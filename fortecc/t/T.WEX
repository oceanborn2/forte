begin TOOL FrameworkBD;

includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionExc;
forward  BusinessExc;
forward  DataExc;
forward  DuplicateKeyExc;
forward  FrontExc;
forward  GenericExc;
forward  ImplementationExc;
forward  NoDataFoundExc;
forward  NotifyExc;
forward  ObjectBD;
forward interface ObjectIf;
forward  RecordAttributeValidityExc;
forward  RecordValidityExc;
forward  SequenceDesc;
forward  Warning;
forward  WarningRecord;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_AOF_ACCESS = 13000;
constant ACT_AOF_CLOSE = 13002;
constant ACT_AOF_EXECUTE = 13003;
constant ACT_AOF_OPEN = 13001;
constant ACT_CRP_ACCESS = 10000;
constant ACT_CRP_GETMODELE = 10002;
constant ACT_CRP_IMPRIMER = 10001;
constant ACT_CRP_WRITEDI = 10101;
constant ACT_CRP_WRITEFILE = 10100;
constant ACT_CTI_ACCESS = 11000;
constant ACT_CTI_ANNULEPREPARETRANSFERT = 11076;
constant ACT_CTI_ANNULERAPPELCAMPAGNE = 11073;
constant ACT_CTI_ANNULERCONSULTATION = 11050;
constant ACT_CTI_APPELCLIENT = 11051;
constant ACT_CTI_ARRETERENREGISTREMENT = 11052;
constant ACT_CTI_ATTENTE = 11053;
constant ACT_CTI_CHANGEMENTMOTDEPASSE = 11054;
constant ACT_CTI_CONSULTATIONCOMPTE = 11055;
constant ACT_CTI_DECROCHE = 11056;
constant ACT_CTI_DEMARRERENREGISTREMENT = 11057;
constant ACT_CTI_DEREGISTERNOTIFIER = 11011;
constant ACT_CTI_DIFFERERAPPELCAMPAGNE = 11074;
constant ACT_CTI_INFOAPPEL = 11058;
constant ACT_CTI_INFOCLIENT = 11059;
constant ACT_CTI_INITIALISERCONSULTATION = 11060;
constant ACT_CTI_INITIALISERCTI = 11020;
constant ACT_CTI_LIBERER = 11061;
constant ACT_CTI_LOGIN = 11062;
constant ACT_CTI_LOGOUT = 11063;
constant ACT_CTI_PAUSE = 11064;
constant ACT_CTI_PREPARETRANSFERT = 11075;
constant ACT_CTI_QUITTER = 11065;
constant ACT_CTI_RACCROCHE = 11066;
constant ACT_CTI_REECOUTE = 11067;
constant ACT_CTI_REECOUTECLIENT = 11068;
constant ACT_CTI_REGISTERNOTIFIER = 11010;
constant ACT_CTI_SYNCCTI = 11077;
constant ACT_CTI_TERMINERCTI = 11021;
constant ACT_CTI_TRANSFERT = 11069;
constant ACT_CTI_TRANSFERTDIRECT = 11070;
constant ACT_CTI_VALIDERCONFERENCE = 11071;
constant ACT_CTI_VALIDERTRANSFERT = 11072;
constant ACT_DETAIL = 100;
constant ACT_DICOREAD = 10;
constant ACT_EXDETAILWIN = 50000;
constant ACT_EXEMPLE = 9999999;
constant ACT_GED_ACCESS = 12000;
constant ACT_GED_AFFICHERDOCDIVERS = 12003;
constant ACT_GED_AFFICHERJUSTIFICATIFS = 12004;
constant ACT_GED_AFFICHERMODELE = 12005;
constant ACT_GED_AFFICHERSIGNATURE = 12006;
constant ACT_GED_INITIALISER = 12001;
constant ACT_GED_RECHERCHER = 12007;
constant ACT_GED_TERMINER = 12002;
constant ACT_HAB_CREATEUSERSESSION = 9;
constant ACT_MQS_ACCESS = 16000;
constant ACT_MQS_CLOSE = 16006;
constant ACT_MQS_CONNECT = 16003;
constant ACT_MQS_DEREGISTERNOTIFIER = 16002;
constant ACT_MQS_DISCONNECT = 16004;
constant ACT_MQS_GETMESSAGE = 16007;
constant ACT_MQS_GETMESSAGES = 16011;
constant ACT_MQS_GETMQMANAGER = 16010;
constant ACT_MQS_GETREFERENCE = 16009;
constant ACT_MQS_OPEN = 16005;
constant ACT_MQS_PUTMESSAGE = 16008;
constant ACT_MQS_REGISTERNOTIFIER = 16001;
constant ACT_NTF_DEREGISTEREVENT = 8;
constant ACT_NTF_REGISTEREVENT = 7;
constant ACT_STD_APPEND = 1;
constant ACT_STD_DELETE = 3;
constant ACT_STD_EXECUTE = 9;
constant ACT_STD_READ = 4;
constant ACT_STD_UPDATE = 2;
constant ACT_TST_GETDATEREF = 100;
constant ACT_UNI_ACCESS = 14000;
constant ACT_UNI_CLOSEREQUESTMAIL = 14104;
constant ACT_UNI_CLOSEREQUESTPOST = 14004;
constant ACT_UNI_CLOSESESSIONMAIL = 14102;
constant ACT_UNI_CLOSESESSIONPOST = 14002;
constant ACT_UNI_COMMITMAIL = 14105;
constant ACT_UNI_COMMITPOST = 14005;
constant ACT_UNI_EXECREQUESTMAIL = 14106;
constant ACT_UNI_EXECREQUESTPOST = 14006;
constant ACT_UNI_GETARGMAIL = 14107;
constant ACT_UNI_GETARGPOST = 14007;
constant ACT_UNI_GETCURSORMAIL = 14108;
constant ACT_UNI_GETCURSORPOST = 14008;
constant ACT_UNI_GETERRORMSGMAIL = 14109;
constant ACT_UNI_GETERRORMSGPOST = 14009;
constant ACT_UNI_GETPARAMMAIL = 14110;
constant ACT_UNI_GETPARAMPOST = 14010;
constant ACT_UNI_GETSTRINGPARAMMAIL = 14111;
constant ACT_UNI_GETSTRINGPARAMPOST = 14011;
constant ACT_UNI_GETVERSIONMAIL = 14112;
constant ACT_UNI_GETVERSIONPOST = 14012;
constant ACT_UNI_HASARGMAIL = 14113;
constant ACT_UNI_HASARGPOST = 14013;
constant ACT_UNI_HASPARAMMAIL = 14114;
constant ACT_UNI_HASPARAMPOST = 14014;
constant ACT_UNI_OPENSESSIONMAIL = 14101;
constant ACT_UNI_OPENSESSIONPOST = 14001;
constant ACT_UNI_PREPAREMAIL = 14115;
constant ACT_UNI_PREPAREPOST = 14015;
constant ACT_UNI_ROLLBACKMAIL = 14116;
constant ACT_UNI_ROLLBACKPOST = 14016;
constant ACT_UNI_SETARGMAIL = 14117;
constant ACT_UNI_SETARGPOST = 14017;
constant ACT_UNI_SETCURSORMAIL = 14118;
constant ACT_UNI_SETCURSORPOST = 14018;
constant ACT_UNI_SETPARAMMAIL = 14119;
constant ACT_UNI_SETPARAMPOST = 14019;
constant ACT_UNI_SETSTRINGPARAMMAIL = 14120;
constant ACT_UNI_SETSTRINGPARAMPOST = 14020;
constant ACT_UNI_STARTREQUESTMAIL = 14103;
constant ACT_UNI_STARTREQUESTPOST = 14003;
constant APP_APPLICATIONNAME = 'Banque Directe';
constant CTI_ET_ACW = 'ACW';
constant CTI_ET_ATTENTE = 'ATTENTE';
constant CTI_ET_AUTOIN = 'APPEL';
constant CTI_ET_LIBRE = 'LIBRE';
constant CTI_ET_LOGGED = 'LOGGED';
constant CTI_ET_NOTLOGGED = 'NOT';
constant CTI_ET_OCCUPE = 'OCC';
constant CTI_ET_PAUSE = 'AUX';
constant CTI_SVI_CLIENTRESERVE = '-1';
constant CTI_SVI_CONSULTECOMPTE = '0';
constant CTI_SVI_MOTDEPASSE = '1';
constant CTI_SVI_NUMERO = '610';
constant CTI_TR_ANNULECLIENT = 'CLIENT';
constant CTI_TR_ANNULECONS = 'CONSEILLER';
constant CTI_TR_CONFERENCE = 3;
constant CTI_TR_DIRECT = 1;
constant CTI_TR_INDIRECT = 2;
constant EVT_CTI_APPELARRIVE = 11501;
constant EVT_CTI_CHANGEMENTETAT = 11502;
constant EVT_CTI_COMMUNICATIONETABLIE = 11503;
constant EVT_CTI_COMMUNICATIONTERMINEE = 11504;
constant EVT_CTI_CONFIRMERDV = 11511;
constant EVT_CTI_CONSULTATIONETABLIE = 11505;
constant EVT_CTI_CONSULTATIONINITIALISEE = 11506;
constant EVT_CTI_CONSULTATIONTERMINEE = 11507;
constant EVT_CTI_ERREURSOFTPHONE = 11508;
constant EVT_CTI_ETATSYNC = 11513;
constant EVT_CTI_QUITTER = 11509;
constant EVT_CTI_TRANSFERTANNULE = 11510;
constant EVT_CTI_TRANSFERTPREPARE = 11512;
constant LOG_GRPFLAG = 1;
constant MSG_DIV = 2;
constant MSG_ERR = 3;
constant MSG_NORM = 1;
constant PLAY_SECURITY = FALSE;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class GenericExc inherits from Framework.GenericException

has public  attribute AppName: Framework.TextData;
has public  attribute Code: Framework.TextData;
has public  attribute Date: Framework.DateTimeNullable;
has public  attribute Level: Framework.TextData;
has public  attribute Source: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ActionExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class BusinessExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DuplicateKeyExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class FrontExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ImplementationExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class NoDataFoundExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class NotifyExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ObjectBD inherits from Framework.Object

has public  method Init;
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

interface ObjectIf 

has property
	componentFlags = 8;
end interface;

class RecordValidityExc inherits from FrameworkBD.GenericExc

has public  attribute ItemName: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RecordAttributeValidityExc inherits from FrameworkBD.RecordValidityExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class SequenceDesc inherits from Framework.Object

has public  constant DEFAULT_INITIAL_INCREMENT = 1;
has public  constant DEFAULT_INITIAL_VALUE = 1;

has private attribute Increment: Framework.integer;
has private attribute Value: Framework.integer;

has public  method CurrentValue: Framework.integer;
has public  method Init;
has public  method NextValue: Framework.integer;
has public  method SetIncrement(input pValue: Framework.integer);
has public  method SetIncrement(input pValue: Framework.IntegerData);
has public  method SetValue(input pValue: Framework.integer);
has public  method SetValue(input pValue: Framework.IntegerData);

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=on, override=off, default=off);

end class;

class Warning inherits from Framework.Object

has public  attribute Message: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class WarningRecord inherits from FrameworkBD.Warning

has public  attribute ItemName: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='Action inconnue : ');

end method;

------------------------------------------------------------
method BusinessExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='BusinessExc : ');

end method;

------------------------------------------------------------
method DataExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='DataExc : ');

end method;

------------------------------------------------------------
method DuplicateKeyExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='Duplicate Key on ');

end method;

------------------------------------------------------------
method FrontExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='FrontExc : ');

end method;

------------------------------------------------------------
method GenericExc.Init
begin
super.Init();
AppName=new;
Code=new;
Date=new;
Level=new;
Source=new;
end method;

------------------------------------------------------------
method ImplementationExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='This Method should be Overwritten : ');

end method;

------------------------------------------------------------
method NoDataFoundExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NotifyExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='NotifyExc : ');

end method;

------------------------------------------------------------
method ObjectBD.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ObjectBD.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method RecordAttributeValidityExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RecordValidityExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method SequenceDesc.CurrentValue: Framework.integer
begin
return Self.Value;
end method;

------------------------------------------------------------
method SequenceDesc.Init
begin
super.Init();
Self.Value = DEFAULT_INITIAL_VALUE;
Self.Increment = DEFAULT_INITIAL_INCREMENT;
end method;

------------------------------------------------------------
method SequenceDesc.NextValue: Framework.integer
begin
Result : integer = Self.Value;
Self.Value = Self.Value + Self.Increment;
Return Result;	
end method;

------------------------------------------------------------
method SequenceDesc.SetIncrement(input pValue: Framework.integer)
begin
Self.Increment = pValue;
end method;

------------------------------------------------------------
method SequenceDesc.SetIncrement(input pValue: Framework.IntegerData)
begin
Self.SetIncrement(pValue = pValue.Value);
end method;

------------------------------------------------------------
method SequenceDesc.SetValue(input pValue: Framework.integer)
begin
Self.Value = pValue;
end method;

------------------------------------------------------------
method SequenceDesc.SetValue(input pValue: Framework.IntegerData)
begin
Self.SetValue(pValue = pValue.Value);
end method;

------------------------------------------------------------
method Warning.Init
begin
super.Init();
end method;

------------------------------------------------------------
method WarningRecord.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 1;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'framewor';


end FrameworkBD;
begin TOOL DataAccessSrvBD;

includes FrameworkBD;
includes GenericDBMS;
includes Framework;
includes SystemMonitor;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionDesc;
forward  ActionDescSql;
forward  AgentBD;
forward  AgentFrontCommSrv;
forward  AgentManager;
forward  AgentService;
forward  ApplicationBDDesc;
forward  ApplicationBDSqlDesc;
forward  AutorisationDesc;
forward  BusinessServiceDesc;
forward  BusinessServiceMgrDesc;
forward  Cache;
forward  CacheDesc;
forward  DataAvailabilityExc;
forward  DataAvailabilityException;
forward  DataConcurencyExc;
forward  DataConcurencyException;
forward  DataContext;
forward  DataIntegrityExc;
forward  DataIntegrityException;
forward  DataSecurityExc;
forward  DataSecurityException;
forward  DataServiceDesc;
forward  DataServiceMgrDesc;
forward  DataServiceSqlDesc;
forward  DialogueManagerDesc;
forward  DialogueServiceDesc;
forward  EventDesc;
forward  FrontCommSrvDesc;
forward  GroupDesc;
forward  IndexDesc;
forward  InstanceDesc;
forward  InterfaceMgrDesc;
forward  InterfaceServiceDesc;
forward  LoginDesc;
forward  LoginDescSql;
forward  LoginExc;
forward  LoginRoleDescSql;
forward  ObjectSelfDesc;
forward  ParallelEltReturnDesc;
forward  ParallelServiceDesc;
forward  ParamDesc;
forward  ParamDescSql;
forward  PasswordDesc;
forward  ProfilActionDescSql;
forward  ProfilDesc;
forward  ProfilDescSql;
forward  RecordDesc;
forward  RoleDesc;
forward  RoleDescSql;
forward  SecurityExc;
forward  ServiceDesc;
forward  ServiceMgrDesc;
forward  SessionHabDesc;
forward  SessionId;
forward  SessionIdDesc;
forward  SessionSrvDesc;
forward  SessionSrvDSDesc;
forward  SessionUserDesc;
forward  StdEventNotifier;
forward  StructureDesc;
forward  StructureServiceDesc;
forward  TimeWatch;
forward  TransClass;
forward  TransDesc;
forward  TransDico;
forward interface TransferIf;
forward  TransferMecanism;
forward  TransferTrt;
forward  TransIntCtxt;
forward  TransProcess;
forward  UserDesc;
forward  UserDescSql;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant DTA_APPEND = 1;
constant DTA_DELETE = 3;
constant DTA_DEREGISTEREVENT = 8;
constant DTA_READ = 4;
constant DTA_REGISTEREVENT = 7;
constant DTA_UPDATE = 2;
constant HAB_REL_PROFILACTIONPARAM = 2;
constant HAB_REL_USERPARAM = 1;
constant LOG_GRPFLAG = 4;
constant TYPEDATA_BOOLEAN = 4;
constant TYPEDATA_DOUBLE = 3;
constant TYPEDATA_INTEGER = 2;
constant TYPEDATA_TEXT = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ObjectSelfDesc inherits from Framework.Object

has public  attribute DtMajQqo: Framework.DateTimeNullable;
has public  attribute FlagSuppr: Framework.boolean;
has public  attribute Id: Framework.integer;
has public  attribute IdUtlQqo: Framework.integer;
has public  attribute SelfDesc: Framework.Array of DataAccessSrvBD.StructureDesc;
has public  attribute ServiceMgr: DataAccessSrvBD.ServiceMgrDesc;
has public  attribute unService: Framework.ClassType;

has public  method DoCheckValidity: Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ActionDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Code: Framework.IntegerNullable;
has public  attribute Description: Framework.TextNullable;
has public  attribute FlagAppend: Framework.BooleanNullable;
has public  attribute FlagDelete: Framework.BooleanNullable;
has public  attribute FlagExecute: Framework.BooleanNullable;
has public  attribute FlagRead: Framework.BooleanNullable;
has public  attribute FlagUpdate: Framework.BooleanNullable;
has public  attribute IdApplicationBDDesc: Framework.IntegerNullable;
has public  attribute LibAction: Framework.TextNullable;
has public  attribute Parametres: Framework.Array of DataAccessSrvBD.ParamDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method GetParam(input pCodeParam: Framework.integer): DataAccessSrvBD.ParamDesc;
has public  method Init;
has public  method IsAuthorisedFor(input pAuthorisation: Framework.integer): Framework.boolean;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ActionDescSql inherits from DataAccessSrvBD.ActionDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AgentBD inherits from SystemMonitor.SystemAgent

has public  attribute LastIndexInst: DataAccessSrvBD.IndexDesc;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AgentFrontCommSrv inherits from SystemMonitor.SystemAgent

has public  constant ADMINISTRATION_FRONTCOMM_INST = 1;
has public  constant AVEPROCESSING_FRONTCOMM_INST = 4;
has public  constant INITIALISERINST_CMD = 1;
has public  constant MAXPROCESSING_FRONTCOMM_INST = 2;
has public  constant METHODCALLS_FRONTCOMM_INST = 5;
has public  constant MINPROCESSING_FRONTCOMM_INST = 3;

has public  attribute CommTimeWatch: DataAccessSrvBD.TimeWatch;

has public  method AttachMO(input managedObject: Framework.Object);
has public  method GetMOTypeName: Framework.string;
has public  method Init;
has public  method InitCmdProcessor;
has public  method ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object;
has public  method UpdateInstrument(input inst: SystemMonitor.Instrument);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AgentManager inherits from DataAccessSrvBD.AgentBD

has public  constant ADMINISTRATION_MANAGER_INST = 1;
has public  constant DEPENDANCES_MANAGER_INST = 2;
has public  constant INITIALISERINST_CMD = 3;
has public  constant SERVICES_MANAGER_INST = 3;
has public  constant STARTSERVICESAGENTS_CMD = 1;
has public  constant STOPSERVICESAGENTS_CMD = 2;

has public  attribute ServicesAgentsStarted: Framework.boolean;

has public  method AttachMO(input managedObject: Framework.Object);
has public  method GetMOTypeName: Framework.string;
has public  method Init;
has public  method InitCmdProcessor;
has public  method InstrumentUpdated(input inst: SystemMonitor.Instrument);
has public  method ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object;
has public  method UpdateInstrument(input inst: SystemMonitor.Instrument);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AgentService inherits from DataAccessSrvBD.AgentBD

has public  constant ADMINISTRATION_SERVICE_INST = 2;
has public  constant DIALOGUES_SERVICE_INST = 3;
has public  constant PERFORMANCES_SERVICE_INST = 1;

has public  attribute AdminInst: SystemMonitor.CompoundInst;
has public  attribute ArrayDialoguesMgr: Framework.Array of DataAccessSrvBD.DialogueManagerDesc;
has public  attribute ArrayTimeWatches: Framework.LargeArray of DataAccessSrvBD.TimeWatch;
has public  attribute DialoguesInst: SystemMonitor.SubObjectInst;
has public  attribute PerformancesInst: SystemMonitor.SubObjectInst;

has public  method AddDialogueInst(input pServiceMgrName: Framework.TextData,
	input pServiceName: Framework.TextData);
has public  method AddPerformanceInst(input pTimeWatch: DataAccessSrvBD.TimeWatch,
	input pNomAction: Framework.TextData);
has public  method AttachMO(input managedObject: Framework.Object);
has public  method GetMOTypeName: Framework.string;
has public  method Init;
has public  method InitCmdProcessor;
has public  method InstrumentUpdated(input inst: SystemMonitor.Instrument);
has public  method ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object;
has public  method UpdateInstrument(input inst: SystemMonitor.Instrument);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ApplicationBDDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Actions: Framework.Array of DataAccessSrvBD.ActionDesc;
has public  attribute Code: Framework.IntegerNullable;
has public  attribute Description: Framework.TextNullable;
has public  attribute IdType: Framework.integer;
has public  attribute LibApplication: Framework.TextNullable;
has public  attribute Profils: Framework.Array of DataAccessSrvBD.ProfilDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetSelfDescUpdate;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ApplicationBDSqlDesc inherits from DataAccessSrvBD.ApplicationBDDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AutorisationDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Code: Framework.integer;
has public  attribute Description: Framework.TextNullable;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ServiceDesc inherits from FrameworkBD.ObjectBD

has public  attribute ActionHab: DataAccessSrvBD.ActionDesc;
has public  attribute AgentSvc: DataAccessSrvBD.AgentService;
has public  attribute ArrayTimeWatches: Framework.LargeArray of DataAccessSrvBD.TimeWatch;
has public  attribute Dependances: Framework.Array of Framework.Object;
has public  attribute Events: Framework.Array of DataAccessSrvBD.EventDesc;
has public  attribute NotificationService: DataAccessSrvBD.ServiceDesc;
has public  attribute ServiceStarted: Framework.boolean;
has public  attribute TransferMecanisms: Framework.Array of DataAccessSrvBD.TransferMecanism;


has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = ActionDone, exception = ActionExc);
has public  method AddTimeWatch(input pCodeAction: Framework.integer);
has public  method CheckPartition: Framework.string;
has public  method DeRegisterEvent(input aEvent: DataAccessSrvBD.EventDesc);
has public  method DeRegisterEvent(input aTransOrigin: DataAccessSrvBD.StdEventNotifier);
has public  method DoInitService;
has public  method Init;
has public  method InitService;
has public  method Notify(input aClassType: Framework.ClassType,
	input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL);
has public  method Notify(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL);
has public  method RegisterEvent(input aTransOrigin: DataAccessSrvBD.StdEventNotifier);
has public  method RegisterEvent(input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier);
has public  method SplitTimeWatch(input pCodeAction: Framework.integer,
	input pTimeSplit: Framework.integer);
has public  method SyncServices;
has public  method Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = TransferDone, exception = TransferExc);

implements	DataAccessSrvBD.TransferIf;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class BusinessServiceDesc inherits from DataAccessSrvBD.ServiceDesc

has public  attribute BusinessClass: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute FlagAppend: Framework.boolean;
has public  attribute FlagDelete: Framework.boolean;
has public  attribute FlagDynamic: Framework.boolean;
has public  attribute FlagRead: Framework.boolean;
has public  attribute FlagUpdate: Framework.boolean;
has public  attribute NtfAppend: Framework.boolean;
has public  attribute NtfDelete: Framework.boolean;
has public  attribute NtfUpdate: Framework.boolean;
has public  attribute ReadModelParallelServices: Framework.Array of DataAccessSrvBD.ParallelServiceDesc;
has public  attribute ReadPrepareDone: Framework.boolean;
has public  attribute TrsAppend: Framework.boolean;
has public  attribute TrsDelete: Framework.boolean;
has public  attribute TrsRead: Framework.boolean;
has public  attribute TrsUpdate: Framework.boolean;


has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Append(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;
has public  method AppendAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;
has public  method AppendUpdateComposant(input pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE) where completion = (return = AppendUpdateComposantArrayDone, exception = AppendUpdateComposantArrayExc);
has public  method AppendUpdateComposant(input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE) where completion = (return = AppendUpdateComposantDone, exception = AppendUpdateComposantExc);
has public  method AppendUpdateComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input output unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method AppendUpdateElt(input pCount: Framework.integer,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE): DataAccessSrvBD.ParallelEltReturnDesc where completion = (return = AppendUpdateEltDone, exception = AppendUpdateEltExc);
has public  method BusinessClassMaj(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pResult: DataAccessSrvBD.ObjectSelfDesc);
has public  method CheckPostAppend: Framework.boolean;
has public  method CheckPostDelete: Framework.boolean;
has public  method CheckPostRead: Framework.boolean;
has public  method CheckPostUpdate: Framework.boolean;
has public  method CheckPreAction: Framework.boolean;
has public  method CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreAppendAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreDelete(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreDeleteAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreReadAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreUpdate(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has public  method CheckPreUpdateAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean;
has private method CheckTransfer(input aObject: Framework.Object): Framework.boolean;
has public  method CloneModelComposition(input pParallelServices: Framework.Array of DataAccessSrvBD.ParallelServiceDesc,
	input Deep: Framework.boolean): Framework.Array of DataAccessSrvBD.ParallelServiceDesc;
has public  method Delete(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DeleteAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DeleteComposant(input output pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL) where completion = (return = DeleteComposantArrayDone, exception = DeleteComposantArrayExc);
has public  method DeleteComposant(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL) where completion = (return = DeleteComposantDone, exception = DeleteComposantExc);
has public  method DeleteComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DeleteElt(input pCount: Framework.integer,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): DataAccessSrvBD.ParallelEltReturnDesc where completion = (return = DeleteEltDone, exception = DeleteEltExc);
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoAfterAppend(input output pTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object);
has public  method DoAfterAppendActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoAfterDelete(input output aTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object);
has public  method DoAfterDeleteActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoAfterRead(input output aTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object);
has public  method DoAfterReadActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: Framework.Array of DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoAfterUpdate(input output pTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object);
has public  method DoAfterUpdateActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoAppendAction(input pTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method DoBeforeAppend(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method DoBeforeAppendActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoBeforeDelete(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method DoBeforeDeleteActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoBeforeRead(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method DoBeforeReadActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: Framework.Array of DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method DoBeforeUpdateActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL);
has public  method Init;
has public  method Read(input pTransData: DataAccessSrvBD.TransDesc,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;
has public  method ReadAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;
has public  method ReadComposant(input output pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType) where completion = (return = ReadComposantArrayDone, exception = ReadComposantArrayExc);
has public  method ReadComposant(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType) where completion = (return = ReadComposantDone, exception = ReadComposantExc);
has public  method ReadComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input output unResult: DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL) where completion = (return = ReadCompositionDone, exception = ReadCompositionExc);
has public  method ReadPrepareComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pCompositionPrepareDone: Framework.boolean = FALSE,
	input pAffectModel: Framework.boolean = TRUE): Framework.Array of DataAccessSrvBD.ParallelServiceDesc;
has public  method Update(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;
has public  method UpdateAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ServiceMgrDesc inherits from FrameworkBD.ObjectBD

has public  attribute AgentMgr: DataAccessSrvBD.AgentManager;
has public  attribute Dependances: Framework.Array of Framework.Object;
has public  attribute Instances: Framework.Array of DataAccessSrvBD.InstanceDesc;
has public  attribute NotificationService: DataAccessSrvBD.ServiceDesc;
has public  attribute ServiceStarted: Framework.boolean;


has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = ActionDone, exception = ActionExc);
has public  method AfterSyncServices;
has public  method AppendRow(input aIdent: Framework.ClassType,
	input aObject: Framework.Object = NIL);
has public  method CheckPartition: Framework.string;
has public  method CheckPreAction: Framework.boolean;
has public  method CheckTransfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransType: DataAccessSrvBD.ServiceDesc): Framework.boolean;
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoAfterSyncServices;
has public  method DoBeforeSyncServices;
has public  method DoInitService;
has public  method FindObjectForIdent(input aIdent: Framework.ClassType): Framework.Object;
has public  method FindRowForIdent(input aIdent: Framework.ClassType): Framework.integer;
has public  method Init;
has public  method InitService;
has public  method InitTransType(input aClassType: Framework.ClassType,
	output aTransType: DataAccessSrvBD.ServiceDesc);
has public  method ReplaceObjectForIdent(input aIdent: Framework.ClassType,
	input aObject: Framework.Object);
has public  method StartManagerAgent;
has public  method StartServicesAgents(input pAgentMgr: DataAccessSrvBD.AgentBD);
has public  method SyncServices;
has public  method TransferByRef(input aTransData: DataAccessSrvBD.TransDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = TransferByRefDone, exception = TransferByRefExc);
has public  method TransferByValue(copy input aTransData: DataAccessSrvBD.TransDesc,
	copy input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): copy Framework.Object where completion = (return = TransferByValueDone, exception = TransferByValueExc);

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=on, override=on, default=off);

end class;

class BusinessServiceMgrDesc inherits from DataAccessSrvBD.ServiceMgrDesc

has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class Cache inherits from Framework.Object

has private attribute LastId: Framework.integer;
has public  attribute Objects: Framework.Array of DataAccessSrvBD.CacheDesc;

has public  method Append(input aObjects: Framework.Array of Framework.Object);
has public  method Append(input output aCacheDesc: DataAccessSrvBD.CacheDesc);
has public  method CriteraPlay(input aCritera: Framework.TextData,
	input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean;
has public  method Delete(input aCacheDesc: DataAccessSrvBD.CacheDesc);
has public  method GetPosition(input RecordId: Framework.integer): Framework.integer;
has public  method Init;
has public  method IsInCache(input RecordId: Framework.long): Framework.boolean;
has public  method Lock(copy input output aCacheDesc: DataAccessSrvBD.CacheDesc): Framework.boolean;
has private method QuickSort(input aSortCritera: Framework.TextData,
	input aRecords: Framework.Array of DataAccessSrvBD.CacheDesc,
	input Left: Framework.integer,
	input Right: Framework.integer);
has private method QuickSort(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aRecords: Framework.Array of DataAccessSrvBD.CacheDesc,
	input Left: Framework.integer,
	input Right: Framework.integer);
has public  method Read: Framework.Array of DataAccessSrvBD.CacheDesc;
has public  method Read(input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input aFilterCritera: Framework.TextData,
	input aSortCritera: Framework.TextData): Framework.Array of DataAccessSrvBD.CacheDesc;
has public  method Read(input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input aFilterCritera: Framework.TextData): Framework.Array of DataAccessSrvBD.CacheDesc;
has public  method Read(input RecordId: Framework.integer): DataAccessSrvBD.CacheDesc;
has public  method Sort(input aSortCritera: Framework.TextData);
has private method TstExpression(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aValue: Framework.TextData,
	input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean;
has private method TstSortExpression(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aRecord1: DataAccessSrvBD.ObjectSelfDesc,
	input aRecord2: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean;
has private method TstSortExpression(input aSortCritera: Framework.TextData,
	input aRecord1: DataAccessSrvBD.ObjectSelfDesc,
	input aRecord2: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean;
has public  method Unlock(copy input output aCacheDesc: DataAccessSrvBD.CacheDesc): Framework.boolean;
has public  method Update(input aCacheDesc: DataAccessSrvBD.CacheDesc);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class CacheDesc inherits from Framework.Object

has public  attribute IdUtl: Framework.integer;
has public  attribute Lock: Framework.boolean;
has public  attribute LockSessionId: DataAccessSrvBD.SessionId;
has public  attribute Record: DataAccessSrvBD.ObjectSelfDesc;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataAvailabilityExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataAvailabilityException inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataConcurencyExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataConcurencyException inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataContext inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Date: Framework.DateTimeNullable;
has public  attribute RecordId: Framework.integer;
has public  attribute unRecord: DataAccessSrvBD.ObjectSelfDesc;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataIntegrityExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataIntegrityException inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataSecurityExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataSecurityException inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DataServiceDesc inherits from DataAccessSrvBD.ServiceDesc

has public  attribute FlagAppend: Framework.boolean;
has public  attribute FlagDelete: Framework.boolean;
has public  attribute FlagRead: Framework.boolean;
has public  attribute FlagUpdate: Framework.boolean;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Append(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has private method CheckConsDataServiceDesc: Framework.boolean;
has public  method CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreAppendAction(input ObjectP: Framework.Object);
has public  method CheckPreDelete(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreDeleteAction(input ObjectP: Framework.Object);
has public  method CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreUpdate(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreUpdateAction(input ObjectP: Framework.Object);
has public  method Delete(input aTransData: DataAccessSrvBD.TransDesc);
has private method DeleteAction(input aTransData: DataAccessSrvBD.TransDesc);
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method Read(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;
has private method ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;
has public  method Update(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method UpdateAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method Write(input aTransObject: Framework.Object);
has private method WriteAction(input aObject: Framework.Object);

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class DataServiceMgrDesc inherits from DataAccessSrvBD.ServiceMgrDesc

has public  attribute FlagDbResource: Framework.boolean;
has public  attribute laDBSession: GenericDBMS.DBSession;
has public  attribute laResourceName: Framework.string;
has public  attribute laResourceOptionList: Framework.Array of Framework.NamedElement;
has public  attribute laResourceUserName: Framework.string;
has public  attribute laResourceUserPassword: Framework.string;

has public  method AfterSyncServices;
has public  method Init;
has public  method ObtenirDBSession;
has public  method SyncServices;
has public  method TracerDBSession;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class DataServiceSqlDesc inherits from DataAccessSrvBD.DataServiceDesc

has public  attribute AppendSQLHdle: GenericDBMS.DBStatementHandle;
has public  attribute AppendSQLInDesc: GenericDBMS.DBDataSet;
has public  attribute AppendSQLText: Framework.string;
has public  attribute AppendSQLType: Framework.integer;
has public  attribute ClauseFrom: Framework.string;
has public  attribute ClauseOrderBy: Framework.string;
has public  attribute ClauseSelect: Framework.string;
has public  attribute ClauseWhere: Framework.string;
has public  attribute DeleteSQLHdle: GenericDBMS.DBStatementHandle;
has public  attribute DeleteSQLInDesc: GenericDBMS.DBDataSet;
has public  attribute DeleteSQLText: Framework.string;
has public  attribute DeleteSQLType: Framework.integer;
has public  attribute laDBSession: GenericDBMS.DBSession;
has public  attribute ReadAllSQLHdle: GenericDBMS.DBStatementHandle;
has public  attribute ReadAllSQLInDesc: GenericDBMS.DBDataSet;
has public  attribute ReadAllSQLText: Framework.string;
has public  attribute ReadAllSQLType: Framework.integer;
has public  attribute ReadSQLHdle: GenericDBMS.DBStatementHandle;
has public  attribute ReadSQLInDesc: GenericDBMS.DBDataSet;
has public  attribute ReadSQLText: Framework.string;
has public  attribute ReadSQLType: Framework.integer;
has public  attribute RecordInstance: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute UpdateSQLHdle: GenericDBMS.DBStatementHandle;
has public  attribute UpdateSQLInDesc: GenericDBMS.DBDataSet;
has public  attribute UpdateSQLText: Framework.string;
has public  attribute UpdateSQLType: Framework.integer;

has public  method AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method CalculerAppendSQL;
has public  method CalculerDeleteSQL;
has public  method CalculerReadAllSQL;
has public  method CalculerReadIntCtxtSQL(input pTransData: DataAccessSrvBD.TransIntCtxt): Framework.string;
has public  method CalculerReadSQL;
has public  method CalculerUpdateSQL;
has public  method CheckPreAppendAction(input ObjectP: Framework.Object);
has public  method CheckPreDeleteAction(input ObjectP: Framework.Object);
has public  method CheckPreUpdateAction(input ObjectP: Framework.Object);
has public  method DeleteAction(input aTransData: DataAccessSrvBD.TransDesc);
has private method DoAppendAction(input aObject: Framework.Object);
has public  method DoConnecterDBSessionMgr_OLD;
has private method DoDeleteAction(input aObject: Framework.Object): Framework.long;
has public  method DoInitServiceSQL;
has private method DoReadAction;
has private method DoUpDateAction(input aObject: Framework.Object): Framework.long;
has public  method Init;
has public  method PrepareAppend;
has public  method PrepareDelete;
has public  method PrepareRead;
has public  method PrepareReadAll;
has public  method PrepareUpdate;
has public  method ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;
has public  method SetCacheDescs(input desObjectSelfDesc: Framework.Array of DataAccessSrvBD.ObjectSelfDesc): Framework.Array of DataAccessSrvBD.CacheDesc;
has public  method StartService;
has public  method UpdateAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class DialogueManagerDesc inherits from FrameworkBD.ObjectBD

has public  attribute ArrayServices: Framework.Array of DataAccessSrvBD.DialogueServiceDesc;
has public  attribute NameManager: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DialogueServiceDesc inherits from FrameworkBD.ObjectBD

has public  attribute CounterService: Framework.integer;
has public  attribute NameService: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class EventDesc inherits from Framework.Object

has public  attribute ClassType: Framework.ClassType;
has public  attribute EventHandle: Framework.EventHandle;
has public  attribute StdEvent: DataAccessSrvBD.StdEventNotifier;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class FrontCommSrvDesc inherits from DataAccessSrvBD.ServiceDesc

has public  attribute AgentFComm: DataAccessSrvBD.AgentFrontCommSrv;
has public  attribute CodeApplication: Framework.integer;
has public  attribute SessionSrv: DataAccessSrvBD.SessionSrvDesc;


has public  method Connect(copy output SessionId: DataAccessSrvBD.SessionId) where completion = (return = ConnectDone, exception = ConnectExc);
has public  method Connect(copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc) where completion = (return = ConnectUserDone, exception = ConnectUserExc);
has public  method GetRoleLst(input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc;
has public  method Init;
has public  method SplitTimeWatch(input pTimeSplit: Framework.integer);
has public  method StartFrontCommAgent(input pAgentName: Framework.TextData);
has public  method Transfer(copy input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.BusinessServiceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier): copy Framework.Object where completion = (return = TransferDone, exception = TransferExc);
has public  method Transfer(copy input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.InterfaceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier): copy Framework.Object where completion = (return = TransferItDone, exception = TransferItExc);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class GroupDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Code: Framework.IntegerNullable;
has public  attribute Description: Framework.TextNullable;
has public  attribute Skill: Framework.IntegerNullable;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class IndexDesc inherits from FrameworkBD.ObjectBD

has public  attribute Index: Framework.integer;

has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InstanceDesc inherits from Framework.Object

has public  attribute aIdent: Framework.ClassType;
has public  attribute aObject: Framework.Object;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceMgrDesc inherits from DataAccessSrvBD.ServiceMgrDesc

has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class InterfaceServiceDesc inherits from DataAccessSrvBD.ServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=on);

end class;

class LoginDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Description: Framework.TextNullable;
has public  attribute IdApplication: Framework.IntegerNullable;
has public  attribute IdProfil: Framework.IntegerNullable;
has public  attribute IdUserDesc: Framework.IntegerNullable;
has public  attribute Password: DataAccessSrvBD.PasswordDesc;
has public  attribute Profil: DataAccessSrvBD.ProfilDesc;
has public  attribute Username: Framework.TextNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LoginDescSql inherits from DataAccessSrvBD.LoginDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LoginExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LoginRoleDescSql inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute IdLogin: Framework.integer;
has public  attribute IdRole: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ParallelEltReturnDesc inherits from Framework.Object

has public  attribute Count: Framework.integer;
has public  attribute Object: Framework.Object;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ParallelServiceDesc inherits from Framework.Object

has public  attribute BusinessClass: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute BusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc;
has public  attribute ComposantCount: Framework.integer;
has public  attribute LinkAttCount: Framework.integer;
has public  attribute ServiceMgr: DataAccessSrvBD.ServiceMgrDesc;
has public  attribute TransIntCtxt: DataAccessSrvBD.TransIntCtxt;
has public  attribute unService: Framework.ClassType;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ParamDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Code: Framework.IntegerNullable;
has public  attribute DataValue: Framework.DataValue;
has public  attribute Description: Framework.TextNullable;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ParamDescSql inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Code: Framework.integer;
has public  attribute DataBoolean: Framework.boolean;
has public  attribute DataDouble: Framework.double;
has public  attribute DataInteger: Framework.integer;
has public  attribute DataText: Framework.string;
has public  attribute IdParent: Framework.integer;
has public  attribute TypeData: Framework.integer;
has public  attribute TypeRelation: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class PasswordDesc inherits from Framework.TextNullable

has public  method Decrypt(input pKey: Framework.integer);
has public  method Encrypt(input pKey: Framework.integer);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class ProfilActionDescSql inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute FlagAppend: Framework.boolean;
has public  attribute FlagDelete: Framework.boolean;
has public  attribute FlagExecute: Framework.boolean;
has public  attribute FlagRead: Framework.boolean;
has public  attribute FlagUpdate: Framework.boolean;
has public  attribute IdAction: Framework.integer;
has public  attribute IdProfil: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ProfilDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute ActionDeb: DataAccessSrvBD.ActionDesc;
has public  attribute Actions: Framework.Array of DataAccessSrvBD.ActionDesc;
has public  attribute Description: Framework.TextNullable;
has public  attribute IdApplicationBDDesc: Framework.IntegerNullable;
has public  attribute LibProfil: Framework.TextNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ProfilDescSql inherits from DataAccessSrvBD.ProfilDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RecordDesc inherits from Framework.Object

has public  attribute DtMajQqo: Framework.DateTimeNullable;
has public  attribute Id: Framework.integer;
has public  attribute IdPtacsQqo: Framework.integer;
has public  attribute IdUtlQqo: Framework.integer;
has public  attribute Object: Framework.Object;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RoleDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute AgentId: Framework.TextNullable;
has public  attribute Code: Framework.integer;
has public  attribute Libelle: Framework.string;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RoleDescSql inherits from DataAccessSrvBD.RoleDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class SecurityExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class SessionHabDesc inherits from Framework.Object

has public  attribute SessionId: DataAccessSrvBD.SessionId;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=off);

end class;

class SessionId inherits from Framework.Object

has public  attribute SessionId: DataAccessSrvBD.SessionIdDesc;
has public  virtual attribute Value: Framework.integer = (set =   _SetValue(Value), get =   SessionId.SessionId);

has public  method _SetValue(input aValue: Framework.integer);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class SessionIdDesc inherits from Framework.Object

has public  attribute SessionId: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class SessionSrvDesc inherits from DataAccessSrvBD.ServiceDesc

has private attribute LastSessionId: Framework.integer;
has public  attribute SessionSrvDS: DataAccessSrvBD.SessionSrvDSDesc;
has public  attribute SessionsUser: Framework.Array of DataAccessSrvBD.SessionUserDesc;


has public  method Connect(copy output SessionId: DataAccessSrvBD.SessionId) where completion = (return = ConnectDone, exception = ConnectExc);
has public  method Connect(copy input CodeApplication: Framework.integer,
	copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc) where completion = (return = UserConnectDone, exception = UserConnectExc);
has public  method GetRoleLst(input pCodeApplication: Framework.integer,
	input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc;
has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class SessionSrvDSDesc inherits from DataAccessSrvBD.DataServiceDesc

has public  attribute laDbSession: GenericDBMS.DBSession;
has public  attribute LastUserSessionId: Framework.integer;


has public  method Connect(copy input CodeApplication: Framework.integer,
	copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc) where completion = (return = UserConnectDone, exception = UserConnectExc);
has public  method GetRoleLst(input pCodeApplication: Framework.integer,
	input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc;
has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class SessionUserDesc inherits from FrameworkBD.ObjectBD

has public  attribute CodeApplication: Framework.integer;
has public  attribute DtDebut: Framework.DateTimeNullable;
has public  attribute DtFin: Framework.DateTimeNullable;
has public  attribute Groups: Framework.Array of DataAccessSrvBD.GroupDesc;
has public  attribute Id: Framework.integer;
has public  attribute IdUtl: Framework.integer;
has public  attribute Profile: DataAccessSrvBD.ProfilDesc;
has public  attribute Role: DataAccessSrvBD.RoleDesc;
has public  attribute User: DataAccessSrvBD.UserDesc;
has public  attribute Username: Framework.string;

has public  method BeginSession;
has public  method CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean;
has public  method EndSession;
has public  method GetAction(input pCodeAction: Framework.integer): DataAccessSrvBD.ActionDesc;
has public  method Init;
has public  method IsActionInProfile(input pCodeAction: Framework.integer): Framework.boolean;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class StdEventNotifier inherits from Framework.Object

has public  event StdEvent(input Type: Framework.integer,
	input Object: Framework.Object);

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class StructureDesc inherits from Framework.Object

has public  attribute ItemName: Framework.string;
has public  attribute ItemReference: Framework.Object;
has public  attribute ItemUserName: Framework.string;
has public  attribute LinkActive: Framework.boolean;
has public  attribute LinkAppend: Framework.boolean;
has public  attribute LinkDelete: Framework.boolean;
has public  attribute LinkRead: Framework.boolean;
has public  attribute LinkUpdate: Framework.boolean;
has public  attribute ParentItemName: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class StructureServiceDesc inherits from Framework.Object

has public  attribute unObjetMetier: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute unService: Framework.ClassType;
has public  attribute unServiceMgr: DataAccessSrvBD.ServiceMgrDesc;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TimeWatch inherits from Framework.Object

has public  attribute AveProcessingTime: Framework.integer;
has public  attribute MaxProcessingTime: Framework.integer;
has public  attribute MethodCallsCount: Framework.integer;
has public  attribute MinProcessingTime: Framework.integer;
has public  attribute TotalProcessingTime: Framework.integer;

has public  method CalculerAveProcessingTime(input pTimeSplit: Framework.integer);
has public  method CalculerMaxProcessingTime(input pTimeSplit: Framework.integer);
has public  method CalculerMinProcessingTime(input pTimeSplit: Framework.integer);
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TransDesc inherits from Framework.Object

has public  attribute IdUtl: Framework.integer;
has public  attribute TransActionService: Framework.integer;
has public  attribute TransObject: Framework.Object;
has public  attribute TransSessionId: DataAccessSrvBD.SessionId;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransClass inherits from DataAccessSrvBD.TransDesc

has public  attribute aDataContext: DataAccessSrvBD.DataContext;
has public  attribute aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransDico inherits from DataAccessSrvBD.TransDesc

has public  attribute aClassType: Framework.ClassType;
has public  attribute TypeLib: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

interface TransferIf inherits from FrameworkBD.ObjectIf


has public  method Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = TransferDone, exception = TransferExc);

has property
	componentFlags = 8;
end interface;

class TransferMecanism inherits from Framework.Object

has public  attribute unServiceMgr: DataAccessSrvBD.ServiceMgrDesc;
has public  attribute UseByValue: Framework.boolean;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TransferTrt inherits from FrameworkBD.ObjectBD

has public  attribute TrfRessource: DataAccessSrvBD.TransferIf;


has public  method Init;
has public  method Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = TransferDone, exception = TransferExc);

implements	DataAccessSrvBD.TransferIf;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TransIntCtxt inherits from DataAccessSrvBD.TransDesc

has public  attribute aDataContext: DataAccessSrvBD.DataContext;
has public  attribute aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransProcess inherits from DataAccessSrvBD.TransDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class UserDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Description: Framework.TextNullable;
has public  attribute Logins: Framework.Array of DataAccessSrvBD.LoginDesc;
has public  attribute Parametres: Framework.Array of DataAccessSrvBD.ParamDesc;
has public  attribute UserName: Framework.TextNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class UserDescSql inherits from DataAccessSrvBD.UserDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	27/06/1997	|	Creation.
--+

Self.Code = New();
Self.Description 			= New();
Self.FlagAppend 			= New();
Self.FlagDelete 			= New();
Self.FlagExecute			= New();
Self.FlagRead 				= New();
Self.FlagUpdate				= New();
Self.IdApplicationBDDesc	= New();
Self.LibAction				= New();
Self.Parametres				= New();

end method;

------------------------------------------------------------
method ActionDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Code';
SelfDesc[SelfDesc.Items].ItemReference = Self.Code;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Description';
SelfDesc[SelfDesc.Items].ItemReference = Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName = 'Description';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'FlagAppend';
SelfDesc[SelfDesc.Items].ItemReference = Self.FlagAppend;
SelfDesc[SelfDesc.Items].ItemUserName = 'FlagAppend';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'FlagDelete';
SelfDesc[SelfDesc.Items].ItemReference = Self.FlagDelete;
SelfDesc[SelfDesc.Items].ItemUserName = 'FlagDelete';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'FlagExecute';
SelfDesc[SelfDesc.Items].ItemReference = Self.FlagExecute;
SelfDesc[SelfDesc.Items].ItemUserName = 'FlagExecute';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'FlagRead';
SelfDesc[SelfDesc.Items].ItemReference = Self.FlagRead;
SelfDesc[SelfDesc.Items].ItemUserName = 'FlagRead';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'FlagUpdate';
SelfDesc[SelfDesc.Items].ItemReference = Self.FlagUpdate;
SelfDesc[SelfDesc.Items].ItemUserName = 'FlagUpdate';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'IdApplicationBDDesc';
SelfDesc[SelfDesc.Items].ItemReference = Self.IdApplicationBDDesc;
SelfDesc[SelfDesc.Items].ItemUserName = 'IdApplicationBDDesc';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdApplicationBDDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LibAction';
SelfDesc[SelfDesc.Items].ItemReference = Self.LibAction;
SelfDesc[SelfDesc.Items].ItemUserName = 'LibAction';



end method;

------------------------------------------------------------
method ActionDesc.GetParam(input pCodeParam: Framework.integer): DataAccessSrvBD.ParamDesc
begin
--
--	Description :	Get the param
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeParam :	Code of the action's parameter
--					Return	--> Parameter found, NIL if not found
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionDesc.GetParam');

-- Declarations
aResult : ParamDesc;

-- Traitement
for aParam in Parametres do
	if aParam.Code.value = pCodeParam then
		aResult = aParam;
	end if;
end for;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionDesc.GetParam : End');

Return aResult;


end method;

------------------------------------------------------------
method ActionDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ActionDesc.IsAuthorisedFor(input pAuthorisation: Framework.integer): Framework.boolean
begin
--
--	Description :	Tests if the authorisation is in the action.
--					Values can be :
--					- ACT_STD_READ : for read
--					- ACT_STD_APPEND : for append
--					- ACT_STD_UPDATE : for update
--					- ACT_STD_DELETE : for delete
--					- ACT_STD_EXECUTE : ability to execute (if FALSE, no authorisation) 
--
--	Type :	Concret
--
--	Parametres :	Input	--> pAuthorisation :	Code action of the action
--					Return	--> TRUE = YES, FALSE = NO
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionDesc.IsAuthorisedFor');

-- Declarations
aResult : Boolean = FALSE;

-- Traitement
if (pAuthorisation = ACT_STD_READ and FlagRead and FlagExecute) or
 (pAuthorisation = ACT_STD_APPEND and FlagAppend and FlagExecute) or
 (pAuthorisation = ACT_STD_UPDATE and FlagUpdate and FlagExecute) or
 (pAuthorisation = ACT_STD_DELETE and FlagDelete and FlagExecute) or
 (pAuthorisation = ACT_STD_EXECUTE and FlagExecute) then
	aResult = TRUE;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionDesc.IsAuthorisedFor : End');

Return aResult;


end method;

------------------------------------------------------------
method ActionDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method AgentBD.Init
begin
super.Init();
end method;

------------------------------------------------------------
method AgentFrontCommSrv.AttachMO(input managedObject: Framework.Object)
begin
--
--	Description :	Cette méthode permet d'attacher l'agent au ManagedObject
--
--	Type :	Concret
--
--	Parametres : managedObject : La reference du manager rattaché à cet agent
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommSrv.AttachMO');

-- Declarations
uneException 			: ImplementationExc;
SystemInstrumentIndex	: integer;
unInst 					: CompoundInst;


-- Verification des pre-conditions
if (managedObject = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, le ManagedObject est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
super.AttachMO(managedObject);
SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

unInst = new();
unInst.Name.SetValue('Performances ');
unInst.Name.concat(managedObject.ClassName);
unInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommSrv.ADMINISTRATION_FRONTCOMM_INST);
Self.AddInstrument(inst = unInst);

unMinProcessingTimeInst : CounterInst = new();
unMinProcessingTimeInst.Name.SetValue('Minimum Processing Time');
unMinProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommSrv.MINPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unMinProcessingTimeInst);

unMaxProcessingTimeInst : CounterInst = new();
unMaxProcessingTimeInst.Name.SetValue('Maximum Processing Time');
unMaxProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommSrv.MAXPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unMaxProcessingTimeInst);

unAveProcessingTimeInst : CounterInst = new();
unAveProcessingTimeInst.Name.SetValue('Average Processing Time');
unAveProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommSrv.AVEPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unAveProcessingTimeInst);

unMethodCallsCountInst : CounterInst = new();
unMethodCallsCountInst.Name.SetValue('Method Calls Count');
unMethodCallsCountInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommSrv.METHODCALLS_FRONTCOMM_INST);
unInst.AddSubInstrument(unMethodCallsCountInst);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommSrv.AttachMO : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommSrv.AttachMO. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentFrontCommSrv.GetMOTypeName: Framework.string
begin
--
--	Description :	Cette méthode retourne le nom du ManagedObject
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommSrv.GetMOTypeName');

-- Declarations
unMOName				: String;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
unMOName = self.ManagedObject.ClassName;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommSrv.GetMOTypeName : End');
Return unMOName;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommSrv.GetMOTypeName. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentFrontCommSrv.Init
begin
super.Init();

-- La mehtode AttachMO utilise MOType pour verifier le type
-- du Managed Object
self.SetMOType(MOType=FrontCommSrvDesc);

Self.CommTimeWatch = new();

end method;

------------------------------------------------------------
method AgentFrontCommSrv.InitCmdProcessor
begin
--
--	Description :	Cette méthode permet de mettre en place de commande
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommSrv.InitCmdProcessor');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
super.InitCmdProcessor();

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;

	self.CommandProcessor.AddCommand(cmdName = 'InitialiserInstruments',
								 argDesc = '', 
								 cmdIndex = SystemCmdIndex + AgentManager.INITIALISERINST_CMD,
								 helpText = 'Syntax : InitialiserInstruments',
								 argNames = '',
								 groupName = 'Banque Directe',
								 menuString = 'Initialiser les instruments');
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommSrv.InitCmdProcessor : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommSrv.InitCmdProcessor. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentFrontCommSrv.ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object
begin
--
--	Description :	Cette méthode est appelée quand une commande est exécutéé
--
--	Type :	Concret
--
--	Parametres : cmdIndex.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommSrv.ProcessCmdRequest');

-- Declarations
unObjet					: object = NIL;
SystemInstrumentIndex	: Integer;


-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;
	case (cmdIndex - SystemCmdIndex) 
		when AgentManager.INITIALISERINST_CMD do
			if (Self.CommTimeWatch <> NIL) then
				Self.CommTimeWatch.MaxProcessingTime   = 0;
				Self.CommTimeWatch.MinProcessingTime   = 2147483647;
				Self.CommTimeWatch.AveProcessingTime   = 0;
				Self.CommTimeWatch.MethodCallsCount    = 0;
				Self.CommTimeWatch.TotalProcessingTime = 0;
			end if;
		
		else
			super.ProcessCmdRequest(cmdIndex, parameters, outStream);
	end case;
else
	super.ProcessCmdRequest(cmdIndex, parameters, outStream);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommSrv.ProcessCmdRequest : End');
Return unObjet;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontComm.ProcessCmdRequest. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentFrontCommSrv.UpdateInstrument(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode est appelée quand un instrument est appelé
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommSrv.UpdateInstrument');

-- Declarations
SystemInstrumentIndex	: integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentFrontComm.UpdateInstrument. Instrument = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, inst.Name);

SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

case (inst.InstrumentID - SystemInstrumentIndex) 
	when AgentFrontCommSrv.ADMINISTRATION_FRONTCOMM_INST do
		for unSousInst in (CompoundInst)(Inst).SubInstruments do
			(CounterInst(unSousInst)).ClearValue();
			case (unSousInst.InstrumentID - SystemInstrumentIndex)
				when AgentFrontCommSrv.MAXPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MaxProcessingTime));

				when AgentFrontCommSrv.MINPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MinProcessingTime));

				when AgentFrontCommSrv.AVEPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.AveProcessingTime));

				when AgentFrontCommSrv.METHODCALLS_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MethodCallsCount));
			end case;
		end for;

	else do
		super.UpdateInstrument(inst);
end case;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommSrv.UpdateInstrument : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommSrv.UpdateInstrument. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentManager.AttachMO(input managedObject: Framework.Object)
begin
--
--	Description :	Cette méthode permet d'attacher l'agent au ManagedObject
--
--	Type :	Concret
--
--	Parametres : managedObject : La reference du manager rattaché à cet agent
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.AttachMO');

-- Declarations
uneException 			: ImplementationExc;
SystemInstrumentIndex	: integer;

-- Verification des pre-conditions
if (managedObject = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, le ManagedObject est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
super.AttachMO(managedObject);
SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

--Administration Instrument
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '***********AgentManager.AttachMO. Manager = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, managedObject.ClassName);
EtatManagerInst : ConfigValueInst = new();
unName : TextData = new(Value = 'Etat ');
unName.Concat(managedObject.ClassName);
EtatManagerInst.Name.SetValue(unName);
tmp : TextData = new();
if ((ServiceMgrDesc)(managedObject).ServiceStarted = TRUE) then
	tmp.SetValue('ON');
else
	tmp.SetValue('OFF');
end if;
EtatManagerInst.UpdateData(data = tmp);
EtatManagerInst.InstrumentID = (SystemInstrumentIndex + ADMINISTRATION_MANAGER_INST);
Self.AddInstrument(EtatManagerInst);


--Dependances Instrument
DependancesInst : CompoundInst = new();
DependancesInst.Name.SetValue('Dependances ');
DependancesInst.Name.Concat(managedObject.ClassName);
DependancesInst.InstrumentID = (SystemInstrumentIndex + AgentManager.DEPENDANCES_MANAGER_INST);
Self.AddInstrument(DependancesInst);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '***********AgentManager.AttachMO. Dependances');
For uneDep in (ServiceMgrDesc)(managedObject).Dependances do
	unInst : ConfigValueInst = new();
	unEtat : TextData = new();
	if (uneDep.IsA(ServiceMgrDesc)) then
		if ((ServiceMgrDesc)(uneDep).ServiceStarted = TRUE) then
			unEtat.SetValue('ON');
		else
			unEtat.SetValue('OFF');
		end if;
	else
		unEtat.SetValue('ON');
	end if;
	unInst.Name.SetValue(uneDep.ClassName);
	unInst.UpdateData(unEtat);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentManager.AttachMO. ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, uneDep.ClassName);

	unInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
	Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;
	DependancesInst.AddSubInstrument(unInst);
end for;


--Services Instrument
ServicesInst : CompoundInst = new();
ServicesInst.Name.SetValue('Services ');
ServicesInst.Name.Concat(managedObject.ClassName);
ServicesInst.InstrumentID = (SystemInstrumentIndex + AgentManager.SERVICES_MANAGER_INST);
Self.AddInstrument(ServicesInst);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '***********AgentManager.AttachMO. Instances : ');
For uneInstance in (ServiceMgrDesc)(managedObject).Instances do
	unInst : ConfigValueInst = new();
	unEtat : TextData = new();
	if (uneInstance.IsA(ServiceDesc)) then
		if ((ServiceDesc)(uneInstance.aObject).ServiceStarted = TRUE) then
			unEtat.SetValue('ON');
		else
			unEtat.SetValue('OFF');
		end if;
	else
		unEtat.SetValue('ON');
	end if;

	unInst.Name.SetValue((ServiceDesc)(uneInstance.aObject).ClassName);
	unInst.UpdateData(unEtat);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentManager.AttachMO. ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, (ServiceDesc)(uneInstance.aObject).ClassName);
	
	unInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
	Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;
	ServicesInst.AddSubInstrument(unInst);
end for;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.AttachMO : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.AttachMO. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentManager.GetMOTypeName: Framework.string
begin
--
--	Description :	Cette méthode retourne le nom du ManagedObject
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.GetMOTypeName');

-- Declarations
unMOName				: String;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
unMOName = self.ManagedObject.ClassName;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.GetMOTypeName : End');
Return unMOName;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.GetMOTypeName. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentManager.Init
begin
super.Init();

-- La mehtode AttachMO utilise MOType pour verifier le type
-- du Managed Object
self.SetMOType(MOType=ServiceMgrDesc);

--Index utilisé pour les instruments
Self.LastIndexInst = new(Index = 10);
end method;

------------------------------------------------------------
method AgentManager.InitCmdProcessor
begin
--
--	Description :	Cette méthode permet de mettre en place de commande
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.InitCmdProcessor');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
super.InitCmdProcessor();

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;

	self.CommandProcessor.AddCommand(cmdName = 'StartServicesAgents',
								 argDesc = 'd', 
								 cmdIndex = SystemCmdIndex + STARTSERVICESAGENTS_CMD,
								 helpText = 'Syntax : StartServicesAgents',
								 argNames = 'Level',
								 groupName = 'Banque Directe',
								 menuString = 'Demarrer les agents des services');

	self.CommandProcessor.AddCommand(cmdName = 'StopServicesAgents',
								 argDesc = '', 
								 cmdIndex = SystemCmdIndex + STOPSERVICESAGENTS_CMD,
								 helpText = 'Syntax : StopServicesAgents',
								 argNames = '',
								 groupName = 'Banque Directe',
								 menuString = 'Arrêter les agents des services');

	self.CommandProcessor.AddCommand(cmdName = 'InitialiserInstruments',
								 argDesc = '', 
								 cmdIndex = SystemCmdIndex + AgentManager.INITIALISERINST_CMD,
								 helpText = 'Syntax : InitialiserInstruments',
								 argNames = '',
								 groupName = 'Banque Directe',
								 menuString = 'Initialiser les instruments');
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.InitCmdProcessor : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.InitCmdProcessor. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentManager.InstrumentUpdated(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode est appelée quand un instrument de type configValueInst a été modifié ou
--					un Tick d'un instrument TimerInst est reçue
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.InstrumentUpdated');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
super.InstrumentUpdated(inst);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.InstrumentUpdated : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.InstrumentUpdated. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentManager.ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object
begin
--
--	Description :	Cette méthode est appelée quand une commande est exécutéé
--
--	Type :	Concret
--
--	Parametres : cmdIndex.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.ProcessCmdRequest');

-- Declarations
unObjet					: object = NIL;
SystemInstrumentIndex	: Integer;


-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;
	case (cmdIndex - SystemCmdIndex) 
		when AgentManager.STARTSERVICESAGENTS_CMD do
			unEntier : Integer = (IntegerData)(parameters[1]).Value;
			if NOT Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = unEntier) then	
				unLogFlag : TextData = new();
				unLogFlag.ReplaceParameters('+(prf:user1:1:%1)',  (IntegerData)(parameters[1]));
				task.Part.LogMgr.ModifyFlags(unLogFlag.Value);
				(ServiceMgrDesc)(self.managedObject).StartServicesAgents(self);
			end if;
			
		when AgentManager.STOPSERVICESAGENTS_CMD do
			unLogFlag : TextData = new();
			unLogFlag.ReplaceParameters('-(prf:user1:1)');
			task.Part.LogMgr.ModifyFlags(unLogFlag.Value);
			task.Part.LogMgr.ModifyFlags('+(prf:user1:1:1)');
			
			For unSubAgent in self.SubAgents do
				if (unSubAgent.managedObject.IsA(ServiceDesc)) then
					(ServiceDesc)(unSubAgent.managedObject).ArrayTimeWatches = NIL;
					(ServiceDesc)(unSubAgent.managedObject).AgentSvc		 = NIL;
				end if;
				(AgentService)(unSubAgent).ArrayTimeWatches  = NIL;
				(AgentService)(unSubAgent).ArrayDialoguesMgr = NIL;
				Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- AgentManager.ProcessCmdRequest. Agent supprime est : ');
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unSubAgent.Name);
				self.DeleteSubAgent(unSubAgent);
			end for;
			self.ServicesAgentsStarted = FALSE;
			
		when AgentManager.INITIALISERINST_CMD do
			For unSubAgent in self.SubAgents do
				if (unSubAgent.managedObject.IsA(ServiceDesc)) then	
					For unTimeWatch in (AgentService)(unSubAgent).ArrayTimeWatches do
						if (unTimeWatch <> NIL) then
							unTimeWatch.MaxProcessingTime   = 0;
							unTimeWatch.MinProcessingTime   = 2147483647;
							unTimeWatch.AveProcessingTime   = 0;
							unTimeWatch.MethodCallsCount    = 0;
							unTimeWatch.TotalProcessingTime = 0;
						end if;
					end for;
				end if;
			end for;
		
		else
			super.ProcessCmdRequest(cmdIndex, parameters, outStream);
	end case;
else
	super.ProcessCmdRequest(cmdIndex, parameters, outStream);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.ProcessCmdRequest : End');
Return unObjet;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.ProcessCmdRequest. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentManager.UpdateInstrument(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode est appelée quand un instrument est appelé
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentManager.UpdateInstrument');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentManager.UpdateInstrument. Instrument = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, inst.Name);
super.UpdateInstrument(inst);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentManager.UpdateInstrument : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentManager.UpdateInstrument. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentService.AddDialogueInst(input pServiceMgrName: Framework.TextData,
	input pServiceName: Framework.TextData)
begin
--
--	Description :	Cette méthode permet d'ajouter les instruments un nouveau dialogue
--
--	Type :	Concret
--
--	Parametres : pServiceMgrName : le nom du manager avec lequel on dialogue
--				 pServiceName	 : le nom du service demandé
--
--	Pre-condition : pServiceMgrName <> NIL et pServiceName <> NIL
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.AddDialogueInst');

-- Declarations
SystemInstrumentIndex	: integer;
unInst 					: CompoundInst;
uneException 			: ImplementationExc;
isManagerFound			: Boolean = FALSE;
isServiceFound			: Boolean = FALSE;
theMgr					: DialogueManagerDesc;
theService				: DialogueServiceDesc;


-- Verification des pre-conditions
if (pServiceMgrName = NIL) OR (pServiceName = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, le nom est NIL';	
	raise uneException;
end if;
for unMgr in Self.ArrayDialoguesMgr do
	if (unMgr.NameManager.IsEqual(pServiceMgrName)) then
		isManagerFound = TRUE;
		theMgr = unMgr;
		for unService in unMgr.ArrayServices do
			If (unService.NameService.IsEqual(pServiceName)) then
				isServiceFound = TRUE;
				theService = unService;
				exit;
			end if;
		end for;
		exit;
	end if;
end for;
-- Fin de verification des pre-conditions

-- Traitement
SystemInstrumentIndex 	= SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

if (isManagerFound) then
	if (isServiceFound) then
		theService.CounterService = theService.CounterService + 1;
	else
		unService : DialogueServiceDesc = new();
		unService.CounterService = 1;
		unService.NameService    = pServiceName;
		theMgr.ArrayServices.AppendRow(unService);
		theInst : CompoundInst;

		unServiceInst : CounterInst = new();
		unServiceInst.Name.SetValue(pServiceName);
		unServiceInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
		for unSubInst in Self.DialoguesInst.ActiveObjects do
			if (unSubInst.Name.IsEqual(pServiceMgrName)) then
				theInst = (CompoundInst)(unSubInst);
				exit;
			end if;
		end for; 
		theInst.AddSubInstrument(unServiceInst);
		Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;	
	end if;
else
	unInst = new();
	unInst.Name.SetValue(pServiceMgrName);
	unInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
	Self.DialoguesInst.AddActiveObject(ObjInst = unInst);
	Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;

	unServiceInst : CounterInst = new();
	unServiceInst.Name.SetValue(pServiceName);
	unServiceInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
	unInst.AddSubInstrument(unServiceInst);
	Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;

	unMgr : DialogueManagerDesc = new;
	unMgr.NameManager = pServiceMgrName;

	unService : DialogueServiceDesc = new();
	unService.CounterService = 1;
	unService.NameService    = pServiceName;
	unMgr.ArrayServices.AppendRow(unService);
	Self.ArrayDialoguesMgr.AppendRow(unMgr);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.AddDialogueInst : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.AddDialogueInst. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
end method;

------------------------------------------------------------
method AgentService.AddPerformanceInst(input pTimeWatch: DataAccessSrvBD.TimeWatch,
	input pNomAction: Framework.TextData)
begin
--
--	Description :	Cette méthode permet d'ajouter les performances d'une action
--
--	Type :	Concret
--
--	Parametres : pTimeWatch  : La reference de l'objet TimeWatch qui concerne l'action
--				 pNomAction  : Le nom de l'action
--
--	Pre-condition : pTimeWatch <> NIL
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.AddPerformanceInst');

-- Declarations
SystemInstrumentIndex	: integer;
unInst 					: CompoundInst;
uneException 			: ImplementationExc;

-- Verification des pre-conditions
if (pTimeWatch = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, la refernce TimeWatch est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Traitement
SystemInstrumentIndex 	= SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

unInst = new();
unInst.Name.SetValue(pNomAction);
unInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
Self.PerformancesInst.AddActiveObject(ObjInst = unInst);
Self.ArrayTimeWatches[Self.LastIndexInst.Index]	= pTimeWatch;
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;


unMinProcessingTimeInst : CounterInst = new();
unMinProcessingTimeInst.Name.SetValue('Minimum Processing Time');
unMinProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
unInst.AddSubInstrument(unMinProcessingTimeInst);
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;

unMaxProcessingTimeInst : CounterInst = new();
unMaxProcessingTimeInst.Name.SetValue('Maximum Processing Time');
unMaxProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
unInst.AddSubInstrument(unMaxProcessingTimeInst);
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;

unAveProcessingTimeInst : CounterInst = new();
unAveProcessingTimeInst.Name.SetValue('Average Processing Time');
unAveProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
unInst.AddSubInstrument(unAveProcessingTimeInst);
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;


unMethodCallsCountInst : CounterInst = new();
unMethodCallsCountInst.Name.SetValue('Method Calls Count');
unMethodCallsCountInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
unInst.AddSubInstrument(unMethodCallsCountInst);
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.AddPerformanceInst : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.AddPerformanceInst. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
end method;

------------------------------------------------------------
method AgentService.AttachMO(input managedObject: Framework.Object)
begin
--
--	Description :	Cette méthode permet d'attacher l'agent au ManagedObject
--
--	Type :	Concret
--
--	Parametres : managedObject : La reference du service rattaché à cet agent
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.AttachMO');

-- Declarations
uneException 			: ImplementationExc;
SystemInstrumentIndex	: integer;

-- Verification des pre-conditions
if (managedObject = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, le ManagedObject est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
super.AttachMO(managedObject);
SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

--Performances Instrument
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) then
	Self.PerformancesInst = new();
	Self.PerformancesInst.Name.SetValue('Performances ');
	Self.PerformancesInst.Name.concat(managedObject.ClassName);
	Self.PerformancesInst.InstrumentID = (SystemInstrumentIndex + AgentService.PERFORMANCES_SERVICE_INST);
	Self.AddInstrument(inst = Self.PerformancesInst);
End if;


--Administration Instrument
Self.AdminInst = new();
Self.AdminInst.Name.SetValue('Administration ');
Self.AdminInst.Name.concat(managedObject.ClassName);
Self.AdminInst.InstrumentID = (SystemInstrumentIndex + AgentService.ADMINISTRATION_SERVICE_INST);
Self.AddInstrument(inst = Self.AdminInst);

EtatServiceInst : ConfigValueInst = new();
unNomService : TextData = new(value = 'Etat ');
unNomService.Concat(managedObject.ClassName);
EtatServiceInst.Name.SetValue(unNomService);
unEtat : TextData = new();
if (managedObject.IsA(ServiceDesc)) then
	if ((ServiceDesc)(managedObject).ServiceStarted = TRUE) then
		unEtat.SetValue('ON');
	else
		unEtat.SetValue('OFF');
	end if;
else
	unEtat.SetValue('ON');
end if;
EtatServiceInst.UpdateData(data = unEtat);
EtatServiceInst.InstrumentID = (SystemInstrumentIndex + Self.LastIndexInst.Index);
Self.AdminInst.AddSubInstrument(subinst = EtatServiceInst);
Self.LastIndexInst.Index = Self.LastIndexInst.Index + 1;

--Dialogues Instrument
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 4) then
	Self.DialoguesInst = new();
	Self.DialoguesInst.Name.SetValue('Dialogues ');
	Self.DialoguesInst.Name.concat(managedObject.ClassName);
	Self.DialoguesInst.InstrumentID = (SystemInstrumentIndex + AgentService.DIALOGUES_SERVICE_INST);
	Self.AddInstrument(inst = Self.DialoguesInst);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.AttachMO : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.AttachMO. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, unMessage);
end method;

------------------------------------------------------------
method AgentService.GetMOTypeName: Framework.string
begin
--
--	Description :	Cette méthode retourne le nom du ManagedObject
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.GetMOTypeName');

-- Declarations
unMOName				: String;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
unMOName = self.ManagedObject.ClassName;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.GetMOTypeName : End');
Return unMOName;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.GetMOTypeName. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentService.Init
begin
super.Init();

-- La mehtode AttachMO utilise MOType pour verifier le type
-- du Managed Object
self.SetMOType(MOType=ServiceDesc);
Self.ArrayTimeWatches = new();
Self.ArrayDialoguesMgr = new();

--Index utilisé pour les instruments
Self.LastIndexInst = new(Index = 10);

end method;

------------------------------------------------------------
method AgentService.InitCmdProcessor
begin
--
--	Description :	Cette méthode est appelée pour mettre en place des commandes pour l'agent
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.InitCmdProcessor');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
super.InitCmdProcessor();
SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.InitCmdProcessor : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.InitCmdProcessor. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
end method;

------------------------------------------------------------
method AgentService.InstrumentUpdated(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode est appelée quand un instrument de type configValueInst a été modifié ou
--					un Tick d'un instrument TimerInst est reçue
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.InstrumentUpdated');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.InstrumentUpdated. Instrument = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, inst.Name);

-- Debut du traitement
if (inst.IsA(TimerInst)) then
	Self.UpdateInstrument(Self.PerformancesInst);
else
	super.InstrumentUpdated(inst);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.InstrumentUpdated : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.InstrumentUpdated. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
end method;

------------------------------------------------------------
method AgentService.ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object
begin
--
--	Description :	Cette méthode est appelée quand un instrument est appelé
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.ProcessCmdRequest');

-- Declarations
unObjet		: object = NIL;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.ProcessCmdRequest. Commande pour ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, Self.Name);
super.ProcessCmdRequest(cmdIndex, parameters, outStream);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.ProcessCmdRequest : End');
Return unObjet;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.ProcessCmdRequest. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentService.UpdateInstrument(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode recupere les informations du managedObject et modifie l'instrument specifié.
--
--	Type :	Concret
--
--	Parametres : inst : instrument spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentService.UpdateInstrument');

-- Declarations
SystemInstrumentIndex	: integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.UpdateInstrument. Instrument = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, inst.Name);


case (inst.InstrumentID - SystemInstrumentIndex) 
	when AgentService.ADMINISTRATION_SERVICE_INST do
		if (Self.managedObject.IsA(ServiceDesc)) then
			for unSousInst in (CompoundInst)(inst).SubInstruments do
				Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.UpdateInstrument. Instrument = ');
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unSousInst.Name);
				unNom : TextData = unSousInst.Name.Clone(deep=TRUE);
				unEtat : TextData = new(value='OFF');
				IsFound : Boolean = unNom.MoveToString('Etat', TRUE, TRUE);
				if (IsFound) then
					if ((ServiceDesc)(Self.managedObject).ServiceStarted = TRUE) then
						unEtat.SetValue('ON');
						Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.UpdateInstrument. Etat = ');
						Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unEtat);
					else
						unEtat.SetValue('OFF');
						Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentService.UpdateInstrument. Etat = ');
						Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unEtat);
					end if;
					(ConfigValueInst)(unSousInst).UpdateData(data = unEtat);
				end if;
			end for;
		end if;



	when AgentService.DIALOGUES_SERVICE_INST do
		for unInst in (subObjectInst)(inst).ActiveObjects do
			for unSousInst in (CompoundInst)(unInst).SubInstruments do
				(CounterInst(unSousInst)).ClearValue();
				for unMgr in Self.ArrayDialoguesMgr do
					if (unMgr.NameManager.IsEqual(unInst.Name)) then
						for unService in unMgr.ArrayServices do
							If (unService.NameService.IsEqual(unSousInst.Name)) then
								(CounterInst(unSousInst)).Increment(amount=unService.CounterService);
								exit;
							end if;
						end for;
						exit;
					end if;
				end for;				
			end for;
		end for;



	when AgentService.PERFORMANCES_SERVICE_INST do
		for unInst in (subObjectInst)(inst).ActiveObjects do
			unIndex : Integer = unInst.InstrumentID - SystemInstrumentIndex;
			for unSousInst in (CompoundInst)(unInst).SubInstruments do
				(CounterInst(unSousInst)).ClearValue();
				if (unSousInst.Name.IsEqual('Maximum Processing Time')) then
					(CounterInst(unSousInst)).Increment(amount=(Self.ArrayTimeWatches[unIndex].MaxProcessingTime));		
				elseif (unSousInst.Name.IsEqual('Minimum Processing Time')) then
					(CounterInst(unSousInst)).Increment(amount=(Self.ArrayTimeWatches[unIndex].MinProcessingTime));
				elseif (unSousInst.Name.IsEqual('Average Processing Time')) then
					(CounterInst(unSousInst)).Increment(amount=(Self.ArrayTimeWatches[unIndex].AveProcessingTime));
				elseif (unSousInst.Name.IsEqual('Method Calls Count')) then
					(CounterInst(unSousInst)).Increment(amount=(Self.ArrayTimeWatches[unIndex].MethodCallsCount));
				end if;			
			end for;
		end for;
					
	else do
		super.UpdateInstrument(inst);
end case;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentService.UpdateInstrument : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentService.UpdateInstrument. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
end method;

------------------------------------------------------------
method ApplicationBDDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	27/06/1997	|	Creation.
--+

Self.Code 			= new();
Self.LibApplication	= new();
Self.Description 	= new();
Self.Actions 		= new();
Self.Profils 		= new();


end method;

------------------------------------------------------------
method ApplicationBDDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Code';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Code;
SelfDesc[SelfDesc.Items].ItemUserName 	= 'Code';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'LibApplication';
SelfDesc[SelfDesc.Items].ItemReference	= Self.LibApplication;
SelfDesc[SelfDesc.Items].ItemUserName	= 'LibApplication';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Description';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Description';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Actions';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Actions;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Actions';
SelfDesc[SelfDesc.Items].LinkActive		= TRUE;

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Profils';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Profils;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Profils';
SelfDesc[SelfDesc.Items].LinkActive		= TRUE;


end method;

------------------------------------------------------------
method ApplicationBDDesc.DoResetSelfDescUpdate
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Code';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Code;
SelfDesc[SelfDesc.Items].ItemUserName 	= 'Code';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'LibApplication';
SelfDesc[SelfDesc.Items].ItemReference	= Self.LibApplication;
SelfDesc[SelfDesc.Items].ItemUserName	= 'LibApplication';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Description';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Description';

--SelfDesc.AppendRow();
--SelfDesc[SelfDesc.Items].ItemName		= 'Actions';
--SelfDesc[SelfDesc.Items].ItemReference	= Self.Actions;
--SelfDesc[SelfDesc.Items].ItemUserName	= 'Actions';

--SelfDesc.AppendRow();
--SelfDesc[SelfDesc.Items].ItemName		= 'Profils';
--SelfDesc[SelfDesc.Items].ItemReference	= Self.Profils;
--SelfDesc[SelfDesc.Items].ItemUserName	= 'Profils';


end method;

------------------------------------------------------------
method ApplicationBDDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ApplicationBDSqlDesc.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method AutorisationDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method BusinessServiceDesc.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Input		--> aTransdata :	Communication structure.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/06/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Action');

-- Declarations

aResult 	: Object;
aStopWatch 	: StopWatch;
aTimesplit 	: Integer;

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreAction();
End if;
-- Fin de verification des pre-conditions

-- Traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aStopWatch = new();
	Self.AddTimeWatch(aTransData.TransActionService);
	aStopWatch.Fire();
end if;

	Case aTransData.TransActionService is
		when ACT_STD_APPEND do
			aResult=Append(aTransData, aTransOrigin);
			aTransData.TransActionService = ACT_STD_APPEND;
			aTransData.TransObject = aResult;
			if Self.NtfAppend then
				Self.Notify(aTransData, aTransOrigin);
			end if;
		
		when ACT_STD_UPDATE do
			aResult=Update(aTransData, aTransOrigin);
			aTransData.TransActionService = ACT_STD_UPDATE;		
			aTransData.TransObject = aResult;
			if Self.NtfUpdate then
				Self.Notify(aTransData, aTransOrigin);
			end if;
				
		when ACT_STD_DELETE do
			Delete(aTransData, aTransOrigin);
			aTransData.TransActionService = ACT_STD_DELETE;		
			if Self.NtfDelete then
				Self.Notify(aTransData, aTransOrigin);
			end if;
			aTransData.TransObject = aResult;
		
		when ACT_STD_READ do
			aResult = Read(aTransData);
			aTransData.TransActionService = ACT_STD_READ;
		
		When ACT_NTF_REGISTEREVENT do
			Self.RegisterEvent(aTransOrigin);
			if not FlagDynamic then
				-- Composition
				For unItem in Self.BusinessClass.SelfDesc do
					if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
						TmpSelf : ObjectSelfDesc = (ObjectSelfDesc)(unItem.ItemReference);
						if TmpSelf.ServiceMgr <> NIL and TmpSelf.unService <> NIL then
							start task Self.Transfer(aTransData, TmpSelf.ServiceMgr,TmpSelf.unService, aTransOrigin);
						end if;
					end if;
				End for;
			end if;
			
		When ACT_NTF_DEREGISTEREVENT do
			Self.DeRegisterEvent(aTransOrigin);
			if not FlagDynamic then
				-- Composition
				For unItem in Self.BusinessClass.SelfDesc do
					if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
						TmpSelf : ObjectSelfDesc = (ObjectSelfDesc)(unItem.ItemReference);
						if TmpSelf.ServiceMgr <> NIL and TmpSelf.unService <> NIL then
							start task Self.Transfer(aTransData, TmpSelf.ServiceMgr,TmpSelf.unService, aTransOrigin);
						end if;
					end if;
				End for;
			end if;
					
		else do // Other cases
			aResult = DoAction(aTransData, aTransOrigin);
	end case;
	
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTransData.TransActionService, aTimeSplit);
end if;
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Action : End');

Return aResult;

Exception
	When e : GenericException do
		if (aStopWatch <> NIL) then
			aStopWatch.Split();
		end if;	
		Self.TraceExc(e, 'BusinessServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.Append(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to append 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	03/07/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Mise aux normes
--	D. NGUYEN	|	14/04/1998	|	Ajout des transactions
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Append');
unResult : Object;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;
if Self.TrsAppend then
	Begin Transaction
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
			CheckPreAppend(pTransData);
		end if;
		DoBeforeAppend(pTransData);
		unResult = AppendAction(pTransData, pTransOrigin, TRUE, pBusinessClass);
		DoAfterAppend(pTransData,unResult);	
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
			CheckPostAppend();
		end if;
	End Transaction;
else
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
		CheckPreAppend(pTransData);
	end if;
	DoBeforeAppend(pTransData);
	unResult = AppendAction(pTransData, pTransOrigin, FALSE, pBusinessClass);
	DoAfterAppend(pTransData,unResult);	
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
		CheckPostAppend();
	end if;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Append : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.Append');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.AppendAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to append 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Append
--
--	Historique :
--
--	D. NGUYEN	|	22/05/1997	|	Creation.
--	D. NGUYEN	|	06/03/1998	|	Ajout du test unResult <> NIL.
--	D. NGUYEN	|	14/04/1998	|	Ajout des trsanctions.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.AppendAction');
unResult : CacheDesc;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement automatique
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	CheckPreAppendAction(pTransData);
end if;
if pBusinessClass.ServiceMgr = NIL or pBusinessClass.unService = NIL then
	pBusinessClass.DoResetService();
end if;
-- Traitement du Record courant
unResult = (CacheDesc)(Self.Transfer(pTransData, pBusinessClass.ServiceMgr, pBusinessClass.unService));

-- Composition
if unResult <> NIL then
	Self.DoBeforeAppendActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
	Self.AppendUpdateComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
	Self.DoAfterAppendActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
end if;
-- Fin de composition
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.AppendAction(automatique) : End');

Return unResult;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.AppendAction');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.AppendUpdateComposant(input pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.AppendUpdateComposant');
-- Tâche pour chaque BusinessClass composante
TaskCount : integer = pBusinessClasses.Items;
i : integer;
if TaskCount > 0 then
	TmpDeleteCount : integer;
	Event Loop

		Postregister
			For aInst in pBusinessClasses do
				i = i + 1;
				TmpTrans : TransDesc = pTransData.Clone(Deep=TRUE);
				TmpCache : CacheDesc = new(IdUtl = pTransData.IdUtl, Record=aInst);
				TmpTrans.TransObject = TmpCache;
				if pTransactional then
					Start task Self.AppendUpdateElt(i, TmpTrans, pServiceMgr,pService, pTransOrigin, pTransactional) where completion = Event, transaction = dependent;
				else
					Start task Self.AppendUpdateElt(i, TmpTrans, pServiceMgr,pService, pTransOrigin, pTransactional) where completion = Event;
				end if;
			end for;

		
		When Self.AppendUpdateEltDone(RetElt) do
			TaskCount = TaskCount - 1;
			-- Recomposition
			if RetElt.Object <> NIL then
				(cacheDesc)(RetElt.Object).Record.SelfDesc = new();
				(cacheDesc)(RetElt.Object).Record.DoResetSelfDesc();
				pBusinessClasses.ReplaceRow(RetElt.Count,(cacheDesc)(RetElt.Object).Record);
			else
				pBusinessClasses.ReplaceRow(RetElt.Count, NIL);
			end if;
			if TaskCount = 0 then
				exit;
			end if;
			
		When Self.AppendUpdateEltExc(RetExc) do
			TaskCount = TaskCount - 1;
			Raise RetExc;

	End Event;

	i : integer = 1;
	While i <= pBusinessClasses.Items do
		if pBusinessClasses[i] = NIL then
			pBusinessClasses.DeleteRow(i);
		else
			i = i + 1;
		end if;
	End While;

end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.AppendUpdateComposant : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.AppendUpdateComposant');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.AppendUpdateComposant(input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.AppendUpdateComposant');
-- Tâche pour chaque BusinessClass composante
RetElt : ParallelEltReturnDesc;
TmpTrans : TransDesc = pTransData.Clone(Deep=TRUE);
TmpCache : CacheDesc = new(IdUtl = pTransData.IdUtl, Record=pBusinessClass);
TmpTrans.TransObject = TmpCache;

RetElt = Self.AppendUpdateElt(1, TmpTrans, pServiceMgr,pService, pTransOrigin, pTransactional);
if RetElt.Object <> NIL then
	TmpResult : ObjectSelfDesc;
	TmpResult = (CacheDesc)(RetElt.Object).Record;
--	pBusinessClass = TmpResult;
	Self.BusinessClassMaj(pBusinessClass,TmpResult); 
--	Task.Part.LogMgr.Put('AppendUpdateComposant pBusinessClass: ');
--	Task.Part.LogMgr.PutLine(pBusinessClass.DtMajQqo.TextValue.Value); -- DN 041197
--	Task.Part.LogMgr.Put('AppendUpdateComposant TmpResult: ');
--	Task.Part.LogMgr.PutLine(TmpResult.DtMajQqo.TextValue.Value); -- DN 041197
else
	pBusinessClass = NIL;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.AppendUpdateComposant : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.AppendUpdateComposant');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.AppendUpdateComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input output unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.AppendUpdateComposition');

ComposantPointeur : integer;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement des composants
if pBusinessClass.SelfDesc = NIL then
	pBusinessClass.SelfDesc = new();
	pBusinessClass.DoResetAttributes();
end if;
if pBusinessClass.SelfDesc.Items = 0 then
	pBusinessClass.DoResetSelfDesc();
end if;

RootData : ObjectSelfDesc = (CacheDesc)(pTransData.TransObject).Record;
if RootData.SelfDesc = NIL then
	RootData.SelfDesc = new();
end if;
if RootData.SelfDesc.Items = 0 then
	RootData.DoResetSelfDesc();
end if;


TmpResult : ObjectSelfDesc = unResult.Record;
if TmpResult.SelfDesc = NIL then
	TmpResult.SelfDesc = new;
end if;
if TmpResult.SelfDesc.Items = 0 then
	TmpResult.DoResetSelfDesc();
end if;

-- Préparation

ParallelServices : Array of ParallelServiceDesc = new();
TmpBC : ObjectSelfDesc;
TmpPrlService : ParallelServiceDesc;

For aItem in pBusinessClass.SelfDesc do
	ComposantPointeur = ComposantPointeur + 1;
	-- Test de la composition
	FlagComposition : Boolean = FALSE;
	if aItem.ItemReference.Isa(Type=ObjectSelfDesc) and aItem.LinkActive and 
	((aItem.LinkAppend and pTransData.TransActionService = ACT_STD_APPEND) 
	or (aItem.LinkUpdate and pTransData.TransActionService = ACT_STD_UPDATE) 
	or (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) 
	or (aItem.LinkRead and pTransData.TransActionService = ACT_STD_READ) 
	or (pTransData.TransActionService <> ACT_STD_APPEND and 
	pTransData.TransActionService <> ACT_STD_UPDATE and
	pTransData.TransActionService <> ACT_STD_DELETE and
	pTransData.TransActionService <> ACT_STD_READ)) then
-- DN->DA 15/04/98	if aItem.ItemReference.Isa(Type=ObjectSelfDesc) and aItem.LinkActive then
		-- Recherche du ParentItemName dans le courant
		TmpBC = (ObjectSelfDesc)(aItem.ItemReference);
		TmpBC.DoResetAttributes();
		-- le BusinessClass de l'élément est instancié
		if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
			TmpBC.DoResetService();
		end if;
		if TmpBC.SelfDesc = NIL then
			TmpBC.SelfDesc = new();
		end if;
		if TmpBC.SelfDesc.Items = 0 then
			TmpBC.DoResetSelfDesc();
		end if;
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.ReadComposition : Service=');
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
		
		TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
		TmpPrlService.BusinessClass = (ObjectSelfDesc)(TmpResult.SelfDesc[ComposantPointeur].ItemReference);
		FlagComposition = TRUE;
	elseif aItem.ItemReference.Isa(Type=GenericArray) then
		TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
		if TmpArray = NIL then
			aItem.ItemReference = new();
			TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
		end if;
		TmpObject : Object = TmpArray.DefaultClass.InstanceAlloc();
		if TmpObject.Isa(Type=ObjectSelfDesc) and aItem.LinkActive and 
		((aItem.LinkAppend and pTransData.TransActionService = ACT_STD_APPEND) 
		or (aItem.LinkUpdate and pTransData.TransActionService = ACT_STD_UPDATE) 
		or (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) 
		or (aItem.LinkRead and pTransData.TransActionService = ACT_STD_READ)
		or (pTransData.TransActionService <> ACT_STD_APPEND and 
		pTransData.TransActionService <> ACT_STD_UPDATE and
		pTransData.TransActionService <> ACT_STD_DELETE and
		pTransData.TransActionService <> ACT_STD_READ)) then
-- DN->DA 15/04/98		if TmpObject.Isa(Type=ObjectSelfDesc) and aItem.LinkActive then
			-- Recherche du ParentItemName dans le courant
			-- Instanciation du BusinessClass de l'élément
			if TmpArray.Items = 0 then
				TmpBC = (ObjectSelfDesc)(TmpArray.DefaultClass.InstanceAlloc());
				TmpBC.DoResetAttributes();
				TmpArray.AppendRow(TmpBC);
			else
				TmpBC = (ObjectSelfDesc)(TmpArray.FindObjectForRow(1));
			end if;
			-- le BusinessClass de l'élément est instancié
			if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
				TmpBC.DoResetService();
			end if;
			if TmpBC.SelfDesc = NIL then
				TmpBC.SelfDesc = new();
			end if;
			if TmpBC.SelfDesc.Items = 0 then
				TmpBC.DoResetSelfDesc();
			end if;

			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.AppendUpdateComposition : Service=');
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
			TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
			FlagComposition = TRUE;
		end if; -- TmpObject.Isa(Type=ObjectSelfDesc)
	end if; -- aItem.ItemReference.Isa(Type=GenericArray)
	
	-- Dans le cadre du parcours de pBusinessClass,
	-- S'il y a composition, alors :
	if FlagComposition then
		-- Désencapsulation des données transmises en entrée
		
		-- Recherche de l'élément à traiter
		aDataItem : StructureDesc = RootData.SelfDesc[ComposantPointeur];
/* -- OPTIMISATION 03/03/98
		For aDataItem in RootData.SelfDesc do
			if aDataItem.ItemName = aItem.ItemName then
*/
				if aDataItem.ItemReference.IsA(Type=ObjectSelfDesc) then
					TmpPrlService.BusinessClass = (ObjectSelfDesc)(aDataItem.ItemReference);
					TmpPrlService.BusinessClass.SelfDesc = new();
					TmpPrlService.BusinessClass.DoResetSelfDesc();
					-- Mise à jour des champs de liens avec le parent
					i : integer;
					-- Recherche des champs de lien
					Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.AppendUpdateComposition : TmpBC.SelfDesc.Items=');
					Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.SelfDesc.Items);
					-- Lien stocké sur le père avec ItemName = Link+ nom de l'attribut d'instance
					-- Recherche d'attribut de lien
					FlagLinkAtt : Boolean = FALSE;
					TmpLinkName : TextData = new(value='Link');
					TmpLinkName.concat(aDataItem.ItemName);
					i = 0;
					For aLinkAtt in RootData.SelfDesc do
						i = i + 1;
						if TmpLinkName.IsEqual(aLinkAtt.ItemName) and aLinkAtt <> NIL then
							TmpPrlService.LinkAttCount = i;
							FlagLinkAtt = TRUE;
							exit;
						end if;
					End for;
					i = 0;
					if not FlagLinkAtt then
						-- Lien stocké sur le fils
						For TmpBCItem in TmpBC.SelfDesc do
							i = i + 1;
							if TmpBCItem.ItemName = TmpPrlService.BusinessClass.SelfDesc[i].ItemName and TmpPrlService.BusinessClass.SelfDesc[i].ParentItemName <> '' then
								-- Mot clé Id+Nom de la classe container
								TmpTxt : TextData = new(value='Id');
								TmpTxt.Concat(RootData.ClassName);
								if TmpTxt.IsEqual(TmpPrlService.BusinessClass.SelfDesc[i].ParentItemName,TRUE) then
									TmpId : IntegerData = new(value=TmpResult.Id);
									(IntegerData)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference).setValue(TmpId);
								else
									-- Recherche du parent à affecter
									For aParent in TmpResult.SelfDesc do
										if aParent.ItemName = TmpBCItem.ParentItemName then
											TmpPrlService.BusinessClass.SelfDesc[i].ItemName = aParent.ItemName;
											if aParent.ItemReference.IsA(Type=DataValue) then
												(DataValue)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference).setValue((DataValue)(aParent.ItemReference));
											elseif aParent.ItemReference.IsA(Type=ObjectSelfDesc) then
												TmpRecord : ObjectSelfDesc = (ObjectSelfDesc)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference);
												Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(aParent.ItemReference));
											end if;
											exit;
										end if;
									End for;
								end if;
							end if;
						end for;
					end if;
					-- Les champs de lien sont à jour
					TmpPrlService.BusinessClass.SelfDesc = NIL;
				else -- aDataItem.ItemReference.IsA(Type=ObjectSelfDesc)
					TmpPrlService.BusinessClasses = (Array of ObjectSelfDesc)(aDataItem.ItemReference);
					For aInst in TmpPrlService.BusinessClasses do
						aInst.SelfDesc = new();
						aInst.DoResetSelfDesc();
						-- Mise à jour des champs de liens avec le parent
						i : integer;
						-- Recherche des champs de lien
						Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.AppendUpdateComposition : TmpBC.SelfDesc.Items=');
						Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.SelfDesc.Items);
						-- Lien stocké obligatoirement sur le fils
						For TmpBCItem in TmpBC.SelfDesc do
							i = i + 1;
							if TmpBCItem.ItemName = aInst.SelfDesc[i].ItemName and aInst.SelfDesc[i].ParentItemName <> '' then
								-- Mot clé Id+Nom de la classe container
								TmpTxt : TextData = new(value='Id');
								TmpTxt.Concat(RootData.ClassName);
								if TmpTxt.IsEqual(aInst.SelfDesc[i].ParentItemName,TRUE) then
									TmpId : IntegerData = new(value=TmpResult.Id);
									(IntegerData)(aInst.SelfDesc[i].ItemReference).setValue(TmpId);
								else
									-- Recherche du parent à affecter
									For aParent in TmpResult.SelfDesc do
										if aParent.ItemName = TmpBCItem.ParentItemName then
											aInst.SelfDesc[i].ItemName = aParent.ItemName;
											if aParent.ItemReference.IsA(Type=DataValue) then
												(DataValue)(aInst.SelfDesc[i].ItemReference).setValue((DataValue)(aParent.ItemReference));
											elseif aParent.ItemReference.IsA(Type=ObjectSelfDesc) then
												TmpRecord : ObjectSelfDesc = (ObjectSelfDesc)(aInst.SelfDesc[i].ItemReference);
												Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(aParent.ItemReference));
											end if;
											exit;
										end if;
									End for;
								end if;
							end if;
						End for;
						-- Les champs de lien sont à jour
						aInst.SelfDesc = NIL;
					end for;
				end if; -- aDataItem.ItemReference.IsA(Type=ObjectSelfDesc)
/* -- OPTIMISATION 03/03/98
				exit;
			end if; -- aDataItem.ItemName = aItem.ItemName
		end for; -- aDataItem
*/		
		ParallelServices.AppendRow(TmpPrlService);
		
	end if; -- FlagComposition
End for; -- aItem
-- Fin Préparation


if ParallelServices.Items > 0 then
	-- Event Loop : Passe 2 : parallèlisation
	TaskCount : integer = ParallelServices.Items;
	Event Loop
		Postregister
			For aServ in ParallelServices do
				if aServ.BusinessClass = NIL then
					if pTransactional then
						Start task Self.AppendUpdateComposant(aServ.BusinessClasses, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin, pTransactional) where completion = Event, transaction = dependent;
					else
						Start task Self.AppendUpdateComposant(aServ.BusinessClasses, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin, pTransactional) where completion = Event;
					end if;
				else
					if pTransactional then
						Start task Self.AppendUpdateComposant(aServ.BusinessClass, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin, pTransactional) where completion = Event, transaction = dependent;
					else
						Start task Self.AppendUpdateComposant(aServ.BusinessClass, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin, pTransactional) where completion = Event;
					end if;
				end if;
			end for;
		
		When Self.AppendUpdateComposantArrayDone do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.AppendUpdateComposantArrayExc(aExc) do
			TaskCount = TaskCount - 1;
			Raise aExc;
		When Self.AppendUpdateComposantDone do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.AppendUpdateComposantExc(aExc) do
			TaskCount = TaskCount - 1;
			Raise aExc;
	End Event;
	-- Fin Event Loop
end if;

For aServ in ParallelServices do
	if TmpResult.SelfDesc[aServ.ComposantCount].ItemReference.IsA(Type=ObjectSelfDesc) then
--		TmpResult.SelfDesc[aServ.ComposantCount].ItemReference = aServ.BusinessClass;
		TmpBClass : ObjectSelfDesc = (ObjectSelfDesc)(TmpResult.SelfDesc[aServ.ComposantCount].ItemReference);
		Self.BusinessClassMaj(TmpBClass,aServ.BusinessClass);
--		Task.Part.LogMgr.Put('AppendUpdateComposition aServ.BusinessClass: ');
--		Task.Part.LogMgr.PutLine(aServ.BusinessClass.DtMajQqo.TextValue.Value);
--		Task.Part.LogMgr.Put('AppendUpdateComposition TmpResult.SelfDesc[aServ.ComposantCount].ItemReference: ');
--		Task.Part.LogMgr.PutLine((ObjectSelfDesc)(TmpResult.SelfDesc[aServ.ComposantCount].ItemReference).DtMajQqo.TextValue.Value);
		if aServ.LinkAttCount > 0 then
			(IntegerNullable)(TmpResult.SelfDesc[aServ.LinkAttCount].ItemReference).setValue(aServ.BusinessClass.Id);
		end if;
	else
--		TmpResult.SelfDesc[aServ.ComposantCount].ItemReference = aServ.BusinessClasses;
		TmpGenArray : GenericArray of ObjectSelfDesc = (GenericArray of ObjectSelfDesc)(TmpResult.SelfDesc[aServ.ComposantCount].ItemReference);
		TmpGenArray.Clear();
		For aItem in aServ.BusinessClasses do
			TmpGenArray.AppendRow(aItem);
		End for;
	end if;
end For;

TmpResult.SelfDesc = NIL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.AppendUpdateComposition : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.AppendUpdateComposition');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.AppendUpdateElt(input pCount: Framework.integer,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE): DataAccessSrvBD.ParallelEltReturnDesc
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.AppendUpdateElt');
-- Tâche élémentaire pour 1 instance d'élément de composition
aResult : ParallelEltReturnDesc = new(Count=pCount);
Event Loop
	Postregister
		if pTransactional then
			Start task Self.Transfer(pTransData, pServiceMgr,pService, pTransOrigin) where completion = Event, transaction=dependent;
		else
			Start task Self.Transfer(pTransData, pServiceMgr,pService, pTransOrigin) where completion = Event;
		end if;

	When Self.TransferDone(RetObject) do
		aResult.Object = RetObject;
		exit;
	When Self.TransferExc(RetExc) do
		Raise RetExc;
End Event;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.AppendUpdateElt : End');

Return aResult;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.AppendUpdateElt');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.BusinessClassMaj(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pResult: DataAccessSrvBD.ObjectSelfDesc)
begin
-- Méthode récursive de mise à jour du BusinessClass

if pBusinessClass.SelfDesc = NIL then
	pBusinessClass.SelfDesc = new();
	pBusinessClass.DoResetAttributes();
end if;
if pBusinessClass.SelfDesc.Items = 0 then
	pBusinessClass.DoResetSelfDesc();
end if;
if pResult.SelfDesc = NIL then
	pResult.SelfDesc = new();
end if;
if pResult.SelfDesc.Items = 0 then
	pResult.DoResetSelfDesc();
end if;

pBusinessClass.Id = pResult.Id;
pBusinessClass.DtMajQqo.setValue(pResult.DtMajQqo);
pBusinessClass.IdUtlQqo = pResult.IdUtlQqo;
pBusinessClass.FlagSuppr = pResult.FlagSuppr;

ItemCount : integer;
For aItem in pBusinessClass.SelfDesc do
	ItemCount = ItemCount + 1;
	if aItem.ItemReference.IsA(Type=DataValue) then
		(DataValue)(aItem.ItemReference).setValue((DataValue)(pResult.SelfDesc[ItemCount].ItemReference));
	elseif aItem.ItemReference.IsA(Type=GenericArray) then
		TmpItem : GenericArray = (GenericArray)(aItem.ItemReference);
		TmpItem.Clear();
		TmpArray : GenericArray = (GenericArray)(pResult.SelfDesc[ItemCount].ItemReference);
		For i in 1 to TmpArray.Items do
			TmpItem.AppendRow(TmpArray.FindObjectForRow(i));
		End for;
	elseif aItem.ItemReference.ISA(Type=ObjectSelfDesc) then
		TmpRecord : ObjectSelfDesc =(ObjectSelfDesc)(aItem.ItemReference);
		Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(pResult.SelfDesc[ItemCount].ItemReference));
	end if;
end for;

end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPostAppend: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les post-conditions de la méthode Append.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPostAppend');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPostAppend : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPostAppend');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPostDelete: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les post-conditions de la méthode Delete.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPostDelete');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPostDelete : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPostDelete');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPostRead: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les post-conditions de la méthode Read.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPostRead');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPostRead : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPostRead');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPostUpdate: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les post-conditions de la méthode Update.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPostUpdate');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPostUpdate : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPostUpdate');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreAction: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Action.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreAction');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Append.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreAppend');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagAppend then
	e : ImplementationExc = New();
	e.Message.Setvalue('Append non activée.');
	raise e;
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreAppend : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreAppend');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreAppendAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Append.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	25/07/1997	|	Création.
--	D. NGUYEN	|	27/01/1998	|	Test Classname plus large.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreAppendAction');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagDynamic then
	if Self.BusinessClass = NIL then
		e : ImplementationExc = New();
		e.Message.SetValue('RecordInstance non initialisé.');
		raise e;
	end if;
	
	if Self.BusinessClass.ClassName <> (CacheDesc)(pTransData.TransObject).Record.ClassName then
		TmpTxt : TextData = new(value=(CacheDesc)(pTransData.TransObject).Record.ClassName);
		if not TmpTxt.MoveToString(Self.BusinessClass.ClassName, FALSE,TRUE) then
			e : ImplementationExc = New();
			e.Message.SetValue('Objet transmis de type :');
			e.Message.Concat((CacheDesc)(pTransData.TransObject).Record.ClassName);
			e.Message.Concat(' alors que le service gère des ');
			e.Message.Concat(Self.BusinessClass.GetClassType().Name);
			e.Message.Concat('.');
			raise e;
		end if;
	end if;
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreAppendAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreAppendAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreDelete(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Delete.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreDelete');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagDelete then
	e : ImplementationExc = New();
	e.Message.Setvalue('Delete non activée.');
	raise e;
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreDelete : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreDelete');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreDeleteAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Delete.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	25/07/1997	|	Création.
--	D. NGUYEN	|	27/01/1998	| Test du classname plus large.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreDeleteAction');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagDynamic then
	
	if Self.BusinessClass = NIL then
		e : ImplementationExc = New();
		e.Message.SetValue('RecordInstance non initialisé.');
		raise e;
	end if;
	
	if Self.BusinessClass.ClassName <> (CacheDesc)(pTransData.TransObject).Record.ClassName then
		TmpTxt : TextData = new(value=(CacheDesc)(pTransData.TransObject).Record.ClassName);
		if not TmpTxt.MoveToString(Self.BusinessClass.ClassName, FALSE,TRUE) then
			e : ImplementationExc = New();
			e.Message.SetValue('Objet transmis de type :');
			e.Message.Concat((CacheDesc)(pTransData.TransObject).Record.ClassName);
			e.Message.Concat(' alors que le service gère des ');
			e.Message.Concat(Self.BusinessClass.GetClassType().Name);
			e.Message.Concat('.');
			raise e;
		end if;
	end if;
	
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreDeleteAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreDeleteAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Read.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreRead');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagRead then
	e : ImplementationExc = New();
	e.Message.Setvalue('Read non activée.');
	raise e;
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreRead : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreRead');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreReadAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Append.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreAppendAction');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagDynamic then
	
	if Self.BusinessClass = NIL then
		e : ImplementationExc = New();
		e.Message.SetValue('RecordInstance non initialisé.');
		raise e;
	end if;
	
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreAppendAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreAppendAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreUpdate(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Update.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreUpdate');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not FlagUpdate then
	e : ImplementationExc = New();
	e.Message.Setvalue('Update non activée.');
	raise e;
end if;

unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreUpdate : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreUpdate');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckPreUpdateAction(input pTransData: DataAccessSrvBD.TransDesc = NIL): Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Update.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	25/07/1997	|	Création.
--	D. NGUYEN	|	27/01/1998	|	Test du classname plus large
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.CheckPreUpdateAction');

-- Declarations
unResult : Boolean = FALSE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

if not FlagDynamic then
	
	if Self.BusinessClass = NIL then
		e : ImplementationExc = New();
		e.Message.SetValue('RecordInstance non initialisé.');
		raise e;
	end if;
	
	if Self.BusinessClass.ClassName <> (CacheDesc)(pTransData.TransObject).Record.ClassName then
		TmpTxt : TextData = new(value=(CacheDesc)(pTransData.TransObject).Record.ClassName);
		if not TmpTxt.MoveToString(Self.BusinessClass.ClassName, FALSE,TRUE) then
			e : ImplementationExc = New();
			e.Message.SetValue('Objet transmis de type :');
			e.Message.Concat((CacheDesc)(pTransData.TransObject).Record.ClassName);
			e.Message.Concat(' alors que le service gère des ');
			e.Message.Concat(Self.BusinessClass.GetClassType().Name);
			e.Message.Concat('.');
			raise e;
		end if;
	end if;
end if;
unResult = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.CheckPreUpdateAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.CheckPreUpdateAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CheckTransfer(input aObject: Framework.Object): Framework.boolean
begin
--
--	Description : 	Controls the pre-conditions of a transfer.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransDataDesc :	Data Transport structure.
--					Input	-->	aClassType : ClassType of the BusinessService required.
--					Result	-->	TRUE	:	OK.
--								FALSE	:	KO.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

aResult : Boolean = FALSE;

aResult = TRUE;

Return aResult;
end method;

------------------------------------------------------------
method BusinessServiceDesc.CloneModelComposition(input pParallelServices: Framework.Array of DataAccessSrvBD.ParallelServiceDesc,
	input Deep: Framework.boolean): Framework.Array of DataAccessSrvBD.ParallelServiceDesc
begin
unResult : Array of ParallelServiceDesc = new();
TmpServ : ParallelServiceDesc;

For unServ in pParallelServices do
	TmpServ = new();
	if unServ.BusinessClass <> NIL then
		TmpServ.BusinessClass = unServ.BusinessClass.clone(Deep=Deep);
--		TmpServ.BusinessClass.SelfDesc = new();
--		TmpServ.BusinessClass.DoResetSelfDesc();
	end if;
	if unServ.BusinessClasses <> NIL then
		TmpServ.BusinessClasses = unServ.BusinessClasses.clone(Deep=Deep);
--		For aItem in TmpServ.BusinessClasses do
--			aItem.SelfDesc = new();
--			aItem.DoResetSelfDesc();
--		End for;
	end if;
	TmpServ.ComposantCount = unServ.ComposantCount;
	TmpServ.LinkAttCount = unServ.LinkAttCount;
	TmpServ.TransIntCtxt = unServ.TransIntCtxt.clone(Deep=Deep);
	TmpServ.unService = unServ.unService;
	TmpServ.ServiceMgr = unServ.ServiceMgr;
	unResult.AppendRow(TmpServ);
End for;

Return unResult;
end method;

------------------------------------------------------------
method BusinessServiceDesc.Delete(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin
--
--	Description : 	Deletes the object transmitted.
--					
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Delete 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	03/07/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Mise aux normes 
--	D. NGUYEN	|	14/04/1998	|	Ajout des transactions
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Delete');
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;
if Self.TrsDelete then
	Begin Transaction
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
			CheckPreDelete(pTransData);
		end if;
		DoBeforeDelete(pTransData);
		DeleteAction(pTransData, pTransOrigin, TRUE, pBusinessClass);
		TmpResult : Object;
		DoAfterDelete(pTransData, TmpResult);	
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
			CheckPostDelete();
		end if;
	End Transaction;
else
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
		CheckPreDelete(pTransData);
	end if;
	DoBeforeDelete(pTransData);
	DeleteAction(pTransData, pTransOrigin, FALSE, pBusinessClass);
	TmpResult : Object;
	DoAfterDelete(pTransData, TmpResult);	
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
		CheckPostDelete();
	end if;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Delete : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.Delete');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.DeleteAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin
--
--	Description : 	Deletes the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Delete 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Delete
--
--	Historique :
--
--	D. NGUYEN	|	22/05/1997	|	Creation.
--	D. NGUYEN	|	02/03/1998	|	Correction de bug.
--	D. NGUYEN	|	14/04/1998	|	Ajout des transactions.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DeleteAction');

unResult : CacheDesc;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement automatique
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	CheckPreDeleteAction(pTransData);
end if;
if pBusinessClass.ServiceMgr = NIL or pBusinessClass.unService = NIL then
	pBusinessClass.DoResetService();
end if;
-- Traitement du Record courant
unResult = (CacheDesc) (Self.Transfer(pTransData, pBusinessClass.ServiceMgr, pBusinessClass.unService));

-- Composition
TmpDel : CacheDesc = (CacheDesc)(pTransData.TransObject);
Self.DoBeforeDeleteActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
Self.AppendUpdateComposition(pTransData, TmpDel, pTransOrigin, pTransactional, pBusinessClass);
Self.DoAfterDeleteActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
-- DN 02/03/98 Self.DeleteComposition(pTransData, pTransOrigin);
-- Fin de composition
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.DeleteAction(automatique) : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.DeleteAction');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.DeleteComposant(input output pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL)
begin
-- Version pour un tableau
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DeleteComposant');
-- Tâche pour chaque BusinessClass composante
TaskCount : integer = pBusinessClasses.Items;
i : integer;
if TaskCount > 0 then
	TmpDeleteCount : integer;
	Event Loop
		Postregister
			For aInst in pBusinessClasses do
				i = i + 1;
				TmpTrans : TransDesc = pTransData.Clone(Deep=TRUE);
				TmpCache : CacheDesc = new(IdUtl = pTransData.IdUtl, Record=aInst);
				TmpTrans.TransObject = TmpCache;
--				Start task Self.DeleteElt(i, TmpTrans, pServiceMgr,pService, pTransOrigin) where completion = Event;
				Start task Self.DeleteElt(i, TmpTrans, pServiceMgr,pService, pTransOrigin) where completion = Event, Transaction = dependent;
			end for;
		When Self.DeleteEltDone(RetElt) do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.DeleteEltExc(RetExc) do
			Raise RetExc;
	End Event;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.DeleteComposant : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.DeleteComposant');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.DeleteComposant(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL)
begin
-- Version pour un element
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DeleteComposant(BusinessClass)');
-- Tâche pour chaque BusinessClass composante
TmpDeleteCount : integer;

TmpTrans : TransDesc = pTransData.Clone(Deep=TRUE);
TmpCache : CacheDesc = new(IdUtl = pTransData.IdUtl, Record=pBusinessClass);
TmpTrans.TransObject = TmpCache;
Self.DeleteElt(1, TmpTrans, pServiceMgr,pService, pTransOrigin);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.DeleteComposant(BusinessClass) : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.DeleteComposant(BusinessClass)');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.DeleteComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DeleteComposition');

ComposantPointeur : integer;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;
-- Traitement des composants
if pBusinessClass.SelfDesc = NIL then
	pBusinessClass.SelfDesc = new();
	pBusinessClass.DoResetAttributes();
end if;
if pBusinessClass.SelfDesc.Items = 0 then
	pBusinessClass.DoResetSelfDesc();
end if;

RootData : ObjectSelfDesc = (CacheDesc)(pTransData.TransObject).Record;
if RootData.SelfDesc = NIL then
	RootData.SelfDesc = new();
end if;
if RootData.SelfDesc.Items = 0 then
	RootData.DoResetSelfDesc();
end if;

-- Préparation

ParallelServices : Array of ParallelServiceDesc = new();
TmpBC : ObjectSelfDesc;
TmpPrlService : ParallelServiceDesc;

For aItem in pBusinessClass.SelfDesc do
	ComposantPointeur = ComposantPointeur + 1;
	-- Test de la composition
	FlagComposition : Boolean = FALSE;
	if aItem.ItemReference.Isa(Type=ObjectSelfDesc) and aItem.ParentItemName = '' and aItem.LinkActive and (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) then
		TmpBC = (ObjectSelfDesc)(aItem.ItemReference);
		TmpBC.DoResetAttributes();
		-- le BusinessClass de l'élément est instancié
		if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
			TmpBC.DoResetService();
		end if;
		if TmpBC.SelfDesc = NIL then
			TmpBC.SelfDesc = new();
		end if;
		if TmpBC.SelfDesc.Items = 0 then
			TmpBC.DoResetSelfDesc();
		end if;
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.ReadComposition : Service=');
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
		
		TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
		TmpPrlService.BusinessClass = (ObjectSelfDesc)(RootData.SelfDesc[ComposantPointeur].ItemReference);
		FlagComposition = TRUE;
	elseif aItem.ItemReference.Isa(Type=GenericArray) and aItem.ParentItemName = '' and aItem.LinkActive and (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) then
		TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
		if TmpArray = NIL then
			aItem.ItemReference = new();
			TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
		end if;
		TmpObject : Object = TmpArray.DefaultClass.InstanceAlloc();
		if TmpObject.Isa(Type=ObjectSelfDesc) then
			-- Instanciation du BusinessClass de l'élément
			if TmpArray.Items = 0 then
				TmpBC = (ObjectSelfDesc)(TmpArray.DefaultClass.InstanceAlloc());
				TmpBC.DoResetAttributes();
				TmpArray.AppendRow(TmpBC);
			else
				TmpBC = (ObjectSelfDesc)(TmpArray.FindObjectForRow(1));
			end if;
			-- le BusinessClass de l'élément est instancié
			if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
				TmpBC.DoResetService();
			end if;
			if TmpBC.SelfDesc = NIL then
				TmpBC.SelfDesc = new();
			end if;
			if TmpBC.SelfDesc.Items = 0 then
				TmpBC.DoResetSelfDesc();
			end if;

			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.DeleteComposition : Service=');
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
			TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
			FlagComposition = TRUE;
			
		end if; -- TmpObject.Isa(Type=ObjectSelfDesc)
	end if; -- aItem.ItemReference.Isa(Type=GenericArray)
	
	-- Dans le cadre du parcours de pBusinessClass,
	-- S'il y a composition, alors :
	if FlagComposition then
		-- Préparation du transfert
		TmpTrans : TransDesc = pTransData.clone(Deep=TRUE);
		-- Désencapsulation des données transmises en entrée
		
		-- Recherche de l'élément à traiter
		For aDataItem in RootData.SelfDesc do
			if aDataItem.ItemName = aItem.ItemName then
				if aDataItem.ItemReference.IsA(Type=ObjectSelfDesc) then
					TmpPrlService.BusinessClass = (ObjectSelfDesc)(aDataItem.ItemReference);
					TmpPrlService.BusinessClass.SelfDesc = new();
					TmpPrlService.BusinessClass.DoResetSelfDesc();
					-- Mise à jour des champs de liens avec le parent
					i : integer;
					-- Recherche des champs de lien
					Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.DeleteComposition : TmpBC.SelfDesc.Items=');
					Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.SelfDesc.Items);
					-- Lien stocké sur le père avec ItemName = Link+ nom de l'attribut d'instance
					-- Recherche d'attribut de lien
					FlagLinkAtt : Boolean = FALSE;
					TmpLinkName : TextData = new(value='Link');
					TmpLinkName.concat(aDataItem.ItemName);
					i = 0;
					For aLinkAtt in RootData.SelfDesc do
						i = i + 1;
						if TmpLinkName.IsEqual(aLinkAtt.ItemName) and aLinkAtt <> NIL then
							TmpPrlService.LinkAttCount = i;
							FlagLinkAtt = TRUE;
							exit;
						end if;
					End for;
					i = 0;
					if not FlagLinkAtt then
						-- Lien stocké sur le fils
						For TmpBCItem in TmpBC.SelfDesc do
							i = i + 1;
							if TmpBCItem.ItemName = TmpPrlService.BusinessClass.SelfDesc[i].ItemName and TmpPrlService.BusinessClass.SelfDesc[i].ParentItemName <> '' then
								-- Mot clé Id+Nom de la classe container
								TmpTxt : TextData = new(value='Id');
								TmpTxt.Concat(RootData.ClassName);
								if TmpTxt.IsEqual(TmpPrlService.BusinessClass.SelfDesc[i].ParentItemName,TRUE) then
									TmpId : IntegerData = new(value=RootData.Id);
									(IntegerData)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference).setValue(TmpId);
								else
									-- Recherche du parent à affecter
									For aParent in RootData.SelfDesc do
										if aParent.ItemName = TmpBCItem.ParentItemName then
											TmpPrlService.BusinessClass.SelfDesc[i].ItemName = aParent.ItemName;
											if aParent.ItemReference.IsA(Type=DataValue) then
												(DataValue)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference).setValue((DataValue)(aParent.ItemReference));
											elseif aParent.ItemReference.IsA(Type=ObjectSelfDesc) then
												TmpRecord : ObjectSelfDesc = (ObjectSelfDesc)(TmpPrlService.BusinessClass.SelfDesc[i].ItemReference);
												Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(aParent.ItemReference));
											end if;
											exit;
										end if;
									End for;
								end if;
							end if;
						end for;
					end if;
					-- Les champs de lien sont à jour
					TmpPrlService.BusinessClass.SelfDesc = NIL;
				else -- aDataItem.ItemReference.IsA(Type=ObjectSelfDesc)
					TmpPrlService.BusinessClasses = (Array of ObjectSelfDesc)(aDataItem.ItemReference);
					For aInst in TmpPrlService.BusinessClasses do
						aInst.SelfDesc = new();
						aInst.DoResetSelfDesc();
						-- Mise à jour des champs de liens avec le parent
						i : integer;
						-- Recherche des champs de lien
						Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.DeleteComposition : TmpBC.SelfDesc.Items=');
						Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.SelfDesc.Items);
						-- Lien stocké obligatoirement sur le fils
						For TmpBCItem in TmpBC.SelfDesc do
							i = i + 1;
							if TmpBCItem.ItemName = aInst.SelfDesc[i].ItemName and aInst.SelfDesc[i].ParentItemName <> '' then
								-- Mot clé Id+Nom de la classe container
								TmpTxt : TextData = new(value='Id');
								TmpTxt.Concat(RootData.ClassName);
								if TmpTxt.IsEqual(aInst.SelfDesc[i].ParentItemName,TRUE) then
									TmpId : IntegerData = new(value=RootData.Id);
									(IntegerData)(aInst.SelfDesc[i].ItemReference).setValue(TmpId);
								else
									-- Recherche du parent à affecter
									For aParent in RootData.SelfDesc do
										if aParent.ItemName = TmpBCItem.ParentItemName then
											aInst.SelfDesc[i].ItemName = aParent.ItemName;
											if aParent.ItemReference.IsA(Type=DataValue) then
												(DataValue)(aInst.SelfDesc[i].ItemReference).setValue((DataValue)(aParent.ItemReference));
											elseif aParent.ItemReference.IsA(Type=ObjectSelfDesc) then
												TmpRecord : ObjectSelfDesc = (ObjectSelfDesc)(aInst.SelfDesc[i].ItemReference);
												Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(aParent.ItemReference));
											end if;
											exit;
										end if;
									End for;
								end if;
							end if;
						End for;
						-- Les champs de lien sont à jour
						aInst.SelfDesc = NIL;
					end for;
				end if; -- aDataItem.ItemReference.IsA(Type=ObjectSelfDesc)
				exit;
			end if; -- aDataItem.ItemName = aItem.ItemName
		end for; -- aDataItem
		ParallelServices.AppendRow(TmpPrlService);
		
	end if; -- FlagComposition
End for; -- aItem
-- Fin Préparation

if ParallelServices.Items > 0 then
	-- Event Loop : Passe 2 : parallèlisation
	TaskCount : integer = ParallelServices.Items;
	Event Loop
		Postregister
			For aServ in ParallelServices do
				if aServ.BusinessClass = NIL then
					Start task Self.DeleteComposant(aServ.BusinessClasses, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin) where completion = Event, Transaction = Dependent;
	--				Start task Self.DeleteComposant(aServ.BusinessClasses, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin) where completion = Event;
				else
					Start task Self.DeleteComposant(aServ.BusinessClass, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin) where completion = Event, Transaction = Dependent;
	--				Start task Self.DeleteComposant(aServ.BusinessClass, pTransData, aServ.ServiceMgr,aServ.unService, pTransOrigin) where completion = Event;
				end if;
			end for;
		
		When Self.DeleteComposantArrayDone do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.DeleteComposantArrayExc(aExc) do
			TaskCount = TaskCount - 1;
			Raise aExc;
		When Self.DeleteComposantDone do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.DeleteComposantExc(aExc) do
			TaskCount = TaskCount - 1;
			Raise aExc;
	End Event;
	-- Fin Event Loop
end if;
For aServ in ParallelServices do
	if RootData.SelfDesc[aServ.ComposantCount].ItemReference.IsA(Type=ObjectSelfDesc) then
		RootData.SelfDesc[aServ.ComposantCount].ItemReference = aServ.BusinessClass;
		if aServ.LinkAttCount > 0 then
			(IntegerNullable)(RootData.SelfDesc[aServ.LinkAttCount].ItemReference).setValue(aServ.BusinessClass.Id);
		end if;
	else
		RootData.SelfDesc[aServ.ComposantCount].ItemReference = aServ.BusinessClasses;
	end if;
end For;
RootData.SelfDesc = NIL;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.DeleteComposition : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.DeleteComposition');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.DeleteElt(input pCount: Framework.integer,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): DataAccessSrvBD.ParallelEltReturnDesc
begin
-- Tâche élémentaire pour 1 instance d'élément de composition
aResult : ParallelEltReturnDesc = new(Count=pCount);
Event Loop
	Postregister
		Start task Self.Transfer(pTransData, pServiceMgr,pService, pTransOrigin) where completion = Event;
	When Self.TransferDone(RetObject) do
		aResult.Object = RetObject;
		exit;
	When Self.TransferExc(RetExc) do
		Raise RetExc;
End Event;

Return aResult;
end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  JB BRIAUD | 29/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('BusinessServiceDesc.DoAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterAppend(input output pTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterAppendActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterDelete(input output aTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterDeleteActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterRead(input output aTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterReadActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: Framework.Array of DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterUpdate(input output pTransData: DataAccessSrvBD.TransDesc,
	input output pResult: Framework.Object)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAfterUpdateActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoAppendAction(input pTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to append 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Append
--
--	Historique :
--
--	D. NGUYEN	|	22/05/1997	|	Creation.
--+

--aResult : Object;
--aServiceMgr : DataServiceMgrDesc;
--aClassType  : ClassType;

-- Transfer to the manager for each DataService

--aServiceMgr = SoXXXDataServiceMgr;
--aClassType  = DataYYYService;
--aResult = super.Transfer (aTransData = aTransData, aServiceMgr = aServiceMgr, aClassType = aClassType);
--Return aResult;

-- Exception d'implémentation

e : ImplementationExc = new;
Self.TraceExc(e,'BusinessServiceDesc.AppendAction');
Raise e;
end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeAppend(input output aTransData: DataAccessSrvBD.TransDesc)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeAppendActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeDelete(input output aTransData: DataAccessSrvBD.TransDesc)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeDeleteActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeRead(input output aTransData: DataAccessSrvBD.TransDesc)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeReadActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: Framework.Array of DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.DoBeforeUpdateActionComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin

end method;

------------------------------------------------------------
method BusinessServiceDesc.Init
begin
--
--	Description : 	Initializes the class.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
Self.FlagAppend = FALSE;
Self.FlagDelete = FALSE;
Self.FlagRead = FALSE;
Self.FlagUpdate = FALSE;
Self.NtfAppend = FALSE;
Self.NtfUpdate = FALSE;
Self.NtfDelete = FALSE;
Self.TrsAppend = FALSE;
Self.TrsDelete = FALSE;
Self.TrsRead = FALSE;
Self.TrsUpdate = FALSE;
Self.ReadPrepareDone = FALSE;
Self.FlagDynamic = FALSE;


end method;

------------------------------------------------------------
method BusinessServiceDesc.Read(input pTransData: DataAccessSrvBD.TransDesc,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Reads the object transmitted.
--					
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Read 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	03/07/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Mise aux normes 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Read');
unResult : Object;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;
if Self.TrsRead then
	Begin Transaction
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
			CheckPreRead(pTransData);
		end if;
		DoBeforeRead(pTransData);
		unResult = ReadAction(pTransData, TRUE, pBusinessClass);
		DoAfterRead(pTransData, unResult);	
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
			CheckPostRead();
		end if;
	End Transaction;
else
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
		CheckPreRead(pTransData);
	end if;
	DoBeforeRead(pTransData);
	unResult = ReadAction(pTransData, FALSE, pBusinessClass);
	DoAfterRead(pTransData, unResult);	
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
		CheckPostRead();
	end if;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Read : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.Read');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.ReadAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Reads the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Read 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Read
--
--	Historique :
--
--	D. NGUYEN	|	22/05/1997	|	Creation.
--	D. NGUYEN	|	14/04/1998	|	Ajout des trsanactions.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.ReadAction');
unResult : Array of CacheDesc;

if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement automatique
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	CheckPreReadAction(pTransData);
end if;
if pBusinessClass.ServiceMgr = NIL or pBusinessClass.unService = NIL then
	pBusinessClass.DoResetService();
end if;
-- Traitement du Record courant
unResult = (Array of CacheDesc)(Self.Transfer(pTransData, pBusinessClass.ServiceMgr, pBusinessClass.unService));

-- Composition
if unResult.Items > 0 then
	Self.DoBeforeReadActionComposition(pTransData, unResult, pTransactional, pBusinessClass);
	TaskCount : integer;
	Event Loop
		PostRegister
			For uneLigne in unResult do
				TaskCount = TaskCount + 1;
				if pTransactional then
					Start task Self.ReadComposition(pTransData,uneLigne, pTransactional, pBusinessClass) where completion = Event, transaction = dependent;
				else
					Start task Self.ReadComposition(pTransData,uneLigne, pTransactional, pBusinessClass) where completion = Event;
				end if;
			end for;
		When Self.ReadCompositionDone do
			TaskCount = TaskCount - 1;
			if TaskCount = 0 then
				exit;
			end if;
		When Self.ReadCompositionExc(unExc) do
			TaskCount = TaskCount - 1;
			Raise unExc;
	End Event;
	Self.DoAfterReadActionComposition(pTransData, unResult, pTransactional, pBusinessClass);
end if;
-- Fin de composition
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.ReadAction(automatique) : End');

Return unResult;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.ReadAction');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.ReadComposant(input output pBusinessClasses: Framework.Array of DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.ReadComposant');
-- Tâche pour chaque BusinessClass composante
TmpResult :Array of CacheDesc;
TmpResult = (Array of CacheDesc)(Self.Transfer(pTransData, pServiceMgr,pService));
pBusinessClasses.Clear();
For unCach in TmpResult do
	unCach.Record.SelfDesc = NIL;
	pBusinessClasses.AppendRow(unCach.Record);
End for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.ReadComposant : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.ReadComposant');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.ReadComposant(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pTransData: DataAccessSrvBD.TransDesc,
	input pServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input pService: Framework.ClassType)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.ReadComposant(BusinessClass)');
-- Tâche pour chaque BusinessClass composante
TmpResult :Array of CacheDesc;
TmpResult = (Array of CacheDesc)(Self.Transfer(pTransData, pServiceMgr,pService));
if TmpResult.Items > 0 then
	if TmpResult[1].Record <> NIL then
		Self.BusinessClassMaj(pBusinessClass,TmpResult[1].Record);
	end if;

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.ReadComposant(BusinessClass) : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.ReadComposant');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.ReadComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input output unResult: DataAccessSrvBD.CacheDesc,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.ReadComposition');

ParallelServices : Array of ParallelServiceDesc;
--if Self.ReadPrepareDone then
	ParallelServices = Self.ReadPrepareComposition(pTransData, unResult, pBusinessClass, FALSE, FALSE);
--else
--	ParallelServices = Self.ReadPrepareComposition(pTransData, unResult, pBusinessClass, FALSE, TRUE);
--end if;

if ParallelServices <> NIL then
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.ReadComposition : ParallelServices.Items=');
	Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, ParallelServices.Items);
	if ParallelServices.Items > 0 then
		-- Event Loop : Passe 2 : parallèlisation
		TaskCount : integer = ParallelServices.Items;
		Event Loop
			Postregister
				For aServ in ParallelServices do
					if aServ.BusinessClass = NIL then
						if pTransactional then
							Start task Self.ReadComposant(aServ.BusinessClasses, aServ.TransIntCtxt, aServ.ServiceMgr,aServ.unService) where completion = Event, transaction = dependent;
						else
							Start task Self.ReadComposant(aServ.BusinessClasses, aServ.TransIntCtxt, aServ.ServiceMgr,aServ.unService) where completion = Event;
						end if;
					else
						if pTransactional then
							Start task Self.ReadComposant(aServ.BusinessClass , aServ.TransIntCtxt, aServ.ServiceMgr,aServ.unService) where completion = Event, transaction= dependent;
						else
							Start task Self.ReadComposant(aServ.BusinessClass , aServ.TransIntCtxt, aServ.ServiceMgr,aServ.unService) where completion = Event;
						end if;
					end if;
				end for;
			
			When Self.ReadComposantArrayDone do
				TaskCount = TaskCount - 1;
				if TaskCount = 0 then
					exit;
				end if;
			When Self.ReadComposantArrayExc(aExc) do
				TaskCount = TaskCount - 1;
				Raise aExc;
			When Self.ReadComposantDone do
				TaskCount = TaskCount - 1;
				if TaskCount = 0 then
					exit;
				end if;
			When Self.ReadComposantExc(aExc) do
				TaskCount = TaskCount - 1;
				Raise aExc;
		End Event;
		-- Fin Event Loop
	end if;
end if;

unResult.Record.SelfDesc = NIL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.ReadComposition : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.ReadComposition');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.ReadPrepareComposition(input pTransData: DataAccessSrvBD.TransDesc,
	input unResult: DataAccessSrvBD.CacheDesc,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pCompositionPrepareDone: Framework.boolean = FALSE,
	input pAffectModel: Framework.boolean = TRUE): Framework.Array of DataAccessSrvBD.ParallelServiceDesc
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.PrepareComposition');

if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement des composants
if pBusinessClass.SelfDesc = NIL then
	pBusinessClass.SelfDesc = new();
end if;
if pBusinessClass.SelfDesc.Items = 0 then
	pBusinessClass.DoResetAttributes();
	pBusinessClass.DoResetSelfDesc();
end if;

TmpResult : ObjectSelfDesc = unResult.Record;
if TmpResult.SelfDesc = NIL then
	TmpResult.SelfDesc = new;
end if;
if TmpResult.SelfDesc.Items = 0 then
	TmpResult.DoResetSelfDesc();
end if;
ParallelServices : Array of ParallelServiceDesc;
TmpBC : ObjectSelfDesc;
TmpPrlService : ParallelServiceDesc;

If pCompositionPrepareDone Then
	-- CompositionPrepareDone
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.PrepareComposition : CompositionPrepareDone');
	if Self.ReadModelParallelServices <> NIL then
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.PrepareComposition : ModelParallelServices <> NIL');
		If Self.ReadModelParallelServices.Items > 0 then
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.PrepareComposition : ModelParallelServices > 0');
			ParallelServices = Self.CloneModelComposition(Self.ReadModelParallelServices,TRUE);
			For aPService in ParallelServices do
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.PrepareComposition : For ParallelServices ');
				TmpPrlService = aPService;
				-- Préparation du transfert
				TmpPrlService.TransIntCtxt.IdUtl = pTransData.IdUtl;
				TmpPrlService.TransIntCtxt.TransActionService = pTransData.TransActionService;
				TmpPrlService.TransIntCtxt.TransSessionId = pTransData.TransSessionId;
				
				-- Recherche des champs de lien
				For aDataStr in TmpPrlService.TransIntCtxt.aDataContext.SelfDesc do
					if aDataStr.ItemName = 'Id' then
					-- Lien stocké sur le père avec ItemName = Link+ nom de l'attribut d'instance
						For aLinkAtt in TmpResult.SelfDesc do
							if aLinkAtt.ItemName = aDataStr.ParentItemName then
								aDataStr.ItemReference = aLinkAtt.ItemReference;
							End if;
						End for;
					else
					-- Lien stocké sur le fils
						-- Mot clé Id+Nom de la classe container
						TmpTxt : TextData = new(value='Id');
						TmpTxt.Concat(pBusinessClass.ClassName);
						if aDataStr.ItemName = TmpTxt.Value then
							TmpId : IntegerData = new(value=TmpResult.Id);
							aDataStr.ItemReference=TmpId;
						else
							-- Recherche du parent à affecter
							For aParent in TmpResult.SelfDesc do
								if aParent.ItemName = aDataStr.ItemName then
									aDataStr.ItemReference = aParent.ItemReference;
									exit;
								end if;
							End for;
						end if;
					end if;
				End for;
			End For;
		End if;
	End if;

Else
-- Not CompositionPrepareDone : First Time to do it.
	ParallelServices = new();
	ComposantPointeur : integer;
-- Préparation
	
	For aItem in pBusinessClass.SelfDesc do
		ComposantPointeur = ComposantPointeur + 1;
		-- Test de la composition
		FlagComposition : Boolean = FALSE;
		if aItem.ItemReference.Isa(Type=ObjectSelfDesc) and aItem.LinkActive and 
		((aItem.LinkAppend and pTransData.TransActionService = ACT_STD_APPEND) 
		or (aItem.LinkUpdate and pTransData.TransActionService = ACT_STD_UPDATE) 
		or (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) 
		or (aItem.LinkRead and pTransData.TransActionService = ACT_STD_READ)
		or (pTransData.TransActionService <> ACT_STD_APPEND and 
		pTransData.TransActionService <> ACT_STD_UPDATE and
		pTransData.TransActionService <> ACT_STD_DELETE and
		pTransData.TransActionService <> ACT_STD_READ)) then
-- DN->DA 15/04/98		if aItem.ItemReference.Isa(Type=ObjectSelfDesc) and aItem.LinkActive then
			TmpBC = (ObjectSelfDesc)(aItem.ItemReference);
			TmpBC.DoResetAttributes();
			-- le BusinessClass de l'élément est instancié
			if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
				TmpBC.DoResetService();
			end if;
			if TmpBC.SelfDesc = NIL then
				TmpBC.SelfDesc = new();
			end if;
			if TmpBC.SelfDesc.Items = 0 then
				TmpBC.DoResetSelfDesc();
			end if;
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.ReadComposition : Service=');
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
			TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
			TmpPrlService.BusinessClass = (ObjectSelfDesc)(TmpResult.SelfDesc[ComposantPointeur].ItemReference);
			FlagComposition = TRUE;
		elseif aItem.ItemReference.Isa(Type=GenericArray) then
			TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
			if TmpArray = NIL then
				aItem.ItemReference = new();
				TmpArray : GenericArray = (GenericArray)(aItem.ItemReference);
			end if;
			TmpObject : Object = TmpArray.DefaultClass.InstanceAlloc();
			if TmpObject.Isa(Type=ObjectSelfDesc) and aItem.LinkActive and 
			((aItem.LinkAppend and pTransData.TransActionService = ACT_STD_APPEND) 
			or (aItem.LinkUpdate and pTransData.TransActionService = ACT_STD_UPDATE) 
			or (aItem.LinkDelete and pTransData.TransActionService = ACT_STD_DELETE) 
			or (aItem.LinkRead and pTransData.TransActionService = ACT_STD_READ)
			or (pTransData.TransActionService <> ACT_STD_APPEND and 
			pTransData.TransActionService <> ACT_STD_UPDATE and
			pTransData.TransActionService <> ACT_STD_DELETE and
			pTransData.TransActionService <> ACT_STD_READ)) then
-- DN->DA 15/04/98			if TmpObject.Isa(Type=ObjectSelfDesc) and aItem.LinkActive then
				-- Instanciation du BusinessClass de l'élément
				if TmpArray.Items = 0 then
					TmpBC = (ObjectSelfDesc)(TmpArray.DefaultClass.InstanceAlloc());
					TmpBC.DoResetAttributes();
					TmpArray.AppendRow(TmpBC);
				else
					TmpBC = (ObjectSelfDesc)(TmpArray.FindObjectForRow(1));
				end if;
				-- le BusinessClass de l'élément est instancié
				if TmpBC.ServiceMgr = NIL or TmpBC.unService = NIL then
					TmpBC.DoResetService();
				end if;
				if TmpBC.SelfDesc = NIL then
					TmpBC.SelfDesc = new();
				end if;
				if TmpBC.SelfDesc.Items = 0 then
					TmpBC.DoResetSelfDesc();
				end if;
				
				Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- BusinessServiceDesc.ReadComposition : Service=');
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, TmpBC.unService.Name);
				TmpPrlService = new(ComposantCount=ComposantPointeur, ServiceMgr = TmpBC.ServiceMgr, unService=TmpBC.unService);
				TmpPrlService.BusinessClasses = (Array of ObjectSelfDesc)(TmpResult.SelfDesc[ComposantPointeur].ItemReference);
				FlagComposition = TRUE;
			end if;
		end if;
		if FlagComposition then
			-- Préparation du transfert
			TmpPrlService.TransIntCtxt = new();
			TmpPrlService.TransIntCtxt.IdUtl = pTransData.IdUtl;
			TmpPrlService.TransIntCtxt.TransActionService = pTransData.TransActionService;
			TmpPrlService.TransIntCtxt.TransSessionId = pTransData.TransSessionId;
			-- Création du contexte technique de composition
			TmpPrlService.TransIntCtxt.aDataContext = new();
			TmpPrlService.TransIntCtxt.aDataContext.SelfDesc = new();
			-- Recherche des champs de lien
			TmpStructure : StructureDesc;
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.ReadComposition : TmpBC.SelfDesc.Items=');
			Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.SelfDesc.Items);
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- BusinessServiceDesc.ReadComposition : TmpBC.ClassName=');
			Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, TmpBC.ClassName);
			-- Lien stocké sur le père avec ItemName = Link+ nom de l'attribut d'instance
			-- Recherche d'attribut de lien
			FlagLinkAtt : Boolean = FALSE;
			TmpLinkName : TextData = new(value='Link');
			TmpLinkName.concat(aItem.ItemName);
			if aItem.ItemReference.Isa(Type=ObjectSelfDesc) then
				For aLinkAtt in TmpResult.SelfDesc do
					if TmpLinkName.IsEqual(aLinkAtt.ItemName) and aLinkAtt <> NIL then
						TmpStructure = new();
						TmpStructure.ItemName = 'Id';
						TmpStructure.ItemReference = aLinkAtt.ItemReference;
						TmpStructure.ParentItemName = aLinkAtt.ItemName;
						TmpPrlService.TransIntCtxt.aDataContext.SelfDesc.AppendRow(TmpStructure);
						FlagLinkAtt = TRUE;
						exit;
					end if;
				End for;
			end if;
			if not FlagLinkAtt then
				-- Lien stocké sur le fils
				For TmpBCItem in TmpBC.SelfDesc do
					if TmpBCItem.ParentItemName <> '' then
						TmpStructure = new();
						-- Mot clé Id+Nom de la classe container
						TmpTxt : TextData = new(value='Id');
						TmpTxt.Concat(pBusinessClass.ClassName);
						TmpStructure.ItemName = TmpTxt.Value;
						if TmpTxt.IsEqual(TmpBCItem.ParentItemName,TRUE) then
							TmpId : IntegerData = new(value=TmpResult.Id);
							TmpStructure.ItemReference=TmpId;
							TmpPrlService.TransIntCtxt.aDataContext.SelfDesc.AppendRow(TmpStructure);
						else
							-- Recherche du parent à affecter
							For aParent in TmpResult.SelfDesc do
								if aParent.ItemName = TmpBCItem.ParentItemName and aParent.ItemReference.IsA(Type=DataValue) then
									TmpStructure.ItemName = aParent.ItemName;
									TmpStructure.ItemReference = aParent.ItemReference;
									TmpPrlService.TransIntCtxt.aDataContext.SelfDesc.AppendRow(TmpStructure);
									exit;
								end if;
							End for;
						end if;
					end if;
				End for;
			end if;
			ParallelServices.AppendRow(TmpPrlService);
		end if;
	End for;
	if ParallelServices <> NIL and pAffectModel then
		Self.ReadModelParallelServices = Self.CloneModelComposition(ParallelServices, TRUE);
		Self.ReadPrepareDone = TRUE;
	end if;
End if;
-- Fin Préparation
-- DN 26/02/98

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.PrepareComposition : End');

Return ParallelServices;


Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.PrepareComposition');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceDesc.Update(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Updates the object transmitted.
--					
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Update 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	03/07/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Mise aux normes 
--	D. NGUYEN	|	14/04/1998	|	Ajout des transactions
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Update');
unResult : Object;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;
if Self.TrsUpdate then
	Begin Transaction
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
			CheckPreUpdate(pTransData);
		end if;
		DoBeforeUpdate(pTransData);
		unResult = UpdateAction(pTransData, pTransOrigin, TRUE, pBusinessClass);
		DoAfterUpdate(pTransData,unResult);	
		if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
			CheckPostUpdate();
		end if;
	End Transaction;
else
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
		CheckPreUpdate(pTransData);
	end if;
	DoBeforeUpdate(pTransData);
	unResult = UpdateAction(pTransData, pTransOrigin, FALSE, pBusinessClass);
	DoAfterUpdate(pTransData,unResult);	
	if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 11) then
		CheckPostUpdate();
	end if;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Update : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.Update');
		Raise;
end method;

------------------------------------------------------------
method BusinessServiceDesc.UpdateAction(input pTransData: DataAccessSrvBD.TransDesc,
	input pTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL,
	input pTransactional: Framework.boolean = FALSE,
	input pBusinessClass: DataAccessSrvBD.ObjectSelfDesc = NIL): Framework.Object
begin
--
--	Description : 	Updates the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransdata :	Container of the object to Update 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceDesc.Update
--
--	Historique :
--
--	D. NGUYEN	|	22/05/1997	|	Creation.
--	D. NGUYEN	|	22/01/1998	|	Ajout du test NIL sur unResult.
--	D. NGUYEN	|	14/04/1998	|	Ajout des trsanactions.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.UpdateAction');
unResult : CacheDesc;
if pBusinessClass = NIL then
	if Self.FlagDynamic then
		pBusinessClass = Self.BusinessClass.clone(Deep=TRUE);
	else
		pBusinessClass = Self.BusinessClass;
	end if;
end if;

-- Traitement automatique
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	CheckPreUpdateAction(pTransData);
end if;
if pBusinessClass.ServiceMgr = NIL or pBusinessClass.unService = NIL then
	pBusinessClass.DoResetService();
end if;

-- Traitement du Record courant
unResult = (CacheDesc)(Self.Transfer(pTransData, pBusinessClass.ServiceMgr,pBusinessClass.unService));

-- Composition
if unResult <> NIL then
	Self.DoBeforeUpdateActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
	Self.AppendUpdateComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
	Self.DoAfterUpdateActionComposition(pTransData,unResult, pTransOrigin, pTransactional, pBusinessClass);
End if;

-- Fin de composition
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.UpdateAction(automatique) : End');

Return unResult;

Exception
	When e: GenericException do
		Self.TraceExc(e,'BusinessServiceDesc.UpdateAction');
		Raise;

end method;

------------------------------------------------------------
method BusinessServiceMgrDesc.Init
begin
--
--	Description : 	Init.
--
--	Type :	Abstrait
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : this class is used by the concret BusinessTransactionServices to type the used manager.
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method Cache.Append(input aObjects: Framework.Array of Framework.Object)
begin
--
--	Description : 	Appends the objects transmitted into the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aObjects :	Container of the objects to append.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

if aObjects <> NIL then
	Self.Objects.Clear();
	for Obj in aObjects do
		Self.Objects.appendrow(Obj);
	end for;
else
	Self.Objects = new;
end if;

for obj in Objects do
	if (CacheDesc)(Obj).Record.Id > LastId then
		LastId = Obj.Record.Id;
	end if;
end for;


end method;

------------------------------------------------------------
method Cache.Append(input output aCacheDesc: DataAccessSrvBD.CacheDesc)
begin
--
--	Description : 	Appends an instance of cachedesc transmitted into the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input Output	--> aCacheDesc :	Container of the object to append.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

if aCacheDesc = NIL then
	e : NoDataFoundExc = new;
	e.Message.setValue('Cache.Append : aCacheDesc = NIL');
	e.Severity = SP_ER_USER;
	raise e;
else
	Self.Objects.appendRow(aCacheDesc);
	if aCacheDesc.Record.Id = 0 then
		Self.Objects[Self.Objects.Items].Record.Id = LastId + 1;
		aCacheDesc.Record.Id = LastId + 1;
		LastId = LastId + 1;
	end if;
end if;
end method;

------------------------------------------------------------
method Cache.CriteraPlay(input aCritera: Framework.TextData,
	input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean
begin
--
--	Description : 	Plays the critera on the record.
--
--	Type :	Concret
--
--	Parametres :	Input	--> aCritera :	Container of the critera.
--					Input	-->	aRecordSelfDesc : Record to be tested.
--					Return	-->	boolean : TRUE = OK, FALSE = KO.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+


-- Initialization of the variables

aResult : Boolean = TRUE;
aTmpResult : Boolean = FALSE;
aTmpResult1 : Boolean = FALSE;
BegPos : Integer;
EndPos : Integer;
BegPos1 : Integer;
EndPos1 : Integer;
BegPos = aCritera.Offset;
EndPos = aCritera.Offset;
aField : TextData = new;
aOperation : Integer; -- 0: =, 1:<, 2:<=, 3:>, 4: >= , 5: <>
aTmpOpe : TextData = new;
aValue : TextData = new;
aTmpTxt : TextData = new;
aCritera.Trimleading;
aCritera.TrimTrailing;
aCritera.Offset=0;
FlagSelfDesc : Boolean = FALSE;

if aRecordSelfDesc.SelfDesc = NIL then
	aRecordSelfDesc.SelfDesc = new;
end if;
if aRecordSelfDesc.selfDesc.Items = 0 then
	aRecordSelfDesc.DoResetSelfDesc();
	FlagSelfDesc = TRUE;
end if;

xWhi:While not aCritera.IsAtEnd() do
	
	-- syntax analysis
	
	if aCritera.IsChar(ListOfChars='(') then
		aCritera.MoveNext;
		BegPos = aCritera.Offset;
		aCritera.MoveToChar(ListofChars = ')');
		EndPos = aCritera.Offset;
		aTmpTxt = aCritera.CopyRange(StartOffSet = BegPos, EndOffSet = EndPos);
		
		-- analysis of the basic expression
		aTmpTxt.Trimleading;
		aTmpTxt.TrimTrailing;
		BegPos1 = aTmpTxt.Offset+1;
		EndPos1 = aTmpTxt.Offset;
		aField = '';
		aTmpOpe = '';
		aValue = '';
		aTmpResult1 = FALSE;
		While not aTmpTxt.IsAtEnd() and aTmpResult1 = FALSE do
			aTmpTxt.MoveNext;
			
			If aTmpTxt.IsChar(ListOfChars='{') then
				aField = '';
				aTmpOpe = '';
				aValue = '';
				BegPos1 = aTmpTxt.Offset+1;
				EndPos1 = aTmpTxt.Offset+1;
			Elseif aTmpTxt.IsChar(ListOfChars='}') then
				BegPos1 = EndPos1;
				EndPos1 = aTmpTxt.Offset;
				aValue.Concat(aTmpTxt.CopyRange(StartOffSet = BegPos1, EndOffSet = EndPos1));
				-- Converts the operation
				If aTmpOpe.Value = '<' then
					aOperation = 1;
				elseif aTmpOpe.Value = '<=' then
					aOperation = 2;
				elseif aTmpOpe.Value = '>' then
					aOperation = 3;
				elseif aTmpOpe.Value = '>=' then
					aOperation = 4;
				elseif aTmpOpe.Value = '<>' then
					aOperation = 5;
				else
					aOperation = 0;
				end if;
				-- The element is decomposed : call the test method for expression
				If Not TstExpression(aField=aField, aOperation = aOperation, aValue = aValue, aRecordSelfDesc = aRecordSelfDesc) then
					aTmpResult = FALSE;
				else
					aTmpResult = TRUE;
					aTmpResult1 = TRUE;
				end if;
				BegPos1 = EndPos1;
				EndPos1 = aTmpTxt.Offset;
			Elseif aTmpTxt.IsChar(ListOfChars='=><') and aField.value = '' then
				EndPos1 = aTmpTxt.Offset;
				aField = aTmpTxt.CopyRange(StartOffSet = BegPos1, EndOffSet = EndPos1);
				BegPos1 = EndPos1;
				aTmpTxt.MoveNext;
				EndPos1 = aTmpTxt.Offset;
				if aTmpTxt.IsChar(ListOfChars='=><') then
					aTmpTxt.MoveNext;
					EndPos1 = aTmpTxt.Offset;
				end if;
				aTmpOpe.Concat(aTmpTxt.CopyRange(StartOffSet = BegPos1, EndOffSet = EndPos1));
				aTmpTxt.MovePrevious;
			end if;
		End While;
		
	elseif aCritera.IsChar(ListOfChars='AOao') then
		-- Searching for expression "AND" or "OR"
		if aCritera.IsChar(ListOfChars='Aa') then
			-- Testing the temp Result : if "AND" and Result = FALSE -> Out
			if aTmpResult1 = FALSE then
				aResult = FALSE;
				exit xWhi;
			end if;
		elseif aCritera.IsChar(ListOfChars='Oo') then
		-- Testing the temp Result : If "OR" and TmpResult = TRUE -> Search next "AND"
			if aTmpResult1 = TRUE then
				aResult = TRUE;
				aCritera.MoveToString(Source='AND', GoPast=TRUE, IgnoreCase = TRUE);
			end if;
		end if;
	end if;
	if aTmpResult1 = TRUE then
		aResult = TRUE;
	else
		aResult = FALSE;
		exit xWhi;
	end if;
	aCritera.MoveNext;
	BegPos = aCritera.Offset;
End While;
if FlagSelfDesc then
	aRecordSelfDesc.selfDesc.Clear();
end if;

Return aResult;
end method;

------------------------------------------------------------
method Cache.Delete(input aCacheDesc: DataAccessSrvBD.CacheDesc)
begin
--
--	Description : 	Deletes the object transmitted in the cacheDesc from the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aCacheDesc :	Container of the object to Delete.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Row : Integer=0;
For obj in Objects do
	Row = Row +1;
	if obj.Record.Id = aCacheDesc.Record.Id then
		Objects.DeleteRow(Row);
		exit;
	end if;
end for;

end method;

------------------------------------------------------------
method Cache.GetPosition(input RecordId: Framework.integer): Framework.integer
begin
--
--	Description : 	Searches the record in the cache and returns TRUE if found.
--
--	Type :	Concret
--
--	Parametres :	Input	-->	RecordId	:	Record id to be searched
--					Return	-->	TRUE : Found, FALSE : not found.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	31/05/1997	|	Creation.
--+

aResult, i : integer;
For aCach in Self.Objects do
	i = i + 1;
	if aCach.Record.Id = RecordId then
		aResult = i;
		exit;
	end if;
end for;

Return aResult;
end method;

------------------------------------------------------------
method Cache.Init
begin
--
--	Description : 	Initialization of the buffer
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
Objects = new;
LastId = 0;

end method;

------------------------------------------------------------
method Cache.IsInCache(input RecordId: Framework.long): Framework.boolean
begin
--
--	Description : 	Searches the record in the cache and returns TRUE if found.
--
--	Type :	Concret
--
--	Parametres :	Input	-->	RecordId	:	Record id to be searched
--					Return	-->	TRUE : Found, FALSE : not found.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	31/05/1997	|	Creation.
--+

aResult : Boolean = FALSE;
For aCach in Self.Objects do
	if aCach.Record.Id = RecordId then
		aResult = TRUE;
		exit;
	end if;
end for;

Return aResult;
end method;

------------------------------------------------------------
method Cache.Lock(copy input output aCacheDesc: DataAccessSrvBD.CacheDesc): Framework.boolean
begin
--
--	Description : 	Locks the object transmitted to the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input Output	--> aCacheDesc :	Container of the object to lock.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Result : Boolean=FALSE;
wfor:for obj in Objects do
	if obj.Record.Id = aCacheDesc.Record.Id then
		if Obj.lock then
			aCacheDesc.LockSessionId=Obj.LockSessionId;
			aCacheDesc.Lock = TRUE;
			Result = FALSE;
		else
			Obj.LockSessionId=aCacheDesc.LockSessionId;
			Obj.Lock = TRUE;
			aCacheDesc.Lock = TRUE;
			Result = TRUE;
		end if;
		exit wFor;
	end if;
End for;
Return Result;
end method;

------------------------------------------------------------
method Cache.QuickSort(input aSortCritera: Framework.TextData,
	input aRecords: Framework.Array of DataAccessSrvBD.CacheDesc,
	input Left: Framework.integer,
	input Right: Framework.integer)
begin
--
--	Description : 	Sorts the array using a Sort Critera with quicksort algorytm.
--					Copied from FShare Version 1.0, RandomSort project, it has been modified
--					to trait of any king of sort critera (any kind of attribute types, without
--					knowing the structure in the code).
--
--	Type :	Concret
--
--	Parametres :	Input	--> aSortCritera :	Container of the critera.
--					Input	-->	aRecordSelfDesc : Record with self description
--					Input	--> aRecords : Array of Records
--					Input	-->	Left : Left position
--					Input	-->	Right : Right Position
--
--	Pre-condition : The given records must be ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+
// The following is an example of the implementation of
// QuickSort in Forte.
//
// QuickSort is supposedly the more widely used algorithm.
// It is relatively simple, yet very efficient. QuickSort
// uses a divide-and-conquer method, where the array is
// partitioned into 2 parts, then sorting the parts
// independently. It requires a recursive algorithm.
//
// Again, I have copied the basic algorithm from the book
// Algorithm by Robert Sedgewick, published by Addison
// Wesley.


i, j : integer;
x, y : CacheDesc;

i = Left;
j = Right;

x = aRecords[(Left+Right)/2];

while (i<=j) do
	while Self.TstSortExpression(aSortCritera,(ObjectSelfDesc)(aRecords[i].Record),(ObjectSelfDesc)(x.Record)) and  (i<Right) do
		i = i+1;
	end while;
	
	while Self.TstSortExpression(aSortCritera,(ObjectSelfDesc)(x.Record),(ObjectSelfDesc)(aRecords[j].Record)) and (j>Left) do
		j = j-1;
	end while;
	
	if (i<=j) then 
		y = aRecords[i];
		aRecords[i] = aRecords[j];
		aRecords[j] = y;
		i = i+1;
		j = j-1;
	end if;
end while;

if (Left<j) then 
	QuickSort(aSortCritera,aRecords,Left,j);
end if;

if (i<Right) then
	QuickSort(aSortCritera,aRecords,i,Right);
end if;

end method;

------------------------------------------------------------
method Cache.QuickSort(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aRecords: Framework.Array of DataAccessSrvBD.CacheDesc,
	input Left: Framework.integer,
	input Right: Framework.integer)
begin
--
--	Description : 	Sorts the array using a Sort Critera with quicksort algorytm.
--					Copied from FShare Version 1.0, RandomSort project, it has been modified
--					to trait of any king of sort critera (any kind of attribute types, without
--					knowing the structure in the code).
--
--	Type :	Concret
--
--	Parametres :	Input	--> aSortCritera :	Container of the critera.
--					Input	-->	aRecordSelfDesc : Record with self description
--					Input	--> aRecords : Array of Records
--					Input	-->	Left : Left position
--					Input	-->	Right : Right Position
--
--	Pre-condition : The given records must be ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+
// The following is an example of the implementation of
// QuickSort in Forte.
//
// QuickSort is supposedly the more widely used algorithm.
// It is relatively simple, yet very efficient. QuickSort
// uses a divide-and-conquer method, where the array is
// partitioned into 2 parts, then sorting the parts
// independently. It requires a recursive algorithm.
//
// Again, I have copied the basic algorithm from the book
// Algorithm by Robert Sedgewick, published by Addison
// Wesley.


i, j : integer;
x, y : CacheDesc;

i = Left;
j = Right;

x = aRecords[(Left+Right)/2];

while (i<=j) do
	while Self.TstSortExpression(aField,aOperation,(ObjectSelfDesc)(aRecords[i].Record),(ObjectSelfDesc)(x.Record)) and  (i<Right) do
		i = i+1;
	end while;
	
	while Self.TstSortExpression(aField,aOperation,(ObjectSelfDesc)(x.Record),(ObjectSelfDesc)(aRecords[j].Record)) and (j>Left) do
		j = j-1;
	end while;
	
	if (i<=j) then 
		y = aRecords[i];
		aRecords[i] = aRecords[j];
		aRecords[j] = y;
		i = i+1;
		j = j-1;
	end if;
end while;

if (Left<j) then 
	QuickSort(aField,aOperation,aRecords,Left,j);
end if;

if (i<Right) then
	QuickSort(aField,aOperation,aRecords,i,Right);
end if;

end method;

------------------------------------------------------------
method Cache.Read: Framework.Array of DataAccessSrvBD.CacheDesc
begin
--
--	Description : 	Read all the records.
--
--	Type :	Concret
--
--	Parametres :	Return	-->	array of the records read.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

Return Self.Objects;
end method;

------------------------------------------------------------
method Cache.Read(input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input aFilterCritera: Framework.TextData,
	input aSortCritera: Framework.TextData): Framework.Array of DataAccessSrvBD.CacheDesc
begin
--
--	Description : 	Reads all the records and plays the filter critera on each record.
--					Then it returns an array of the records matching with the filter critera.
--
--	Type :	Concret
--
--	Parametres :	Input	-->	aRecordSelfDesc : Record to be tested.
--					Input	--> aFilterCritera 	: Container of the Filter critera.
--					Input	--> aSortCritera 	: Container of the Sort critera.
--					Return	-->	array of the matching records.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

aDataFiltered : Array of CacheDesc = new;

if aFilterCritera.Value <> '' then
	For aObj in Self.Objects do
		if Self.CriteraPlay(aCritera=aFilterCritera, aRecordSelfDesc=(ObjectSelfDesc)(aObj.Record)) then
			aDataFiltered.appendRow(Object=aObj);
		end if;
	end for;
else
	aDataFiltered = Self.Objects;
end if;

If aDataFiltered.Items = 0 then
	aDataFiltered = NIL;
Elseif aSortCritera.value <> '' then
	BegPos, EndPos, BegPos1, EndPos1 : integer;
	aTmpSortCritera : TextData = new;
	aTmpTxt, aTmpTxt1 : TextData = new;

	aTmpSortCritera = aSortCritera.clone(Deep=TRUE);

	-- Searching for * parameter and replacing it by all fields
	while not aTmpSortCritera.IsAtEnd() do
		if aTmpSortCritera.MoveToString(Source='(*') then
			BegPos = aTmpSortCritera.Offset;
			if aTmpSortCritera.MoveToString(Source=')', GoPast = TRUE, IgnoreCase = FALSE) then
				EndPos = aTmpSortCritera.Offset;
				aTmpTxt = aTmpSortCritera.CopyRange(StartOffSet = BegPos, EndOffSet=EndPos);
				aTmpTxt1.value = '';
				For SDesc in (ObjectSelfDesc)(Self.Objects[1].Record).SelfDesc do
					if aTmpTxt1.value <> '' then
						aTmpTxt1.concat(' AND ');
					end if;
					aTmpTxt1.Concat(aTmpTxt);
					aTmpTxt1.MoveToChar('*');
					BegPos1 = aTmpTxt1.Offset;
					EndPos1 = BegPos1 + 1;
					aTmpTxt1.ReplaceRange(Source=SDesc.ItemName, StartOffset = BegPos1, EndOffset = EndPos1);
				End For;
				aTmpSortCritera.ReplaceRange(Source=aTmpTxt1.Value, StartOffset = BegPos, EndOffset = EndPos);
			else
				exit;
			end if;
		end if;
		aTmpSortCritera.MoveNext;
	End while;
	Self.QuickSort(aTmpSortCritera, aDataFiltered, 1, aDataFiltered.Items);
end if;
Return aDataFiltered;
 
end method;

------------------------------------------------------------
method Cache.Read(input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input aFilterCritera: Framework.TextData): Framework.Array of DataAccessSrvBD.CacheDesc
begin
--
--	Description : 	Reads all the records and plays the filter critera on each record.
--					Then it returns an array of the records matching with the filter critera.
--
--	Type :	Concret
--
--	Parametres :	Copy Input	-->	aRecordSelfDesc : Record to be tested.
--					Copy Input	--> aFilterCritera :	Container of the critera.
--					Return	-->	array of the matching records.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

aDataFiltered : Array of CacheDesc = new;

For aObj in Self.Objects do
	if Self.CriteraPlay(aCritera=aFilterCritera, aRecordSelfDesc=(ObjectSelfDesc)(aObj.Record)) then
		aDataFiltered.appendRow(Object=aObj);
	end if;
end for;
If aDataFiltered.Items = 0 then
	Return NIL;
Else
	Return aDataFiltered;
end if; 
end method;

------------------------------------------------------------
method Cache.Read(input RecordId: Framework.integer): DataAccessSrvBD.CacheDesc
begin
--
--	Description : 	Reads all the records and returns the cachedesc for RecordId.
--
--	Type :	Concret
--
--	Parametres :	Input	-->	RecordId : Record.id to be tested.
--					Return	-->	The matching record.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

aResult : CacheDesc;

For aObj in Self.Objects do
	if aObj.Record.Id = RecordId then
		aResult = aObj;
		exit;
	end if;
end for;

Return aResult;

end method;

------------------------------------------------------------
method Cache.Sort(input aSortCritera: Framework.TextData)
begin
--
--	Description : 	Sorts the cache using a Sort Critera.
--					The Critera should have a syntax like :
--					(Att1>) AND (Att2<) : Attribute 1 Ascending and Attribute 2 Descending
--					(*>) AND (Att1<) : All attributes Ascending and attribute 1 Descending
--
--	Type :	Concret
--
--	Parametres :	Input	--> aSortCritera :	Container of the critera.
--
--	Pre-condition : The cache.Object.Record.Object must be an array of ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

BegPos, EndPos, BegPos1, EndPos1 : integer;
aTmpSortCritera : TextData = new;
aTmpTxt, aTmpTxt1 : TextData = new;
FlagSelfDescNIL : Boolean;

if Self.Objects.Items > 0 then
	aTmpSortCritera = aSortCritera.clone(Deep=TRUE);
	FlagSelfDescNIL = FALSE;
	if (ObjectSelfDesc)(Self.Objects[1].Record).SelfDesc = NIL then
		(ObjectSelfDesc)(Self.Objects[1].Record).SelfDesc = new();
		(ObjectSelfDesc)(Self.Objects[1].Record).DoResetSelfDesc();
		FlagSelfDescNIL = TRUE;
	end if;
	-- Searching for * parameter and replacing it by all fields
	while not aTmpSortCritera.IsAtEnd() do
		if aTmpSortCritera.MoveToString(Source='(*') then
			BegPos = aTmpSortCritera.Offset;
			if aTmpSortCritera.MoveToString(Source=')', GoPast = TRUE, IgnoreCase = FALSE) then
				EndPos = aTmpSortCritera.Offset;
				aTmpTxt = aTmpSortCritera.CopyRange(StartOffSet = BegPos, EndOffSet=EndPos);
				aTmpTxt1.value = '';
				For SDesc in (ObjectSelfDesc)(Self.Objects[1].Record).SelfDesc do
					if aTmpTxt1.value <> '' then
						aTmpTxt1.concat(' AND ');
					end if;
					aTmpTxt1.Concat(aTmpTxt);
					aTmpTxt1.MoveToChar('*');
					BegPos1 = aTmpTxt1.Offset;
					EndPos1 = BegPos1 + 1;
					aTmpTxt1.ReplaceRange(Source=SDesc.ItemName, StartOffset = BegPos1, EndOffset = EndPos1);
				End For;
				aTmpSortCritera.ReplaceRange(Source=aTmpTxt1.Value, StartOffset = BegPos, EndOffset = EndPos);
			else
				exit;
			end if;
		end if;
		aTmpSortCritera.MoveNext;
	End while;
	Self.QuickSort(aTmpSortCritera, Self.Objects, 1, Self.Objects.Items);
	if FlagSelfDescNIL then
		(ObjectSelfDesc)(Self.Objects[1].Record).SelfDesc = NIL;
	end if;

end if;
Return;

end method;

------------------------------------------------------------
method Cache.TstExpression(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aValue: Framework.TextData,
	input aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean
begin
--
--	Description : 	Test the expression on the record.
--
--	Type :	Concret
--
--	Parametres :	Input	--> aField :	Container of the field to be tested.
--					Input	-->	aOperation : Operation to be played.
--					Input	-->	aValue : value to be tested.
--					Input	-->	aRecordSelfDesc : record on which the test must be played. 
--					Return	-->	boolean : TRUE = OK, FALSE = KO.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Cache.CriteraPlay
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+


aResult : Boolean = FALSE;
FieldRef : DataValue = new;
For SDesc in aRecordSelfDesc.SelfDesc do
	if SDesc.ItemName = aField.Value then
		FieldRef = (DataValue)(SDesc.ItemReference);
	end if;
End for;
if FieldRef <> NIL then
	Case aOperation is
		When 0 do -- Ope : =
			if FieldRef.TextValue.IsEqual(Source=aValue.Value,IgnoreCase = TRUE) then
				aResult = TRUE;
			else
				aResult = FALSE;
			end if;
		When 1 do -- Ope : <
			Begin 
				if FieldRef.TextValue.DoubleValue < aValue.TextValue.DoubleValue then
						aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef.TextValue.Value < aValue.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 2 do -- Ope : <=
			Begin
				if FieldRef.TextValue.DoubleValue <= aValue.TextValue.DoubleValue then
					aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef.TextValue.Value <= aValue.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 3 do -- Ope : >
			Begin
				if FieldRef.TextValue.DoubleValue > aValue.TextValue.DoubleValue then
					aResult = TRUE;	
				else
					aResult = FALSE;	
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef.TextValue.Value > aValue.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 4 do -- Ope : >=
			Begin
				if FieldRef.TextValue.DoubleValue >= aValue.TextValue.DoubleValue then
					aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef.TextValue.Value >= aValue.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 5 do -- Ope : <>
			if FieldRef.TextValue.IsEqual(Source=aValue.Value,IgnoreCase = TRUE) then
				aResult = FALSE;
			else
				aResult = TRUE;
			end if;
		else
			aResult = FALSE;
	End Case;
End if;
Return aResult;
end method;

------------------------------------------------------------
method Cache.TstSortExpression(input aField: Framework.TextData,
	input aOperation: Framework.integer,
	input aRecord1: DataAccessSrvBD.ObjectSelfDesc,
	input aRecord2: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean
begin
--
--	Description : 	Test the sort expression on the record.
--
--	Type :	Concret
--
--	Parametres :	Input	--> aField :	Container of the field to be tested.
--					Input	-->	aOperation : Operation to be played.
--					Input	-->	aRecord1 : record on which the test must be played.
--					Input	-->	aRecord2 : record on which the test must be played. 
--					Return	-->	boolean : TRUE = OK, FALSE = KO.
--
--	Pre-condition : The given record must be a ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Cache.CriteraPlay
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+


aResult : Boolean = FALSE;
FieldRef1 : DataValue = new;
FieldRef2 : DataValue = new;
FlagSelfDesc1, FlagSelfDesc2 : Boolean = FALSE; 
if aRecord1.SelfDesc.Items = 0 then
	aRecord1.DoResetSelfDesc();
	FlagSelfDesc1 = TRUE;
end if;
if aRecord2.SelfDesc.Items = 0 then
	aRecord2.DoResetSelfDesc();
	FlagSelfDesc2 = TRUE;
end if;

For SDesc in aRecord1.SelfDesc do
	if SDesc.ItemName = aField.Value then
		FieldRef1 = (DataValue)(SDesc.ItemReference);
	end if;
End for;
For SDesc in aRecord2.SelfDesc do
	if SDesc.ItemName = aField.Value then
		FieldRef2 = (DataValue)(SDesc.ItemReference);
	end if;
End for;
if FieldRef1 <> NIL and FieldRef2 <> NIL then
	Case aOperation is
		When 0 do -- Ope : =
			if FieldRef1.TextValue.IsEqual(Source=FieldRef2.TextValue.Value,IgnoreCase = TRUE) then
				aResult = TRUE;
			else
				aResult = FALSE;
			end if;
		When 1 do -- Ope : <
			Begin 
				if FieldRef1.TextValue.DoubleValue < FieldRef2.TextValue.DoubleValue then
					aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef1.TextValue.Value < FieldRef2.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 2 do -- Ope : <=
			Begin
				if FieldRef1.TextValue.DoubleValue <= FieldRef2.TextValue.DoubleValue then
					aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef1.TextValue.Value <= FieldRef2.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 3 do -- Ope : >
			Begin
				if FieldRef1.TextValue.DoubleValue > FieldRef2.TextValue.DoubleValue then
					aResult = TRUE;	
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef1.TextValue.Value > FieldRef2.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 4 do -- Ope : >=
			Begin
				if FieldRef1.TextValue.DoubleValue >= FieldRef2.TextValue.DoubleValue then
					aResult = TRUE;
				else
					aResult = FALSE;
				end if;
			Exception
				When e : DataTypeException do
					if FieldRef1.TextValue.Value >= FieldRef2.TextValue.Value then
						aResult = TRUE;
					else
						aResult = FALSE;
					end if;
					
			End;
		When 5 do -- Ope : <>
			if FieldRef1.TextValue.IsEqual(Source=FieldRef2.TextValue.Value,IgnoreCase = TRUE) then
				aResult = FALSE;
			else
				aResult = TRUE;
			end if;
		else
			aResult = FALSE;
	End Case;
End if;
if FlagSelfDesc1 then
	aRecord1.SelfDesc.clear();
end if;
if FlagSelfDesc2 then
	aRecord2.SelfDesc.clear();
end if;

Return aResult;
end method;

------------------------------------------------------------
method Cache.TstSortExpression(input aSortCritera: Framework.TextData,
	input aRecord1: DataAccessSrvBD.ObjectSelfDesc,
	input aRecord2: DataAccessSrvBD.ObjectSelfDesc): Framework.boolean
begin
--
--	Description : 	Tests if Record1 is lower then Record2 regarding of the sort critera.
--					The sort Critera should be like '(Attribute1 >) AND (Attribute2 <)'.
--					if the critera is true between Record1 and Record2 then TRUE is returned.
--
--	Type :	Concret
--
--	Parametres :	Input	--> aSortCritera :	Container of the critera.
--					Input	--> aRecord1 : Left part of the test
--					Input	--> aRecord2 : Right part of the test
--
--	Pre-condition : The given records must be ObjectSelfDesc 
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	8/06/1997	|	Creation.
--+

-- Initialization of the variables

aResult : Boolean = FALSE;
aTmpResult : Integer;
BegPos : Integer;
EndPos : Integer;
BegPos1 : Integer;
EndPos1 : Integer;
BegPos = aSortCritera.Offset;
EndPos = aSortCritera.Offset;
aField : TextData = new;
aOperation : Integer; -- 0: =, 1:<, 2:<=, 3:>, 4: >= , 5 : <>
aTmpOpe : TextData = new;
aTmpTxt : TextData = new;
aSortCritera.Trimleading;
aSortCritera.TrimTrailing;
aSortCritera.Offset=0;
FlagSelfDesc1, FlagSelfDesc2 : Boolean = FALSE; 
if aRecord1.SelfDesc = NIL then
	aRecord1.SelfDesc = new();
end if;
if aRecord1.SelfDesc.Items = 0 then
	aRecord1.DoResetSelfDesc();
	FlagSelfDesc1 = TRUE;
end if;
if aRecord2.SelfDesc = NIL then
	aRecord2.SelfDesc = new();
end if;
if aRecord2.SelfDesc.Items = 0 then
	aRecord2.DoResetSelfDesc();
	FlagSelfDesc2 = TRUE;
end if;

xWhi:While not aSortCritera.IsAtEnd() do
	
	-- syntax analysis
	
	if aSortCritera.IsChar(ListOfChars='(') then
		aSortCritera.MoveNext;
		BegPos = aSortCritera.Offset;
		aSortCritera.MoveToChar(ListofChars = ')');
		EndPos = aSortCritera.Offset;
		aTmpTxt = aSortCritera.CopyRange(StartOffSet = BegPos, EndOffSet = EndPos);
		
		-- analysis of the basic expression
		aTmpTxt.Trimleading;
		aTmpTxt.TrimTrailing;
		BegPos1 = aTmpTxt.Offset;
		EndPos1 = aTmpTxt.Offset;
		aField = '';
		aTmpOpe = '';
		aTmpResult = 0;
		While not aTmpTxt.IsAtEnd() and aTmpResult = 0 do
			aTmpTxt.MoveNext;
			
			if aTmpTxt.IsAtEnd() then
				-- Converts the operation
				If aTmpOpe.Value = '<' then
					aOperation = 3;
				elseif aTmpOpe.Value = '<=' then
					aOperation = 4;
				elseif aTmpOpe.Value = '>' then
					aOperation = 1;
				elseif aTmpOpe.Value = '>=' then
					aOperation = 2;
				elseif aTmpOpe.Value = '<>' then
					aOperation = 5;
				else
					aOperation = 0;
				end if;
				-- The element is decomposed : call the test method for expression
				If TstSortExpression(aField=aField, aOperation = aOperation, aRecord1 = aRecord1, aRecord2 = aRecord2) then
					aTmpResult = 0;
				else
					aOperation = 0;
					If TstSortExpression(aField=aField, aOperation = aOperation, aRecord1 = aRecord1, aRecord2 = aRecord2) then
						aTmpResult = 1;
					else
						aTmpResult = 2;
					end if;
				end if;
				BegPos1 = EndPos1;
				EndPos1 = aTmpTxt.Offset;
			Elseif aTmpTxt.IsChar(ListOfChars='=><') and aField.value = '' then
				EndPos1 = aTmpTxt.Offset;
				aField = aTmpTxt.CopyRange(StartOffSet = BegPos1, EndOffSet = EndPos1);
				BegPos1 = EndPos1;
				aTmpTxt.MoveNext;
				EndPos1 = aTmpTxt.Offset;
				if aTmpTxt.IsChar(ListOfChars='=><') and not aTmpTxt.IsAtEnd() then
					aTmpTxt.MoveNext;
					EndPos1 = aTmpTxt.Offset;
				end if;
				aTmpOpe.Concat(aTmpTxt.CopyRange(StartOffSet = BegPos1, EndOffSet = EndPos1));
				aTmpTxt.MovePrevious;
			end if;
		End While;
		
	end if;
	Case aTmpResult is
		When 0 do
			aResult = TRUE;
			exit xWhi;
		When 1 do
			aResult = FALSE;
		When 2 do
			aResult = FALSE;
			exit xWhi;
	end case;
	aSortCritera.MoveNext;
	BegPos = aSortCritera.Offset;
End While;
if FlagSelfDesc1 then
	aRecord1.SelfDesc.Clear();
end if;
if FlagSelfDesc2 then
	aRecord2.SelfDesc.clear();
end if;
Return aResult;
end method;

------------------------------------------------------------
method Cache.Unlock(copy input output aCacheDesc: DataAccessSrvBD.CacheDesc): Framework.boolean
begin
--
--	Description : 	Unlocks the object transmitted to the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input Output	--> aCacheDesc :	Container of the object to unlock.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Result : Boolean=FALSE;
wfor:for obj in Objects do
	if obj.Record.Id = aCacheDesc.Record.Id and Obj.LockSessionId.value = aCacheDesc.LockSessionId.value then
		if Obj.lock then 
			Obj.LockSessionId.value=0;
			Obj.Lock = FALSE;
			Result =TRUE;
		else
			Result = FALSE;
		end if;
		exit wFor;
	end if;
End for;
aCacheDesc.LockSessionId.value=0;
aCacheDesc.Lock = FALSE;
Return Result;
end method;

------------------------------------------------------------
method Cache.Update(input aCacheDesc: DataAccessSrvBD.CacheDesc)
begin
--
--	Description : 	Updates the object transmitted to the buffer.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aCacheDesc :	Container of the object to Update.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

For Obj in Self.Objects do
	if aCacheDesc.Record.Id = Obj.Record.Id then
		Obj.Record = aCacheDesc.Record;
		Obj.Lock = FALSE;
		Obj.LockSessionId.Value=0;
		exit;
	end if;
End for;

end method;

------------------------------------------------------------
method CacheDesc.Init
begin
--
--	Description : 	Initialization of instance of cache descriptor.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
Lock = FALSE;
LockSessionId = new;
Record = new;
end method;

------------------------------------------------------------
method DataAvailabilityExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataAvailabilityException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataConcurencyExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataConcurencyException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataContext.Init
begin
super.Init();

end method;

------------------------------------------------------------
method DataIntegrityExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataIntegrityException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataSecurityExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataSecurityException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DataServiceDesc.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransData : Communication structure..
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Action');

-- Declarations
unResultat	: Object;
aStopWatch	: StopWatch;
aTimesplit	: Integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aStopWatch = new();
	Self.AddTimeWatch(aTransData.TransActionService);
	aStopWatch.Fire();
end if;

	Case aTransData.TransActionService is
		when ACT_STD_APPEND do
		unResultat=Append(aTransData);
		aTransData.TransActionService = ACT_STD_APPEND;

		when ACT_STD_UPDATE do
		unResultat=Update(aTransData);
		aTransData.TransActionService = ACT_STD_UPDATE;

		when ACT_STD_DELETE do
		Delete(aTransData);
		aTransData.TransActionService = ACT_STD_DELETE;
			
		when ACT_STD_READ do
		unResultat = Read(aTransData);
		aTransData.TransActionService = ACT_STD_READ;
			
		else do 
			-- Traitements des autres cas au niveau concret.
			unResultat=DoAction(aTransData, aTransOrigin);
	end case;
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTransData.TransActionService, aTimeSplit);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Action : End');
Return unResultat;

Exception
	When e : GenericException do
		if (aStopWatch <> NIL) then
			aStopWatch.Split();
		end if;	
		Self.TraceExc(e, 'DataServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.Append(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to append.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--  D. NGUYEN   |   03/07/1997  |   Mise en forme.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagAppend.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Append');

-- Declarations
unResult : Object;
-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreAppend(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

unResult = Self.AppendAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Append : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Append');
		Raise;
 

end method;

------------------------------------------------------------
method DataServiceDesc.AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to append.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc.AppendByRef
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.AppendAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.AppendAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.AppendAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckConsDataServiceDesc: Framework.boolean
begin
--
--	Description : 	Checks the state of the object.
--
--	Type :	Abstrait
--
--	Parametres :	RETURN	--> TRUE :	OK
--								FALSE:	KO
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckConsDataServiceDesc');

-- Declarations
unResult : Boolean = TRUE;

-- Si les pre-conditions ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckConsDataServiceDesc : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckConsDataServiceDesc');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Append.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	Instance à créer
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreAppend');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagAppend then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreAppend --> Action Append déclenchée alors que FlagAppend = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreAppend : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreAppend');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreAppendAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.AppendAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreDelete(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Delete.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	Instance à détruire
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreDelete');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagDelete then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreDelete --> Action Delete déclenchée alors que FlagDelete = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreDelete : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreDelete');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreDeleteAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.DeleteAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Read.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	paramêtres de lecture
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreRead');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagRead then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreRead --> Action Read déclenchée alors que FlagRead = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreRead : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreRead');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreUpdate(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Update.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	Instance à mettre à jour
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreUpdate');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagUpdate then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreUpdate --> Action Update déclenchée alors que FlagUpdate = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreUpdate : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreUpdate');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.CheckPreUpdateAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.UpdateAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceDesc.Delete(input aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description : 	Deletes the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to delete.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagDelete.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Delete');

-- Declarations

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreDelete(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

DeleteAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Delete : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Delete');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.DeleteAction(input aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description : 	Deletes the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to delete.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc.DeleteByRef
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.DeleteAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.DeleteAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.DeleteAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 29/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.DoAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.Init
begin
--
--	Description : 	Initialization of the class.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method DataServiceDesc.Read(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Read the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Return	--> aObject :	Object to read.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--	D. NGUYEN	|	25/10/1996	|	Including optimized cache.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagRead.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Read');

-- Declarations

aObject : Object = aTransData;

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreRead(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

aResult : Array of Object = ReadAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Read : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Read');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Reads the Data Flow and transmits it.
--
--	Type :	Abstrait
--
--	Parametres :	Input Output	--> aObject :	Container of the flow.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc.ReadByRef
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.ReadAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.ReadAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.ReadAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.Update(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Updates the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to update.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--  JB BRIAUD   |   29/05/1997  |   Creation.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagUpdate.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Update');

-- Declarations
unResult : Object;

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreUpdate(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

unResult=UpdateAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Update : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Update');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.UpdateAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Updates the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to update.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc.UpdateByRef
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.UpdateAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.UpdateAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.UpdateAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.Write(input aTransObject: Framework.Object)
begin
--
--	Description : 	Writes the object transmitted.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to write.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServices
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Write');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

WriteAction(aTransObject);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Write : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Write');
		Raise;
end method;

------------------------------------------------------------
method DataServiceDesc.WriteAction(input aObject: Framework.Object)
begin
--
--	Description : 	Writes the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to write.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc.WriteByRef
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.WriteAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.WriteAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.WriteAction');
		Raise;
end method;

------------------------------------------------------------
method DataServiceMgrDesc.AfterSyncServices
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceMgrDesc.AfterSyncServices');
/* JBB
if Dependances <> NIL then
	if Dependances.items > 0 then
		TmpDbSessionMgr : DbSessionMgrDesc;
		For uneDependance in Dependances do
			if uneDependance.Isa(Type=DbSessionMgrDesc) then
				TmpDbSessionMgr = (DbSessionMgrDesc)(uneDependance);
				exit;
			end if;
		End for;
		For unDataService in Self.Instances do
			if unDataService.aObject.IsA(Type=DataServiceSqlDesc) then
				if TmpDbSessionMgr <> NIL then
					(DataServiceSqlDesc)(unDataService.aObject).leDbSessionMgr = TmpDbSessionMgr;
					(DataServiceSqlDesc)(unDataService.aObject).StartService();
				else
					unExc : GenericExc = new;
					unExc.Message = new(value='DbSessionMgr manquant');
					Self.TraceExc(unExc,'DataServiceMgrDesc.AfterSyncServices');
					Raise unExc;
				end if;
			end if;
		end for;
	end if;
end if;
*/

Self.ObtenirDBSession();

-- le DataServiceMgrDesc donne sa DBSession aux DataServiceSQLDesc qu'il héberge.
For unDataService in Self.Instances do
	if unDataService.aObject.IsA(Type=DataServiceSqlDesc) then
		(DataServiceSqlDesc)(unDataService.aObject).laDBSession = Self.laDBSession;
		(DataServiceSqlDesc)(unDataService.aObject).StartService();
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceMgrDesc.AfterSyncServices : End');
Return;
end method;

------------------------------------------------------------
method DataServiceMgrDesc.Init
begin
--
--	Description : 	Init.
--
--	Type :	Abstrait
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : this class is used by the concret BusinessServices to type the used manager.
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method DataServiceMgrDesc.ObtenirDBSession
begin
--
--	Description : Renseigne l'attribut Self.DBSession
--	C'est à dire, obtenir la DBSession du SO adéquat.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  J BRIAUD  | 23/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.ObtenirDBSession');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if not Self.FlagDbResource then
	For unService in Dependances do
		if unService.IsA(Type=DBSession) then
			Self.laDBSession = (DbSession)(unService);
			exit;
		end if;
	end for;
else
	-- Dans l'autre cas, l'atttribut Self.laDBSession
	-- est affecté dans la méthode SyncService().
end if;

-- Le tronçon de code suivant permet de tracer
-- les DBSession au demarrage.
-- Il n'est pas utile en production.
/*
if Self.laDBSession.DbVendorType = DB_VT_ORACLE then
	Self.TracerDBSession();
end if;
*/

-- Fin du traitement

-- Verification des post-conditions
	if Self.laDbSession = NIL then
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.ObtenirDBSession : DbSession = NIL');
	else
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.ObtenirDBSession : DbSession <> NIL');
	end if;
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.ObtenirDBSession : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.ObtenirDBSession');
		Raise;
end method;

------------------------------------------------------------
method DataServiceMgrDesc.SyncServices
begin
--
--	Description : 	Synchronization of the service objects due at the startup of the current service.
--
--	Type :	Abstrait
--
--	Parametres :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Startup of the application
--
--	Historique :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceMgrDesc.SyncServices');
Dependances.Clear();
DoInitService();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceMgrDesc.SyncServices : Dependances -->');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, Dependances.Items);
For unService in Dependances do
	if unService = NIL then
		e : DistributedAccessException = new;
		Raise e;
	elseif (unService.IsA(Type=ServiceMgrDesc) and not (ServiceMgrDesc)(unService).ServiceStarted) or (unService.IsA(Type=ServiceDesc) and not (ServiceDesc)(unService).ServiceStarted) then
		e : DistributedAccessException = new;
		Raise e;
	elseif unService.IsA(Type=DbSession) then
		Self.laDbSession = (DbSession)(unService);
		if Self.laDBSession = NIL then
			e : DistributedAccessException = new;
			Raise e;
		end if;
	elseif unService.IsA(Type=DbResourceMgr) then
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceMgrDesc.SyncServices : DbResourceMgr');
		-- TmpDbSession : DbSession;
		Self.laDBSession=(DbResourceMgr)(unService).ConnectDB(Self.laResourceName,
										     Self.laResourceUserName, 
										     Self.laResourceUserPassword);
		if Self.laDBSession = NIL then
			e : DistributedAccessException = new;
			Raise e;
		end if;
	else
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceMgrDes.SyncServices : ?????????');
	end if;
end for;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceMgrDes.SyncServices : End');

Return;

Exception
	When e:DistributedAccessException do
		Task.Delay(1000);
		Self.SyncServices();
	When e: GenericException do
		Self.TraceExc(e,'DataServiceMgrDes.SyncServices');
		Raise;

end method;

------------------------------------------------------------
method DataServiceMgrDesc.TracerDBSession
begin
--
--	Description :	Tracer l'obtention des DBSessions
--  en renseignant une table de trace dans ORACLE.
--  Pour l'instant (07/07/1997) execution facultative.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  J BBRIAUD | 07/07/1997  |   Version Initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.TracerDBSession');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

	if Self.laDbSession = NIL then
		-- Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.ObtenirDBSession : DbSession = NIL');
		Task.Part.LogMgr.PutLine('- DataServiceMgrDesc.TracerDBSession : DbSession = NIL');
	else
		-- Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.ObtenirDBSession : DbSession <> NIL');
		Task.Part.LogMgr.PutLine('- DataServiceMgrDesc.TracerDBSession : DbSession <> NIL');
		Begin transaction
			sql insert into SID_FORTE
				select userenv('sessionid') from DUAL
			on session Self.laDBSession;
		end transaction;
	end if;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.TracerDBSession : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.TracerDBSession');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Insert an occurence in the relationnal database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to insert
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	07/06/1997	|	Création.
--  JB BRIAUD	|	09/04/1998	|	Correction du bug des séquences a grande valeur.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSqlDesc.AppendAction');

LastId : Integer;
TmpSqlTxt : TextData=new();
TmpSQLHdle : DbStatementHandle;
TmpSqlInDesc, TmpSqlOutDesc : DbDataSet;
TmpSQLType : integer;
unResult : CacheDesc;

aObject : Object = aTransData.TransObject;
-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreAppendAction(aObject);
End if;
-- Fin de verification des pre-conditions
TmpTxt : TextData = new;
unCacheDesc : CacheDesc = (CacheDesc)(aObject);
unCacheDesc.Record.IdUtlQqo = unCacheDesc.IdUtl;
unCacheDesc.Record.DtMajQqo.setCurrent();
if Self.laDbSession.DbVendorType = DB_VT_ORACLE then
	TmpSqlTxt = new(value='Select ');
	TmpSqlTxt.concat(Self.ClauseFrom);
	TmpSqlTxt.concat('Id.NextVal as LastId From DUAL');
	Begin Transaction
		TmpSQLHdle = Self.laDBSession.Prepare(
			TmpSQLTxt,
			TmpSQLInDesc,
			TmpSQLType);
		Self.laDBSession.Select(TmpSQLHdle, TmpSQLInDesc, TmpSQLOutDesc, 1);
		Self.laDbSession.RemoveStatement(TmpSQLHdle);
	end transaction;

	LastId = (DoubleNullable)(TmpSQLOutDesc.GetValue('LastId')).Value;

	Self.AppendSQLInDesc.SetValue(ColumnName = ':Id', Value=LastId);
	unCacheDesc.Record.Id = LastId;
end if;
Self.AppendSQLInDesc.SetValue(ColumnName = ':DtMajQqo', Value=unCacheDesc.Record.DtMajQqo); 
Self.AppendSQLInDesc.SetValue(ColumnName = ':IdUtlQqo', Value=unCacheDesc.Record.IdUtlQqo); 

unObjectSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(unCacheDesc.Record);
if unObjectSelfDesc.SelfDesc = NIL then
	 unObjectSelfDesc.SelfDesc = new();
end if;

// JBB : il manque if unObjectSelfDesc.SelfDesc.Items = 0 ??????
unObjectSelfDesc.DoResetSelfDesc();

For unAttribut in unObjectSelfDesc.selfDesc do
	TmpTxt.setValue(':');
	TmpTxt.Concat(unAttribut.ItemName);
	if unAttribut.ItemReference.IsA(Type=DataValue) then
		Self.AppendSQLInDesc.SetValue(ColumnName = TmpTxt.Value, Value=(DataValue)(unAttribut.ItemReference));
	end if;
End For;

Begin Transaction
	Self.laDbSession.Execute(StatementHandle=AppendSQLHdle, inputDataSet=AppendSQLInDesc);
End Transaction;

if not Self.laDbSession.DbVendorType = DB_VT_ORACLE then
	TmpSqlTxt = new(value='Select Id as LastId From ');
	TmpSqlTxt.Concat(Self.ClauseFrom);
	TmpSqlTxt.Concat(' where IdUtlQqo = ');
	TmpSqlTxt.Concat(unCacheDesc.Record.IdUtlQqo);
	TmpSqlTxt.Concat(' and DtMajQqo = :DateRef ');
	TmpSQLHdle = Self.laDBSession.Prepare(
		TmpSQLTxt,
		TmpSQLInDesc,
		TmpSQLType);
	DateRef : DateTimeNullable = unCacheDesc.Record.DtMajQqo;
	TmpSqlInDesc.SetValue(':DateRef',DateRef);
	Self.laDBSession.Select(TmpSQLHdle, TmpSQLInDesc, TmpSQLOutDesc, 100);
	Self.laDbSession.RemoveStatement(TmpSQLHdle);
	unCacheDesc.Record.Id = TmpSQLOutDesc.GetValue('LastId').TextValue.IntegerValue;
end if;

unResult = unCacheDesc;
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.AppendAction : End');

Return unResult;

Exception
	-- Raise Database exceptions
	When e : GenericException do
		Task.Part.LogMgr.PutLine(AppendSqlText);
		Self.TraceExc(e, 'DataServiceSqlDesc.AppendAction');
		Raise;

/*
	-- if an index error occurs raise an "ImplementationExc"
	when e : DBOperationException do
		exc : ImplementationExc = new;
		exc.severity = SP_ER_USER;
		exc.Message = e.message;
		Transaction.abort;
		-- call the AlertManager de Bernie
		raise exc;
		
	when e : DBResourceException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		raise e;

	When e: GenericException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		Return;
*/		
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerAppendSQL
begin
--
--	Description : Générer le code SQL de l'action APPEND.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerAppendSQL');

-- Declarations

laRequete : TextData = New();
TmpTxt : TextData;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if Self.laDbSession.DbVendorType = DB_VT_ORACLE then
	laRequete = 'insert into ';
	laRequete.Concat(Self.ClauseFrom);
	laRequete.Concat(' (Id,IdUtlQqo,DtMajQqo,');
	if Self.ClauseSelect = '' then 
		-- Solution à partir du SelfDesc
		
		Self.RecordInstance.DoResetAttributes();
		if Self.RecordInstance.SelfDesc = NIL then
			 Self.RecordInstance.SelfDesc = new();
		end if;
		Self.RecordInstance.DoResetSelfDesc();
		AttributesText : TextData = new;
		For unAttribut in Self.RecordInstance.SelfDesc do
			if unAttribut.ItemReference.IsA(Type=DataValue) then
				AttributesText.Concat(unAttribut.ItemName);
				AttributesText.concat(',');
			end if;
		end for;
		laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
	else
		laRequete.Concat(Self.ClauseSelect);
	end if;
	laRequete.Concat(') values (:Id,:IdUtlQqo,:DtMajQqo,');
else
	laRequete = 'insert into ';
	laRequete.Concat(Self.ClauseFrom);
	laRequete.Concat(' (IdUtlQqo,DtMajQqo,');
	if Self.ClauseSelect = '' then 
		-- Solution à partir du SelfDesc
		
		Self.RecordInstance.DoResetAttributes();
		if Self.RecordInstance.SelfDesc = NIL then
			 Self.RecordInstance.SelfDesc = new();
		end if;
		Self.RecordInstance.DoResetSelfDesc();
		AttributesText : TextData = new;
		For unAttribut in Self.RecordInstance.SelfDesc do
			if unAttribut.ItemReference.IsA(Type=DataValue) then
				AttributesText.Concat(unAttribut.ItemName);
				AttributesText.concat(',');
			end if;
		end for;
		laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
	else
		laRequete.Concat(Self.ClauseSelect);
	end if;
	laRequete.Concat(') values (:IdUtlQqo,:DtMajQqo,');
end if;
Self.RecordInstance.DoResetAttributes();
if Self.RecordInstance.SelfDesc = NIL then
	 Self.RecordInstance.SelfDesc = new();
end if;
Self.RecordInstance.DoResetSelfDesc();
AttributesText : TextData = new;
For unAttribut in Self.RecordInstance.SelfDesc do
	if unAttribut.ItemReference.IsA(Type=DataValue) then
		AttributesText.Concat(':');
		AttributesText.Concat(unAttribut.ItemName);
		AttributesText.concat(',');
	end if;
end for;
laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
laRequete.Concat(' )');
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerAppendSQL : ');
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);
Self.AppendSQLText = laRequete.Value;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerAppendSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerAppendSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerDeleteSQL
begin
--
--	Description : Générer le code SQL de l'action DELETE
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerDeleteSQL');

-- Declarations

laRequete : TextData = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

laRequete = 'delete from ';
laRequete.Concat(Self.ClauseFrom);
laRequete.Concat(' where (id = :Id and idutlqqo = :IdUtlQqo and dtmajqqo = :DtMajQqo)');

Self.DeleteSQLText = laRequete.Value;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerDeleteSQL : ');
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerDeleteSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerDeleteSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerReadAllSQL
begin
--
--	Description : Générer le code SQL de l'action ReadAll.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerReadAllSQL');

-- Declarations

laRequete : TextData = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

laRequete = 'select Id, DtMajQqo, IdUtlQqo, ';
if Self.ClauseSelect = '' then 
	-- Solution à partir du SelfDesc
	
	Self.RecordInstance.DoResetAttributes();
	if Self.RecordInstance.SelfDesc = NIL then
		 Self.RecordInstance.SelfDesc = new();
	end if;
	Self.RecordInstance.DoResetSelfDesc();
	AttributesText : TextData = new;
	For unAttribut in Self.RecordInstance.SelfDesc do
		if unAttribut.ItemReference.IsA(Type=DataValue) then
			AttributesText.Concat(unAttribut.ItemName);
			AttributesText.concat(',');
		end if;
	end for;
	laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
else
	laRequete.Concat(Self.ClauseSelect);
end if;
laRequete.Concat(' from ');
laRequete.Concat(Self.ClauseFrom);
if Self.ClauseOrderBy <> '' then
	laRequete.Concat(' order by ');
	laRequete.Concat(Self.ClauseOrderBy);
end if;
Self.ReadAllSQLText = laRequete.Value;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadAllSQL : ');
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadAllSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerReadAllSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerReadIntCtxtSQL(input pTransData: DataAccessSrvBD.TransIntCtxt): Framework.string
begin
--
--	Description : Générer le code SQL de l'action READ.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerReadInCtxtSQL');

-- Declarations

laRequete : TextData = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

laRequete = 'select id, dtmajqqo, idutlqqo, ';
if Self.ClauseSelect = '' then 
	-- Solution à partir du SelfDesc
	
	Self.RecordInstance.DoResetAttributes();
	if Self.RecordInstance.SelfDesc = NIL then
		 Self.RecordInstance.SelfDesc = new();
	end if;
	Self.RecordInstance.DoResetSelfDesc();
	AttributesText : TextData = new;
	For unAttribut in Self.RecordInstance.SelfDesc do
		if unAttribut.ItemReference.IsA(Type=DataValue) then
			AttributesText.Concat(unAttribut.ItemName);
			AttributesText.concat(',');
		end if;
	end for;
	laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
else
	laRequete.Concat(Self.ClauseSelect);
end if;
laRequete.Concat(' from ');
laRequete.Concat(Self.ClauseFrom);
if pTransData.aDataContext.SelfDesc = NIL then
	laRequete.Concat('');
elseif pTransData.aDataContext.SelfDesc.Items = 0 then
	laRequete.Concat('');
else
	laRequete.Concat(' where ');
	AttributesText : TextData = new;
	For unAttribut in pTransData.aDataContext.SelfDesc do
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- DataServiceSQLDesc.CalculerReadInCtxtSQL : unAttribut.ItemName=');
		Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, unAttribut.ItemName);
		if unAttribut.ItemReference.IsA(Type=DataValue) then
			AttributesText.Concat(unAttribut.ItemName);
			AttributesText.concat(' = ');
		end if;
		if unAttribut.ItemReference.IsA(Type=IntegerData) then
			AttributesText.Concat((IntegerData)(unAttribut.ItemReference).Value);
		elseif unAttribut.ItemReference.IsA(Type=NumericData) then
			AttributesText.Concat((NumericData)(unAttribut.ItemReference).DoubleValue);
		else
			AttributesText.Concat('''');
			AttributesText.Concat((DataValue)(unAttribut.ItemReference).TextValue.Value);
			AttributesText.Concat('''');
		end if;
		
		AttributesText.Concat(' and ');
		
	end for;
	laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-5));
end if;
if Self.ClauseOrderBy <> '' then
	laRequete.Concat(' order by ');
	laRequete.Concat(Self.ClauseOrderBy);
end if;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadInCtxtSQL : ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadInCtxtSQL : End');

Return laRequete.Value;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerReadInCtxtSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerReadSQL
begin
--
--	Description : Générer le code SQL de l'action READ.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerReadSQL');

-- Declarations

laRequete : TextData = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

laRequete = 'select id, dtmajqqo, idutlqqo, ';
if Self.ClauseSelect = '' then 
	-- Solution à partir du SelfDesc
	
	Self.RecordInstance.DoResetAttributes();
	if Self.RecordInstance.SelfDesc = NIL then
		 Self.RecordInstance.SelfDesc = new();
	end if;
	Self.RecordInstance.DoResetSelfDesc();
	AttributesText : TextData = new;
	For unAttribut in Self.RecordInstance.SelfDesc do
		if unAttribut.ItemReference.IsA(Type=DataValue) then
			AttributesText.Concat(unAttribut.ItemName);
			AttributesText.concat(',');
		end if;
	end for;
	laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
else
	laRequete.Concat(Self.ClauseSelect);
end if;
laRequete.Concat(' from ');
laRequete.Concat(Self.ClauseFrom);
if Self.ClauseWhere <> '' then
	laRequete.Concat(' where ');
	laRequete.Concat(Self.ClauseWhere);
end if;
if Self.ClauseOrderBy <> '' then
	laRequete.Concat(' order by ');
	laRequete.Concat(Self.ClauseOrderBy);
end if;
Self.ReadSQLText = laRequete.Value;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadSQL : ');
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerReadSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerReadSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CalculerUpdateSQL
begin
--
--	Description : Générer le code SQL de l'action UPDATE.
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 06/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.CalculerUpdateSQL');

-- Declarations

laRequete : TextData = New();
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

laRequete = 'update ';
laRequete.Concat(Self.ClauseFrom);
laRequete.Concat(' set IdUtlQqo = :IdUtlQqo, DtMajQqo= :DtMajQqo,');

-- Solution à partir du SelfDesc

Self.RecordInstance.DoResetAttributes();
if Self.RecordInstance.SelfDesc = NIL then
	 Self.RecordInstance.SelfDesc = new();
end if;
Self.RecordInstance.DoResetSelfDesc();
AttributesText : TextData = new;
For unAttribut in Self.RecordInstance.SelfDesc do
	if unAttribut.ItemReference.IsA(Type=DataValue) then
		AttributesText.Concat(unAttribut.ItemName);
		AttributesText.Concat('= :');
		AttributesText.Concat(unAttribut.ItemName);
		AttributesText.concat(',');
	end if;
end for;
laRequete.Concat(AttributesText.CopyRange(StartOffset=0, EndOffset=AttributesText.ActualSize-1));
-- Solution à partir du SelfDesc

laRequete.Concat(' where Id = :OldId and DtMajQqo = :OldDtMajQqo and IdUtlQqo = :OldIdUtlQqo');
Self.UpdateSQLText = laRequete.Value;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerUpdateSQL : ');
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, laRequete.Value);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.CalculerUpdateSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.CalculerAppendSQL');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.CheckPreAppendAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.AppendAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceSqlDesc.CheckPreDeleteAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.DeleteAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceSqlDesc.CheckPreUpdateAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.UpdateAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method DataServiceSqlDesc.DeleteAction(input aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description : 	Delete an occurence in the relationnal database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to Delete
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	07/06/1997	|	Création.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSqlDesc.DeleteAction');

-- Declarations
Nombre : Integer;
aObject : Object = aTransData.TransObject;
-- Fin Declarations

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreDeleteAction(aObject);
End if;
-- Fin de verification des pre-conditions
TmpTxt : TextData = new;
unCacheDesc : CacheDesc = (CacheDesc)(aObject);
Self.DeleteSQLInDesc.SetValue(ColumnName = ':Id', Value=unCacheDesc.Record.Id);
Self.DeleteSQLInDesc.SetValue(ColumnName = ':DtMajQqo', Value=unCacheDesc.Record.DtMajQqo); 
Self.DeleteSQLInDesc.SetValue(ColumnName = ':IdUtlQqo', Value=unCacheDesc.Record.IdUtlQqo); 
Begin Transaction
	Nombre = Self.laDbSession.Execute(StatementHandle=DeleteSQLHdle, inputDataSet=DeleteSQLInDesc);
End Transaction;
if Nombre = 0 then
	unExc : DataExc = new;
	unExc.Message.Concat('Aucune occurence détruite... -->');
	unExc.Message.Concat(' Id : ');
	unExc.Message.Concat(unCacheDesc.Record.Id);
	unExc.Message.Concat(' DtMajQqo : ');
	unExc.Message.Concat(unCacheDesc.Record.DtMajQqo);
	unExc.Message.Concat(' IdUtlQqo : ');
	unExc.Message.Concat(unCacheDesc.Record.IdUtlQqo);
	Raise unExc;
end if;

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.DeleteAction : End');

Return;

Exception
	-- Raise Database exceptions
	When e : GenericException do
		task.Part.LogMgr.PutLine(DeleteSQLText);
		Self.TraceExc(e, 'DataServiceSqlDesc.DeleteAction');
--		Raise;

/*
	-- if an index error occurs raise an "ImplementationExc"
	when e : DBOperationException do
		exc : ImplementationExc = new;
		exc.severity = SP_ER_USER;
		exc.Message = e.message;
		Transaction.abort;
		-- call the AlertManager de Bernie
		raise exc;
		
	when e : DBResourceException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		raise e;

	When e: GenericException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		Return;
*/		
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoAppendAction(input aObject: Framework.Object)
begin
--
--	Description : 	this method must be overloaded at the concrete level
--					and shall do the real work of inserting an object in the SQL Database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to insert
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	AUTHOR NAME	|	DD/MM/CCYY	|	Aim of the intervention.
--	D. NGUYEN 	|	06/06/1997	|	Creation.
--+
-- This code should never execute
-- exc : AbstraitException = new;
-- raise exc;
Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoConnecterDBSessionMgr_OLD
begin
--
--	Description : Etablir la liaison entre le service objet
--  assurant la gestion des DBSession et cet objet (DataServiceSQLDesc).
--
--	Type :	Concret
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 27/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataSerfviceSQLDesc.ConnecterDBSessionMgr');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataSerfviceSQLDesc.ConnecterDBSessionMgr');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataSerfviceSQLDesc.ConnecterDBSessionMgr');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoDeleteAction(input aObject: Framework.Object): Framework.long
begin
--
--	Description :	this method must be overloaded at the concrete level
--					and shall do the real work of deleting data from the SQL Database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to be destroyed
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	AUTHOR NAME	|	DD/MM/CCYY	|	Aim of the intervention.
--	D. NGUYEN  	|	06/06/1997	|	Creation.
--+

Return 1;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoInitServiceSQL
begin
--
--	Description :	Modèle de méthode de type "Do" au niveau abstrait	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Parm1 :	Desc
--					Output	--> Parm2 :	Desc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 05/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.DoInitServiceSQL');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceSQLDesc.DoInitServiceSQL');
Self.TraceExc(unExc, 'DataServiceSQLDesc.DoInitServiceSQL');
Raise unExc;
-- Fin du traitement
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoReadAction
begin
--
--	Description : 	this method must be overloaded at the concrete level
--					and shall do the real work of loading data from the SQL Database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : empty
--					Output	--> aObject : array of CacheDesc containing data read in the Database
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	AUTHOR NAME	|	DD/MM/CCYY	|	Aim of the intervention.
--	D. NGUYEN  	|	06/06/1997	|	Creation
--+

Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.DoUpDateAction(input aObject: Framework.Object): Framework.long
begin
--
--	Description : 	this method must be overloaded at the concrete level
--					and shall do the real work of updating data in the SQL database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to update
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : returns the number of rows updated
--
--	Exceptions : Aucun
--
--	Usage : global
--
--	Historique :
--
--	AUTHOR NAME	|	DD/MM/CCYY	|	Aim of the intervention.
--	D. NGUYEN  	|	20/06/1997	|	Creation.
--+

Return 1;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.Init
begin
--
--	Description : 	initialize the class
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> Aucun
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	AUTHOR NAME	|	DD/MM/CCYY	|	Aim of the intervention.
--	D. NGUYEN	|	22/07/1997	|	Creation.
--	D. NGUYEN  	|	28/06/1997	|	Creation of the DBSession by a DBSessionMgr.
--  JB BRIAUD   |   23/05/1997  |   Obtention de la DBSession par le SO adéquat.
--  JB BRIAUD   |   27/05/1997  |   Connection au SO adéquat.
--	D. NGUYEN	|	24/12/1997	|	Ajout des flagappend, update, delete, read.
--+

super.Init();
Self.ClauseSelect = '';
Self.ClauseWhere = '';
Self.ClauseOrderBy = '';
Self.ClauseFrom = '';
Self.FlagAppend = TRUE;
Self.FlagRead = TRUE;
Self.FlagDelete = TRUE;
Self.FlagUpdate = TRUE;

end method;

------------------------------------------------------------
method DataServiceSqlDesc.PrepareAppend
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.PrepareAppend');

Self.AppendSQLHdle = Self.laDBSession.Prepare(
	Self.AppendSQLText,
	Self.AppendSQLInDesc,
	Self.AppendSQLType);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.PrepareAppend : End');

Return;

end method;

------------------------------------------------------------
method DataServiceSqlDesc.PrepareDelete
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.PrepareDelete');

Self.DeleteSQLHdle = Self.laDBSession.Prepare(
	Self.DeleteSQLText,
	Self.DeleteSQLInDesc,
	Self.DeleteSQLType);
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.PrepareDelete : End');

Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.PrepareRead
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.PrepareRead');

Self.ReadSQLHdle = Self.laDBSession.Prepare(
	Self.ReadSQLText,
	Self.ReadSQLInDesc,
	Self.ReadSQLType);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.PrepareRead : End');

Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.PrepareReadAll
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.PrepareReadAll');

Self.ReadAllSQLHdle = Self.laDBSession.Prepare(
	Self.ReadAllSQLText,
	Self.ReadAllSQLInDesc,
	Self.ReadAllSQLType);
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.PrepareReadAll : End');

Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.PrepareUpdate
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.PrepareUpdate');

Self.UpdateSQLHdle = Self.laDBSession.Prepare(
	Self.UpdateSQLText,
	Self.UpdateSQLInDesc,
	Self.UpdateSQLType);
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.PrepareUpdate : End');

Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Gets data from the SQL Database
--
--	Type :	Abstrait
--
--	Parametres :	Input/Output	--> aObject : Array of CacheDesc retrieved from the Database
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions :	DataConcurencyException	-> if data is locked by an external system or administrator
--					DataAvailabilityException -> the database is currently unavailable, but should come back soon
--					ImplementationExc	-> stop all processing
--
--	Usage : Global
--
--	Historique :
--
--  JB BRIAUD   |   02/06/1997  |   Creation.
--  JB BRIAUD   |   04/06/1997  |   SQL dynamique.
--  JB BRIAUD   |   01/09/1997  |   DBDataSet.SetValue by position Vs by name.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSqlDesc.ReadAction');

-- Declarations
TmpRecordInstance : ObjectSelfDesc = Self.RecordInstance;
FlagReadAll : Boolean = TRUE;
DesRecords     : Array of ObjectSelfDesc = New();
unCacheDescs : Array of CacheDesc = new();
unRecordDesc : ObjectSelfDesc;
TmpReadSQLHdle : DBStatementHandle;
TmpReadSQLIn : DBDataSet;
TmpReadSQLType : Integer;
TmpReadSQLText : String;
ReadSQLOutDesc : DBDataSet;
leNombreDeLigne : Integer;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- DataServiceSqlDesc.ReadAction : aTransData.ClassName = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, aTransData.ClassName);
if aTransData <> NIL then
	if aTransData.IsA(Type=TransClass) then
		if (TransClass)(aTransData).aRecordSelfDesc <> NIL then
			if (TransClass)(aTransData).aRecordSelfDesc.SelfDesc <> NIL then
				if (TransClass)(aTransData).aRecordSelfDesc.SelfDesc.Items > 0 then
					FlagReadAll = FALSE;
					TmpRecordInstance = (TransClass)(aTransData).aRecordSelfDesc;
				else
					TmpRecordInstance.DoResetAttributes();
					if TmpRecordInstance.SelfDesc = NIL then
						 TmpRecordInstance.SelfDesc = new();
					end if;
					TmpRecordInstance.DoResetSelfDesc();
				end if;
			end if; 
		else
			TmpRecordInstance.DoResetAttributes();
			if TmpRecordInstance.SelfDesc = NIL then
				 TmpRecordInstance.SelfDesc = new();
			end if;
			TmpRecordInstance.DoResetSelfDesc();
		end if;
	elseif aTransData.IsA(Type=TransIntCtxt) then -- traitement du read en contexte technique (composition)
		FlagReadAll = FALSE;
		TmpRecordInstance = (TransIntCtxt)(aTransData).aRecordSelfDesc;
	else
		TmpRecordInstance.DoResetAttributes();
		if TmpRecordInstance.SelfDesc = NIL then
			 TmpRecordInstance.SelfDesc = new();
		end if;
		TmpRecordInstance.DoResetSelfDesc();
	end if;
else
	TmpRecordInstance.DoResetAttributes();
	if TmpRecordInstance.SelfDesc = NIL then
		 TmpRecordInstance.SelfDesc = new();
	end if;
	TmpRecordInstance.DoResetSelfDesc();
end if;


-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- Prise en compte des paramètres de Where (convention : variable nommée :WhereXXXX)
Begin Transaction

if FlagReadAll then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.ReadAction : ReadAll');

	TmpReadSQLHdle = Self.ReadAllSQLHdle;
	TmpReadSQLIn = Self.ReadAllSQLInDesc;

elseif aTransData.IsA(Type=TransIntCtxt) then -- traitement du read en contexte technique (composition)
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.ReadAction : ReadTechCtx');
	
	-- Contruction du SQL
	TmpReadSQLText = Self.CalculerReadIntCtxtSQL((TransIntCtxt)(aTransData));
	-- Préparation
	TmpReadSQLHdle = Self.laDBSession.Prepare(
			TmpReadSQLText,
			TmpReadSQLIn,
			TmpReadSQLType);

else

	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.ReadAction : Read');
	
	TmpReadSQLHdle = Self.ReadSQLHdle;
	TmpReadSQLIn = Self.ReadSQLInDesc;

end if;

if TmpReadSQLIn.ColumnList.Items > 0 then
	aCompteur : integer;
	for unColumnDesc in TmpReadSQLIn.ColumnList do
		aCompteur = aCompteur + 1;
		For unElt in TmpRecordInstance.SelfDesc do
			TmpColName : TextData = new;
			TmpColName.setValue(':');
			TmpColName.Concat(unElt.ItemName);
			if unColumnDesc.Name.IsEqual(TmpColName.value,TRUE) then
				TmpReadSQLIn.SetValue(Position = aCompteur, Value=(DataValue)(unElt.ItemReference)); 
			end if;
		end for;
	end For;
end if;

Self.laDBSession.OpenCursor(TmpReadSQLHdle, TmpReadSQLIn, ReadSQLOutDesc);

leNombreDeLigne = ReadSQLOutDesc.MaxRows;

TmpRecordInstance = Self.RecordInstance;	
unRecordDesc = TmpRecordInstance.Clone(Deep = TRUE);
	
while (TRUE) do
	if (laDBSession.FetchCursor(TmpReadSQLHdle, ReadSQLOutDesc, leNombreDeLigne) = 0) then
		exit;
	end if;
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '.');
	for Ligne in 1 to ReadSQLOutDesc.ActualRows do
		ReadSQLOutDesc.CurrentRow = Ligne;
		for Item in TmpRecordInstance.SelfDesc do
			if Item.ItemReference.Isa(Type=DataValue) then
				(DataValue)(Item.ItemReference).SetValue(ReadSQLOutDesc.GetValue(Item.ItemName));
			end if;
		end for;
		unRecordDesc = TmpRecordInstance.Clone(Deep = TRUE);
		if Self.laDbSession.DbVendorType = DB_VT_ORACLE then
			unRecordDesc.Id = (DoubleNullable)(ReadSQLOutDesc.GetValue('Id')).Value;
		else
			unRecordDesc.Id = ReadSQLOutDesc.GetValue('Id').TextValue.IntegerValue;
		end if;
		unRecordDesc.DtMajQqo = (DateTimeNullable)(ReadSQLOutDesc.GetValue('DtMajQqo'));
		unRecordDesc.IdUtlQqo = ReadSQLOutDesc.GetValue('IdUtlQqo').TextValue.IntegerValue;
		unCacheDescs.AppendRow();
		unCacheDescs[unCacheDescs.Items].Record=unRecordDesc;
	end for;
end while;
laDBSession.CloseCursor(TmpReadSQLHdle);
if aTransData.IsA(Type=TransIntCtxt) then -- traitement du read en contexte technique (composition)
	Self.laDBSession.RemoveStatement(TmpReadSQLHdle);
end if;
End Transaction;

ReadSQLOutDesc = NIL;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.ReadAction : End');

Return unCacheDescs;

Exception
	
	When e: DBOperationException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DataServiceSqlDesc.ReadAction--> DBOperationException :');
		Raise;
	
	when e : DBResourceException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DataServiceSqlDesc.ReadAction--> DBResourceException :');
		Raise;

	When e : GenericException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DataServiceSqlDesc.ReadAction');
		Raise;
/*
	when e : DBDeadlockException do
		TmpMsg : TextData = new;
		TmpMsg.Setvalue(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		task.Part.LogMgr.PutLine(TmpMsg);
--		countOfTry : integer = 3;
--		while countOfTry > 0 do
--			DoReadAction(aObject);
--			countOfTry = countOfTry -1;
--		end while;
		
		exc : DataConcurencyException = new;
		exc.Message = e.Message;
		exc.severity = 1;
		aObject = NIL;
		Transaction.Abort;
		raise exc;

	when e : DBResourceException do
		
		TmpMsg : TextData = new;
		TmpMsg.Setvalue(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		task.Part.LogMgr.PutLine(TmpMsg);
		exc : DataConcurencyException = new;
		exc.Message = e.Message;
		exc.severity  = e.severity;
		aObject = NIL;
		Transaction.Abort;
		raise exc;	
*/
end method;

------------------------------------------------------------
method DataServiceSqlDesc.SetCacheDescs(input desObjectSelfDesc: Framework.Array of DataAccessSrvBD.ObjectSelfDesc): Framework.Array of DataAccessSrvBD.CacheDesc
begin
--
--	Description :	Transforme en ajoutant l'information necessaire
--  un tableau de RecordSQL en un tableau de CacheDesc.
--
--	Type :	Concret
--
--	Parametres :	Input	--> desRecordSQL : tableau de RecordSQL
--					Output	--> Aucun
--					Return  --> tableau de CacheDesc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 02/06/1997  |   Version initiale au niveau abstrait.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSQLDesc.SetCacheDesc');

-- Declarations

unTableauCache : Array of CacheDesc = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

if desObjectSelfDesc = NIL then
	unTableauCache = NIL;
else
	For unRecord in desObjectSelfDesc do
		unCache : CacheDesc = New();
		unCache.Record = unRecord;
		-- Attention : il faut gérer les autres attributs
		-- de CacheDesc !	
		unTableauCache.AppendRow(Object=unCache);
	End for;
end if;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSQLDesc.SetCacheDesc : End');

return unTableauCache;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceSQLDesc.SetCacheDesc');
		Raise;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.StartService
begin
--
--	Description :	Démarrage du DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  JB BRIAUD	|	05/06/1997  |   Version initiale.
--	D. NGUYEN	|	24/12/1997	|	Ajout des flagAppend, update, delete et read.
--+
DoInitServiceSQL();
if FlagRead then
	Self.CalculerReadSQL();
	Self.PrepareRead();
	Self.CalculerReadAllSQL();
	Self.PrepareReadAll();
end if;
if FlagAppend then
	Self.CalculerAppendSQL();
	Self.PrepareAppend();
end if;
if FlagDelete then
	Self.CalculerDeleteSQL();
	Self.PrepareDelete();
end if;
if flagUpdate then
	Self.CalculerUpdateSQL();
	Self.PrepareUpdate();
end if;
Return;
end method;

------------------------------------------------------------
method DataServiceSqlDesc.UpdateAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Update an occurence in the relationnal database
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject : Object to insert
--					Output	--> Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	07/06/1997	|	Création.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceSqlDesc.UpdateAction');
unResult : Object;
NbRecords : integer;
aObject : Object = aTransData.TransObject;
-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreUpdateAction(aObject);
End if;
-- Fin de verification des pre-conditions
unCacheDesc : CacheDesc = (CacheDesc)(aObject);
if unCacheDesc.Record.Id = 0 then
	Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.UpdateAction : --> Append');
	unResult = Self.Append(aTransData);
	Return unResult;
elseif unCacheDesc.Record.FlagSuppr then
	Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.UpdateAction : --> Delete');
	Self.Delete(aTransData);
	Return unResult;
end if;
TmpTxt : TextData = new;
OldId, OldIdUtlQqo : integer;
OldDtMajQqo : DateTimeNullable = new;
OldId = unCacheDesc.Record.Id;
OldIdUtlQqo = unCacheDesc.Record.IdUtlQqo;
unCacheDesc.Record.IdUtlQqo =unCacheDesc.IdUtl;
OldDtMajQqo.setValue(unCacheDesc.Record.DtMajQqo);
unCacheDesc.Record.DtMajQqo.setCurrent();
Self.UpdateSQLInDesc.SetValue(ColumnName = ':OldId', Value=OldId); 
Self.UpdateSQLInDesc.SetValue(ColumnName = ':OldDtMajQqo', Value=OldDtMajQqo); 
Self.UpdateSQLInDesc.SetValue(ColumnName = ':OldIdUtlQqo', Value=OldIdUtlQqo); 
Self.UpdateSQLInDesc.SetValue(ColumnName = ':DtMajQqo', Value=unCacheDesc.Record.DtMajQqo.SetCurrent()); 
Self.UpdateSQLInDesc.SetValue(ColumnName = ':IdUtlQqo', Value=unCacheDesc.Record.IdUtlQqo); 

unObjectSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(unCacheDesc.Record);
if unObjectSelfDesc.SelfDesc = NIL then
	 unObjectSelfDesc.SelfDesc = new();
end if;
unObjectSelfDesc.DoResetSelfDesc();

For unAttribut in unObjectSelfDesc.selfDesc do
	TmpTxt.setValue(':');
	TmpTxt.Concat(unAttribut.ItemName);
	if unAttribut.ItemReference.IsA(Type=DataValue) then
		Self.UpdateSQLInDesc.SetValue(ColumnName = TmpTxt.Value, Value=(DataValue)(unAttribut.ItemReference)); 
	end if;
End For;

Begin Transaction
	NbRecords = Self.laDbSession.Execute(StatementHandle=UpdateSQLHdle, inputDataSet=UpdateSQLInDesc);
End Transaction;

if NbRecords = 0 then
	unExc : DataExc = new();
	unExc.Message.SetValue('Aucun occurence mise à jour... Id :');
	unExc.Message.Concat(OldId);
	unExc.Message.Concat(' DtMajQqo :');
	unExc.Message.Concat(OldDtMajQqo);
	unExc.Message.Concat(' IdUtlQqo :');
	unExc.Message.Concat(OldIdUtlQqo);

	Raise unExc;
end if;

unResult = unCacheDesc;
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceSqlDesc.UpdateAction : End');

Return unResult;

Exception
	-- Raise Database exceptions
	When e : GenericException do
		Task.Part.Logmgr.Putline(UpdateSqlText);
		Self.TraceExc(e, 'DataServiceSqlDesc.UpdateAction');
		Raise;

/*
	-- if an index error occurs raise an "ImplementationExc"
	when e : DBOperationException do
		exc : ImplementationExc = new;
		exc.severity = SP_ER_USER;
		exc.Message = e.message;
		Transaction.abort;
		-- call the AlertManager de Bernie
		raise exc;
		
	when e : DBResourceException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		raise e;

	When e: GenericException do
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : DataServiceSqlDesc... ');
		TmpMsg.Concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, 3, 1, TmpMsg);
		Return;
*/		
end method;

------------------------------------------------------------
method DialogueManagerDesc.Init
begin
super.Init();

Self.NameManager   = new();
Self.ArrayServices = new();
end method;

------------------------------------------------------------
method DialogueServiceDesc.Init
begin
super.Init();
Self.NameService = new();
end method;

------------------------------------------------------------
method EventDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This object contains the events to use for the notification in MVC Model.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessTransactionService
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
EventHandle = new;
end method;

------------------------------------------------------------
method FrontCommSrvDesc.Connect(copy output SessionId: DataAccessSrvBD.SessionId)
begin
--
--	Description : 	makes the connection to the businessTransactionService for the client.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Ouput	--> SessionId :	Identification of the session given.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+
task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrvDesc.Connect');

Self.SessionSrv.Connect(SessionId); -- A passer en start task si IsShared=TRUE

/* -- DN Version partagée (IsShared = TRUE) éventuellement utile si instruments à développer
Event Loop
	Postregister
		Start task Self.SessionSrv.Connect(SessionId) where completion = Event;
	
	When Self.SessionSrv.ConnectDone(aSessionId) do
		SessionId = aSessionId;
		Exit;
	When Self.SessionSrv.ConnectExc(Exc) do
		Raise Exc;

End event;
*/

task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrvDesc.Connect : End');
Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'FrontCommSrvDesc.Connect');
		Raise;

end method;

------------------------------------------------------------
method FrontCommSrvDesc.Connect(copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- FrontCommSrvDesc.Connect(User)');

Self.SessionSrv.Connect(Self.CodeApplication, Username, Password, SessionUser); -- A passer en start task si IsShared=TRUE

/* -- DN Version partagée (IsShared = TRUE) éventuellement utile si instruments à développer

Event Loop
	Postregister
		Start task Self.SessionSrv.Connect(Username,Password,SessionUser) where completion = Event;
	
	When Self.SessionSrv.UserConnectDone(aSessionUser) do
		SessionUser = aSessionUser;
		Exit;
	When Self.SessionSrv.UserConnectExc(Exc) do
		Raise Exc;

End event;
*/
Task.Part.LogMgr.Put(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,1,'--- Connection User : ');
Task.Part.LogMgr.PutLine(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,1,SessionUser.DtDebut.TextValue.Value);
Task.Part.LogMgr.Put(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,2,'	SessionUser.CodeApplication : ');
Task.Part.LogMgr.PutLine(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,2,SessionUser.CodeApplication);
Task.Part.LogMgr.Put(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,2,'	Username : ');
Task.Part.LogMgr.PutLine(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,2,Username);
Task.Part.LogMgr.Put(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,3,'	SessionUser.Id : ');
Task.Part.LogMgr.PutLine(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,3,SessionUser.Id);
For act in SessionUser.Profile.Actions do
	Task.Part.LogMgr.Put(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,4,'	SessionUser.Profile.Actions[] : ');
	Task.Part.LogMgr.PutLine(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,4,act.Code);
End for;
Task.Part.LogMgr.Putline(SP_MT_SECURITY,SP_ST_USER1,LOG_GRPFLAG,2,'--- Connection User : End');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- FrontCommSrvDesc.Connect(User) : End');

Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'FrontCommSrvDesc.Connect');
		Raise;

end method;

------------------------------------------------------------
method FrontCommSrvDesc.GetRoleLst(input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc
begin
--
--	Description :		Méthode de recherche des rôles d'un utilisateur
--
--	Type :	Concret
--
--	Parametres :	Input -->	pUserName	:	UserName
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommClt
--
--	History :
--
--	D. Nguyen	|	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- FrontCommSrvDesc.GetRoleLst');

aResult : Array of RoleDesc;
aResult = Self.SessionSrv.GetRoleLst(Self.CodeApplication, pUserName);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- FrontCommSrvDesc.GetRoleLst : End');

Return aResult;

Exception
	When e:GenericException do
		Self.TraceExc(e,'FrontCommSrvDesc.GetRoleLst');
		Raise;
		
end method;

------------------------------------------------------------
method FrontCommSrvDesc.Init
begin
--
--	Description : 	Initialization of the class. This object is a communication Front Desk.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();

Start task Self.InitService();

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	Self.StartFrontCommAgent(NIL);
End if;


end method;

------------------------------------------------------------
method FrontCommSrvDesc.SplitTimeWatch(input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet de mettre à jour les éléments de perf.
--
--	Type :	Concret
--
--	Parametres : pTimeSplit
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrvDesc.SplitTimeWath');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self.AgentFComm.CommTimeWatch.MethodCallsCount = Self.AgentFComm.CommTimeWatch.MethodCallsCount + 1;
Self.AgentFComm.CommTimeWatch.CalculerMinProcessingTime(pTimeSplit);
Self.AgentFComm.CommTimeWatch.CalculerMaxProcessingTime(pTimeSplit);
Self.AgentFComm.CommTimeWatch.CalculerAveProcessingTime(pTimeSplit);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrvDesc.SplitTimeWath : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method FrontCommSrvDesc.StartFrontCommAgent(input pAgentName: Framework.TextData)
begin
--
--	Description :	Cette méthode permet de demarrer l'agent de la fontale de comm
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition :
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrvDesc.StartFrontCommAgent');

-- Declarations
uneException : ImplementationExc;

-- Verification des pre-conditions
if (Self.AgentFComm <> NIL) then
	uneException = new();
	uneException.Message = 'L''agent est déjà demarré';
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
Self.AgentFComm = new();
Self.AgentFComm.AttachMO(self);
Self.AgentFComm.Name.SetValue('ABD_');
if (pAgentName = NIL) then
	Self.AgentFComm.Name.Concat(Self.ClassName);
else
	Self.AgentFComm.Name.Concat(pAgentName);
end if;
Self.AgentFComm.State = SM_ONLINE;
partAgent : ActivePartitionAgent = ActivePartitionAgent(task.Part.ActPartAgent);
Self.AgentFComm.SetParentAgent(parentAgent = partAgent, name = Self.AgentFComm.Name);
partAgent.AddSubAgent(subAgent = Self.AgentFComm, subAgentInfo = Self.AgentFComm.GetInfo());
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrvDesc.StartFrontCommAgent : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('FrontCommSrvDesc.StartFrontCommAgent. Exception : <%1> est recue.', TextData(value = ge.ClassName));
		return;

end method;

------------------------------------------------------------
method FrontCommSrvDesc.Transfer(copy input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.BusinessServiceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier): copy Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessService.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> TransData :	Data Transport structure.
--					Input	-->	BusinessTransactionService required for action.
--					Input	-->	TransOrigin	:	Origin of the demand
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	14/07/1997	|	Creation.
--+
task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrvDesc.Transfer');

aObject 	: Object;
aResult 	: Object;
aStopWatch 	: StopWatch;
aTimesplit 	: Integer;

-- Recherche de précédence
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aStopWatch = new();
	aStopWatch.Fire();
end if;

TmpMec : Boolean;
FlagFound : Boolean;
For aMec in Self.TransferMecanisms do
	if aMec.unServiceMgr = TransType then
		TmpMec = aMec.UseByValue;
		FlagFound = TRUE;
		exit;
	end if;
End for;
if not flagFound then
	if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
		TmpMec = FALSE;
	else
		TmpMec = TRUE;
	end if;
	TmpTransferMec : TransferMecanism = new(unServiceMgr=TransType,UseByValue=TmpMec);
	Self.TransferMecanisms.Appendrow(TmpTransferMec);
end if;
if TmpMec then
	aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
else
	aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
end if;

--if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
--	aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
--else
--	aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
--end if;

/* -- DN Version partagée (IsShared =TRUE) : désactivée pour l'instant
if CheckTransfer(TransData, TransType) then
	Event Loop 
		PostRegister
		if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
			start task TransType.TransferByRef(TransData, ClassType, TransOrigin) where completion = event;
		else
			start task TransType.TransferByValue(TransData, ClassType, TransOrigin) where completion = event;
		end if;
		When TransType.TransferByRefDone(aObject) do
			aResult = aObject;
			exit;
		When TransType.TransferByRefExc(Exc) do
			Raise Exc;
		When TransType.TransferByValueDone(aObject) do
			aResult = aObject;
			exit;
		When TransType.TransferByValueExc(Exc) do
			Raise Exc;
	end event;
end if;
*/

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTimeSplit);
end if;


task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrvDesc.Transfer : End');
Return aResult;

Exception
	When e: GenericException do
		if (aStopWatch <> NIL) then
			aStopWatch.Split();
		end if;		
		Self.TraceExc(e,'FrontCommSrvDesc.Transfer');
		Raise;

end method;

------------------------------------------------------------
method FrontCommSrvDesc.Transfer(copy input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.InterfaceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier): copy Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessTransactionService.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> TransData :	Data Transport structure.
--					Input	-->	BusinessTransactionService required for action.
--					Input	-->	TransOrigin	:	Origin of the demand
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	14/07/1997	|	Creation.
--+
task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrvDesc.Transfer');

aObject : Object;
aResult : Object;

-- Recherche de précédence
TmpMec : Boolean;
FlagFound : Boolean;
For aMec in Self.TransferMecanisms do
	if aMec.unServiceMgr = TransType then
		TmpMec = aMec.UseByValue;
		FlagFound = TRUE;
		exit;
	end if;
End for;
if not flagFound then
	if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
		TmpMec = FALSE;
	else
		TmpMec = TRUE;
	end if;
	TmpTransferMec : TransferMecanism = new(unServiceMgr=TransType,UseByValue=TmpMec);
	Self.TransferMecanisms.Appendrow(TmpTransferMec);
end if;
if TmpMec then
	aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
else
	aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
end if;

--if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
--	aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
--else
--	aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
--end if;

/* -- DN Version partagée (IsShared =TRUE) : désactivée pour l'instant
if CheckTransfer(TransData, TransType) then
	Event Loop 
		PostRegister
		if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
			start task TransType.TransferByRef(TransData, ClassType, TransOrigin) where completion = event;
		else
			start task TransType.TransferByValue(TransData, ClassType, TransOrigin) where completion = event;
		end if;
		When TransType.TransferByRefDone(aObject) do
			aResult = aObject;
			exit;
		When TransType.TransferByRefExc(Exc) do
			Raise Exc;
		When TransType.TransferByValueDone(aObject) do
			aResult = aObject;
			exit;
		When TransType.TransferByValueExc(Exc) do
			Raise Exc;
	end event;
end if;
*/

task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrvDesc.Transfer : End');
Return aResult;

Exception
	When e: GenericException do
		Self.TraceExc(e,'FrontCommSrvDesc.Transfer');
		Raise;

end method;

------------------------------------------------------------
method GroupDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method IndexDesc.Init
begin
super.Init();

Self.IsShared = TRUE;
end method;

------------------------------------------------------------
method InstanceDesc.Init
begin
--
--	Description : 	Init.
--
--	Type :	Abstrait
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.
--+

super.Init();
aObject = new;
aIdent  = new;
end method;

------------------------------------------------------------
method InterfaceMgrDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceServiceDesc.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	05/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('ServiceDesc.DoAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method InterfaceServiceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LoginDesc.DoResetAttributes
begin
Self.Description 	= new();
Self.IdApplication	= new();
Self.IdUserDesc 	= new();
Self.IdProfil 		= new();
Self.PassWord 		= new();
Self.UserName 		= new();
Self.Profil			= new();
end method;

------------------------------------------------------------
method LoginDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'IdApplication';
SelfDesc[SelfDesc.Items].ItemReference	= Self.IdApplication;
SelfDesc[SelfDesc.Items].ItemUserName	= 'IdApplication';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'IdProfil';
SelfDesc[SelfDesc.Items].ItemReference	= Self.IdProfil;
SelfDesc[SelfDesc.Items].ItemUserName	= 'IdProfil';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'IdUserDesc';
SelfDesc[SelfDesc.Items].ItemReference	= Self.IdUserDesc;
SelfDesc[SelfDesc.Items].ItemUserName	= 'IdUserDesc';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdUserDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'Password';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Password;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Password';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'UserName';
SelfDesc[SelfDesc.Items].ItemReference	= Self.UserName;
SelfDesc[SelfDesc.Items].ItemUserName	= 'UserName';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'Profil';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Profil;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Profil';
end method;

------------------------------------------------------------
method LoginDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method LoginDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method LoginExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LoginRoleDescSql.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ObjectSelfDesc.DoCheckValidity: Framework.boolean
begin
aResult : Boolean = FALSE;

aResult = TRUE;
Return aResult;
end method;

------------------------------------------------------------
method ObjectSelfDesc.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method ObjectSelfDesc.DoResetAttributes
begin
--
--	Description : 	Instanciates the attributes of the structure.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ObjectSelfDesc
--
--	Historique :
--
--	D. NGUYEN	|	17/06/1997	|	Creation.
--+

e : ImplementationExc = new;
e.Message.concat('ObjectSelfDesc.DoResetAttributes');
Raise e;

end method;

------------------------------------------------------------
method ObjectSelfDesc.DoResetSelfDesc
begin
e : ImplementationExc = new;
e.Message.concat('ObjectSelfDesc.DoResetSelfDesc');
Raise e;

end method;

------------------------------------------------------------
method ObjectSelfDesc.DoResetService
begin

end method;

------------------------------------------------------------
method ObjectSelfDesc.Init
begin
super.Init();
--SelfDesc = new;
Id = 0;
IdUtlQqo = 0;
DtMajQqo = new;

end method;

------------------------------------------------------------
method ParallelEltReturnDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ParallelServiceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ParamDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ParamDescSql.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PasswordDesc.Decrypt(input pKey: Framework.integer)
begin

end method;

------------------------------------------------------------
method PasswordDesc.Encrypt(input pKey: Framework.integer)
begin

end method;

------------------------------------------------------------
method PasswordDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ProfilActionDescSql.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ProfilDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	29/06/1997	|	Creation.
--+

Self.ActionDeb				= New();
Self.Actions 				= New();
Self.Description			= New();
Self.IdApplicationBDDesc	= New();
Self.LibProfil 				= New();

end method;

------------------------------------------------------------
method ProfilDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'ActionDeb';
SelfDesc[SelfDesc.Items].ItemReference	= Self.ActionDeb;
SelfDesc[SelfDesc.Items].ItemUserName	= 'ActionDeb';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Actions';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Actions;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Actions';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Description';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Description';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'IdApplicationBDDesc';
SelfDesc[SelfDesc.Items].ItemReference	= Self.IdApplicationBDDesc;
SelfDesc[SelfDesc.Items].ItemUserName	= 'IdApplicationBDDesc';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdApplicationBDDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'LibProfil';
SelfDesc[SelfDesc.Items].ItemReference	= Self.LibProfil;
SelfDesc[SelfDesc.Items].ItemUserName	= 'LibProfil';

end method;

------------------------------------------------------------
method ProfilDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ProfilDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method RecordDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used to store the Record structure of the collection.	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
Id = 0;
IdPtacsQqo = 0;
IdUtlQqo = 0;
DtMajQqo = new;
DtMajQqo.setCurrent();
--Object = new;
end method;

------------------------------------------------------------
method RoleDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	27/06/1997	|	Creation.
--+

Self.AgentId	= new();
Self.Code		= 0;
Self.Libelle	= '';
end method;

------------------------------------------------------------
method RoleDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'AgentId';
SelfDesc[SelfDesc.Items].ItemReference = Self.AgentId;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id de l''Agent';

end method;

------------------------------------------------------------
method RoleDesc.Init
begin
super.Init();


end method;

------------------------------------------------------------
method RoleDescSql.Init
begin
super.Init();

Self.DoResetAttributes();
end method;

------------------------------------------------------------
method SecurityExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='%%1 --> Security problem : Action %%2 not authorised ');

end method;

------------------------------------------------------------
method ServiceDesc.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.Action');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('ServiceDesc.Action');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.AddTimeWatch(input pCodeAction: Framework.integer)
begin
--
--	Description :	Cette méthode permet d'ajouter un TimeWatch dans le tableau Self.ArrayTimeWatch
--
--	Type :	Concret
--
--	Parametres : pCodeAction : Le code action pour laquelle on ajoute un instrument de performances
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.AddTimeWatch');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if (Self.ArrayTimeWatches[pCodeAction] = NIL) then
	unTimeWatch : TimeWatch = new();
	Self.ArrayTimeWatches[pCodeAction] = unTimeWatch;
	NomAction : TextData = new(Value = 'Action.');
	NomAction.Concat(pCodeAction);
	Self.AgentSvc.AddPerformanceInst(unTimeWatch, NomAction);
end if;
Self.ArrayTimeWatches[pCodeAction].MethodCallsCount = 
		Self.ArrayTimeWatches[pCodeAction].MethodCallsCount + 1;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.AddTimeWatch : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method ServiceDesc.CheckPartition: Framework.string
begin
--
--	Description : 	Returns the partition name of the current task.
--					It's use by the caller to determine if the architecture
--					is distirbuted or not.
--
--	Type :	Abstrait
--
--	Parametres :	Return	--> Name of the partition of the current task.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Return (SystemAgent)(Task.Part.ActPartAgent).Name.value;
end method;

------------------------------------------------------------
method ServiceDesc.DeRegisterEvent(input aEvent: DataAccessSrvBD.EventDesc)
begin
--
--	Description : 	Deregisters the event due to a loss of the link with a viewer.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aEvent :	Event to deregister.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontaleHabDesc
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.DeRegisterEvent');
Events.DeleteRow(aEvent);
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.DeRegisterEvent : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.DeRegisterEvent');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.DeRegisterEvent(input aTransOrigin: DataAccessSrvBD.StdEventNotifier)
begin
--
--	Description : 	Deregisters the event due to a loss of the link with a viewer.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransOrigin :	Object to deregister event.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontaleHabDesc
--
--	Historique :
--
--	D. NGUYEN	|	31/06/1996	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.DeRegisterEvent');
if Self.NotificationService = NIL then
	For aEv in Events do
		if aEv.StdEvent = aTransOrigin then
			Events.DeleteRow(aEv);
			exit;
		end if;
	end for;
else
	Self.NotificationService.DeRegisterEvent(aTransOrigin);
end if;
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.RegisterEvent : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.DeRegisterEvent');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ServiceDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.DoInitService');
/*
Self.SessionSrv = SoSessionSrv;
Self.Dependances.AppendRow(Self.SessionSrv);
*/
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method ServiceDesc.Init
begin
super.Init();
Self.Events = new();
Self.TransferMecanisms = new();

end method;

------------------------------------------------------------
method ServiceDesc.InitService
begin
--
--	Description : 	Initialisation du service en utilisant les dépendances entre services objets Forté.
--
--	Type :	Concret
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	19/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.InitService');

Self.Dependances = new;
Self.SyncServices();
Self.ServiceStarted = TRUE;
TmpMsg : TextData = new(value='---------- ');
TmpMsg.concat(Self.ClassName);
TmpMsg.Concat(' -> Started');
Task.Part.LogMgr.PutLine(TmpMsg.value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.InitService : End');

end method;

------------------------------------------------------------
method ServiceDesc.Notify(input aClassType: Framework.ClassType,
	input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL)
begin
--
--	Description : 	Notifie tous les clients d'un service.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransOrigin :	Caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.Notify');
For aEvent in Events do
	if aEvent.ClassType.Name = aClassType.Name and aEvent.StdEvent <> aTransOrigin then
		TmpEvent : EventDesc = new();
		TmpEvent.EventHandle = aEvent.StdEvent.StdEvent(Type=aTransData.TransActionService,
														Object = aTransData);
		Begin
			TmpEvent.EventHandle.PostEvent();
			exception
				when ex : DistributedAccessException do
					Self.DeRegisterEvent(aEvent);
		end;
	end if;
End for;


Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.Notify : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.Notify');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.Notify(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL)
begin
--
--	Description : 	Notifie tous les clients d'un service.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransOrigin :	Caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.Notify');
if Self.NotificationService = NIL then
	Self.Notify(Self.GetClassType(), aTransData, aTransOrigin);
else
	Self.NotificationService.Notify(Self.GetClassType(), aTransData, aTransOrigin);
end if;

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.Notify : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.Notify');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.RegisterEvent(input aTransOrigin: DataAccessSrvBD.StdEventNotifier)
begin
--
--	Description : 	Registers the event of the caller.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransOrigin :	Caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.RegisterEvent');

if Self.NotificationService = NIL then
	Events.AppendRow();
	Events[Events.Items].ClassType = Self.GetClassType();
	Events[Events.Items].StdEvent = aTransOrigin;
else
	Self.NotificationService.RegisterEvent(Self.GetClassType(),aTransOrigin);
end if;
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.RegisterEvent : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.RegisterEvent');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.RegisterEvent(input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier)
begin
--
--	Description : 	Registers the event of the caller.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransOrigin :	Caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.RegisterEvent');

if Self.NotificationService = NIL then
	Events.AppendRow();
	Events[Events.Items].ClassType = aClassType;
	Events[Events.Items].StdEvent = aTransOrigin;
else
	unExc : NotifyExc = new();
	unExc.Message.Concat('Service de notification impropre...');
	Raise unExc;
end if;
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.RegisterEvent : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.RegisterEvent');
		Raise;
end method;

------------------------------------------------------------
method ServiceDesc.SplitTimeWatch(input pCodeAction: Framework.integer,
	input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet d'ajouter un TimeWatch dans le tableau Self.ArrayTimeWatch
--
--	Type :	Concret
--
--	Parametres : pCodeAction : Le code action pour laquelle on ajoute un instrument de performances
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.AddTimeWatch');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self.ArrayTimeWatches[pCodeAction].CalculerMinProcessingTime(pTimeSplit);
Self.ArrayTimeWatches[pCodeAction].CalculerMaxProcessingTime(pTimeSplit);
Self.ArrayTimeWatches[pCodeAction].CalculerAveProcessingTime(pTimeSplit);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.AddTimeWatch : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method ServiceDesc.SyncServices
begin
--
--	Description : 	Synchronisation des service objects Forté pour le démarrage du service.
--
--	Type :	Abstrait
--
--	Parametres :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Startup of the application
--
--	Historique :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.SyncServices');

Dependances.Clear();
DoInitService();
For unService in Dependances do
	if unService = NIL then
		e : DistributedAccessException = new;
		Raise e;
	elseif (unService.IsA(Type=ServiceMgrDesc) and not (ServiceMgrDesc)(unService).ServiceStarted) or (unService.IsA(Type=ServiceDesc) and not (ServiceDesc)(unService).ServiceStarted) then
		e : DistributedAccessException = new;
		Raise e;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDesc.SyncServices : End');

Return;

Exception
	When e:DistributedAccessException do
		Task.Delay(1000);
		Self.SyncServices();
end method;

------------------------------------------------------------
method ServiceDesc.Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessTransactionService.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransData  :	Data Transport structure.
--					Input		--> aServiceMgr : 	The used data service manager.	
--					Input		--> aClassType  :	The used DataService.
--					
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation (SoDataServiceMgr).
--	D. NGUYEN	|	25/07/1997	|	Mise aux normes 
--	D. NGUYEN	|	03/11/1997	|	Stockage du mecanisme des services 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Transfer');
aObject   : Object;

-- Recherche de précédence
TmpMec : Boolean;
FlagFound : Boolean;
For aMec in Self.TransferMecanisms do
	if aMec.unServiceMgr = aServiceMgr then
		TmpMec = aMec.UseByValue;
		FlagFound = TRUE;
		exit;
	end if;
End for;

if not flagFound then
	if (SystemAgent)(Task.Part.ActPartAgent).Name.value = aServiceMgr.CheckPartition() then
		TmpMec = FALSE;
	else
		TmpMec = TRUE;
	end if;
	TmpTransferMec : TransferMecanism = new(unServiceMgr=aServiceMgr,UseByValue=TmpMec);
	Self.TransferMecanisms.Appendrow(TmpTransferMec);
end if;

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 4) 
	AND (Self.AgentSvc <> NIL) then
	start task self.AgentSvc.AddDialogueInst(aServiceMgr.ClassName, aClassType.Name);
end if;

if TmpMec then
	aObject = aServiceMgr.TransferByValue(aTransData, aClassType, aTransOrigin);
else
	aObject = aServiceMgr.TransferByRef(aTransData, aClassType, aTransOrigin);
end if;
/*
Event Loop 
	
	postregister
		if (SystemAgent)(Task.Part.ActPartAgent).Name.value = aServiceMgr.CheckPartition() then
			start task aServiceMgr.TransferByRef(aTransData, aClassType, aTransOrigin) where completion = event, transaction = Dependent;
		else
			start task aServiceMgr.TransferByValue(aTransData, aClassType, aTransOrigin) where completion = event, transaction = Dependent;
		end if;	
	
	When aServiceMgr.TransferByRefDone(RetObject) do
		aObject = RetObject;
		Exit;
	When aServiceMgr.TransferByValueDone(RetObject) do
		aObject = RetObject;
		Exit;
	When aServiceMgr.TransferByRefExc(Exc) do
		Raise Exc;
	When aServiceMgr.TransferByValueExc(Exc) do
		Raise Exc;
end;
*/
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Transfer : End');

Return aObject;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Transfer');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Appel de processus
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	24/10/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.Action');

-- Declarations

aResult : Object;

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreAction();
End if;
-- Fin de verification des pre-conditions

-- Traitement

	Case aTransData.TransActionService is
		
		else do // Other cases
			aResult = DoAction(aTransData, aTransOrigin);
	end case;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.Action : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceMgrDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.AfterSyncServices
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.AfterSyncServices');
if Self.NotificationService <> NIL then
	For Inst in Instances do
		if Inst.aObject.IsA(Type=ServiceDesc) then
			(ServiceDesc)(Inst.aObject).NotificationService = Self.NotificationService;
		end if;
	End for;
End if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.AfterSyncServices : End');
Return;

Exception
	When e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.AfterSyncServices');
		Raise;

end method;

------------------------------------------------------------
method ServiceMgrDesc.AppendRow(input aIdent: Framework.ClassType,
	input aObject: Framework.Object = NIL)
begin
--
--	Description : 	Method AppendRow 
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aIdent  :	the Classtype.
--					Input	-->	aObject :   the instance
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.
--	D. NGUYEN	|	24/07/1997	|	Instanciation du service si NIL.


aInstanceDesc : InstanceDesc = new;

aInstanceDesc.aIdent  = aIdent;
if aObject <> NIL then
	aInstanceDesc.aObject = aObject;
else
	aInstanceDesc.aObject = aIdent.InstanceAlloc();
end if;
Instances.AppendRow(aInstanceDesc);
TmpMsg : TextData = new(value='----------	');
TmpMsg.concat(aInstanceDesc.aObject.ClassName);
TmpMsg.Concat(' -> Started');
Task.Part.LogMgr.PutLine(TmpMsg.value);

Exception
	When e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.AppendRow');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.CheckPartition: Framework.string
begin
--
--	Description : 	Returns the partition name of the current task.
--					It's used by the caller to determine if the architecture
--					is distirbuted or not.
--
--	Type :	Abstrait
--
--	Parametres :	Return	--> Name of the partition of the current task.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Return (SystemAgent)(Task.Part.ActPartAgent).Name.value;
end method;

------------------------------------------------------------
method ServiceMgrDesc.CheckPreAction: Framework.boolean
begin
--
--	Description : 	Le but de cette méthode est de tester les pre-conditions de la méthode Action.
--
--	Type :	Abstrait/Concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	25/07/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.CheckPreAction');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.CheckPreAction : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceMgrDesc.CheckPreAction');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.CheckTransfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransType: DataAccessSrvBD.ServiceDesc): Framework.boolean
begin
--
--	Description : 	Controls the pre-conditions of a transfer.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransData : Data Transport structure.
--					Input	-->	aTransType : TransType of the BusinessService required.
--					Result	-->	TRUE	:	OK.
--								FALSE	:	KO.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Return TRUE;
end method;

------------------------------------------------------------
method ServiceMgrDesc.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  D.NGUYEN | 24/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('ServiceMgrDesc.DoAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceMgrDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.DoAfterSyncServices
begin

end method;

------------------------------------------------------------
method ServiceMgrDesc.DoBeforeSyncServices
begin

end method;

------------------------------------------------------------
method ServiceMgrDesc.DoInitService
begin
--
--	Description :	Modèle de méthode de type "Do" au niveau abstrait	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Parm1 :	Desc
--					Output	--> Parm2 :	Desc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.DoInitService');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('ServiceMgrDesc.DoInitService');
Self.TraceExc(unExc, 'ServiceMgrDesc.DoInitService');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method ServiceMgrDesc.FindObjectForIdent(input aIdent: Framework.ClassType): Framework.Object
begin
--
--	Description : 	find the object for the given ident.
--
--	Type :	
--
--	Parametres :	Input	--> aIdent  :	the Classtype.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.


aObject : Object;
FlagFound : Boolean = FALSE;
aObjectCursor : Object;
aInstanceDesc  : InstanceDesc;

for aObjectCursor in Instances do
	aInstanceDesc  = (InstanceDesc)(aObjectCursor);
	if aInstanceDesc.aIdent.Name = aIdent.Name then
		aObject = aInstanceDesc.aObject;
		FlagFound = TRUE;
		exit;
	end if;
end for;

if not FlagFound then
/*
	Self.AppendRow(aIdent);
	aObject = Self.FindObjectForIdent(aIdent);
*/
	e : ImplementationExc = new;
	param1 : TextData=new (value=aIdent.Name);
	param2 : TextData = new(value=Self.ClassName);
	TmpMsg : String = 'Le Service %1 n''est pas dans le Service manager %2.';
	e.setWithParams(severity = SP_ER_USER, message = TmpMsg, param1 = param1, param2 = param2);
	Raise e;
end if;

Return aObject;

Exception 
	when e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.FindObjectForIdent');
		Raise;
end method;

------------------------------------------------------------
method ServiceMgrDesc.FindRowForIdent(input aIdent: Framework.ClassType): Framework.integer
begin
--
--	Description : 	find the object position for the given ident.
--
--	Type :	
--
--	Parametres :	Input	--> aIdent  :	the Classtype.
--					Return  --> The Object position.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.

aObject : Object;
aPosition : Integer = 0;
FlagFound : Boolean = FALSE;
aInstanceDesc  : InstanceDesc;
TmpTxt : TextData = new(Value=aIdent.Name);

for aInstanceDesc in Instances do
	aPosition = aPosition + 1;
	if TmpTxt.IsEqual(aInstanceDesc.aIdent.Name,TRUE) then
		FlagFound = TRUE;
		exit;
	end if;
end for;

if not FlagFound then
/*
	Self.AppendRow(aIdent);
	aPosition = Self.Instances.Items;
*/
	e : ImplementationExc = new;
	param1 : TextData=new (value=aIdent.Name);
	param2 : TextData = new(value=Self.ClassName);
	TmpMsg : String = 'Le Service %1 n''est pas dans le Service manager %2.';
	e.setWithParams(severity = SP_ER_USER, message = TmpMsg, param1 = param1, param2 = param2);
	Raise e;
end if;

Return aPosition;

Exception 
	When e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.FindRowForIndent');
		Raise e;

end method;

------------------------------------------------------------
method ServiceMgrDesc.Init
begin
--
--	Description : 	Init.
--
--	Type :	Abstrait
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.
--+

super.Init();
Instances = new;
Start task Self.InitService();


end method;

------------------------------------------------------------
method ServiceMgrDesc.InitService
begin
--
--	Description : 	Init of the service using dependancy with services.
--
--	Type :	Concret
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	19/01/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.InitService');

Self.Dependances = new;
Self.DoBeforeSyncServices();
Self.SyncServices();
Self.DoAfterSyncServices();
Self.AfterSyncServices();
Self.ServiceStarted = TRUE;
TmpMsg : TextData = new(value='---------- ');
TmpMsg.concat(Self.ClassName);
TmpMsg.Concat(' -> Started');
Task.Part.LogMgr.PutLine(TmpMsg.value);

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 1) then
	Self.StartManagerAgent();
End if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.InitService : End');

Return;
end method;

------------------------------------------------------------
method ServiceMgrDesc.InitTransType(input aClassType: Framework.ClassType,
	output aTransType: DataAccessSrvBD.ServiceDesc)
begin
--
--	Description : 	Initialize the transtype from the classtype.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aClassType : Class type to initialize.
--					Output	-->	aTransType : the class reference.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ServiceMgrDesc.TransferByRef
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation .
--+
aObject : Object;

aObject = Self.FindObjectForIdent(aClassType);
If aObject <> NIL then
	aTransType = (ServiceDesc)(aObject);
else
	aTransType = (ServiceDesc)(aClassType.InstanceAlloc());
	Self.ReplaceObjectForIdent(aClassType, aTransType);
end if;

/* -- Code d'origine

-- Initialization of the Transtype

If CheckValidity(aIdent = aClassType) then

	aObject = Self.FindObjectForIdent(aIdent = aClassType);
	If aObject <> NIL then
--		an instance already exists
		aTransType = (ServiceDesc)(aObject);
	else
--		an instance doesn't exist
		aTransType = (ServiceDesc)(aClassType.InstanceAlloc());
		Self.ReplaceObjectForIdent(aIdent = aClassType, aObject = aTransType);
	end if;
else
	e : ImplementationExc = new;
	param1 : TextData=new (value=aClassType.Name);
	param2 : TextData = new(value=Self.ClassName);
	TmpMsg : String = 'The class %1 is not in this Service manager domain %2.';
	e.setWithParams(severity = SP_ER_ERROR, message = TmpMsg, param1 = param1, param2 = param2);
	Raise e;
End if;
*/
end method;

------------------------------------------------------------
method ServiceMgrDesc.ReplaceObjectForIdent(input aIdent: Framework.ClassType,
	input aObject: Framework.Object)
begin
--
--	Description : 	Method ReplaceRowforIdent
--
--	Type :	
--
--	Parametres :	Input	--> aIdent  :	the Classtype.
--					Input	--> aObject :   the Object reference.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	19/06/1997	|	Creation.


aInstanceDesc : InstanceDesc = new;
aFindObject : Object;
aPosition : Integer;

aPosition = FindRowForIdent(aIdent = aIdent);
If aPosition > 0 then
	Instances[aPosition].aObject = aObject;
End if;

Exception 
	When e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.ReplaceObjectForIndent');
		Raise e;

end method;

------------------------------------------------------------
method ServiceMgrDesc.StartManagerAgent
begin
--
--	Description :	Cette méthode permet de demarrer les agents des services heberges par ce manager
--
--	Type :	Concret
--
--	Parametres : pAgentMgr : La refernece de l'agent de ce Manager
--
--	Pre-condition : pAgentMgr <> NIL
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.StartManagerAgent');

-- Declarations
uneException : ImplementationExc;

-- Verification des pre-conditions
if (Self.AgentMgr <> NIL) then
	uneException = new();
	uneException.Message = 'L''agent est déjà demarré';
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
Self.AgentMgr = new();
Self.AgentMgr.AttachMO(self);
Self.AgentMgr.Name.SetValue('ABD_');
Self.AgentMgr.Name.Concat(Self.ClassName);
Self.AgentMgr.State = SM_ONLINE;
partAgent : ActivePartitionAgent = ActivePartitionAgent(task.Part.ActPartAgent);
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 2) then
	Self.StartServicesAgents(Self.AgentMgr);
End if;
Self.AgentMgr.SetParentAgent(parentAgent = partAgent, name = Self.AgentMgr.Name);
partAgent.AddSubAgent(subAgent = Self.AgentMgr, subAgentInfo = Self.AgentMgr.GetInfo());
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.StartManagerAgent : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('ServiceMgrDesc.StartManagerAgent. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);

end method;

------------------------------------------------------------
method ServiceMgrDesc.StartServicesAgents(input pAgentMgr: DataAccessSrvBD.AgentBD)
begin
--
--	Description :	Cette méthode permet de demarrer les agents des services heberges par ce manager
--
--	Type :	Concret
--
--	Parametres : pAgentMgr : La refernece de l'agent de ce Manager
--
--	Pre-condition : pAgentMgr <> NIL
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.StartServicesAgents');

-- Declarations
uneException	: ImplementationExc;
unIndex			: Integer;

-- Verification des pre-conditions
if (pAgentMgr = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, la refernce AgentMgr est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '*****************ServiceMgrDesc.StartServicesAgents. Manager Name = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, pAgentMgr.Name);

unIndex = 1;
For unService in Instances do
	if unService.aObject.IsA(Type=ServiceDesc) then
		if ((ServiceDesc)(unService.aObject).AgentSvc = NIL) then
			(ServiceDesc)(unService.aObject).ArrayTimeWatches = new();
			(ServiceDesc)(unService.aObject).AgentSvc = new();
			(ServiceDesc)(unService.aObject).AgentSvc.AttachMO((ServiceDesc)(unService.aObject));
			(ServiceDesc)(unService.aObject).AgentSvc.Name.SetValue(unIndex);
			(ServiceDesc)(unService.aObject).AgentSvc.Name.Concat('_');
			(ServiceDesc)(unService.aObject).AgentSvc.Name.Concat((ServiceDesc)(unService.aObject).ClassName);
			(ServiceDesc)(unService.aObject).AgentSvc.State = SM_ONLINE;
			unIndex = unIndex + 1;
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'ServiceMgrDesc.StartServicesAgents. Service Name = ');
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3,
								 (ServiceDesc)(unService.aObject).AgentSvc.Name);

			(ServiceDesc)(unService.aObject).AgentSvc.SetParentAgent(parentAgent = pAgentMgr, 
																 name = (ServiceDesc)(unService.aObject).AgentSvc.Name);
			pAgentMgr.AddSubAgent(subAgent = (ServiceDesc)(unService.aObject).AgentSvc, 
							  subAgentInfo = (ServiceDesc)(unService.aObject).AgentSvc.GetInfo());
		end if;
	end if;
end for;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.StartServicesAgents : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('Excpetion : <%1> est recue.', TextData(value = ge.ClassName));

end method;

------------------------------------------------------------
method ServiceMgrDesc.SyncServices
begin
--
--	Description : 	Synchronization of the service objects due at the startup of the current service.
--
--	Type :	Abstrait
--
--	Parametres :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Startup of the application
--
--	Historique :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.SyncServices');

Dependances.Clear();
DoInitService();
For unService in Dependances do
	if unService = NIL then
		e : DistributedAccessException = new;
		Raise e;
	elseif (unService.IsA(Type=ServiceMgrDesc) and not (ServiceMgrDesc)(unService).ServiceStarted) or (unService.IsA(Type=ServiceDesc) and not (ServiceDesc)(unService).ServiceStarted) then
		e : DistributedAccessException = new;
		Raise e;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceMgrDesc.SyncServices : End');

Return;

Exception
	When e:DistributedAccessException do
		Task.Delay(1000);
		Self.SyncServices();
end method;

------------------------------------------------------------
method ServiceMgrDesc.TransferByRef(input aTransData: DataAccessSrvBD.TransDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : Transfers the Data and Action Required to the BusinessTransactionService.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aTransData :	Data Transport structure.
--					Input	-->	aClassType :    Class Type of the Service required for action.
--
--	Pre-condition : The Classtype belongs to the Service Manager domain.
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation .
--+
-------------------------------------------------------------------------------------------
--	NOTE : 30/10/97 Suite à possibilité de supprimer le frontale de comm srv dans son role
--					de frontale de comm
--
--	C'est ici qu'il faudra mettre la traçabilité des opérations ou voire même dans le BS...
--
--	Danger : 	Usine à gaz possible + bottle neck si SO ou Pb de concurrences de n SO sur
--				une même ressource de trace. Penser à faire ça en start task sur un autre
--				SO, et par sécurité liée aux ressources voire à la partition à éventuellement
--				loger ce SO dans une autre partition.
--
--	Exploitation :
--				On perd le point unique de gestion des filtres de la trace... Donc penser
--				à un service de gestion des filtres centralisé puis à une diffusion par 
--				Event. Pb à résoudre, comment va se passer le démarrage ? Quel référentiel
--				de filtres d'exploitation pour les traces? Quel degré d'intéractivité par
--				rapport à la console d'exploitation ?
-------------------------------------------------------------------------------------------
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, 1, 1, '- ServiceMgrDesc.TransferByRef');
	
aTransType : ServiceDesc;
aObject : Object = new;
RetObject : Object = new;


-- DN 24/10/97 : Extension du rôle du manager de services : il prend en charge la gestion des processus
-- A NE PAS PUBLIER MAINTENANT
if aTransData.IsA(TransProcess) then
	Self.Action(aTransData, aTransOrigin);
else
-- Initialization of the Transtype and verify the pre-condition
InitTransType(aClassType = aClassType, aTransType = aTransType);

--Transfer
aObject = aTransType.Action(aTransData, aTransOrigin);
End if;
/* -- DN Version partagée (IsShared =TRUE) : désactivée pour l'instant
if CheckTransfer(aTransData, aTransType) then

	Event Loop 
	
		postregister
			start task aTransType.Action(aTransData) where completion = event;

		When aTransType.ActionDone(RetObject) do
			aObject = RetObject;
			Exit;
		When aTransType.ActionExc(Exc) do
			Raise Exc;
	end event;
end if;
*/
Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, 1, 2, '- ServiceMgrDesc.TransferByRef : End');

Return aObject;	

Exception
	When e: GenericException do
		Self.TraceExc(e,'ServiceMgrDesc.TransferByRef');
		Raise;

end method;

------------------------------------------------------------
method ServiceMgrDesc.TransferByValue(copy input aTransData: DataAccessSrvBD.TransDesc,
	copy input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): copy Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessTransactionService.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransData :	Data Transport structure.
--					Copy Input	-->	aClassType :    ClassType of the BusinessService required for action.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--+

Return Self.TransferByRef(aTransData, aClassType, aTransOrigin);
end method;

------------------------------------------------------------
method SessionHabDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used to store the session.	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
SessionId = new;
end method;

------------------------------------------------------------
method SessionId._SetValue(input aValue: Framework.integer)
begin
--
--	Description : 	
--
--	Type :	Abstrait
--
--	Paramétres :	
--
--	Précondition : 
--
--	Postcondition : 
--
--	Exceptions : Aucune
--
--	Utilisation : 
--
--	Historique :
--
--	D. NGUYEN		|	22/07/1997	|	Création.
--+

SessionId.SessionId = aValue;
end method;

------------------------------------------------------------
method SessionId.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used to store a session Id.	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
SessionId = new;
end method;

------------------------------------------------------------
method SessionIdDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used to describe what is a session Id.	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method SessionSrvDesc.Connect(copy output SessionId: DataAccessSrvBD.SessionId)
begin
--
--	Description : 	makes the connection to the businessTransactionService for the client.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Ouput	--> SessionId :	Identification of the session given.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

	task.part.logMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, 1, 1, '- FrontaleHabDesc : Connect');
	aSession : SessionIdDesc = new;
	LastSessionId = LastSessionId + 1;
	aSession.SessionId = LastSessionId;
	SessionId=new(value = aSession.SessionId);

end method;

------------------------------------------------------------
method SessionSrvDesc.Connect(copy input CodeApplication: Framework.integer,
	copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc)
begin
--
--	Description :		Méthode de connection
--
--	Type :	Concret
--
--	Parametres :	Input -->	CodeApplication : Le code de l'application
--								UserName		: UserName
--								Password		: Le mot de passe
--					OutPut -->  SessionUser		: une session
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommSrv
--
--	History :
--
--	D. Nguyen	|	16/02/1998	|	Création.
--	D. ACHHAB	|	01/04/1998	|	Les habilitations.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionSrvDesc.Connect(User)');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self.SessionSrvDS.Connect(CodeApplication,Username,Password, SessionUser);
if SessionUser <> NIL then
	Self.SessionsUser.AppendRow(SessionUser);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionSrvDesc.Connect(User) : End');
return;

Exception
	When ge : GenericException do
		Self.TraceExc(ge, 'SessionSrvDesc.Connect');
		raise;

end method;

------------------------------------------------------------
method SessionSrvDesc.GetRoleLst(input pCodeApplication: Framework.integer,
	input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc
begin
--
--	Description :		Méthode de recherche des rôles d'un utilisateur
--
--	Type :	Concret
--
--	Parametres :	Input -->	pCodeApplication 	:	Code application
--					Input -->	pUserName			:	UserName
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/04/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- SessionSrvDesc.GetRoleLst');

aResult : Array of RoleDesc;
aResult = Self.SessionSrvDS.GetRoleLst(pCodeApplication,pUserName);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- SessionSrvDesc.GetRoleLst : End');

Return aResult;

Exception
	When e:GenericException do
		Self.TraceExc(e,'SessionSrvDesc.GetRoleLst');
		Raise;
		
end method;

------------------------------------------------------------
method SessionSrvDesc.Init
begin
super.Init();
Self.SessionsUser = new();
Self.ServiceStarted = TRUE;
Task.Part.LogMgr.PutLine('---------- SessionSrvDesc -> Started');
end method;

------------------------------------------------------------
method SessionSrvDSDesc.Connect(copy input CodeApplication: Framework.integer,
	copy input Username: Framework.string,
	copy input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc)
begin
--
--	Description :		Méthode de connection
--
--	Type :	Concret
--
--	Parametres :	Input -->	CodeApplication : Le code de l'application
--								UserName		: UserName
--								Password		: Le mot de passe
--					OutPut -->  SessionUser		: une session
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommSrv
--
--	History :
--
--	D. Nguyen	|	16/02/1998	|	Création.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- SessionSrvDS.Connect(User)');
SessionUser = new;
LastUserSessionId = LastUserSessionId + 1;
SessionUser.Id=LastUserSessionId;
SessionUser.CodeApplication = CodeApplication;
SessionUser.UserName = UserName;
SessionUser.BeginSession();
-- Recherche du login et alimentation de la session utilisateur

-- Recherche de l'application
IdApp : Integer;
Sql Select Id into :IdApp from HabApplication -- $$PMT
  where Code = :CodeApplication
   on Session Self.LaDBSession;
-- Recherche du login
TmpLogin : LoginDescSql=new();
Sql Select * into :TmpLogin from HabLogin where IdApplication = :IdApp and UserName = :UserName -- $$PMT
and Password = :Password
on Session Self.LaDBSession;
SessionUser.IdUtl = TmpLogin.IdUserDesc.Value;
Task.Part.LogMgr.Put(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- SessionSrvDS.Connect(User) : TmpLogin-->');
Task.Part.LogMgr.Putline(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,TmpLogin.Id);
-- Recherche du user
TmpUser : UserDescSql=new();
Sql Select * into :TmpUser from HabUser Where
  Id = :TmpLogin.IdUserDesc on Session Self.LaDbSession; -- $$PMT
SessionUser.User = TmpUser;
-- Recherche des paramétres de l'utilisateur
TmpHabRelUserParam : integer = HAB_REL_USERPARAM;
TmpParams : Array of ParamDescSql = new();
Sql Select * into :TmpParams from HabParametres where TypeRelation = :TmpHabRelUserParam and IdParent = :SessionUser.User.Id on Session Self.LaDbSession;
TmpParam : ParamDesc;
For aPar in TmpParams do
	TmpParam = new(Id = aPar.Id, DtMajQqo = aPar.DtMajQqo, IdUtlQqo = aPar.IdUtlQqo);
	TmpParam.Code= new(Value=aPar.Code);
	Case aPar.TypeData is
		When TYPEDATA_TEXT do
			TmpTxt : TextNullable = new();
			TmpTxt.setValue(aPar.DataText);
			TmpParam.DataValue = TmpTxt;
		When TYPEDATA_INTEGER do
			TmpInteger : IntegerNullable = new();
			TmpInteger.setValue(aPar.DataInteger);
			TmpParam.DataValue = TmpInteger;
		When TYPEDATA_DOUBLE do
			TmpDouble : DoubleNullable = new();
			TmpDouble.setValue(aPar.DataDouble);
			TmpParam.DataValue = TmpDouble;
		When TYPEDATA_BOOLEAN do
			TmpBoolean : BooleanNullable = new();
			TmpBoolean.setValue(aPar.DataBoolean);
			TmpParam.DataValue = TmpBoolean;
	End Case;
	SessionUser.User.Parametres.AppendRow(TmpParam);
End for; 

-- Recherche du profil
TmpProfil : ProfilDescSql = new();
Sql Select * into :TmpProfil from HabProfil where Id = :TmpLogin.IdProfil on Session Self.LaDbSession; 
Task.Part.LogMgr.Put(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- SessionSrvDS.Connect(User) : TmpProfil-->');
Task.Part.LogMgr.Putline(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,TmpProfil.Id);
For (act : ProfilActionDescSql) in Sql Select * from HabProfilAction where IdProfil = :TmpProfil.Id on Session Self.LaDbSession do
	TmpAct : ActionDescSql=new();
	Sql Select * into :TmpAct from HabAction where Id = :act.IdAction and IdApplicationBDDesc = :IdApp on Session Self.LaDbSession; 
	TmpAct.FlagRead.value = act.FlagRead;
	TmpAct.FlagAppend.value = act.FlagAppend;
	TmpAct.FlagUpdate.value = act.FlagUpdate;
	TmpAct.FlagDelete.value = act.FlagDelete;
	TmpAct.FlagExecute.value = act.FlagExecute;
	-- Recherche des paramétres de l'action
	TmHabRelProfilActionParam : integer = HAB_REL_PROFILACTIONPARAM;
	TmpParams : Array of ParamDescSql = new();
	Sql Select * into :TmpParams from HabParametres where TypeRelation = :TmHabRelProfilActionParam and IdParent = :act.Id on Session Self.LaDbSession;
	TmpParam : ParamDesc;
	For aPar in TmpParams do
		TmpParam = new(Id = aPar.Id, DtMajQqo = aPar.DtMajQqo, IdUtlQqo = aPar.IdUtlQqo);
		TmpParam.Code= new(Value=aPar.Code);
		Case aPar.TypeData is
			When TYPEDATA_TEXT do
				TmpTxt : TextNullable = new();
				TmpTxt.setValue(aPar.DataText);
				TmpParam.DataValue = TmpTxt;
			When TYPEDATA_INTEGER do
				TmpInteger : IntegerNullable = new();
				TmpInteger.setValue(aPar.DataInteger);
				TmpParam.DataValue = TmpInteger;
			When TYPEDATA_DOUBLE do
				TmpDouble : DoubleNullable = new();
				TmpDouble.setValue(aPar.DataDouble);
				TmpParam.DataValue = TmpDouble;
			When TYPEDATA_BOOLEAN do
				TmpBoolean : BooleanNullable = new();
				TmpBoolean.setValue(aPar.DataBoolean);
				TmpParam.DataValue = TmpBoolean;
		End Case;
		TmpAct.Parametres.AppendRow(TmpParam);
	End for; 

	TmpProfil.Actions.Appendrow(TmpAct);
End For;
SessionUser.Profile = TmpProfil;
-- Recherche des groupes : not implemented

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- SessionSrvDS.Connect(User) : End');

end method;

------------------------------------------------------------
method SessionSrvDSDesc.GetRoleLst(input pCodeApplication: Framework.integer,
	input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc
begin
--
--	Description :		Méthode de recherche des rôles d'un utilisateur
--
--	Type :	Concret
--
--	Parametres :	Input -->	pCodeApplication	: 	Code Application 
--					Input -->	pUserName			:	UserName
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : SessionSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/04/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- SessionSrvDSDesc.GetRoleLst');

aResult : Array of RoleDesc;
-- Recherche de l'application
IdApp : Integer;
Sql Select Id into :IdApp from HabApplication where Code = :pCodeApplication on Session Self.LaDBSession;
-- Recherche du login
TmpLogin : LoginDescSql=new();
Sql Select * into :TmpLogin from HabLogin where IdApplication = :IdApp and UserName = :pUserName on Session Self.LaDBSession;
-- Recherche des rôles
aResult = new();
For (Lr : LoginRoleDescSql) in Sql Select * from HabLoginRole where IdLogin = :TmpLogin.Id on Session Self.LaDbSession do
	TmpRole : RoleDescSql=new();
	Sql Select * into :TmpRole from HabRole where Id = :Lr.IdRole on Session Self.LaDbSession; 
	aResult.Appendrow(TmpRole);
End For;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- SessionSrvDSDesc.GetRoleLst : End');

Return aResult;

Exception
	When e:GenericException do
		Self.TraceExc(e,'SessionSrvDSDesc.GetRoleLst');
		Raise;
		
end method;

------------------------------------------------------------
method SessionSrvDSDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method SessionUserDesc.BeginSession
begin
--
--	Description :	Cette méthode permet de demarrer une Session
--
--	Type :	Concret
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	ActionExc : générée en cas d'action inconnue.
--
--	Utilisation : Globale
--
--	Historique :
--
--  D. NGUYEN	  | 01/03/1998  |	Création.
--	D. ACHHAB	  |	01/04/1998	|	Les habilitations.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionUserDesc.BeginSession');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if Self.DtDebut = NIL then
	Self.DtDebut = new();
	Self.DtDebut.SetCurrent();
else
	uneException : ImplementationExc = new();
	uneException.message.concat('This session already began...');
	Raise uneException;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionUserDesc.BeginSession : End');
Return;

Exception
	When ge : GenericException do
		Self.TraceExc(ge, 'SessionUserDesc.BeginSession');
		Raise;
end method;

------------------------------------------------------------
method SessionUserDesc.CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean
begin
--
--	Description :	Tests if the action can be done by the current user
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeAction :	Code action of the action
--					Return	--> TRUE = YES, FALSE = NO
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionUserDesc.CheckSecurity');

-- Declarations
aResult : Boolean = FALSE;

-- Traitement
if Self.Profile <> NIL then
	For aAct in Self.Profile.Actions do
		if aAct.Code.Value = pCodeAction then
			if aAct.IsAuthorisedFor(ACT_STD_EXECUTE) then
				aResult = TRUE;
			end if;
			exit;
		end if;
	End for;
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionUserDesc.CheckSecurity : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'SessionUserDesc.CheckSecurity');
		Raise;
end method;

------------------------------------------------------------
method SessionUserDesc.EndSession
begin
--
--	Description :	Cette méthode permet d'arrêter une Session
--
--	Type :	Concret
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	
--
--	Utilisation : Globale
--
--	Historique :
--
--  D. NGUYEN	  | 01/03/1998  |	Création.
--	D. ACHHAB	  |	01/04/1998	|	Les habilitations.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionUserDesc.EndSession');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if (Self.DtFin = NIL) then
	Self.DtFin = new();
end if;
Self.DtFin.SetCurrent();
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionUserDesc.EndSession : End');
Return;

Exception
	When ge : GenericException do
		Self.TraceExc(ge, 'SessionUserDesc.BeginSession');
		Raise;



end method;

------------------------------------------------------------
method SessionUserDesc.GetAction(input pCodeAction: Framework.integer): DataAccessSrvBD.ActionDesc
begin
--
--	Description :	Get an Action from the UserSession.	
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeAction :	Code action of the action
--					Return	--> ActionDesc corresponding to the action definition (NIL if no action).
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionUserDesc.GetAction');

-- Declarations
aResult : ActionDesc;

-- Traitement
if Self.Profile <> NIL then
	For aAct in Self.Profile.Actions do
		if aAct.Code.Value = pCodeAction then
			aResult = aAct;
			exit;
		end if;
	End for;
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionUserDesc.GetAction : End');
Return aResult;

Exception
	When ge : GenericException do
		Self.TraceExc(ge, 'SessionUserDesc.GetAction');
		Raise;
end method;

------------------------------------------------------------
method SessionUserDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method SessionUserDesc.IsActionInProfile(input pCodeAction: Framework.integer): Framework.boolean
begin
--
--	Description :	Tests if the action is in the profile	
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeAction :	Code action of the action
--					Return	--> TRUE = YES, FALSE = NO
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionUserDesc.IsActionInProfile');

-- Declarations
aResult : Boolean = FALSE;

-- Traitement
if Self.Profile <> NIL then
	For aAct in Self.Profile.Actions do
		if aAct.Code.Value = pCodeAction then
			aResult = TRUE;
			exit;
		end if;
	End for;
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionUserDesc.IsActionInProfile : End');
Return aResult;

Exception
	When ge : GenericException do
		Self.TraceExc(ge, 'SessionUserDesc.IsActionInProfile');
		Raise;
end method;

------------------------------------------------------------
method StdEventNotifier.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used for the MVC model : it contains the notify event.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method StructureDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This class is used to defined the structure of a self descriptive record	
--
--				Attributes :	ItemName	-->	Name of the item
--							ItemReference 	-->	Reference of the item
--
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
-- OP 10/10/97 : Read only
Self.ParentItemName = '';
Self.LinkAppend = TRUE;
Self.LinkDelete = TRUE;
Self.LinkRead = TRUE; 
Self.LinkUpdate = TRUE;

end method;

------------------------------------------------------------
method StructureServiceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TimeWatch.CalculerAveProcessingTime(input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet de calculer le Max Processing Time
--
--	Type :	Concret
--
--	Parametres : pTimeSplit : Le temps d'execution d'une action
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TimeWatch.CalculerAveProcessingTime');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self.TotalProcessingTime = Self.TotalProcessingTime + pTimeSplit;
Self.AveProcessingTime   = Self.TotalProcessingTime / Self.MethodCallscount;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TimeWatch.CalculerAveProcessingTime : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method TimeWatch.CalculerMaxProcessingTime(input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet de calculer le Max Processing Time
--
--	Type :	Concret
--
--	Parametres : pTimeSplit : Le temps d'execution d'une action
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TimeWatch.CalculerMaxProcessingTime');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if (pTimeSplit > Self.MaxProcessingTime) then
	Self.MaxProcessingTime = pTimeSplit;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TimeWatch.CalculerMaxProcessingTime : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method TimeWatch.CalculerMinProcessingTime(input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet de calculer le Max Processing Time
--
--	Type :	Concret
--
--	Parametres : pTimeSplit : Le temps d'execution d'une action
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TimeWatch.CalculerMinProcessingTime');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if (pTimeSplit < Self.MinProcessingTime) then
	Self.MinProcessingTime = pTimeSplit;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TimeWatch.TimeWatch.CalculerMinProcessingTime : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method TimeWatch.Init
begin
super.Init();

Self.AveProcessingTime	 = 0;
Self.MaxProcessingTime	 = 0;
Self.MethodCallsCount	 = 0;
Self.TotalProcessingTime = 0;
Self.MinProcessingTime	 = 2147483647;

end method;

------------------------------------------------------------
method TransClass.Init
begin
super.Init();
aRecordSelfDesc = new;
aDataContext = new;
end method;

------------------------------------------------------------
method TransDesc.Init
begin
--
--	Description : 	Initialization of the class.
--					This object is used to store the data structure to transport from client to Data Storage.	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--					Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Class
--
--	Historique :
--
--	D. NGUYEN	|	28/06/1996	|	Creation.
--+

super.Init();
TransActionService = 99; -- Code of the Action wanted
TransObject = new; -- Object containing the data transmitted
TransSessionId = new; -- Identification of the session asking the action

end method;

------------------------------------------------------------
method TransDico.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransferMecanism.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransferTrt.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransferTrt.Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method Transfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class DataWin
--
--	Pre-condition : Refer to Abstract method of the class DataWin
--
--	Post-condition : Refer to Abstract method of the class DataWin
--
--	Exceptions : Refer to Abstract method of the class DataWin
--
--	Usage : TransferTrt
--
--	Historique :
--
--	D. NGUYEN	|	30/01/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TransferTrt.Transfer');
aResult : Object;
if TrfRessource = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'TransferTrt.Transfer : Attribute TrfRessource is NIL');
	Raise e;
end if;

aResult = TrfRessource.Transfer(aTransData, aServiceMgr, aClassType, aTransOrigin);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TransferTrt.Transfer : End');

Return aResult;

end method;

------------------------------------------------------------
method TransIntCtxt.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransProcess.Init
begin
super.Init();
end method;

------------------------------------------------------------
method UserDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	29/06/1997	|	Creation.
--+

Self.Description	= New();
Self.Parametres 	= New();
Self.UserName		= new();
Self.Logins			= new();


end method;

------------------------------------------------------------
method UserDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	Historique :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Description';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName 	= 'Description';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName 		= 'UserName';
SelfDesc[SelfDesc.Items].ItemReference	= Self.UserName;
SelfDesc[SelfDesc.Items].ItemUserName	= 'UserName';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Logins';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Logins;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Logins';
SelfDesc[SelfDesc.Items].LinkActive		= TRUE;


SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName		= 'Parametres';
SelfDesc[SelfDesc.Items].ItemReference	= Self.Parametres;
SelfDesc[SelfDesc.Items].ItemUserName	= 'Parametres';




end method;

------------------------------------------------------------
method UserDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method UserDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 1;
	ProjectType = SERVER;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'dataacce';


end DataAccessSrvBD;
begin TOOL SecuritySrvBD;

includes DataAccessSrvBD;
includes GenericDBMS;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  SessionSrv;
forward  SessionSrvDS;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class SessionSrv inherits from DataAccessSrvBD.SessionSrvDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class SessionSrvDS inherits from DataAccessSrvBD.SessionSrvDSDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service SoDbSessionHab : GenericDBMS.DBSession = (DialogDuration = SESSION,
	Visibility = user,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '628902D0-C4E0-11D1-9548-74219451AA77');
service SoSessionSrv : SecuritySrvBD.SessionSrv = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'A0E5E990-A185-11D1-A0B4-B0AD0101AA77');
service SoSessionSrvDS : SecuritySrvBD.SessionSrvDS = (DialogDuration = SESSION,
	Visibility = user,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'E1C32820-A184-11D1-A0B4-B0AD0101AA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method SessionSrv.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : SessionSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionSrv.DoInitService');

Self.SessionSrvDS = SoSessionSrvDS;
Self.Dependances.AppendRow(Self.SessionSrvDS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionSrv.DoInitService : End');
Return;

end method;

------------------------------------------------------------
method SessionSrv.Init
begin
super.Init();

Start task Self.InitService();
end method;

------------------------------------------------------------
method SessionSrvDS.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : SessionSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SessionSrvDS.DoInitService');

Self.Dependances.AppendRow(soDBSessionHab);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SessionSrvDS.DoInitService : End');
Return;

end method;

------------------------------------------------------------
method SessionSrvDS.Init
begin
super.Init();
Self.LaDBSession = SoDbSessionHab;
Self.ServiceStarted = TRUE;

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'security';


end SecuritySrvBD;
begin TOOL DicoSrvBD;

includes DataAccessSrvBD;
includes FrameworkBD;
includes GenericDBMS;
includes Framework;
includes SystemMonitor;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  DateTimeRefSrv;
forward  DicoClassDesc;
forward  DicoLibDesc;
forward  DicoRefDesc;
forward  DictionaryBSMgr;
forward  DictionaryDS;
forward  DictionaryDSMgr;
forward  DictionaryService;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant DICO_READ = 1;
constant DICO_TYPLIB_COD = 1;
constant DICO_TYPLIB_STD = 0;
constant LOG_GRPFLAG = 3;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class DateTimeRefSrv inherits from DataAccessSrvBD.ServiceDesc

has public  attribute DateRef: Framework.DateTimeNullable;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method GetDateRef(input resolution: Framework.integer = 7): Framework.DateTimeNullable;
has public  method Init;
has public  method SetDateRef(input pDateRef: Framework.DateTimeData);

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class DicoClassDesc inherits from Framework.Object

has public  attribute DicoClassName: Framework.string;
has public  attribute ListElements: Framework.Array of Framework.ListElement;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DicoLibDesc inherits from Framework.Object

has public  attribute CodeValue: Framework.string;
has public  attribute TextValue: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DicoRefDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodElement: Framework.TextNullable;
has public  attribute DicoClassName: Framework.TextNullable;
has public  attribute IntCodeElement: Framework.IntegerNullable;
has public  attribute LibElement: Framework.TextNullable;
has public  attribute OrderByValue: Framework.IntegerNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DictionaryBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class DictionaryDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;
has private method ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class DictionaryDSMgr inherits from DataAccessSrvBD.DataServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class DictionaryService inherits from DataAccessSrvBD.ServiceDesc

has public  attribute aServiceMgr: DicoSrvBD.DictionaryDSMgr;
has public  attribute FirstRead: Framework.boolean;
has public  attribute References: Framework.Array of DicoSrvBD.DicoClassDesc;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method Read(input aTransData: DataAccessSrvBD.TransDico): Framework.Object;
has private method ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service SoDBSessionDico : GenericDBMS.DBSession = (DialogDuration = TRANSACTION,
	Visibility = user,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'CC795FFA-083C-11D1-B833-B1E641C8AA77');
service SoDateTimeRef : DicoSrvBD.DateTimeRefSrv = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'DE710120-77D7-11D1-9463-8BA6ADA3AA77');
service SoDictionaryBSMgr : DicoSrvBD.DictionaryBSMgr = (DialogDuration = SESSION,
	Visibility = user,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'EA4BE645-0840-11D1-B833-B1E641C8AA77');
service SoDictionaryDSMgr : DicoSrvBD.DictionaryDSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '97E3C915-083D-11D1-B833-B1E641C8AA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method DateTimeRefSrv.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Point d'entrée de la classe.
--
--	Type :	Concret
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	18/12/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DateTimeRefSrv.Action');

-- Declarations
aResult : Object;

-- Traitement
	Case aTransData.TransActionService is
		when ACT_TST_GETDATEREF do
			aResult=GetDateRef();
	end case;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DateTimeRefSrv.Action : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DateTimeRefSrv.Action');
		Raise;
end method;

------------------------------------------------------------
method DateTimeRefSrv.GetDateRef(input resolution: Framework.integer = 7): Framework.DateTimeNullable
begin
--
--	Description :	Récupération de la date de référence	
--
--	Type :	Concret
--
--	Parametres :	Input	--> resolution :
--					DR_YEAR	Set to midnight on January 1 of current year.
--					DR_QUARTER	Set to midnight on the first day of the current calendar quarter (I. e. 1=midnight January 1, 2=midnight April 1, 3=midnight July 1, and 4=Midnight October 1.)
--					DR_MONTH	Set to midnight on the first day of current month.
--					DR_DAY	Set to midnight of the current day.	
--					DR_HOUR	Set to start of the current hour. 
--					DR_MINUTE	Set to start of the current minute.
--					DR_SECOND	Set to current second (default if no resolution given).
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Pour phase de tests uniquement
--
--	Historique :
--
--	D. NGUYEN	  |	18/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DateTimeRefSrv.GetDateRef');

aResult : DateTimeNullable = new;

Case resolution is
	When DR_YEAR do
	-- Set to midnight on January 1 of current year.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_YEAR');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		TmpTxt.ReplaceRange('01-Jan-',0,7);
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange(' 00:00:00',TmpTxt.Offset,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);
	
	When DR_QUARTER do
	-- Set to midnight on the first day of the current calendar quarter (I. e. 1=midnight January 1, 2=midnight April 1, 3=midnight July 1, and 4=Midnight October 1.)
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_QUARTER');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		Case aResult.GetUnit(DR_QUARTER) is
			When 1 do
				TmpTxt.ReplaceRange('01-Jan-',0,7);
			When 2 do
				TmpTxt.ReplaceRange('01-Apr-',0,7);
			When 3 do
				TmpTxt.ReplaceRange('01-Jul-',0,7);
			When 4 do
				TmpTxt.ReplaceRange('01-Oct-',0,7);
		End Case;
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange('00:00:00',TmpTxt.Offset+1,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);
	
	When DR_MONTH do
	-- Set to midnight on the first day of current month.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_MONTH');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		TmpTxt.ReplaceRange('01',0,2);
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange('00:00:00',TmpTxt.Offset+1,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);
	
	When DR_DAY do
	-- Set to midnight of the current day.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_DAY');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange('00:00:00',TmpTxt.Offset+1,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);
	
	When DR_HOUR do
	-- Set to start of the current hour.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_HOUR');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange('00:00',TmpTxt.Offset+4,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);
	
	When DR_MINUTE do
	-- Set to start of the current minute.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_MINUTE');
		aResult.SetValue(Self.DateRef);
		TmpTxt : TextData = new(value=aResult.TextValue.value);
		TmpTxt.MoveToChar(' ');
		TmpTxt.ReplaceRange('00',TmpTxt.Offset+7,TmpTxt.Offset+9);
		aResult.setValue(TmpTxt.Value);

	When DR_SECOND do
	-- Set to start of the current minute.
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DR_SECOND');
		aResult.SetValue(Self.DateRef);
	
	Else do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : Else');
		aResult.SetValue(Self.DateRef);
End case;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : DateRef ->');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, DateRef.TextValue.Value);
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- DateTimeRefSrv.GetDateRef : resultat ->');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, aResult.TextValue.Value);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DateTimeRefSrv.GetDateRef : End');

Return aResult;
end method;

------------------------------------------------------------
method DateTimeRefSrv.Init
begin
super.Init();
Self.DateRef = new();
Self.DateRef.SetValue('15-Jan-1998 12:12:35');

end method;

------------------------------------------------------------
method DateTimeRefSrv.SetDateRef(input pDateRef: Framework.DateTimeData)
begin
Self.DateRef.setValue(pDateRef);
Return;
end method;

------------------------------------------------------------
method DicoClassDesc.Init
begin
super.Init();
Self.ListElements = New();
end method;

------------------------------------------------------------
method DicoLibDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DicoRefDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+
Self.DicoClassName = new();
Self.IntCodeElement = new();
Self.LibElement = new();
Self.CodElement = new();
Self.OrderByValue = new();


end method;

------------------------------------------------------------
method DicoRefDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--	D. NGUYEN	|	30/10/1997	|	Ajout du CodElement.
--+
Self.SelfDesc.clear();
SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DicoClassName';
SelfDesc[SelfDesc.Items].ItemReference = DicoClassName;
SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'IntCodeElement';
SelfDesc[SelfDesc.Items].ItemReference = IntCodeElement;
SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LibElement';
SelfDesc[SelfDesc.Items].ItemReference = LibElement;
SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodElement';
SelfDesc[SelfDesc.Items].ItemReference = CodElement;
SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'OrderByValue';
SelfDesc[SelfDesc.Items].ItemReference = OrderByValue;


end method;

------------------------------------------------------------
method DicoRefDesc.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method DictionaryBSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Simplification de l'instanciation des services pour l'utilisateur.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryBSMgr.InitService');

-- Declarations


-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- The concret array Instances must contain the classtype list of his domain elements.

Self.AppendRow(aIdent = DictionaryService);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DictionaryBSMgr.InitService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DictionaryBSMgr.InitService');
		Raise;
 

end method;

------------------------------------------------------------
method DictionaryBSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour le démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryBSMgr.DoInitService');

Self.Dependances.AppendRow(SoDictionaryDSMgr);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-DictionaryBSMgr.DoInitService : End');
end method;

------------------------------------------------------------
method DictionaryBSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DictionaryDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  JB BRIAUD | 05/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = 'cle, nombre, nom';
Self.ClauseSelect  = '';
Self.ClauseFrom    = 'DicoRef';
Self.ClauseWhere   = '';
Self.ClauseOrderBy = 'DicoClassName, OrderByValue';
Temp : DicoRefDesc = New();
Self.RecordInstance = Temp.Clone(Deep = TRUE);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DictionaryDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DictionaryDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method DictionaryDS.Init
begin
--
--	Description : 	Initializes the class
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : DataService
--
--	History :
--
--	B. SAILLY	|	20/08/1996	|	Creation.
--  JB BRIAUD   |   23/05/1997  |   Gestion des DBSession par heritage
--+

super.Init();
end method;

------------------------------------------------------------
method DictionaryDS.ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Gets data from the SQL Database
--
--	Type :	Abstrait
--
--	Parametres :	Input/Output	--> aObject : Array of CacheDesc retrieved from the Database
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions :	DataConcurencyException	-> if data is locked by an external system or administrator
--					DataAvailabilityException -> the database is currently unavailable, but should come back soon
--					ImplementationExc	-> stop all processing
--
--	Usage : Global
--
--	Historique :
--
--  D. NGUYEN   |   29/07/1997  |   Creation.
--  D. NGUYEN   |   30/10/1997  |   Ajout du CodElement.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryDataService.ReadAction');
aRecords : Array of DicoRefDesc;

Sql Select 
	DicoRef.Id, 
	DicoRef.IdUtlQqo,
	DicoRef.DtMajQqo,
	DicoRef.DicoClassName,
	DicoRef.IntCodeElement,
	DicoRef.LibElement,
	DicoRef.CodElement
into :aRecords 
from
	DicoRef
Order by
	DicoRef.DicoClassName,
	DicoRef.OrderByValue
on Session Self.LaDbSession;

aDicoClasses : Array of DicoClassDesc = new();
TmpName : TextData = new(value='');
TmpVal : ListElement;
TmpLib : DicoLibDesc;
For aRec in aRecords do
	if not TmpName.IsEqual(aRec.DicoClassName,TRUE) then
		--Create the new DicoClass
		aDicoClasses.AppendRow();
		aDicoClasses[aDicoClasses.Items].DicoClassName = aRec.DicoClassName.Value;
		TmpName.SetValue(aRec.DicoClassName);
	end if;
	-- Add the Element to the current DicoClass
	TmpLib = new;
	TmpVal = new(ObjectValue=TmpLib);
	TmpVal.IntegerValue=aRec.IntCodeElement.Value;
	TmpLib.TextValue=aRec.LibElement.value;
	TmpLib.CodeValue=aRec.CodElement.value;
	aDicoClasses[aDicoClasses.Items].ListElements.AppendRow(Object=TmpVal);
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DictionaryDataService.ReadAction : End');

Return aDicoClasses;

Exception
	
	When e: DBOperationException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DictionaryDataService.ReadAction--> DBOperationException :');
		Raise;
	
	when e : DBResourceException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DictionaryDataService.ReadAction--> DBResourceException :');
		Raise;

	When e : GenericException do
		Task.Part.LogMgr.PutLine(ReadSqlText);
		Self.TraceExc(e, 'DictionaryDataService.ReadAction');
		Raise;

end method;

------------------------------------------------------------
method DictionaryDSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Simplification de l'instanciation des services pour l'utilisateur.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryDSMgr.DoAfterSyncServices');

Self.AppendRow(aIdent = DictionaryDS);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DictionaryDSMgr.DoAfterSyncServices : End');


Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DictionaryDSMgr.DoAfterSyncServices');
		Raise;
end method;

------------------------------------------------------------
method DictionaryDSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances de démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	29/07/1997	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DictionaryDataServiceMgr.DoInitService');

-- Declarations
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- Cas de l'utilisation d'un Service objet DBSession
Task.Part.LogMgr.PutLine('DBA : Option soDBSessionDico');
Self.FlagDbResource = FALSE;
Self.Dependances.AppendRow(soDBSessionDico);

-- ou 
/*
-- Cas de l'utilisation d'un Service objet DBResourceMgr
Task.Part.LogMgr.PutLine('DBA : Option DBResourceMgr');
Self.FlagDbResource = TRUE;
Self.laResourceName = '@AR01';
Self.laResourceUserName = 'exemple';
Self.laResourceUserPassword = 'exemple';
Self.Dependances.AppendRow(soDBResourceMgr);
*/
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DictionaryDataServiceMgr.DoInitService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DictionaryDataServiceMgr.DoInitService');
		Raise;
end method;

------------------------------------------------------------
method DictionaryDSMgr.Init
begin
super.Init();

end method;

------------------------------------------------------------
method DictionaryService.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Input		--> aTransdata :	Communication structure.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/06/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.Action');

-- Declarations

aResult : Object;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

	Case aTransData.TransActionService is
		when DICO_READ do
			aResult=Read((TransDico)(aTransData));
	end case;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Action : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method DictionaryService.Init
begin
super.Init();
References = new;
aServiceMgr = SoDictionaryDSMgr; -- Allocation of the service Manager of the dictionary

end method;

------------------------------------------------------------
method DictionaryService.Read(input aTransData: DataAccessSrvBD.TransDico): Framework.Object
begin
aResult : Object;
if not FirstRead then
	TmpObject : Object = new;
	TmpObject = ReadAction(aTransData);
	Self.References = (Array of DicoClassDesc)(TmpObject);
	FirstRead = TRUE;
End if;
if aTransData.aClassType <> NIL then
	For aCls in References do
		if aCls.DicoClassname = aTransData.aClassType.Name then
			TmpCls : DicoClassDesc = aCls.Clone(Deep=FALSE);
			case aTransData.TypeLib is
				When DICO_TYPLIB_STD do
					For aElt in TmpCls.ListElements do
						aElt.TextValue.Value = (DicoLibDesc)(aElt.ObjectValue).TextValue;
					end for;
				When DICO_TYPLIB_COD do
					For aElt in TmpCls.ListElements do
						aElt.TextValue.Value = (DicoLibDesc)(aElt.ObjectValue).CodeValue;
					end for;
			end case;
			aResult = TmpCls;
			exit;
		end if;
	end for;
else
	aResult = Self.References;
end if;
Return aResult;
end method;

------------------------------------------------------------
method DictionaryService.ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Reads the data flow and stores it in the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aTransdata :	Container of the object to append 
--					Return	--> Object     :	Container of the data flow.
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : BusinessTransactionServiceDesc.Read
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--	B. SAILLY	|	11/09/1996	|	Ajout du paramètre aTransData, suite intégration du
--								|   SoBusinessServiceMgr.
--+
aObject : Object;

aClassType  : ClassType;

-- Transfer to the manager for each BusinessService
aTransData.TransActionService = ACT_STD_READ;
aClassType  = DictionaryDS;
aObject = Self.Transfer (aTransData = aTransData, aServiceMgr = aServiceMgr, aClassType = aClassType);

Return aObject;

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'dicosrvb';


end DicoSrvBD;
begin TOOL DicoBD;

includes DataAccessSrvBD;
includes DicoSrvBD;
includes FrameworkBD;
includes GenericDBMS;
includes Framework;
includes SystemMonitor;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  AutoFillnNumDesc;
forward  CodDesc;
forward  CodeApplicationCrpDesc;
forward  CodeFamilleCrpDesc;
forward  CodeProduitDesc;
forward  CommentDesc;
forward  DateDesc;
forward interface DicoDesc;
forward  DteDesc;
forward  LibDesc;
forward  NbExemplairesCrpDesc;
forward  NomClientDesc;
forward  NomTestDesc;
forward  NumClientDesc;
forward  NumClientRcDesc;
forward  NumCommandeDesc;
forward  NumContratDesc;
forward  NumDesc;
forward  QuantiteDesc;
forward  RcTypTextNullable;
forward  RefDeviseDesc;
forward  RefTarifDesc;
forward  RefTypeEmetteurDesc;
forward  RefTypeProduitDesc;
forward  TextPersoCrpDesc;
forward  TypBinaryNullable;
forward  TypBooleanNullable;
forward  TypDatetimeNullable;
forward  TypDecimalNullable;
forward  TypDoubleNullable;
forward  TypImageNullable;
forward  TypIntegerNullable;
forward  TypIntervalNullable;
forward  TypTextNullable;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 3;
constant RC_COD_INCONNU = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class TypTextNullable inherits from Framework.TextNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.DataValue);
has public  method SetValue(input source: Framework.BinaryData);
has public  method SetValue(input source: Framework.integer);
has public  method SetValue(input source: Framework.double);
has public  method SetValue(input source: Framework.boolean);
has public  method SetValue(input source: Framework.TextData);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RcTypTextNullable inherits from DicoBD.TypTextNullable

has public  attribute ListeCharInterdit: Framework.string;
has public  attribute MajusculeBln: Framework.boolean;
has public  attribute MaxCharNbr: Framework.integer;

has public  method CheckCharInterdit: Framework.boolean;
has public  method CheckIsNull: Framework.boolean;
has public  method CheckMajuscule: Framework.boolean;
has public  method CheckMaxChar: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NumDesc inherits from DicoBD.RcTypTextNullable

has public  attribute MinCharNbr: Framework.integer;
has public  attribute NumeriqueBln: Framework.boolean;

has public  method CheckMinChar: Framework.boolean;
has public  method CheckNumerique: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class AutoFillnNumDesc inherits from DicoBD.NumDesc

has public  method SetValue(input source: Framework.integer);
has public  method SetValue(input source: Framework.TextData);
has public  method SetValue(input source: Framework.IntegerData);
has public  method SetValue(input source: Framework.string);

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypIntegerNullable inherits from Framework.IntegerNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.long);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.DataValue);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CodDesc inherits from DicoBD.TypIntegerNullable

has public  method CheckIsNull: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input mandat: Framework.boolean = TRUE,
	input value: Framework.boolean = TRUE): Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CodeApplicationCrpDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CodeFamilleCrpDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CodeProduitDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CommentDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypDatetimeNullable inherits from Framework.DateTimeNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetCurrent(input resolution: Framework.int = 7): Framework.DateTimeData;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.DateTimeData);
has public  method SetValue(input source: Framework.TextData);
has public  method SetValue(input source: Framework.DataValue);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class DateDesc inherits from DicoBD.TypDatetimeNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

interface DicoDesc inherits from FrameworkBD.ObjectIf

has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);

has property
	componentFlags = 8;
end interface;

class DteDesc inherits from DicoBD.TypDatetimeNullable

has public  attribute CheckNonFuturBln: Framework.boolean;

has public  method CheckIsNull: Framework.boolean;
has public  method CheckMandat: Framework.boolean;
has public  method CheckNonFutur: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method EstNonFutur: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class LibDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NbExemplairesCrpDesc inherits from DicoBD.TypIntegerNullable

has public  method CheckValue: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NomClientDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NomTestDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NumClientDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NumClientRcDesc inherits from DicoBD.AutoFillnNumDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NumCommandeDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NumContratDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class QuantiteDesc inherits from DicoBD.TypIntegerNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefDeviseDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTarifDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeEmetteurDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeProduitDesc inherits from DicoBD.CodDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TextPersoCrpDesc inherits from DicoBD.TypTextNullable

has public  method CheckValue: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypBinaryNullable inherits from Framework.BinaryNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.DataValue);
has public  method SetValue(input source: Framework.ImageData);
has public  method SetValue(input source: Framework.BinaryData);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.TextData);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypBooleanNullable inherits from Framework.BooleanNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.boolean);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.DataValue);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypDecimalNullable inherits from Framework.DecimalNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.double);
has public  method SetValue(input source: Framework.DataValue);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.TextData);
has public  method SetValue(input source: Framework.NumericData);
has public  method SetValue(input source: Framework.DecimalData);
has public  method SetValue(input source: Framework.long);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypDoubleNullable inherits from Framework.DoubleNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.double);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.DataValue);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TypImageNullable inherits from Framework.ImageNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.DataValue);
has public  method SetValue(input source: Framework.TextData);
has public  method SetValue(input source: Framework.string);
has public  method SetValue(input source: Framework.BinaryData);
has public  method SetValue(input source: Framework.ImageData);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TypIntervalNullable inherits from Framework.IntervalNullable

has public  attribute ListValues: Framework.Array of Framework.ListElement;

has public  method CheckMandat: Framework.boolean;
has public  method CheckValue: Framework.boolean;
has public  method DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean;
has public  method DoCheckWarning: FrameworkBD.Warning;
has public  method FillString(input target: Framework.TextData);
has public  method GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc;
has public  method Init;
has public  method SetListValues(input pListValues: Framework.Array of Framework.ListElement);
has public  method SetValue(input source: Framework.DataValue);
has public  method SetValue(input source: Framework.TextData);
has public  method SetValue(input source: Framework.IntervalData);
has public  method SetValue(input source: Framework.string);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

implements	DicoBD.DicoDesc;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method AutoFillnNumDesc.SetValue(input source: Framework.integer)
begin
--
--	Description : 	
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globlal
--
--	History :
--
--	PDG	|	21/04/1998	|	Remontée de cette méthode de NumClientRcDesc dans AutoFillnNumDesc
--	PDG	|	13/10/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AutoFillnNumDesc.SetValue(integer)');

-- Déclarations
unText : TextData;

-- Traitements
unText = New();
unText.SetValue(source);
for i in unText.ActualSize + 1 to self.MinCharNbr do
	unText.ReplaceRange('0', 0, 0);
end for;
super.SetValue(unText);

-- Fin des traitements

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-  AutoFillnNumDesc.SetValue : End');
end method;

------------------------------------------------------------
method AutoFillnNumDesc.SetValue(input source: Framework.TextData)
begin
--
--	Description : 	
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globlal
--
--	History :
--
--	PDG	|	21/04/1998	|	Remontée de cette méthode de NumClientRcDesc dans NumDesc.
--	PDG	|	13/10/1997	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AutoFillnNumDesc.SetValue(TextData)');

source.OffSet = 0;
for i in source.ActualSize + 1 to self.MinCharNbr do --i
	source.ReplaceRange('0', 0, 0);
end for; --i
--
super.SetValue(source);
--	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AutoFillnNumDesc.SetValue(TextData) : End');
end method;

------------------------------------------------------------
method AutoFillnNumDesc.SetValue(input source: Framework.IntegerData)
begin
--
--	Description : 	
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globlal
--
--	History :
--
--	PDG	|	21/04/1998	|	Remontée de cette méthode de NumClientRcDesc dans NumDesc.
--	PDG	|	13/10/1997	|	Creation.
--+
Self.SetValue(source.value);
end method;

------------------------------------------------------------
method AutoFillnNumDesc.SetValue(input source: Framework.string)
begin
--
--	Description : 	
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globlal
--
--	History :
--
--	PDG	|	21/04/1998	|	Remontée de cette méthode de NumClientRcDesc dans NumDesc.
--	PDG	|	13/10/1997	|	Creation.
--+
super.SetValue(source);
end method;

------------------------------------------------------------
method CodDesc.CheckIsNull: Framework.boolean
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	BL	|	30/10/1997	|	Creation
--+

unResult : Boolean = FALSE;

If self.IsNull then
 	unResult = TRUE;
elseif self.IntegerValue = 0 then
 		unResult = TRUE;
end if;
--
return unResult;
end method;

------------------------------------------------------------
method CodDesc.CheckValue: Framework.boolean
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Classe
--
--	Historique :
--
--	PDG	|	11/09/1997	|	Creation
--+
aResult : Boolean = FALSE;
if not (Self.IsNull or Self.Value = 0) then
	if ListValues <> NIL then
		if ListValues.Items > 0 then
			For aVal in ListValues do
				if aVal.IntegerValue = Self.value then
					aResult = TRUE;
					exit;
				end if;
			End For;
		else
			aResult = TRUE;
		end	if;
	else
		aResult = TRUE;
	end if;
	if aResult = FALSE then
		aMessageText : String;
		aMessageText  = 'pas dans la liste des valeurs autorisées';
		Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
		Self.TraceExc(Exc, aMessageText);
		raise Exc;
	end if;
end if;

Return aResult;
end method;

------------------------------------------------------------
method CodDesc.DoCheckValidity(input mandat: Framework.boolean = TRUE,
	input value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description :	le nom est obligatoire	
--
--	Type :	Concret
--
--	Parametres :	Input	--> mandat :	obligatoire
--					Input	--> value  :	controle de valeur
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	BL	|	13/08/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CodDesc.DoCheckValidity');

-- Declaration
unRes : Boolean;

-- Traitement
unRes = super.DoCheckValidity(mandat = mandat, value = value);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CodDesc.DoCheckValidity : End');

Return unRes;

end method;

------------------------------------------------------------
method CodDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Classe
--
--	Historique :
--
--	PDG	|	11/09/1997	|	Creation
--+
super.Init();

self.SetValue(RC_COD_INCONNU);
end method;

------------------------------------------------------------
method CodeApplicationCrpDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CodeFamilleCrpDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CodeProduitDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CommentDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DateDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DteDesc.CheckIsNull: Framework.boolean
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--  BL  |   01/10/1997  |   Rajout de dt pour que le test se fasse bien
--	PDG	|	09/09/1997	|	La date non renseignée est maintenant Self.IsNull = TRUE (modif retirée)
--+

unResult : Boolean = FALSE;

If self.IsNull then
 	unResult = TRUE;
else
	dt : DateTimeData = new;
	dt.SetValue('01-Jan-1516 00:00:00');
	If Self.IsLessThan(dt) then
 		unResult = TRUE;
 	else
		dt.SetValue('01-Jan-2999 00:00:00');
		If self.IsGreaterThan(dt) then
	 		unResult = TRUE;
		end if;
	end if;
end if;
--
return unResult;
end method;

------------------------------------------------------------
method DteDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Controls the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : DteDesc
--
--	History :
--
--	PDG	|	03/11/1997	|	Creation.
--+

if Self.CheckIsNull() then
	raise GenerateException('Saisie obligatoire');
end if;

Return TRUE;

end method;

------------------------------------------------------------
method DteDesc.CheckNonFutur: Framework.boolean
begin
--
--	Description : verifie que la date saisie n'est pas future. 	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	06/08/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DteDesc.CheckNonFutur');

-- Declarations
unResultat : Boolean = TRUE;
uneDte : DateTimeData = New();

-- Traitement
uneDte.SetCurrent();
--
if uneDte.IsGreaterThan(Self) then
    unResultat = TRUE;
else --1
	unResultat = FALSE;
	uneExc : RecordAttributeValidityExc = GenerateException('Est une date future.');
	Self.TraceExc(uneExc, 'DteDesc.CheckNonFutur');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DteDesc.CheckNonFutur : End');
--
Return unResultat;
end method;

------------------------------------------------------------
method DteDesc.CheckValue: Framework.boolean
begin
--
--	Description :		
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	06/08/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DteDesc.CheckValue');

-- Declarations
unResultat : Boolean = FALSE;
-- Traitement
super.CheckValue;
--
if Self.CheckNonFuturBln = TRUE then
	Self.CheckNonFutur();
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DteDesc.CheckValue : End');
--
Return unResultat;

end method;

------------------------------------------------------------
method DteDesc.EstNonFutur: Framework.boolean
begin
--
--	Description : renvoie vrai ou faux suivant si la date saisie est ou pas future. 	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	BL	|	02/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DteDesc.EstNonFutur');

-- Declarations
unResultat : Boolean = TRUE;
uneDte : DateTimeData = New();

-- Traitement
uneDte.SetCurrent();
--
if uneDte.IsGreaterThan(Self) then
    unResultat = TRUE;
else 
	unResultat = FALSE;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DteDesc.EstNonFutur : End');
--
Return unResultat;
end method;

------------------------------------------------------------
method DteDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	PDG	|	23/12/1997	|	Valeur par défaut.
--	PDG	|	07/05/1997	|	Creation
--+

super.Init();
--
--Self.SetValue('01-Jan-1515 00:00:00');
Self.IsNull = TRUE;
--
Self.CheckNonFuturBln = FALSE;
end method;

------------------------------------------------------------
method LibDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NbExemplairesCrpDesc.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	Super.CheckValue();
else
	aResult = TRUE;
	if Self.Value > 10 then
		aMessageText : String;
		aMessageText  = 'Un nombre d''exemplaires doit être inférieur ou égal à 10.';
		Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
		raise Exc;
	end if;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method NbExemplairesCrpDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NomClientDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NomTestDesc.Init
begin
super.Init();

Self.ListValues = new();
TmpVal : ListElement = new();
TmpVal.IntegerValue=1;
TmpVal.TextValue.SetValue('Toto');
Self.ListValues.AppendRow(Object=TmpVal);
TmpVal = new();
TmpVal.IntegerValue=2;
TmpVal.TextValue.SetValue('Titi');
Self.ListValues.AppendRow(Object=TmpVal);

end method;

------------------------------------------------------------
method NumClientDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NumClientRcDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : NumClientDesc
--
--	Historique :
--
--  PDG |  01/10/1997  |   Création
--+

super.Init();
--
self.MinCharNbr = 7;
self.MaxCharNbr = 7;
Self.ListeCharInterdit = '';
end method;

------------------------------------------------------------
method NumCommandeDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NumContratDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NumDesc.CheckMinChar: Framework.boolean
begin
--
--	Description : verifie que la longueur est au dessus du min
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	24/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NumDesc.CheckMinChar');

-- Declarations
unResultat : Boolean = FALSE;
-- Traitement
if self.MinCharNbr <= self.ActualSize then
    unResultat = TRUE;
else
	unResultat = FALSE;
	unMessageText : TextData = New();
	unMessageText.SetValue('Est trop court, moins de : ');
	unMessageText.Concat(source = self.MinCharNbr);
	uneExc : RecordAttributeValidityExc = GenerateException(unMessageText.value);
	Self.TraceExc(uneExc, 'NumDesc.CheckMinChar');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NumDesc.CheckMinChar : End');
--
Return unResultat;
end method;

------------------------------------------------------------
method NumDesc.CheckNumerique: Framework.boolean
begin
--
--	Description : verifie que le lib est numérique
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NumDesc.CheckNumerique');

-- Declarations
unResultat : Boolean = FALSE;
unBln : Boolean = TRUE;

-- Traitement
self.Offset = 0;
--
while not self.IsAtEnd do
	if not self.IsDigit
   		then
   			unBln = FALSE;
   			Exit;
   	end if;
	self.MoveNext();   
end while;
--
if unBln then
    unResultat = TRUE;
else
	unResultat = FALSE;
	unMessageText : String;
	unMessageText = 'N''est pas numérique.';
	uneExc : RecordAttributeValidityExc = GenerateException(unMessageText);
	Self.TraceExc(uneExc, 'NumDesc.CheckNumerique');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NumDesc.CheckNumerique : End');

Return unResultat;

end method;

------------------------------------------------------------
method NumDesc.CheckValue: Framework.boolean
begin
--
--	Description : verifie qu'un numéro a au moins n car, qu'il est numérique
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  PDG |   15/04/1998  |   NumeriqueBln
--	PDG	|	07/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NumDesc.CheckValue');

-- Declarations
unResultat : Boolean = FALSE;

-- Traitement
super.CheckValue;
--
if self.MinCharNbr > 0 then
	self.CheckMinChar();
end if;

if self.NumeriqueBln then
	self.CheckNumerique();
end if;
	
-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NumDesc.CheckValue : End');

Return unResultat;
 

end method;

------------------------------------------------------------
method NumDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	PDG	|	07/05/1997	|	Creation
--+

super.Init();
--
self.MinCharNbr = 10;
self.MaxCharNbr = 20;
Self.ListeCharInterdit = '';
Self.NumeriqueBln = TRUE;
end method;

------------------------------------------------------------
method QuantiteDesc.Init
begin
super.Init();
Self.SetValue(0);

end method;

------------------------------------------------------------
method RcTypTextNullable.CheckCharInterdit: Framework.boolean
begin
--
--	Description : verifie que le lib ne conteint pas de caracteres interdits
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RcTypTextNullable.CheckCarInterdit');

-- Declarations
unResultat : Boolean = FALSE;

-- Traitement
self.OffSet = 0;
if not self.MoveToChar(ListOfChars = ListeCharInterdit) then
    unResultat = TRUE;
else
	unResultat = FALSE;
	unMessageText : TextData = New();
	unMessageText.SetValue('Contient au moins un caractère interdit.');
	uneExc : RecordAttributeValidityExc = GenerateException(unMessageText.value);
	Self.TraceExc(uneExc, 'RcTypTextNullable.CheckCharInterdit');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RcTypTextNullable.CheckCharInterdit : End');

Return unResultat;

end method;

------------------------------------------------------------
method RcTypTextNullable.CheckIsNull: Framework.boolean
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	PDG	|	03/11/1997	|	Creation
--+

unResult : Boolean = FALSE;

If self.ActualSize = 0 then
 	unResult = TRUE;
end if;
--
return unResult;
end method;

------------------------------------------------------------
method RcTypTextNullable.CheckMajuscule: Framework.boolean
begin
--
--	Description : verifie que le nom est en majuscules
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  PDG	|	30/09/1997	|	mise ds RcTypTextNullable
--	PDG	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RcTypTextNullable.CheckMajuscule');

-- Declarations
unResultat : Boolean = FALSE;
unTextData : TextData;
-- Traitement
super.CheckValue;

unTextData = New( value = self.value);
if unTextData.ToUpper().IsEqual(self) then
    unResultat = TRUE;
else
	unResultat = FALSE;
	unMessageText : TextData = New();
	unMessageText.SetValue('contient au moins un caractère minuscule.');
	uneExc : RecordAttributeValidityExc = GenerateException(unMessageText.value);
	Self.TraceExc(uneExc, 'NomLibDesc.CheckMajuscule');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RcTypTextNullable.CheckMajuscule : End');
--
Return unResultat;

end method;

------------------------------------------------------------
method RcTypTextNullable.CheckMaxChar: Framework.boolean
begin
--
--	Description : verifie que la longueur ne depasse pas la longueur max	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RcTypTextNullable.CheckMaxChar');

-- Declarations
unResultat : Boolean = FALSE;
-- Traitement
if self.MaxCharNbr >= self.ActualSize then
    unResultat = TRUE;
else --1
	unResultat = FALSE;
	unMessageText : TextData = New();
	unMessageText.SetValue('Depasse la longueur maximale: ');
	unMessageText.Concat(source = self.MaxCharNbr);
	uneExc : RecordAttributeValidityExc = GenerateException(unMessageText.value);
	Self.TraceExc(uneExc, 'RcTypTextNullable.CheckMaxChar');
	raise uneExc;
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RcTypTextNullable.CheckMaxChar : End');
--
Return unResultat;
end method;

------------------------------------------------------------
method RcTypTextNullable.CheckValue: Framework.boolean
begin
--
--	Description :		
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PDG	|	27/05/1997	|	ajout des caracteres interdits et des tests conditionnels.
--	PDG	|	06/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RcTypTextNullable.CheckValue');

-- Declarations
unResultat : Boolean = FALSE;
-- Traitement
super.CheckValue;

if self.MaxCharNbr > 0 then
	self.CheckMaxChar();
end if;

if self.ListeCharInterdit <> '' then
	self.CheckCharInterdit();
end if;

if self.MajusculeBln then
	self.CheckMajuscule();
end if;

-- Fin du traitement
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RcTypTextNullable.CheckValue : End');
--
Return unResultat;

end method;

------------------------------------------------------------
method RcTypTextNullable.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	PDG	|	08/09/1997	|	Creation
--+

super.Init();
Self.ListeCharInterdit = '';
Self.MaxCharNbr = 0;
Self.MajusculeBln = FALSE;
end method;

------------------------------------------------------------
method RefDeviseDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTarifDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeEmetteurDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	BL	|	30/03/1998	|	Creation
--+

super.Init();
end method;

------------------------------------------------------------
method RefTypeProduitDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Vous devez sélectionner le produit';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method RefTypeProduitDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TextPersoCrpDesc.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	Super.CheckValue();
else
	aResult = TRUE;
	if Self.ActualSize > 401 then
		aMessageText : String;
		aMessageText  = 'Taille limitée à 400 caractères.';
		Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
		raise Exc;
	end if;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TextPersoCrpDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypBinaryNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypBinaryNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypBinaryNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypBinaryNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypBinaryNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypBinaryNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypBinaryNullable.Init
begin
super.Init();

end method;

------------------------------------------------------------
method TypBinaryNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypBinaryNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBinaryNullable.SetValue(input source: Framework.ImageData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBinaryNullable.SetValue(input source: Framework.BinaryData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBinaryNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBinaryNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBinaryNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypBooleanNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypBooleanNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypBooleanNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypBooleanNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypBooleanNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypBooleanNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypBooleanNullable.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypBooleanNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypBooleanNullable.SetValue(input source: Framework.boolean)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBooleanNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBooleanNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypBooleanNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypDatetimeNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypDatetimeNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypDatetimeNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypDatetimeNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypDatetimeNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypDatetimeNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypDatetimeNullable.Init
begin
super.Init();
Self.SetValue('01-Jan-1753 00:00:00');
end method;

------------------------------------------------------------
method TypDatetimeNullable.SetCurrent(input resolution: Framework.int = 7): Framework.DateTimeData
begin
aResult : DateTimeData;
if Task.Part.LogMgr.Test(Type = SP_MT_CONFIGURATION, ServiceId = SP_ST_USER3, Group = 50, Level = 3) then
	aResult=new();
	aResult.setValue(SoDateTimeRef.GetDateRef(resolution));
	Self.SetValue(aResult.value);
elseif Task.Part.LogMgr.Test(Type = SP_MT_CONFIGURATION, ServiceId = SP_ST_USER3, Group = 50, Level = 2) then
	TmpDateRef : DateTimeData = SoDateTimeRef.GetDateRef();
	aResult = new;
	aResult.setCurrent(resolution);
	BegPos,EndPos : integer;
	TmpDateRef.TextValue.MoveToChar(' ');
	aResult.TextValue.ReplaceRange(TmpDateRef.TextValue.CopyRange(0,TmpDateRef.TextValue.OffSet),0,TmpDateRef.TextValue.OffSet);
	Self.SetValue(aResult);
else
	aResult = Super.setCurrent(resolution);
end if;

Return aResult;
end method;

------------------------------------------------------------
method TypDatetimeNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypDatetimeNullable.SetValue(input source: Framework.DateTimeData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDatetimeNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDatetimeNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDatetimeNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypDecimalNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypDecimalNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypDecimalNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypDecimalNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypDecimalNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypDecimalNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypDecimalNullable.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypDecimalNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.double)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.NumericData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.DecimalData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.SetValue(input source: Framework.long)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDecimalNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypDoubleNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypDoubleNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypDoubleNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypDoubleNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypDoubleNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypDoubleNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypDoubleNullable.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypDoubleNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypDoubleNullable.SetValue(input source: Framework.double)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDoubleNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDoubleNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypDoubleNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypImageNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypImageNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypImageNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypImageNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypImageNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypImageNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypImageNullable.Init
begin
super.Init();

end method;

------------------------------------------------------------
method TypImageNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypImageNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypImageNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypImageNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypImageNullable.SetValue(input source: Framework.BinaryData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypImageNullable.SetValue(input source: Framework.ImageData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypImageNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypIntegerNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypIntegerNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypIntegerNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypIntegerNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypIntegerNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypIntegerNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypIntegerNullable.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypIntegerNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypIntegerNullable.SetValue(input source: Framework.long)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntegerNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntegerNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntegerNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypIntervalNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	raise GenerateException(aMessageText);
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypIntervalNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypIntervalNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypIntervalNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypIntervalNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypIntervalNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypIntervalNullable.Init
begin
super.Init();

end method;

------------------------------------------------------------
method TypIntervalNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypIntervalNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntervalNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntervalNullable.SetValue(input source: Framework.IntervalData)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntervalNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypIntervalNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method TypTextNullable.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Mandatory input';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method TypTextNullable.CheckValue: Framework.boolean
begin
aResult : Boolean = FALSE;
if ListValues <> NIL then
	if ListValues.Items > 0 then
		For aVal in ListValues do
			if aVal.TextValue.Value = Self.TextValue.value then
				aResult = TRUE;
				exit;
			end if;
		End For;
	else
		aResult = TRUE;
	end	if;
else
	aResult = TRUE;
end if;
if aResult = FALSE then
	aMessageText : String;
	aMessageText  = 'The input is not in the Value Domain';
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;
Return aResult;
end method;

------------------------------------------------------------
method TypTextNullable.DoCheckValidity(input Mandat: Framework.boolean = TRUE,
	input Value: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : 	Control the form of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : AccordDemandeDesc
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+

aResult : Boolean = TRUE;
if Mandat then
	aResult = CheckMandat();
end if;
if Value then
	if not Self.IsNull then
		CheckValue();
	end if;
end if; 
Return aResult;
end method;

------------------------------------------------------------
method TypTextNullable.DoCheckWarning: FrameworkBD.Warning
begin
unResult : Warning;
Return unResult;

end method;

------------------------------------------------------------
method TypTextNullable.FillString(input target: Framework.TextData)
begin
super.FillString(target);
end method;

------------------------------------------------------------
method TypTextNullable.GenerateException(input aMessageText: Framework.string): FrameworkBD.RecordAttributeValidityExc
begin
--
--	Description : 	create an exception
--
--	Type :	Concret
--
--	Parameters :	- input : aMessageText
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
ErrRecAttributeValidityExc : RecordAttributeValidityExc = new();
ErrRecAttributeValidityExc.setWithParams(severity = SP_ER_ERROR,	message = aMessageText);
return ErrRecAttributeValidityExc;

end method;

------------------------------------------------------------
method TypTextNullable.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TypTextNullable.SetListValues(input pListValues: Framework.Array of Framework.ListElement)
begin
Self.ListValues = pListValues;

Return;
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.string)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.DataValue)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.BinaryData)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.integer)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.double)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.boolean)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.SetValue(input source: Framework.TextData)
begin
super.SetValue(source);
--DoCheckValidity(FALSE);
end method;

------------------------------------------------------------
method TypTextNullable.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parameters :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'dicobd';


end DicoBD;
begin TOOL AddDicoBD;

includes DicoBD;
includes FrameworkBD;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  CodeClientDesc;
forward  CommentaireDesc;
forward  CommentDesc;
forward  ConditionDesc;
forward  DestineProspectDesc;
forward  MontantDesc;
forward  NomDesc;
forward  NomRegleDesc;
forward  PackageBlnDesc;
forward  RefCanalDesc;
forward  RefTypeCodeODDesc;
forward  RefTypeEmetteurEvt;
forward  RefTypePackageDesc;
forward  RefTypePromotionDesc;
forward  RefTypeRubriqueODDesc;
forward  RefTypeServiceDesc;
forward  RefTypeStrategieDesc;
forward  RefTypeTarifDesc;
forward  RemisableDesc;
forward  TarifableDesc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 3;
constant RC_COD_INCONNU = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class CodeClientDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CommentDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class CommentaireDesc inherits from AddDicoBD.CommentDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class ConditionDesc inherits from DicoBD.LibDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class DestineProspectDesc inherits from DicoBD.TypBooleanNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class MontantDesc inherits from DicoBD.LibDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NomDesc inherits from DicoBD.LibDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class NomRegleDesc inherits from DicoBD.LibDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class PackageBlnDesc inherits from DicoBD.TypBooleanNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefCanalDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeCodeODDesc inherits from DicoBD.TypTextNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeEmetteurEvt inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypePackageDesc inherits from DicoBD.CodDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypePromotionDesc inherits from DicoBD.CodDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeRubriqueODDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeServiceDesc inherits from DicoBD.CodDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeStrategieDesc inherits from DicoBD.CodDesc

has public  method CheckMandat: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RefTypeTarifDesc inherits from DicoBD.CodDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class RemisableDesc inherits from DicoBD.TypBooleanNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;

class TarifableDesc inherits from DicoBD.TypBooleanNullable

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method CodeClientDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CommentaireDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aResult = FALSE;
end if;
	
Return aResult;

end method;

------------------------------------------------------------
method CommentaireDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CommentDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ConditionDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'La condition est obligatoire';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method ConditionDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DestineProspectDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MontantDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Le montant est obligatoire';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method MontantDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NomDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NomRegleDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Le nom de la règle est obligatoire';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method NomRegleDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PackageBlnDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefCanalDesc.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	Stéphane LEBLEU	|	10/11/1997	|	Creation
--+

super.Init();
end method;

------------------------------------------------------------
method RefTypeCodeODDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeEmetteurEvt.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypePackageDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Vous devez sélectionner le package';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method RefTypePackageDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypePromotionDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Vous devez sélectionner la promotion';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method RefTypePromotionDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeRubriqueODDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeServiceDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Vous devez sélectionner le service';
	aResult = FALSE;
end if;
	
if not (aResult) then
	Exc : RecordAttributeValidityExc = GenerateException(aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
end if;

Return aResult;

end method;

------------------------------------------------------------
method RefTypeServiceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeStrategieDesc.CheckMandat: Framework.boolean
begin
--
--	Description : 	Control the mandat of the Data
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TypBooleanNullable
--
--	History :
--
--	D.NGUYEN	|	15/10/1996	|	Creation.
--+
aResult : Boolean = TRUE;
aMessageText : String;

if Self.TextValue.value = '' or Self.IsNull then
	aMessageText  = 'Vous devez sélectionner une stratégie';
	aResult = FALSE;
end if;
	

Return aResult;

end method;

------------------------------------------------------------
method RefTypeStrategieDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RefTypeTarifDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RemisableDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarifableDesc.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'adddicob';


end AddDicoBD;
begin TOOL AddFrameworkBD;

includes FrameworkBD;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  CatalogueException;
forward  ErreurCompilationExc;
forward  ErreurPrixPublicExc;
forward  IllegalTarifExc;
forward  PresenceARenseignerExc;
forward  RegleTypeInvalideExc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_TARIF_APPEND_EVTREJETE = 15017;
constant ACT_TARIF_APPEND_EVTTARIFE = 15018;
constant ACT_TARIF_APPEND_SANSCONTROLE = 15019;
constant ACT_TARIF_CALCULTARIF = 15008;
constant ACT_TARIF_COMPLETION_AUTOMATIQUE = 15020;
constant ACT_TARIF_CONTROLE_EVENEMENT = 15025;
constant ACT_TARIF_ERREUR_SIARENSEIGNER = 15021;
constant ACT_TARIF_MISEENPRODUCTION = 15011;
constant ACT_TARIF_PRODUITSEMIS_PARRC = 15022;
constant ACT_TARIF_READALL_EVT = 15016;
constant ACT_TARIF_READALL_REGLE = 15015;
constant ACT_TARIF_READCODEPRODUIT = 15001;
constant ACT_TARIF_READCODEPROMOTION = 15005;
constant ACT_TARIF_READCODESERVICE = 15002;
constant ACT_TARIF_READCODESERVICETARIFABLE = 15003;
constant ACT_TARIF_READPRIXPUBLIC = 15006;
constant ACT_TARIF_READSERVICENONREMISABLE = 15012;
constant ACT_TARIF_RETROCESSION = 15024;
constant ACT_TARIF_SERVICESEMIS_PARRC = 15021;
constant ACT_TARIF_TAUX = 15026;
constant ACT_TARIF_UNSEULPRIXPUBLIC = 15010;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class CatalogueException inherits from FrameworkBD.RecordValidityExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurCompilationExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurPrixPublicExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class IllegalTarifExc inherits from FrameworkBD.RecordValidityExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class PresenceARenseignerExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RegleTypeInvalideExc inherits from FrameworkBD.RecordValidityExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method CatalogueException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurCompilationExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurPrixPublicExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method IllegalTarifExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PresenceARenseignerExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RegleTypeInvalideExc.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'addframe';


end AddFrameworkBD;
begin TOOL CatalogueSrv;

includes AddDicoBD;
includes AddFrameworkBD;
includes DataAccessSrvBD;
includes DicoBD;
includes FrameworkBD;
includes GenericDBMS;
includes DisplayProject;
includes Framework;
includes SecuritySrvBD;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  CatalogueBSMgr;
forward  CatalogueDSMgr;
forward  LienPackagePackageDesc;
forward  LienPackagePackageDS;
forward  LienPackageProduitDesc;
forward  LienPackageProduitDS;
forward  LienProduitServiceDesc;
forward  LienProduitServiceDS;
forward  PackageBS;
forward  PackageDesc;
forward  PackageDS;
forward  ProduitBS;
forward  ProduitCommercialDesc;
forward  ProduitDesc;
forward  ProduitDS;
forward  PromotionBS;
forward  PromotionDesc;
forward  PromotionDS;
forward  PromotionParam;
forward  Service_Desc;
forward  ServiceBS;
forward  ServiceDescSql;
forward  ServiceDS;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_CP_GETPRODUIT = 15000;
constant EMETTEUR_EVENEMENT_BATCH_RC = 5;
constant EMETTEUR_EVENEMENT_RC = 3;
constant EMETTEUR_EVENEMENT_SAB = 4;
constant LOG_GRPFLAG = 66;
constant TYPE_TARIF_FIXE = 1;
constant TYPE_TARIF_MONTANT = 2;
constant TYPE_TARIF_QUANTITE = 3;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class CatalogueBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class CatalogueDSMgr inherits from DataAccessSrvBD.DataServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class LienPackagePackageDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute IdPackageDesc: DicoBD.TypIntegerNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LienPackagePackageDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class LienPackageProduitDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute IdPackageDesc: DicoBD.TypIntegerNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LienPackageProduitDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class LienProduitServiceDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute IdProduitDesc: DicoBD.TypIntegerNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LienProduitServiceDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class PackageBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method LireCodeProduit(input aCodePackage: AddDicoBD.RefTypePackageDesc,
	input output ListeProduit: Framework.Array of DicoBD.RefTypeProduitDesc);

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ProduitCommercialDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;
has public  attribute Description: AddDicoBD.CommentDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class PackageDesc inherits from CatalogueSrv.ProduitCommercialDesc

has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute LienPackages: Framework.Array of CatalogueSrv.LienPackagePackageDesc;
has public  attribute LienProduits: Framework.Array of CatalogueSrv.LienPackageProduitDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class PackageDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ProduitBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method LireCodeService(input aCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc;
has public  method LireProduitDontEvtEmisRC: Framework.Array of DicoBD.RefTypeProduitDesc;
has public  method LireServiceDontEvtEmisRC(input UnCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc;
has public  method LireServiceTarifable(input aCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ProduitDesc inherits from CatalogueSrv.ProduitCommercialDesc

has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute DestineProspectBln: AddDicoBD.DestineProspectDesc;
has public  attribute LienServices: Framework.Array of CatalogueSrv.LienProduitServiceDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;
has public  method IsDestineProspect: Framework.boolean;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ProduitDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class PromotionBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method LireCodePromotion(input adevise: DicoBD.RefDeviseDesc,
	input acategorie: DicoBD.RefTarifDesc,
	input apackage: AddDicoBD.RefTypePackageDesc,
	input aproduit: DicoBD.RefTypeProduitDesc,
	input aservice: AddDicoBD.RefTypeServiceDesc): Framework.Array of AddDicoBD.RefTypePromotionDesc;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class PromotionDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;
has public  attribute LibellePromotion: DicoBD.LibDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class PromotionDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class PromotionParam inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;

has public  method DoResetAttributes;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class Service_Desc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeOD: AddDicoBD.RefTypeCodeODDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute EmetteurEvenement: DicoBD.RefTypeEmetteurDesc;
has public  attribute LibelleFacturation: DicoBD.LibDesc;
has public  attribute RemisableBln: AddDicoBD.RemisableDesc;
has public  attribute RubriqueOD: AddDicoBD.RefTypeRubriqueODDesc;
has public  attribute TarifableBln: AddDicoBD.TarifableDesc;
has public  attribute TypeTarif: AddDicoBD.RefTypeTarifDesc;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;
has public  method IsRemisable: Framework.boolean;
has public  method IsTarifable: Framework.boolean;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ServiceBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method LireServiceNonRemisable: Framework.Array of AddDicoBD.RefTypeServiceDesc;
has public  method LireServicesEmisParRC: Framework.Array of CatalogueSrv.ServiceDescSql;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ServiceDescSql inherits from CatalogueSrv.Service_Desc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ServiceDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soCatalogueBSMgr : CatalogueSrv.CatalogueBSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '2CE23640-BE69-11D1-B3FD-58AE4269AA77');
service soCatalogueDBSession : GenericDBMS.DBSession = (DialogDuration = SESSION,
	Visibility = user,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '5683E3D9-0BFC-11D1-BE4E-1F5BB6EEAA77');
service soCatalogueDSMgr : CatalogueSrv.CatalogueDSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '63093BF0-CFC8-11D1-A3BB-5DE1593DAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method CatalogueBSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	CDC :
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoAfterSyncservicesService');



-- Traitement

Self.AppendRow(aIdent = PackageBS);
Self.AppendRow(aIdent = ProduitBS);
Self.AppendRow(aIdent = PromotionBS);
Self.AppendRow(aIdent = ServiceBS);


-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CatalogueBSMgr.DoAfterSyncService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CatalogueBSMgr.DoAfterSyncService');
		Raise;
 
end method;

------------------------------------------------------------
method CatalogueBSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour le démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	CDC :
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoInitService');


--Self.Dependances.AppendRow(SoNotificationSrv);
--Self.NotificationService = SoNotificationSrv; 
Self.Dependances.AppendRow(soCatalogueDSMgr);


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoInitService');

end method;

------------------------------------------------------------
method CatalogueBSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CatalogueDSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	CDC	|

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueDSMgr.DoAfterSyncServices');

Self.AppendRow(LienPackagePackageDS);
Self.AppendRow(LienPackageProduitDS);
Self.AppendRow(LienProduitServiceDS);
Self.AppendRow(PackageDS);
Self.AppendRow(ProduitDS);
Self.AppendRow(PromotionDS);
Self.AppendRow(ServiceDS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CatalogueDSMgr.DoAfterSyncServices : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CatalogueDSMgr.DoAfterSyncServices');
		Raise;
end method;

------------------------------------------------------------
method CatalogueDSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances de démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	CDC :
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueDSMgr.DoInitService');

-- Declarations
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.Dependances.AppendRow(soCatalogueDBSession);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CatalogueDSMgr.DoInitService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CatalogueDSMgr.DoInitService');
		Raise;
end method;

------------------------------------------------------------
method CatalogueDSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienPackagePackageDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackagePackageDesc.DoResetAttributes');

Self.CodePackage = new();
Self.IdPackageDesc= new();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackagePackageDesc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method LienPackagePackageDesc.DoResetSelfDesc
begin
--
--	Description : 	instanciation de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackagePackageDesc.DoResetSelfDesc');

SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'IdPackageDesc';
SelfDesc[SelfDesc.Items].ItemReference = Self.IdPackageDesc;
SelfDesc[SelfDesc.Items].ItemUserName = 'Identifiant Package';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdPackageDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePackage ';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackagePackageDesc.DoResetSelfDesc : End');

end method;

------------------------------------------------------------
method LienPackagePackageDesc.DoResetService
begin
--
--	Description : 	instanciation des services
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackagePackageDesc.DoResetService');

Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = LienPackagePackageDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackagePackageDesc.DoResetService : End');



end method;

------------------------------------------------------------
method LienPackagePackageDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienPackagePackageDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackagePackageDS.DoInitServiceSQL');


-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'IdPackageDesc = :WherePackage';
Self.ClauseFrom    = 'PackagePackagetest';
Self.RecordInstance = LienPackagePackageDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackagePackageDS.DoInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'LienPackagePackageDS.DoInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method LienPackagePackageDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienPackageProduitDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackageProduitDesc.DoResetAttributes');

Self.CodeProduit = new();
Self.IdPackageDesc= new();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackageProduitDesc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method LienPackageProduitDesc.DoResetSelfDesc
begin
--
--	Description : 	instanciation de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackageProduitDesc.DoResetSelfDesc');

SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'IdPackageDesc';
SelfDesc[SelfDesc.Items].ItemReference = Self.IdPackageDesc;
SelfDesc[SelfDesc.Items].ItemUserName = 'Identifiant Package';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdPackageDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeProduit ';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackageProduitDesc.DoResetSelfDesc : End');
end method;

------------------------------------------------------------
method LienPackageProduitDesc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackageProduitDesc.DoResetService');


Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = LienPackageProduitDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackageProduitDesc.DoResetService : End');

end method;

------------------------------------------------------------
method LienPackageProduitDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienPackageProduitDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienPackageProduitDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'IdPackageDesc = :WherePackage';
Self.ClauseFrom    = 'PackageProduittest';
Self.RecordInstance = LienPackageProduitDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienPackageProduitDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'LienPackageProduitDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method LienPackageProduitDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienProduitServiceDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienProduitServiceDesc.DoResetAttributes ');

Self.CodeService = new();
Self.IdProduitDesc= new();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienProduitServiceDesc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method LienProduitServiceDesc.DoResetSelfDesc
begin
--
--	Description : 	instanciation de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienProduitServiceDesc.DoResetSelfDesc');

SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'IdProduitDesc';
SelfDesc[SelfDesc.Items].ItemReference = Self.IdProduitDesc;
SelfDesc[SelfDesc.Items].ItemUserName = 'Identifiant Produit';
SelfDesc[SelfDesc.Items].ParentItemName = 'IdProduitDesc';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeService ';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienProduitServiceDesc.DoResetSelfDesc : End');

end method;

------------------------------------------------------------
method LienProduitServiceDesc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienProduitServiceDesc.DoResetService');

Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = LienProduitServiceDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienProduitServiceDesc.DoResetService : End');
end method;

------------------------------------------------------------
method LienProduitServiceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LienProduitServiceDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- LienProduitServiceDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'IdProduitDesc = :WhereProduit';
Self.ClauseFrom    = 'ProduitServicetest';
Self.RecordInstance = LienProduitServiceDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- LienProduitServiceDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'LienProduitServiceDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method LienProduitServiceDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PackageBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	permet d'éxécuter l'action : lecture des codes des produits pour un package donné
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageBS.DoAction');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READCODEPRODUIT do
		ListeProduit : Array of RefTypeProduitDesc ;
		self.LireCodeProduit((RefTypePackageDesc)(aTransData.TransObject),ListeProduit);
		anObject = ListeProduit;
end case;

return anObject;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'PackageBS.DoAction');
		Raise;
end method;

------------------------------------------------------------
method PackageBS.Init
begin
--
--	Description :	initialisation de packageBS. Gestion de la composition par le socle.
--					PackageDesc est constitué d'un tableau de produits (lienpackageproduitdesc) et 
--					d'un tableau de packages (lienpackagepackagedesc)
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageBS.Init');



super.Init();

--
-- Initialisation de la composition
--
Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;

TmpPackage : PackageDesc = new();
TmpPackage.DoResetAttributes();
TmpPackage.SelfDesc = new();
TmpPackage.DoResetSelfDesc();

-- INSTANCE MODELE PRODUIT POUR LE ROUTAGE DES ELEMENTS DU TABLEAU
TmpPackPackage : LienPackagePackageDesc = new();
TmpPackPackage.DoResetAttributes();
TmpPackPackage.SelfDesc = new();


TmpPackPackage.ServiceMgr = soCatalogueDSMgr;
TmpPackPackage.unService = LienPackagePackageDS;

TmpPackage.LienPackages.appendRow(TmpPackPackage);


-- INSTANCE MODELE PRODUIT POUR LE ROUTAGE DES ELEMENTS DU TABLEAU
TmpProduit : LienPackageProduitDesc = new();
TmpProduit.DoResetAttributes();
TmpProduit.SelfDesc = new();

TmpProduit.ServiceMgr = soCatalogueDSMgr;
TmpProduit.unService = LienPackageProduitDS;


TmpPackage.LienProduits.appendRow(TmpProduit);

-- On termine l'init de package
Self.BusinessClass = TmpPackage;
Self.BusinessClass.unService =PackageDS ;
Self.BusinessClass.ServiceMgr = soCatalogueDSMgr;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageBS.Init : End');
end method;

------------------------------------------------------------
method PackageBS.LireCodeProduit(input aCodePackage: AddDicoBD.RefTypePackageDesc,
	input output ListeProduit: Framework.Array of DicoBD.RefTypeProduitDesc)
begin
--
--	Description :	lecture des codes des produits contenus dans un Package
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Input 		--> aCodePackage : le code du package dont on recherche les produits
--					input/output--> ListeProduit : liste des codes produits trouvés
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageBS.LireCodeProduit ');

--Preparation de la lecture du package passé dans atransdata 
aTransData : TransClass = New();
aTransdata.TransactionService = ACT_STD_READ;
aTransdata.aRecordSelfDesc.SelfDesc = New();
aTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WherePackage';					
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aCodePackage;

--lecture
UnCache : Array of CacheDesc = (Array of CacheDesc)(Read(aTransdata));

UnPackage : PackageDesc;

--Constitution de la liste des codes produits présents dans le package considéré. Ces derniers sont présents dans
--dans l'attribut LienProduits: attribut qui est renseigné automatiquement par le socle grâce à la gestion de
--la composition
if UnCache <> NIL then
	for UnCacheDesc in UnCache do
		if UnCacheDesc <> NIL then
			UnPackage = (PackageDesc)(UnCacheDesc.Record);
			for UnLienPackageProduit in UnPackage.LienProduits do
				if UnLienPackageProduit <> NIL then
					if ListeProduit = NIL then
						ListeProduit = New();
					end if;
					ListeProduit.AppendRow(UnLienPackageProduit.CodeProduit);
				end if;
			end for;
--Prise en compte des packages éventuellement présents dans le package considéré.
--Ajout dans la liste des codes produits appartenant à chaque package "fils" 
			for UnLienPackage in UnPackage.LienPackages do  
				if UnLienPackage <> NIL then
					LireCodeProduit(UnLienPackage.CodePackage,ListeProduit);
				end if;
			end for;
		end if;
	end for;
end if;
	
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageBS.LireCodeProduit : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'PackageBS.LireCodeProduit');
		Raise;


end method;

------------------------------------------------------------
method PackageDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageDesc.DoResetAttributes ');

Super.DoResetAttributes();
Self.CodePackage = new();
Self.LienProduits = new();
Self.LienPackages = new();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageDesc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method PackageDesc.DoResetSelfDesc
begin
--
--	Description : 	instanciation de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageDesc.DoResetSelfDesc');

Super.DoResetSelfDesc();
SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Package';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LienPackages';
SelfDesc[SelfDesc.Items].ItemReference = Self.LienPackages;
SelfDesc[SelfDesc.Items].ItemUserName = 'Les Packages';
SelfDesc[SelfDesc.Items].linkActive = TRUE;

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LienProduits';
SelfDesc[SelfDesc.Items].ItemReference = Self.LienProduits;
SelfDesc[SelfDesc.Items].ItemUserName = 'Les Produits';
SelfDesc[SelfDesc.Items].linkActive = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageDesc.DoResetSelfDesc : End');

end method;

------------------------------------------------------------
method PackageDesc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageDesc.DoResetService');

Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = PackageDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageDesc.DoResetService : End');

end method;

------------------------------------------------------------
method PackageDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PackageDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PackageDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.ClauseWhere = 'CodePackage = :WherePackage';
Self.ClauseFrom    = 'Packagetest';
Self.RecordInstance = PackageDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PackageDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'NomDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method PackageDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ProduitBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	deux codes action sont définis :
--						ACT_READCODESERVICE : lecture des codes des services correspondant à un produit donné
--						ACT_READCODESERVICETARIFABLE : lecture des codes des services tarifables correspondant 
--		                            à un produit donné
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.DoAction');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READCODESERVICE do
		ListeService : Array of RefTypeServiceDesc ;
		ListeService = self.LireCodeService((RefTypeProduitDesc)(aTransData.TransObject));
		anObject = ListeService;
	when ACT_TARIF_READCODESERVICETARIFABLE do
		ListeServiceTarifable : Array of RefTypeServiceDesc ;
		ListeServiceTarifable = LireServiceTarifable((RefTypeProduitDesc)(aTransData.TransObject));
		anObject = ListeServiceTarifable;
	when ACT_TARIF_PRODUITSEMIS_PARRC do
		anObject = LireProduitDontEvtEmisRC();	
	when ACT_TARIF_SERVICESEMIS_PARRC do
		anObject = LireServiceDontEvtEmisRC((RefTypeProduitDesc)(aTransData.TransObject));	
end case;


return anObject;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitBS.DoAction');
		Raise;
end method;

------------------------------------------------------------
method ProduitBS.Init
begin
--
--	Description :	initialisation de ProduitBS. Gestion de la composition par le socle.
--					ProduiteDesc est constitué d'un tableau de services (lienproditservicedesc) 
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.Init');

super.Init();

--
-- Initialisation de la composition
--
Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;

TmpProduit : ProduitDesc = new();
TmpProduit.DoResetAttributes();
TmpProduit.SelfDesc = new();
TmpProduit.DoResetSelfDesc();

-- INSTANCE MODELE SERVICE POUR LE ROUTAGE DES ELEMENTS DU TABLEAU
TmpService : LienProduitServiceDesc = new();
TmpService.DoResetAttributes();
TmpService.SelfDesc = new();

TmpProduit.ServiceMgr = soCatalogueDSMgr;
TmpProduit.unService = LienProduitServiceDS;

TmpProduit.LienServices.appendRow(TmpService);

-- On termine l'init de produit
Self.BusinessClass = TmpProduit;
Self.BusinessClass.unService =ProduitDS ;
Self.BusinessClass.ServiceMgr = soCatalogueDSMgr;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitBS.Init : End');

end method;

------------------------------------------------------------
method ProduitBS.LireCodeService(input aCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc
begin
--
--	Description :	lecture des codes des services contenus dans un Produit
--
--	Type :	
--
--
--	Parametres :	Input 		--> aCodeProduit : le code du produit dont on recherche les services
--					return		--> ListeService : liste des codes Service trouvés
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.LireCodeService');


UnProduit : ProduitDesc ;

--  Lecture des services contenu dans le produit dont le code est passé en paramètre
aTransData : TransClass = New();
aTransdata.TransactionService = ACT_STD_READ;
aTransdata.aRecordSelfDesc.SelfDesc = New();
aTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereProduit';					
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aCodeProduit;


ListeService : Array of RefTypeServiceDesc = New();

--Constitution de ListeService par lecture des codes de chaque service présent dans UnCache = Résultat de la lecture

UnCache : Array of cacheDesc  =(Array of CacheDesc)(Read(aTransdata));

if UnCache <> NIL then
	for UnCacheDesc in UnCache do
		if UnCacheDesc <> NIL then
			UnProduit = (ProduitDesc)(UnCacheDesc.Record);
			for UnLienProduitService in UnProduit.LienServices do
				if UnLienProduitService <> NIL then
					ListeService.AppendRow(UnLienProduitService.CodeService);
				end if;
			end for;
		end if;
	end for;
end if; 



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitBS.LireCodeService : End');

return ListeService;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitBS.LireCodeService');
		Raise;
end method;

------------------------------------------------------------
method ProduitBS.LireProduitDontEvtEmisRC: Framework.Array of DicoBD.RefTypeProduitDesc
begin
--	Description : 	Lecture des produits auxquels appartiennent les services dont les événements doivent être saisis au niveau de RC
--
--	Type :	Concret
--
--	Parametres :	Input -->	ListeService : Liste des codes des services dont l'on souhaite connaître
--								les produits d'appartenance
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : ProduitBS.Action
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.LireProduitDontEvtEmisRC ');

aTransData : TransClass = New();
aTransData.TransActionService = ACT_TARIF_SERVICESEMIS_PARRC;
aTransData.TransObject=NIL;
ListeService : Array of ServiceDescSql = (Array of ServiceDescSql)(self.Transfer(aTransData,soCatalogueBSMgr,ServiceBS));


ListeProduit : Array of RefTypeProduitDesc = New();
pTransData : TransDesc = New();
pTransData.TransActionService = ACT_STD_READ ;
pTransData.TransObject = NIL;
UnCacheProduit : Array of CacheDesc = (Array of CacheDesc)(self.Transfer(pTransData,soCatalogueDSMgr,LienProduitServiceDS));

UnLienProduitService : LienProduitServiceDesc;

--Initialisation de la hashtable : recherche rapide d'une règle par son identifiant
HashTabLiens : HashTable = new;
Reglesfunc : HashFuncs = new(keyType = SP_KT_INTEGER);
HashTabLiens.Setup(size = 300, functions = Reglesfunc, uniqueKey = TRUE);

if UnCacheProduit <> NIL and UnCacheProduit.Items > 0 then
	for aCacheDesc in UnCacheProduit do
		if aCacheDesc <> NIL then
			UnLienProduitService=(LienProduitServiceDesc)(aCacheDesc.Record);
			HashTabLiens.Enter(UnLienProduitService, key = UnLienProduitService.CodeService.IntegerValue);
		end if;
	end for ;
end if;	


-- lacture du message correspondant à l'identifiant souhaité.
if ListeService <> NIL and ListeService.Items > 0 then
	for aService in ListeService  do
		if aService <> NIL then
			UnLienProduitService=(LienProduitServiceDesc)(HashTabLiens.Find(key = aService.CodeService.Value));
			if ListeProduit[UnLienProduitService.IdProduitDesc.Value] = NIL then
				ListeProduit[UnLienProduitService.IdProduitDesc.Value] = New();
			end if; 
			
			ListeProduit[UnLienProduitService.IdProduitDesc.Value].SetValue(UnLienProduitService.IdProduitDesc);
		end if;
	end for;
end if;
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitBS.LireProduitDontEvtEmisRC : End');

return ListeProduit;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitBS.LireCodeService');
		Raise;
end method;

------------------------------------------------------------
method ProduitBS.LireServiceDontEvtEmisRC(input UnCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc
begin
--	Description : 	Lecture des produits auxquels appartiennent les services dont les événements doivent être saisis au niveau de RC
--
--	Type :	Concret
--
--	Parametres :	Input -->	ListeService : Liste des codes des services dont l'on souhaite connaître
--								les produits d'appartenance
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : ProduitBS.Action
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.LireProduitDontEvtEmisRC ');


ListeServiceDontEvtEmisRC : Array of RefTypeServiceDesc = New();
ListeService : Array of RefTypeServiceDesc;
-- Lecture de l'ensemble des codes des services présents dans un produit

ListeService = self.LireCodeService(unCodeProduit);


UnService : Service_Desc ;


pTransdata : Transclass = New();

--Lecture des services l'un après l'autre : si il est tarifable, il est ajouté à la liste.

if ListeService <> NIL then
	for Parcours in ListeService do
		pTransdata.TransactionService = ACT_STD_READ;	
		pTransdata.aRecordSelfDesc.SelfDesc = New();
		pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
		pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
		pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = Parcours;
		UnCache : Array of CacheDesc = (Array of CacheDesc)(transfer(pTransdata,soCatalogueBSMgr,ServiceBS));
		
		--Tarifable --> ajout dans la liste.
		For UnCacheDesc in UnCache do
			unService = (Service_Desc)(UnCacheDesc.Record);
			if unService.EmetteurEvenement.IsEqual(IntegerData(Value=EMETTEUR_EVENEMENT_RC)) then
				ListeServiceDontEvtEmisRC .AppendRow(Parcours);
			end if;	
		end for;
	end for;			
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitBS.LireProduitDontEvtEmisRC : End');

return ListeServiceDontEvtEmisRC;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitBS.LireCodeService');
		Raise;
end method;

------------------------------------------------------------
method ProduitBS.LireServiceTarifable(input aCodeProduit: DicoBD.RefTypeProduitDesc): Framework.Array of AddDicoBD.RefTypeServiceDesc
begin
--
--	Description :	lecture des codes des services tarifables (TarifableBln = TRUE) contenus dans un Produit
--
--	Type :	
--
--
--	Parametres :	Input 		--> aCodeProduit : le code du produit dont on recherche les services
--					return		--> ListeService : liste des codes Service trouvés
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitBS.LireServiceTarifable');




ListeServiceTarifable : Array of RefTypeServiceDesc;

-- Lecture de l'ensemble des codes des services présents dans un produit

ListeServiceTarifable = self.LireCodeService(aCodeProduit);


UnService : Service_Desc ;


pTransdata : Transclass = New();

--Lecture des services l'un après l'autre : si il est tarifable, il est ajouté à la liste.

if ListeServiceTarifable <> NIL then
	for Parcours in ListeServiceTarifable do
		pTransdata.TransactionService = ACT_STD_READ;	
		pTransdata.aRecordSelfDesc.SelfDesc = New();
		pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
		pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
		pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = Parcours;
		UnCache : Array of CacheDesc = (Array of CacheDesc)(transfer(pTransdata,soCatalogueBSMgr,ServiceBS));
		
		--Tarifable --> ajout dans la liste.
		For UnCacheDesc in UnCache do
			unService = (Service_Desc)(UnCacheDesc.Record);
			if not unService.IsTarifable then
				ListeServiceTarifable .DeleteRow(Parcours);
			end if;	
		end for;
	end for;			
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitBS.LireServiceTarifable : End');		

return ListeServiceTarifable;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitBS.LireServicetarifable');
		Raise;	
end method;

------------------------------------------------------------
method ProduitCommercialDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitCommercialDesc.DoResetAttributes ');

Self.DateDebutValidite = new();
Self.DateFinValidite = new();
Self.Description = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitCommercialDesc.DoResetAttributes : End ');

end method;

------------------------------------------------------------
method ProduitCommercialDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitCommercialDesc.DoResetSelfDesc');



SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFinValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFinValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de fin';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateDebutValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebutValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de Début';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Description';
SelfDesc[SelfDesc.Items].ItemReference = Self.Description;
SelfDesc[SelfDesc.Items].ItemUserName = 'Description';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitCommercialDesc.DoResetSelfDesc : End');
end method;

------------------------------------------------------------
method ProduitCommercialDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ProduitDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitDesc.DoResetAttributes');

Super.DoResetAttributes();
Self.CodeProduit = new();
Self.DestineProspectBln = new();
Self.LienServices = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitDesc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method ProduitDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitDesc.DoResetSelfDesc');


Super.DoResetSelfDesc();
SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Produit';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DestineProspectBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.DestineProspectBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'DestineProspectBln ';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LienServices';
SelfDesc[SelfDesc.Items].ItemReference = Self.LienServices;
SelfDesc[SelfDesc.Items].ItemUserName = 'Les Services';
SelfDesc[SelfDesc.Items].ParentItemName = 'LienServices';
SelfDesc[SelfDesc.Items].linkActive = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitDesc.DoResetSelfDesc : End');
end method;

------------------------------------------------------------
method ProduitDesc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitDesc.DoResetService');


Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = ProduitDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitDesc.DoResetService : End');


end method;

------------------------------------------------------------
method ProduitDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ProduitDesc.IsDestineProspect: Framework.boolean
begin
aResult : boolean;
return aResult;
end method;

------------------------------------------------------------
method ProduitDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ProduitDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.ClauseWhere = 'CodeProduit = :WhereProduit';
Self.ClauseFrom    = 'Produittest';
Self.RecordInstance = ProduitDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ProduitDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ProduitDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method ProduitDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PromotionBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	définition de l'action ACT_READCODEPROMO : lecture des codes des promotions
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionBS.DoAction');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READCODEPROMOTION do
		aPromotionParam: PromotionParam = New();
		aPromotionParam.DoResetAttributes();
		aPromotionParam = (PromotionParam)(aTransdata.TransObject);
		anObject = LireCodePromotion(aPromotionParam.CodeDevise, aPromotionParam.Codecategorie,aPromotionParam.CodePackage,aPromotionParam.CodeProduit,aPromotionParam.CodeService);
end case;


return anObject;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'PromotionBS.DoAction');
		Raise;
end method;

------------------------------------------------------------
method PromotionBS.Init
begin
--
--	Description :	Initialisation du  Business Service.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionBS.Init');


super.Init();
Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;
Self.BusinessClass =PromotionDesc();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionBS.Init : End');
end method;

------------------------------------------------------------
method PromotionBS.LireCodePromotion(input adevise: DicoBD.RefDeviseDesc,
	input acategorie: DicoBD.RefTarifDesc,
	input apackage: AddDicoBD.RefTypePackageDesc,
	input aproduit: DicoBD.RefTypeProduitDesc,
	input aservice: AddDicoBD.RefTypeServiceDesc): Framework.Array of AddDicoBD.RefTypePromotionDesc
begin
--
--	Description :	Cette méthode charge  l'ensemble des promotions répondant aux critères de sélection passés
--					en paramètre.Elle renvoit la liste des codes Promotion correspondants. 
--
--	Type :	
--
--
--	Parametres :    Input 		--> aDevise : RefDeviseDesc
--									aCategorie : RefTarifDesc
--									aPackage : RefTypePackageDesc
--									aProduit : RefTypeProduitDesc
--									aService : RefTypeServiceDesc
--					Return      --> Array of RefTypePromotionDesc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionBS.LireCodePromotion');


-- Initialisation

pTransdata : Transclass = New();		
pTransdata.aRecordSelfDesc = New();
UnCache  : Array of CacheDesc = New();  
UnePromotion : PromotionDesc;
ListePromotion : Array of RefTypePromotionDesc = New();	-- Liste des promotions répondant 
														-- aux critères de recherche

pTransdata.TransActionService = ACT_STD_READ;


-- Définition du contexte de recherche

pTransdata.aRecordSelfDesc.selfDesc = New();
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereDevise';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aDevise;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereCategorie';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aCategorie;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WherePackage';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aPackage;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereProduit';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aProduit;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aService;

-- Lecture

UnCache = (Array of CacheDesc)(Transfer(pTransdata,soCatalogueBSMgr,PromotionBS));

-- Constitution de la liste à partir des codes des promotions trouvées
if( UnCache <> NIL)  then
	for aCache in UnCache do
		if aCache <> NIL then
			UnePromotion = (PromotionDesc)(aCache.record);
			ListePromotion.AppendRow(UnePromotion.CodePromotion);
		end if;
	end for;
end if;

-- Ajout dans la lise du code qui correspond à 'Hors Promotion'. Celui-ci n'est pas présent dans la table de 
-- de données Promotion, et doit donc être ajoutés en Runtime

IntCodHorsPromo : RefTypePromotionDesc  = New(Value = 1);
ListePromotion.InsertRow(1,IntCodHorsPromo);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionBS.LireCodePromotion : End');

return ListePromotion;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'PromotionBS.LireCodePromotion');
		Raise;			
end method;

------------------------------------------------------------
method PromotionDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, 'PromotionDesc.DoResetAttributes');

Self.CodePackage = new();
Self.CodeCategorie = new();
Self.CodeDevise = new();
Self.CodeProduit = new();
Self.CodePromotion = new();
Self.CodeService = new();
Self.DateDebutValidite = new();
Self.DateFinValidite = new();
Self.LibellePromotion = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, 'PromotionDesc.DoResetAttributes : End' );

end method;

------------------------------------------------------------
method PromotionDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--   CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionDesc.DoResetSelfDesc');

SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Package';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeCategorie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeCategorie;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeCategorie';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePromotion';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePromotion;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePromotion';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionDesc.DoResetSelfDesc : End');


SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeDevise';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeDevise;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeDevise';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeProduit';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeService';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateDebutValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebutValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateDebutValidite';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFinValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFinValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateFinValidite';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LibellePromotion';
SelfDesc[SelfDesc.Items].ItemReference = Self.LibellePromotion;
SelfDesc[SelfDesc.Items].ItemUserName = 'LibellePromotion';




end method;

------------------------------------------------------------
method PromotionDesc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionDesc.DoResetService');


Self.ServiceMgr = soCatalogueDSMgr;
Self.unService = PromotionDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionDesc.DoResetService : End');

end method;

------------------------------------------------------------
method PromotionDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PromotionDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionDS.DoInitServiceSQL');


-- Traitement

Self.ClauseWhere =  'CodeCategorie = :WhereCategorie and CodeDevise = :WhereDevise and CodeProduit = :WhereProduit and CodePackage = :WherePackage and CodeService = :WhereService ';
Self.ClauseFrom    = 'Promotiontest';
Self.RecordInstance = PromotionDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'PromotionDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method PromotionDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method PromotionParam.DoResetAttributes
begin
--
--	Description : 	Permet de passer les paramètres de recherche nécessaire à l'éxécution de ACT_READCODEPROMOTION
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PromotionParam.DoResetAttributes ');

Self.CodeCategorie = New();
Self.CodeDevise = New();
Self.CodeService = New();
Self.CodePackage = New();
Self.CodeProduit = New();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PromotionParam.DoResetAttributes : End');


end method;

------------------------------------------------------------
method PromotionParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Service_Desc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, 'Service_Desc.DoResetAttributes');

Self.CodeService = new();
Self.LibelleFacturation = new();
Self.RemisableBln = new();
Self.TarifableBln = new();
self.EmetteurEvenement = new();
self.TypeTarif = new();
self.CodeOD = new();
self.RubriqueOD = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, 'Service_Desc.DoResetAttributes : End');
end method;

------------------------------------------------------------
method Service_Desc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Service_Desc.DoResetSelfDesc');

SelfDesc.Clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Service';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'EmetteurEvenement';
SelfDesc[SelfDesc.Items].ItemReference = Self.EmetteurEvenement;
SelfDesc[SelfDesc.Items].ItemUserName = 'EmetteurEvenement';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeOD';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeOD;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeOD';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'RubriqueOD';
SelfDesc[SelfDesc.Items].ItemReference = Self.RubriqueOD;
SelfDesc[SelfDesc.Items].ItemUserName = 'RubriqueOD';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'TypeTarif';
SelfDesc[SelfDesc.Items].ItemReference = Self.TypeTarif;
SelfDesc[SelfDesc.Items].ItemUserName = 'TypeTarif';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'LibelleFacturation';
SelfDesc[SelfDesc.Items].ItemReference = Self.LibelleFacturation;
SelfDesc[SelfDesc.Items].ItemUserName = 'Libellé de Facturation';


SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'RemisableBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.RemisableBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'Remise possible ? ';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'TarifableBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.TarifableBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'Opération tarifable ? ';

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Service_Desc.DoResetSelfDesc : End');


end method;

------------------------------------------------------------
method Service_Desc.DoResetService
begin
--
--	Description : 	instanciation des services.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Service_Desc.DoResetService');

Self.ServiceMgr = soCatalogueDSMgr;
Self.UnService  = ServiceDS;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Service_Desc.DoResetService : End');
end method;

------------------------------------------------------------
method Service_Desc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Service_Desc.IsRemisable: Framework.boolean
begin
--
--	Description :	Le service peut il faire l'objet d'une remise
--
--	Type :	
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Service_Desc.IsRemisable');

return self.RemisableBln;

Exception
	When e : GenericException do
		Raise;	

end method;

------------------------------------------------------------
method Service_Desc.IsTarifable: Framework.boolean
begin
--
--	Description :	Le service est-il tarifable ?
--
--	Type :	
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Service_Desc.IsTarifable');

return self.TarifableBln;


Exception
	When e : GenericException do
		Raise;	
end method;

------------------------------------------------------------
method ServiceBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	deux codes action sont définis :
--						ACT_TARIF_READSERVICENONREMISABLE : lecture des codes des services correspondant à un produit donné
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceBS.DoAction');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READSERVICENONREMISABLE do
		anObject = self.LireServiceNonRemisable();
	when ACT_TARIF_SERVICESEMIS_PARRC do
		anObject = self.LireServicesEmisParRC();
end case;


return anObject;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceBS.DoAction');
		Raise;
end method;

------------------------------------------------------------
method ServiceBS.Init
begin
--
--	Description :	Initialisation du  Business Service.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC | 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceBS.Init');


super.Init();
Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;
Self.BusinessClass = Service_Desc();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceBS.Init : End');
end method;

------------------------------------------------------------
method ServiceBS.LireServiceNonRemisable: Framework.Array of AddDicoBD.RefTypeServiceDesc
begin
ListeServiceNonRemisable : Array of RefTypeServiceDesc = New();
UnService : Service_Desc = New();
aTransdata : TransDesc = New();
aTransdata.TransActionservice = ACT_STD_READ;
aTransData.TransObject = New();
UnCache : Array of CacheDesc = (Array of CacheDesc)(self.Transfer(aTransdata,soCatalogueBSMgr,ServiceBS));

For aCacheDesc in UnCache do
	UnService = (Service_Desc)(aCacheDesc.Record);
	if not UnService.RemisableBln then
		ListeServiceNonRemisable[unService.CodeService.Value]=New();
		ListeServiceNonRemisable[unService.CodeService.Value]= unService.CodeService;
	end if;
end for;
	
return ListeServiceNonRemisable;
end method;

------------------------------------------------------------
method ServiceBS.LireServicesEmisParRC: Framework.Array of CatalogueSrv.ServiceDescSql
begin
--
--	Description :	Cette méthode lit les services dont les événements de tarification sont émis par RC.
--
--	Type :	Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceBS.LireServicesEmisParRC');


CodeEmetteur : RefTypeEmetteurEvt = New(Value = EMETTEUR_EVENEMENT_RC);

TableService : Array of ServiceDescSql = New();

sql select 
		CodeService

into    :TableService from ServiceTest

where   EmetteurEvenement = :CodeEmetteur

on Session soCatalogueDBSession;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceBS.LireServicesEmisParRC :End');

return TableService;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceBS.LireServicesEmisParRC');
		Raise;
end method;

------------------------------------------------------------
method ServiceDescSql.Init
begin
super.Init();
self.DoResetAttributes();
end method;

------------------------------------------------------------
method ServiceDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.ClauseWhere = 'CodeService = :WhereService';
Self.ClauseFrom    = 'Servicestest';
Self.RecordInstance = Service_Desc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ServiceDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method ServiceDS.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'catalogu';


end CatalogueSrv;
begin TOOL ContexteSrv;

includes DataAccessSrvBD;
includes GenericDBMS;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  CalculDesc;
forward  ContexteBS;
forward  ContexteDesc;
forward  ContexteDS;
forward  ContexteParam;
forward  RequeteDesc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_CTX_EVAL = 1;
constant LOG_GRPFLAG = 20;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class RequeteDesc inherits from Framework.Object

has public  attribute Dependances: Framework.Array of Framework.IntegerData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class CalculDesc inherits from ContexteSrv.RequeteDesc

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ContexteBS inherits from DataAccessSrvBD.ServiceDesc

has public  attribute ContexteDesc: ContexteSrv.ContexteDesc;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Calcule(input Calcul: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue);
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has private method Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue): Framework.Array of Framework.DataValue;
has private method Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue,
	input VariablesADeterminer: Framework.Array of Framework.IntegerData,
	input VariablesACalculer: Framework.Array of Framework.IntegerData);
has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteDesc inherits from Framework.Object

has public  attribute ContexteService: Framework.ClassType;
has public  attribute ContexteServiceMgr: DataAccessSrvBD.ServiceMgrDesc;
has public  attribute Requetes: Framework.Array of ContexteSrv.RequeteDesc;
has public  attribute Variables: Framework.Array of Framework.IntegerData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ContexteDS inherits from DataAccessSrvBD.ServiceDesc

has public  attribute ContexteDesc: ContexteSrv.ContexteDesc;
has public  attribute DBSession: GenericDBMS.DBSession;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Determine(input Requete: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue);
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has private method Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue): Framework.Array of Framework.DataValue;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteParam inherits from Framework.Object

has public  attribute Valeurs: Framework.Array of Framework.DataValue;
has public  attribute VariablesADeterminer: Framework.Array of Framework.IntegerData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method CalculDesc.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CalculDesc.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CalculDesc.Init : End');

end method;

------------------------------------------------------------
method ContexteBS.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input aTransData : TransDesc
--               input aTransOrigin : StdEventNotifier = NIL
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.Action');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_CTX_EVAL do
		ContexteParam : ContexteParam = (ContexteParam)(aTransData.TransObject);
		anObject = self.Evalue(ContexteParam.VariablesADeterminer, ContexteParam.Valeurs);
	else do
		anObject = self.DoAction(aTransData, aTransOrigin);
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.Action : End');

return anObject;
end method;

------------------------------------------------------------
method ContexteBS.Calcule(input Calcul: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Calcul : integer
--               input Valeurs : Array of Framework.DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.Calcule');

-- case Calcul is
	-- when CTX_CALC1 do
		-- self.<methode de calcul>(
			-- (<type Var1>)(Valeurs[CTX_VAR1]),
			-- (<type Var2>)(Valeurs[CTX_VAR2]),
			-- Valeurs);
-- end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.Calcule : End');

end method;

------------------------------------------------------------
method ContexteBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input aTransData : TransDesc
--               input aTransOrigin : StdEventNotifier = NIL
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.DoAction');

anObject : Object = NIL;
-- case aTransData.TransActionService is
	-- when <code action> do
		-- anObject = self.<methode action>(aTransData);
-- end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.DoAction : End');

return anObject;
end method;

------------------------------------------------------------
method ContexteBS.Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue): Framework.Array of Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Variables : Array of Framework.IntegerData
--               input Valeurs : Array of Framework.DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.Evalue');

VariablesADeterminer : Array of IntegerData = new();
VariablesACalculer : Array of IntegerData = new();
self.Evalue(Variables, Valeurs, VariablesADeterminer, VariablesACalculer);
if VariablesADeterminer.Items > 0 then
	aTransData : TransDesc = new();
	aTransData.TransActionService = ACT_CTX_EVAL;
	aTransData.TransObject = ContexteParam(
		VariablesADeterminer = VariablesADeterminer,
		Valeurs = Valeurs);
	Valeurs = (Array of DataValue) (self.Transfer(aTransData, self.ContexteDesc.ContexteServiceMgr, self.ContexteDesc.ContexteService));
end if;
for Variable in VariablesACalculer do
	if Valeurs[Variable.Value] = NIL then
		CalculId : IntegerData = self.ContexteDesc.Variables[Variable.Value];
		if CalculId <> NIL then
			self.Calcule(CalculId.Value, Valeurs);
		end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.Evalue : End');

return Valeurs;
end method;

------------------------------------------------------------
method ContexteBS.Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue,
	input VariablesADeterminer: Framework.Array of Framework.IntegerData,
	input VariablesACalculer: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Variables : Array of Framework.IntegerData
--               input Valeurs : Array of Framework.DataValue
--               input VariablesADeterminer : Array of Framework.IntegerData
--               input VariablesACalculer : Array of Framework.IntegerData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.Evalue');

for Variable in Variables do
	if Valeurs[Variable.Value] = NIL then
		RequeteId : IntegerData = self.ContexteDesc.Variables[Variable.Value];
		if RequeteId <> NIL then
			Requete : RequeteDesc = self.ContexteDesc.Requetes[RequeteId.Value];
			if Requete.IsA(CalculDesc) then
				if Requete.Dependances <> NIL then
					self.Evalue(Requete.Dependances, Valeurs, VariablesADeterminer, VariablesACalculer);
				end if;
				VariablesACalculer.AppendRow(Variable);
			else
				VariablesADeterminer.AppendRow(Variable);
			end if;
		end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.Evalue : End');

end method;

------------------------------------------------------------
method ContexteBS.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteBS.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteBS.Init : End');

end method;

------------------------------------------------------------
method ContexteDesc.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDesc.Init');

super.Init();
Requetes = new();
Variables = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDesc.Init : End');

end method;

------------------------------------------------------------
method ContexteDS.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input aTransData : TransDesc
--               input aTransOrigin : StdEventNotifier = NIL
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDS.Action');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_CTX_EVAL do
		ContexteParam : ContexteParam = (ContexteParam)(aTransData.TransObject);
		anObject = self.Evalue(ContexteParam.VariablesADeterminer, ContexteParam.Valeurs);
	else do
		anObject = self.DoAction(aTransData, aTransOrigin);
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDS.Action : End');

return anObject;
end method;

------------------------------------------------------------
method ContexteDS.Determine(input Requete: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Requete : integer
--               input Valeurs : Array of Framework.DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDS.Determine');

-- case Requete is
	-- when CTX_REQ1 do
		-- self.<requete>(
			-- (<type Var1>)(Valeurs[CTX_VAR1]),
			-- (<type Var2>)(Valeurs[CTX_VAR2]),
			-- Valeurs);
-- end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDS.Determine : End');

end method;

------------------------------------------------------------
method ContexteDS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input aTransData : TransDesc
--               input aTransOrigin : StdEventNotifier = NIL
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDS.DoAction');

anObject : Object = NIL;
-- case aTransData.TransActionService is
	-- when <code action> do
		-- anObject = self.<methode action>(aTransData);
-- end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDS.DoAction : End');

return anObject;
end method;

------------------------------------------------------------
method ContexteDS.Evalue(input Variables: Framework.Array of Framework.IntegerData,
	input Valeurs: Framework.Array of Framework.DataValue): Framework.Array of Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Variables : Array of Framework.IntegerData
--               input Valeurs : Array of Framework.DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDS.Evalue');

for Variable in Variables do
	if Valeurs[Variable.Value] = NIL then
		RequeteId : IntegerData = self.ContexteDesc.Variables[Variable.Value];
		if RequeteId <> NIL then
			Requete : RequeteDesc = self.ContexteDesc.Requetes[RequeteId.Value];
			if Requete.Dependances <> NIL then
				self.Evalue(Requete.Dependances, Valeurs);
			end if;
			self.Determine(RequeteId.Value, Valeurs);
		end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDS.Evalue : End');

return Valeurs;
end method;

------------------------------------------------------------
method ContexteDS.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteDS.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteDS.Init : End');

end method;

------------------------------------------------------------
method ContexteParam.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteParam.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteParam.Init : End');

end method;

------------------------------------------------------------
method RequeteDesc.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RequeteDesc.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RequeteDesc.Init : End');

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'contexte';


end ContexteSrv;
begin TOOL DataStructuresClasses;

includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  Algorithm;
forward  Assoc;
forward  AssocException;
forward  AssocFlag;
forward  AssocGen;
forward  AssocItem;
forward  AssocItemGen;
forward  BinaryFunction;
forward  Chronometre;
forward  DataStructureException;
forward  Function;
forward interface I_Adapter;
forward interface I_ArrayAdapter;
forward interface I_BinaryFunction;
forward interface I_Compare;
forward interface I_Feature;
forward interface I_Function;
forward interface I_Iterator;
forward interface I_ObjectAtIndex;
forward interface I_UnaryFunction;
forward  IotaGen;
forward  NeedOverride;
forward  OneToMany;
forward  SearchTree;
forward  SearchTreeException;
forward  Stack;
forward  StackException;
forward  UnaryFunction;
forward  UnsupportedOperation;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 2;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class Algorithm inherits from Framework.Object

has public  method Execute(input InputData: Framework.Object,
	input Algorithm: DataStructuresClasses.Algorithm): Framework.Object;
has public  method Init;

implements	DataStructuresClasses.I_Feature;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Assoc inherits from Framework.Object

has public  attribute lesElements: Framework.Array of DataStructuresClasses.AssocItem;

has public  method Append(input uneCle: Framework.TextData,
	input uneValeur: Framework.TextData);
has public  method Clear;
has public  method Find(input uneCle: Framework.TextData,
	input output unResult: DataStructuresClasses.AssocItem): DataStructuresClasses.AssocItem;
has public  method FindByKey(input uneCle: Framework.TextData): DataStructuresClasses.AssocItem;
has public  method GetElements: Framework.Array of DataStructuresClasses.AssocItem;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DataStructureException inherits from Framework.GenericException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AssocException inherits from DataStructuresClasses.DataStructureException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AssocFlag inherits from DataStructuresClasses.Assoc

has public  attribute flagFalse: Framework.BooleanNullable;
has public  attribute flagTrue: Framework.BooleanNullable;

has public  method ClearFlags;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AssocGen inherits from Framework.Object

has public  attribute lesElements: Framework.Array of DataStructuresClasses.AssocItemGen;

has public  method Append(input uneCle: Framework.DataValue,
	input uneValeur: Framework.DataValue);
has public  method Append(input unAssocItemGen: DataStructuresClasses.AssocItemGen);
has public  method Clear;
has public  method Find(input uneCle: Framework.Object,
	input output unResult: DataStructuresClasses.AssocItemGen): DataStructuresClasses.AssocItemGen;
has public  method FindByKey(input uneCle: Framework.Object): DataStructuresClasses.AssocItemGen;
has public  method GetElements: Framework.Array of DataStructuresClasses.AssocItemGen;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AssocItem inherits from Framework.Object

has public  attribute Extra: Framework.Object;
has private attribute ItemName: Framework.TextData;
has private attribute ItemValue: Framework.TextData;

has public  method GetExtra: Framework.Object;
has public  method GetItem: Framework.TextData;
has public  method HasKey(input uneCle: Framework.TextData): Framework.boolean;
has public  method Init;
has public  method SetExtra(input unExtra: Framework.Object);
has public  method SetParams(input aItem: Framework.TextData,
	input aValue: Framework.TextData);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AssocItemGen inherits from Framework.Object

has public  attribute Extra: Framework.Object;
has private attribute ItemKey: Framework.Object;
has private attribute ItemValue: Framework.Object;

has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;
has public  method DoIsKey(input aKey: Framework.Object): Framework.boolean;
has public  method GetExtra: Framework.Object;
has public  method GetItem: Framework.Object;
has public  method HasKey(input uneCle: Framework.DataValue): Framework.boolean;
has public  method HasKey(input uneCle: Framework.IntegerData): Framework.boolean;
has public  method HasKey(input uneCle: Framework.TextData): Framework.boolean;
has public  method HasKey(input uneCle: Framework.BooleanData): Framework.boolean;
has public  method HasKey(input uneCle: Framework.DoubleData): Framework.boolean;
has public  method HasKey(input uneCle: Framework.NumericData): Framework.boolean;
has public  method HasKey(input uneCle: Framework.Object): Framework.boolean;
has public  method Init;
has public  method SetExtra(input unExtra: Framework.Object);
has public  method SetParams(input aKey: Framework.Object,
	input aValue: Framework.Object);

implements	DataStructuresClasses.I_Compare;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Function inherits from Framework.Object

has public  method Execute: Framework.Object;
has public  method Init;

implements	DataStructuresClasses.I_Function;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class BinaryFunction inherits from DataStructuresClasses.Function

has public  method Execute(input Value1: Framework.Object,
	input Value2: Framework.Object): Framework.Object;
has public  method Init;

implements	DataStructuresClasses.I_BinaryFunction;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Chronometre inherits from Framework.Object

has public  attribute Clock: Framework.StopWatch;

has public  method AsInterval: Framework.IntervalData;
has public  method AsText: Framework.TextData;
has public  method Fire;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

interface I_Adapter 

has property
	componentFlags = 8;
end interface;

interface I_ArrayAdapter inherits from DataStructuresClasses.I_Adapter

has public  method BuildFromArray(input anArray: Framework.GenericArray);

has property
	componentFlags = 8;
end interface;

interface I_BinaryFunction 

has public  method Execute(input Value1: Framework.Object = NIL,
	input Value2: Framework.Object = NIL): Framework.Object;

has property
	componentFlags = 8;
end interface;

interface I_Compare 

has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;

has property
	componentFlags = 8;
end interface;

interface I_Feature 

has public  method Execute(input InputData: Framework.Object,
	input Algorithm: DataStructuresClasses.Algorithm): Framework.Object;

has property
	componentFlags = 8;
end interface;

interface I_Function 

has public  method Execute: Framework.Object;

has property
	componentFlags = 8;
end interface;

interface I_Iterator 

has public  method ClearAllItems;
has public  method GetCurrIndex: Framework.integer;
has public  method GetFirst: Framework.Object;
has public  method GetItems: Framework.Array of Framework.Object;
has public  method GetNext: Framework.Object;
has public  method IsAtEnd: Framework.boolean;
has public  method IsAtStart: Framework.boolean;
has public  method IsEmpty: Framework.boolean;
has public  method SetItems(input Items: Framework.Array of Framework.Object);

has property
	componentFlags = 8;
end interface;

interface I_ObjectAtIndex 

has public  method GetObjectAtIndex(input Index: Framework.integer): Framework.Object;
has public  method SetObjectAtIndex(input index: Framework.integer,
	input aObject: Framework.Object);

has property
	componentFlags = 8;
end interface;

interface I_UnaryFunction 

has public  method Execute(input Value: Framework.Object): Framework.Object;

has property
	componentFlags = 8;
end interface;

class IotaGen inherits from DataStructuresClasses.Function

has private attribute SequenceIncrement: Framework.integer;
has private attribute SequenceValue: Framework.integer;

has public  method Execute: Framework.Object;
has public  method Init;
has public  method InitSequence(input aValue: Framework.integer,
	input anIncrement: Framework.integer = 1);

implements	DataStructuresClasses.I_Function;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class NeedOverride inherits from DataStructuresClasses.DataStructureException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class OneToMany inherits from Framework.Object

has private attribute chemin: Framework.Array of Framework.Object;
has private attribute Parcours: Framework.integer;

has public  method Append(input uneValeur: Framework.Object);
has public  method BuildFromArray(input anArray: Framework.GenericArray);
has public  method Clear;
has public  method ClearAllItems;
has public  method GetCurrIndex: Framework.integer;
has public  method GetFirst: Framework.Object;
has public  method GetItems: Framework.Array of Framework.Object;
has public  method GetNext: Framework.Object;
has public  method GetObjectAtIndex(input Index: Framework.integer): Framework.Object;
has public  method Init;
has public  method IsAtEnd: Framework.boolean;
has public  method IsAtStart: Framework.boolean;
has public  method IsEmpty: Framework.boolean;
has public  method SetItems(input Items: Framework.Array of Framework.Object);
has public  method SetObjectAtIndex(input index: Framework.integer,
	input aObject: Framework.Object);

implements	DataStructuresClasses.I_ArrayAdapter;
implements	DataStructuresClasses.I_Iterator;
implements	DataStructuresClasses.I_ObjectAtIndex;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class SearchTree inherits from Framework.Object

has public  attribute Father: DataStructuresClasses.SearchTree;
has public  attribute Key: Framework.Object;
has public  attribute Left: DataStructuresClasses.SearchTree;
has public  attribute Right: DataStructuresClasses.SearchTree;
has public  attribute Value: Framework.Object;

has public  method BackTrack(input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DeepLeftTraversalInOrder(input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DeepRightTraversalInOrder(input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DeleteChildren(input Notification: Framework.boolean,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DeleteNodeForKey(input aKey: Framework.Object,
	input Notification: Framework.boolean = FALSE,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): Framework.boolean;
has public  method DoAcceptDuplicates: Framework.boolean;
has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;
has public  method DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DoRaiseExceptionWhenDuplicateValues: Framework.boolean;
has public  method ForceNode(input aKey: Framework.Object,
	input aValue: Framework.Object,
	input aClassType: Framework.ClassType,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree;
has public  method GetKey: Framework.Object;
has public  method GetValue(input Clone: Framework.boolean = FALSE): Framework.Object;
has public  method HasChildren: Framework.boolean;
has public  method Init;
has public  method Insert(input aKey: Framework.Object,
	input aValue: Framework.Object,
	input aClassType: Framework.ClassType): DataStructuresClasses.SearchTree;
has public  method LookupNode(input aKey: Framework.Object,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree;
has public  method LookupValue(input aKey: Framework.Object,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object,
	input Clone: Framework.boolean = FALSE): Framework.Object;
has public  method RotateNode;
has public  method SetParams(input aKey: Framework.Object,
	input aValue: Framework.Object);
has public  method WalkBack(input DoNotify: Framework.boolean,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree;

implements	DataStructuresClasses.I_Compare;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class SearchTreeException inherits from DataStructuresClasses.DataStructureException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class Stack inherits from Framework.Object

has private attribute ItemList: Framework.Array of Framework.Object;
has public  attribute TopIndex: Framework.integer;

has public  method ClearAllItems;
has public  method GetSize: Framework.integer;
has public  method Init;
has public  method IsEmpty: Framework.boolean;
has public  method Peek(input Clone: Framework.boolean = FALSE): Framework.Object;
has public  method Pop(input Clone: Framework.boolean = FALSE): Framework.Object;
has public  method Push(input unObjet: Framework.Object,
	input Clone: Framework.boolean = FALSE);
has public  method Reverse;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class StackException inherits from DataStructuresClasses.DataStructureException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class UnaryFunction inherits from DataStructuresClasses.Function

has public  method Execute(input Value: Framework.Object): Framework.Object;
has public  method Init;

implements	DataStructuresClasses.I_UnaryFunction;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class UnsupportedOperation inherits from DataStructuresClasses.DataStructureException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method Algorithm.Execute(input InputData: Framework.Object,
	input Algorithm: DataStructuresClasses.Algorithm): Framework.Object
begin
return NIL;
end method;

------------------------------------------------------------
method Algorithm.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Assoc.Append(input uneCle: Framework.TextData,
	input uneValeur: Framework.TextData)
begin
--
--	Description : Ajout d'un élément de type textdata
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Assoc.Append');

unAssocItem : AssocItem;
Find(uneCle,unAssocItem);
if  unAssocItem = NIL then 
	unAssocItem = new();
	unAssocItem.SetParams(aItem=uneCle,aValue=uneValeur);
	lesElements.AppendRow(unAssocItem);
else
	unAssocItem.SetParams(uneCle,uneValeur); -- si la clé existe déjà, on la remplace. Moyen !
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Assoc.Append : End');

end method;

------------------------------------------------------------
method Assoc.Clear
begin
--
--	Description : Effacement de la liste des éléments
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Assoc.Clear');

lesElements.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Assoc.Clear : End');

end method;

------------------------------------------------------------
method Assoc.Find(input uneCle: Framework.TextData,
	input output unResult: DataStructuresClasses.AssocItem): DataStructuresClasses.AssocItem
begin
--
--	Description : Recherche d'un élément
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Assoc.Find');

Found : AssocItem;
for i in lesElements do
  if i.HasKey(uneCle) then
   Found = i;
   exit;
  end if;
end for;
  
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Assoc.Find : End');

unResult = Found;
return unResult;

end method;

------------------------------------------------------------
method Assoc.FindByKey(input uneCle: Framework.TextData): DataStructuresClasses.AssocItem
begin
--
--	Description : Recherche d'un élément par sa clé et renvoi de la valeur
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Assoc.FindByKey');

unAssocItem : AssocItem;
Find(uneCle,unAssocItem);
uneValeur   : TextData;
if unAssocItem<>NIL then
   uneValeur = unAssocItem.GetItem();
else
   uneValeur = NIL; -- inutile, mais ca documente
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Assoc.FindByKey : End');

return unAssocItem;

end method;

------------------------------------------------------------
method Assoc.GetElements: Framework.Array of DataStructuresClasses.AssocItem
begin
--
--	Description : Renvoi de tous les éléments de l'association
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

return lesElements;
end method;

------------------------------------------------------------
method Assoc.Init
begin
--
--	Description : Initialisation d'un Assoc
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Assoc.Init');

super.Init();
lesElements = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Assoc.Init : End');

end method;

------------------------------------------------------------
method AssocException.Init
begin
super.Init();
end method;

------------------------------------------------------------
method AssocFlag.ClearFlags
begin
--
--	Description : Effacement des flags
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocFlag.ClearFlags');

for unElement in lesElements do 
    unElement.SetExtra(flagFalse);
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocFlag.ClearFlags : End');

end method;

------------------------------------------------------------
method AssocFlag.Init
begin
--
--	Description : Initialisation de AssocFlag
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocFlag.Init');

super.Init();
lesElements = new();

FlagFalse = new();		-- Utilisation du poids mouche
FlagFalse.SetValue(FALSE);

FlagTrue = new();
FlagTrue.SetValue(TRUE);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocFlag.Init : End');

end method;

------------------------------------------------------------
method AssocGen.Append(input uneCle: Framework.DataValue,
	input uneValeur: Framework.DataValue)
begin
--
--	Description : Ajout d'un élément de type textdata
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.Append');

unAssocItem : AssocItemGen;
Find(uneCle,unAssocItem);
if  unAssocItem = NIL then 
	unAssocItem = new();
	unAssocItem.SetParams(aKey=uneCle,aValue=uneValeur);
	Append(unAssocItem);
else
	unAssocItem.SetParams(uneCle,uneValeur); -- si la clé existe déjà, on la remplace. Moyen !
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.Append : End');

end method;

------------------------------------------------------------
method AssocGen.Append(input unAssocItemGen: DataStructuresClasses.AssocItemGen)
begin
--
--	Description : Ajout d'un élément de type TextData
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

-- Dans ce type d'ajout, pas de recherche d'unicité
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.Append');

lesElements.AppendRow(unAssocItemGen);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.Append : End');

end method;

------------------------------------------------------------
method AssocGen.Clear
begin
--
--	Description : Effacement de la liste des éléments
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.Clear');

lesElements.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.Clear : End');

end method;

------------------------------------------------------------
method AssocGen.Find(input uneCle: Framework.Object,
	input output unResult: DataStructuresClasses.AssocItemGen): DataStructuresClasses.AssocItemGen
begin
--
--	Description : Recherche d'un élément
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Modification pour prendre en compte les classes usuelles directement (Un seul cast)
--+

-- L'opérateur IsA exploitant les informations de type RTTI, on souhaite faire le test uniquement avant
-- l'entrée dans la boucle.
-- Evite les casts multiples (runtime) et la surcharge de Find et FindByKey pour chaque
-- type de classe.

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.Find');

-- Le but de la duplication de code est de factoriser l'emploi de l'opérateur IsA

		Found : AssocItemGen;
if      uneCle.IsA(TextData) then

		uneCleText : TextData = (TextData) (uneCle);
		for unElement in lesElements do
		  if unElement.HasKey(uneCleText) then
		   Found = unElement;
		   exit;
		  end if;
		end for;

elseif  uneCle.IsA(IntegerData) then

		uneCleInt : IntegerData = (IntegerData) (uneCle);
		for unElement in lesElements do
		  if unElement.HasKey(uneCleInt) then
		   Found = unElement;
		   exit;
		  end if;
		end for;

elseif  uneCle.IsA(DoubleData) then

		uneCleDou : DoubleData = (DoubleData) (uneCle);
		for unElement in lesElements do
		  if unElement.HasKey(uneCleDou) then
		   Found = unElement;
		   exit;
		  end if;
		end for;
		
elseif  uneCle.IsA(BooleanData) then

		uneCleBoo : BooleanData = (BooleanData) (uneCle);
		for unElement in lesElements do
		  if unElement.HasKey(uneCleBoo) then
		   Found = unElement;
		   exit;
		  end if;
		end for;

else
	   -- Classe non prévue, lever une exception pour signaler le problème
       uneException : AssocException = new();
       uneException.SetWithParams(SP_ER_ERROR, 'DataStructuresClasses.AssocGen.DoIsKey(DataValue) : Classe non prévue');
       raise uneException;
end if;

  
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.Find : End');

unResult = Found;
return unResult;
end method;

------------------------------------------------------------
method AssocGen.FindByKey(input uneCle: Framework.Object): DataStructuresClasses.AssocItemGen
begin
--
--	Description : Recherche d'un élément par sa clé et renvoi de la valeur
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.FindByKey');

unAssocItem : AssocItemGen;
Find(uneCle,unAssocItem);
uneValeur   : Object;
if unAssocItem<>NIL then
   uneValeur = unAssocItem.GetItem();
else
   uneValeur = NIL; -- inutile, mais ca documente
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.FindByKey : End');

return unAssocItem;

end method;

------------------------------------------------------------
method AssocGen.GetElements: Framework.Array of DataStructuresClasses.AssocItemGen
begin
--
--	Description : Recherche d'un élément par sa clé et renvoi de la valeur
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

return lesElements;
end method;

------------------------------------------------------------
method AssocGen.Init
begin
--
--	Description : Initialisation
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocGen.Init');
super.Init();
lesElements = new();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocGen.Init : End');
end method;

------------------------------------------------------------
method AssocItem.GetExtra: Framework.Object
begin
--
--	Description : Retourne la valeur supplémentaire
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

return Extra;
end method;

------------------------------------------------------------
method AssocItem.GetItem: Framework.TextData
begin
--
--	Description : Retourne la valeur d'un élément d'association
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

return ItemValue;
end method;

------------------------------------------------------------
method AssocItem.HasKey(input uneCle: Framework.TextData): Framework.boolean
begin
--
--	Description : Initialisation d'un objet AssocItem
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.HasKey');

Found : boolean = uneCle.IsEqual(ItemName,ignoreCase=TRUE);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.HasKey : End');

return Found;
end method;

------------------------------------------------------------
method AssocItem.Init
begin
--
--	Description : Initialisation d'un objet AssocItem
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.Init');

-- Déjà initialisés lors du passage de paramètres par la méthode SetParams
--ItemName = new();
--ItemValue = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.Init : End');

end method;

------------------------------------------------------------
method AssocItem.SetExtra(input unExtra: Framework.Object)
begin
--
--	Description : Positionnement de la valeur supplémentaire
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

Extra = unExtra;
end method;

------------------------------------------------------------
method AssocItem.SetParams(input aItem: Framework.TextData,
	input aValue: Framework.TextData)
begin
--
--	Description : Initialisation d'un élément d'association
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.SetParams');

ItemName = aItem;
ItemValue = aValue;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.SetParams : End');

end method;

------------------------------------------------------------
method AssocItemGen.DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer
begin
--
--	Description : Test de la présence d'une clé
--
--	Type :	abstrait
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directement 
--+

-- Méthode d'implémentation : (Idem strcmp en C)
-- -1 : X<Y
-- +1 : X>Y
--  0 : X=Y

Exc : NeedOverride = new();
Exc.SetWithParams(SP_ER_ERROR,'La méthode DoCompare doit être implémentée');
raise Exc;


end method;

------------------------------------------------------------
method AssocItemGen.DoIsKey(input aKey: Framework.Object): Framework.boolean
begin
--
--	Description : Test de la présence d'une clé
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Test de plusieurs types courants
--+

-- Idéalement, l'utilisation (après surcharge de HasKey) devrait être préférée à cette méthode
-- pour éviter de trop nombreux casts et appels de l'opérateur IsA qui sont couteux en termes
-- de performances.

-- A noter : Seul le paramètre passe par le test de l'opérateur IsA. Donc, le ItemKey correspondant doit être
-- du même type sinon, une exception sera levée au moment du cast de ItemKey

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.DoIsKey');

statut : boolean;
if     aKey.IsA(TextData) then
       statut = (TextData) (aKey).IsEqual((TextData) (ItemKey),ignoreCase=TRUE);	
elseif aKey.IsA(NumericData) then
	   statut = (NumericData) (aKey).IsEqual((NumericData) (ItemKey));
elseif aKey.IsA(BooleanData) then
	   statut = (BooleanData) (aKey).IsEqual((BooleanData) (ItemKey));
else
	   -- Classe non prévue, lever une exception pour signaler le problème
       uneException : AssocException = new();
       uneException.SetWithParams(SP_ER_ERROR, 'DataStructuresClasses.DoIsKey(DataValue) : Classe non prévue');
       raise uneException;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.DoIsKey : End');

return statut;
end method;

------------------------------------------------------------
method AssocItemGen.GetExtra: Framework.Object
begin
--
--	Description : Retourne la valeur supplémentaire
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

return Extra;
end method;

------------------------------------------------------------
method AssocItemGen.GetItem: Framework.Object
begin
--
--	Description : Retourne la valeur d'un élément d'association
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

return ItemValue;
end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.DataValue): Framework.boolean
begin
--
--	Description : Test de la présence d'une clé
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directement 
--+

-- Cette version prend en compte le cas général (DataValue), mais est plus coûteuse. Il est préférable
-- d'utiliser les autres surcharges qui économisent un certain nombre de tests et de casts

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.HasKey');

Found : boolean = DoIsKey(uneCle);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.HasKey : End');

return Found;
end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.IntegerData): Framework.boolean
begin
--
--	Description : Détermine si le paramètre uneCle est une clé d'accès au AssocItem (self)
--
--	Type :	concret
--
--	Parametres :   uneCle : Clé à examiner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directements
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.HasKey(IntegerData)');

statut : boolean = uneCle.IsEqual((IntegerData) (ItemKey));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.HasKey(IntegerData) : End');

return statut;

end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.TextData): Framework.boolean
begin
--
--	Description : Détermine si le paramètre uneCle est une clé d'accès au AssocItem (self)
--
--	Type :	concret
--
--	Parametres :   uneCle : Clé à examiner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directements
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.HasKey(TextData)');

statut : boolean = uneCle.IsEqual((TextData) (ItemKey),ignoreCase=TRUE);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.HasKey(TextData) : End');

return statut;

end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.BooleanData): Framework.boolean
begin
--
--	Description : Détermine si le paramètre uneCle est une clé d'accès au AssocItem (self)
--
--	Type :	concret
--
--	Parametres :   uneCle : Clé à examiner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directements
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.HasKey(BooleanData)');

statut : boolean = uneCle.IsEqual((BooleanData) (ItemKey));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.HasKey(BooleanData) : End');

return statut;

end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.DoubleData): Framework.boolean
begin
--
--	Description : Détermine si le paramètre uneCle est une clé d'accès au AssocItem (self)
--
--	Type :	concret
--
--	Parametres :   uneCle : Clé à examiner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directements
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.HasKey(DoubleData)');

statut : boolean = uneCle.IsEqual((DoubleData) (ItemKey));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.HasKey(DoubleData) : End');

return statut;
end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.NumericData): Framework.boolean
begin
--
--	Description : Détermine si le paramètre uneCle est une clé d'accès au AssocItem (self)
--
--	Type :	concret
--
--	Parametres :   uneCle : Clé à examiner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directements
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.HasKey(NumericData)');

statut : boolean = uneCle.IsEqual((NumericData) (ItemKey));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.HasKey(NumericData) : End');

return statut;


end method;

------------------------------------------------------------
method AssocItemGen.HasKey(input uneCle: Framework.Object): Framework.boolean
begin
--
--	Description : Test de la présence d'une clé
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	17/04/1998	|	Surcharge multiple pour prendre en compte les types usuels directement 
--+

-- Cette version prend en compte le cas général (Object), mais est plus coûteuse. Il est préférable
-- d'utiliser les autres surcharges qui économisent un certain nombre de tests et de casts

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.HasKey');

Found : boolean = DoIsKey(uneCle);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.HasKey : End');

return Found;
end method;

------------------------------------------------------------
method AssocItemGen.Init
begin
--
--	Description : Initialisation d'un objet AssocItem
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.Init');

-- Déjà initialisés lors du passage de paramètres par la méthode SetParams
--ItemName = new();
--ItemValue = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.Init : End');

end method;

------------------------------------------------------------
method AssocItemGen.SetExtra(input unExtra: Framework.Object)
begin
--
--	Description : Positionnement de la valeur supplémentaire
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	25/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItemGen.SetExtra');
Extra = unExtra;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItemGen.SetExtra : End');
end method;

------------------------------------------------------------
method AssocItemGen.SetParams(input aKey: Framework.Object,
	input aValue: Framework.Object)
begin
--
--	Description : Initialisation d'un élément d'association
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AssocItem.SetParams');

ItemKey = aKey;
ItemValue = aValue;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AssocItem.SetParams : End');

end method;

------------------------------------------------------------
method BinaryFunction.Execute(input Value1: Framework.Object,
	input Value2: Framework.Object): Framework.Object
begin
Exc : DataStructureException = new();
Exc.SetWithParams(SP_ER_ERROR,'La méthode Execute doit être implémentée');
raise Exc;
end method;

------------------------------------------------------------
method BinaryFunction.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Chronometre.AsInterval: Framework.IntervalData
begin
--
--	Description : Renvoie le chrono sous la forme d'un IntervalData
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Chronometre.AsInterval');

unIntervalle : IntervalData = new();
Clock.SplitAsInterval(unIntervalle);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Chronometre.AsInterval : End');

return unIntervalle;
end method;

------------------------------------------------------------
method Chronometre.AsText: Framework.TextData
begin
--
--	Description : Renvoie le chrono sous la forme d'un textdata
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Chronometre.AsText');

unIntervalle : IntervalData = AsInterval();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Chronometre.AsText : End');

return unIntervalle.TextValue;
end method;

------------------------------------------------------------
method Chronometre.Fire
begin
--
--	Description : Lancement du chronomètre
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Chronometre.Fire');

Clock.Fire();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Chronometre.Fire : End');
end method;

------------------------------------------------------------
method Chronometre.Init
begin
--
--	Description : Initialisation du chronomètre
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Chronometre.Init');

super.Init();
Clock = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Chronometre.Init : End');

end method;

------------------------------------------------------------
method DataStructureException.Init
begin
--
--	Description : Initialisation d'une exception "DataStructure"
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataStructureException.Init');
super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataStructureException.Init : End');
end method;

------------------------------------------------------------
method Function.Execute: Framework.Object
begin
return NIL;
end method;

------------------------------------------------------------
method Function.Init
begin
super.Init();
end method;

------------------------------------------------------------
method IotaGen.Execute: Framework.Object
begin
--
--	Description : Positionnement du générateur de séquence à la valeur suivante
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	11/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- IotaGen.Execute');

SequenceValue = SequenceValue + SequenceIncrement;
aRes : IntegerData = IntegerData(Value=SequenceValue); -- pour garantir la non modification du compteur

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- IotaGen.Execute : End');

return aRes;
end method;

------------------------------------------------------------
method IotaGen.Init
begin
--
--	Description : Initialisation par défaut du générateur de séquence
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	11/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- IotaGen.Init');

super.Init();
SequenceValue = 1;
SequenceIncrement = 1;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- IotaGen.Init : End');

end method;

------------------------------------------------------------
method IotaGen.InitSequence(input aValue: Framework.integer,
	input anIncrement: Framework.integer = 1)
begin
--
--	Description : Initialisation de la valeur et de l'incrément du générateur de séquence
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	11/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- IotaGen.InitSequence');

SequenceValue = aValue;
SequenceIncrement = anIncrement;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- IotaGen.InitSequence : End');

end method;

------------------------------------------------------------
method NeedOverride.Init
begin
super.Init();
end method;

------------------------------------------------------------
method OneToMany.Append(input uneValeur: Framework.Object)
begin
--
--	Description : Ajout d'une valeur
--
--	Type :	concret
--
--	Parametres :   uneValeur : Valeur à ajouter
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.Append');

unObject : Object = uneValeur;
Chemin.AppendRow(unObject);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.Append : End');

end method;

------------------------------------------------------------
method OneToMany.BuildFromArray(input anArray: Framework.GenericArray)
begin
Chemin = (array of Object) (anArray);
end method;

------------------------------------------------------------
method OneToMany.Clear
begin
--
--	Description : Effacement de la liste des valeurs. OBSOLETE. Maintenue pour conserver l'interface publique.
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.Clear');

Chemin.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.Clear : End');

end method;

------------------------------------------------------------
method OneToMany.ClearAllItems
begin
--
--	Description : Effacement de la liste des valeurs
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.ClearAllItems');

self.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.ClearAllItems : End');

end method;

------------------------------------------------------------
method OneToMany.GetCurrIndex: Framework.integer
begin
--
--	Description : Renvoie l'index en cours
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.GetCurrIndex');

unEntier : integer = Parcours;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.GetCurrIndex : End');

return unEntier;

end method;

------------------------------------------------------------
method OneToMany.GetFirst: Framework.Object
begin
--
--	Description : Accesseur sur le premier élément de la liste
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.GetFirst');

Parcours = 1;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.GetFirst : End');

return Chemin[1];
end method;

------------------------------------------------------------
method OneToMany.GetItems: Framework.Array of Framework.Object
begin
--
--	Description : Accesseur sur les éléments de la liste (tous)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.GetItems');

unChemin : array of Object = Chemin;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.GetItems : End');

return UnChemin;
end method;

------------------------------------------------------------
method OneToMany.GetNext: Framework.Object
begin
--
--	Description : Accesseur sur le premier élément de la liste
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.GetNext');

unResult : Object;
Parcours = Parcours + 1;
if Chemin[Parcours] = NIL  
then unResult=NIL;
else unResult=Chemin[Parcours];
end  if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.GetNext : End');

return unResult;

end method;

------------------------------------------------------------
method OneToMany.GetObjectAtIndex(input Index: Framework.integer): Framework.Object
begin
--
--	Description : Accesseur sur un objet à un index donné
--
--	Type :	concret
--
--	Parametres :   Index : L'index de l'élément recherché
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.GetObjectAtIndex');

unObject : Object = Chemin[index];

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.GetObjectAtIndex : End');

return unObject;
end method;

------------------------------------------------------------
method OneToMany.Init
begin
--
--	Description : Initialisation 
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.Init');

super.Init();
Parcours = 1;
Chemin = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.Init : End');

end method;

------------------------------------------------------------
method OneToMany.IsAtEnd: Framework.boolean
begin
--
--	Description : Test de fin de liste
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.IsAtEnd');

statut : boolean = Parcours = Chemin.Items;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.IsAtEnd : End');

return statut;
end method;

------------------------------------------------------------
method OneToMany.IsAtStart: Framework.boolean
begin
--
--	Description : Test de fin de liste
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.IsAtEnd');

statut : boolean = Parcours = 1;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.IsAtEnd : End');

return statut;
end method;

------------------------------------------------------------
method OneToMany.IsEmpty: Framework.boolean
begin
--
--	Description : Teste si la table est vide
--
--	Type :	concret
--
--	Parametres :   uneValeur : Valeur à ajouter
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.IsEmpty');

unRes : boolean = Chemin.Items = 0;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.IsEmpty : End');

return unRes;
end method;

------------------------------------------------------------
method OneToMany.SetItems(input Items: Framework.Array of Framework.Object)
begin
--
--	Description : Positionnement de tous les éléments
--
--	Type :	concret
--
--	Parametres :   Items : Le tableau d'éléments à positionner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.SetItems');

Chemin = Items;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.SetItems : End');

end method;

------------------------------------------------------------
method OneToMany.SetObjectAtIndex(input index: Framework.integer,
	input aObject: Framework.Object)
begin
--
--	Description : Positionnement de tous les éléments
--
--	Type :	concret
--
--	Parametres :   Index : Index de l'élément à positionner
--				   aObject : Instance à positionner (Valeur)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OneToMany.SetObjectAtIndex');

Chemin[index]=aObject;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OneToMany.SetObjectAtIndex : End');

end method;

------------------------------------------------------------
method SearchTree.BackTrack(input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--	Description : Remontée vers la racine de l'arbre avec notification pour
-- 				  chaque noeud remonté
--
--	Type :	concret
--
--	Parametres :    CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.BackTrack');

Parcours : SearchTree;
Parcours = Self;
while Parcours <> NIL do
	
	DoNotifyNodeFound(Parcours,CaseBranch,Param);
	Parcours = Parcours.Father;

end while;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.BackTrack : End');


end method;

------------------------------------------------------------
method SearchTree.DeepLeftTraversalInOrder(input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--
--	Description : Traversée en profondeur et à gauche d'abord
--
--	Type :	concret
--
--	Parametres :    CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.DeepLeftTraversal');

if Left<>NIL then 
   Left.DeepLeftTraversalInOrder(CaseBranch,Param);
end if;

DoNotifyNodeFound(Self,CaseBranch,Param);

if Right<>NIL then
   Right.DeepLeftTraversalInOrder(CaseBranch,Param);	
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.DeepLeftTraversal : End');

end method;

------------------------------------------------------------
method SearchTree.DeepRightTraversalInOrder(input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--	Description : Traversée en profondeur et à droite d'abord
--
--	Type :	concret
--
--	Parametres :    CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.DeepRightTraversal');

if Right<>NIL then
   Right.DeepRightTraversalInOrder(CaseBranch,Param);	
end if;

DoNotifyNodeFound(Self,CaseBranch,Param);

if Left<>NIL then 
   Left.DeepRightTraversalInOrder(CaseBranch,Param);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.DeepRightTraversal : End');

end method;

------------------------------------------------------------
method SearchTree.DeleteChildren(input Notification: Framework.boolean,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--
--	Description : Suppression de tous les noeuds fils
--
--	Type :	concret
--
--  Parametres : Notification : Faut t'il notifier ?
-- 				 CaseBranch   : Code associé à la notification (à destination de DoNotifyNodeFound)	
--				 Param		  : Paramètre associé à la notification
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.DeleteChildren');

if Left <> NIL then
   Left.DeleteChildren(Notification,CaseBranch,Param);
   Left = NIL;
end if;

if Notification then
  DoNotifyNodeFound(self,CaseBranch,Param);
end if;

if Right<>NIL then
   Right.DeleteChildren(Notification,CaseBranch,Param);	
   Right = NIL;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.DeleteChildren : End');


end method;

------------------------------------------------------------
method SearchTree.DeleteNodeForKey(input aKey: Framework.Object,
	input Notification: Framework.boolean = FALSE,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): Framework.boolean
begin
--
--	Description : Suppression du noeud contenant la clé en paramètre
--
--	Type :	concret
--
--	Parametres :    aKey  : La clé à rechercher
--					Notification : Faut t'il notifier la suppression du noeud et de ses noeuds fils
--					CaseBranch	 : Code action à passer à la méthode callback
--					Param        : Paramètre utilisable par la notification
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

unResult : boolean = FALSE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.DeleteNodeForKey');

NoeudTrouve : SearchTree = LookupNode(aKey,CaseBranch,Param);
if NoeudTrouve = NIL then
   unResult = FALSE;
else
   unResult = TRUE;	
   NoeudTrouve.DeleteChildren(Notification,CaseBranch,Param);  -- DeleteChildren ou réinsertion des éléments fils ?
   NoeudTrouve = NIL; -- Suppression également de la racine du sous-arbre
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.DeleteNodeForKey : End');

return unResult;

end method;

------------------------------------------------------------
method SearchTree.DoAcceptDuplicates: Framework.boolean
begin
--
--	Description : Doit t'on accepter les valeurs (sémantiquement) en double
-- 				  (FALSE par défaut)
--
--	Type :	Abstrait
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

return FALSE;
end method;

------------------------------------------------------------
method SearchTree.DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer
begin
--
--	Description : Comparer deux clés
--
--	Type :	abstrait
--
--	Parametres :    Key1  : Première clé
--					Key2  : Deuxième clé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

-- On ne devrait pas exécuter cette méthode

Exc : NeedOverride = new();
Exc.SetWithParams(SP_ER_ERROR,'La méthode abstraite DoCompare n''a pas été redéfinie');
raise Exc;


end method;

------------------------------------------------------------
method SearchTree.DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--
--	Description : Méthode "callback" appelée dans le cadre du mécanisme de notification
--
--	Type :	abstrait
--
--	Parametres :    aNode      : Le noeud faisant l'objet de la notification
--	                CaseBranch : Code de l'action à effectuer 
--					Param 	   : Paramètre utilisable pour un traitement du noeud 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

-- Cette méthode doit être surchargée par la classe dérivée
-- La variable CaseBranch donne une indication (utilisateur) ce
-- l'action à effectuer avec la donnée

-- Exemple :
-- case CaseBranch is
--   when 1 do
--			(Stack) (Param).Push(aNode.Value);
-- end case;

Exc : NeedOverride = new();
Exc.SetWithParams(SP_ER_ERROR,'La méthode abstraite DoCompare n''a pas été redéfinie');
raise Exc;

end method;

------------------------------------------------------------
method SearchTree.DoRaiseExceptionWhenDuplicateValues: Framework.boolean
begin
--
--	Description : Faut t'il lever une exception en cas de clé dupliquée ?
--
--	Type :	abstrait
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

return FALSE;
end method;

------------------------------------------------------------
method SearchTree.ForceNode(input aKey: Framework.Object,
	input aValue: Framework.Object,
	input aClassType: Framework.ClassType,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree
begin
--
--	Description : Forcer la création d'un couple (clé,donnée) si il n'existe pas déjà
--
--	Type :	concret
--
--	Parametres :    aKey       : Clé à créer
--					aValue     : Donnée associée à la clé
--	                CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

-- Vérifie d'abord si une clé existe, renvoie le noeud correspondant
-- ou effectue la création de cette clé (=noeud) si elle n'existe pas déjà

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.ForceNode');

NoeudTrouve : SearchTree = LookupNode(aKey,CaseBranch,Param);
if NoeudTrouve=NIL then
   NoeudTrouve = Insert(aKey,aValue,aClassType);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.ForceNode : End');

return NoeudTrouve;
end method;

------------------------------------------------------------
method SearchTree.GetKey: Framework.Object
begin
--
--	Description : Récupération de la clé associée au noeud
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

return Key;
end method;

------------------------------------------------------------
method SearchTree.GetValue(input Clone: Framework.boolean = FALSE): Framework.Object
begin
--
--	Description : Récupération de la donnée associée au noeud
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

if Clone=TRUE 
 then return Value.Clone(Deep=TRUE);
 else return Value;
end if;
end method;

------------------------------------------------------------
method SearchTree.HasChildren: Framework.boolean
begin
--
--	Description : Le noeud a t'il des noeuds fils ?
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

return left<>NIL or right<>NIL;

end method;

------------------------------------------------------------
method SearchTree.Init
begin
--
--	Description : Initialisation d'un noeud
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.Init : End');

end method;

------------------------------------------------------------
method SearchTree.Insert(input aKey: Framework.Object,
	input aValue: Framework.Object,
	input aClassType: Framework.ClassType): DataStructuresClasses.SearchTree
begin
--
--	Description : Insertion d'un couple (clé,donnée) sous la forme d'un nouveau noeud dans l'arbre
--
--	Type :	concret
--
--	Parametres :    aKey 	   : Clé du noeud
--					CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.Insert');

unResult : SearchTree;

if aKey <> NIL then

	if self.Key = NIL then
	   SetParams(aKey,aValue);
	   unResult = self;
	else
		SensComp : integer = DoCompare(aKey,Self.Key); -- Effectuer la comparaison de la clé du noeud et de la nouvelle clé
		case SensComp is
			 
			 -- Key > aKey 
			 when 1	 do 
			    if Right = NIL then
				   Right = (SearchTree) (aClassType.InstanceAlloc());
				   Right.SetParams(aKey,aValue);
				   Right.Father = Self;
				   unResult = Right;
				else
				   unResult = Right.Insert	(aKey,aValue,aClassType);
			    end if;
			    
			 -- Key < aKey 
			 when -1 do
			    if Left = NIL then
			       Left = (SearchTree) (aClassType.InstanceAlloc());
				   Left.SetParams(aKey,aValue);
				   Left.Father = Self;
				   unResult = Left;
				else
				   unResult = Left.Insert	(aKey,aValue,aClassType);
			    end if;
		
			 -- Key = aKey 
			 when  0 do
				
				if DoAcceptDuplicates() then
				
				    if Left = NIL then
				       Left = (SearchTree) (aClassType.InstanceAlloc());
					   Left.SetParams(aKey,aValue);
					   Left.Father = Self;
					   unResult = Left;
					else
					   unResult = Left.Insert	(aKey,aValue,aClassType);
				    end if;
				  	
				else
					if DoRaiseExceptionWhenDuplicateValues() then
						uneException : SearchTreeException = new();
						uneException.SetWithParams(SP_ER_ERROR,'Tentative d''insertion d''une clé déjà définie');
						raise uneException;	 
					end if;
				end if;
		end case;
	end if;
else
	uneException : SearchTreeException = new();
	uneException.SetWithParams(SP_ER_ERROR,'Tentative d''insertion d''une clé à NIL');
	raise uneException;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.Insert : End');

return unResult;

end method;

------------------------------------------------------------
method SearchTree.LookupNode(input aKey: Framework.Object,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree
begin
--
--	Description : Recherche d'un noeud correspondant à la clé passée en paramètre
--
--	Type :	concret
--
--	Parametres :    aKey	   : Clé à rechercher
--					CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.LookupNode');

unResult : SearchTree;
SensComp : integer;

if aKey <> NIL and self.Key <> NIL then

	SensComp = DoCompare(aKey,self.Key); -- Effectuer la comparaison de la clé du noeud et de la nouvelle clé
	case SensComp is
		 
		 -- Key > aKey 
		 when 1	 do 
		    if Right = NIL then
			   unResult = NIL;
			else
			   unResult = Right.LookupNode	(aKey,CaseBranch,Param);
		    end if;
		    
		 -- Key < aKey 
		 when -1 do
		    if Left = NIL then
			   unResult = NIL;
			else
			   unResult = Left.LookUpNode	(aKey,CaseBranch,Param);
		    end if;
	
		 -- Key = aKey 
		 when  0 do
			
			if DoAcceptDuplicates() 
			then
			     DoNotifyNodeFound(self,CaseBranch,Param); -- Permet d'éviter l'utilisation d'une 
			     						  -- variable globale, pas très propre avec la récursivité
			     unResult = Left.LookupNode(aKey,CaseBranch,Param);			
	    	else unResult = Self;
			end if;
	end case;

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.LookupNode : End');

return unResult;

end method;

------------------------------------------------------------
method SearchTree.LookupValue(input aKey: Framework.Object,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object,
	input Clone: Framework.boolean = FALSE): Framework.Object
begin
--
--	Description : Recherche d'une valeur directement, utilisation de la méthode LookupNode
--  			  et contrôle de unNoeud = NIL
--
--	Type :	concret
--
--	Parametres :    aKey	   : Clé à rechercher
--					CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.LookupValue');

unResult : Object;
unNoeud  : SearchTree = LookupNode(aKey,CaseBranch,Param);
if unNoeud = NIL 
then unResult = NIL;
else unResult = unNoeud.GetValue(Clone);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.LookupValue : End');

return unResult;

end method;

------------------------------------------------------------
method SearchTree.RotateNode
begin
--
--	Description : Rotation du noeud
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.RotateNode');

Tmp : SearchTree = Left;
Left = Right;
Right = Tmp;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.RotateNode : End');

end method;

------------------------------------------------------------
method SearchTree.SetParams(input aKey: Framework.Object,
	input aValue: Framework.Object)
begin
--
--	Description : Affectation de la clé et de la donnée du noeud
--
--	Type :	concret
--
--	Parametres :    aKey    : Clé du noeud
--					aValue  : Données du noeud
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.SetParams');

Key = aKey;
Value = aValue;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.SetParams : End');

end method;

------------------------------------------------------------
method SearchTree.WalkBack(input DoNotify: Framework.boolean,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object): DataStructuresClasses.SearchTree
begin
--	Description : Traversée en profondeur et à droite d'abord
--
--	Type :	concret
--
--	Parametres :    CaseBranch : Code de l'action à effectuer dans DoNotifyNodeFound
--					Param 	   : Données à passer à DoNotifyNodeFound
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SearchTree.Walkback');

Tmp : SearchTree = self.Father;
if DoNotify = TRUE then
   DoNotifyNodeFound(Tmp,CaseBranch,Param); 
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SearchTree.Walkback : End');

return Tmp;
end method;

------------------------------------------------------------
method SearchTreeException.Init
begin
--
--	Description : Initialisation d'un SearchTree
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+
super.Init();
end method;

------------------------------------------------------------
method Stack.ClearAllItems
begin
--
--	Description : Effacement de l'ensemble des éléments de la pile
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

ItemList.Clear();
TopIndex = 0;
end method;

------------------------------------------------------------
method Stack.GetSize: Framework.integer
begin
--
--	Description : Nombre d'éléments actuellement stockés dans la pile
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+
return TopIndex;
end method;

------------------------------------------------------------
method Stack.Init
begin
--
--	Description : Initialisation d'une pile
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Stack.Init');
super.Init();
ItemList = new();
TopIndex = 0;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Stack.Init : End');
end method;

------------------------------------------------------------
method Stack.IsEmpty: Framework.boolean
begin
--
--	Description : Teste si la pile est vide
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	22/04/1998	|	Creation.
--+

return TopIndex = 0;
end method;

------------------------------------------------------------
method Stack.Peek(input Clone: Framework.boolean = FALSE): Framework.Object
begin
--
--	Description : récupérer le sommet de la pile sans dépiler.
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

if Clone = TRUE 
	then return ItemList[TopIndex].Clone(Deep=TRUE);
	else return ItemList[TopIndex];
end if;
end method;

------------------------------------------------------------
method Stack.Pop(input Clone: Framework.boolean = FALSE): Framework.Object
begin
--
--	Description : Dépilement d'un objet
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Stack.Pop');

aRes : Object;
if Clone=TRUE 
	then aRes = ItemList[TopIndex].Clone(Deep=TRUE);
	else aRes = ItemList[TopIndex];
end if;
ItemList[TopIndex] = NIL;
TopIndex = TopIndex - 1;
if TopIndex = -1 then 
   StackUnderFlow : StackException = new();
   StackUnderFlow.SetWithParams	(severity=SP_ER_ERROR, message='erreur de pile : La pile est vide !');
   raise StackUnderFlow;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Stack.Pop : End');

return aRes;

end method;

------------------------------------------------------------
method Stack.Push(input unObjet: Framework.Object,
	input Clone: Framework.boolean = FALSE)
begin
--
--	Description : Empilement d'un objet
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Stack.Push');

TopIndex = TopIndex + 1;
if Clone=TRUE 
	then ItemList[TopIndex] = unObjet.Clone(deep=TRUE);
	else ItemList[TopIndex] = unObjet;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Stack.Push : End');

end method;

------------------------------------------------------------
method Stack.Reverse
begin
--
--	Description : Inversion de la pile
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Stack.Reverse');

ReverseStack : Stack = self.Clone(Deep=True);
self.ClearAllItems();

while not ReverseStack.IsEmpty() do
	self.Push(ReverseStack.Pop());
end while;

-- La méthode pourrait peut t 'être être remplacée par une version avec insertion de l'élément en haut
-- en bas de la pile et en remontant vers le haut de la pile,
-- ceci le nombre de fois le nombre d'éléments de la pile - 1

-- Problème : coût des insertions < coût du Clone et du parcours de la pile ?

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Stack.Reverse : End');
end method;

------------------------------------------------------------
method StackException.Init
begin
--
--	Description : Initialisation d'une exception de pile
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method UnaryFunction.Execute(input Value: Framework.Object): Framework.Object
begin
Exc : DataStructureException = new();
Exc.SetWithParams(SP_ER_ERROR,'Méthode Execute non implémentée');
raise Exc;

end method;

------------------------------------------------------------
method UnaryFunction.Init
begin
super.Init();
end method;

------------------------------------------------------------
method UnsupportedOperation.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'datastru';


end DataStructuresClasses;
begin TOOL FileDataAccessSrv;

includes DataAccessSrvBD;
includes FrameworkBD;
includes GenericDBMS;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  BooleanFileStructureDesc;
forward  DateFileStructureDesc;
forward  FileDataAccessExc;
forward  FileDataServiceDesc;
forward  FileStructureDesc;
forward  FileStructureDescExc;
forward  IntegerFileStructureDesc;
forward  LogFile;
forward  NumericFileStructureDesc;
forward  TextFileStructureDesc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_FILE_DELETE = 10003;
constant ACT_FILE_INIT = 10001;
constant ACT_FILE_TERMINATE = 10002;
constant CHARACTER_CASE_ANY = 3;
constant CHARACTER_CASE_LOWER = 1;
constant CHARACTER_CASE_UPPER = 2;
constant DEFAULT_COMPLETION_CHARACTER = '*';
constant DEFAULT_LABEL_FALSE = 'N';
constant DEFAULT_LABEL_TRUE = 'O';
constant JUSTIFY_LEFT = 1;
constant JUSTIFY_RIGHT = 2;
constant LOG_GRPFLAG = 66;
constant ROUNDING_AUTO = 1;
constant ROUNDING_LOWER = 2;
constant ROUNDING_TRUNCATE = 4;
constant ROUNDING_UPPER = 3;
constant SIGN_ALWAYS = 2;
constant SIGN_DISABLE = 1;
constant SIGN_ENABLE = 3;
constant SIGN_POS_LEFTMOST = 1;
constant SIGN_POS_RIGHTMOST = 2;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class FileStructureDesc inherits from DataAccessSrvBD.StructureDesc

has public  attribute CompletionCharacter: Framework.string;
has public  attribute CustomFormat: Framework.TextData;
has public  attribute DataFormat: Framework.DataFormat;
has public  attribute Justification: Framework.integer;
has public  attribute Length: Framework.integer;
has public  attribute StartIndex: Framework.integer;

has public  method CompleteString(input aResultString: Framework.TextData);
has public  method DoFormatOutput(input aField: FileDataAccessSrv.FileStructureDesc,
	input RaiseStringTooLong: Framework.boolean): Framework.TextData;
has public  method DoRetrieveInput: Framework.DataValue;
has public  method Init;
has public  method Repetition(input aString: Framework.TextData,
	input TargetTemplate: Framework.TextData,
	input Number: Framework.IntegerData,
	input Code: Framework.TextData = NIL);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class BooleanFileStructureDesc inherits from FileDataAccessSrv.FileStructureDesc

has public  attribute FalseLabel: Framework.TextData;
has public  attribute TrueLabel: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DateFileStructureDesc inherits from FileDataAccessSrv.FileStructureDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class FileDataAccessExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class FileDataServiceDesc inherits from DataAccessSrvBD.ServiceDesc

has public  constant ERR_INCONSISTENT_SIGN_SETTINGS = 2;
has public  constant ERR_NEGATIVE_NUMERIC_DISALLOWED_HERE = 4;
has public  constant ERR_NONE = 0;
has public  constant ERR_STRING_TOO_LONG = 1;
has public  constant ERR_UNKNOWN_EXCEPTION = 3;

has public  attribute DefaultFillerCharacter: Framework.string;
has public  attribute File: Framework.File;
has public  attribute FileMap: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute Filename: Framework.TextData;
has public  attribute FlagAppend: Framework.boolean;
has public  attribute FlagRead: Framework.boolean;
has public  attribute FlagRewrite: Framework.boolean;
has public  attribute InstanceMinusSign: Framework.TextData;
has public  attribute InstancePlusSign: Framework.TextData;
has private attribute InstanceZeroValue: Framework.IntegerData;
has private attribute LastErrorCode: Framework.integer;
has public  attribute RecordLength: Framework.integer;
has private attribute ReferenceOutputData: Framework.TextData;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Append(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has public  method AppendAction_OBS(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object;
has private method CheckConsDataServiceDesc: Framework.boolean;
has public  method CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreAppendAction(input ObjectP: Framework.Object);
has public  method CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean;
has public  method CheckPreUpdateAction(input ObjectP: Framework.Object);
has public  method CloseFile;
has public  method CompleteString(input aFieldOutput: Framework.TextData,
	input aTemplate: FileDataAccessSrv.FileStructureDesc,
	input anIndex: Framework.integer,
	input RaiseStringTooLong: Framework.boolean);
has public  method DeleteFile;
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoStartService;
has public  method GetLastError: Framework.integer;
has public  method Init;
has public  method OpenFile;
has public  method PrepareBooleanFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData;
has public  method PrepareDataFormats: Framework.TextData;
has public  method PrepareDateFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData;
has public  method PrepareNumericFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData;
has public  method PrepareNumericFormat_OBS(input attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData;
has public  method PrepareTextFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData;
has public  method PutLine(input aTextData: Framework.TextData);
has public  method RaiseFileDataAccessExc(input Message: Framework.string);
has public  method Read(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;
has private method ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object;
has public  method SetupCompletionClause(input attr: FileDataAccessSrv.FileStructureDesc,
	input aTextData: Framework.TextData);
has public  method StartService;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class FileStructureDescExc inherits from FrameworkBD.DataExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class IntegerFileStructureDesc inherits from FileDataAccessSrv.FileStructureDesc

has public  attribute PosSign: Framework.integer;
has public  attribute Sign: Framework.integer;

has public  method Init;
has public  method IsLeftSigned: Framework.boolean;
has public  method IsRightSigned: Framework.boolean;
has public  method IsSigned: Framework.boolean;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LogFile inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeErreur: Framework.IntegerData;
has public  attribute LibelleErreur: Framework.TextData;
has public  attribute NumEnreg: Framework.IntegerData;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class NumericFileStructureDesc inherits from FileDataAccessSrv.IntegerFileStructureDesc

has public  attribute DecimalSeparator: Framework.boolean;
has public  attribute NbFrac: Framework.integer;
has public  attribute RoundingMethod: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TextFileStructureDesc inherits from FileDataAccessSrv.FileStructureDesc

has public  attribute CharacterCase: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method BooleanFileStructureDesc.Init
begin
super.Init();
FalseLabel = TextData (Value = DEFAULT_LABEL_FALSE);
TrueLabel  = TextData (Value = DEFAULT_LABEL_TRUE);
end method;

------------------------------------------------------------
method DateFileStructureDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method FileDataAccessExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method FileDataServiceDesc.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :  Routage des codes action standards et des codes actions spécifiques aux fichiers
--
--	Type :	Concret
--
--	Parametres :	aTransData : Communication structure..
--					aTransOrigin : ?
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucune
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FileDataService.Action');

-- Declarations
unResultat	: Object;
aStopWatch	: StopWatch;
aTimesplit	: Integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aStopWatch = new();
	Self.AddTimeWatch(aTransData.TransActionService);
	aStopWatch.Fire();
end if;

	Case aTransData.TransActionService is

		-- codes actions implémentant les actions standards
		-- du socle (avec la même sémantique)
		
		when ACT_STD_APPEND do
			unResultat=Append(aTransData);
			aTransData.TransActionService = ACT_STD_APPEND;

		when ACT_STD_READ do
			unResultat = Read(aTransData);
			aTransData.TransActionService = ACT_STD_READ;

		-- L'utilisation de ACT_STD_UPDATE ou ACT_STD_DELETE est interdite
		when ACT_STD_UPDATE do
			Exc : ImplementationExc = new();
			Exc.SetWithParams(SP_ER_ERROR, 'L''action ACT_STD_UPDATE n''existe pas sur un FileDataService');
			raise Exc;
/*
			unResultat=Update(aTransData);
			aTransData.TransActionService = ACT_STD_UPDATE;
*/

		when ACT_STD_DELETE do
			Exc : ImplementationExc = new();
			Exc.SetWithParams(SP_ER_ERROR, 'L''action ACT_STD_DELETE n''existe pas sur un FileDataService');
			raise Exc;
/*
			Delete(aTransData);
			aTransData.TransActionService = ACT_STD_DELETE;
*/
			
		
		-- codes actions spécifiques aux fichiers

		when ACT_FILE_INIT do
			OpenFile();
			aTransData.TransActionService = ACT_FILE_INIT;
						
		when ACT_FILE_TERMINATE do
			CloseFile();
			aTransData.TransActionService = ACT_FILE_TERMINATE;

		when ACT_FILE_DELETE do
			DeleteFile();
			aTransData.TransActionService = ACT_FILE_DELETE;
								
		else do 
			-- Traitements des autres cas au niveau concret.
			unResultat=DoAction(aTransData, aTransOrigin);
	end case;
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
--	SUPPRIME CAR PRIVATE
--	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 1, Level = 3) 
	AND (Self.AgentSvc <> NIL) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTransData.TransActionService, aTimeSplit);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FileDataService.Action : End');
Return unResultat;

Exception
	When e : GenericException do
		if (aStopWatch <> NIL) then
			aStopWatch.Split();
		end if;	
		Self.TraceExc(e, 'DataServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.Append(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Appends the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aObject :	Object to append.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--  D. NGUYEN   |   03/07/1997  |   Mise en forme.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagAppend.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Append');

-- Declarations
unResult : Object;
-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreAppend(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

unResult = Self.AppendAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Append : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'FileDataServiceDesc.Append');
		Raise;
 

end method;

------------------------------------------------------------
method FileDataServiceDesc.AppendAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Ecriture de données dans le fichier
--
--	Type :	Concret
--
--	Parametres :	aTransData  :	Les données à écrire 
--	(L'ObjectSelfDesc contenant des instances de FileStructureDesc en lieu et place du StructureDesc).
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FileDataServiceDesc.AppendAction');

-- aTransData.TransObject est l'ObjectSelfDesc concret (=il contient les données effectives) tandis que
-- FileMap lui ne contient que la description du fichier et les attributs conteneurs

-- Création de la chaîne résultat et remplissage 
-- avec le caractère de remplissage par défaut

OutputData : TextData = ReferenceOutputData.Clone(Deep=TRUE);

-- l'objet reçu est un CacheDesc

-- FileMap est utilisé en tant que modèle déjà préparé (les templates associés aux dataformats sont
-- correctement mis en forme). De plus, il ne doit pas y avoir de champs à NIL (Cela n'arrive normalement
-- pas avec les objets de type ObjectSelfDesc qui sont renseignés d'une manière séquentielle et sans remise
-- de référence à NIL.

RaiseStringTooLong  : boolean = TRUE;  -- Strict par défaut, pour ne pas laisser passer d'erreurs

InputData : ObjectSelfDesc = (CacheDesc) (aTransData.TransObject).Record;
InputData.DoResetSelfDesc();

ThisFieldOutput   : TextData;
ind       		  : integer = 1;
Templates         : array of StructureDesc = (array of StructureDesc) (FileMap.SelfDesc);
DataFormat        : DataFormat;

-- On itère sur les données, pas sur le modèle
-- Les données et le modèle doivent correspondrent en termes d'ordre

-- Le modèle est récupéré et exécuté à la demande
-- Amélioration : Stocker dans des tableaux différents les types de données identiques de
-- manière à diminuer le nombre de casts et d'appels de l'opérateur IsA

-- Penser à gérer les valeurs nulles;

-- Il serait possible d'appeler les méthodes d'écriture et de lecture des sous-classes de FileStructureDesc

unMessage		: TextData;
aNumericData	: NumericData;
aTextFormat		: TextFormat;
aDateFormat		: DateFormat;
Template		: FileStructureDesc;
IntTemplate		: IntegerFileStructureDesc;
BooTemplate		: BooleanFileStructureDesc;
TexTemplate		: TextFileStructureDesc;
Completion		: TextData = new();
aNumericFormat  : NumericFormat;
aTextValue		: TextData;
Rang 			: integer;

LastErrorCode   = ERR_NONE;

for aField in InputData.SelfDesc do

	begin
     	--	(DataValue) (FileMap.SelfDesc[ind].ItemReference).SetValue((DataValue) (aField.ItemReference));
    	--	utile ?
	
		Template = (FileStructureDesc) (Templates[ind]);
		Completion.SetValue(Template.CompletionCharacter);
		
		      	-- NumericFileStructureDesc hérite de IntegerFileStructureDesc
		if		Template.IsA(IntegerFileStructureDesc) then 
		
				IntTemplate = (IntegerFileStructureDesc) (Template);
			    aNumericFormat = (NumericFormat) (Template.DataFormat);
				aNumericData = (NumericData) (aField.ItemReference);
				ThisFieldOutput = aNumericFormat.FormatNumeric(aNumericData);
	
				case IntTemplate.Sign is 
	
				  when SIGN_ALWAYS do
						if   aNumericData.IsLessThan(InstanceZeroValue) then
	                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
						else -- Eq. IsGreaterThanOrEqual
							 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstancePlusSign);
						end if; 
	
				  when SIGN_ENABLE do
						if   aNumericData.IsLessThan(InstanceZeroValue) then
	                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
						else -- Eq. IsGreaterThanOrEqual
							 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=Completion);
						end if; 
	
				  when SIGN_DISABLE do
						if   aNumericData.IsLessThan(InstanceZeroValue) then
	                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
							 LastErrorCode = ERR_NEGATIVE_NUMERIC_DISALLOWED_HERE;
						else -- Eq. IsGreaterThanOrEqual
							 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=Completion);
						end if; 
				  	
				end case;
	
				RaiseStringTooLong = TRUE;
					
						   
		elseif	Template.IsA(BooleanFileStructureDesc) then
				
				BooTemplate = (BooleanFileStructureDesc) (Template);
			    aTextFormat : TextFormat = (TextFormat) (Template.DataFormat);
			    aBoolean    : BooleanData = (BooleanData) (aField.ItemReference);
				ThisFieldOutput = new();
			    if aBoolean.Value = TRUE 
				    then ThisFieldOutput.SetValue(BooTemplate.TrueLabel); 
				    else ThisFieldOutput.SetValue(BooTemplate.FalseLabel); 
			    end if;
				RaiseStringTooLong = TRUE;
	
		elseif	Template.IsA(TextFileStructureDesc) then
	
				TexTemplate = (TextFileStructureDesc) (Template);
				if TexTemplate.DataFormat = NIL then
					ThisFieldOutput  = (TextData) (aField.ItemReference);
					case TexTemplate.CharacterCase is 
					  when CHARACTER_CASE_ANY   do  
					  when CHARACTER_CASE_LOWER do ThisFieldOutput.ToLower();
					  when CHARACTER_CASE_UPPER do ThisFieldOutput.ToUpper();
					  else do
					  		Exc : FileDataAccessExc = new();
					  		Exc.SetWithParams(SP_ER_ERROR,'AppendAction.Mode de conversion de caractère incorrect');
					  		raise Exc;
					end case;
				else
					aTextFormat = (TextFormat) (TexTemplate.DataFormat);
					ThisFieldOutput = aTextFormat.FormatText(ThisFieldOutput);
				end if;
				RaiseStringTooLong = FALSE;  -- Le seul cas ou l'on puisse tronquer sans lever une exception !
	
		elseif	Template.IsA(DateFileStructureDesc) then
	
			    aDateFormat = (DateFormat) (Template.DataFormat);
			    ThisFieldOutput = aDateFormat.FormatDate((DateTimeData) (aField.ItemReference));
				RaiseStringTooLong = TRUE;
					
		end if;
	
		CompleteString(aFieldOutput 	= ThisFieldOutput, 
		 				 aTemplate 		= Template, 
		 				 anIndex 		= ind, 
		 	 RaiseStringTooLong			= RaiseStringTooLong);
		
		-- Incrustation du résultat dans la chaîne destination
		
		ThisFieldOutput.Offset = 0;
		Len   : integer = ThisFieldOutput.LengthToEnd();
		Delta : integer = Template.Length - Len;
		
		if ThisFieldOutput.LengthToEnd() <> Template.Length then
		   UnMessage = new(); -- comment stocker les informations de contexte d'erreurs (pile ?)
		   UnMessage.ReplaceParameters('Erreur de taille : Taille attendue : %1, Taille réelle : %2, Delta : %3, Rang=%4',
		   							   Parameter1 = IntegerData(Value=Template.Length),
		   							   Parameter2 = IntegerData(Value=Len),
		   							   Parameter3 = IntegerData(Value=Delta),
		   							   Parameter4 = IntegerData(Value=Ind));
		   Task.Part.LogMgr.PutLine(UnMessage.Value);
		end if;
		
		OutputData.ReplaceRange(ThisFieldOutput.Value, Template.StartIndex-1, Template.StartIndex+Template.Length-1);
		ind = ind + 1; -- passer au suivant, uniquement pour garder un pointeur sur le template suivant
	exception

		when e : GenericException do

		 LastErrorCode = ERR_UNKNOWN_EXCEPTION;
		 Msg : TextData = new(Value = '#%1  Err:%2  Val:%3');
		 Msg.ReplaceParameters(Msg, IntegerData(Value=ind), e.Message); --, (DataValue) (aField.ItemReference));
		 Task.Part.LogMgr.Put(Msg.Value);

	end;

end for;


OutputData.Offset = 0;
Task.Part.LogMgr.PutLine(OutputData.LengthToEnd());
PutLine(OutputData);

-- On ne peut lever l'exception qu'une fois la chaîne correctement écrite dans le fichier !
if LastErrorCode <> ERR_NONE then

   unMessage = new();
   unMessage.ReplaceParameters('Erreur %1 sur le champs de rang %2. Chaîne : %3',
   								Parameter1=IntegerData(Value=LastErrorCode), 
   								Parameter2=IntegerData(Value=ind),
   								Parameter3=ThisFieldOutput);
   RaiseFileDataAccessExc(unMessage.Value);

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FileDataServiceDesc.AppendAction : End');

return OutputData;

end method;

------------------------------------------------------------
method FileDataServiceDesc.AppendAction_OBS(input aTransData: DataAccessSrvBD.TransDesc): Framework.Object
begin
--
--	Description : 	Ecriture de données dans le fichier
--
--	Type :	Concret
--
--	Parametres :	aTransData  :	Les données à écrire 
--	(L'ObjectSelfDesc contenant des instances de FileStructureDesc en lieu et place du StructureDesc).
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FileDataServiceDesc.AppendAction');

-- aTransData.TransObject est l'ObjectSelfDesc concret (=il contient les données effectives) tandis que
-- FileMap lui ne contient que la description du fichier et les attributs conteneurs

-- Création de la chaîne résultat et remplissage 
-- avec le caractère de remplissage par défaut

OutputData : TextData = ReferenceOutputData.Clone(Deep=TRUE);

-- l'objet reçu est un CacheDesc

-- FileMap est utilisé en tant que modèle déjà préparé (les templates associés aux dataformats sont
-- correctement mis en forme). De plus, il ne doit pas y avoir de champs à NIL (Cela n'arrive normalement
-- pas avec les objets de type ObjectSelfDesc qui sont renseignés d'une manière séquentielle et sans remise
-- de référence à NIL.

RaiseStringTooLong  : boolean = TRUE;  -- Strict par défaut, pour ne pas laisser passer d'erreurs

InputData : ObjectSelfDesc = (CacheDesc) (aTransData.TransObject).Record;
InputData.DoResetSelfDesc();

ThisFieldOutput   : TextData;
ind       		  : integer = 1;
Templates         : array of StructureDesc = (array of StructureDesc) (FileMap.SelfDesc);
DataFormat        : DataFormat;

-- On itère sur les données, pas sur le modèle
-- Les données et le modèle doivent correspondrent en termes d'ordre

-- Le modèle est récupéré et exécuté à la demande
-- Amélioration : Stocker dans des tableaux différents les types de données identiques de
-- manière à diminuer le nombre de casts et d'appels de l'opérateur IsA

-- Penser à gérer les valeurs nulles;

-- Il serait possible d'appeler les méthodes d'écriture et de lecture des sous-classes de FileStructureDesc

unMessage		: TextData;
aNumericData	: NumericData;
aTextFormat		: TextFormat;
aDateFormat		: DateFormat;
Template		: FileStructureDesc;
IntTemplate		: IntegerFileStructureDesc;
BooTemplate		: BooleanFileStructureDesc;
TexTemplate		: TextFileStructureDesc;
Completion		: TextData = new();
aTextValue		: TextData;

LastErrorCode   = ERR_NONE;

for aField in InputData.SelfDesc do

--	(DataValue) (FileMap.SelfDesc[ind].ItemReference).SetValue((DataValue) (aField.ItemReference));
--	utile ?

	Template = (FileStructureDesc) (Templates[ind]);
	Completion.SetValue(Template.CompletionCharacter);
	
	      	-- NumericFileStructureDesc hérite de IntegerFileStructureDesc
	if		Template.IsA(IntegerFileStructureDesc) then 
	
			IntTemplate = (IntegerFileStructureDesc) (Template);
		    aTextFormat = (TextFormat) (Template.DataFormat);
			aNumericData = (NumericData) (aField.ItemReference);
			aTextValue = aNumericData.TextValue;
		    ThisFieldOutput = aTextFormat.FormatText(aTextValue);

			case IntTemplate.Sign is 

			  when SIGN_ALWAYS do
					if   aNumericData.IsLessThan(InstanceZeroValue) then
                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
					else -- Eq. IsGreaterThanOrEqual
						 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstancePlusSign);
					end if; 

			  when SIGN_ENABLE do
					if   aNumericData.IsLessThan(InstanceZeroValue) then
                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
					else -- Eq. IsGreaterThanOrEqual
						 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=Completion);
					end if; 

			  when SIGN_DISABLE do
					if   aNumericData.IsLessThan(InstanceZeroValue) then
                         ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=InstanceMinusSign);
						 LastErrorCode = ERR_NEGATIVE_NUMERIC_DISALLOWED_HERE;
					else -- Eq. IsGreaterThanOrEqual
						 ThisFieldOutput.ReplaceParameters(ThisFieldOutput, Parameter1=Completion);
					end if; 
			  	
			end case;

			RaiseStringTooLong = TRUE;
						   
	elseif	Template.IsA(BooleanFileStructureDesc) then
			
			BooTemplate = (BooleanFileStructureDesc) (Template);
		    aTextFormat : TextFormat = (TextFormat) (Template.DataFormat);
		    aBoolean    : BooleanData = (BooleanData) (aField.ItemReference);
			ThisFieldOutput = new();
		    if aBoolean.Value = TRUE 
			    then ThisFieldOutput.SetValue(BooTemplate.TrueLabel); 
			    else ThisFieldOutput.SetValue(BooTemplate.FalseLabel); 
		    end if;
			RaiseStringTooLong = TRUE;

	elseif	Template.IsA(TextFileStructureDesc) then

			TexTemplate = (TextFileStructureDesc) (Template);
			if TexTemplate.DataFormat = NIL then
				ThisFieldOutput  = (TextData) (aField.ItemReference);
				case TexTemplate.CharacterCase is 
				  when CHARACTER_CASE_ANY do 
				  when CHARACTER_CASE_LOWER do ThisFieldOutput.ToLower();
				  when CHARACTER_CASE_UPPER do ThisFieldOutput.ToUpper();
				  else do
				  		Exc : FileDataAccessExc = new();
				  		Exc.SetWithParams(SP_ER_ERROR,'AppendAction.Mode de conversion de caractère incorrect');
				  		raise Exc;
				end case;
			else
				aTextFormat = (TextFormat) (TexTemplate.DataFormat);
				ThisFieldOutput = aTextFormat.FormatText(ThisFieldOutput);
			end if;
			RaiseStringTooLong = FALSE;  -- Le seul cas ou l'on puisse tronquer sans lever une exception !

	elseif	Template.IsA(DateFileStructureDesc) then

		    aDateFormat = (DateFormat) (Template.DataFormat);
		    ThisFieldOutput = aDateFormat.FormatDate((DateTimeData) (aField.ItemReference));
			RaiseStringTooLong = TRUE;
				
	end if;

	CompleteString(aFieldOutput 	= ThisFieldOutput, 
	 				 aTemplate 		= Template, 
	 				 anIndex 		= ind, 
	 	 RaiseStringTooLong			= RaiseStringTooLong);
	
	-- Incrustation du résultat dans la chaîne destination
	
	ThisFieldOutput.Offset = 0;
	Len   : integer = ThisFieldOutput.LengthToEnd();
	Delta : integer = Template.Length - Len;
	
	if ThisFieldOutput.LengthToEnd() <> Template.Length then
	   UnMessage = new(); -- comment stocker les informations de contexte d'erreurs (pile ?)
	   UnMessage.ReplaceParameters('Erreur de taille : Taille attendue : %1, Taille réelle : %2, Delta : %3, Rang=%4',
	   							   Parameter1 = IntegerData(Value=Template.Length),
	   							   Parameter2 = IntegerData(Value=Len),
	   							   Parameter3 = IntegerData(Value=Delta),
	   							   Parameter4 = IntegerData(Value=Ind));
	   Task.Part.LogMgr.PutLine(UnMessage.Value);
	end if;
	
	OutputData.ReplaceRange(ThisFieldOutput.Value, Template.StartIndex-1, Template.StartIndex+Template.Length-1);
	ind = ind + 1; -- passer au suivant, uniquement pour garder un pointeur sur le template suivant

end for;


OutputData.Offset = 0;
Task.Part.LogMgr.PutLine(OutputData.LengthToEnd());
PutLine(OutputData);

-- On ne peut lever l'exception qu'une fois la chaîne correctement écrite dans le fichier !
if LastErrorCode <> ERR_NONE then

   unMessage = new();
   unMessage.ReplaceParameters('Erreur %1 sur le champs de rang %2. Chaîne : %3',
   								Parameter1=IntegerData(Value=LastErrorCode), 
   								Parameter2=IntegerData(Value=ind),
   								Parameter3=ThisFieldOutput);
   RaiseFileDataAccessExc(unMessage.Value);

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FileDataServiceDesc.AppendAction : End');

return OutputData;

end method;

------------------------------------------------------------
method FileDataServiceDesc.CheckConsDataServiceDesc: Framework.boolean
begin
--
--	Description : 	Checks the state of the object.
--
--	Type :	Abstrait
--
--	Parametres :	RETURN	--> TRUE :	OK
--								FALSE:	KO
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckConsDataServiceDesc');

-- Declarations
unResult : Boolean = TRUE;

-- Si les pre-conditions ne sont pas vérifiées, on envoit une exception correspondante

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckConsDataServiceDesc : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckConsDataServiceDesc');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.CheckPreAppend(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Append.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	Instance à créer
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreAppend');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagAppend then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreAppend --> Action Append déclenchée alors que FlagAppend = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreAppend : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreAppend');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.CheckPreAppendAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.AppendAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method FileDataServiceDesc.CheckPreRead(input pTransData: DataAccessSrvBD.TransDesc): Framework.boolean
begin
--
--	Description : 	Test des pré-conditions de l'Read.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pTransData :	paramêtres de lecture
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	24/12/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.CheckPreRead');

-- Declarations
unResult : Boolean = TRUE;

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante
if not Self.FlagRead then -- Incohérence de déclaration du service par rapport à l'action demandée 
	unExc : ImplementationExc = new();
	unExc.severity = SP_ER_USER;
	unExc.Message = 'DataServiceDesc.CheckPreRead --> Action Read déclenchée alors que FlagRead = FALSE';
	raise unExc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.CheckPreRead : End');

Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.CheckPreRead');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.CheckPreUpdateAction(input ObjectP: Framework.Object)
begin
if ObjectP = NIL then
	exc : ImplementationExc = new;
	exc.severity = SP_ER_USER;
	exc.Message = 'DataServiceSqlDesc.UpdateAction--> unexpected Parameter aObject = NIL';
	raise exc;
end if; 

end method;

------------------------------------------------------------
method FileDataServiceDesc.CloseFile
begin
File.Close();
File = NIL; -- indicateur de présence d'un fichier hébergé par l'objet File
end method;

------------------------------------------------------------
method FileDataServiceDesc.CompleteString(input aFieldOutput: Framework.TextData,
	input aTemplate: FileDataAccessSrv.FileStructureDesc,
	input anIndex: Framework.integer,
	input RaiseStringTooLong: Framework.boolean)
begin
aFieldOutput.Offset = 0;  -- LengthToEnd() utilise l'offset pour initialiser le calcul
Delta : integer = aTemplate.Length - aFieldOutput.LengthToEnd(); -- différences en nombre de caractères

if     Delta  > 0  then -- pas assez de caractères 

		   if aTemplate.CompletionCharacter = '0' and aTemplate.IsA(IntegerFileStructureDesc) -- IntegerFileStructureDesc inclus dans NumericFileStructureDesc
		   then 
		       -- le caractère de complétion est zéro et c'est un entier ou un réel, donc traitement particulier
			   case aTemplate.Justification is 
	
			     when JUSTIFY_RIGHT do 
				   Tmp : TextData = new();
			       for cnt in 1 to Delta do 
			       	   Tmp.Concat(aTemplate.CompletionCharacter);
			       end for;
			       Tmp.Concat(aFieldOutput);
			       aFieldOutput.SetValue(tmp); -- Mettre aFieldOutput en Input / Output ? Effets de bords ?
	
			     when JUSTIFY_LEFT do
			       for cnt in 1 to Delta do 
				       aFieldOutput.Concat(aTemplate.CompletionCharacter);
				   end for;
	
			   end case;
			   	
		   else
			   -- Cas général, autre que caractère de complétion est zéro
			   case aTemplate.Justification is 
	
			     when JUSTIFY_RIGHT do 
				   Tmp : TextData = new();
			       for cnt in 1 to Delta do 
			       	   Tmp.Concat(aTemplate.CompletionCharacter);
			       end for;
			       Tmp.Concat(aFieldOutput);
			       aFieldOutput.SetValue(tmp); -- Mettre aFieldOutput en Input / Output ? Effets de bords ?
	
			     when JUSTIFY_LEFT do
			       for cnt in 1 to Delta do 
				       aFieldOutput.Concat(aTemplate.CompletionCharacter);
				   end for;
	
			   end case;
		   end if; 

elseif Delta < 0 then -- La chaîne est trop longue, on ne s'énerve pas, on renvoie un code d'erreur ssi
					  -- ce n'est pas du texte
	
	if aTemplate.IsA(TextFileStructureDesc) then
		aFieldOutput.Offset = aTemplate.Length;
		aFieldOutput.Truncate();
	else
		if RaiseStringTooLong = TRUE then
		   LastErrorCode = ERR_STRING_TOO_LONG;
		end if;
	end if;

end if;
	
end method;

------------------------------------------------------------
method FileDataServiceDesc.DeleteFile
begin
File.Remove();
File = NIL;

end method;

------------------------------------------------------------
method FileDataServiceDesc.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standard". Un transdataDesc est transmis.
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  PMT		  | 30/06/1998  |   Redéfinition de la méthode 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.DoAction');

-- Declarations
unExc : ImplementationExc;

Task.Part.LogMgr.PutLine('!!!!!!!!!!!!!!!!! Passage dans FileDataServiceDesc.DoAction !!!!!!!!!!!!!!!!!!!!!');
-- Traitement
unExc = New();
unExc.Message.Concat('DataServiceDesc.DoAction');
Raise unExc;
-- Fin du traitement

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.DoStartService
begin
-- méthode appelée par StartService et dont le but est de 
-- laisser un point d'entrée pour l'utilisateur


end method;

------------------------------------------------------------
method FileDataServiceDesc.GetLastError: Framework.integer
begin
return LastErrorCode;
end method;

------------------------------------------------------------
method FileDataServiceDesc.Init
begin
super.Init();

InstanceZeroValue = new(IntegerValue=0);

-- On ne doit pas pouvoir supprimer ou mettre à jour des
-- éléments du fichier
-- (Pas vraiment de sens dans un fichier en format fixe)


-- ne pas surcharger les méthodes DeleteAction et AppendAction,
-- car l'implémentation socle se charge déjà de lever une exception

FlagRewrite = TRUE; -- Par défaut, on réécrit complètement le fichier
File = NIL;			-- pour ne pas lancer une exception à l'initialisation
Filename = new();

InstancePlusSign = new(Value='+');
InstanceMinusSign = new(Value='-');
InstanceZeroValue = new(IntegerValue=0);
end method;

------------------------------------------------------------
method FileDataServiceDesc.OpenFile
begin
-- Détermination du mode d'ouverture du fichier en fonction
-- des flag 'read' et 'append'

Erreur : integer = 0; -- code d'erreur éventuellement renvoyé par Open en cas d'exception
Mode   : integer = 0; -- Mode d'ouverture du fichier 

-- calcul du mode d'ouverture du fichier
if FlagRead = TRUE and FlagAppend = TRUE then
   Mode = SP_AM_READ_WRITE;			-- le fichier ne sera accessible qu'en écriture

elseif FlagRead = TRUE then			-- le fichier ne sera accessible qu'en lecture 
   Mode = SP_AM_READ;

elseif FlagAppend = TRUE then		-- mode réécriture, à affiner entre Rewrite et Append

   if  FlagRewrite = TRUE then
       Mode = SP_AM_WRITE;			-- on réécrit le fichier depuis la position de début (=0)
   else
   	   Mode = SP_AM_APPEND;			-- on ajoute les données en fin de fichier
   end if;
   
end if;

if File <> NIL then -- un fichier est déjà géré par ce FileDataService
 
   Exc : FileDataAccessExc = new();
   Exc.SetWithParams(SP_ER_ERROR, 'Cet objet FileDataService héberge déjà un fichier ouvert ! Il faut le refermer !');
   raise Exc;
   
end if;

File = new();
File.SetLocalName(FileName);


begin
	File.Open(Mode,IsBinary=FALSE);	 -- une exception peut se produire (FileResourceException), on la laisse partir
									 -- L'application utilisateur doit savoir la gérer !!!			
exception
  when e : FileResourceException do
	File = NIL;						 -- Repositionner l'instance à NIL
	raise; 
end;
end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareBooleanFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData
begin
Template : TextData = new();
if Attr.CustomFormat <> NIL then
   Template.SetValue(Attr.CustomFormat.Value);
end if;
Attr.DataFormat = TextFormat();
Attr.DataFormat.Template = Template;
return Template;

end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareDataFormats: Framework.TextData
begin
-- on est obligé de caster le FileMap de 'array of StructureDesc' en 'array of FileStructureDesc'
-- pour pouvoir accéder à la propriété DataFormat de cette classe

Template : TextData;
lesAttributs : array of StructureDesc = FileMap.SelfDesc;

FullTemplate : TextData = new();

for attr in lesAttributs do
	
	-- préparation spécifique à chaque type de DataValue
	if 		attr.IsA(IntegerFileStructureDesc) or 
			attr.IsA(NumericFileStructureDesc) 	then Template = PrepareNumericFormat((FileStructureDesc) (attr));
	elseif	attr.IsA(TextFileStructureDesc)     then Template = PrepareTextFormat((FileStructureDesc) (attr));
	elseif	attr.IsA(BooleanFileStructureDesc)  then Template = PrepareBooleanFormat((FileStructureDesc) (attr));
	elseif	attr.IsA(DateFileStructureDesc)     then Template = PrepareDateFormat((FileStructureDesc) (attr));
	end if;
	
	FullTemplate.Concat(Template);
	FullTemplate.Concat('|');
	
end for;

return FullTemplate;
end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareDateFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData
begin
Template : TextData = new(Value='dd-nnn-yy');
if Attr.CustomFormat<>NIL then
   Template.SetValue(Attr.CustomFormat.Value);
end if;
Attr.DataFormat = DateFormat();
Attr.DataFormat.Template = Template;
return Template;
end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareNumericFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData
begin
Template : TextData = new();
--SetupCompletionClause(Attr,Template);

IntAttr 	  : IntegerFileStructureDesc = (IntegerFileStructureDesc) (Attr);
Signed		  : boolean = ((IntAttr.Sign = SIGN_ENABLE) or (IntAttr.Sign = SIGN_ALWAYS));
LeftMostSign  : boolean = (Signed = TRUE and (IntAttr.PosSign = SIGN_POS_LEFTMOST));
RightMostSign : boolean = (Signed = TRUE and (IntAttr.PosSign = SIGN_POS_RIGHTMOST));

-- Pour régler en partie le problème du caractère de complétion à zéro,
-- L'émission de la zone est forcément en JUSTIFY_RIGHT car 
-- sinon la valeur numérique change de valeur !

if IntAttr.CompletionCharacter='0' 
then IntAttr.Justification = JUSTIFY_RIGHT;
end if;

Formatter     : TextData = new(Value='+%1,-%1;');

PlaceHolder   : TextData = new();
if Attr.IsA(IntegerFileStructureDesc) 
then PlaceHolder.Concat('#',attr.Length);
elseif Attr.IsA(NumericFileStructureDesc) 
then
	 NumAttr : NumericFileStructureDesc = (NumericFileStructureDesc) (Attr);
	 NbLeft : integer = attr.Length-NumAttr.NbFrac;
	 if NumAttr.IsSigned() = TRUE
	 then 
	 	  NbLeft = NbLeft - 1;
	 	  for cnt in 1 to NbLeft do 
	 	      PlaceHolder.Concat('#');
	 	  end for;
	 	  PlaceHolder.Concat('.');
	 else 
	 	  for cnt in 1 to NbLeft do
	          PlaceHolder.Concat('#');
	      end for;
	 end if;
	 for cnt in 1 to NumAttr.NbFrac do
	     PlaceHolder.Concat('#');
	 end for;
end if;

if     LeftMostSign = TRUE then
	   Template.ReplaceParameters('+%1;-%1;0;;',PlaceHolder);
elseif RightMostSign = TRUE then
	   Template.ReplaceParameters('%1+;%1-;0;;',PlaceHolder);
else
	   Template.ReplaceParameters('%1;%1;0;;',PlaceHolder);
end if;
			
attr.DataFormat = NumericFormat();
attr.DataFormat.Template = Template;

return Template;

end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareNumericFormat_OBS(input attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData
begin
Template : TextData = new();
if Attr.CustomFormat<>NIL then
   Template.SetValue(Attr.CustomFormat.Value);
end if;

IntAttr 	  : IntegerFileStructureDesc = (IntegerFileStructureDesc) (Attr);

NbLeft		  : integer;
NbRight		  : integer;

if Attr.IsA(IntegerFileStructureDesc) -- on s'assure que l'on dispose bien d'un IntegerFileStructureDesc
then 
	NbRight = 0;
	NbLeft = Attr.Length;
	if IntAttr.IsSigned () = TRUE then
         NbLeft = NbLeft - 1; 
	end if;
	
	-- si c'est en plus un Numérique, alors traiter la partie fractionnaire
	if Attr.IsA(NumericFileStructureDesc) 
	then
		 NumAttr : NumericFileStructureDesc = (NumericFileStructureDesc) (Attr);
		 NbLeft = NbLeft - NumAttr.NbFrac;
		 NbRight = NumAttr.NbFrac;
	end if;
	
	for cnt in 1 to NbLeft do -- Création de la partie à gauche
	    Template.Concat('#');
	end for;

	if NbRight > 0 then		  -- Création de la partie à droite si elle existe
	    Template.Concat('.');
	    for cnt in 1 to NbRight do
		    Template.Concat('#');
	    end for;
	end if;
	
	-- Traitement du signe
	if IntAttr.IsSigned() = TRUE then
	   if 	  IntAttr.IsLeftSigned() = TRUE then
	   		  Template.ReplaceRange('%1',0,0);
	   elseif IntAttr.IsRightSigned() = TRUE then
	   		  Template.Concat('%1');
	   end if;
	end if;
end if;

--SetupCompletionClause(Attr,Template);
attr.DataFormat = TextFormat();
attr.DataFormat.Template = Template;

return Template;
end method;

------------------------------------------------------------
method FileDataServiceDesc.PrepareTextFormat(input Attr: FileDataAccessSrv.FileStructureDesc): Framework.TextData
begin
Template : TextData;
if Attr.CustomFormat<>NIL then
   Template = new();
   Template.SetValue(Attr.CustomFormat);
end if;
return Template; -- Pas de template pour les champs de type texte
end method;

------------------------------------------------------------
method FileDataServiceDesc.PutLine(input aTextData: Framework.TextData)
begin
File.WriteLine(aTextData);
end method;

------------------------------------------------------------
method FileDataServiceDesc.RaiseFileDataAccessExc(input Message: Framework.string)
begin
Exc : FileDataAccessExc = new();
Exc.SetWithParams(SP_ER_ERROR,Message);
raise Exc;
end method;

------------------------------------------------------------
method FileDataServiceDesc.Read(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Read the object transmitted.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Return	--> aObject :	Object to read.
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceDesc
--
--	Historique :
--
--	D. NGUYEN	|	11/06/1997	|	Creation.
--	D. NGUYEN	|	25/10/1996	|	Including optimized cache.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--	D. NGUYEN	|	24/12/1997	|	Ajout du FlagRead.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataServiceDesc.Read');

-- Declarations

aObject : Object = aTransData;

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreRead(aTransData);
End if;
-- Fin de verification des pre-conditions

-- Traitement

aResult : Array of Object = ReadAction(aTransData);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 12) then
	Self.CheckConsDataServiceDesc();
End if;
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataServiceDesc.Read : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DataServiceDesc.Read');
		Raise;
end method;

------------------------------------------------------------
method FileDataServiceDesc.ReadAction(input aTransData: DataAccessSrvBD.TransDesc): Framework.Array of Framework.Object
begin
--
--	Description : 	Lecture des données à partir Ecriture de données dans le fichier
--
--	Type :	Concret
--
--	Parametres :	aTransData  :	Les données à écrire 
--	(L'ObjectSelfDesc contenant des instances de FileStructureDesc en lieu et place du StructureDesc).
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FileDataService.ReadAction');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FileDataService.ReadAction : End');

return NIL;

end method;

------------------------------------------------------------
method FileDataServiceDesc.SetupCompletionClause(input attr: FileDataAccessSrv.FileStructureDesc,
	input aTextData: Framework.TextData)
begin
-- Mise en place du codage du caractère de complétion
Tmp : TextData = new(Value='<');
Tmp.Concat(attr.CompletionCharacter);
Tmp.Concat('!>');
aTextData.ReplaceRange(Tmp,0,0); -- Cool feature
end method;

------------------------------------------------------------
method FileDataServiceDesc.StartService
begin
-- préparation des chaînes de formatages

FullTemplate : TextData = PrepareDataFormats();  -- Préparation des formats de codage/décodage pour tous les attributs de l'objetSelfDesc
Task.Part.LogMgr.PutLine(FullTemplate.Value);

-- Préparation de la chaîne de référence
ReferenceOutputData = new();
for aloop in 1 to RecordLength do
  ReferenceOutputData.Concat(DefaultFillerCharacter, RecordLength);
end for;

DoStartService();      -- point d'entrée utilisateur
end method;

------------------------------------------------------------
method FileStructureDesc.CompleteString(input aResultString: Framework.TextData)
begin
KeepOffset : integer = aResultString.Offset;  -- faut t'il conserver l'offset ???
aResultString.Offset = 0;
LengthDelta : integer = Length - aResultString.LengthToEnd();
aResultString.Offset = KeepOffset;

aRes : TextData;

if LengthDelta < 0 then

   Exc : FileStructureDescExc = new();
   Exc.SetWithParams(SP_ER_ERROR,'La chaîne résultat est trop longue');
   raise Exc;
   
elseif LengthDelta > 0 then

   FillerString: TextData = new();
   FillerString.Concat(Source=CompletionCharacter, n=LengthDelta);
   case Justification is 
   
   	 when JUSTIFY_LEFT do
   	 
   	 	  aResultString.Concat(FillerString);
   	 	  
   	 when JUSTIFY_RIGHT do

		   aRes = new(Value = FillerString.Value);
		   aRes.Concat(aResultString);
		   aResultString.SetValue(aRes);
		   
   	 else 
		   Exc : FileStructureDescExc = new();
		   Exc.SetWithParams(SP_ER_ERROR,'Le mode de justification est incorrect');
		   raise Exc;
   end case;
   
end if;

end method;

------------------------------------------------------------
method FileStructureDesc.DoFormatOutput(input aField: FileDataAccessSrv.FileStructureDesc,
	input RaiseStringTooLong: Framework.boolean): Framework.TextData
begin
Exc : FileStructureDescExc = new();
Exc.SetWithParams(SP_ER_ERROR, 'Il faut surcharger la méthode DoFormatOutput');
raise Exc;

end method;

------------------------------------------------------------
method FileStructureDesc.DoRetrieveInput: Framework.DataValue
begin
Exc : FileStructureDescExc = new();
Exc.SetWithParams(SP_ER_ERROR, 'Il faut surcharger la méthode DoRetrieveInput');
raise Exc;

end method;

------------------------------------------------------------
method FileStructureDesc.Init
begin
super.Init();

-- Valeurs par défaut
CompletionCharacter = DEFAULT_COMPLETION_CHARACTER;
StartIndex = 1;
Justification = JUSTIFY_LEFT;
DataFormat = NIL;
Length = 1;
end method;

------------------------------------------------------------
method FileStructureDesc.Repetition(input aString: Framework.TextData,
	input TargetTemplate: Framework.TextData,
	input Number: Framework.IntegerData,
	input Code: Framework.TextData = NIL)
begin
TargetTemplate.Concat('(');
TargetTemplate.Concat(Number.TextValue);
TargetTemplate.Concat(')');
if Code <> NIL and not Code.IsEqual('') then
   TargetTemplate.Concat(Code);
end if;

end method;

------------------------------------------------------------
method FileStructureDescExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method IntegerFileStructureDesc.Init
begin
super.Init();
-- initialisation des valeurs par défaut
Sign    = SIGN_ENABLE;
PosSign = SIGN_POS_LEFTMOST;

end method;

------------------------------------------------------------
method IntegerFileStructureDesc.IsLeftSigned: Framework.boolean
begin
return IsSigned() = TRUE and PosSign = SIGN_POS_LEFTMOST;
end method;

------------------------------------------------------------
method IntegerFileStructureDesc.IsRightSigned: Framework.boolean
begin
return IsSigned() = TRUE and PosSign = SIGN_POS_RIGHTMOST;
end method;

------------------------------------------------------------
method IntegerFileStructureDesc.IsSigned: Framework.boolean
begin
return (Sign = SIGN_ALWAYS or Sign = SIGN_ENABLE); -- <> SIGN_DISABLE risqué à cause des valeurs entières possibles
end method;

------------------------------------------------------------
method LogFile.DoResetAttributes
begin
--
--	Description : 	Instanciates the attributes of the structure.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ObjectSelfDesc
--
--	Historique :
--
--	PMT		|	01/07/1998	|	Creation.
--+

CodeErreur = new();
LibelleErreur = new();
NumEnreg = new();
end method;

------------------------------------------------------------
method LogFile.DoResetSelfDesc
begin
e : ImplementationExc = new;
e.Message.concat('ObjectSelfDesc.DoResetSelfDesc');
Raise e;

end method;

------------------------------------------------------------
method LogFile.DoResetService
begin

end method;

------------------------------------------------------------
method LogFile.Init
begin
super.Init();
end method;

------------------------------------------------------------
method NumericFileStructureDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TextFileStructureDesc.Init
begin
super.Init();
CharacterCase = CHARACTER_CASE_ANY;
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'filedata';


end FileDataAccessSrv;
begin TOOL ParserErrors;

includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ErreurCaractereInterdit;
forward  ErreurCompilateur;
forward  ErreurDelimiteurChaine;
forward  ErreurElementNonTrouve;
forward  ErreurFormatIdentificateurIncorrect;
forward  ErreurFormatSymIncorrect;
forward  ErreurInconnue;
forward  ErreurMotReserveAttendu;
forward  ErreurOperateurInconnu;
forward  ErreurPreProcesseur;
forward  ErreurSigneInterdit;
forward  ErreurSymCirculaire;
forward  ErreurSymNonTrouve;
forward  ErreurTokFinPre;
forward  ErreurType;
forward  ErreurTypeInexistant;
forward  ErreurValeurBooleenne;
forward  ErreurValeurChaine;
forward  ErreurValeurEntiere;
forward  ErreurValeurGenerique;
forward  ErreurValeurReelle;
forward  ErreurValeurTypeInconnu;
forward  ErreurVariableInconnue;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ERR_CARACTERE_INTERDIT = 14;
constant ERR_DELIMITEUR_CHAINE = 8;
constant ERR_ELEMENT_NON_TROUVE = 1;
constant ERR_FORMAT_IDENTIFICATEUR_INCORRECT = 5;
constant ERR_FORMAT_SYM_INCORRECT = 16;
constant ERR_INCONNUE = 18;
constant ERR_MOT_RESERVE_ATTENDU = 3;
constant ERR_OPERATEUR_INCONNU = 9;
constant ERR_SIGNE_INTERDIT = 6;
constant ERR_SYM_CIRCULAIRE = 19;
constant ERR_SYM_NON_TROUVE = 17;
constant ERR_TOK_FINPRE = 21;
constant ERR_TYPE = 15;
constant ERR_TYPE_INEXISTANT = 4;
constant ERR_VALEUR_BOOLEENNE = 13;
constant ERR_VALEUR_CHAINE = 12;
constant ERR_VALEUR_ENTIERE = 7;
constant ERR_VALEUR_GENERIQUE = 20;
constant ERR_VALEUR_REELLE = 10;
constant ERR_VALEUR_TYPE_INCONNU = 11;
constant ERR_VARIABLE_INCONNUE = 2;
constant LOG_GRPFLAG = 63;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ErreurCompilateur inherits from Framework.GenericException

has private attribute Item: Framework.TextData;

has public  method GetItem: Framework.TextData;
has public  method Init;
has public  method SetWithItem(input unItem: Framework.TextData);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurCaractereInterdit inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurDelimiteurChaine inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurElementNonTrouve inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurFormatIdentificateurIncorrect inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurPreProcesseur inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurFormatSymIncorrect inherits from ParserErrors.ErreurPreProcesseur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurInconnue inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurMotReserveAttendu inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurOperateurInconnu inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurSigneInterdit inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurSymCirculaire inherits from ParserErrors.ErreurPreProcesseur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurSymNonTrouve inherits from ParserErrors.ErreurPreProcesseur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurTokFinPre inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurType inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurTypeInexistant inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurBooleenne inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurChaine inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurEntiere inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurGenerique inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurReelle inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurValeurTypeInconnu inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ErreurVariableInconnue inherits from ParserErrors.ErreurCompilateur

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ErreurCaractereInterdit.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurCompilateur.GetItem: Framework.TextData
begin
--
--	Description : Renvoie de l'élément ayant provoqué l'erreur
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	26/02/1998	|	Creation.
--+

return Item;
end method;

------------------------------------------------------------
method ErreurCompilateur.Init
begin
super.Init();
Item = new();
end method;

------------------------------------------------------------
method ErreurCompilateur.SetWithItem(input unItem: Framework.TextData)
begin
--
--	Description : Initialisation de l'élément ayant provoqué l'erreur
--
--	Type :	concret
--
--	Parametres :   unItem : Libellé de l'élément
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	26/02/1998	|	Creation.
--+

Item = unItem;
end method;

------------------------------------------------------------
method ErreurDelimiteurChaine.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurElementNonTrouve.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurFormatIdentificateurIncorrect.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurFormatSymIncorrect.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurInconnue.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurMotReserveAttendu.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurOperateurInconnu.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurPreProcesseur.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurSigneInterdit.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurSymCirculaire.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurSymNonTrouve.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurTokFinPre.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurType.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurTypeInexistant.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurBooleenne.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurChaine.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurEntiere.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurGenerique.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurReelle.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurValeurTypeInconnu.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ErreurVariableInconnue.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'parserer';


end ParserErrors;
begin TOOL ParserClasses;

includes DataStructuresClasses;
includes FrameworkBD;
includes ParserErrors;
includes GenericDBMS;
includes DisplayProject;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  DataTypeDesc;
forward  ElementDesc;
forward  InternalExc;
forward  KeywordDesc;
forward  Parser;
forward  Token;
forward  TokenFinPre;
forward  Tokenizer;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant CHARSET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"()\'_+-*/.<\
>=^ \t';
constant DT_BOTH = 2;
constant DT_CLASS = 1;
constant DT_PRIMITIVE = 0;
constant KW_IDENT = -1;
constant KW_NOTFOUND = 0;
constant KW_TYPE = -2;
constant LOG_GRPFLAG = 62;
constant MAP_DECIMAL_TO_DECIMAL = 2;
constant MAP_DECIMAL_TO_DOUBLE = 1;
constant TOK_BOOLEAN = 6;
constant TOK_DATAVALUE = 7;
constant TOK_DECIMAL = 8;
constant TOK_FLOAT = 5;
constant TOK_INTEGER = 4;
constant TOK_INVALID = 0;
constant TOK_PREEND = -1;
constant TOK_SEPARATOR = 1;
constant TOK_STRING = 3;
constant TOK_VAL = 2;
constant TYP_INVALID = 0;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ElementDesc inherits from FrameworkBD.ObjectBD

has public  attribute Code: Framework.integer;
has public  attribute Name: Framework.TextData;

has public  method GetCode: Framework.integer;
has public  method GetName: Framework.string;
has public  method Init;
has public  method SetCode(input aCode: Framework.integer);
has public  method SetName(input aName: Framework.string);
has public  method SetParams(input aCode: Framework.integer,
	input aName: Framework.string);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DataTypeDesc inherits from ParserClasses.ElementDesc

has public  attribute ClassID: Framework.integer;

has public  method GetClassID: Framework.integer;
has public  method Init;
has public  method SetClassID(input unClassID: Framework.integer);
has public  method SetParams(input aCode: Framework.integer,
	input aName: Framework.string,
	input aClassID: Framework.integer);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InternalExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class KeywordDesc inherits from ParserClasses.ElementDesc

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Parser inherits from FrameworkBD.ObjectBD

has public  attribute CurrTok: ParserClasses.Token;
has public  attribute ExpandTokens: Framework.Array of ParserClasses.Token;
has public  attribute Expansed: Framework.boolean;
has public  attribute lesErreurs: Framework.Array of Framework.ListElement;
has public  attribute lesKeywords: Framework.Array of ParserClasses.KeywordDesc;
has public  attribute lesTokens: Framework.Array of ParserClasses.Token;
has public  attribute lesTypes: Framework.Array of ParserClasses.DataTypeDesc;
has public  attribute NextTok: ParserClasses.Token;
has public  attribute PrevTok: ParserClasses.Token;
has public  attribute Scope: Framework.integer;
has public  attribute Status: Framework.boolean;
has public  attribute TokenCount: Framework.integer;
has public  attribute TokenIndex: Framework.integer;
has private attribute unTokenizer: ParserClasses.Tokenizer;
has public  attribute WantErrors: Framework.boolean;

has public  event ErrorNotification(input lesErreurs: Framework.Array of Framework.ListElement);
has public  event TokenPassed(input TokenList: Framework.Array of ParserClasses.Token);

has public  method Accept(input unCode: Framework.integer,
	input output unRes: Framework.integer,
	input unMot: Framework.TextData): Framework.boolean;
has public  method Accept(input Courant: Framework.TextData,
	input Suivant: Framework.TextData = NIL,
	input Avance: Framework.boolean = TRUE): Framework.boolean;
has public  method AcceptKeyword(input unCode: Framework.integer,
	input output unRes: Framework.integer,
	input output leKeyword: Framework.TextData): Framework.boolean;
has public  method AcceptType(input unCode: Framework.integer,
	input output unRes: Framework.integer): Framework.boolean;
has public  method AddErr(input uneExc: Framework.integer,
	input uneErreur: Framework.string,
	input RaiseException: Framework.boolean);
has public  method AddError(input uneExc: Framework.integer,
	input uneErreur: Framework.string,
	input unComplem: Framework.string,
	input RaiseException: Framework.boolean = TRUE);
has public  method ClearErrors;
has public  method ClearStatus;
has public  method Compile(copy input SourceCode: Framework.TextData): Framework.boolean;
has public  method DataTypeExists(input leType: Framework.TextData,
	input typeRecherche: Framework.integer): Framework.integer;
has public  method DoesExpand(input srcString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.boolean;
has public  method DoGetEndOfLineCommentOut: Framework.string;
has public  method DoInitializeDataTypes;
has public  method DoInitializeKeywords;
has public  method DoInitializeParser;
has public  method DoIsKeyword(input aString: Framework.TextData): Framework.integer;
has public  method DoIsType(input aTypeName: Framework.string): Framework.integer;
has public  method DoIsValidIdentifier(input uneChaine: Framework.TextData): Framework.boolean;
has public  method DoParseTokens: Framework.TextData;
has public  method Expand(input SourceString: Framework.TextData,
	input WithString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.TextData;
has public  method Expecting(input PreIncr: Framework.boolean = TRUE,
	input PostIncr: Framework.boolean = TRUE,
	input uneChaine: Framework.TextData): Framework.boolean;
has public  method Expecting(input PreIncr: Framework.boolean = TRUE,
	input PostIncr: Framework.boolean = TRUE,
	input unCodeKeyword: Framework.integer): Framework.boolean;
has public  method Found(input uneChaine: Framework.TextData): Framework.boolean;
has public  method GetErrors: Framework.Array of Framework.ListElement;
has public  method GetFirstToken: ParserClasses.Token;
has public  method GetNextToken: ParserClasses.Token;
has public  method GetStatus: Framework.boolean;
has public  method GetTokenizer: ParserClasses.Tokenizer;
has public  method Init;
has public  method KeywordExists(input leKeyword: Framework.TextData): Framework.integer;
has public  method PutBack;
has public  method RaiseInternalError(input unErrorMsg: Framework.string);
has public  method ReadInteger(input AcceptSign: Framework.boolean = TRUE): Framework.TextData;
has public  method RegisterDataType(copy input aString: Framework.TextData,
	input aCode: Framework.integer,
	input aClassID: Framework.integer);
has public  method RegisterKeyword(copy input aString: Framework.TextData,
	input aCode: Framework.integer);
has public  method SetErrorMode(input Mode: Framework.boolean);
has public  method SetStatus;
has public  method SetTokenizer(input aTokenizer: ParserClasses.Tokenizer);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Token inherits from FrameworkBD.ObjectBD

has public  attribute fkind: Framework.integer;
has public  attribute fstrval: Framework.DataValue;
has public  attribute Refiner: Framework.integer;

has public  method GetAsRefined: Framework.integer;
has public  method GetDataValue: Framework.DataValue;
has public  method GetKind: Framework.integer;
has public  method GetVal: Framework.TextData;
has public  method Init;
has public  method SetAsRefined(input unRefiner: Framework.integer);
has public  method SetKind(input kind: Framework.integer);
has public  method SetVal(input val: Framework.TextData);
has public  method SetVal(input Val: Framework.DataValue);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TokenFinPre inherits from ParserClasses.Token

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Tokenizer inherits from FrameworkBD.ObjectBD

has public  attribute CurrToken: Framework.TextData;
has public  attribute DecimalNumbersMapping: Framework.integer;
has public  attribute flagFalse: Framework.BooleanNullable;
has public  attribute flagTrue: Framework.BooleanNullable;
has public  attribute LigneCode: Framework.TextData;
has public  attribute NbDigits: Framework.integer;
has public  attribute PerformPreprocessing: Framework.boolean;
has public  attribute PreProc: DataStructuresClasses.AssocFlag;
has public  attribute TokenFinPre: ParserClasses.TokenFinPre;
has private attribute Tokens: Framework.Array of ParserClasses.Token;
has public  attribute unParser: ParserClasses.Parser;

has public  method AcceptChar(input laLigne: Framework.TextData,
	input ThisChar: Framework.TextData): Framework.boolean;
has public  method AddError(input uneExc: Framework.integer,
	input uneErreur: Framework.string);
has public  method AnchorPreEnd(input laTableTokens: Framework.Array of ParserClasses.Token,
	input AfterToken: ParserClasses.Token);
has public  method AppendPre(input unObjet: Framework.TextData,
	input uneCle: Framework.TextData);
has public  method AppendToken(input laTableTokens: Framework.Array of ParserClasses.Token,
	input unTypToken: Framework.integer,
	input uneChaine: Framework.TextData,
	input unRefiner: Framework.integer = -1): ParserClasses.Token;
has public  method AppendToken(input laTableTokens: Framework.Array of ParserClasses.Token,
	input unTypToken: Framework.integer,
	input unDataValue: Framework.DataValue,
	input unRefiner: Framework.integer = -1): ParserClasses.Token;
has public  method ClearPres;
has public  method DoCanMergeToken(input TokenGauche: Framework.TextData,
	input TokenDroit: Framework.TextData): Framework.boolean;
has public  method DoGetStringChar: Framework.string;
has public  method DoGetStringForm(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneChaine: Framework.TextData): ParserClasses.Token;
has public  method DoIsSeparator(input ThisChar: Framework.TextData): Framework.boolean;
has public  method DoIsStringChar(input ThisChar: Framework.TextData): Framework.boolean;
has public  method DoRefineSeparator(input ThisChar: Framework.TextData): Framework.integer;
has public  method DoUsePreprocessor: Framework.boolean;
has public  method FindToken(input leToken: ParserClasses.Token,
	input inList: Framework.Array of ParserClasses.Token): Framework.boolean;
has public  method GetDecimalNumbersMapping: Framework.integer;
has public  method GetPre(input uneCle: Framework.TextData,
	input output unAssocItem: DataStructuresClasses.AssocItem): Framework.TextData;
has public  method GetTokens: Framework.Array of ParserClasses.Token;
has public  method GetValToken(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token);
has public  method Init;
has public  method MapDecimalToDecimal;
has public  method MapDecimalToDouble;
has public  method Preprocess(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneValeurRempl: Framework.TextData);
has public  method RaiseInternalError(input unErrorMsg: Framework.string);
has public  method ReadDigitList(input laLigne: Framework.TextData): Framework.boolean;
has public  method ReadNumeric(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean;
has public  method ReadSeparator(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean;
has public  method ReadString(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean;
has public  method ReplaceTokenWith(input Origine: Framework.Array of ParserClasses.Token,
	input leToken: ParserClasses.Token,
	input ParTokens: Framework.Array of ParserClasses.Token,
	input output NbRepl: Framework.integer): Framework.boolean;
has public  method SetParser(input aParser: ParserClasses.Parser);
has public  method SkipChar(input laLigne: Framework.TextData,
	input ThisChar: Framework.TextData): Framework.boolean;
has public  method TokenizeLine(input output laLigne: Framework.TextData,
	input TableTokens: Framework.Array of ParserClasses.Token);
has public  method TokenizeSource(input Code: Framework.Array of Framework.TextData);
has public  method TrimLine(input Code: Framework.TextData): Framework.TextData;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method DataTypeDesc.GetClassID: Framework.integer
begin
--
--	Description : Renvoie le genre du type (primitif/classe)
--
--	Type :	concret
--
--	Parametres :   
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	11/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataTypeDesc.GetClassID');
unClassID : integer = ClassID;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataTypeDesc.GetClassID : End');
return unClassID;

end method;

------------------------------------------------------------
method DataTypeDesc.Init
begin
--
--	Description : Initialisation des paramètres du type (code et nom)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/02/1998	|	Creation.
--+

super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataTypeDesc.Init');
ClassID = 0; -- pas de classe définie, donc un type primitif.
Name=new();
Code=0;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataTypeDesc.Init : End');

end method;

------------------------------------------------------------
method DataTypeDesc.SetClassID(input unClassID: Framework.integer)
begin
--
--	Description : Positionne le genre du type (primitif/classe)
--
--	Type :	concret
--
--	Parametres :   
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	11/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataTypeDesc.SetClassID');
ClassID=unClassID;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataTypeDesc.SetClassID : End');

end method;

------------------------------------------------------------
method DataTypeDesc.SetParams(input aCode: Framework.integer,
	input aName: Framework.string,
	input aClassID: Framework.integer)
begin
--
--	Description : Initialisation spécifiée des paramètres du type (code et nom)
--
--	Type :	concret
--
--	Parametres :   aCode    : Code du type
--				   aName    : Nom du type
--				   aClassID : type primitif ou type objet ?
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DataTypeDesc.SetParams');
Name=aName;
Code=aCode;
ClassID=aClassId;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataTypeDesc.SetParams : End');

end method;

------------------------------------------------------------
method ElementDesc.GetCode: Framework.integer
begin
--
--	Description : Renvoie des paramètres de l'élément de nomemclature
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation dans Keyword/DataType.
--	PMT	|	03/02/1998	|	Remontée de la méthode de Keyword/DataType vers Nomemclature.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.GetCode');
unCode : integer = Code;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.GetCode : End');
return unCode;
end method;

------------------------------------------------------------
method ElementDesc.GetName: Framework.string
begin
--
--	Description : Renvoie le nom de l'élément
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.GetName');
uneChaine : string = name.value;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.GetName : End');
return uneChaine;
end method;

------------------------------------------------------------
method ElementDesc.Init
begin
--
--	Description : Initialisation des paramètres de l'élément de nomemclature
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	03/02/1998	|	Remontée de la méthode de Keyword/DataType vers Nomemclature.
--+

super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.Init');
Name=new(value='');  -- on ne devrait jamais arriver ici
Code=0;  
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.Init : End');

end method;

------------------------------------------------------------
method ElementDesc.SetCode(input aCode: Framework.integer)
begin
--
--	Description : Initialisation du code d'un ElementDesc
--
--	Type :	concret
--
--	Parametres :   aCode : code de l'élément
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	03/02/1998	|	Remontée de la méthode de Keyword/DataType vers Nomemclature.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.SetCode');
Code=aCode;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.SetCode : End');

end method;

------------------------------------------------------------
method ElementDesc.SetName(input aName: Framework.string)
begin
--
--	Description : Modification du nom de l'élément
--
--	Type :	concret
--
--	Parametres :   aName  : Nom de l'élément
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	03/02/1998	|	Remontée de la méthode de Keyword/DataType vers Nomemclature.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.SetName');
Name=aName;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.SetName : End');

end method;

------------------------------------------------------------
method ElementDesc.SetParams(input aCode: Framework.integer,
	input aName: Framework.string)
begin
--
--	Description : Initialisation des paramètres de l'élément de nomemclature
--
--	Type :	concret
--
--	Parametres :   aCode : code de l'élément, aName  : Nom de l'élément
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	03/02/1998	|	Remontée de la méthode de Keyword/DataType vers Nomemclature.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ElementDesc.SetParams');
Name=aName;
Code=aCode;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ElementDesc.SetParams : End');

end method;

------------------------------------------------------------
method InternalExc.Init
begin
--
--	Description : Initialisation de l'exception interne
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/02/1998	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method KeywordDesc.Init
begin
--
--	Description : Initialisation d'un keyword
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

super.Init();

end method;

------------------------------------------------------------
method Parser.Accept(input unCode: Framework.integer,
	input output unRes: Framework.integer,
	input unMot: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le mot passé en paramètre correspond au token en cours
--  d'évaluation. Si oui, modification en sortie du paramètre aRes.
--  Renvoie d'un booléen pour être éventuellement exploité par la méthode appelante.
--
--	Type :	concret
--
--	Parametres :  unCode: Le code à renvoyer en cas de succès.
--				  unRes : La variable en sortie pour renvoyer le code 
--				  unMot : Le mot à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Accept(unCode,unRes,unMot)');
found : boolean = FALSE;
	if CurrTok.GetVal().IsEqual(source=unMot,ignoreCase=TRUE) 
	then
	  unRes = unCode; -- on modifie uniquement si le mot est un mot réservé.
	  found = TRUE;	
	end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Accept(unCode,unRes,unMot) : End');

return found;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Accept(unCode,unRes,unMot)');
		Raise;

end method;

------------------------------------------------------------
method Parser.Accept(input Courant: Framework.TextData,
	input Suivant: Framework.TextData = NIL,
	input Avance: Framework.boolean = TRUE): Framework.boolean
begin
--
--	Description : Vérifie si le mot passé en paramètre correspond au token en cours
--  d'évaluation. Version plus basique que l'autre signature qui renvoie un code avec la
--  possibilité de tester le token suivant (utile pour tester les opérateurs sur deux caractères)
--
--	Type :	concret
--
--	Parametres :   Courant : La première chaîne à trouver
--				   Suivant : La seconde chaîne à trouver (NIL = ne pas évaluer par défaut)
--				   Avance  : Faut t'il mettre à jour la position dans le flux de tokens (True par défaut)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Accept(Courant,Suivant,Avance)');
unRes : boolean;
unRes = CurrTok.GetVal().IsEqual(Courant);

-- Vérification du deuxième symbole si précisé. Si trouvé, alors on avance d'un symbole.
SecondChar : boolean = unRes and Suivant<>NIL and NextTok<>NIL;
if SecondChar then 
   unRes = unRes and NextTok.GetVal().IsEqual(Suivant); 
end if;

-- Avancée dans la liste des symboles en fonction du succès ou non de la recherche et du nombre
-- de token du symbole
if unRes and Avance then
   GetNextToken();
   if SecondChar then GetNextToken(); end if; 	
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Accept(Courant,Suivant,Avance) : End');

return unRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Accept(Courant,Suivant,avance)');
		Raise;

end method;

------------------------------------------------------------
method Parser.AcceptKeyword(input unCode: Framework.integer,
	input output unRes: Framework.integer,
	input output leKeyword: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le mot clé passé en paramètre (via son code) correspond au token en cours
--  d'évaluation. Si oui, modification en sortie du paramètre aRes.
--  Renvoie d'un booléen pour être éventuellement exploité par la méthode appelante.
--
--	Type :	concret
--
--	Parametres :   unCode : le code du mot réservé (keyword)
--				   unRes  : La variable de sortie destinée à renvoyer le code
--				   leKeyword : Renvoi du texte du keyword
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Création.
--	PMT	|	21/04/1998	|	Suppression d'un new pour aller plus vite
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.AcceptKeyword');

unKeyword : TextData = new();
found : boolean = FALSE;
if lesKeywords[unCode] <> NIL then
 unKeyword.SetValue(lesKeywords[unCode].GetName()); -- Recherche directement à l'index du code dans le tableau
end if;

if CurrTok.GetVal().IsEqual(source=unKeyword,ignoreCase=TRUE) 
then
  unRes = unCode; -- on modifie uniquement si le mot est un mot réservé.
  leKeyword = unKeyword;	
  found = TRUE;	
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.AcceptKeyword : End');

return found;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.AcceptKeyword');
		Raise;

end method;

------------------------------------------------------------
method Parser.AcceptType(input unCode: Framework.integer,
	input output unRes: Framework.integer): Framework.boolean
begin
--
--	Description : Vérifie si le type correspond au token en cours
--  d'évaluation. Si oui, modification en sortie du paramètre aRes.
--  Renvoie d'un booléen pour être éventuellement exploité par la méthode appelante.
--
--	Type :	concret
--
--	Parametres :   unCode : le code du type à rechercher
--	Parametres :   unRes  : La variable de sortie destinée à renvoyer le code
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.AcceptType');

UnType : TextData = new();
found : boolean = FALSE;
if lesTypes[unCode] <> NIL then
 unType.SetValue(lesTypes[unCode].GetName()); -- Recherche directement à l'index du code dans le tableau
end if;

if CurrTok.GetVal().IsEqual(source=unType,ignoreCase=TRUE) 
then
  unRes = unCode; -- on modifie uniquement si le mot est un mot réservé.
  found = TRUE;	
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.AcceptType : End');

return found;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.AcceptType');
		Raise;

end method;

------------------------------------------------------------
method Parser.AddErr(input uneExc: Framework.integer,
	input uneErreur: Framework.string,
	input RaiseException: Framework.boolean)
begin
--
--	Description : Ajout d'une erreur dans la liste des erreurs
--
--	Type :	concret
-- 
--  Remarques : Cette méthode dépend du package ParserErrors qui implémente des exceptions destinées 
--  à ParserTarif. Peut t'être faudrait t'il surcharger AddErr dans ParserTarif pour traiter les autres 
--  cas (A voir).
--
--	Parametres :  uneErreur : Libellé complet de l'erreur
--	              unComplem : Complément d'information (En général : Symbole concerné) sur l'erreur
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	05/02/1998	|	Possibilité de montrer/masquer les erreurs.
--	PMT	|	26/02/1998	|	Possibilité de lever une exception.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.AddErr');

if WantErrors then

	Chaine : TextData = new(value = 'Ajout d''une erreur : ');
	Chaine.Concat(uneErreur);
	task.part.LogMgr.PutLine(Chaine);
	
	-- création de l'erreur et insertion dans la liste
	Erreur : ListElement  = new(TextValue=uneErreur);
	lesErreurs.AppendRow(Erreur);
end if;

if RaiseException then

    ObjErreur : ErreurCompilateur;
	case uneExc is
		when ERR_DELIMITEUR_CHAINE do ObjErreur = ErreurDelimiteurChaine();
		when ERR_ELEMENT_NON_TROUVE do ObjErreur = ErreurElementNonTrouve(); 
		when ERR_FORMAT_IDENTIFICATEUR_INCORRECT do ObjErreur = ErreurFormatIdentificateurIncorrect();
		when ERR_MOT_RESERVE_ATTENDU do ObjErreur = ErreurMotReserveAttendu();
		when ERR_OPERATEUR_INCONNU do ObjErreur = ErreurOperateurInconnu();
		when ERR_SIGNE_INTERDIT do ObjErreur = ErreurSigneInterdit();
		when ERR_TYPE_INEXISTANT do ObjErreur = ErreurTypeInexistant();
		when ERR_VALEUR_BOOLEENNE do ObjErreur = ErreurValeurBooleenne();
		when ERR_VALEUR_CHAINE do ObjErreur = ErreurValeurChaine();
		when ERR_VALEUR_ENTIERE do ObjErreur = ErreurValeurEntiere();
		when ERR_VALEUR_REELLE  do ObjErreur = ErreurValeurReelle();
		when ERR_VALEUR_TYPE_INCONNU do ObjErreur = ErreurValeurTypeInconnu();
		when ERR_VARIABLE_INCONNUE  do ObjErreur = ErreurVariableInconnue();
		when ERR_CARACTERE_INTERDIT do ObjErreur = ErreurCaractereInterdit();
		when ERR_FORMAT_SYM_INCORRECT do ObjErreur = ErreurFormatSymIncorrect();
		when ERR_SYM_NON_TROUVE do ObjErreur = ErreurSymNonTrouve();
	    when ERR_SYM_CIRCULAIRE do ObjErreur = ErreurSymCirculaire();
		when ERR_VALEUR_GENERIQUE do ObjErreur = ErreurValeurGenerique();
		when ERR_TOK_FINPRE do ObjErreur = ErreurTokFinPre();
	end case;

    if ObjErreur = NIL then 
       ObjErreur = ErreurInconnue();
       Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, 'Attention, une exception à NIL : ParserClasses.Parser.AddErr');
    end if;
       
    (ErreurCompilateur) (ObjErreur).SetWithParams(severity=SP_ER_ERROR,Message=uneErreur);

	Task.Part.LogMgr.PutLine(uneErreur);

	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.AddErr::raise ObjErreur');
	raise ObjErreur;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.AddErr: End');


end method;

------------------------------------------------------------
method Parser.AddError(input uneExc: Framework.integer,
	input uneErreur: Framework.string,
	input unComplem: Framework.string,
	input RaiseException: Framework.boolean = TRUE)
begin
--
--	Description : Ajout d'une erreur d'analyse syntaxique dans la liste des erreurs
--
--	Type :	concret
--
--	Parametres :   uneErreur : Libellé complet de l'erreur
--	Parametres :   unComplem : Complément d'informations sur l'erreur
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.AddError');

Erreur : TextData = new(value = uneErreur);
Erreur.Concat(unComplem);
AddErr(uneExc,Erreur.Value,RaiseException);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.AddError : End');

end method;

------------------------------------------------------------
method Parser.ClearErrors
begin
--
--	Description : Effacer la liste des erreurs de compilation
--
--	Type :	concret
--
--	Parametres :  Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.ClearErrors');
lesErreurs.Clear();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.ClearErrors : End');

end method;

------------------------------------------------------------
method Parser.ClearStatus
begin
--
--	Description : Positionne le status d'erreur à FALSE, pour initialiser une règle en
--				  termes de gestion d'erreurs (On démmarre la règle en considérant qu'il n'y a
--				  pas encore eu d'erreurs. Necéssite la gestion des erreurs sous la forme d'une pile de booléens).	
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.ClearStatus');
status = FALSE;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.ClearStatus : End');

end method;

------------------------------------------------------------
method Parser.Compile(copy input SourceCode: Framework.TextData): Framework.boolean
begin
--
--	Description : Lancement de la compilation (au sens générique)
--
--	Type :	concret
--
--	Parametres :   SourceCode : Le code source sous forme d'un TextData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--	PMT	|	03/02/1998	|	Passage du nombre de tokens au parseur.
--+

-- variables nécessaires au découpage du texte en lignes de textes.
-- on pourrait peut-être éviter le découpage en ligne en utilisant le 
-- retour chariot dans la liste des séparateurs autorisés.
		
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Compile');

currLine  : integer = 1;
startofs  : integer = 0;
stopofs   : integer = 0;

Self.ClearStatus();

-- extraction d'une ligne de code et "tokenization" de la ligne en question				
lesLignes : array of TextData = new();
lesLignes.Clear();

unComment : TextData = new(Value=DoGetEndOfLineCommentOut());
uneLongueur : integer = unComment.LengthToEnd();

Found : boolean = SourceCode.FindLine(1,startofs,stopofs) and not SourceCode.IsEqual('');
while Found do
  
      Chaine : TextData = new();
      Chaine.SetValue(SourceCode.CopyRange(startofs,stopofs));
	  SourceCode.CutRange(startofs,stopofs);
	  while SourceCode.IsChar('\n') do SourceCode.CutRange(0,1); end while; 
      CurrLine = CurrLine + 1; -- passage à la ligne suivante

	  -- suppression des commentaires de fin de ligne	
	  Chaine.Offset = 0;
	  if Chaine.MoveToString(unComment) then 
    	 Chaine.CutRange(Chaine.offset,Chaine.offset+Chaine.LengthToEnd()+uneLongueur);	     
	  end if;

	  Chaine.TrimLeading();
	  Chaine.TrimTrailing();
	  -- ajout de la chaîne dans le tableau des lignes du code source.		  
	  if not Chaine.IsEqual('') then lesLignes.AppendRow(Chaine); end if;
	  
	  Found = SourceCode.FindLine(1,startofs,stopofs) and not SourceCode.IsEqual('');
end;
		
-- 1ère passe : séparation des éléments lexicaux
self.unTokenizer.TokenizeSource(lesLignes);

-- 2ème passe : Analyse des tokens et constitution de l'arbre syntaxique
DoParseTokens();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Compile : End');

return not GetStatus(); 

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Compile');
		Raise;

end method;

------------------------------------------------------------
method Parser.DataTypeExists(input leType: Framework.TextData,
	input typeRecherche: Framework.integer): Framework.integer
begin
--
--	Description : Vérification de l'existence d'un type
--
--	Type :	concret
--
--	Parametres :   leType : Le mot recherché
--				   TypeRecherche : Méthode de recherche 
--				   (types primitifs : DT_PRIMITIVE,
--				    classes         : DT_CLASS,
--				    les deux        : DT_BOTH)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	11/02/1998	|	Prise en compte de la sélection entre type primitif, classes, ou les deux.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DataTypeExists');

leCode : integer = 0;
for i in lesTypes do
  if (leType.IsEqual(i.name,ignoreCase=TRUE))  --and ((typeRecherche=i.GetClassID()) or (typeRecherche=DT_BOTH))
  then
    leCode = i.Code;
    exit;
  end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DataTypeExists : End');
return leCode;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.DataTypeExists');
		Raise;

end method;

------------------------------------------------------------
method Parser.DoesExpand(input srcString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.boolean
begin
--
--	Description : Expansion d'une chaîne de caractère par une sous-expression
--
--	Type : Concret
--
--	Parametres : srcString : Chaîne source
--				 WithString: Chaîne de remplacement
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : Vérifie si la chaîne contient le symbole "WithItem"
--
--	Historique : 
--
--	PMT    |   08/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.DoesExpand');

Expand(SourceString = srcString, WithString='',WithItem = WithItem);
unResult : boolean = Expansed;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.DoesExpand : End');

return unResult;
end method;

------------------------------------------------------------
method Parser.DoGetEndOfLineCommentOut: Framework.string
begin
--
--	Description : A surcharger.Renvoie la chaîne de commentaire fin de ligne
--
--	Type :	Abstrait
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

return '"';
end method;

------------------------------------------------------------
method Parser.DoInitializeDataTypes
begin
--
--	Description : Enregistrement de tous les types du langage. A surcharger
--
--	Type :	Concret car on doit appeler cette méthode dans la méthode dérivée
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoInitializeDataTypes');
lesTypes.Clear();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoInitializeDataTypes : End');

end method;

------------------------------------------------------------
method Parser.DoInitializeKeywords
begin
--
--	Description : A surcharger par la classe dérivée. 
--  Enregistrement de tous les mots réservés du langage
--
--	Type :	Concret car on doit appeler cette méthode dans la méthode dérivée
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoInitializeKeywords');
lesKeywords.Clear();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoInitializeKeywords : End');

end method;

------------------------------------------------------------
method Parser.DoInitializeParser
begin
--
--	Description : A surcharger. Initialisation des autres objets du compilateur (tokenizer,parser)
--
--	Type :	Abstrait
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

WantErrors = TRUE;
end method;

------------------------------------------------------------
method Parser.DoIsKeyword(input aString: Framework.TextData): Framework.integer
begin
--
--	Description : Vérifie si la chaîne correspond à un mot clé
--  Accept modifiera le code résultat si le mot est un mot réservé du langage
--
--	Type :	Abstrait
--
--	Parametres :   aString : Le mot à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/01/1998	|	Creation.
--+

-- Attention : Le code ci-dessous ne sert que d'exemple de surcharge, le laisser en commentaire.


/*  *** EXEMPLE DE LA METHODE MERE ***

aResult : integer = KW_NOTFOUND;
found   : boolean = FALSE;

if 	   aString.IsChar('Cc') then
	found = AcceptKeyword(KW_CONSTS,aResult);
	if not found then found = AcceptKeyword(KW_COMMENTS,aResult); end if;
	
elseif aString.IsChar('Pp') then
	found = AcceptKeyword(KW_PUBLIC  , aResult);  end if;
	if not found then found = AcceptKeyword(KW_PRIVATE , aResult);  end if;
	if not found then found = AcceptKeyword(KW_PROPERTY,aResult);  end if;

end if;

return aResult;

*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoIsKeyword');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoIsKeyword : End');
return KW_NOTFOUND;
end method;

------------------------------------------------------------
method Parser.DoIsType(input aTypeName: Framework.string): Framework.integer
begin
--
--	Description : Vérifie si la chaîne correspond à un type, renvoie le code correspondant, sinon TYP_INVALID
--  Accept modifiera le code résultat si le mot correspond à un type du langage
--
--	Type :	Concret
--
--	Parametres :   aString : Le mot à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoIsType');
aResult:integer = TYP_INVALID;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoIsType : End');
return aResult;
end method;

------------------------------------------------------------
method Parser.DoIsValidIdentifier(input uneChaine: Framework.TextData): Framework.boolean
begin
--
--	Description : vérification du bon format d'un identificateur 
--  Par défaut : Une lettre, suivie de caractères alphanumériques (a-zA-Z0-9)
--  expression régulière : [a-zA-Z] [_a-zA-Z0-9]*
--  Ne devrait être surchargé que si ce format ne convient pas !
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoIsValidIdentifier');

aRes  : boolean = TRUE; -- On commence en considérant le résultat comme correct
if not uneChaine.IsAlpha() 
  then aRes=FALSE; -- Ca commence mal, erreur dés le premier caractère
  else
       uneChaine.MoveNext(); 
       while (not uneChaine.IsAtEnd()) and (aRes=TRUE) do
		 if not (uneChaine.IsAlpha() or uneChaine.IsDigit() or uneChaine.IsChar('_')) then aRes=FALSE; end if; -- chercher l'erreur
         uneChaine.MoveNext;
       end while;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoIsValidIdentifier : End');
return aRes;
end method;

------------------------------------------------------------
method Parser.DoParseTokens: Framework.TextData
begin
--
--	Description : Lancement de l'analyse syntaxique sur les tokens créés par le tokenizer
--  Retourne une référence sur la liste des erreurs.
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation. 
--	PMT	|	03/02/1998	|	Ajout de code pour faire l'interface entre le tokenizer et le parseur.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoParseTokens');

lesTokens = unTokenizer.GetTokens(); 
--TokenCount = unTokenizer.GetTokenCount();
TokenCount = lesTokens.Items;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoParseTokens : End');

return NIL; -- A VOIR PLUS TARD
end method;

------------------------------------------------------------
method Parser.Expand(input SourceString: Framework.TextData,
	input WithString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.TextData
begin
--
--	Description : Expansion d'un symbole dans une chaîne avec parenthésage automatique
--
--	Type :	concret
--
--	Parametres :   SourceString  : Chaîne à scanner
--				   WithString    : Chaîne de remplacement
--				   WithItem      : Element à rechercher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	07/04/1998	|	Creation.
--	PMT	|	22/04/1998	|	Suppression d'un test un peu sévère (sur la possibilité de passer une chaîne vide à WithString)
--+

ExpandTokens : array of Token = new();
--ExpandTokens.Clear(); -- Gain en performances pas très convaincant 
uneLigne	   : TextData = new(Value=SourceString.Value);
unResult       : TextData = new();

unTokenizer.TokenizeLine(uneLigne,ExpandTokens); -- Séparation en tokens car permet ensuite des comparaisons
												   -- sans avoir le problème du symbole compris en tant que 
												   -- sous chaîne dans la chaîne à scanner	
Expansed = false;

if         WithString<>NIL 
--   and not WithString.IsEqual('') 
   and     WithItem<>NIL
   and not WithItem.IsEqual('')
then
   -- Parenthésage de l'expression de remplacement
   uneValeurRempl : TextData = new(Value='(');
   uneValeurRempl.Concat(WithString);
   uneValeurRempl.Concat(')');

   -- remplacement des chaînes pour lesquelles on trouve le symbole à remplacer
   for parcours in ExpandTokens do
		if Parcours.GetVal().IsEqual(WithItem,ignoreCase=TRUE) then
		   Expansed = true;	
		   Parcours.SetVal(uneValeurRempl);
		end if;
   end for;

   -- reconstitution de la chaîne à partir de la liste de tokens	
   for parcours in ExpandTokens do
		unResult.Concat(parcours.GetVal());	
   end for;
else
   unResult.SetValue(SourceString);	
end if;


return unResult;
end method;

------------------------------------------------------------
method Parser.Expecting(input PreIncr: Framework.boolean = TRUE,
	input PostIncr: Framework.boolean = TRUE,
	input uneChaine: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie la présence de la chaîne en paramètre sur le token en cours 
--  (doit être strictement égal à la casse près)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/02/1998	|	Creation.
--	PMT	|	11/05/1998	|	Correction : Ajouté un test if uneChaine<>NIL 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Expecting(preincr,postincr,unechaine)');

if PreIncr then GetNextToken(); end if;

aRes:boolean;
if uneChaine<>NIL and CurrTok<>NIL 
	then aRes = uneChaine.IsEqual(CurrTok.GetVal().Value,ignoreCase=TRUE);
	else aRes = FALSE;
end if;

if PostIncr then GetNextToken(); end if;
if not aRes then 
   SetStatus(); -- Notification d'erreur
   self.AddError(ERR_ELEMENT_NON_TROUVE,'Element non trouvé : ',UneChaine.Value);
   GetNextToken();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Expecting(preincr,postincr,unechaine) : End');

return aRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Expecting(uneChaine)');
		Raise;

end method;

------------------------------------------------------------
method Parser.Expecting(input PreIncr: Framework.boolean = TRUE,
	input PostIncr: Framework.boolean = TRUE,
	input unCodeKeyword: Framework.integer): Framework.boolean
begin
--
--	Description : Vérifie la présence d'un mot réservé
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/02/1998	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Expecting(preincr,postincr,unCodeKeyword)');

aRes : boolean;
unRes: integer; -- filler
unTexteKeyword : TextData;

if PreIncr then GetNextToken(); end if;
aRes = AcceptKeyword(unCodeKeyword,unRes,unTexteKeyword);
if PostIncr then GetNextToken(); end if;
if not aRes then 
	SetStatus(); -- Notification d'erreur
	self.AddError(ERR_MOT_RESERVE_ATTENDU,'Mot réservé non trouvé : ',unTexteKeyword.Value);
	GetNextToken();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Expecting(preincr,postincr,unCodeKeyword) : End');

return aRes;     

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Expecting(unCodeKeyword)');
		Raise;

end method;

------------------------------------------------------------
method Parser.Found(input uneChaine: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérification de la présence d'un token
--  i.e. Version de Accept sans avoir besoin de passer un ensemble de code
-- 
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	10/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.Found');
aRes : boolean = UneChaine.IsEqual(CurrTok.GetVal());
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.Found : End');
return aRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.Found');
		Raise;

end method;

------------------------------------------------------------
method Parser.GetErrors: Framework.Array of Framework.ListElement
begin
--
--	Description : Renvoie la liste des erreurs
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.GetErrors');
ListeErreurs : array of ListElement = lesErreurs;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.GetErrors : End');
return ListeErreurs;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.GetErrors');
		Raise;

end method;

------------------------------------------------------------
method Parser.GetFirstToken: ParserClasses.Token
begin
--
--	Description : Positionne le pointeur de token sur le premier token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--	PMT	|	17/02/1998	|	Intégration de la lecture d'un token en avance.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.GetFirstToken');

TokenIndex = 1;
PrevTok = NIL;

CurrTok = lesTokens[1];
NextTok = lesTokens[2];

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.GetFirstToken : End');

return CurrTok;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.GetFirstToken');
		Raise;

end method;

------------------------------------------------------------
method Parser.GetNextToken: ParserClasses.Token
begin
--
--	Description : Positionne le pointeur de token sur le suivant et renvoie 
--  sa référence ou NIL si on est en fin de chaine.
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--  PMT |   03/02/1998  |   Ajout de la possibilité de positionner directement le token courant.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.GetNextToken');

unToken : Token;

TokenIndex = TokenIndex+1;
if TokenIndex<=TokenCount
then   
	 PrevTok = CurrTok;

	 CurrTok = lesTokens[TokenIndex];
	 if TokenIndex < TokenCount then
	     NextTok = lesTokens[TokenIndex+1];
	 else
	 	 NextTok = NIL;
	 end if;
	 
     unToken = CurrTok;
else 
     CurrTok = NIL;
     NextTok = NIL;
	 unToken = NIL;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.GetNextToken');

return unToken;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.GetNextToken');
		Raise;

end method;

------------------------------------------------------------
method Parser.GetStatus: Framework.boolean
begin
--
--	Description : Renvoie le statut d'erreur pour la règle en cours
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

return status;
end method;

------------------------------------------------------------
method Parser.GetTokenizer: ParserClasses.Tokenizer
begin
--
--	Description : Renvoie la référence sur le tokenizer
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	/01/1998	|	Creation.
--+

return unTokenizer;

end method;

------------------------------------------------------------
method Parser.Init
begin
--
--	Description : Initialisation du parseur (création de la racine de l'arbre syntaxique)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.DoInitializeParser');

DoInitializeParser(); -- Pour initialiser le tokenizer
lesKeywords = new(); -- liste des mots clés
lesTypes = new(); -- liste des types 
lesErreurs = new(); -- liste des erreurs
lesErreurs.Clear(); 
ClearStatus(); -- pas d'erreurs pour l'instant
Scope = 0; -- portée des identificateurs globale au début
DoInitializeKeywords(); -- initialisation des mots clés
DoInitializeDataTypes(); -- initialisation des types du langage
ExpandTokens = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.DoInitializeParser : End');


end method;

------------------------------------------------------------
method Parser.KeywordExists(input leKeyword: Framework.TextData): Framework.integer
begin
--
--	Description : Vérification de l'existence d'un mot clé
--
--	Type :	concret
--
--	Parametres :   leKeyword : Le mot recherché
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.KeywordExists');

leCode : integer = 0;
for i in lesKeywords do
  if (i<>NIL) and leKeyword.IsEqual(i.name,ignoreCase=TRUE) 
  then
    leCode = i.Code;
    exit;
  end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.KeywordExists : End');

return leCode;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.KeywordExists');
		Raise;

end method;

------------------------------------------------------------
method Parser.PutBack
begin
--
--	Description : Revient en arrière d'un token
--  Utile pour gérer des essais sur des mots réservés
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.PutBack');

if TokenIndex>1 then
	TokenIndex = TokenIndex - 1; 
	if TokenIndex>-1 then 
		CurrTok = lesTokens[tokenindex];
        NextTok = lesTokens[TokenIndex+1];
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.PutBack : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.PutBack');
		Raise;

	
end method;

------------------------------------------------------------
method Parser.RaiseInternalError(input unErrorMsg: Framework.string)
begin
--
--	Description : Leve une exception interne
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.RaiseInternalError');
uneException : InternalExc = new();
uneException.SetWithParams(severity = SP_ER_ERROR,Message=unErrorMsg);
Task.Part.LogMgr.PutLine(unErrorMsg);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.RaiseInternalError : raise UneException =  : End');
raise UneException;
end method;

------------------------------------------------------------
method Parser.ReadInteger(input AcceptSign: Framework.boolean = TRUE): Framework.TextData
begin
--
--	Description : Lecture d'un entier sans enregistrement dans un KWValue
--
--	Type :	concret
--
--	Parametres :  AcceptSign : Doit t'on accepter le signe (- ou +) ?
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	10/02/1998	|	Creation.
--+


	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.ReadInteger');

    ConversionOK : boolean = TRUE; 
    
	Chaine : TextData = new(Value='');
	
	-- on ignore le plus si le signe est accepté, sinon on renvoie l'erreur
	if Found('+') then 
	   if AcceptSign 
	   then
	      GetNextToken(); 
	   else
		  ConversionOK = FALSE;
	      SetStatus();
		  AddError(ERR_SIGNE_INTERDIT,'Signe non autorisé dans ce contexte.','');
	   end if;
	end if; 

	-- on ajoute le moins si le signe est accepté, sinon on renvoie l'erreur
	if Found('-') then 
	   if AcceptSign then	
          GetNextToken(); 
          Chaine.Concat('-');
	   else
		  ConversionOK = FALSE;
		  SetStatus();
		  AddError(ERR_SIGNE_INTERDIT,'Signe non autorisé dans ce contexte.','');
	   end if;   
	end if; -- on rajoute le moins en début de chaîne 

if ConversionOK then
          Chaine.Concat(CurrTok.GetVal().Value);
	begin
	      unEntier : IntegerData = new(value = Chaine.IntegerValue);
	exception
		  when e: DataTypeException do 
		  ConversionOK=FALSE;
		  Chaine = NIL;
	      SetStatus();
	      AddError(ERR_VALEUR_ENTIERE,'Valeur entière incorrecte : ',CurrTok.GetVal().Value);
	end;
else
          Chaine = NIL;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.ReadInteger : End');

return Chaine;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.ReadInteger');
		Raise;

end method;

------------------------------------------------------------
method Parser.RegisterDataType(copy input aString: Framework.TextData,
	input aCode: Framework.integer,
	input aClassID: Framework.integer)
begin
--
--	Description : Enregistre un type du langage
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.RegisterDataType');

if DataTypeExists(aString,aClassID)<=0 then 
  aDataType : DataTypeDesc = new();
  aDataType.SetParams(aCode,aString.value,aClassID);
  lesTypes.AppendRow(aDataType);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.RegisterDataType : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.RegisterDataType');
		Raise;

end method;

------------------------------------------------------------
method Parser.RegisterKeyword(copy input aString: Framework.TextData,
	input aCode: Framework.integer)
begin
--
--	Description : Enregistre un mot réservé du le langage
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.RegisterKeyword');

if KeywordExists(aString)<=0 then 
  aKeyword : KeywordDesc = new();
  aKeyword.SetParams(aCode,aString.value);
--  lesKeywords.AppendRow(aKeyword);
  lesKeywords[aCode] = aKeyword;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.RegisterKeyword : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Parser.RegisterKeyword');
		Raise;

end method;

------------------------------------------------------------
method Parser.SetErrorMode(input Mode: Framework.boolean)
begin
--
--	Description : Positionnement du mode d'affichage des erreurs
--
--	Type :	concret
--
--	Parametres :   Mode : = TRUE quand on veut voir les erreurs
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/02/1998	|	Creation.
--+

WantErrors = Mode;
end method;

------------------------------------------------------------
method Parser.SetStatus
begin
--
--	Description : Positionne le status d'erreur à TRUE, pour signifier un problème
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.SetStatus');
status = TRUE;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.SetStatus : End');

end method;

------------------------------------------------------------
method Parser.SetTokenizer(input aTokenizer: ParserClasses.Tokenizer)
begin
--
--	Description : Positionne la référence sur le tokenizer
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.SetTokenizer');
unTokenizer = aTokenizer;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.SetTokenizer : End');

end method;

------------------------------------------------------------
method Token.GetAsRefined: Framework.integer
begin
--
--	Description : Renvoie le code "affiné" du token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.GetAsRefined');
unRefiner : integer = Refiner;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.GetAsRefined : End');
return unRefiner;
end method;

------------------------------------------------------------
method Token.GetDataValue: Framework.DataValue
begin
--
--	Description : Renvoie la valeur DataValue du token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/03/1998	|	Creation.
--+

return fstrval;

end method;

------------------------------------------------------------
method Token.GetKind: Framework.integer
begin
--
--	Description : Renvoie le type du token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.GetKind');
unGenre : integer = fkind;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.GetKind : End');
return unGenre;

end method;

------------------------------------------------------------
method Token.GetVal: Framework.TextData
begin
--
--	Description : Renvoie la valeur chaîne du token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.GetVal');
unStrVal : TextData;
if fstrVal.IsA(TextData) then
   unStrVal = TextData(fstrval);
else
   unStrVal = fstrVal.TextValue;	
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.GetVal : End');

return unStrVal;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Token.GetVal');
		Raise;

end method;

------------------------------------------------------------
method Token.Init
begin
--
--	Description : Initialisation du token
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.Init');
fstrval = new();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.Init : End');

end method;

------------------------------------------------------------
method Token.SetAsRefined(input unRefiner: Framework.integer)
begin
--
--	Description : Positionnement du code affiné d'un token
--
--	Type :	concret
--
--	Parametres :   unRefiner : Code affiné
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.SetAsRefined');
Refiner = unRefiner;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.SetAsRefined : End');

end method;

------------------------------------------------------------
method Token.SetKind(input kind: Framework.integer)
begin
--
--	Description : Positionnement du type du token
--
--	Type :	concret
--
--	Parametres :   Kind : Le type du token
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.SetKind');
fkind = kind;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.SetKind : End');

end method;

------------------------------------------------------------
method Token.SetVal(input val: Framework.TextData)
begin
--
--	Description : Positionnement de la valeur chaîne du token
--
--	Type :	concret
--
--	Parametres :   Val : La valeur à positionner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.SetVal(TextData)');
fstrval = val;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.SetVal(TextData) : End');

end method;

------------------------------------------------------------
method Token.SetVal(input Val: Framework.DataValue)
begin
--
--	Description : Positionnement de la valeur chaîne du token
--
--	Type :	concret
--
--	Parametres :   Val : La valeur à positionner
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Token.SetVal(DataValue)');
fstrval = val;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Token.SetVal(DataValue) : End');

end method;

------------------------------------------------------------
method TokenFinPre.Init
begin
super.Init();
SetKind(TOK_PREEND);
SetVal('');
end method;

------------------------------------------------------------
method Tokenizer.AcceptChar(input laLigne: Framework.TextData,
	input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : on accepte et on conserve le caractère passé dans ThisChar (un seul caractère)
--
--	Type :	concret
--
--	Parametres :   ThisChar : Caractère à accepter
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	16/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AcceptChar');

unRes : boolean;

if laLigne.IsChar(ThisChar) then
   laLigne.CutRange(0,1);
   CurrToken.Concat(ThisChar);
   unRes = TRUE;
else 
   unRes = FALSE;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AcceptChar : End');

return unRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.AcceptChar');
		Raise;

end method;

------------------------------------------------------------
method Tokenizer.AddError(input uneExc: Framework.integer,
	input uneErreur: Framework.string)
begin
--
--	Description : Ajout d'une erreur d'analyse lexicale dans la liste des erreurs
--
--	Type :	concret
--
--	Parametres :   uneErreur : Libellé complet de l'erreur
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AddError');
unParser.AddError(uneExc,uneErreur,'');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AddError : End');

end method;

------------------------------------------------------------
method Tokenizer.AnchorPreEnd(input laTableTokens: Framework.Array of ParserClasses.Token,
	input AfterToken: ParserClasses.Token)
begin
--
--	Description : "Greffe" le symbole de fin de prétraitement après le token passé en paramètre
--
--	Type :	Concret
--
--	Parametres :   
--
--	laTableTokens : La liste de tokens sur laquelle effectuer la recherche
--	AfterToken	  : le token à rechercher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	20/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AnchorPreEnd');

-- Etape1 : Rechercher la position du token "fin de prétraitement" pour ne pas le retrouver
-- plusieurs fois dans la liste des tokens

unRangTFP : integer = laTableTokens.FindRowForObject(TokenFinPre);
unRangTP  : integer = laTableTokens.FindRowForObject(AfterToken);
if unRangTFP=0 then 
   AddError(ERR_TOK_FINPRE,'Token de fin de prétraitement non trouvé');
elseif unRangTP>unRangTFP then
   laTableTokens.DeleteRow(unRangTFP);	
   laTableTokens.InsertRow(unRangTP,TokenFinPre); -- Pas de décalage pour se positionner après car delete avant
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AnchorPreEnd : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.AnchorPreEnd');
		Raise;


end method;

------------------------------------------------------------
method Tokenizer.AppendPre(input unObjet: Framework.TextData,
	input uneCle: Framework.TextData)
begin
--
--	Description : Ajoute une directive de compilation
--
--	Type :	abstrait
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

-- suppression de la version HashTable pour gagner du temps
--PreProc.Enter(element = unObjet, key = uneCle.Value); 

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AppendPre');

PreProc.Append(uneCle=uneCle,uneValeur=unObjet);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AppendPre : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.AppendPre');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.AppendToken(input laTableTokens: Framework.Array of ParserClasses.Token,
	input unTypToken: Framework.integer,
	input uneChaine: Framework.TextData,
	input unRefiner: Framework.integer = -1): ParserClasses.Token
begin
--
--	Description : Création et ajout d'un token dans la liste 
--
--	Type :	concret
--
--	Parametres :    
--					laTableTokens : le tableau de tokens
--					unTypToken    : le type du token à créer
--					uneChaine     : la chaîne de caractère du token
--					unRefiner     : Code "affiné" du token
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	16/02/1998	|	Creation.
--	PMT	|	17/02/1998	|	Ajout du code "Refiner"
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AppendToken(uneChaine)');

unToken : Token = new();

/*
unToken.SetVal(uneChaine);
unToken.SetKind(unTypToken);
unToken.SetAsRefined(unRefiner);
*/

unToken.fstrval=uneChaine;
unToken.fkind=unTypToken;
unToken.Refiner = unRefiner;

laTableTokens.AppendRow(unToken);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AppendToken(uneChaine) : End');

return unToken;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.AppendRoken(uneChaine)');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.AppendToken(input laTableTokens: Framework.Array of ParserClasses.Token,
	input unTypToken: Framework.integer,
	input unDataValue: Framework.DataValue,
	input unRefiner: Framework.integer = -1): ParserClasses.Token
begin
--
--	Description : Création et ajout d'un token dans la liste 
--
--	Type :	concret
--
--	Parametres :    
--					laTableTokens : le tableau de tokens
--					unTypToken    : le type du token à créer
--					unDataValue   : la chaîne de caractère du token
--					unRefiner     : Code "affiné" du token
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/03/1998	|	Creation à partir de AppendToken(TextData)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.AppendToken(unDataValue)');

unToken : Token = new();
/*
unToken.SetVal(unDataValue);
unToken.SetKind(unTypToken);
unToken.SetAsRefined(unRefiner);
*/
unToken.fstrval=unDataValue;
unToken.fkind=unTypToken;
unToken.Refiner = unRefiner;


laTableTokens.AppendRow(unToken);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.AppendToken(unDataValue) : End');

return unToken;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.AppendToken(unDataValue)');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.ClearPres
begin
--
--	Description : Efface la liste des directives de compilation
--
--	Type :	Concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

PreProc.Clear();
end method;

------------------------------------------------------------
method Tokenizer.DoCanMergeToken(input TokenGauche: Framework.TextData,
	input TokenDroit: Framework.TextData): Framework.boolean
begin
--
--	Description : A surcharger. Demande d'autorisation de fusion de deux tokens
--
--	Type :	Abstrait
--
--	Parametres :   TokenGauche, TokenDroit : Tokens sous la forme de chaînes de caractères
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	26/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.DoCanMergeTokens');
unRes : boolean = FALSE;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.DoCanMergeTokens : End');
return unRes;
end method;

------------------------------------------------------------
method Tokenizer.DoGetStringChar: Framework.string
begin
return '';
end method;

------------------------------------------------------------
method Tokenizer.DoGetStringForm(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneChaine: Framework.TextData): ParserClasses.Token
begin
--
--	Description : Lecture d'une forme particulière de chaîne
--
--	Type :	concret
--
--	Parametres :  UneChaine : Chaîne à analyser
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.DoGetStringForm');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.DoGetStringForm : End');

return NIL;
end method;

------------------------------------------------------------
method Tokenizer.DoIsSeparator(input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le caractère dans ThisChar est un séparateur
--
--	Type :	concret
--
--	Parametres :  ThisChar : Caractère à tester
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.IsSeparator');
aRes : boolean = ThisChar.IsChar('');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.IsSeparator : End');
return aRes;
end method;

------------------------------------------------------------
method Tokenizer.DoIsStringChar(input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le caractère dans ThisChar est le caractère de définition d'une chaîne
--
--	Type :	concret
--
--	Parametres :  ThisChar : Caractère à tester
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	10/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.IsStringChar');
--unRes : boolean = ThisChar.IsChar(DoGetStringChar());
unRes : boolean = ThisChar.IsChar('');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.IsStringChar : End');
return unRes;

end method;

------------------------------------------------------------
method Tokenizer.DoRefineSeparator(input ThisChar: Framework.TextData): Framework.integer
begin
--
--	Description : Renvoie un code séparateur plus précis que TOK_SEPARATOR
--
--	Type :	abstrait
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.DoRefineSeparator');
unRefiner : integer = TOK_INVALID;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.DoRefineSeparator : End');

return unRefiner;

end method;

------------------------------------------------------------
method Tokenizer.DoUsePreprocessor: Framework.boolean
begin
--
--	Description : Méthode à surcharger pour autoriser ou interdire le préprocesseur
--
--	Type :	concret
--
--	Parametres :  Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	20/03/1998	|	Creation.
--+

return TRUE;

end method;

------------------------------------------------------------
method Tokenizer.FindToken(input leToken: ParserClasses.Token,
	input inList: Framework.Array of ParserClasses.Token): Framework.boolean
begin
--
--	Description : Recherche (par contenu) d'un token dans un tableau de tokens
--
--	Type :	Concret
--
--	Parametres :   
--					leToken   : Le token que l'on doit remplacer
--					inList    : Le tableau de tokens à examiner
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.FindToken');

Found : boolean = FALSE;
for i in inList do
  if i.GetVal().IsEqual(leToken.GetVal(),ignoreCase=TRUE) then
    Found = TRUE;
	exit;
  end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.FindToken : End');

return Found;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.FindToken');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.GetDecimalNumbersMapping: Framework.integer
begin
--
--	Description : Lecture du type d'attribution des nombres décimaux
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

return DecimalNumbersMapping;
end method;

------------------------------------------------------------
method Tokenizer.GetPre(input uneCle: Framework.TextData,
	input output unAssocItem: DataStructuresClasses.AssocItem): Framework.TextData
begin
--
--	Description : Essaye de trouver la directive correspondant à la clé
--
--	Type :	abstrait
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

--Suppression de la version HashTable
--return (TextData) (PreProc.Find(uneCle.Value));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.GetPre');

unRes   : AssocItem;
unTexte : TextData;

unRes = PreProc.FindByKey(uneCle);
unAssocItem = unRes;

if unRes<>NIL then
	unTexte = unRes.GetItem();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.GetPre : End');

return unTexte;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.GetPre');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.GetTokens: Framework.Array of ParserClasses.Token
begin
--
--	Description : Renvoie la liste des tokens trouvés
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.GetTokens');
ListeTokens : array of Token = tokens;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.GetTokens : End');
return ListeTokens;
end method;

------------------------------------------------------------
method Tokenizer.GetValToken(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token)
begin
--
--  Description : constitution d'un token sous la forme d'une valeur quelquonque.	
--
--	Type :	concret
--
--	Parametres :   laTableTokens : Tableau de tokens à utiliser
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.GetValToken');

laLigne.TrimLeading(); -- on se débarasse des blancs en début de ligne pour la prochaine itération
laLigne.Offset = 0;	
while not laLigne.IsAtEnd() and not DoIsSeparator(laLigne)  do laLigne.MoveNext(); end while;
if laLigne.Offset>0 then 
  Ligne : TextData = new();
  Ligne = laLigne.CopyRange(0,laLigne.Offset);
  AppendToken(laTableTokens,TOK_VAL,Ligne.Value);
  laLigne.CutRange(0,laLigne.Offset);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.GetValToken : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.GetValToken');
		Raise;
		
end method;

------------------------------------------------------------
method Tokenizer.Init
begin
--
--	Description : Création de la liste des tokens
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--	PMT	|	0?/06/1998	|	Ajout de la gestion des deux types de nombres réels (Double, Décimal)
--	PMT	|	11/06/1998	|	Petite optimisation : Utilisation d'une variable en remplacement de DoUsePreprocessor
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.Init');

flagFalse = new();
flagFalse.SetValue(FALSE);

flagTrue = new();
flagTrue.SetValue(TRUE);

super.Init();
tokens = new(); 
CurrToken=new();
TokenFinPre = new();
DecimalNumbersMapping = MAP_DECIMAL_TO_DOUBLE;
PerformPreProcessing = DoUsePreprocessor();
-- initialisation de la hash-table chargée de stocker les directives de compilations acceptées
PreProc = new();

-- suppression de la version HashTable
--strfunc : HashFuncs = new(keyType = SP_KT_STRING, ignoreCase=TRUE);
--PreProc.Setup(size = 10, functions = strfunc, uniqueKey = TRUE);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.Init : End');

end method;

------------------------------------------------------------
method Tokenizer.MapDecimalToDecimal
begin
--
--	Description : Attribution du type par défaut pour un nombre décimal
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.MapDecimalToDecimal');

DecimalNumbersMapping = MAP_DECIMAL_TO_DECIMAL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.MapDecimalToDecimal : End()');

end method;

------------------------------------------------------------
method Tokenizer.MapDecimalToDouble
begin
--
--	Description : Attribution du type par défaut pour un nombre décimal
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.MapDecimalToDouble');

DecimalNumbersMapping = MAP_DECIMAL_TO_DOUBLE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.MapDecimalToDouble : End()');

end method;

------------------------------------------------------------
method Tokenizer.Preprocess(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneValeurRempl: Framework.TextData)
begin
--
--	Description : Procède au prétraitement des tokens (au sens spécifique)
--
--	Type :	Concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.Preprocess');

LaDirective : AssocItem;
PreProc.ClearFlags();
laTableTokens.InsertRow(1,TokenFinPre);

NbRepl : integer;
Index    : integer = 1;
IndexPre : integer = 0;
for i in laTableTokens do

  if i.GetKind()=TOK_VAL then
  
	  GetPre(i.GetVal(),LaDirective);
	
	  -- le token correspond effectivement à un symbole préprocesseur
	  if LaDirective<>NIL then
	
	     uneValeurRempl.SetValue('('); -- Parenthésage obligatoire 
	     uneValeurRempl.Concat(LaDirective.GetItem());
	     uneValeurRempl.Concat(')');
		 
		 if (LaDirective.GetExtra()) = flagTrue then
		    AddError(ERR_SYM_CIRCULAIRE,'Référence circulaire');
		 end if;	
	
	     ParTokens : array of Token = new();
		 TokenizeLine(uneValeurRempl,ParTokens);
		 AnchorPreEnd(laTableTokens,i);
	     if ReplaceTokenWith(laTableTokens,i,ParTokens,NbRepl) then  -- Remplacement seulement à la fin, càd si pas d'exception ErreurSymCirculaire levée
	        IndexPre = IndexPre + NbRepl-1;
			Index    = Index +NbRepl-1;
	     end if;
	     LaDirective.SetExtra(FlagTrue); -- interdire cette directive tant que la fin du préprocessing n'est pas atteinte
	
	  end if;

  end if;
  
  -- détection du symbole de fin de préprocessing, remise à zéro des flags
  if i = TokenFinPre then 
     PreProc.ClearFlags();	
  end if;

  index = index + 1;
  
end for;

laTableTokens.DeleteRow(TokenFinPre);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.Preprocess : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.Preprocess');
		Raise;
		

end method;

------------------------------------------------------------
method Tokenizer.RaiseInternalError(input unErrorMsg: Framework.string)
begin
--
--	Description : Leve une exception interne
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Parser.RaiseInternalError');
uneException : InternalExc = new();
uneException.SetWithParams(severity = SP_ER_ERROR,Message=unErrorMsg);
Task.Part.LogMgr.PutLine(unErrorMsg);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Parser.RaiseInternalError : raise UneException =  : End');
raise UneException;
end method;

------------------------------------------------------------
method Tokenizer.ReadDigitList(input laLigne: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le caractère dans ThisChar est le caractère de définition d'une chaîne
--
--	Type :	concret
--
--	Parametres :  Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	16/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.ReadDigitList');

NbDigits = 0;
while laLigne.IsDigit() do
	 laLigne.MoveNext();
	 NbDigits = NbDigits + 1;
end while;

unRes : boolean;
if NbDigits = 0 then
   unRes =  FALSE;
else
   unRes =  TRUE;	
   CurrToken.Concat(laLigne.CutRange(0,NbDigits));
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.ReadDigitList : End');
return unRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.ReadDigitList');
		Raise;

end method;

------------------------------------------------------------
method Tokenizer.ReadNumeric(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean
begin
--
--	Description : Lecture d'un entier
--
--	Type :	concret
--
--	Parametres :  laTableTokens : tableau de tokens à utiliser
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	16/02/1998	|	Creation.
--	PMT	|	17/03/1998	|	Ne dépend plus d'un tableau de tokens particulier
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.ReadNumeric');

unRes	 : boolean = TRUE;
typToken : integer = TOK_INVALID;
NbDeci	 : integer;

CurrToken.SetValue('');
-- acquisition du signe si présent
if not SkipChar(LaLigne=LaLigne,ThisChar='+') then
   AcceptChar(LaLigne=laLigne,ThisChar='-'); 
end if; 

-- lecture des chiffres (partie mantisse)
if ReadDigitList(laLigne) then -- un entier pour l'instant
   
   if not AcceptChar(LaLigne=laLigne,ThisChar='.') 
   then TypToken = TOK_INTEGER; -- c'est bien un entier
   else 			  
		 case DecimalNumbersMapping is
		      when MAP_DECIMAL_TO_DOUBLE  do typToken = TOK_FLOAT;
		      when MAP_DECIMAL_TO_DECIMAL do typToken = TOK_DECIMAL;
		 else RaiseInternalError('Attribution de type décimal incorrecte');
		 end case;

         if not ReadDigitList(laLigne) 
         then TypToken = TOK_INVALID;
         else -- ok pour la partie décimale
		   NbDeci = NbDigits; -- Récupérer le nombre de décimales pour la conversion en DecimalData	
		   if LaLigne.IsChar('^') 
    	   then 
				typToken = TOK_FLOAT;
				CurrToken.Concat('E');
				LaLigne.CutRange(0,1);
			    if not SkipChar(LaLigne=laLigne,ThisChar='+') then -- lecture du signe de l'exposant
			       AcceptChar(LaLigne=laLigne,ThisChar='-');
			    end if;
    		    if not ReadDigitList(laLigne) then typToken = TOK_INVALID; end if;
           end if;
         end if; 		
   end if;
end if;

if typToken <> TOK_INVALID 
then 
   if typToken=TOK_DECIMAL 
    then AppendToken(laTableTokens,typToken,CurrToken.Value,unRefiner=NbDeci);
    else AppendToken(laTableTokens,typToken,CurrToken.Value);
   end if;
   unRes = TRUE;
else
   unRes = FALSE;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.ReadNumeric : End');
return unRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.ReadNumeric');
		Raise;

end method;

------------------------------------------------------------
method Tokenizer.ReadSeparator(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean
begin
--
--	Description : Lecture d'un séparateur
--
--	Type :	concret
--
--	Parametres :   laTableTokens : Ne dépend plus d'un tableau de tokens particulier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/02/1998	|	Creation.
--	PMT	|	17/03/1998	|	La méthode de dépend plus d'un tableau de tokens particulier
--+

unRes : boolean;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.ReadSeparator');

if not DoIsStringChar(laLigne) 
then 
	Chaine : TextData = laLigne.CutRange(0,1);
    AppendToken(laTableTokens,TOK_SEPARATOR,Chaine.Value,DoRefineSeparator(Chaine)); 
    unRes = TRUE;
else
    unRes = FALSE;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.ReadSeparator : End');
return unRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.ReadSeparator');
		Raise;


end method;

------------------------------------------------------------
method Tokenizer.ReadString(input laLigne: Framework.TextData,
	input laTableTokens: Framework.Array of ParserClasses.Token): Framework.boolean
begin
--
--	Description : Lecture d'une chaîne de caractères
--
--	Type :	concret
--
--	Parametres : laTableTokens : Ne dépend plus d'un tableau de tokens particulier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	10/02/1998	|	Creation.
--	PMT	|	12/05/1998	|	Correction du traitement de l'erreur 'Délimiteur de fin de chaîne non trouvé'
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.ReadString');

startpos : integer = 0;
endpos   : integer = 0;
CurrToken.SetValue('''');
FoundText:boolean = FALSE;

startpos = laLigne.Offset;
while not laLigne.IsAtEnd() and DoIsStringChar(laLigne) do
     laLigne.CutRange(0,1);
     if laLigne.MoveToChar(DoGetStringChar()) then
        laLigne.MoveNext();
		CurrToken.Concat(laLigne.CutRange(0,laLigne.Offset));
		FoundText = TRUE;
	 else
		laLigne.SetValue('');
	    FoundText = FALSE;
	    exit;
     end if;
end while;

-- Pour laisser la possibilité de donner un sens particulier aux chaînes de caractères
-- tout en conservant la propriété générique  de l'analyse de chaîne.

if FoundText then -- On a effectivement trouvé une chaîne de caractères

	Copie : TextData = new(Value=CurrToken.Value);
	unToken : Token = DoGetStringForm(laTableTokens,CurrToken);  -- On laisse la main à la classe dérivée
	CurrToken.SetValue(Copie);
	
	-- si la méthode DoGetStringForm de la classe dérivée renvoie NIL, c'est qu'elle ne
	-- sait pas lui donner de sens connu, donc on insère le token initialement trouvé càd
	-- une chaîne classique. Dans le cas inverse, la méthode DoGetStringForm doit déjà 
	-- avoir effectuée l'insertion du token qu'elle a trouvé.
	if unToken = NIL 
	then AppendToken(laTableTokens,TOK_STRING,CurrToken.Value);
	end if;

else -- Oops ...
	AddError(ERR_DELIMITEUR_CHAINE,'Délimiteur de fin de chaîne non trouvé');
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.ReadString : End');

return FoundText; -- pour un traitement d'erreur éventuel

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.ReadString');
		Raise;

end method;

------------------------------------------------------------
method Tokenizer.ReplaceTokenWith(input Origine: Framework.Array of ParserClasses.Token,
	input leToken: ParserClasses.Token,
	input ParTokens: Framework.Array of ParserClasses.Token,
	input output NbRepl: Framework.integer): Framework.boolean
begin
--
--	Description : Remplacement d'un token par un tableau de token
--
--	Type :	Concret
--
--	Parametres :   
--					Origine   : Le tableau de tokens sur lequel on va effectuer le remplacement
--					leToken   : Le token que l'on doit remplacer
--					ParTokens : Les tokens que l'on doit insérer
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.ReplaceTokenWith');

unRes : boolean = FALSE;
unRang : integer = Origine.FindRowForObject(leToken);
unRes = (unRang<>0) and (ParTokens<>NIL);
if unRes then
   
   -- recherche de pré-traitements récursifs 
/*
   Found : boolean = FindToken(leToken,ParTokens);
   for i in ParTokens do
      if i.GetVal().IsEqual(leToken.GetVal(),ignoreCase=TRUE) then
	      uneChaine : TextData = new(Value='Attention, des éléments lexicaux sont imbriqués : ');
		  uneChaine.Concat(leToken.GetVal());	
		  uneChaine.Concat('=');
		  unAssocItem : AssocItemFlag;	
		  uneChaine.Concat(GetDirective(leToken.GetVal(),unAssocItem));
		  AddError(ERR_SYM_CIRCULAIRE,uneChaine.Value);
          exit;
      end if;
   end for;
*/
  
   -- si pas d'exceptions ici, on peut continuer
   Origine.DeleteRow(unRang); -- Fonctionne aussi avec l'objet directement mais probablement plus lent
   for i in ParTokens do
	  Origine.InsertRow(unRang,i); -- Insertion un par un des objets avec incrémentation du rang
	  unRang = unRang + 1;
   end for;

   NbRepl = ParTokens.Items; -- Renvoyer le nombre d'éléments

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.ReplaceTokenWith : End');

return unRes;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.ReplaceTokenWith');
		Raise;
		

end method;

------------------------------------------------------------
method Tokenizer.SetParser(input aParser: ParserClasses.Parser)
begin
--
--	Description : Positionnement de la référence sur le parseur
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	26/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.SetParser');
unParser = aParser;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.SetParser : End');

end method;

------------------------------------------------------------
method Tokenizer.SkipChar(input laLigne: Framework.TextData,
	input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : passer un caractère car accepté par le langage 
--                mais inutile de le conserver
--
--	Type :	concret
--
--	Parametres : Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	16/02/1998	|	Creation.
--+

unRes : boolean;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.SkipChar');
if laLigne.IsChar(ThisChar) then
   laLigne.CutRange(0,1);
   unRes = TRUE;
else
   unRes = FALSE;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.SkipChar : End');
return unRes;
end method;

------------------------------------------------------------
method Tokenizer.TokenizeLine(input output laLigne: Framework.TextData,
	input TableTokens: Framework.Array of ParserClasses.Token)
begin
--
--	Description : Sépare la ligne en cours en tokens et l'ajoute aux tokens
--  déjà créés.
--
--	Type :	concret
--
--	Parametres :   laLigne : Ligne en cours 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--	PMT	|	10/02/1998	|	Lecture du type chaîne
--	PMT	|	16/02/1998	|	Lecture du type entier et flottant (numérique)
--	PMT	|	13/03/1998	|	Ajout du préprocesseur
--	PMT	|	17/03/1998	|	Supression préprocesseur de ligne 
--	PMT	|	17/03/1998	|	La méthode ne dépend plus d'un tableau de tokens particulier
--	PMT	|	12/05/1998	|	Filtrage de types de caractères autorisés
--+

-- Pour l'instant, la méthode ne sait pas distinguer la présence de mots réservés ou de types
-- car leur gestion est hébergée dans la partie analyseur syntaxique.
--
-- Il faudrait pour cela créer des méthodes appelant ces services dans l'analyseur syntaxique
-- en s'assurant de l'initialisation correcte de ces services. 
-- ou redescendre ces services dans un objet Compiler.

-- on se débarasse des blancs en début et fin de ligne
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.TokenizeLine');

self.TrimLine(laLigne); 
laLigne.Offset = 0;
while laLigne.ActualSize>0 do

--   if laLigne.IsChar(CHARSET) then
   	
	   -- PreprocessLine(laLigne);
	   if     DoIsStringChar(laLigne) then	ReadString(laLigne,TableTokens);    -- est-ce une chaîne ?
	   elseif laLigne.IsDigit() 	then	ReadNumeric(laLigne,TableTokens);   -- est-ce une valeur numérique ?
	   elseif DoIsSeparator(laLigne)  then	ReadSeparator(laLigne,TableTokens); -- lecture d'un séparateur sur un caractère
	   else   GetValToken(laLigne,TableTokens);
	   end if;
	   while laLigne.IsChar(' ') do laLigne.CutRange(laLigne.Offset,laLigne.Offset+1);	end while;

--   else 

--	   unMessage : TextData = new(Value='Détection d''un caractère interdit : ');
--	   unMessage.Concat(laLigne.CopyRange(0,1));	
--     AddError(ERR_CARACTERE_INTERDIT,unMessage.Value);

--   end if;

end while;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.TokenizeLine : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.TokenizeLine');
		Raise;
		

end method;

------------------------------------------------------------
method Tokenizer.TokenizeSource(input Code: Framework.Array of Framework.TextData)
begin
--
--	Description : Séparation de chaque ligne du source en tokens
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.TokenizeSource');

uneValeurRempl : TextData = new();

tokens.clear();
for i in Code do
  LigneCode = i;

  -- Contrôle de la présence de caractères autorisés uniquement
  if LigneCode.MoveToNotChar(CHARSET) then

		unMessage : TextData = new(Value='Détection d''un caractère interdit : ');
		unMessage.Concat('[position: ');
		unMessage.Concat(LigneCode.Offset);
		unMessage.Concat('] [Caractère : ');
		unMessage.Concat(LigneCode.CopyRange(LigneCode.Offset,LigneCode.Offset+1));	
		unMessage.Concat(']');
		AddError(ERR_CARACTERE_INTERDIT,unMessage.Value);

  end if;

  self.TokenizeLine(LigneCode,tokens);

end for;

if PerformPreProcessing=TRUE then 
   Preprocess(tokens,uneValeurRempl); -- appel d'une éventuelle phase de prétraitement
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.TokenizeSource : End');

return; 

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.TokenizeSource');
		Raise;
		

end method;

------------------------------------------------------------
method Tokenizer.TrimLine(input Code: Framework.TextData): Framework.TextData
begin
--
--	Description : Suppression des blancs inutiles
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.TrimLine');
Code.TrimTrailing(); -- suppression des blancs en fin de ligne	
Code.TrimLeading();  -- suppression des blancs en début de ligne
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.TrimLine : End');
return Code; 

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Tokenizer.TrimLine');
		Raise;

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'parsercl';


end ParserClasses;
begin TOOL ContexteClt;

includes ContexteSrv;
includes DataAccessSrvBD;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  Contexte;
forward  Variable;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 20;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class Contexte inherits from DataAccessSrvBD.ServiceDesc

has public  attribute ContexteService: Framework.ClassType;
has public  attribute ContexteServiceMgr: DataAccessSrvBD.ServiceMgrDesc;
has public  attribute Valeurs: Framework.Array of Framework.DataValue;
has public  attribute Variables: Framework.Array of ContexteClt.Variable;
has private attribute VariablesADeterminer: Framework.Array of Framework.IntegerData;
has private attribute VariablesUtilisees: Framework.Array of Framework.IntegerData;

has private method Evalue;
has public  method Evalue(input IndicesDesVariables: Framework.Array of Framework.IntegerData);
has public  method Evalue(input IndiceDeLaVariable: Framework.integer);
has public  method GetVariablesUtilisees: copy Framework.Array of Framework.IntegerData;
has public  method Init;
has public  method Initialise;
has public  method ResetVariablesUtilisees;
has public  method Transfert: Framework.Array of Framework.DataValue;
has public  method Variable(input Nom: Framework.TextData): Framework.DataValue;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class Variable inherits from Framework.Object

has public  attribute Nom: Framework.string;
has public  attribute Valeur: Framework.DataValue;
has public  attribute ValeurConnue: Framework.boolean;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method Contexte.Evalue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Evalue');

Valeurs : Array of DataValue = self.Transfert();
if Valeurs <> NIL then
	self.Valeurs = Valeurs;
	Variable : ContexteClt.Variable;
	Valeur : DataValue;
	for Indice in self.VariablesADeterminer do
		Valeur = self.Valeurs[Indice.Value];
		if Valeur <> NIL then
			Variable = self.Variables[Indice.Value];
			if Variable <> NIL and Variable.ValeurConnue = FALSE then
				Variable.Valeur.SetValue(Valeur);
				Variable.ValeurConnue = TRUE;
			end if;
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Evalue : End');

end method;

------------------------------------------------------------
method Contexte.Evalue(input IndicesDesVariables: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input IndicesDesVariables : Array of Framework.IntegerData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Evalue');

Variable : ContexteClt.Variable;
if IndicesDesVariables <> NIL then
	self.VariablesADeterminer.Clear();
	for Indice in IndicesDesVariables do
		Variable = self.Variables[Indice.Value];
		if Variable <> NIL and Variable.ValeurConnue = FALSE then
			Valeur : DataValue = self.Valeurs[Indice.Value];
			if Valeur = NIL then
				self.VariablesADeterminer.AppendRow(Indice);
			else
				Variable.Valeur.SetValue(Valeur);
				Variable.ValeurConnue = TRUE;
			end if;
		end if;
	end for;
	if self.VariablesADeterminer.Items > 0 then
		self.Evalue();
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Evalue : End');

end method;

------------------------------------------------------------
method Contexte.Evalue(input IndiceDeLaVariable: Framework.integer)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input IndiceDeLaVariable : integer
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Evalue');

Variable : ContexteClt.Variable = self.Variables[IndiceDeLaVariable];
if Variable <> NIL and Variable.ValeurConnue = FALSE then
	Valeur : DataValue = self.Valeurs[IndiceDeLaVariable];
	if Valeur = NIL then
		self.VariablesADeterminer.Clear();
		self.VariablesADeterminer.AppendRow(IntegerData(Value=IndiceDeLaVariable));
		self.Evalue();
	else
		Variable.Valeur.SetValue(Valeur);
		Variable.ValeurConnue = TRUE;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Evalue : End');

end method;

------------------------------------------------------------
method Contexte.GetVariablesUtilisees: copy Framework.Array of Framework.IntegerData
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.GetVariablesUtilisees');

VariablesUtilisees : Array of IntegerData = NIL;
if self.VariablesUtilisees.Items > 0 then
	VariablesUtilisees = self.VariablesUtilisees;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.GetVariablesUtilisees : End');

return VariablesUtilisees;
end method;

------------------------------------------------------------
method Contexte.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Init');

super.Init();
self.InitService();
self.Variables = new();
self.VariablesADeterminer = new();
self.VariablesUtilisees = new();
self.Valeurs = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Init : End');

end method;

------------------------------------------------------------
method Contexte.Initialise
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Initialise');

for Variable in self.Variables do
	if Variable <> NIL then
		Variable.ValeurConnue = FALSE;
	end if;
end for;
self.Valeurs.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Initialise : End');

end method;

------------------------------------------------------------
method Contexte.ResetVariablesUtilisees
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.ResetVariablesUtilisees');

self.VariablesUtilisees.Clear();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.ResetVariablesUtilisees : End');

end method;

------------------------------------------------------------
method Contexte.Transfert: Framework.Array of Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Transfert');

Valeurs : Array of DataValue;
aTransData : TransDesc = new();
aTransData.TransActionService = ACT_CTX_EVAL;
aTransData.TransObject = ContexteParam(
	VariablesADeterminer = self.VariablesADeterminer,
	Valeurs = self.Valeurs);
Valeurs = (Array of DataValue) (self.Transfer(aTransData, self.ContexteServiceMgr, self.ContexteService));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Transfert : End');

return Valeurs;
end method;

------------------------------------------------------------
method Contexte.Variable(input Nom: Framework.TextData): Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Nom : TextData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Contexte.Variable');

Valeur : DataValue = NIL;
for Variable in self.Variables do
	if Variable <> NIL and Nom.IsEqual(Variable.Nom, TRUE) then
		Valeur = Variable.Valeur;
		Indice : integer = self.Variables.FindRowForObject(Variable);
		VariableDejaUtilisee : Boolean = FALSE;
		for unIndice in VariablesUtilisees do
			if unIndice.Value = Indice then
				VariableDejaUtilisee = TRUE;
				exit;
			end if;
		end for;
		if not VariableDejaUtilisee then
			self.VariablesUtilisees.AppendRow(IntegerData(Value=Indice));
		end if;
		exit;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Contexte.Variable : End');

return Valeur;
end method;

------------------------------------------------------------
method Variable.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Variable.Init');

super.Init();
self.ValeurConnue = FALSE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Variable.Init : End');

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'contexte';


end ContexteClt;
begin TOOL ContexteTarificat;

includes AddDicoBD;
includes AddFrameworkBD;
includes ContexteClt;
includes ContexteSrv;
includes DataAccessSrvBD;
includes DicoBD;
includes GenericDBMS;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ContexteTarification;
forward  ContexteTarificationBS;
forward  ContexteTarificationBSMgr;
forward  ContexteTarificationDesc;
forward  ContexteTarificationDS;
forward  ContexteTarificationDSMgr;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant CTX_TARIF_AGE = 1;
constant CTX_TARIF_CATEGORIE = 2;
constant CTX_TARIF_CODECATEGORIE = 12;
constant CTX_TARIF_CODEDEVISE = 15;
constant CTX_TARIF_CODEOPERATION = 13;
constant CTX_TARIF_CODEPACKAGE = 15;
constant CTX_TARIF_CODEPRODUIT = 8;
constant CTX_TARIF_CODEPROMOTION = 14;
constant CTX_TARIF_DEVISE = 3;
constant CTX_TARIF_NUMCLIENT = 4;
constant CTX_TARIF_OPERATION = 9;
constant CTX_TARIF_PACKAGE = 10;
constant CTX_TARIF_PRIX = 5;
constant CTX_TARIF_PRIXPUBLICBLN = 11;
constant CTX_TARIF_PROMOTION = 7;
constant CTX_TARIF_REQ = 1;
constant CTX_TEST_BONCLIENT = 16;
constant LOG_GRPFLAG = 20;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ContexteTarification inherits from ContexteClt.Contexte

has public  attribute Age: Framework.IntegerData;
has public  attribute BonClient: Framework.BooleanData;
has public  attribute Categorie: Framework.TextData;
has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute Devise: Framework.TextData;
has public  attribute NumClient: Framework.TextData;
has public  attribute Prix: Framework.DecimalData;
has public  attribute PrixPublicBln: Framework.IntegerData;

has public  method DoInitService;
has public  method Init;
has public  method Initialise(input NumClient: Framework.IntegerData = NIL,
	input CodeDevise: DicoBD.RefDeviseDesc = NIL,
	input CodeCategorie: DicoBD.RefTarifDesc = NIL,
	input CodeService: AddDicoBD.RefTypeServiceDesc = NIL,
	input CodeProduit: DicoBD.RefTypeProduitDesc = NIL,
	input CodePackage: AddDicoBD.RefTypePackageDesc = NIL,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc = NIL);
has public  method Transfert: Framework.Array of Framework.DataValue;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteTarificationBS inherits from ContexteSrv.ContexteBS

has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteTarificationBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteTarificationDesc inherits from ContexteSrv.ContexteDesc

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ContexteTarificationDS inherits from ContexteSrv.ContexteDS

has public  method Determine(input Requete: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue);
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ContexteTarificationDSMgr inherits from DataAccessSrvBD.DataServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soContexteTarificationBSMgr : ContexteTarificat.ContexteTarificationBSMgr = (DialogDuration = MESSAGE,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '8A137900-B2AF-11D1-8791-4363DDE8AA77');
service soContexteTarificationDSMgr : ContexteTarificat.ContexteTarificationDSMgr = (DialogDuration = MESSAGE,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'C037CEE0-B2AF-11D1-8791-4363DDE8AA77');
service soDefaultDBSession : GenericDBMS.DBSession = (DialogDuration = SESSION,
	Visibility = environment,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '2CF1CCF0-B357-11D1-BA39-E25B49EEAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ContexteTarification.DoInitService
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarification.DoInitService');

self.ContexteService = ContexteTarificationBS;
self.ContexteServiceMgr = soContexteTarificationBSMgr;
self.Dependances.AppendRow(self.ContexteServiceMgr);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarification.DoInitService : End');

end method;

------------------------------------------------------------
method ContexteTarification.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PMT   |   15/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarification.Init');

super.Init();

-- Initialisation des attributs
Age = new();
Categorie = new();
Devise = new();
Prix = new();
BonClient = new();

CodeCategorie = new();
CodeProduit = new();
CodeService = new();
CodePackage = new();
CodePromotion = new();
PrixPublicBln = new();
CodeDevise = new();

NumClient = new();

-- Initialisation des variables gérées par le contexte
Variable : ContexteClt.Variable;

Variable = new(Nom = 'BonClient', Valeur = BonClient);
self.Variables[CTX_TEST_BONCLIENT] = Variable;

Variable = new(Nom = 'Age', Valeur = Age);
self.Variables[CTX_TARIF_AGE] = Variable;

Variable = new(Nom = 'Categorie', Valeur = Categorie);
self.Variables[CTX_TARIF_CATEGORIE] = Variable;

Variable = new(Nom = 'Devise', Valeur = Devise);
self.Variables[CTX_TARIF_DEVISE] = Variable;

Variable = new(Nom = 'Prix', Valeur = Prix);
self.Variables[CTX_TARIF_PRIX] = Variable;

Variable = new(Nom = 'CodeProduit', Valeur = CodeProduit);
self.Variables[CTX_TARIF_CODEPRODUIT] = Variable;

Variable = new(Nom = 'CodeCategorie', Valeur = CodeCategorie);
self.Variables[CTX_TARIF_CODECATEGORIE] = Variable;

Variable = new(Nom = 'CodeService', Valeur = CodeService);
self.Variables[CTX_TARIF_CODEOPERATION] = Variable;

Variable = new(Nom='CodePackage', Valeur = CodePackage);
self.Variables[CTX_TARIF_CODEPACKAGE] = Variable;

Variable = new(Nom='PrixPublicBln', Valeur = PrixPublicBln);
self.Variables[CTX_TARIF_PRIXPUBLICBLN] = Variable;



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarification.Init : End');

end method;

------------------------------------------------------------
method ContexteTarification.Initialise(input NumClient: Framework.IntegerData = NIL,
	input CodeDevise: DicoBD.RefDeviseDesc = NIL,
	input CodeCategorie: DicoBD.RefTarifDesc = NIL,
	input CodeService: AddDicoBD.RefTypeServiceDesc = NIL,
	input CodeProduit: DicoBD.RefTypeProduitDesc = NIL,
	input CodePackage: AddDicoBD.RefTypePackageDesc = NIL,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc = NIL)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input NumClient : IntegerData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarification.Initialise');

super.Initialise();

self.NumClient.SetValue(NumClient);
self.Valeurs[CTX_TARIF_NUMCLIENT] = NumClient;

self.CodeCategorie.SetValue(CodeCategorie);
self.Valeurs[CTX_TARIF_CATEGORIE] = CodeCategorie;

self.CodeDevise.SetValue(CodeDevise);
self.Valeurs[CTX_TARIF_CODEDEVISE] = CodeDevise;

self.CodeService.SetValue(CodeService);
self.Valeurs[CTX_TARIF_OPERATION] = CodeService;

self.CodeProduit.SetValue(CodeProduit);
self.Valeurs[CTX_TARIF_CODEPRODUIT] = CodeProduit;

self.CodePackage.SetValue(CodePackage);
self.Valeurs[CTX_TARIF_CODEPACKAGE] = CodePackage;

self.CodePromotion.SetValue(CodePromotion);
self.Valeurs[CTX_TARIF_CODEPROMOTION] = CodePromotion;

--self.PrixPublicBln.SetValue(PrixPublicBln);
--self.Valeurs[CTX_TARIF_PRIXPUBLICBLN] = PrixPublicBln;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarification.Initialise : End');

end method;

------------------------------------------------------------
method ContexteTarification.Transfert: Framework.Array of Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarification.Transfert');

Valeurs : Array of DataValue;

if self.ContexteServiceMgr <> NIL and self.ContexteService <> NIL then
	Valeurs = super.Transfert();
else
	Valeurs = new();
	Valeurs[CTX_TEST_BONCLIENT] = BooleanData(Value=TRUE);
	Valeurs[CTX_TARIF_AGE] = IntegerData(Value = 18);
	Valeurs[CTX_TARIF_CATEGORIE] = TextData(Value = 'VIP');
	Valeurs[CTX_TARIF_DEVISE] = TextData(Value = 'FF');
	Valeurs[CTX_TARIF_PRIX] = DecimalData(Value = 400);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarification.Transfert : End');

return Valeurs;
end method;

------------------------------------------------------------
method ContexteTarificationBS.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationBS.Init');

super.Init();
self.ContexteDesc = ContexteTarificationDesc();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationBS.Init : End');

end method;

------------------------------------------------------------
method ContexteTarificationBSMgr.DoAfterSyncServices
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationBSMgr.DoAfterSyncServices');

self.AppendRow(ContexteTarificationBS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationBSMgr.DoAfterSyncServices : End');

end method;

------------------------------------------------------------
method ContexteTarificationBSMgr.DoInitService
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationBSMgr.DoInitService');

self.Dependances.AppendRow(soContexteTarificationDSMgr);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationBSMgr.DoInitService : End');

end method;

------------------------------------------------------------
method ContexteTarificationBSMgr.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationBSMgr.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationBSMgr.Init : End');

end method;

------------------------------------------------------------
method ContexteTarificationDesc.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDesc.Init');

super.Init();

-- Le service auquel on delegue l'acces aux donnees
ContexteService = ContexteTarificationDS;
ContexteServiceMgr = soContexteTarificationDSMgr;

-- La definition des requetes :
--    Une requete peut etre un calcul (CalculDesc) ou une requete (RequeteDesc)
--    Liste des variables nécessaires a leur execution
self.Requetes[CTX_TARIF_REQ] = RequeteDesc();
self.Requetes[CTX_TARIF_REQ].Dependances = new();
self.Requetes[CTX_TARIF_REQ].Dependances.AppendRow(IntegerData(Value = CTX_TARIF_NUMCLIENT));

-- La definition des variables :
--    Id de la requete permettant d'obtenir leur valeur
self.Variables[CTX_TEST_BONCLIENT] = IntegerData(Value = CTX_TARIF_REQ);
self.Variables[CTX_TARIF_AGE] = IntegerData(Value = CTX_TARIF_REQ);
self.Variables[CTX_TARIF_CATEGORIE] = IntegerData(Value = CTX_TARIF_REQ);
self.Variables[CTX_TARIF_DEVISE] = IntegerData(Value = CTX_TARIF_REQ);
self.Variables[CTX_TARIF_PRIX] = IntegerData(Value = CTX_TARIF_REQ);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDesc.Init : End');

end method;

------------------------------------------------------------
method ContexteTarificationDS.Determine(input Requete: Framework.integer,
	input Valeurs: Framework.Array of Framework.DataValue)
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Requete : integer
--               input Valeurs : Array of Framework.DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDS.Determine');

case Requete is
	when CTX_TARIF_REQ do
		NumClient : DataValue = Valeurs[CTX_TARIF_NUMCLIENT];
		if NumClient <> NIL then
			BonClient : BooleanNullable= new();
			Age : IntegerNullable = new();
--			Categorie : TextNullable = new();
--			Devise : TextNullable = new();
			Categorie : IntegerNullable = new();
			Devise : IntegerNullable = new();
			Prix : DecimalNullable = new();
			begin independent transaction
				sql select BonClient, Age, Categorie, Devise, Prix
					into :BonClient, :Age, :Categorie, :Devise, :Prix
					from Contexte
					where NumClient = :NumClient
					on session self.DBSession;
			end transaction;
			Valeurs[CTX_TEST_BONCLIENT] = BonClient;
			Valeurs[CTX_TARIF_AGE] = Age;
			Valeurs[CTX_TARIF_CATEGORIE] = Categorie;
			Valeurs[CTX_TARIF_DEVISE] = Devise;
			Valeurs[CTX_TARIF_PRIX] = Prix;
		else
			Valeurs[CTX_TEST_BONCLIENT] = BooleanData(Value=TRUE);
			Valeurs[CTX_TARIF_AGE] = IntegerData(Value = 18);
			Valeurs[CTX_TARIF_CATEGORIE] = IntegerData(Value = 3); -- VIP
			Valeurs[CTX_TARIF_DEVISE] = IntegerData(Value = 1); -- FF
			Valeurs[CTX_TARIF_PRIX] = DecimalData(Value = 400);
		end if;
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDS.Determine : End');

end method;

------------------------------------------------------------
method ContexteTarificationDS.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDS.Init');

super.Init();
self.ContexteDesc = ContexteTarificationDesc();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDS.Init : End');

end method;

------------------------------------------------------------
method ContexteTarificationDSMgr.DoAfterSyncServices
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDSMgr.DoAfterSyncServices');

/* self.AppendRow(ContexteTarificationDS); OBSOLETE */

unContexteTarificationDS : ContexteTarificationDS = new(DBSession = soDefaultDBSession);
self.AppendRow(ContexteTarificationDS, unContexteTarificationDS);


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDSMgr.DoAfterSyncServices : End');

end method;

------------------------------------------------------------
method ContexteTarificationDSMgr.DoInitService
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDSMgr.DoInitService');

self.Dependances.AppendRow(soDefaultDBSession);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDSMgr.DoInitService : End');

end method;

------------------------------------------------------------
method ContexteTarificationDSMgr.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ContexteTarificationDSMgr.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ContexteTarificationDSMgr.Init : End');

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'contexte';


end ContexteTarificat;
begin TOOL ExpressionClasses;

includes ContexteClt;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  Arrondi;
forward  ArrondiInf;
forward  ArrondiSup;
forward  Constante;
forward  Constructeur;
forward  Different;
forward  Divise;
forward  Egal;
forward  Et;
forward  Expression;
forward  Inferieur;
forward  InferieurOuEgal;
forward  Max;
forward  Min;
forward  Moins;
forward  MoinsUnaire;
forward  Multiplie;
forward  Operation;
forward  OperationArithmetique;
forward  OperationBinaire;
forward  OperationDeComparaison;
forward  OperationLogique;
forward  OperationUnaire;
forward  Ou;
forward  Pas;
forward  Plus;
forward  PlusUnaire;
forward  Superieur;
forward  SuperieurOuEgal;
forward  Variable;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 21;
constant TYPE_BOOLEEN = 1;
constant TYPE_CHAINE = 5;
constant TYPE_DATE = 6;
constant TYPE_DECIMAL = 3;
constant TYPE_DUREE = 7;
constant TYPE_ENTIER = 2;
constant TYPE_INCONNU = 0;
constant TYPE_NUMERIQUE = 4;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class Expression inherits from Framework.Object

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Operation inherits from ExpressionClasses.Expression

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class OperationBinaire inherits from ExpressionClasses.Operation

has public  attribute Operande1: ExpressionClasses.Expression;
has public  attribute Operande2: ExpressionClasses.Expression;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class OperationArithmetique inherits from ExpressionClasses.OperationBinaire

has public  attribute Valeur: Framework.DataValue;

has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Arrondi inherits from ExpressionClasses.OperationArithmetique

has public  attribute Deux: Framework.NumericData;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ArrondiInf inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ArrondiSup inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Constante inherits from ExpressionClasses.Expression

has public  attribute Type: Framework.integer;
has public  attribute Valeur: Framework.DataValue;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Constructeur inherits from Framework.Object

has public  attribute Contexte: ContexteClt.Contexte;
has private attribute Variables: Framework.Array of ExpressionClasses.Variable;

has public  method Arrondi(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Arrondi;
has public  method ArrondiInf(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.ArrondiInf;
has public  method ArrondiSup(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.ArrondiSup;
has public  method Constante(input Valeur: Framework.boolean): ExpressionClasses.Constante;
has public  method Constante(input Valeur: Framework.integer): ExpressionClasses.Constante;
has public  method Constante(input Valeur: Framework.double): ExpressionClasses.Constante;
has public  method Constante(input Valeur: Framework.string): ExpressionClasses.Constante;
has public  method Constante(input Valeur: Framework.DataValue): ExpressionClasses.Constante;
has public  method Different(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Different;
has public  method Divise(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Divise;
has public  method Egal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Egal;
has public  method Et(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Et;
has public  method Inferieur(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Inferieur;
has public  method InferieurOuEgal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.InferieurOuEgal;
has public  method Init;
has public  method Max(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Max;
has public  method Min(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Min;
has public  method Moins(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Moins;
has public  method MoinsUnaire(input Operande: ExpressionClasses.Expression): ExpressionClasses.MoinsUnaire;
has public  method Multiplie(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Multiplie;
has public  method Ou(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Ou;
has public  method Pas(input Operande: ExpressionClasses.Expression): ExpressionClasses.Expression;
has public  method Plus(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Plus;
has public  method PlusUnaire(input Operande: ExpressionClasses.Expression): ExpressionClasses.PlusUnaire;
has public  method Superieur(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Superieur;
has public  method SuperieurOuEgal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.SuperieurOuEgal;
has public  method Variable(input Nom: Framework.TextData): ExpressionClasses.Variable;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class OperationDeComparaison inherits from ExpressionClasses.OperationBinaire

has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Different inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Divise inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Egal inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class OperationLogique inherits from ExpressionClasses.OperationBinaire

has public  attribute Valeur: Framework.BooleanData;

has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Et inherits from ExpressionClasses.OperationLogique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Inferieur inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InferieurOuEgal inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Max inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Min inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Moins inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class OperationUnaire inherits from ExpressionClasses.Operation

has public  attribute Operande: ExpressionClasses.Expression;

has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class MoinsUnaire inherits from ExpressionClasses.OperationUnaire

has public  attribute Valeur: Framework.NumericData;
has private attribute Zero: Framework.NumericData;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Multiplie inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Ou inherits from ExpressionClasses.OperationLogique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Pas inherits from ExpressionClasses.OperationUnaire

has public  attribute Valeur: Framework.BooleanData;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Plus inherits from ExpressionClasses.OperationArithmetique

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class PlusUnaire inherits from ExpressionClasses.OperationUnaire

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Superieur inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class SuperieurOuEgal inherits from ExpressionClasses.OperationDeComparaison

has public  method Evalue: Framework.DataValue;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Variable inherits from ExpressionClasses.Expression

has public  attribute Nom: Framework.string;
has public  attribute Type: Framework.integer;
has public  attribute Valeur: Framework.DataValue;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method Arrondi.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   24/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Arrondi.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
			(DecimalData)(self.Valeur).Divide((DecimalData)(Valeur2), (DecimalData)(self.Deux));
			(DecimalData)(self.Valeur).Add((DecimalData)(self.Valeur), (DecimalData)(Valeur1));
			(DecimalData)(self.Valeur).Divide((DecimalData)(self.Valeur), (DecimalData)(Valeur2));
			(DecimalData)(self.Valeur).SetValue((DecimalData)(self.Valeur).IntegerValue);
			(DecimalData)(self.Valeur).Multiply((DecimalData)(self.Valeur), (DecimalData)(Valeur2));
		else
			(NumericData)(self.Valeur).Divide(Valeur2, self.Deux);
			(NumericData)(self.Valeur).Add((NumericData)(self.Valeur), Valeur1);
			(NumericData)(self.Valeur).Divide((NumericData)(self.Valeur), Valeur2);
			(NumericData)(self.Valeur).SetValue((NumericData)(self.Valeur).IntegerValue);
			(NumericData)(self.Valeur).Multiply((NumericData)(self.Valeur), Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Arrondi.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Arrondi.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   24/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Arrondi.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Arrondi.Init : End');

end method;

------------------------------------------------------------
method Arrondi.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   24/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Arrondi.VerifieType');

Type : integer = super.VerifieType();
if self.Deux = NIL then
	case Type is
		when TYPE_ENTIER do
			self.Deux = IntegerData(Value = 2);
		when TYPE_DECIMAL do
			self.Deux = DecimalData(Value = 2);
		when TYPE_NUMERIQUE do
			self.Deux = DoubleData(Value = 2);
	end case;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Arrondi.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method ArrondiInf.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ArrondiInf.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
			(DecimalData)(self.Valeur).Divide((DecimalData)(Valeur1), (DecimalData)(Valeur2));
			(DecimalData)(self.Valeur).SetValue((DecimalData)(self.Valeur).IntegerValue);
			(DecimalData)(self.Valeur).Multiply((DecimalData)(self.Valeur), (DecimalData)(Valeur2));
		else
			(NumericData)(self.Valeur).Divide(Valeur1, Valeur2);
			(NumericData)(self.Valeur).SetValue((NumericData)(self.Valeur).IntegerValue);
			(NumericData)(self.Valeur).Multiply((NumericData)(self.Valeur), Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ArrondiInf.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method ArrondiInf.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ArrondiInf.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ArrondiInf.Init : End');

end method;

------------------------------------------------------------
method ArrondiSup.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ArrondiSup.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
			(DecimalData)(self.Valeur).Divide((DecimalData)(Valeur1), (DecimalData)(Valeur2));
			(DecimalData)(self.Valeur).SetValue((DecimalData)(self.Valeur).IntegerValue + 1);
			(DecimalData)(self.Valeur).Multiply((DecimalData)(self.Valeur), (DecimalData)(Valeur2));
		else
			(NumericData)(self.Valeur).Divide(Valeur1, Valeur2);
			(NumericData)(self.Valeur).SetValue((NumericData)(self.Valeur).IntegerValue + 1);
			(NumericData)(self.Valeur).Multiply((NumericData)(self.Valeur), Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ArrondiSup.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method ArrondiSup.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ArrondiSup.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ArrondiSup.Init : End');

end method;

------------------------------------------------------------
method Constante.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constante.Evalue');

Valeur : DataValue = self.Valeur;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constante.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Constante.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constante.Init');

super.Init();
self.Type = TYPE_INCONNU;
self.Valeur = NIL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constante.Init : End');

end method;

------------------------------------------------------------
method Constante.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constante.VerifieType');

Type : integer = self.Type;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constante.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method Constructeur.Arrondi(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Arrondi
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   24/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Arrondi');

Arrondi : ExpressionClasses.Arrondi = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Arrondi : End');

return Arrondi;
end method;

------------------------------------------------------------
method Constructeur.ArrondiInf(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.ArrondiInf
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.ArrondiInf');

ArrondiInf : ExpressionClasses.ArrondiInf = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.ArrondiInf : End');

return ArrondiInf;
end method;

------------------------------------------------------------
method Constructeur.ArrondiSup(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.ArrondiSup
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.ArrondiSup');

ArrondiSup : ExpressionClasses.ArrondiSup = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.ArrondiSup : End');

return ArrondiSup;
end method;

------------------------------------------------------------
method Constructeur.Constante(input Valeur: Framework.boolean): ExpressionClasses.Constante
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Valeur : boolean
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Constante');

uneConstante : ExpressionClasses.Constante = new();
uneConstante.Type = TYPE_BOOLEEN;
uneConstante.Valeur = BooleanData(Value = Valeur);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Constante : End');

return uneConstante;
end method;

------------------------------------------------------------
method Constructeur.Constante(input Valeur: Framework.integer): ExpressionClasses.Constante
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Valeur : integer
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Constante');

uneConstante : ExpressionClasses.Constante = new();
uneConstante.Type = TYPE_ENTIER;
uneConstante.Valeur = IntegerData(Value = Valeur);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Constante : End');

return uneConstante;
end method;

------------------------------------------------------------
method Constructeur.Constante(input Valeur: Framework.double): ExpressionClasses.Constante
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Valeur : double
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Constante');

uneConstante : ExpressionClasses.Constante = new();
uneConstante.Type = TYPE_NUMERIQUE;
uneConstante.Valeur = DoubleData(Value = Valeur);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Constante : End');

return uneConstante;
end method;

------------------------------------------------------------
method Constructeur.Constante(input Valeur: Framework.string): ExpressionClasses.Constante
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Valeur : string
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Constante');

Date : DateTimeData = new();
Duree : IntervalData = new();
Chaine : TextData = new(Value = Valeur);

-- Cas d'une date
begin
	Date.DecodeValue(Chaine, DateFormat(Template = 'dd/mm/yyyy'));
exception
	when Erreur : UsageException do
		Date = NIL;
end;

-- Cas d'une duree
while Chaine.IsDigit() do
	Chaine.MoveNext();
end while;
if Chaine.Offset <> 0 then
	Nombre : integer = Chaine.CopyRange(0, Chaine.Offset).IntegerValue;
	Unite : TextData = Chaine.CopyRange(Chaine.Offset);
	if (Nombre = 1 and Unite.IsEqual(' Jour', TRUE)) or
	   (Nombre > 1 and Unite.IsEqual(' Jours', TRUE)) then
		Duree.SetUnit(Days = Nombre);
	elseif Nombre > 0 and Unite.IsEqual(' Mois', TRUE) then
		Duree.SetUnit(Months = Nombre);
	elseif (Nombre = 1 and Unite.IsEqual(' An', TRUE)) or
	       (Nombre > 1 and Unite.IsEqual(' Ans', TRUE)) then
		Duree.SetUnit(Years = Nombre);
	else
		Duree = NIL;
	end if;
else
	Duree = NIL;
end if;

-- Creation de la constante
uneConstante : ExpressionClasses.Constante = new();
if Date <> NIL then
	uneConstante.Type = TYPE_DATE;
	uneConstante.Valeur = Date;
elseif Duree <> NIL then
	uneConstante.Type = TYPE_DUREE;
	uneConstante.Valeur = Duree;
else
	uneConstante.Type = TYPE_CHAINE;
	uneConstante.Valeur = Chaine;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Constante : End');

return uneConstante;
end method;

------------------------------------------------------------
method Constructeur.Constante(input Valeur: Framework.DataValue): ExpressionClasses.Constante
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Valeur : DataValue
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Constante');

uneConstante : ExpressionClasses.Constante = NIL;
if Valeur <> NIL then
	uneConstante = new();
	if Valeur.IsA(BooleanData) then
		uneConstante.Type = TYPE_BOOLEEN;
	elseif Valeur.IsA(IntegerData) then
		uneConstante.Type = TYPE_ENTIER;
	elseif Valeur.IsA(DecimalData) then
		uneConstante.Type = TYPE_DECIMAL;
	elseif Valeur.IsA(NumericData) then
		uneConstante.Type = TYPE_NUMERIQUE;
	elseif Valeur.IsA(TextData) then
		uneConstante.Type = TYPE_CHAINE;
	elseif Valeur.IsA(DateTimeData) then
		uneConstante.Type = TYPE_DATE;
	elseif Valeur.IsA(IntervalData) then
		uneConstante.Type = TYPE_DUREE;
	else
		uneConstante.Type = TYPE_INCONNU;
	end if;
	uneConstante.Valeur = Valeur;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Constante : End');

return uneConstante;
end method;

------------------------------------------------------------
method Constructeur.Different(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Different
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Different');

Different : ExpressionClasses.Different = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Different : End');

return Different;
end method;

------------------------------------------------------------
method Constructeur.Divise(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Divise
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Divise');

Divise : ExpressionClasses.Divise = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Divise : End');

return Divise;
end method;

------------------------------------------------------------
method Constructeur.Egal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Egal
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Egal');

Egal : ExpressionClasses.Egal = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Egal : End');

return Egal;
end method;

------------------------------------------------------------
method Constructeur.Et(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Et
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Et');

Et : ExpressionClasses.Et = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Et : End');

return Et;
end method;

------------------------------------------------------------
method Constructeur.Inferieur(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Inferieur
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Inferieur');

Inferieur : ExpressionClasses.Inferieur = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Inferieur : End');

return Inferieur;
end method;

------------------------------------------------------------
method Constructeur.InferieurOuEgal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.InferieurOuEgal
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.InferieurOuEgal');

InferieurOuEgal : ExpressionClasses.InferieurOuEgal = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.InferieurOuEgal : End');

return InferieurOuEgal;
end method;

------------------------------------------------------------
method Constructeur.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Init');

super.Init();
self.Variables = new();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Init : End');

end method;

------------------------------------------------------------
method Constructeur.Max(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Max
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Max');

Max : ExpressionClasses.Max = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Max : End');

return Max;
end method;

------------------------------------------------------------
method Constructeur.Min(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Min
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Min');

Min : ExpressionClasses.Min = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Min : End');

return Min;
end method;

------------------------------------------------------------
method Constructeur.Moins(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Moins
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Moins');

Moins : ExpressionClasses.Moins = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Moins : End');

return Moins;
end method;

------------------------------------------------------------
method Constructeur.MoinsUnaire(input Operande: ExpressionClasses.Expression): ExpressionClasses.MoinsUnaire
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.MoinsUnaire');

MoinsUnaire : ExpressionClasses.MoinsUnaire = new(Operande = Operande);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.MoinsUnaire : End');

return MoinsUnaire;
end method;

------------------------------------------------------------
method Constructeur.Multiplie(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Multiplie
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Multiplie');

Multiplie : ExpressionClasses.Multiplie = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Multiplie : End');

return Multiplie;
end method;

------------------------------------------------------------
method Constructeur.Ou(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Ou
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Ou');

Ou : ExpressionClasses.Ou = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Ou : End');

return Ou;
end method;

------------------------------------------------------------
method Constructeur.Pas(input Operande: ExpressionClasses.Expression): ExpressionClasses.Expression
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.PlusUnaire');

Pas : ExpressionClasses.Pas = new(Operande = Operande);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.PlusUnaire : End');

return Pas;
end method;

------------------------------------------------------------
method Constructeur.Plus(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Plus
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Plus');

Plus : ExpressionClasses.Plus = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Plus : End');

return Plus;
end method;

------------------------------------------------------------
method Constructeur.PlusUnaire(input Operande: ExpressionClasses.Expression): ExpressionClasses.PlusUnaire
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.PlusUnaire');

PlusUnaire : ExpressionClasses.PlusUnaire = new(Operande = Operande);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.PlusUnaire : End');

return PlusUnaire;
end method;

------------------------------------------------------------
method Constructeur.Superieur(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.Superieur
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Superieur');

Superieur : ExpressionClasses.Superieur = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Superieur : End');

return Superieur;
end method;

------------------------------------------------------------
method Constructeur.SuperieurOuEgal(input Operande1: ExpressionClasses.Expression,
	input Operande2: ExpressionClasses.Expression): ExpressionClasses.SuperieurOuEgal
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Operande1 : Expression
--               input Operande2 : Expression
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.SuperieurOuEgal');

SuperieurOuEgal : ExpressionClasses.SuperieurOuEgal = new(Operande1 = Operande1, Operande2 = Operande2);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.SuperieurOuEgal : End');

return SuperieurOuEgal;
end method;

------------------------------------------------------------
method Constructeur.Variable(input Nom: Framework.TextData): ExpressionClasses.Variable
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Nom : TextData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Constructeur.Variable');

Variable : ExpressionCLasses.Variable = NIL;
if self.Contexte <> NIL then
	for uneVariable in self.Variables do
		if Nom.IsEqual(uneVariable.Nom, TRUE) then
			Variable = uneVariable;
			exit;
		end if;
	end for;
	if Variable = NIL then
		Valeur : DataValue = self.Contexte.Variable(Nom);
		if Valeur <> NIL then
			Variable = new();
			Variable.Nom = Nom.Value;
			if Valeur.IsA(BooleanData) then
				Variable.Type = TYPE_BOOLEEN;
			elseif Valeur.IsA(IntegerData) then
				Variable.Type = TYPE_ENTIER;
			elseif Valeur.IsA(DecimalData) then
				Variable.Type = TYPE_DECIMAL;
			elseif Valeur.IsA(NumericData) then
				Variable.Type = TYPE_NUMERIQUE;
			elseif Valeur.IsA(TextData) then
				Variable.Type = TYPE_CHAINE;
			elseif Valeur.IsA(DateTimeData) then
				Variable.Type = TYPE_DATE;
			elseif Valeur.IsA(IntervalData) then
				Variable.Type = TYPE_DUREE;
			else
				Variable.Type = TYPE_INCONNU;
			end if;
			Variable.Valeur = Valeur;
			self.Variables.AppendRow(Variable);
		end if;
	end if;
else
	-- Pour pouvoir tester sans utiliser de contexte
	if self.Variables.Items = 0 then
		self.Variables.AppendRow(ExpressionClasses.Variable(
			Nom = 'BonClient',
			Type = TYPE_BOOLEEN,
			Valeur = BooleanData(value = TRUE)));
		self.Variables.AppendRow(ExpressionClasses.Variable(
			Nom = 'Age',
			Type = TYPE_ENTIER,
			Valeur = IntegerData(value = 18)));
		self.Variables.AppendRow(ExpressionClasses.Variable(
			Nom = 'Categorie',
			Type = TYPE_CHAINE,
			Valeur = TextData(value = 'VIP')));
		self.Variables.AppendRow(ExpressionClasses.Variable(
			Nom = 'Devise',
			Type = TYPE_CHAINE,
			Valeur = TextData(value = 'FF')));
		self.Variables.AppendRow(ExpressionClasses.Variable(
			Nom = 'Prix',
			Type = TYPE_DECIMAL,
			Valeur = DecimalData(value = 400)));
	end if;
	for uneVariable in self.Variables do
		if Nom.IsEqual(uneVariable.Nom, TRUE) then
			Variable = uneVariable;
			exit;
		end if;
	end for;
		
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Constructeur.Variable : End');

return Variable;
end method;

------------------------------------------------------------
method Different.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Different.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsNotEqual((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsNotEqual((TextData)(Valeur2));
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsNotEqual((DateTimeData)(Valeur2));
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Different.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Different.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Different.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Different.Init : End');

end method;

------------------------------------------------------------
method Divise.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Divise.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
			(DecimalData)(self.Valeur).Divide((DecimalData)(Valeur1), (DecimalData)(Valeur2));
		else
			(NumericData)(self.Valeur).Divide(Valeur1, Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Divise.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Divise.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Divise.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Divise.Init : End');

end method;

------------------------------------------------------------
method Egal.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Egal.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsEqual((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsEqual((TextData)(Valeur2));
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsEqual((DateTimeData)(Valeur2));
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Egal.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Egal.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Egal.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Egal.Init : End');

end method;

------------------------------------------------------------
method Et.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Et.Evalue');

Valeur : BooleanData = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : BooleanData = (BooleanData)(self.Operande1.Evalue());
	Valeur2 : BooleanData = (BooleanData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		Valeur = self.Valeur.LAnd(Valeur1, Valeur2);
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Et.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Et.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Et.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Et.Init : End');

end method;

------------------------------------------------------------
method Expression.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Expression.Evalue');

Valeur : DataValue = NIL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Expression.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Expression.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Expression.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Expression.Init : End');

end method;

------------------------------------------------------------
method Expression.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Expression.VerifieType');

Type : integer = TYPE_INCONNU;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Expression.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method Inferieur.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Inferieur.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsLessThan((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsLessThan((TextData)(Valeur2));
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsLessThan((DateTimeData)(Valeur2));
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Inferieur.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Inferieur.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Inferieur.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Inferieur.Init : End');

end method;

------------------------------------------------------------
method InferieurOuEgal.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InferieurOuEgal.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsLessThanOrEqual((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsGreaterThan((TextData)(Valeur2));
			Valeur.LNot(Valeur);
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsGreaterThan((DateTimeData)(Valeur2));
			Valeur.LNot(Valeur);
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InferieurOuEgal.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method InferieurOuEgal.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InferieurOuEgal.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InferieurOuEgal.Init : End');

end method;

------------------------------------------------------------
method Max.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Max.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur2.IsNull = TRUE or (Valeur1.IsNull = FALSE and Valeur1.IsGreaterThan(Valeur2)) then
			(NumericData)(self.Valeur).SetValue(Valeur1);
		else
			(NumericData)(self.Valeur).SetValue(Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Max.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Max.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Max.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Max.Init : End');

end method;

------------------------------------------------------------
method Min.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Min.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur2.IsNull = TRUE or (Valeur1.IsNull = FALSE and Valeur1.IsLessThan(Valeur2)) then
			(NumericData)(self.Valeur).SetValue(Valeur1);
		else
			(NumericData)(self.Valeur).SetValue(Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Min.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Min.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   23/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Min.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Min.Init : End');

end method;

------------------------------------------------------------
method Moins.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Moins.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	if self.Valeur.IsA(NumericData) then
		Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
		Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
		if Valeur1 <> NIL and Valeur2 <> NIL then
			if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
				(DecimalData)(self.Valeur).Subtract((DecimalData)(Valeur1), (DecimalData)(Valeur2));
			else
				(NumericData)(self.Valeur).Subtract(Valeur1, Valeur2);
			end if;
			Valeur = self.Valeur;
		end if;
	elseif self.Valeur.IsA(DateTimeData) then
		Valeur1 : DateTimeData = (DateTimeData)(self.Operande1.Evalue());
		Valeur2 : IntervalData = (IntervalData)(self.Operande2.Evalue());
		if Valeur1 <> NIL and Valeur2 <> NIL then
			(DateTimeData)(self.Valeur).Subtract(Valeur1, Valeur2);
			Valeur = self.Valeur;
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Moins.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Moins.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Moins.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Moins.Init : End');

end method;

------------------------------------------------------------
method MoinsUnaire.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoinsUnaire.Evalue');

Valeur : DataValue = NIL;
if self.Operande <> NIL then
	Valeur = self.Operande.Evalue();
	if Valeur <> NIL then
		if Valeur.IsA(NumericData) then
			if self.Valeur.IsA(DecimalData) and self.Zero.IsA(DecimalData) and Valeur.IsA(DecimalData) then
				(DecimalData)(self.Valeur).Subtract((DecimalData)(self.Zero), (DecimalData)(Valeur));
			else
				self.Valeur.Subtract(self.Zero, (NumericData)(Valeur));
			end if;
			Valeur = self.Valeur;
		else
			Valeur = NIL;
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoinsUnaire.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method MoinsUnaire.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoinsUnaire.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoinsUnaire.Init : End');

end method;

------------------------------------------------------------
method MoinsUnaire.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoinsUnaire.VerifieType');

Type : integer = super.VerifieType();
if self.Valeur = NIL then
	case Type is
		when TYPE_ENTIER do
			self.Valeur = IntegerNullable();
			self.Zero = IntegerData(Value = 0);
		when TYPE_DECIMAL do
			self.Valeur = DecimalNullable();
			self.Zero = DecimalData(Value = 0);
		when TYPE_NUMERIQUE do
			self.Valeur = DoubleNullable();
			self.Zero = DoubleData(Value = 0);
	end case;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoinsUnaire.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method Multiplie.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Multiplie.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
	Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
			(DecimalData)(self.Valeur).Multiply((DecimalData)(Valeur1), (DecimalData)(Valeur2));
		else
			(NumericData)(self.Valeur).Multiply(Valeur1, Valeur2);
		end if;
		Valeur = self.Valeur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Multiplie.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Multiplie.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Multiplie.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Multiplie.Init : End');

end method;

------------------------------------------------------------
method Operation.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Operation.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Operation.Init : End');

end method;

------------------------------------------------------------
method OperationArithmetique.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationArithmetique.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationArithmetique.Init : End');

end method;

------------------------------------------------------------
method OperationArithmetique.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationArithmetique.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Type1 : integer = self.Operande1.VerifieType();
	Type2 : integer = self.Operande2.VerifieType();
	if (Type1 = TYPE_ENTIER or Type1 = TYPE_DECIMAL or Type1 = TYPE_NUMERIQUE) and
	   (Type2 = TYPE_ENTIER or Type2 = TYPE_DECIMAL or Type2 = TYPE_NUMERIQUE) then
		if Type1 = TYPE_NUMERIQUE or Type2 = TYPE_NUMERIQUE then
			Type = TYPE_NUMERIQUE;
		elseif Type1 = TYPE_DECIMAL or Type2 = TYPE_DECIMAL then
			Type = TYPE_DECIMAL;
		else
			Type = TYPE_ENTIER;
		end if;
		-- Lors d'un arrondi, le type du resultat doit etre
		-- celui de la premiere operande. En effet :
		--    123 Arrondi 0.01
		-- n'a aucun sens, car 123 est un entier !
		if (self.IsA(Arrondi) or self.IsA(ArrondiInf) or self.IsA(ArrondiSup)) and Type <> Type1 then
			Type = TYPE_INCONNU;
		end if;
	elseif (self.IsA(Plus) or self.IsA(Moins)) and
	       Type1 = TYPE_DATE and Type2 = TYPE_DUREE then
		Type = Type1;
	end if;
	if self.Valeur = NIL then
		case Type is
			when TYPE_ENTIER do
				self.Valeur = IntegerNullable();
			when TYPE_DECIMAL do
				self.Valeur = DecimalNullable();
			when TYPE_NUMERIQUE do
				self.Valeur = DoubleNullable();
			when TYPE_DATE do
				self.Valeur = DateTimeNullable();
		end case;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationArithmetique.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method OperationBinaire.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationBinaire.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationBinaire.Init : End');

end method;

------------------------------------------------------------
method OperationDeComparaison.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationDeComparaison.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationDeComparaison.Init : End');

end method;

------------------------------------------------------------
method OperationDeComparaison.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationDeComparaison.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Type1 : integer = self.Operande1.VerifieType();
	Type2 : integer = self.Operande2.VerifieType();
	if (Type1 = TYPE_ENTIER or Type1 = TYPE_DECIMAL or Type1 = TYPE_NUMERIQUE) and
	   (Type2 = TYPE_ENTIER or Type2 = TYPE_DECIMAL or Type2 = TYPE_NUMERIQUE) then
		Type = TYPE_BOOLEEN;
	elseif Type1 = TYPE_CHAINE and Type2 = TYPE_CHAINE then
		Type = TYPE_BOOLEEN;
	elseif Type1 = TYPE_DATE and Type2 = TYPE_DATE then
		Type = TYPE_BOOLEEN;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationDeComparaison.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method OperationLogique.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationLogique.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationLogique.Init : End');

end method;

------------------------------------------------------------
method OperationLogique.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationLogique.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Type1 : integer = self.Operande1.VerifieType();
	Type2 : integer = self.Operande2.VerifieType();
	if Type1 = TYPE_BOOLEEN and Type2 = TYPE_BOOLEEN then
		Type = TYPE_BOOLEEN;
		if self.Valeur = NIL then
			self.Valeur = BooleanNullable();
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationLogique.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method OperationUnaire.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationUnaire.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationUnaire.Init : End');

end method;

------------------------------------------------------------
method OperationUnaire.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationUnaire.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Operande <> NIL then
	Type = self.Operande.VerifieType();
	if Type <> TYPE_ENTIER and Type <> TYPE_DECIMAL and Type <> TYPE_NUMERIQUE then
		Type = TYPE_INCONNU;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationUnaire.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method Ou.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Ou.Evalue');

Valeur : BooleanData = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : BooleanData = (BooleanData)(self.Operande1.Evalue());
	Valeur2 : BooleanData = (BooleanData)(self.Operande2.Evalue());
	if Valeur1 <> NIL and Valeur2 <> NIL then
		Valeur = self.Valeur.LOr(Valeur1, Valeur2);
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Ou.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Ou.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Ou.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Ou.Init : End');

end method;

------------------------------------------------------------
method Pas.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   29/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Pas.Evalue');

Valeur : DataValue = NIL;
if self.Operande <> NIL then
	Valeur = self.Operande.Evalue();
	if Valeur <> NIL then
		if Valeur.IsA(BooleanData) then
			Valeur = self.Valeur.LNot((BooleanData)(Valeur));
		else
			Valeur = NIL;
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Pas.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Pas.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   29/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Pas.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Pas.Init : End');

end method;

------------------------------------------------------------
method Pas.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   29/06/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Pas.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Operande <> NIL then
	Type = self.Operande.VerifieType();
	if Type = TYPE_BOOLEEN then
		if self.Valeur = NIL then
			self.Valeur = BooleanNullable();
		end if;
	else
		Type = TYPE_INCONNU;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Pas.VerifieType : End');

return Type;
end method;

------------------------------------------------------------
method Plus.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--	PV    |   23/04/1998   |   Ajout du type decimal.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Plus.Evalue');

Valeur : DataValue = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	if self.Valeur.IsA(NumericData) then
		Valeur1 : NumericData = (NumericData)(self.Operande1.Evalue());
		Valeur2 : NumericData = (NumericData)(self.Operande2.Evalue());
		if Valeur1 <> NIL and Valeur2 <> NIL then
			if self.Valeur.IsA(DecimalData) and Valeur1.IsA(DecimalData) and Valeur2.IsA(DecimalData) then
				(DecimalData)(self.Valeur).Add((DecimalData)(Valeur1), (DecimalData)(Valeur2));
			else
				(NumericData)(self.Valeur).Add(Valeur1, Valeur2);
			end if;
			Valeur = self.Valeur;
		end if;
	elseif self.Valeur.IsA(DateTimeData) then
		Valeur1 : DateTimeData = (DateTimeData)(self.Operande1.Evalue());
		Valeur2 : IntervalData = (IntervalData)(self.Operande2.Evalue());
		if Valeur1 <> NIL and Valeur2 <> NIL then
			(DateTimeData)(self.Valeur).Add(Valeur1, Valeur2);
			Valeur = self.Valeur;
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Plus.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Plus.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Plus.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Plus.Init : End');

end method;

------------------------------------------------------------
method PlusUnaire.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PlusUnaire.Evalue');

Valeur : DataValue = NIL;
if self.Operande <> NIL then
	Valeur = self.Operande.Evalue();
	if Valeur <> NIL then
		if not Valeur.IsA(NumericData) then
			Valeur = NIL;
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PlusUnaire.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method PlusUnaire.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- PlusUnaire.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- PlusUnaire.Init : End');

end method;

------------------------------------------------------------
method Superieur.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Superieur.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsGreaterThan((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsGreaterThan((TextData)(Valeur2));
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsGreaterThan((DateTimeData)(Valeur2));
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Superieur.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Superieur.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Superieur.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Superieur.Init : End');

end method;

------------------------------------------------------------
method SuperieurOuEgal.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--	PV    |   17/03/1998   |   Ajout des types date et duree.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SuperieurOuEgal.Evalue');

Valeur : BooleanNullable = NIL;
if self.Operande1 <> NIL and self.Operande2 <> NIL then
	Valeur1 : DataValue = self.Operande1.Evalue();
	Valeur2 : DataValue = self.Operande2.Evalue();
	if Valeur1 <> NIL and Valeur2 <> NIL then
		if Valeur1.IsA(NumericData) and Valeur2.IsA(NumericData) then
			Valeur = (NumericData)(Valeur1).IsGreaterThanOrEqual((NumericData)(Valeur2));
		elseif Valeur1.IsA(TextData) and Valeur2.IsA(TextData) then
			Valeur = (TextData)(Valeur1).IsLessThan((TextData)(Valeur2));
			Valeur.LNot(Valeur);
		elseif Valeur1.IsA(DateTimeData) and Valeur2.IsA(DateTimeData) then
			Valeur = (DateTimeData)(Valeur1).IsLessThan((DateTimeData)(Valeur2));
			Valeur.LNot(Valeur);
		end if;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SuperieurOuEgal.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method SuperieurOuEgal.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- SuperieurOuEgal.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- SuperieurOuEgal.Init : End');

end method;

------------------------------------------------------------
method Variable.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Variable.Evalue');

Valeur : DataValue = self.Valeur;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Variable.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method Variable.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Variable.Init');

super.Init();
self.Nom = '<variable inconnue>';
self.Type = TYPE_INCONNU;
self.Valeur = NIL;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Variable.Init : End');

end method;

------------------------------------------------------------
method Variable.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Variable.VerifieType');

Type : integer = self.Type;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Variable.VerifieType : End');

return Type;
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'expressi';


end ExpressionClasses;
begin TOOL ParserExpression;

includes ContexteClt;
includes ContexteSrv;
includes DataStructuresClasses;
includes ExpressionClasses;
includes ParserClasses;
includes ParserErrors;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ExprParser;
forward  ExprTokenizer;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant KW_ARR = 9;
constant KW_ET = 1;
constant KW_INF = 4;
constant KW_MAX = 7;
constant KW_MIN = 6;
constant KW_NON = 8;
constant KW_OU = 2;
constant KW_SUP = 5;
constant KW_VALUE = 3;
constant LOG_GRPFLAG = 2;
constant OP_DIFF = 7;
constant OP_DIV = 4;
constant OP_EGAL = 8;
constant OP_FPAR = 12;
constant OP_INF = 5;
constant OP_INFE = 10;
constant OP_MOINS = 2;
constant OP_MULT = 3;
constant OP_OPAR = 11;
constant OP_PLUS = 1;
constant OP_SUP = 6;
constant OP_SUPE = 9;
constant TOK_DATE = 9;
constant TOK_INTERVAL = 10;
constant TYP_BOOLEAN = 4;
constant TYP_DATE = 5;
constant TYP_DECIMAL = 7;
constant TYP_FLOAT = 3;
constant TYP_INTEGER = 1;
constant TYP_INTERVAL = 6;
constant TYP_STRING = 2;
constant USEPREPROCESSOR = TRUE;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ExprParser inherits from ParserClasses.Parser

has public  attribute Constructeur: ExpressionClasses.Constructeur;
has public  attribute Contexte: ContexteClt.Contexte;
has private attribute Expression: ExpressionClasses.Expression;

has public  method DoGetEndOfLineCommentOut: Framework.string;
has public  method DoInitializeDataTypes;
has public  method DoInitializeKeywords;
has public  method DoInitializeParser;
has public  method DoIsKeyword(input aString: Framework.TextData): Framework.integer;
has public  method DoIsType(input aTypeName: Framework.string): Framework.integer;
has public  method DoParseTokens: Framework.TextData;
has public  method GetParsedExpression: ExpressionClasses.Expression;
has public  method Init;
has public  method Parse(input Expression: Framework.string): ExpressionClasses.Expression;
has public  method ParseExpression: ExpressionClasses.Expression;
has public  method ParsePrimary: ExpressionClasses.Expression;
has public  method TokenToExpression(input unCode: Framework.integer,
	input PreIncr: Framework.boolean = FALSE): ExpressionClasses.Expression;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ExprTokenizer inherits from ParserClasses.Tokenizer

has public  constant DelimChaine = '\'';

has public  method DoCanMergeToken(input TokenGauche: Framework.TextData,
	input TokenDroit: Framework.TextData): Framework.boolean;
has public  method DoGetStringChar: Framework.string;
has public  method DoGetStringForm(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneChaine: Framework.TextData): ParserClasses.Token;
has public  method DoIsSeparator(input ThisChar: Framework.TextData): Framework.boolean;
has public  method DoIsStringChar(input ThisChar: Framework.TextData): Framework.boolean;
has public  method DoRefineSeparator(input ThisChar: Framework.TextData): Framework.integer;
has public  method DoUsePreprocessor: Framework.boolean;
has public  method Init;
has public  method TryADate(input uneChaine: Framework.TextData,
	input Format: Framework.TextData): Framework.DateTimeData;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ExprParser.DoGetEndOfLineCommentOut: Framework.string
begin
--
--	Description : A surcharger.Renvoie la chaîne de commentaire fin de ligne
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoGetEndOfLineCommentOut');
uneChaine : string = '"';
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoGetEndOfLineCommentOut : End');
return uneChaine;
end method;

------------------------------------------------------------
method ExprParser.DoInitializeDataTypes
begin
--
--	Description : Enregistrement de tous types du langage
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation.
--	PMT	|	17/03/1998	|	Ajout du type date et du type intervalle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoInitializeDataTypes');

super.DoInitializeDataTypes();
RegisterDataType('integer' , TYP_INTEGER , DT_PRIMITIVE);
RegisterDataType('string'  , TYP_STRING  , DT_PRIMITIVE);
RegisterDataType('float'   , TYP_FLOAT   , DT_PRIMITIVE);
RegisterDataType('boolean' , TYP_BOOLEAN , DT_PRIMITIVE);
RegisterDataType('date'    , TYP_DATE    , DT_PRIMITIVE);
RegisterDataType('interval', TYP_INTERVAL, DT_PRIMITIVE);
RegisterDataType('decimal',  TYP_DECIMAL , DT_PRIMITIVE);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoInitializeDataTypes : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoInitializeDataTypes');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.DoInitializeKeywords
begin
--
--	Description : Enregistrement de tous les mots réservés du langage de description de règles
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--	PMT	|	29/06/1998	|	Ajout des opérateurs "Non" et "Arr"
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoInitializeKeywords');

super.DoInitializeKeywords(); -- pour effacer la liste des mots réservés

RegisterKeyword('ET'  , KW_ET);
RegisterKeyword('OU'  , KW_OU);
RegisterKeyword('MIN' , KW_MAX);  -- Max et Min volontairement inversés pour leur donner la sémantique voulue
RegisterKeyword('MAX' , KW_MIN);
RegisterKeyword('INF' , KW_INF);
RegisterKeyword('SUP' , KW_SUP);
RegisterKeyword('NON' , KW_NON); 
RegisterKeyword('ARR' , KW_ARR);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoInitializeKeywords : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoInitializeKeywords');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.DoInitializeParser
begin
--
--	Description : Initialisation des autres objets du compilateur (tokenizer,parser)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoInitializeParser');

super.DoInitializeParser();
aTokenizer : ExprTokenizer = new();
aTokenizer.SetParser(Self);
SetTokenizer(aTokenizer);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoInitializeParser : End');

return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoInitializeParser');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.DoIsKeyword(input aString: Framework.TextData): Framework.integer
begin
--
--	Description : Vérifie si la chaîne correspond à un mot clé. Renvoie le code correspondant, sinon KW_NOTFOUND
--  Accept modifiera le code résultat si le mot est un mot réservé du langage
--
--	Type :	Abstrait
--
--	Parametres :   aString : Le mot à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/01/1998	|	Creation.
--	PMT	|	04/02/1998	|	Implémentation de l'analyse par la méthode Accept.
--	PMT	|	29/06/1998	|	Ajout des opérateur "Non" et "Arr"
--+

-- Attention : La méthode IsChar est 'case sensitive' et on doit donc lui passer le caractère 
-- en minuscule et en majuscule.

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoIsKeyword');

aResult : integer = KW_NOTFOUND;
found   : boolean = FALSE;
unTexteKeyword : TextData;

-- L'ordre alphabétique n'est pas forcément heureux, il est sans doute préférable
-- de mettre les mots réservés dans l'ordre probable d'apparition des mots réservés

if aString.IsChar('Aa') then
   found = AcceptKeyword(KW_ARR,aResult,unTexteKeyword);
elseif 
   aString.IsChar('Ee') then
   found = AcceptKeyword(KW_ET,aResult,unTexteKeyword);
elseif
   aString.IsChar('Oo') then
   found = AcceptKeyword(KW_OU,aResult,unTexteKeyword);
elseif
   aString.IsChar('Mm') then
   found = AcceptKeyword(KW_MIN,aResult,unTexteKeyword);
   if not found then 
      found = AcceptKeyword(KW_MAX,aResult,unTexteKeyword);
   end if;
elseif 
   aString.IsChar('Nn') then
   found = AcceptKeyword(KW_NON,aResult,unTexteKeyword);	
elseif
   aString.IsChar('Ii') then
   found = AcceptKeyword(KW_INF,aResult,unTexteKeyword);
elseif
   aString.IsChar('Ss') then
   found = AcceptKeyword(KW_SUP,aResult,unTexteKeyword);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoIsKeyword : End');

return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoIsKeyword');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.DoIsType(input aTypeName: Framework.string): Framework.integer
begin
--
--	Description : Vérifie si la chaîne correspond à un type, renvoie le code correspondant, sinon TYP_INVALID
--  Accept modifiera le code résultat si le mot correspond à un type du langage
--
--	Type :	Concret
--
--	Parametres :   aString : Le mot à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	04/02/1998	|	Creation
--	PMT	|	17/03/1998	|	Ajout du type date et du type intervalle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoIsType');

aResult:integer = TYP_INVALID;
found : boolean =  AcceptType(TYP_INTEGER,aResult); 
if not found then found = AcceptType(TYP_STRING,aResult); end if;
if not found then found = AcceptType(TYP_FLOAT,aResult); end if;
if not found then found = AcceptType(TYP_BOOLEAN,aResult); end if;
if not found then found = AcceptType(TYP_DATE,aResult); end if;
if not found then found = AcceptType(TYP_INTERVAL,aResult); end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoIsType : End');

return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoIsType');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.DoParseTokens: Framework.TextData
begin
--
--	Description : Lancement de l'analyse syntaxique sur les tokens créés par le tokenizer
--  Retourne une référence sur la liste des erreurs.
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--	PMT	|	02/02/1998	|	Début implémentation du parsing.
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.DoParseTokens');

super.DoParseTokens();

if TokenCount>0  then
	GetFirstToken();  -- positionnement sur le début de la chaîne des tokens.
	Expression = ParseExpression(); -- Lancement du premier appel d'analyse de l'expression
else
	Expression = Constructeur.Constante(TRUE);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.DoParseTokens : End');

return NIL; 

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.DoParseTokens');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.GetParsedExpression: ExpressionClasses.Expression
begin
--
--	Description : Renvoie l'expression compilée
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	20/02/1998	|	Creation
--+

return Expression;

end method;

------------------------------------------------------------
method ExprParser.Init
begin
--
--	Description : Initialisation du parseur (= de l'expression et du constructeur d'expression)
--
--	Type :	Concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/02/1998	|	Creation.
--+

super.Init();
end method;

------------------------------------------------------------
method ExprParser.Parse(input Expression: Framework.string): ExpressionClasses.Expression
begin
--
--	Description : Appel du parseur
--
--	Type :	Concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.Parse');

uneExpression : ExpressionClasses.Expression = NIL;
if self.Constructeur = NIL then
	self.Constructeur = new(Contexte = self.Contexte);
end if;
self.Compile(Expression);
uneExpression  = self.GetParsedExpression();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.Parse : End');

return uneExpression;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.Parse');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.ParseExpression: ExpressionClasses.Expression
begin
--
--	Description : Analyse d'une expression ou d'une sous-expression
--
--	Type :	Concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/02/1998	|	Creation
--	PMT	|	29/06/1998	|	Ajout de l'opérateur "Arr" (Arrondi)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.ParseExpression');

unCode           : integer = TOK_INVALID;
unRefiner        : integer = TOK_INVALID;
uneExpression    : ExpressionClasses.Expression;
unOperandeADroite: ExpressionClasses.Expression;
unCodeKeyword	 : integer;
unTexteKeyword   : TextData;

uneExpression = ParsePrimary(); 
while CurrTok<>NIL do
	
	unCode = CurrTok.GetKind();
	unRefiner = CurrTok.GetAsRefined();

	-- Attention à analyser en premier les opérateurs sur deux caractères. Sinon, on risque d'accepter un
	-- opérateur sur un caractère dont le premier caractère correspond au premier caractère d'un opérateur
	-- sur deux caractères. Exemple : <= (Inférieur ou égal) doit être analysé avant < (Inférieur).
			 
	if	    Accept(')',NIL,FALSE)		
	then 	
		exit;
		
	elseif	Accept('>','=') then 
			unOperandeADroite = ParsePrimary(); 
	 		uneExpression = Constructeur.SuperieurOuEgal(uneExpression,unOperandeADroite);
	 		
	elseif Accept('<','=') then 
			unOperandeADroite = ParsePrimary(); 
	        uneExpression = Constructeur.InferieurOuEgal(uneExpression,unOperandeADroite);
	        
	elseif Accept('<','>') then 
			unOperandeADroite = ParsePrimary(); 
	        uneExpression = Constructeur.Different(uneExpression,unOperandeADroite);
	
	elseif Accept('=') then 
			unOperandeADroite = ParsePrimary(); 
	        uneExpression = Constructeur.Egal(uneExpression,unOperandeADroite);
	
	elseif Accept('+')     then 
			unOperandeADroite = ParsePrimary(); 
			uneExpression = Constructeur.Plus(uneExpression,unOperandeADroite);			   
							        
	elseif Accept('-')     then 
			unOperandeADroite = ParsePrimary(); 
			uneExpression = Constructeur.Moins(uneExpression,unOperandeADroite);
	 		
	elseif Accept('*')     then 
			unOperandeADroite = ParsePrimary(); 
	 		uneExpression = Constructeur.Multiplie(uneExpression,unOperandeADroite);
	 		
	elseif Accept('/')     then 
			unOperandeADroite = ParsePrimary(); 
	        uneExpression = Constructeur.Divise(uneExpression,unOperandeADroite);
			 
	elseif Accept('<')     then 
			unOperandeADroite = ParsePrimary(); 
			uneExpression = Constructeur.Inferieur(uneExpression,unOperandeADroite);
	 		
	elseif Accept('>')     then 
			unOperandeADroite = ParsePrimary(); 
			uneExpression = Constructeur.Superieur(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_ET,unCodeKeyword,unTexteKeyword) then
			GetNextToken();
		    unOperandeADroite = ParsePrimary();
		    uneExpression = Constructeur.Et(uneExpression,unOperandeADroite);
		    
	elseif AcceptKeyword(KW_OU,unCodeKeyword,unTexteKeyword) then
			GetNextToken();
			unOperandeADroite = ParsePrimary();
			uneExpression = Constructeur.Ou(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_MIN,unCodeKeyword,unTexteKeyword) then
		   GetNextToken();
		   unOperandeADroite = ParsePrimary();
		   uneExpression = Constructeur.Min(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_MAX,unCodeKeyword,unTexteKeyword) then
		   GetNextToken();
		   unOperandeADroite = ParsePrimary();
		   uneExpression = Constructeur.Max(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_SUP,unCodeKeyword,unTexteKeyword) then -- Opérateur arrondi supérieur
           GetNextToken();
		   unOperandeADroite = ParsePrimary();
		   uneExpression = Constructeur.ArrondiSup(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_INF,unCodeKeyword,unTexteKeyword) then -- Opérateur arrondi inférieur
		   GetNextToken();
		   unOperandeADroite = ParsePrimary();
		   uneExpression = Constructeur.ArrondiInf(uneExpression,unOperandeADroite);

	elseif AcceptKeyword(KW_ARR,unCodeKeyword,unTexteKeyword) then -- Opérateur arrondi auto
		   GetNextToken();
		   unOperandeADroite = ParsePrimary();
		   uneExpression = Constructeur.Arrondi(uneExpression,unOperandeADroite);

	else   
		   AddError(ERR_OPERATEUR_INCONNU,'Opérateur attendu : ',CurrTok.GetVal().Value); 	 -- traitement d'erreur
		   GetNextToken();
		   SetStatus();
	end if; 

end while;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.ParseExpression : End');

return uneExpression;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.ParseExpression');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.ParsePrimary: ExpressionClasses.Expression
begin
--
--	Description : Cette méthode traite les opérateurs unaires (plus et moins) ainsi que le cas des parenthèses 
--  			  et des opérandes (constantes et variables).
--
--	Type :	Concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	24/02/1998	|	Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.ParsePrimary');

uneExpression  : ExpressionClasses.Expression;
unCodeKeyword  : integer;
unTexteKeyword : TextData;
 
if CurrTok<>NIL then
	unCode        : integer = CurrTok.GetKind();
	unRefiner     : integer = CurrTok.GetAsRefined();
	
	if unCode = TOK_SEPARATOR then
		   -- Attention, traitement du parenthésage en premier
		   if       	unRefiner = OP_OPAR then 
						Expecting(FALSE,TRUE,'(');
						uneExpression = ParseExpression();
						Expecting(FALSE,FALSE,')');

		   elseif	    unRefiner = OP_PLUS then
						GetNextToken();
						unCode = CurrTok.GetKind();
						unRefiner = CurrTok.GetAsRefined();
						uneExpression = Constructeur.PlusUnaire(TokenToExpression(unCode));
						
			elseif  unRefiner = OP_MOINS then
						GetNextToken();
						unCode = CurrTok.GetKind();
						unRefiner = CurrTok.GetAsRefined();
						uneExpression = Constructeur.MoinsUnaire(TokenToExpression(unCode));
												
			else
					AddError(ERR_CARACTERE_INTERDIT,'Caractère non autorisé ici : ',CurrTok.GetVal().Value);
					SetStatus();
					GetNextToken();
			end if;
			GetNextToken(); -- $+290698
	else
			-- opérateurs unaires non stockés sous la forme d'un caractère séparateur mais d'un mot réservé
			if AcceptKeyword(KW_NON, unCodeKeyword, unTexteKeyword) = TRUE then
               GetNextToken();
			   uneExpression = Constructeur.Pas(ParsePrimary());
			-- Attention : Ici, on n'avance pas d'un token car c'est à ParseExpression de repositionner
			-- correctement le token pour la suite de l'analyse.
			else
				uneExpression = TokenToExpression(unCode);
				GetNextToken(); -- $+290698
			end if;
	end if;
	
--	GetNextToken(); -- $-290698
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.ParsePrimary : End');

return uneExpression;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.ParsePrimary');
		Raise;

end method;

------------------------------------------------------------
method ExprParser.TokenToExpression(input unCode: Framework.integer,
	input PreIncr: Framework.boolean = FALSE): ExpressionClasses.Expression
begin
--
--	Description : Création d'une opérande (sous la forme d'une expression) à partir du contenu d'un token.
--
--	Type :	concret
--
--	Parametres :   unCode : le code correspondant au type du token
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : ExprParser.
--
--	Historique :
--
--	PMT	|	18/02/1998	|	Creation.
--	PMT	|	18/03/1998	|	Ajout de l'analyse des DataValues.
--	PMT	|	11/05/1998	|	Correction : Prise en compte d'une expression parenthésée
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprParser.TokenToExpression');

unRefiner : integer;

if PreIncr then  -- passage au symbole suivant (à la demande) et actualisation du code
   GetNextToken();
   unCode = CurrTok.GetKind();
   unRefiner = CurrTok.GetAsRefined();
end if;

uneExpression  : ExpressionClasses.Expression;
case unCode is

	when TOK_SEPARATOR do

		unRefiner = CurrTok.GetAsRefined();
		if unRefiner = OP_OPAR then
			Expecting(FALSE,TRUE,'(');
			uneExpression = ParseExpression();
			Expecting(FALSE,FALSE,')');
		else
		    uneExpression = Constructeur.Constante(NIL);
		    AddError(ERR_VALEUR_TYPE_INCONNU,'Constante de type inconnu',CurrTok.GetVal().Value);
			SetStatus();
			GetNextToken();
		end if;
		
	when TOK_VAL do

	    if DoIsValidIdentifier(CurrTok.GetVal()) 
	    then 
	    	 uneExpression = Constructeur.Variable(CurrTok.GetVal());
			 if uneExpression = NIL then 
			 	AddError(ERR_VARIABLE_INCONNUE,'Variable inconnue : ',CurrTok.GetVal().Value);
				SetStatus();
				GetNextToken();
	         end if;
	    else 
	    	    AddError(ERR_FORMAT_IDENTIFICATEUR_INCORRECT,'Identificateur invalide : ',CurrTok.GetVal().Value);
				SetStatus();
				GetNextToken();
	    end if;

	when TOK_INTEGER do
		unEntier : IntegerData = new();
		begin
		  unEntier.Value = CurrTok.GetVal().IntegerValue;
		  uneExpression = Constructeur.Constante(unEntier);	
		exception
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_ENTIERE,'Entier de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;

	when TOK_DECIMAL do
		unDecimal : DecimalData = new();
		begin
		   unDecimal.Scale = CurrTok.GetAsRefined();
		   unDecimal.TextValue = CurrTok.GetVal();
		   uneExpression = Constructeur.Constante(unDecimal);
		exception
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_REELLE,'Réel de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;

	when TOK_STRING do
		begin
		  Chaine : TextData = new(Value=CurrTok.GetVal().Value);
		  Chaine = Chaine.CutRange(1,Chaine.LengthToEnd()-1);	-- pour enlever les quotes
		  uneExpression = Constructeur.Constante(Chaine);	
		exception
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_CHAINE,'Constante chaîne de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;

	when TOK_FLOAT do
		unReel : DoubleData = new();
		begin
		  unReel.Value = CurrTok.GetVal().DoubleValue;
		  uneExpression = Constructeur.Constante(unReel);	
		exception
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_REELLE,'Réel de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;
	
	when TOK_BOOLEAN do
		begin
		  unBooleen : BooleanData = new();
		  uneExpression = Constructeur.Constante(CurrTok.GetVal());	
		exception
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_BOOLEENNE,'Constante booléenne de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;
		
	-- Gestion de valeurs autres que : booléens, chaînes, entiers, flottants,
	-- Certains cas (float, integer) pourraient être traités ici au prix d'un case et
	-- d'un traitement d'erreur plus contraignant
	when TOK_DATAVALUE do
		begin
		  unDataValue : DataValue;
		  unDataValue = CurrTok.GetDataValue();
		  uneExpression = Constructeur.Constante(unDataValue); 
		exception
		  when e : UsageException do
		    AddError(ERR_VALEUR_GENERIQUE,'Constante de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
			
		  when e : DataTypeException do
		    AddError(ERR_VALEUR_GENERIQUE,'Constante de format incorrect : ',CurrTok.GetVal().Value);   
			SetStatus();
			GetNextToken();
		end;

	else
	    uneExpression = Constructeur.Constante(NIL);
	    AddError(ERR_VALEUR_TYPE_INCONNU,'Constante de type inconnu',CurrTok.GetVal().Value);
		SetStatus();
		GetNextToken();
	    
end case;	

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprParser.TokenToExpression : End');

return uneExpression;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprParser.TokenToExpression');
		Raise;

end method;

------------------------------------------------------------
method ExprTokenizer.DoCanMergeToken(input TokenGauche: Framework.TextData,
	input TokenDroit: Framework.TextData): Framework.boolean
begin
--
--	Description : Demande d'autorisation de fusion de deux tokens (au sens ExprTokenizer)
--
--	Type :	Concret
--
--	Parametres :   TokenGauche, TokenDroit : Tokens sous la forme de chaînes de caractères
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	26/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprTokenizer.DoCanMergeToken');

Autorisation : boolean = FALSE;
if     TokenGauche.IsEqual('<') then
	   if TokenDroit.IsEqual('>') or TokenDroit.IsEqual('=') 
	   then Autorisation = TRUE;
	   end if;
elseif TokenGauche.IsEqual('>') and TokenDroit.IsEqual('=') 
	   then Autorisation = TRUE;   
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprTokenizer.DoCanMergeToken : End');

return Autorisation;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprTokenizer.DoCanMergeTokens');
		Raise;

end method;

------------------------------------------------------------
method ExprTokenizer.DoGetStringChar: Framework.string
begin
--
--	Description : Renvoie le symbole accepté comme symbole de début de chaîne
--
--	Type :	Valeur par défaut (Devrait être surchargé)
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	30/03/1998	|	Creation.
--+

return DelimChaine;
end method;

------------------------------------------------------------
method ExprTokenizer.DoGetStringForm(input laTableTokens: Framework.Array of ParserClasses.Token,
	input uneChaine: Framework.TextData): ParserClasses.Token
begin
--
--	Description : Lecture d'une date ou d'un intervalle (optionnel)
--
--	Type :	concret
--
--	Parametres :  UneChaine : Chaîne à analyser
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--	PMT	|	20/03/1998	|	Reconnaissance des dates de la même manière qu'avec les intervalles (analyse syntaxique)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprTokenizer.DoGetStringForm');

unToken      : Token;
LaForme      : array of Token=new(); -- Les tokens 
if uneChaine <> nil then

	Chaine     : TextData = new(Value = uneChaine.CutRange(1,uneChaine.LengthToEnd()-1).Value);
	Chaine.Offset = 0;
	
	TmpChaine : TextData = new(Value=Chaine.Value);
	TokenizeLine(Chaine,LaForme); -- Transformation en un tableau de tokens
	
	case LaForme.Items is
	
	    -- Analyse des dates
	    when 5 do
			
			unDTD        : DateTimeData;
			FormatChaine : TextData = new(); -- Format de la chaîne à accepter
	        DateOk 		 : boolean = TRUE;
	        leToken      : Token;
	        
	        for i in 1 to 5 do
				if laForme[i]=NIL then
				   DateOK = FALSE;
				   exit;
				end if;
	        end for;
	
			if DateOK and laForme[1].GetKind()=TOK_INTEGER 
			then 
			  for i in 1 to laForme[1].GetVal().LengthToEnd() do
			    FormatChaine.Concat('d');
			  end for;
			else DateOK = FALSE;
			end if;
			
			if DateOK and laForme[2].GetVal().IsEqual('/')  
			then 
				FormatChaine.Concat('/');	
			else DateOK = FALSE;
			end if;
	
			if DateOK and laForme[3].GetKind()=TOK_INTEGER 
			then
			  for i in 1 to laForme[3].GetVal().LengthToEnd() do
			    FormatChaine.Concat('m');
			  end for;
			else DateOK = FALSE;
			end if;
			 
			if DateOK and laForme[4].GetVal().IsEqual('/')  
			then FormatChaine.Concat('/');	
			else DateOK = FALSE;
			end if;
	
			if DateOK and laForme[5].GetKind()=TOK_INTEGER 
			then 
			  for i in 1 to laForme[5].GetVal().LengthToEnd() do
			    FormatChaine.Concat('y');
			  end for;
			else DateOK = FALSE;
			end if;
			          
	
			unDTD = TryADate(tmpChaine,FormatChaine);
					
			if unDTD<>NIL then 
	--		   unToken = AppendToken(laTableTokens,TOK_DATAVALUE,unDTD,TYP_DATE);	
			   unToken = AppendToken(laTableTokens,TOK_DATAVALUE,unDTD,TOK_DATE);	
			end if;
				
	  	when 2 do
	       
	       unInterval : IntervalData;
		   if LaForme.Items=2 and LaForme[1]<>NIL and LaForme[2]<>NIL then
		
			  if LaForme[1].GetKind()=TOK_INTEGER then
			     NombreUnites : Integer = LaForme[1].GetVal().IntegerValue; -- ne devrait pas lever d'exception car TOK_INTEGER
				 if     LaForme[2].GetVal.IsEqual('an',IgnoreCase=TRUE) and (NombreUnites=1) then
					    unInterval = new();
					    unInterval.SetUnit(Years=NombreUnites);
				 elseif LaForme[2].GetVal.IsEqual('ans',IgnoreCase=TRUE) and (NombreUnites<>1) then
					    unInterval = new();
					    unInterval.SetUnit(Years=NombreUnites);
				 elseif LaForme[2].GetVal.IsEqual('mois',IgnoreCase=TRUE)  then
					    unInterval = new();
					    unInterval.SetUnit(Months=NombreUnites);
				 elseif LaForme[2].GetVal.IsEqual('jour',IgnoreCase=TRUE) and (NombreUnites=1) then
					    unInterval = new();
					    unInterval.SetUnit(Days=NombreUnites);
				 elseif LaForme[2].GetVal.IsEqual('jours',IgnoreCase=TRUE) and (NombreUnites<>1) then			
					    unInterval = new();
					    unInterval.SetUnit(Days=NombreUnites);
				 end if; 
			  end if;	
		   end if;
		   if unInterval<>NIL then
	--			unToken = AppendToken(laTableTokens,TOK_DATAVALUE,unInterval,TYP_INTERVAL);	
				unToken = AppendToken(laTableTokens,TOK_DATAVALUE,unInterval,TOK_INTERVAL);	
		   end if;
	
	end case;

end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprTokenizer.DoGetStringForm : End');


return unToken;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprTokenizer.DoGetStringForm');
		Raise;

end method;

------------------------------------------------------------
method ExprTokenizer.DoIsSeparator(input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le caractère dans ThisChar est un séparateur
--
--	Type :	concret
--
--	Parametres :  ThisChar : Caractère à tester
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	23/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.IsSeparator');
aRes : boolean = ThisChar.IsChar('+-*/() ^''\\=<>\0');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.IsSeparator : End');
return aRes;
end method;

------------------------------------------------------------
method ExprTokenizer.DoIsStringChar(input ThisChar: Framework.TextData): Framework.boolean
begin
--
--	Description : Vérifie si le caractère dans ThisChar est le caractère de définition d'une chaîne
--
--	Type :	concret
--
--	Parametres :  ThisChar : Caractère à tester
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	10/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Tokenizer.IsStringChar');
unRes : boolean = ThisChar.IsChar(DelimChaine);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Tokenizer.IsStringChar : End');
return unRes;

end method;

------------------------------------------------------------
method ExprTokenizer.DoRefineSeparator(input ThisChar: Framework.TextData): Framework.integer
begin
--
--	Description : Affine le séparateur passé en argument
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale - Ne gère pas les séparateurs et/ou opérateurs sur plus d'un caractère. 
--
--	Historique : 
--
--	PMT	|	17/02/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExprTokenizer.DoRefineSeparator : End');

unRefiner : integer = TOK_INVALID;
if     ThisChar.IsChar('+') then unRefiner = OP_PLUS;
elseif ThisChar.IsChar('-') then unRefiner = OP_MOINS;
elseif ThisChar.IsChar('*') then unRefiner = OP_MULT;
elseif ThisChar.IsChar('/') then unRefiner = OP_DIV;
elseif ThisChar.IsChar('(') then unRefiner = OP_OPAR;
elseif ThisChar.IsChar(')') then unRefiner = OP_FPAR;
elseif ThisChar.IsChar('<') then unRefiner = OP_INF;
elseif ThisChar.IsChar('>') then unRefiner = OP_SUP;
elseif ThisChar.IsChar('=') then unRefiner = OP_EGAL;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExprTokenizer.DoRefineSeparator : End');

return unRefiner;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprTokenizer.DoRefineSeparator');
		Raise;

end method;

------------------------------------------------------------
method ExprTokenizer.DoUsePreprocessor: Framework.boolean
begin
--
--	Description : Méthode surchargée (autorisation du préprocesseur)
--
--	Type :	concret
--
--	Parametres :  Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	20/03/1998	|	Creation.
--+

return UsePreprocessor;

end method;

------------------------------------------------------------
method ExprTokenizer.Init
begin
--
--	Description : Initialisation du tokenizer
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/98	|	Creation.
--+

super.Init();

end method;

------------------------------------------------------------
method ExprTokenizer.TryADate(input uneChaine: Framework.TextData,
	input Format: Framework.TextData): Framework.DateTimeData
begin
--
--	Description : "Essai" d'un format de date
--
--	Type :	Concret
--
--	Parametres :   uneChaine : la chaîne à vérifier
--				   Format    : Le format à tester	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/03/1998	|	Creation.
--+

  unDateTimeData : DateTimeData;
begin
  unFormatDate : DateFormat = new(Template = Format);
  unDateTimeData = unFormatDate.DecodeDate(uneChaine);
exception
  when e : UsageException do unDateTimeData = NIL;
end;

return unDateTimeData;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ExprTokenizer.TryADate');
		Raise;

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'parserex';


end ParserExpression;
begin TOOL CompilateurClasses;

includes ContexteClt;
includes ExpressionClasses;
includes ParserErrors;
includes ParserExpression;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  Compilateur;
forward  ExpressionCompilee;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 20;
constant MAP_DECIMAL_TO_DECIMAL = 2;
constant MAP_DECIMAL_TO_DOUBLE = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class Compilateur inherits from Framework.Object

has public  attribute Contexte: ContexteClt.Contexte;
has private attribute Parser: ParserExpression.ExprParser;

has public  method AppendPre(input unObjet: Framework.TextData,
	input uneCle: Framework.TextData);
has public  method ClearPres;
has public  method Compile(input Expression: Framework.string): CompilateurClasses.ExpressionCompilee;
has public  method DoesExpand(input srcString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.boolean;
has public  method Expand(input srcString: Framework.TextData,
	input WithString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.TextData;
has public  method GetDecimalNumbersMapping: Framework.integer;
has public  method Init;
has public  method MapDecimalToDecimal;
has public  method MapDecimalToDouble;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ExpressionCompilee inherits from Framework.Object

has public  attribute Contexte: ContexteClt.Contexte;
has public  attribute Expression: ExpressionClasses.Expression;
has public  attribute VariablesUtilisees: Framework.Array of Framework.IntegerData;

has public  method Evalue: Framework.DataValue;
has public  method Init;
has public  method VerifieType: Framework.integer;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method Compilateur.AppendPre(input unObjet: Framework.TextData,
	input uneCle: Framework.TextData)
begin
--
--	Description : Ajoute une directive de compilation
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.AppendPre');

if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;
Parser.GetTokenizer().AppendPre(uneCle=uneCle,unObjet=unObjet);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.AppendPre : End');

return;

Exception
	When e : GenericException do
		Raise;
		
end method;

------------------------------------------------------------
method Compilateur.ClearPres
begin
--
--	Description : Effacement des directives de compilation
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.ClearPres');

if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;
Parser.GetTokenizer().ClearPres();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.ClearPres : End');

end method;

------------------------------------------------------------
method Compilateur.Compile(input Expression: Framework.string): CompilateurClasses.ExpressionCompilee
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : input Expression : string
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.Compile');

uneExpressionCompilee : ExpressionCompilee = NIL;
if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;
if self.Contexte <> NIL then
	self.Contexte.ResetVariablesUtilisees();
end if;
uneExpression : ExpressionClasses.Expression = self.Parser.Parse(Expression);
if uneExpression <> NIL then
	if uneExpression.VerifieType() <> TYPE_INCONNU then
		uneExpressionCompilee = new();
		uneExpressionCompilee.Contexte = self.Contexte;
		uneExpressionCompilee.Expression = uneExpression;
		if self.Contexte <> NIL then
			uneExpressionCompilee.VariablesUtilisees = self.Contexte.GetVariablesUtilisees();
		end if;
	else
		uneErreur : ErreurTypeInexistant = new();
		uneErreur.SetWithParams(Message='Expression mal formée',severity=SP_ER_ERROR); 
		raise uneErreur;
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.Compile : End');

return uneExpressionCompilee;
end method;

------------------------------------------------------------
method Compilateur.DoesExpand(input srcString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.boolean
begin
--
--	Description : Expansion d'une chaîne de caractère par une sous-expression
--
--	Type : Concret
--
--	Parametres : srcString : Chaîne source
--				 WithString: Chaîne de remplacement
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : Vérifie si la chaîne contient le symbole "WithItem"
--
--	Historique : 
--
--	PMT    |   08/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.DoesExpand');

if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;
unResult : boolean = self.Parser.DoesExpand(SrcString = srcString, WithItem = WithItem);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.DoesExpand : End');

return unResult;
end method;

------------------------------------------------------------
method Compilateur.Expand(input srcString: Framework.TextData,
	input WithString: Framework.TextData,
	input WithItem: Framework.TextData): Framework.TextData
begin
--
--	Description : Expansion d'une chaîne de caractère par une sous-expression
--
--	Type : Concret
--
--	Parametres : srcString : Chaîne source
--				 WithString: Chaîne de remplacement
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : Retourne la chaîne "expansée"
--
--	Historique : 
--
--	PMT    |   07/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.Expand');

uneExpansion : TextData;
if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;
uneExpansion = self.Parser.Expand(SourceString = srcString, WithString = WithString, WithItem = WithItem);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.Expand : End');

return uneExpansion;
end method;

------------------------------------------------------------
method Compilateur.GetDecimalNumbersMapping: Framework.integer
begin
--
--	Description : Lecture du type d'attribution des nombres décimaux
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.GetDecimalNumbersMapping');

unRes : integer = Parser.GetTokenizer().GetDecimalNumbersMapping();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.GetDecimalNumbersMapping : End()');

return unRes;
end method;

------------------------------------------------------------
method Compilateur.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.Init : End');

end method;

------------------------------------------------------------
method Compilateur.MapDecimalToDecimal
begin
--
--	Description : Attribution du type par défaut pour un nombre décimal (decimal to decimal)
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.MapDecimalToDouble');

if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;

Parser.GetTokenizer().MapDecimalToDecimal();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.MapDecimalToDouble : End()');

end method;

------------------------------------------------------------
method Compilateur.MapDecimalToDouble
begin
--
--	Description : Attribution du type par défaut pour un nombre décimal (decimal to double)
--
--	Type :	concret
--
--	Parametres :   Aucun.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Compilateur.MapDecimalToDouble');

if self.Parser  = NIL then
	self.Parser = new(Contexte = self.Contexte);
end if;

Parser.GetTokenizer().MapDecimalToDouble();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Compilateur.MapDecimalToDouble : End()');

end method;

------------------------------------------------------------
method ExpressionCompilee.Evalue: Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExpressionCompilee.Evalue');

Valeur : DataValue = NIL;
if self.Expression <> NIL then
	if self.Contexte <> NIL then
		self.Contexte.Evalue(VariablesUtilisees);
	end if;
	Valeur = self.Expression.Evalue();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExpressionCompilee.Evalue : End');

return Valeur;
end method;

------------------------------------------------------------
method ExpressionCompilee.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExpressionCompilee.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExpressionCompilee.Init : End');

end method;

------------------------------------------------------------
method ExpressionCompilee.VerifieType: Framework.integer
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ExpressionCompilee.VerifieType');

Type : integer = TYPE_INCONNU;
if self.Expression <> NIL then
	Type = self.Expression.VerifieType();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ExpressionCompilee.VerifieType : End');

return Type;
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'compilat';


end CompilateurClasses;
begin TOOL TarificationSrv;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes CompilateurClasses;
includes ContexteClt;
includes ContexteSrv;
includes ContexteTarificat;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes DicoBD;
includes ExpressionClasses;
includes FileDataAccessSrv;
includes FrameworkBD;
includes ParserErrors;
includes GenericDBMS;
includes Framework;
includes SecuritySrvBD;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  AnomalieTarificationExc;
forward  EvenementTarificationBS;
forward  EvenementTarificationDesc;
forward  EvenementTarificationDescSql;
forward  EvenementTarificationDS;
forward  FrontCommSrv;
forward  NotificationSrv;
forward  OperationDiverseBS;
forward  OperationDiverseDesc;
forward  OperationDiverseDS;
forward  RegleBS;
forward  RegleDesc;
forward  RegleDescSql;
forward  RegleDS;
forward  RegleParam;
forward  ServiceOD;
forward  SessionSrv;
forward  TarifClientBS;
forward  TarifClientDesc;
forward  TarifClientDS;
forward  TarificationBSMgr;
forward  TarificationDSMgr;
forward  TauxTVABS;
forward  TauxTVADesc;
forward  TauxTVADS;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_CP_GETPRODUIT = 15000;
constant CLASSE_CATEGORIE_DICO = 'RefTarifDesc';
constant CLASSE_DEVISE_DICO = 'RefDeviseDesc';
constant CLASSE_PACKAGE_DICO = 'RefTypePackageDesc';
constant CLASSE_PRODUIT_DICO = 'RefTypeProduitDesc';
constant CLASSE_PROMOTION_DICO = 'RefTypePromotionDesc';
constant CLASSE_SERVICE_DICO = 'RefTypeServiceDesc';
constant CST_TARIF_A_RENSEIGNER = 'Tarif_A_Renseigner';
constant CST_TARIF_CATEGORIE = 'Tarif_Categorie';
constant CST_TARIF_CATEGORIE_STANDARD = 'Tarif_Categorie_Standard';
constant CST_TARIF_DE_REFERENCE = 'Tarif_De_Reference';
constant CST_TARIF_PRIX_PUBLIC = 'Prix_Public';
constant CST_TARIF_SANS_PROMOTION = 'Tarif_Sans_Promotion';
constant DATE_INFINI = '31-dec-2099';
constant DECIMAL_NUMBERS_MAPPING = 1;
constant DEVISE_EURO = 2;
constant DEVISE_FRANC = 1;
constant IDX_CATEGORIE_STANDARD = 1;
constant IDX_DEVISE_FRF = 1;
constant IDX_HORS_PACKAGE = 1;
constant IDX_HORS_PROMOTION = 1;
constant LOG_GRPFLAG = 60;
constant STRATEGIE_INDEFINI = 0;
constant STRATEGIE_MAXI = 3;
constant STRATEGIE_MINI = 2;
constant STRATEGIE_STANDARD = 1;
constant TYPE_CATEGORIE = 2;
constant TYPE_DEVISE = 1;
constant TYPE_PACKAGE = 4;
constant TYPE_PRODUIT = 3;
constant TYPE_PROMOTION = 6;
constant TYPE_SERVICE = 5;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class AnomalieTarificationExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class EvenementTarificationBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc);
has public  method DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method Init;
has public  method LireEvtsValides(input DateReference: Framework.DateTimeData): Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method RejeterEvenement(input EvenementRejete: TarificationSrv.EvenementTarificationDesc): Framework.IntegerData;
has public  method TariferEvenement(input EvenementTarife: TarificationSrv.EvenementTarificationDesc): Framework.IntegerData;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class EvenementTarificationDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  constant NullValue = 0;

has public  attribute CodeAgence: DicoBD.TypTextNullable;
has public  attribute CodeCanal: DicoBD.CodDesc;
has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodeEtab: DicoBD.TypTextNullable;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute CompteAFacturer: DicoBD.TypTextNullable;
has public  attribute DateFacturation: DicoBD.DteDesc;
has public  attribute DateOperation: DicoBD.DteDesc;
has public  attribute DateTarification: DicoBD.DteDesc;
has public  attribute EtatCRE: Framework.IntegerData;
has public  attribute Montant: DicoBD.TypDoubleNullable;
has public  attribute NumClient: DicoBD.NumClientRcDesc;
has public  attribute NumCompte: DicoBD.TypTextNullable;
has public  attribute NumContrat: DicoBD.TypTextNullable;
has public  attribute Quantite: DicoBD.TypIntegerNullable;
has public  attribute RetrocessionBln: DicoBD.TypBooleanNullable;
has public  attribute TarifTTC: Framework.DoubleData;

has public  method DoCheckValidity: Framework.boolean;
has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class EvenementTarificationDescSql inherits from TarificationSrv.EvenementTarificationDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class EvenementTarificationDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class FrontCommSrv inherits from DataAccessSrvBD.FrontCommSrvDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class NotificationSrv inherits from DataAccessSrvBD.ServiceDesc

has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class OperationDiverseBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc);
has public  method DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class OperationDiverseDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute Agence: DicoBD.TypIntegerNullable;
has public  attribute CodeEtat: DicoBD.TypTextNullable;
has public  attribute CodeEvenement: DicoBD.TypTextNullable;
has public  attribute CodeSynonyme1: DicoBD.TypTextNullable;
has public  attribute CodeSynonyme2: DicoBD.TypTextNullable;
has public  attribute CodeSynonyme3: DicoBD.TypTextNullable;
has public  attribute CodeUtilisateur: DicoBD.TypIntegerNullable;
has public  attribute Compte1: DicoBD.TypTextNullable;
has public  attribute Compte2: DicoBD.TypTextNullable;
has public  attribute Compte3: DicoBD.TypTextNullable;
has public  attribute Date1: DicoBD.TypIntegerNullable;
has public  attribute Date2: DicoBD.TypIntegerNullable;
has public  attribute Date3: DicoBD.TypIntegerNullable;
has public  attribute Date4: DicoBD.TypIntegerNullable;
has public  attribute DateCommission1: DicoBD.TypIntegerNullable;
has public  attribute DateCommission2: DicoBD.TypIntegerNullable;
has public  attribute DateCommission3: DicoBD.TypIntegerNullable;
has public  attribute DateCommission4: DicoBD.TypIntegerNullable;
has public  attribute DateValeur1: DicoBD.TypIntegerNullable;
has public  attribute DateValeur2: DicoBD.TypIntegerNullable;
has public  attribute DateValeur3: DicoBD.TypIntegerNullable;
has public  attribute DateValeur4: DicoBD.TypIntegerNullable;
has public  attribute Devise1: DicoBD.TypTextNullable;
has public  attribute Devise2: DicoBD.TypTextNullable;
has public  attribute Etablissement: DicoBD.TypIntegerNullable;
has public  attribute Libelle1: DicoBD.TypTextNullable;
has public  attribute Libelle2: DicoBD.TypTextNullable;
has public  attribute Montant1: DicoBD.TypDoubleNullable;
has public  attribute Montant2: DicoBD.TypDoubleNullable;
has public  attribute Montant3: DicoBD.TypDoubleNullable;
has public  attribute Montant4: DicoBD.TypDoubleNullable;
has public  attribute Montant5: DicoBD.TypDoubleNullable;
has public  attribute Montant6: DicoBD.TypDoubleNullable;
has public  attribute Montant7: DicoBD.TypDoubleNullable;
has public  attribute Montant8: DicoBD.TypDoubleNullable;
has public  attribute MontantCommission1: DicoBD.TypDoubleNullable;
has public  attribute MontantCommission2: DicoBD.TypDoubleNullable;
has public  attribute MontantCommission3: DicoBD.TypDoubleNullable;
has public  attribute MontantCommission4: DicoBD.TypDoubleNullable;
has public  attribute MontantTVA1: DicoBD.TypDoubleNullable;
has public  attribute MontantTVA2: DicoBD.TypDoubleNullable;
has public  attribute MontantTVA3: DicoBD.TypDoubleNullable;
has public  attribute MontantTVA4: DicoBD.TypDoubleNullable;
has public  attribute MultiCre: DicoBD.TypBooleanNullable;
has public  attribute NoCheque: DicoBD.TypTextNullable;
has public  attribute NoPiece: DicoBD.TypIntegerNullable;
has public  attribute NoSequence: DicoBD.TypIntegerNullable;
has public  attribute NumeroClient1: DicoBD.TypTextNullable;
has public  attribute NumeroClient2: DicoBD.TypTextNullable;
has public  attribute Opera: DicoBD.TypTextNullable;
has public  attribute Plan: DicoBD.TypIntegerNullable;
has public  attribute Rubrique1: DicoBD.TypTextNullable;
has public  attribute Rubrique2: DicoBD.TypTextNullable;
has public  attribute Rubrique3: DicoBD.TypTextNullable;
has public  attribute Rubrique4: DicoBD.TypTextNullable;
has public  attribute Servic: DicoBD.TypTextNullable;
has public  attribute SousService: DicoBD.TypTextNullable;
has public  attribute TypeClientTiers1: DicoBD.TypTextNullable;
has public  attribute TypeClientTiers2: DicoBD.TypTextNullable;

has public  method DoCheckValidity: Framework.boolean;
has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class OperationDiverseDS inherits from FileDataAccessSrv.FileDataServiceDesc

has public  method DoStartService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class RegleBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  attribute AttributionTypeDecimal: Framework.integer;
has public  attribute unCompilateur: CompilateurClasses.Compilateur;
has public  attribute unContexte: ContexteClt.Contexte;

has public  method AppendPrixPublic(input pTransdata: DataAccessSrvBD.TransDesc);
has public  method CompileRegle(input aRegle: TarificationSrv.RegleDesc);
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc);
has public  method DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method Init;
has public  method LirePrixPublic(input aDevise: DicoBD.RefDeviseDesc,
	input aCategorie: DicoBD.RefTarifDesc,
	input aPackage: AddDicoBD.RefTypePackageDesc,
	input aProduit: DicoBD.RefTypeProduitDesc,
	input aService: AddDicoBD.RefTypeServiceDesc,
	input apromotion: AddDicoBD.RefTypePromotionDesc): Framework.Array of TarificationSrv.RegleDesc;
has public  method LireReglesValides(input DateReference: Framework.DateTimeData): Framework.Array of TarificationSrv.RegleDesc;
has public  method VerifieMacros(input UneRegle: TarificationSrv.RegleDesc);
has public  method VerifieRegle(input aRegle: TarificationSrv.RegleDesc);

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class RegleDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute CodeStrategie: AddDicoBD.RefTypeStrategieDesc;
has public  attribute Commentaire: AddDicoBD.CommentaireDesc;
has public  attribute Condition: AddDicoBD.ConditionDesc;
has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;
has public  attribute DateProduction: DicoBD.DteDesc;
has public  attribute Montant: AddDicoBD.MontantDesc;
has public  attribute NomRegle: AddDicoBD.NomRegleDesc;
has public  attribute PrixPublicBln: DicoBD.TypBooleanNullable;
has public  attribute ProductionBln: DicoBD.TypBooleanNullable;

has public  method DoCheckValidity: Framework.boolean;
has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;
has public  method VerifieDate: Framework.boolean;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RegleDescSql inherits from TarificationSrv.RegleDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class RegleDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class RegleParam inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;

has public  method DoResetAttributes;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ServiceOD inherits from Framework.Object

has public  attribute CodeOD: Framework.string;
has public  attribute Libelle1: Framework.TextData;
has public  attribute Libelle2: Framework.TextData;
has public  attribute RubriqueOD: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class SessionSrv inherits from DataAccessSrvBD.SessionSrvDesc

has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class TarifClientBS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method Init;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class TarifClientDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeClient: AddDicoBD.CodeClientDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;
has public  attribute Montant: Framework.TextData;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TarifClientDS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class TarificationBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class TarificationDSMgr inherits from DataAccessSrvBD.DataServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class TauxTVABS inherits from DataAccessSrvBD.BusinessServiceDesc

has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc);
has public  method DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc);
has public  method Init;
has public  method TrouverTauxValide(input DateReference: Framework.DateTimeData): Framework.DoubleNullable;

has property
	shared=(allow=on, override=off, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class TauxTVADesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute DateDebut: Framework.DateTimeNullable;
has public  attribute DateFin: Framework.DateTimeNullable;
has public  attribute TauxTVA: Framework.DoubleNullable;

has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TauxTVADS inherits from DataAccessSrvBD.DataServiceSqlDesc

has public  method DoInitServiceSQL;
has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soDBResourceMgr : GenericDBMS.DBResourceMgr = (DialogDuration = SESSION,
	Visibility = user,
	ExternalManager = 'DBRelationClientele',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '5442FCF2-0BFC-11D1-BE4E-1F5BB6EEAA77');
service soNotificationSrv : TarificationSrv.NotificationSrv = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '512C0470-BDC0-11D1-94B6-0A77CA27AA77');
service soTarificationBSMgr : TarificationSrv.TarificationBSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '6F215040-BDAC-11D1-91D2-87C4D07FAA77');
service soTarificationDBSession : GenericDBMS.DBSession = (DialogDuration = SESSION,
	Visibility = user,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '5683E3D9-0BFC-11D1-BE4E-1F5BB6EEAA77');
service soTarificationDSMgr : TarificationSrv.TarificationDSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '7B8E52B0-BDAC-11D1-91D2-87C4D07FAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method AnomalieTarificationExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method EvenementTarificationBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  JB BRIAUD | 29/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarification.DoAction');


anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READALL_EVT do
		DateReference : DateTimeData = (DateTimeData)(aTransData.TransObject);
		anObject = LireEvtsValides(DateReference);
	when ACT_TARIF_APPEND_EVTREJETE do
		EvenementRejete : EvenementTarificationDesc = (EvenementTarificationDesc)(aTransData.TransObject);
		anObject = RejeterEvenement(EvenementRejete);
	when ACT_TARIF_APPEND_EVTTARIFE do
		EvenementTarife : EvenementTarificationDesc = (EvenementTarificationDesc)(aTransData.TransObject);
		anObject = TariferEvenement(EvenementTarife);
end case;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationBS.DoAction : End');

return anObject;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationBS.DoAction');
		Raise;
		
		
end method;

------------------------------------------------------------
method EvenementTarificationBS.DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationBS.DoBeforeUpdate');


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationBS.DoBeforeUpdate');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationBS.DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationBS.DoBeforeUpdate');



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationBS.DoBeforeUpdate');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationBS.Init
begin
super.Init();

Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;
Self.BusinessClass = EvenementTarificationDesc();

end method;

------------------------------------------------------------
method EvenementTarificationBS.LireEvtsValides(input DateReference: Framework.DateTimeData): Framework.Array of TarificationSrv.EvenementTarificationDesc
begin


TableEvt : Array of EvenementTarificationDescSql = New();

sql select 
		CodeDevise,CodeProduit, CodeService, CodeCategorie,CodePackage,CodePromotion, 
		NumClient, NumContrat, CodeAgence, CodeEtab, CodeCanal, DateOperation, DateTarification,
		DateFacturation, Montant, Quantite, TarifTTC, EtatCRE, CompteAFacturer, NumCompte

into    :TableEvt from EvtSource

where   DateOperation <= :DateReference 

on Session soTarificationDBSession;

return TableEvt;
end method;

------------------------------------------------------------
method EvenementTarificationBS.RejeterEvenement(input EvenementRejete: TarificationSrv.EvenementTarificationDesc): Framework.IntegerData
begin
Nb : integer = (sql insert into evtRejetes
	(id, idutlqqo, dtmajqqo,
	 CodeDevise, CodeProduit, CodeService, CodeCategorie, CodePackage, CodePromotion, NumClient, NumContrat,
	 CodeAgence, CodeEtab, CodeCanal, DateOperation, DateTarification, DateFacturation, Montant, Quantite,
	 TarifTTC, EtatCRE, CompteAFacturer, NumCompte)
	values (
			:EvenementRejete.ID,			   :EvenementRejete.Idutlqqo,	 	 :EvenementRejete.dtmajqqo,
	        :EvenementRejete.CodeDevise,       :EvenementRejete.CodeProduit,     :EvenementRejete.CodeService,
			:EvenementRejete.CodeCategorie,    :EvenementRejete.CodePackage,     :EvenementRejete.CodePromotion,
			:EvenementRejete.NumClient,        :EvenementRejete.NumContrat,      :EvenementRejete.CodeAgence,
			:EvenementRejete.CodeEtab,         :EvenementRejete.CodeCanal,       :EvenementRejete.DateOperation,
			:EvenementRejete.DateTarification, :EvenementRejete.DateFacturation, :EvenementRejete.Montant,
			:EvenementRejete.Quantite,         :EvenementRejete.TarifTTC,        :EvenementRejete.EtatCRE,
			:EvenementRejete.CompteAFacturer,  :EvenementRejete.NumCompte)
	on session soTarificationDBSession);

Nombre_Insertion : integerdata = New(Value=Nb);

return Nombre_Insertion;
end method;

------------------------------------------------------------
method EvenementTarificationBS.TariferEvenement(input EvenementTarife: TarificationSrv.EvenementTarificationDesc): Framework.IntegerData
begin

Nb : integer = (sql insert into evtTarifes
	(id,idutlqqo, dtmajqqo,
	 CodeDevise, CodeProduit, CodeService, CodeCategorie, CodePackage, CodePromotion, 
	 NumClient, NumContrat, CodeAgence, CodeEtab, CodeCanal, DateOperation, DateTarification,
	 DateFacturation, Montant, Quantite, TarifTTC, EtatCRE, CompteAFacturer, NumCompte)

	values (
			:EvenementTarife.ID, 		       :EvenementTarife.Idutlqqo,        :EvenementTarife.dtmajqqo,
			:EvenementTarife.CodeDevise,       :EvenementTarife.CodeProduit,     :EvenementTarife.CodeService,
			:EvenementTarife.CodeCategorie,    :EvenementTarife.CodePackage,     :EvenementTarife.CodePromotion,
			:EvenementTarife.NumClient,        :EvenementTarife.NumContrat,      :EvenementTarife.CodeAgence,
			:EvenementTarife.CodeEtab,         :EvenementTarife.CodeCanal,       :EvenementTarife.DateOperation,
			:EvenementTarife.DateTarification, :EvenementTarife.DateFacturation, :EvenementTarife.Montant,
			:EvenementTarife.Quantite,         :EvenementTarife.TarifTTC,        :EvenementTarife.EtatCRE,
			:EvenementTarife.CompteAFacturer,  :Evenementtarife.NumCompte)
	on session soTarificationDBSession);

Nombre_Insertion : integerdata = New(Value=Nb);

return Nombre_Insertion;
end method;

------------------------------------------------------------
method EvenementTarificationDesc.DoCheckValidity: Framework.boolean
begin
--
--	Description : 	contrôle l'ensemble des attributs de self.UneRegle : RegleDesc
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	History :
--

--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity ');


aResult : boolean = TRUE;

--Controle de cohérence des dates et champ montant non vide

unItemName : string;

unItemName = 'CodeProduit';
self.CodeProduit.DoCheckValidity();

unItemName = 'CodeService';
self.CodeService.DoCheckValidity();

unItemName = 'CodeAgence';
self.CodeAgence.DoCheckValidity();

unItemName = 'CodeCanal';
self.CodeCanal.DoCheckValidity();

unItemName = 'CodeCategorie';
self.CodeCategorie.DoCheckValidity();

unItemName = 'CodeDevise';
self.CodeDevise.DoCheckValidity();

unItemName = 'CodeEtab';
self.CodeEtab.DoCheckValidity();

unItemName = 'CodePackage';
self.CodePackage.DoCheckValidity();

unItemName = 'CodePromotion';
self.CodePromotion.DoCheckValidity();

unItemName = 'CompteAFacturer';
self.CompteAFacturer.DoCheckValidity();

unItemName = 'DateOperation';
self.DateOperation.DoCheckValidity();

unItemName = 'NumClient';
self.NumClient.DoCheckValidity();

unItemName = 'NumCompte';
self.NumCompte.DoCheckValidity();

unItemName = 'RetrocessionBln';
self.RetrocessionBln.DoCheckValidity();

unItemName = 'NumContrat';
self.NumContrat.DoCheckValidity();
		

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity : End');

return aResult;

Exception 
when e: GenericExc do
	Raise;



		
end method;

------------------------------------------------------------
method EvenementTarificationDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--+

self.CodeDevise = new();
self.CodeProduit = new();
self.CodeService = new();
Self.CodeCategorie = new();
self.CodePackage = new();
self.CodePromotion = new();
Self.NumClient = new();
Self.NumContrat = new();
self.CodeAgence = new();
self.CodeEtab = new();
self.CodeCanal = new();
self.DateOperation = new();
self.DateTarification = new();
self.DateFacturation = new();
self.Montant = new();
self.Quantite = new();
self.TarifTTC = new();
self.EtatCRE = new();
self.CompteAFacturer = new();
self.NumCompte = new();
self.RetrocessionBln = New();

end method;

------------------------------------------------------------
method EvenementTarificationDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description d'un évenement de tarification
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	PMT	|	13/05/1998	|	Création.
--+

SelfDesc.clear();


--MANQUE TRAITEMENT VALIDITE

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeDevise';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeDevise;
SelfDesc[SelfDesc.Items].ItemUserName = 'Devise';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'Produit';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'Operation';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeCategorie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeCategorie;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id Categorie';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'Package';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePromotion';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePromotion;
SelfDesc[SelfDesc.Items].ItemUserName = 'Promotion';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'NumClient';
SelfDesc[SelfDesc.Items].ItemReference = Self.NumClient;
SelfDesc[SelfDesc.Items].ItemUserName = 'Client';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'NumContrat';
SelfDesc[SelfDesc.Items].ItemReference = Self.NumContrat;
SelfDesc[SelfDesc.Items].ItemUserName = 'Contrat';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeAgence';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeAgence;
SelfDesc[SelfDesc.Items].ItemUserName = 'Agence';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeEtab';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeEtab;
SelfDesc[SelfDesc.Items].ItemUserName = 'Etablissement';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeCanal';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeCanal;
SelfDesc[SelfDesc.Items].ItemUserName = 'Canal';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateOperation';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateOperation;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateOperation';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateTarification';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateTarification;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateTarification';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'RetrocessionBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.RetrocessionBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'RetrocessionBln';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFacturation';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFacturation;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateFacturation';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Montant';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Quantite';
SelfDesc[SelfDesc.Items].ItemReference = Self.Quantite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Quantite';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'TarifTTC';
SelfDesc[SelfDesc.Items].ItemReference = Self.TarifTTC;
SelfDesc[SelfDesc.Items].ItemUserName = 'TarifTTC';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'EtatCRE';
SelfDesc[SelfDesc.Items].ItemReference = Self.EtatCRE;
SelfDesc[SelfDesc.Items].ItemUserName = 'EtatCRE';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CompteAFacturer';
SelfDesc[SelfDesc.Items].ItemReference = Self.CompteAFacturer;
SelfDesc[SelfDesc.Items].ItemUserName = 'CompteAFacturer';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'NumCompte';
SelfDesc[SelfDesc.Items].ItemReference = Self.NumCompte;
SelfDesc[SelfDesc.Items].ItemUserName = 'NumCompte';


end method;

------------------------------------------------------------
method EvenementTarificationDesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = EvenementTarificationDS;

end method;

------------------------------------------------------------
method EvenementTarificationDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method EvenementTarificationDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method EvenementTarificationDS.DoInitServiceSQL
begin
--
--	Description :	Initialisation SQL pour la gestion des évenements de tarification
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Tarification
--
--	Historique :
--
--  PMT		 | 13/05/1998  |   Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = '';
Self.ClauseFrom    = 'EvtSource';
Self.ClauseOrderBy    = '';
Self.RecordInstance = EvenementTarificationDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationDS.DoInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationDS.DoInitServiceSQL');
		Raise;
		
/*

CODECATEGORIE                           NUMBER
CODECLIENT                              NUMBER
CODEDEVISE                              NUMBER
CODESERVICE                             NUMBER
CODEPACKAGE                             NUMBER
CODEPRODUIT                             NUMBER
CODEPROMOTION                           NUMBER
TRAITE                                  NUMBER
DATEFACTURATION                         DATE
VALIDE                                  NUMBER
QUANTITE                                NUMBER
MONTANTVALORISEHT                       NUMBER
MONTANTVALORISETTC                      NUMBER
DATETRAITE                              DATE
ID                                      NUMBER
IDUTLQQO                                NUMBER
DTMAJQQO                                DATE


*/		
end method;

------------------------------------------------------------
method EvenementTarificationDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method FrontCommSrv.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrv.DoInitService');

Self.SessionSrv = SoSessionSrv;
Self.Dependances.AppendRow(Self.SessionSrv);
Self.Dependances.AppendRow(soCatalogueBSMgr);	--permet l'utilisation des services du catalogue Produit 
												--directement
Self.Dependances.AppendRow(soTarificationBSMgr);



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrv.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method FrontCommSrv.Init
begin
super.Init();

end method;

------------------------------------------------------------
method NotificationSrv.Init
begin
super.Init();
Self.ServiceStarted = TRUE;
end method;

------------------------------------------------------------
method OperationDiverseBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  JB BRIAUD | 29/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BusinessServiceDesc.DoAction');

unResult : Object = self.Transfer(aTransData, soTarificationDSMgr, OperationDiverseDS, aTransOrigin);

return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method OperationDiverseBS.DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT		| 06/07/98	| Création
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationDiverseBS.DoBeforeUpdate');


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationDiverseBS.DoBeforeUpdate : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'OperationDiverseBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method OperationDiverseBS.DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- OperationDiverseBS.DoBeforeUpdate');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- OperationDiverseBS.DoBeforeUpdate : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'OperationDiverseBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method OperationDiverseBS.Init
begin
super.Init();
Self.FlagRead = TRUE;
Self.FlagAppend = TRUE;
Self.BusinessClass = OperationDiverseDesc();

end method;

------------------------------------------------------------
method OperationDiverseDesc.DoCheckValidity: Framework.boolean
begin
--
--	Description : 	contrôle l'ensemble des attributs de self.UneRegle : RegleDesc
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	History :
--

--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity ');


aResult : boolean = TRUE;

--Controle de cohérence des dates et champ montant non vide

/*

unItemName : string;

unItemName = 'CodeProduit';
self.CodeProduit.DoCheckValidity();

unItemName = 'CodeService';
self.CodeService.DoCheckValidity();

unItemName = 'CodeAgence';
self.CodeAgence.DoCheckValidity();

unItemName = 'CodeCanal';
self.CodeCanal.DoCheckValidity();

unItemName = 'CodeCategorie';
self.CodeCategorie.DoCheckValidity();

unItemName = 'CodeDevise';
self.CodeDevise.DoCheckValidity();

unItemName = 'CodeEtab';
self.CodeEtab.DoCheckValidity();

unItemName = 'CodePackage';
self.CodePackage.DoCheckValidity();

unItemName = 'CodePromotion';
self.CodePromotion.DoCheckValidity();

unItemName = 'CompteAFacturer';
self.CompteAFacturer.DoCheckValidity();

unItemName = 'DateOperation';
self.DateOperation.DoCheckValidity();

unItemName = 'NumClient';
self.NumClient.DoCheckValidity();

unItemName = 'NumCompte';
self.NumCompte.DoCheckValidity();

unItemName = 'RetrocessionBln';
self.RetrocessionBln.DoCheckValidity();

unItemName = 'NumContrat';
self.NumContrat.DoCheckValidity();
		
*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity : End');

return aResult;

Exception 
when e: GenericExc do
	Raise;



		
end method;

------------------------------------------------------------
method OperationDiverseDesc.DoResetAttributes
begin
--
--	Description : 	Instancier les attributs de OperationDiverseDesc
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ObjectSelfDesc
--
--	Historique :
--
--	PMT		|	06/07/1998	|	Creation.
--+

self.Etablissement = new();
self.Agence = new();
self.Servic = new();
self.SousService = new();
self.CodeUtilisateur = new();
self.Plan = new();
self.Opera = new();
self.CodeEvenement = new();
self.NoPiece = new();
self.NoSequence = new();
self.Multicre = new();
self.CodeEtat = new();
self.TypeClientTiers1 = new();
self.NumeroClient1 = new();
self.TypeClientTiers2 = new();
self.NumeroClient2 = new();
self.Date1 = new();
self.Date2 = new();
self.Date3 = new();
self.Date4 = new();
self.DateValeur1 = new();
self.DateValeur2 = new();
self.DateValeur3 = new();
self.DateValeur4 = new();
self.Devise1 = new();
self.Devise2 = new();
self.Montant1 = new();
self.Montant2 = new();
self.Montant3 = new();
self.Montant4 = new();
self.Montant5 = new();
self.Montant6 = new();
self.Montant7 = new();
self.Montant8 = new();
self.CodeSynonyme1 = new();
self.Compte1 = new();
self.CodeSynonyme2 = new();
self.Compte2 = new();
self.CodeSynonyme3 = new();
self.Compte3 = new();
self.NoCheque = new();
self.Libelle1 = new();
self.Libelle2 = new();
self.Rubrique1 = new();
self.Rubrique2 = new();
self.Rubrique3 = new();
self.Rubrique4 = new();
self.MontantCommission1 = new();
self.DateCommission1 = new();
self.MontantTVA1 = new();
self.MontantCommission2 = new();
self.DateCommission2 = new();
self.MontantTVA2 = new();
self.MontantCommission3 = new();
self.DateCommission3 = new();
self.MontantTVA3 = new();
self.MontantCommission4 = new();
self.DateCommission4 = new();
self.MontantTVA4 = new();




end method;

------------------------------------------------------------
method OperationDiverseDesc.DoResetSelfDesc
begin
SelfDesc.clear();

-- #01  1,4,4N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=1, Length=4, Sign=SIGN_DISABLE, 
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Etablissement';
SelfDesc[SelfDesc.Items].ItemReference = Self.Etablissement;
SelfDesc[SelfDesc.Items].ItemUserName = 'Etablissement';

-- #02  5,4,4N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=5, Length=4, Sign=SIGN_DISABLE, 
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Agence';
SelfDesc[SelfDesc.Items].ItemReference = Self.Agence;
SelfDesc[SelfDesc.Items].ItemUserName = 'Agence';

-- #03  9,2,2A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=9, Length=2,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Servic';
SelfDesc[SelfDesc.Items].ItemReference = Self.Servic;
SelfDesc[SelfDesc.Items].ItemUserName = 'Service';

-- #04  11,2,2A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=11, Length=2,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'SousService';
SelfDesc[SelfDesc.Items].ItemReference = Self.SousService;
SelfDesc[SelfDesc.Items].ItemUserName = 'SousService';

-- #05  13,4,4N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=13, Length=4, Sign=SIGN_DISABLE,
									     Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeUtilisateur';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeUtilisateur;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeUtilisateur';

-- #06  17,3,3N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=17, Length=3, Sign=SIGN_DISABLE,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Plan';
SelfDesc[SelfDesc.Items].ItemReference = Self.Plan;
SelfDesc[SelfDesc.Items].ItemUserName = 'Plan';

-- #07  20,3,3A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=20, Length=3,
										 Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'Opera';
SelfDesc[SelfDesc.Items].ItemReference = Self.Opera;
SelfDesc[SelfDesc.Items].ItemUserName = 'Opera';

-- #08  23,3,3A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=23, Length=3,
										 Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'CodeEvenement';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeEvenement;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeEvenement';

-- #09  26,9,9N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=26, Length=9, Sign=SIGN_DISABLE,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'NoPiece';
SelfDesc[SelfDesc.Items].ItemReference = Self.NoPiece;
SelfDesc[SelfDesc.Items].ItemUserName = 'NoPiece';

-- #10  35,5,5N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=35, Length=5, Sign=SIGN_DISABLE,
										   Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'NoSequence';
SelfDesc[SelfDesc.Items].ItemReference = Self.NoSequence;
SelfDesc[SelfDesc.Items].ItemUserName = 'NoSequence';

-- #11  40,1,1A
SelfDesc.AppendRow(BooleanFileStructureDesc(StartIndex=40, Length=1, FalseLabel='N', TrueLabel='O',
											Justification = JUSTIFY_LEFT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Multicre';
SelfDesc[SelfDesc.Items].ItemReference = Self.Multicre;
SelfDesc[SelfDesc.Items].ItemUserName = 'Multicre';

-- #12  41,3,3A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=41, Length=3,
									     Justification = JUSTIFY_RIGHT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'CodeEtat';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeEtat;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeEtat';

-- #13  44,1,1A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=44, Length=1,
									     Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'TypeClientTiers1';
SelfDesc[SelfDesc.Items].ItemReference = Self.TypeClientTiers1;
SelfDesc[SelfDesc.Items].ItemUserName = 'TypeClientTiers1';

-- #14  45,7,7A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=45, Length=7,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'NumeroClient1';
SelfDesc[SelfDesc.Items].ItemReference = Self.NumeroClient1;
SelfDesc[SelfDesc.Items].ItemUserName = 'NumeroClient1';

-- #15  52,1,1A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=52, Length=1,
										 Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'TypeClientTiers2';
SelfDesc[SelfDesc.Items].ItemReference = Self.TypeClientTiers2;
SelfDesc[SelfDesc.Items].ItemUserName = 'TypeClientTiers2';

-- #16  53,7,7A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=53, Length=7,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'NumeroClient2';
SelfDesc[SelfDesc.Items].ItemReference = Self.NumeroClient2;
SelfDesc[SelfDesc.Items].ItemUserName = 'NumeroClient2';

-- #17  60,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=60, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Date1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Date1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date1';

-- #18  67,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=67, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Date2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Date2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date2';

-- #19  74,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=74, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Date3';
SelfDesc[SelfDesc.Items].ItemReference = Self.Date3;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date3';

-- #20  81,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=81, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'Date4';
SelfDesc[SelfDesc.Items].ItemReference = Self.Date4;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date4';

-- #21  88,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=88, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateValeur1';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateValeur1;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateValeur1';

-- #22  95,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=95, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateValeur2';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateValeur2;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateValeur2';

-- #23  102,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=102, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateValeur3';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateValeur3;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateValeur3';

-- #24  109,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=109, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter = '0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateValeur4';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateValeur4;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateValeur4';

-- #25  116,3,3A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=116, Length=3,
										 Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'Devise1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Devise1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Devise1';

-- #26  119,3,3A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=119, Length=3,
										 Justification = JUSTIFY_LEFT, CompletionCharacter = ' '));
SelfDesc[SelfDesc.Items].ItemName = 'Devise2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Devise2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Devise2';

-- #27  122,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=122, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant1';

-- #28  137,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=137, Length=15, NbFrac=2, DecimalSeparator=FALSE,
										    Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant2';

-- #29  152,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=152, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant3';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant3;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant3';

-- #30  167,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=167, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant4';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant4;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant4';

-- #31  182,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=182, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant5';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant5;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant5';

-- #32  197,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=197, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant6';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant6;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant6';

-- #33  212,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=212, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant7';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant7;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant7';

-- #34  227,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=227, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant8';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant8;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant8';

-- #35  242,2,2A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=242, Length=2,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'CodeSynonyme1';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeSynonyme1;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeSynonyme1';

-- #36  244,20,20A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=244, Length=20,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'Compte1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Compte1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Compte1';

-- #37  264,2,2A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=264, Length=2, 
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'CodeSynonyme2';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeSynonyme2;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeSynonyme2';

-- #38  266,20,20A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=266, Length=20,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Compte2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Compte2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Compte2';

-- #39  286,2,2A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=286, Length=2, 
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'CodeSynonyme3';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeSynonyme3;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeSynonyme3';

-- #40  288,20,20A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=288, Length=20, 
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Compte3';
SelfDesc[SelfDesc.Items].ItemReference = Self.Compte3;
SelfDesc[SelfDesc.Items].ItemUserName = 'Compte3';

-- #41  308,7,7A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=308, Length=7,
				                         Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'NoCheque';
SelfDesc[SelfDesc.Items].ItemReference = Self.NoCheque;
SelfDesc[SelfDesc.Items].ItemUserName = 'NoCheque';

-- #42  315,30,30A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=315, Length=30,
										 Justification = JUSTIFY_LEFT, CompletionCharacter= ' '));
SelfDesc[SelfDesc.Items].ItemName = 'Libelle1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Libelle1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Libelle1';

-- #43  345,30,30A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=345, Length=30,
										 Justification = JUSTIFY_LEFT, CompletionCharacter= ' '));
SelfDesc[SelfDesc.Items].ItemName = 'Libelle2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Libelle2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Libelle2';

-- #44  375,6,6A (Mois de tarification = nn)
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=375, Length=6,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Rubrique1';
SelfDesc[SelfDesc.Items].ItemReference = Self.Rubrique1;
SelfDesc[SelfDesc.Items].ItemUserName = 'Rubrique1';

-- #45  381,6,6A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=381, Length=6,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Rubrique2';
SelfDesc[SelfDesc.Items].ItemReference = Self.Rubrique2;
SelfDesc[SelfDesc.Items].ItemUserName = 'Rubrique2';

-- #46  387,6,6A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=387, Length=6,
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Rubrique3';
SelfDesc[SelfDesc.Items].ItemReference = Self.Rubrique3;
SelfDesc[SelfDesc.Items].ItemUserName = 'Rubrique3';

-- #47  393,6,6A
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex=393, Length=6, 
										 Justification = JUSTIFY_RIGHT, CompletionCharacter=' '));
SelfDesc[SelfDesc.Items].ItemName = 'Rubrique4';
SelfDesc[SelfDesc.Items].ItemReference = Self.Rubrique4;
SelfDesc[SelfDesc.Items].ItemUserName = 'Rubrique4';

-- #48  399,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=399, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantCommission1';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantCommission1;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantCommission1';

-- #49  414,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=414, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateCommission1';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateCommission1;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateCommission1';

-- #50  421,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=421, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantTVA1';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantTVA1;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantTVA1';

-- #51  436,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=436, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantCommission2';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantCommission2;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantCommission2';

-- #52  451,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=451, Length=7, Sign=SIGN_DISABLE, 
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateCommission2';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateCommission2;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateCommission2';

-- #53  458,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=458, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantTVA2';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantTVA2;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantTVA2';

-- #54  473,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=473, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantCommission3';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantCommission3;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantCommission3';

-- #55  488,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=488, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateCommission3';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateCommission3;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateCommission3';

-- #56  495,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=495, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantTVA3';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantTVA3;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantTVA3';

-- #57  510,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=510, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantCommission4';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantCommission4;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantCommission4';

-- #58  525,7,7N
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=525, Length=7, Sign=SIGN_DISABLE,
											Justification = JUSTIFY_RIGHT, CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'DateCommission4';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateCommission4;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateCommission4';

-- #59  532,15,13V99
SelfDesc.AppendRow(NumericFileStructureDesc(StartIndex=532, Length=15, NbFrac=2, DecimalSeparator=FALSE,
											Justification = JUSTIFY_RIGHT, Sign = SIGN_ALWAYS, 
											CompletionCharacter='0'));
SelfDesc[SelfDesc.Items].ItemName = 'MontantTVA4';
SelfDesc[SelfDesc.Items].ItemReference = Self.MontantTVA4;
SelfDesc[SelfDesc.Items].ItemUserName = 'MontantTVA4';


end method;

------------------------------------------------------------
method OperationDiverseDesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = OperationDiverseDS;
end method;

------------------------------------------------------------
method OperationDiverseDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method OperationDiverseDS.DoStartService
begin

end method;

------------------------------------------------------------
method OperationDiverseDS.Init
begin
super.Init();

-- Initialisation du FileDataServiceDesc attaché à OperationDiverseDesc

Task.Part.LogMgr.PutLine('Passé dans DoStartService');

unOperationDiverseDesc : OperationDiverseDesc = new();
unOperationDiverseDesc.DoResetAttributes();
unOperationDiverseDesc.SelfDesc = new();
unOperationDiverseDesc.DoResetSelfDesc();
self.FileMap = unOperationDiverseDesc;

Filename.SetValue('c:\\tests\\ods.txt');
DefaultFillerCharacter = ' ';

self.RecordLength = 546;
self.FlagRead = FALSE;
self.FlagAppend = TRUE;
self.FlagRewrite = TRUE;

StartService();
end method;

------------------------------------------------------------
method RegleBS.AppendPrixPublic(input pTransdata: DataAccessSrvBD.TransDesc)
begin
pTransdata.TransactionService = ACT_STD_APPEND;
self.Transfer(pTransdata,soTarificationDSMgr,RegleDS);
end method;

------------------------------------------------------------
method RegleBS.CompileRegle(input aRegle: TarificationSrv.RegleDesc)
begin
--
--	Description :	le champ montant de la regle doit être syntaxiquement correcte et de type numérique ou entier
--					le champ condition de la regle doit être syntaxiquement correcte et de type booleen 
--					lorsqu'il s'agit d'une regle spécifique et non d'un prix public. Ce dernier n'étant pas soumis
--					a condition				
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :   Input 		--> aRegle : regleDesc : la règle à compiler
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

UnItemName : string = 'Montant';
ExpCompilee : ExpressionCompilee = unCompilateur.Compile(aRegle.Montant.Value);
TypeExpression : integer = ExpCompilee.VerifieType();

if TypeExpression <> AttributionTypeDecimal then
		Exc : RegleTypeInvalideExc = New();
		aMessageText : String;
		if aRegle.PrixPublicBln then
			aMessageText  = ('L''évaluation du Prix Public renvoit une valeur non décimale');
		else
			aMessageText  = ('L''évaluation de la règle renvoit une valeur non décimale');
		end if;
		Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
		Task.ErrorMgr.AddError(Exc);
		Exc.ItemName = 'Montant';
		raise Exc;
end if;

-- si prix public pas de condition donc aucun test
if not aRegle.PrixPublicBln then
	UnItemName = 'Condition';
	ExpCompilee = unCompilateur.Compile(aRegle.Condition.Value);
	TypeExpression = ExpCompilee.VerifieType();
	if TypeExpression<> TYPE_BOOLEEN then
		Exc : RegleTypeInvalideExc = New();
		aMessageText : String;
		aMessageText  = ('La condition de la règle renvoit une valeur différente de VRAI ou FAUX');
		Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
		Task.ErrorMgr.AddError(Exc);	
		raise Exc;
	end if;
end if;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.CompileRegle: End');

Exception
	when e : RegleTypeInvalideExc do
		Raise;
		
	when e : ErreurCompilateur do
		uneexc : RecordValidityExc = New(ItemName =UnItemName, Message = e.Message,Severity = e.Severity);
		Raise uneexc;


	
end method;

------------------------------------------------------------
method RegleBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  JB BRIAUD | 29/05/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.DoAction');




anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_READPRIXPUBLIC do
		aRegleParam : RegleParam = New();
		aRegleParam = (RegleParam)(aTransData.TransObject);
		anObject = LirePrixPublic(aRegleParam.CodeDevise,aRegleParam.CodeCategorie,aRegleParam.CodePackage,
			aRegleParam.CodeProduit,aRegleParam.CodeService,aRegleParam.CodePromotion);
	when ACT_TARIF_READALL_REGLE do
		DateReference : DateTimeData = (DateTimeData)(aTransData.TransObject);
		anObject = lireReglesValides(DateReference);
	when ACT_TARIF_APPEND_SANSCONTROLE do
		self.AppendPrixPublic(aTransdata);
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.DoAction : End');

return anObject;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleBS.DoAction');
		Raise;
		
		
end method;

------------------------------------------------------------
method RegleBS.DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.DoBeforeUpdate');

self.VerifieRegle(RegleDesc((CacheDesc) (aTransdata.TransObject).Record));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.DoBeforeUpdate');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method RegleBS.DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.DoBeforeUpdate');

self.VerifieRegle(RegleDesc((CacheDesc) (aTransdata.TransObject).Record));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.DoBeforeUpdate');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleBS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method RegleBS.Init
begin
super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.Init');

Self.FlagRead = TRUE;
Self.FlagUpdate = TRUE;
Self.FlagDelete = TRUE;
Self.FlagAppend = TRUE;
Self.BusinessClass = RegleDesc();

--unContexte = ContexteTarification();
unCompilateur = new(Contexte = unContexte);
if DECIMAL_NUMBERS_MAPPING = MAP_DECIMAL_TO_DOUBLE then
   unCompilateur.MapDecimalToDouble();
   AttributionTypeDecimal = TYPE_NUMERIQUE;
else
   unCompilateur.MapDecimalToDecimal();
   AttributionTypeDecimal = TYPE_DECIMAL;
end if;

unCompilateur.ClearPres();
unCompilateur.AppendPre(uneCle=CST_TARIF_A_RENSEIGNER,unObjet='1.0');
unCompilateur.AppendPre(uneCle=CST_TARIF_CATEGORIE,unObjet='1.0');
unCompilateur.AppendPre(uneCle=CST_TARIF_CATEGORIE_STANDARD,unObjet='1.0');
unCompilateur.AppendPre(uneCle=CST_TARIF_DE_REFERENCE,unObjet='1.0');
unCompilateur.AppendPre(uneCle=CST_TARIF_PRIX_PUBLIC,unObjet='1.0');
unCompilateur.AppendPre(uneCle=CST_TARIF_SANS_PROMOTION,unObjet='1.0');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.Init : End');
end method;

------------------------------------------------------------
method RegleBS.LirePrixPublic(input aDevise: DicoBD.RefDeviseDesc,
	input aCategorie: DicoBD.RefTarifDesc,
	input aPackage: AddDicoBD.RefTypePackageDesc,
	input aProduit: DicoBD.RefTypeProduitDesc,
	input aService: AddDicoBD.RefTypeServiceDesc,
	input apromotion: AddDicoBD.RefTypePromotionDesc): Framework.Array of TarificationSrv.RegleDesc
begin
--
--	Description :	Lecture des prix publics correspondants à 
--						-un Code Devise
--						-un Code Categorie
--						-un Code Package
--						-un Code Produit
--						-un Code Service
--						-un Code Promotion
--	Type :	
--
--
--	Parametres :	correspondent aux critères de sélection des Prix Public
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : lorsque l'on vérifie l'existence et la continuité de prix public pour une période donnée
--					à partir de l'ensemble des règles existentes. RegleProc
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.LirePrixPublic');




pTransdata : Transclass = New();
pTransdata.TransActionService = ACT_STD_READ;

UnCache: Array of CacheDesc = New();
--DEFINITION DU CONTEXTE D'APPLICATION DU PRIX PUBLIC

pTransdata.aRecordSelfDesc.selfDesc = New();
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereDevise';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aDevise;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereCategorie';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aCategorie;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WherePackage';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aPackage;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereProduit';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aProduit;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aService;
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WherePromotion';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = aPromotion;


--LECTURE DES PRIX PUBLIC CORRESPONDANT AUX CRITERES DEFINIS PRECEDEMMENT



UnCache = (Array of CacheDesc)(Transfer(pTransdata,soTarificationBSMgr,RegleBS));

UneRegle : RegleDesc = New();
ListeRegle : Array of RegleDesc = New();

--CAST DE CACHEDESC EN REGLEDESC
if UnCache <> NIL and UnCache.Items > 0 then
	for UnCacheDesc in UnCache do
		if UnCacheDesc <> NIL then
			UneRegle = (RegleDesc)(UnCacheDesc.Record);
			--ON NE VEUT QUE LES PRIX PUBLIC
			if UneRegle.PrixPublicBln then
				ListeRegle.AppendRow(UneRegle);
			end if;
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.LirePrixPublic : End');

return ListeRegle;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleBS.LirePrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleBS.LireReglesValides(input DateReference: Framework.DateTimeData): Framework.Array of TarificationSrv.RegleDesc
begin


TableRegle : Array of RegleDescSql = New();

sql select id,CodeCategorie,CodeDevise,CodePackage,CodeProduit,CodePromotion,CodeService,CodeStrategie,
Commentaire,Condition,DateDebutValidite,DateFinValidite,DateProduction,Montant,NomRegle,PrixPublicBln,
ProductionBln into :TableRegle from Regles
where DateDebutValidite <= :DateReference and  DateFinValidite >= :DateReference
on Session soTarificationDBSession;

return TableRegle;
end method;

------------------------------------------------------------
method RegleBS.VerifieMacros(input UneRegle: TarificationSrv.RegleDesc)
begin
--
--	Description :	Une règle ou un prix public défini dans un contexte : hors package, hors promotion et 
--					catégorie = standard ne peut faire réference au Tarif Normal car il représente le tarif normal
--					par défaut.
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.VerifieTarifNormal');

Exc : IllegalTarifExc = New();
Exc.ItemName = 'Montant';
aMessageText :TextData = New();
PresenceErreurTarif : boolean = FALSE;

--TARIF CATEGORIE STANDARD
if UneRegle.CodeCategorie.Value = IDX_CATEGORIE_STANDARD then 		
		 PresenceErreurTarif = UnCompilateur.DoesExpand(UneRegle.Montant,CST_TARIF_CATEGORIE_STANDARD);
		 if PresenceErreurTarif then
			aMessageText.SetValue('La règle définie pour la catégorie Standard et hors d''une promotion correspond au Tarif_Categorie_Standard et ne peut donc s''y référer.');
			Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
			Raise Exc;		
		end if;		
end if;

--TARIF SANS PROMOTION ET TARIF CATEGORIE
If UneRegle.CodePromotion.Value = IDX_HORS_PROMOTION then
	PresenceErreurTarif = UnCompilateur.DoesExpand(UneRegle.Montant,CST_TARIF_SANS_PROMOTION) ;
	if PresenceErreurTarif then
		aMessageText.SetValue('La règle définie dans un contexte Hors Promotion ou Hors Package correspond au Tarif_sans_promotion et ne peut donc s''y référer.');
		Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
		Raise Exc;
	end if;
	if UneRegle.CodePackage.Value = IDX_HORS_PACKAGE then  --hors promo et hors pacakge
		PresenceErreurTarif = UnCompilateur.DoesExpand(UneRegle.Montant,CST_TARIF_CATEGORIE);
		if PresenceErreurTarif then
			aMessageText.SetValue('La règle définie dans un contexte Hors Package et hors promotion correspond au Tarif_categorie et ne peut donc s''y référer.');
			Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
			Raise Exc;
		end if;
	end if;
end if;

--TARIF DE REFERENCE
If UneRegle.CodeCategorie.IntegerValue =IDX_CATEGORIE_STANDARD and UneRegle.CodePackage.IntegerValue = IDX_HORS_PACKAGE and UneRegle.CodePromotion.IntegerValue=IDX_HORS_PROMOTION then
	--Recherche de la chaîne Tarif Normal dans le champ montant
 	PresenceErreurTarif = UnCompilateur.DoesExpand(UneRegle.Montant,CST_TARIF_DE_REFERENCE);
 	if PresenceErreurTarif  then
		aMessageText  = ('Le prix public hors promotion, hors package et défini pour la catégorie standard correspond au Tarif_de_Reference et ne peut donc pas s''y réferer');
		Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
		Raise Exc;
	end if;
end if;

--TARIF PRIX PUBLIC
If UneRegle.prixPublicBln then
	PresenceErreurTarif = UnCompilateur.DoesExpand(UneRegle.Montant,CST_TARIF_PRIX_PUBLIC) ;
	if PresenceErreurTarif then
		aMessageText.SetValue('Un Prix Public correspond au Prix_Public et ne peut donc s''y référer.');
		Exc.SetWithParams(severity = SP_ER_ERROR, message =aMessageText);
		Raise Exc;
	end if;
end if;

			







Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.VerifieTarifNormal : End');

Exception
	when e: GenericException do
		Raise;
end method;

------------------------------------------------------------
method RegleBS.VerifieRegle(input aRegle: TarificationSrv.RegleDesc)
begin
--
--	Description :	Ensemble des vérifications à réaliser avant de mettre à jour la table des données
--
--	Type :	
--
--
--	Parametres :	aRegle : regleDesc : Regle à vérifier
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : DoBeforeAppend et DoBeforeUpdate
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleBS.VerifieRegle');

-- verification sur la présence obligatoire ou facultative de l'ensemble des champs et de leur valeur 
aRegle.DoCheckValidity();
-- certaines règles ne peuvent faire réference à TARIF_NORMAL car elles sont le tarif normal par défaut
self.VerifieMacros(aRegle);
-- verification syntaxique et contrôle de type sur les champs montant et conditionde la regle
self.CompileRegle(aRegle);


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleBS.VerifieRegle : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleBS.VerifieRegle');
		Raise;
end method;

------------------------------------------------------------
method RegleDesc.DoCheckValidity: Framework.boolean
begin
--
--	Description : 	contrôle l'ensemble des attributs de self.UneRegle : RegleDesc
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	History :
--

--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity ');

aResult : boolean = TRUE;

--Controle de cohérence des dates et champ montant non vide

unItemName : string;

unItemName = 'CodeDevise';
self.CodeDevise.DoCheckValidity();

unItemName = 'CodeCategorie';
self.CodeCategorie.DoCheckValidity();

unItemName = 'CodePackage';
self.CodePackage.DoCheckValidity();

unItemName = 'CodeProduit';
self.CodeProduit.DoCheckValidity();

unItemName = 'CodeService';
self.CodeService.DoCheckValidity();

unItemName = 'CodePromotion';
self.CodePromotion.DoCheckValidity();
	
unItemName = 'DateDebutValidite';
self.VerifieDate(); 
	
unItemName = 'Montant';
Montant.DoCheckValidity();

unItemName = 'Commentaire';
Commentaire.DoCheckValidity(FALSE,TRUE);
		
-- si ce n'est pas un prix public, la condition et le nom de la regle sont obligatoires
if not PrixPublicBln then
	unItemName = 'Condition';
	Condition.DoCheckValidity();
	unItemName = 'NomRegle';		
	NomRegle.DoCheckValidity();
else
	unItemName = 'CodeStrategie';
	CodeStrategie.DoCheckValidity();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity : End');

return aResult;

Exception 
when e: RecordValidityExc do
	e.ItemName = unItemName;
	Raise ;



		
end method;

------------------------------------------------------------
method RegleDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+

Self.CodeCategorie = New();
Self.CodeDevise = New();
Self.CodeService = New();
Self.CodePackage = New();
Self.CodeProduit = New();
Self.CodeStrategie= New();
Self.CodePromotion = New();
Self.Commentaire = New();
Self.Condition = New();
Self.Montant = New();
Self.NomRegle = New();
Self.PrixPublicBln = New(value = FALSE);
Self.ProductionBln = New(value = FALSE);
self.DateProduction = New();
Self.DateDebutValidite = New();
Self.DateFinValidite = New();




end method;

------------------------------------------------------------
method RegleDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();


--MANQUE TRAITEMENT VALIDITE

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id Service';
--SelfDesc[SelfDesc.Items].ParentItemName='CodeService';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeCategorie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeCategorie;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeCategorie';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'PrixPublicBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.PrixPublicBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'PrixPublicBln';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'ProductionBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.ProductionBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'ProductionBln';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'dateProduction';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateProduction;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateProduction';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeDevise';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeDevise;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeDevise';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePackage';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeProduit';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodePromotion';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePromotion;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePromotion';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeStrategie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeStrategie;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Strategie';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'NomRegle';
SelfDesc[SelfDesc.Items].ItemReference = Self.NomRegle;
SelfDesc[SelfDesc.Items].ItemUserName = 'NomRegle';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Commentaire';
SelfDesc[SelfDesc.Items].ItemReference = Self.Commentaire;
SelfDesc[SelfDesc.Items].ItemUserName = 'Commentaire';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Condition';
SelfDesc[SelfDesc.Items].ItemReference = Self.Condition;
SelfDesc[SelfDesc.Items].ItemUserName = 'Condition';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Montant';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateDebutValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebutValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de début de validité';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFinValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFinValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de fin de validité';
end method;

------------------------------------------------------------
method RegleDesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = RegleDS;


end method;

------------------------------------------------------------
method RegleDesc.Init
begin
super.Init();

end method;

------------------------------------------------------------
method RegleDesc.VerifieDate: Framework.boolean
begin
--
--	Description : vérifie que :	- la date de fin de validité d'une règle est supérieure à la date de début.
--								- la date de fin soit bien inférieur à DATE_INFINI									
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	BL	|	02/01/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleDesc.VerifieDate');

-- Declarations
DateInfini : DateTimeData = New(Value = DATE_INFINI);
unResultat : Boolean = TRUE;
DateSupInfini : Boolean = FALSE;


-- Contrôle de cohérence entre date de fin et date de début
if (DateDebutValidite.IsGreaterThan(DateFinValidite)) then
   	unResultat = FALSE;
else 
   	unResultat = TRUE;
   	-- Contrôle sur la date de fin < Date infini
   	if DateFinValidite.IsGreaterThan(DateInfini) then
   		DateSupInfini = TRUE;
   	end if;
end if;


--Gestion des erreurs
if not unResultat then 
-- Incohérence
	Exc : RecordValidityExc = New();
	aMessageText : String;
	if PrixPublicBln then
		aMessageText  = ('La date de début de validité du prix public doit être inférieure à la date de fin');
	else
		aMessageText  = ('La date de début de validité d''une règle doit être inférieure à la date de fin');		
	end if;
	Exc.SetWithParams(severity = SP_ER_ERROR, message = aMessageText);
	Task.ErrorMgr.AddError(Exc);
	raise Exc;
else
	--Cohérence mais date de fin > Date Infini
	if DateSupInfini then
		aFormat : DateFormat = New(Template = 'dd/mm/yyyy');
		adate : TextData = New();
		adate = aFormat.FormatDate(DateInfini);
		Exc : RecordValidityExc = New();
		if PrixPublicBln then
			Exc.SetWithParams(severity = SP_ER_ERROR, 
			message = 'La date de fin de validité du prix public doit être inférieure au : %1',
			param1 = aDate);
		else
			Exc.SetWithParams(severity = SP_ER_ERROR, 
			message = 'La date de fin de validité d''une règle doit être inférieure au : %1',
			param1 =  aDate);
		end if;
		Task.ErrorMgr.AddError(Exc);
		raise Exc;
	end if;
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.VerifieDate : End');
Return unResultat;


Exception
	when e : GenericException do
		Raise;





end method;

------------------------------------------------------------
method RegleDescSql.Init
begin
super.Init();
Self.DoResetAttributes();
end method;

------------------------------------------------------------
method RegleDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  JB BRIAUD | 05/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'CodeCategorie = :WhereCategorie and CodeDevise = :WhereDevise and CodeProduit = :WhereProduit and CodePackage = :WherePackage and CodeService = :WhereService and CodePromotion = :WherePromotion';
Self.ClauseFrom    = 'Regles';
Self.ClauseOrderBy    = 'DateDebutValidite ,CodeCategorie';
Self.RecordInstance = RegleDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method RegleDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RegleParam.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+

Self.CodeCategorie = New();
Self.CodeDevise = New();
Self.CodeService = New();
Self.CodePackage = New();
Self.CodeProduit = New();
Self.CodePromotion = New();





end method;

------------------------------------------------------------
method RegleParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ServiceOD.Init
begin
super.Init();
CodeOD = '';
RubriqueOD = 0;
Libelle1 = new();
Libelle2 = new();
end method;

------------------------------------------------------------
method SessionSrv.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarifClientBS.Init
begin
super.Init();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarifClienteBS.Init');
Self.FlagRead = TRUE;
Self.FlagUpdate = FALSE;
Self.FlagDelete = FALSE;
Self.FlagAppend = FALSE;
Self.BusinessClass = TarifClientDesc();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarifClientBS.Init : End');
end method;

------------------------------------------------------------
method TarifClientDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+

self.CodeClient = New();
Self.CodeDevise = New();
Self.CodeService = New();
Self.CodeProduit = New();
Self.Montant = New();
Self.DateDebutValidite = New();
Self.DateFinValidite = New();




end method;

------------------------------------------------------------
method TarifClientDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id Service';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeClient';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeClient;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id Client';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeDevise';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeDevise;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeDevise';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeProduit';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Montant';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateDebutValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebutValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de début de validité';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFinValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFinValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de fin de validité';
end method;

------------------------------------------------------------
method TarifClientDesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = TarifClientDS;


end method;

------------------------------------------------------------
method TarifClientDesc.Init
begin
super.Init();
CodeClient = new();
CodeDevise = new();
CodeService = new();
CodeProduit = new();
Montant = new();
end method;

------------------------------------------------------------
method TarifClientDS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  JB BRIAUD | 05/06/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarifClientDS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'CodeDevise = :WhereDevise and CodeProduit = :WhereProduit and CodeService = :WhereService';
Self.ClauseFrom    = 'TarifClient';
Self.ClauseOrderBy    = 'CodeClient';
Self.RecordInstance = TarifClientDesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientDS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientPrivilegeDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method TarifClientDS.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarificationBSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--	D. NGUYEN	|	25/07/1997	|	Simplification de l'instanciation des services pour l'utilisateur.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationBSMgr.InitService');

-- Declarations



-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.AppendRow(aIdent = RegleBS);
Self.AppendRow(aIdent = TarifClientBS);
Self.AppendRow(aIdent = EvenementTarificationBS);
Self.AppendRow(aIdent = OperationDiverseBS);
Self.AppendRow(aIdent = TauxTVABS);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationBSMgr.InitService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationBSMgr.InitService');
		Raise;
 
end method;

------------------------------------------------------------
method TarificationBSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour le démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--

--+

Self.Dependances.AppendRow(SoNotificationSrv);
Self.NotificationService = SoNotificationSrv; 
Self.Dependances.AppendRow(soTarificationDSMgr);
Self.Dependances.AppendRow(soCatalogueBSMgr); -- indispensable pour le fonctionnement de RegleProc dont les services
								--font appel à des services du catalogue produit

end method;

------------------------------------------------------------
method TarificationBSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarificationDSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationDSMgr.DoAfterSyncServices');

Self.AppendRow(RegleDS);
Self.AppendRow(TarifClientDS);
Self.AppendRow(EvenementTarificationDS);

unOperationDiverseDS : OperationDiverseDS = new();
unOperationDiverseDS.DoStartService();
Self.AppendRow(OperationDiverseDS,unOperationDiverseDS);

Self.AppendRow(TauxTVADS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationDSMgr.DoAfterSyncServices : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationDSMgr.DoAfterSyncServices');
		Raise;
end method;

------------------------------------------------------------
method TarificationDSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances de démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : DataServiceMgrDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationDSMgr.DoInitService');

-- Declarations
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Self.Dependances.AppendRow(soTarificationDBSession);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationDSMgr.DoInitService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationDSMgr.DoInitService');
		Raise;
end method;

------------------------------------------------------------
method TarificationDSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TauxTVABS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Recherche du taux valide
--
--	Type :	Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  PMT	  | 11/07/1998  |   Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.DoAction');


unDoubleNullable : DoubleNullable;
 
 case aTransData.TransActionService is
 
	when ACT_TARIF_TAUX do
		DateReference : DateTimeData = (DateTimeData) (aTransData.TransObject);
		unDoubleNullable = TrouverTauxValide(DateReference);
		
	else
		Exc : ImplementationExc = new();
		Exc.SetWithParams(SP_ER_ERROR,'Action non définie dans TauxTVABS.DoAction');
		raise Exc;
		
 end case;
  
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TauxTVABS.DoAction : End');

return unDoubleNullable;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TauxTVABS.DoAction');
		Raise;
		
		
end method;

------------------------------------------------------------
method TauxTVABS.DoBeforeAppend(input output aTransdata: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.DoBeforeAppend');


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TauxTVABS.DoBeforeAppend : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TauxTVABS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method TauxTVABS.DoBeforeUpdate(input output aTransData: DataAccessSrvBD.TransDesc)
begin
--
--	Description :	Verification à réaliser avant la mise à jour dans la base d'une règle
-- 
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> pTransdata :	Communication structure.
--					
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.DoBeforeUpdate');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TauxTVABS.DoBeforeUpdate : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TauxTVABS.DoBeforeUpdate');
		Raise;
end method;

------------------------------------------------------------
method TauxTVABS.Init
begin
super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.Init');

Self.FlagRead = TRUE;
Self.FlagUpdate = FALSE;
Self.FlagDelete = FALSE;
Self.FlagAppend = TRUE;
Self.BusinessClass = TauxTVADesc();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.Init : End');


end method;

------------------------------------------------------------
method TauxTVABS.TrouverTauxValide(input DateReference: Framework.DateTimeData): Framework.DoubleNullable
begin
--
--	Description :	Lecture du taux en cours de validité
--
--	Type :	Concret
--
--
--	Parametres :	DateReference : La date à utiliser pour la comparaison
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : 
--
--	Historique :
--
--	PMT		| 11/07/1998	| Création

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVABS.TrouverTauxValide');

pTransdata : Transclass = new();
pTransdata.TransActionService = ACT_STD_READ;

UnCache: Array of CacheDesc = New();

pTransdata.aRecordSelfDesc.selfDesc = New();
pTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereDateReference';
pTransdata.aRecordSelfDesc.SelfDesc[pTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = DateReference;


UnCache = (Array of CacheDesc)(Transfer(pTransdata,soTarificationBSMgr,TauxTVABS));
TauxConversion : DoubleNullable;

UnTauxTVADesc : TauxTVADesc = new();
if UnCache <> NIL and UnCache.Items > 0 then

   if unCache.Items <> 1 then
   		Exc : GenericExc = new();
   		Exc.SetWithParams(SP_ER_ERROR,'Un seul taux de conversion TVA possible');
   		raise Exc;
   else
		unCache : CacheDesc = unCache[1];
   		unTauxTVADesc = (TauxTVADesc) (unCache.Record);
   end if;
   
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TauxTVABS.TrouverTauxValide : End');

return TauxConversion;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TauxTVABS.TrouverTauxValide');
		Raise;
end method;

------------------------------------------------------------
method TauxTVADesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	PMT		|	11/07/98	| Création

--+

self.DateDebut = new();
Self.DateFin = new();
Self.TauxTVA = New();




end method;

------------------------------------------------------------
method TauxTVADesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	PMT		|	11/07/1998	|	Création.
--+

SelfDesc.clear();

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateDebut';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebut;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateDebut';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'DateFin';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFin;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateFin';

SelfDesc.AppendRow();
SelfDesc[SelfDesc.Items].ItemName = 'Taux';
SelfDesc[SelfDesc.Items].ItemReference = Self.TauxTVA;
SelfDesc[SelfDesc.Items].ItemUserName = 'TauxTVA';


end method;

------------------------------------------------------------
method TauxTVADesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = TauxTVADS;


end method;

------------------------------------------------------------
method TauxTVADesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TauxTVADS.DoInitServiceSQL
begin
--
--	Description :	Définition du SQL utilisé par le DataService.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : DataServiceSqlDesc
--
--	Historique :
--
--  PMT	 | 11/07/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TauxTVADS.DoInitServiceSQL');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

--Self.ClauseSelect  = '';
Self.ClauseWhere = 'DateDebut>= :WhereDateReference and :WhereDateReference<= DateFin';
Self.ClauseFrom    = 'TauxTVA';
Self.ClauseOrderBy    = 'DateDebut';
Self.RecordInstance = TauxTVADesc();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TauxTVADS.DOInitServiceSQL : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientPrivilegeDS.DOInitServiceSQL');
		Raise;
end method;

------------------------------------------------------------
method TauxTVADS.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'tarifica';


end TarificationSrv;
begin TOOL MoteurTarifSrv;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes CompilateurClasses;
includes ContexteClt;
includes ContexteSrv;
includes ContexteTarificat;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes DicoBD;
includes ExpressionClasses;
includes FrameworkBD;
includes GenericDBMS;
includes Framework;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  Anomalie;
forward  AnomalieEvaluationExc;
forward  DatesValidite;
forward  MoteurBS;
forward  MoteurBSControles;
forward  MoteurBSMgr;
forward  MoteurBSProduction;
forward  Noeud;
forward  NoeudIntermediaire;
forward  NoeudPorteurDeRegles;
forward  NoeudServices;
forward  Privilege;
forward  Regle;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant ACT_TARIF_COMPILE = 50003;
constant ACT_TARIF_CONTROLE = 50004;
constant ACT_TARIF_EVALUE = 50001;
constant ACT_TARIF_INITIALISE = 50002;
constant ERR_COMPILE_ABSENCE_TARIF_HORS_CATEGORIE_STANDARD = 2001;
constant ERR_COMPILE_ABSENCE_TARIF_HORS_PACKAGE = 2002;
constant ERR_COMPILE_ABSENCE_TARIF_HORS_PROMOTION = 2003;
constant ERR_COMPILE_CONDITION_MAL_FORMEE = 2004;
constant ERR_COMPILE_CONDITION_MAL_FORMEE_OU_TYPE_INCORRECT = 2005;
constant ERR_COMPILE_EVALUATION_DOIT_ETRE_NUMERIQUE = 2006;
constant ERR_COMPILE_EVALUATION_MAL_FORMEE = 2007;
constant ERR_COMPILE_EXCEPTION = 2008;
constant ERR_COMPILE_LISTEREGLES_NIL = 2009;
constant ERR_COMPILE_PRIVILEGE_MAL_TYPE = 2010;
constant ERR_CONSTRUCTION_LISTE_REGLES_CONSTRUITE_TROP_TARD = 3001;
constant ERR_CONSTRUCTION_NOEUD_SERVICE_A_NIL = 3002;
constant ERR_CONSTRUCTION_STRATEGIE_INVALIDE = 3003;
constant ERR_CONSTRUCTION_TARIF_CLIENT_INCORRECT = 3004;
constant ERR_EVT_REJETE_CATEGORIE_INCONNUE = 4001;
constant ERR_EVT_REJETE_DEVISE_INCONNUE = 4002;
constant ERR_EVT_REJETE_INVALIDE = 4003;
constant ERR_EVT_REJETE_PACKAGE_INCONNU = 4004;
constant ERR_EVT_REJETE_PRODUIT_INCONNU = 4005;
constant ERR_EVT_REJETE_PROMOTION_INCONNUE = 4006;
constant ERR_EVT_REJETE_RAISON_INCONNUE = 4007;
constant ERR_EVT_REJETE_REGLE_INCONNUE = 4008;
constant ERR_EVT_REJETE_SERVICE_INCONNU = 4009;
constant ERR_EVT_REJETE_TARIF_IMPOSSIBLE = 4010;
constant ERR_EVT_TARIFE = 1;
constant ERR_MOTEUR_CODE_ACTION_INCORRECT = 1000;
constant EVT_CREE = 2;
constant EVT_VALIDE = 0;
constant LOG_GRPFLAG = 65;
constant SHOW_STRINGS = TRUE;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class Anomalie inherits from Framework.Object

has public  attribute IDRegle: Framework.integer;
has public  attribute Message: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AnomalieEvaluationExc inherits from TarificationSrv.AnomalieTarificationExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DatesValidite inherits from Framework.Object

has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class MoteurBS inherits from DataAccessSrvBD.ServiceDesc

has public  constant DECIMAL_POINT = '.';

has public  attribute Arbre: MoteurTarifSrv.Noeud;
has public  attribute AttributionTypeDecimal: Framework.integer;
has public  attribute CompteurEval: Framework.integer;
has public  attribute CT: ContexteTarificat.ContexteTarification;
has public  attribute DateReference: Framework.DateTimeData;
has private attribute DerniereErreur: Framework.integer;
has public  attribute ErreursCompilation: Framework.Array of MoteurTarifSrv.Anomalie;
has public  attribute GoCompile: Framework.boolean;
has public  attribute NombreCompilees: Framework.integer;
has public  attribute NombreExpl: Framework.integer;
has public  attribute NombreListes: Framework.integer;
has public  attribute NombreNoeudsFin: Framework.integer;
has public  attribute NombreNoeudsInt: Framework.integer;
has public  attribute NombrePrivCrees: Framework.integer;
has public  attribute NombreRegles: Framework.integer;
has public  attribute NombreServInseres: Framework.integer;
has public  attribute PerformControls: Framework.boolean;
has public  attribute unCompilateur: CompilateurClasses.Compilateur;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method AnomalieTarification(input CodeErreur: Framework.integer);
has public  method AnomalieTarification(input Source: Framework.TextData,
	input Descr: Framework.TextData);
has public  method CalculerChemin(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method CalculerChemin(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method CompileCategoriesEtPrivileges(input leService: MoteurTarifSrv.NoeudServices);
has public  method CompilePackages(input lesPackages: Framework.Array of MoteurTarifSrv.Noeud,
	input TarifDeReference: Framework.TextData,
	input TarifCategoriesStandard: Framework.Array of Framework.TextData = NIL);
has public  method CompilePromotions(input lesPromotions: Framework.Array of MoteurTarifSrv.Noeud,
	input TarifDeReference: Framework.TextData,
	input TarifCategorieStandard: Framework.TextData,
	input TarifCategorie: Framework.TextData);
has public  method CompilerArbre;
has public  method CompileRegles(input lesRegles: Framework.Array of MoteurTarifSrv.Regle,
	input TarifDeReference: Framework.TextData,
	input TarifCategorieStandard: Framework.TextData,
	input TarifCategorie: Framework.TextData,
	input TarifSansPromotion: Framework.TextData);
has public  method CompilerUneRegle(input uneRegle: MoteurTarifSrv.Regle);
has public  method ConstruireArbre(input lesRegles: Framework.Array of TarificationSrv.RegleDesc,
	input lesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudIntermediaire;
has public  method ConstruireBranchePrivilege(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method ConstruireBrancheRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method DeterminerPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.TextData;
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc;
has public  method DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc;
has public  method DoStartService;
has public  method Evalue: Framework.NumericData;
has public  method EvalueCRE(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.NumericData;
has public  method EvaluerMaxiApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvaluerMiniApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvaluerPremierApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvalueTarifPrivilege(input leService: MoteurTarifSrv.NoeudServices): Framework.NumericData;
has public  method Init;
has public  method Initialise(input unContexte: ContexteTarificat.ContexteTarification,
	input GoCompile: Framework.boolean,
	input DoPerformControls: Framework.boolean);
has public  method LireDerniereErreur: Framework.integer;
has public  method LireErreursCompilation: Framework.Array of MoteurTarifSrv.Anomalie;
has public  method PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long);
has public  method PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData);
has public  method SubstituerMacrosVariables(input Tarif: Framework.TextData,
	input TarifDeReference: Framework.TextData = NIL,
	input TarifCategorieStandard: Framework.TextData = NIL,
	input TarifCategorie: Framework.TextData = NIL,
	input TarifSansPromotion: Framework.TextData = NIL,
	input TarifPrixPublic: Framework.TextData = NIL);
has public  method TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean;
has public  method TrouverCheminPrivileges(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudServices;
has public  method TrouverCheminRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudPorteurDeRegles;
has public  method TrouverListeRegles(input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData): Framework.Array of MoteurTarifSrv.Regle;
has public  method TrouveSousChemin(input CodeDevise: Framework.integer,
	input CodeProduit: Framework.integer = -1,
	input CodeService: Framework.integer = -1,
	input CodeCategorie: Framework.integer = -1,
	input CodePackage: Framework.integer = -1,
	input CodePromotion: Framework.integer = -1): Framework.boolean;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class MoteurBSControles inherits from MoteurTarifSrv.MoteurBS

has public  method DoStartService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class MoteurBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class MoteurBSProduction inherits from MoteurTarifSrv.MoteurBS

has public  method DoStartService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class Noeud inherits from Framework.Object

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class NoeudIntermediaire inherits from MoteurTarifSrv.Noeud

has public  attribute Children: Framework.Array of MoteurTarifSrv.Noeud;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class NoeudPorteurDeRegles inherits from MoteurTarifSrv.Noeud

has public  attribute lesRegles: Framework.Array of MoteurTarifSrv.Regle;
has public  attribute strategie: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class NoeudServices inherits from MoteurTarifSrv.NoeudIntermediaire

has public  constant ACCEPT_DUPLICATES = TRUE;
has public  constant HASHTABLE_BUCKETS = 10;

has public  attribute Privileges: Framework.HashTable;

has public  method AjouterPriv(input unCodeClient: Framework.integer,
	input unPrivilege: MoteurTarifSrv.Privilege);
has public  method Init;
has public  method LirePriv(input CodeClient: Framework.integer): MoteurTarifSrv.Privilege;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Privilege inherits from MoteurTarifSrv.DatesValidite

has public  attribute CodeClient: Framework.TextData;
has public  attribute Eval: CompilateurClasses.ExpressionCompilee;
has public  attribute EvalString: Framework.TextData;
has public  attribute IDPriv: Framework.integer;

has public  method Init;
has public  method SetParams(input NumCli: Framework.IntegerData,
	input uneEvaluation: CompilateurClasses.ExpressionCompilee);
has public  method SetStrings(input uneChaineEval: Framework.TextData);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Regle inherits from MoteurTarifSrv.DatesValidite

has public  attribute Cond: CompilateurClasses.ExpressionCompilee;
has public  attribute CondString: Framework.TextData;
has public  attribute Eval: CompilateurClasses.ExpressionCompilee;
has public  attribute EvalString: Framework.TextData;
has public  attribute IDRegle: Framework.integer;
has public  attribute PrixPublic: Framework.boolean;

has public  method EvaluatesAs: Framework.DataValue;
has public  method Init;
has public  method SetParams(input uneCondition: CompilateurClasses.ExpressionCompilee,
	input uneEvaluation: CompilateurClasses.ExpressionCompilee,
	input IsPrixPublic: Framework.boolean);
has public  method SetStrings(input uneChaineCond: Framework.TextData,
	input uneChaineEval: Framework.TextData);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method Anomalie.Init
begin
super.Init();
Message = new();
IDRegle = 0;
end method;

------------------------------------------------------------
method AnomalieEvaluationExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DatesValidite.Init
begin
super.Init();

-- pas de new sur les attributs car les attributs 
-- seront passés par référence
end method;

------------------------------------------------------------
method MoteurBS.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Méthode Action destinée à router les évaluations
--
--	Type :	Concret
--
--	Parametres :	Input		--> aTransdata :	Communication structure.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	06/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Action');

-- Declarations

aResult : Object;

	Case aTransData.TransActionService is

		when ACT_TARIF_EVALUE do		 -- Evaluation d'un événement de tarification
			
			aResult = self.EvalueCre((EvenementTarificationDesc) (aTransData.TransObject));

		when ACT_TARIF_CONTROLE do PerformControls = TRUE;
		
		when ACT_TARIF_COMPILE do GoCompile = TRUE;
		
		when ACT_TARIF_INITIALISE do	 -- Renvoie l'instance du moteur une fois instancié (pas initialisé)
			
			aResult = NIL;
			Initialise((ContexteTarification) (aTransData. TransObject),GoCompile,PerformControls);

      	else do -- Traitement des autres cas
		
--			aResult = DoAction(aTransData, aTransOrigin);
			aResult = NIL;
			AnomalieTarification(ERR_MOTEUR_CODE_ACTION_INCORRECT);
	end case;
	

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Action : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MoteurBS.Action');
		Raise;
end method;

------------------------------------------------------------
method MoteurBS.AnomalieTarification(input CodeErreur: Framework.integer)
begin
--
--	Description : Levée d'une exception spécifique au moteur de tarification
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : AnomalieTarificationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--	PMT	|	16/06/1998	|	Utilisation de codes d'erreur en lieu et place des chaines 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.AnomalieTarification');

self.DerniereErreur = CodeErreur; -- positionner le moteur en erreur
unMessage : TextData = new();
unMessage.SetValue('Erreur : ');

Msg : string;
case CodeErreur is

  when ERR_EVT_REJETE_DEVISE_INCONNUE do Msg = 'Le code devise est incorrect';
  when ERR_EVT_REJETE_PRODUIT_INCONNU do Msg = 'Le code produit est incorrect';
  when ERR_EVT_REJETE_SERVICE_INCONNU do Msg = 'Le code service est incorrect';
  when ERR_EVT_REJETE_CATEGORIE_INCONNUE do Msg = 'Le code categorie est incorrect';
  when ERR_EVT_REJETE_PACKAGE_INCONNU do Msg = 'Le code package est incorrect';
  when ERR_EVT_REJETE_PROMOTION_INCONNUE do Msg = 'Le code promotion est incorrect';
  when ERR_EVT_REJETE_INVALIDE do Msg = 'Evenement de tarification invalide';
  when ERR_EVT_REJETE_RAISON_INCONNUE do Msg = 'Evenement de tarification rejete pour une raison inconnue';
  when ERR_EVT_REJETE_REGLE_INCONNUE do Msg = 'Regle inconnue';
  when ERR_EVT_REJETE_TARIF_IMPOSSIBLE do Msg = 'Impossible de valoriser un l''evenement';
  when ERR_COMPILE_PRIVILEGE_MAL_TYPE do Msg = 'Un tarif privilege est mal type';
  when ERR_CONSTRUCTION_STRATEGIE_INVALIDE do Msg = 'Stratégie invalide';
  when ERR_MOTEUR_CODE_ACTION_INCORRECT do Msg = 'Code action incorrect';
  when ERR_COMPILE_ABSENCE_TARIF_HORS_PACKAGE do Msg = 'Absence de tarif hors package';
  when ERR_COMPILE_ABSENCE_TARIF_HORS_PROMOTION do Msg = 'Absence de tarif hors promotion';
  when ERR_COMPILE_CONDITION_MAL_FORMEE do Msg = 'Condition mal formee';
  when ERR_COMPILE_CONDITION_MAL_FORMEE_OU_TYPE_INCORRECT do Msg = 'Condition mal formee ou de type incorrect';
  when ERR_COMPILE_EVALUATION_DOIT_ETRE_NUMERIQUE do Msg = 'La partie evaluation doit etre de type numerique';
  when ERR_COMPILE_EVALUATION_MAL_FORMEE do Msg = 'Evaluation mal formee';
  when ERR_COMPILE_LISTEREGLES_NIL do Msg = 'Liste de regles à NIL';
  when ERR_COMPILE_EXCEPTION do Msg = 'Exception levée pendant le parcours de l''arbre ou la compilation';
  when ERR_CONSTRUCTION_TARIF_CLIENT_INCORRECT do Msg = 'Tarif client incorrect';
  when ERR_CONSTRUCTION_NOEUD_SERVICE_A_NIL do Msg = 'Noeud service à NIL';
  else Msg = 'CODE ERREUR NON GERE !!!';  
end case;

unMessage.Concat(Msg);  

if PerformControls = TRUE then
	Anomalie : Anomalie = new();
	Anomalie.Message = unMessage;
	ErreursCompilation.AppendRow(Anomalie);
else
	UneAnomalie : AnomalieTarificationExc = new();
	uneAnomalie.SetWithParams(SP_ER_ERROR,unMessage.Value);
	Task.Part.LogMgr.PutLine('Levée d''une exception : ');
	Task.Part.LogMgr.PutLine(unMessage.Value);
	raise uneAnomalie;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.AnomalieTarification : End');


end method;

------------------------------------------------------------
method MoteurBS.AnomalieTarification(input Source: Framework.TextData,
	input Descr: Framework.TextData)
begin
--
--	Description : Levée d'une exception spécifique au moteur de tarification
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : AnomalieTarificationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--	PMT	|	12/06/1998	|	Si PerformControls = TRUE, pas d'exception mais insertion erreurs dans un tableau 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.AnomalieTarification');

UneAnomalie : AnomalieTarificationExc;
unMessage : TextData = new(Value='Erreur : ');
unMessage.Concat(Source);
unMessage.Concat('-');
unMessage.Concat(Descr);

if PerformControls = TRUE then
	Anomalie : Anomalie = new();
	Anomalie.Message = unMessage;
	ErreursCompilation.AppendRow(Anomalie);
else
	UneAnomalie = new();
	uneAnomalie.SetWithParams(SP_ER_ERROR,unMessage.Value);
	Task.Part.LogMgr.PutLine(unMessage.Value);
	raise uneAnomalie;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.AnomalieTarification : End');


end method;

------------------------------------------------------------
method MoteurBS.CalculerChemin(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Calcul du chemin d'accès à un noeud (Version RegleDesc)
-- 				  	Le chemin d'accès représente la branche de l'arbre que l'on doit
--				  	atteindre pour obtenir la liste de règles correspondant au RegleDesc
--
--				  	Les indices du tableau représente les niveaux de l'arbre
--				  	Les entiers stockés dans le tableau représente le rang du noeud fils dans le tableau Children
--	
--
--	Type :	concret
--
--	Parametres :    unRegleDesc   : Le RegleDesc pour lequel on va calculer le chemin d'accès (= branche de l'arbre)
--					unChemin	  : Le tableau d'entiers dans lequel on renvoie le chemin d'accès
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CalculerChemin(RegleDesc)');


unChemin.Clear();
unChemin.AppendRow(unRegleDesc.CodeDevise);
unChemin.AppendRow(unRegleDesc.CodeProduit);
unChemin.AppendRow(unRegleDesc.CodeService);
unChemin.AppendRow(unRegleDesc.CodeCategorie);
unChemin.AppendRow(unRegleDesc.CodePackage);
unChemin.AppendRow(unRegleDesc.CodePromotion);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CalculerChemin(RegleDesc) : End');

end method;

------------------------------------------------------------
method MoteurBS.CalculerChemin(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Calcul du chemin d'accès à un noeud (Version TarifClientDesc)
-- 				  	Le chemin d'accès représente la branche de l'arbre que l'on doit
--				  	atteindre pour obtenir la liste de règles correspondant au RegleDesc
--
--				  	Les indices du tableau représente les niveaux de l'arbre
--				  	Les entiers stockés dans le tableau représente le rang du noeud fils dans le tableau Children
--	
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le TarifClientDesc pour lequel on va calculer le chemin d'accès (= branche de l'arbre)
--					unChemin	  : Le tableau d'entiers dans lequel on renvoie le chemin d'accès
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CalculerChemin(TarifClientDesc)');

unChemin.Clear();
unChemin.AppendRow(unTarifClient.CodeDevise);
unChemin.AppendRow(unTarifClient.CodeProduit);
unChemin.AppendRow(unTarifClient.CodeService);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CalculerChemin(TarifClientDesc) : End');

end method;

------------------------------------------------------------
method MoteurBS.CompileCategoriesEtPrivileges(input leService: MoteurTarifSrv.NoeudServices)
begin
--
--	Description : 	Lancement pour chaque catégorie client de la compilation des packages 
--
--	Détermination au préalable de la liste de règles hors catégorie (=Catégorie standard), 
--	hors package et hors promotion
--
--
--	Type :	concret
--
--	Parametres :    leService : Sous-arbre à compiler
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompileCategoriesEtPrivileges');

PrixPublicCategorieStandard : string;
unType						: integer;
Substitution				: boolean;

begin
	if leService <> NIL then
	
		-- Exploration de la branche "Prix public"
		CategorieStandard       : NoeudIntermediaire   = (NoeudIntermediaire)   (leService          . Children[IDX_CATEGORIE_STANDARD]);
		
		if CategorieStandard <> NIL then
	
			HorsPackages 		    : NoeudIntermediaire   = (NoeudIntermediaire)   (CategorieStandard  . Children[IDX_HORS_PACKAGE]);
	
			if HorsPackages <> NIL then
			
				HorsPromotions          : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (HorsPackages       . Children[IDX_HORS_PROMOTION]);
	
				if HorsPromotions <> NIL then 
				
					PrixPublicHorsContexte  : array of Regle       = HorsPromotions.LesRegles;
					
					-- Détermination de la chaîne PrixPublic 
					if PrixPublicHorsContexte = NIL then
					   AnomalieTarification(ERR_COMPILE_LISTEREGLES_NIL);	
					else
						-- Détermination du prix public de la catégorie standard
						TarifDeReference : TextData = DeterminerPrixPublic(PrixPublicHorsContexte);
						CopieTarifRef : TextData = new(Value = TarifDeReference.Value);
						
						Substitution = FALSE;
						-- IsEqual et pas DoesExpand !
						if PerformControls = TRUE and TarifDeReference.IsEqual(CST_TARIF_A_RENSEIGNER) then
						   TarifDeReference.SetValue('1.0');
						   Substitution = TRUE;
						end if;
	
	
						-- En fait, ici on ne substitue rien, on ne fait que vérifier l'absence effective
						-- de tout type de macros variables. En effet, les paramètres autres que la variable
						-- dans laquelle effectuer la substitution sont à NIL. On passera donc dans la vérification
						-- pour chacun des types de macros.
						
						SubstituerMacrosVariables(TarifDeReference);
					
					    -- constitution de la liste de tous les tarifs packages pour la catégorie standard
						TarifCategoriesStandard : array of TextData = new();
						for unPackage in CategorieStandard.Children do
							HorsPromotions = (NoeudPorteurDeRegles) ((NoeudIntermediaire) (unPackage).Children[IDX_HORS_PROMOTION]);
							TarifCategoriesStandard.AppendRow(DeterminerPrixPublic(HorsPromotions.LesRegles));
						end for;
						
						-- Première passe de la compilation : On compile d'abord le tarif pour la catégorie standard
					 	-- Tarif des packages pour la catégorie standard.
					 	-- La méthode CompilePackages a des paramètres par défaut à NIL permettant d'interdire
					 	-- la présence d'une occurrence du tarif correspondant.
					 	
					 	-- Une valeur <> de NIL effectue la substitution
					 	-- Une valeur = à NIL effectue la vérification d'absence du tarif
					 	
					 	CompilePackages(CategorieStandard.Children,TarifDeReference); 
					
						-- Parcours de toutes les catégories et compilation des sous-arbres correspondants
						-- en passant en paramètre le prix public "CategorieStandard"
						for uneCategorie in leService.Children do -- Pour toutes les catégories
							if uneCategorie<>CategorieStandard then
							   CompilePackages((NoeudIntermediaire) (uneCategorie).Children,TarifDeReference,TarifCategoriesStandard);
							end if;
						end for;
					
						-- Récupération de la liste des privilèges associés aux noeud leService
						lesPrivileges : array of Privilege = (array of Privilege) (leService.Privileges.FillArray());				
						for unPrivilege in lesPrivileges do
						
							-- Seul le tarif de référence est admis dans les privilèges. Les autres types
							-- de tarifs sont interdits, d'ou le passage des paramètres à leur valeur
							-- par défaut. Non seulement, ils ne seront pas substitués, mais de plus,
							-- la méthode SubstituerMacrosVariables vérifie l'absence effective
							-- de références vers les tarifs passés à NIL.
							
							self.SubstituerMacrosVariables(unPrivilege.EvalString, TarifDeReference);
					 		unPrivilege.Eval = unCompilateur.Compile(unPrivilege.EvalString.Value);
							
							-- Validation : contrôle de type
							unType = unPrivilege.Eval.VerifieType(); -- pré-allocation des variables temporaires
							if unType <> AttributionTypeDecimal then
							   AnomalieTarification(ERR_COMPILE_PRIVILEGE_MAL_TYPE);	
							end if;		
							
							-- Pour libérer la référence
							unPrivilege.EvalString = NIL; 
					
							NombreCompilees = NombreCompilees + 1;  -- DEBUG
						end for;
	
					TarifDeReference.SetValue(CopieTarifRef);
					end if;
					
	
				else AnomalieTarification(ERR_COMPILE_ABSENCE_TARIF_HORS_PROMOTION);
				end if; -- Hors promotion
			else AnomalieTarification(ERR_COMPILE_ABSENCE_TARIF_HORS_PACKAGE);
			end if; -- HorsPackage
		else AnomalieTarification(ERR_COMPILE_ABSENCE_TARIF_HORS_CATEGORIE_STANDARD);
		end if; -- CategorieStandard<>NIL
	  else AnomalieTarification(ERR_CONSTRUCTION_NOEUD_SERVICE_A_NIL);
	end if;  -- LeService<>NIL
exception
	when e : GenericException do
	   	     AnomalieTarification(ERR_COMPILE_EXCEPTION);
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompileCategoriesEtPrivileges : End');


end method;

------------------------------------------------------------
method MoteurBS.CompilePackages(input lesPackages: Framework.Array of MoteurTarifSrv.Noeud,
	input TarifDeReference: Framework.TextData,
	input TarifCategoriesStandard: Framework.Array of Framework.TextData = NIL)
begin
--
--	Description : 	Lancement de la compilation des promotions pour chaque package de la liste  
--
--	La compilation consiste en la détermination à chaque étape de la liste de règles  
--	hors package et hors promotion et finalement du prix public de cette liste de règles 
--
--	Détermination au préalable de la liste de règles hors package et hors promotion sachant que 
--	l'on recoit en paramètre le prix public pour la catégorie standard
--
--
--	Type :	concret
--
--	Parametres :    lesPackages 		    : La liste des packages à compiler
--					TarifDeReference        : Le tarif de référence, à renseigner obligatoirement
--					TarifCategoriesStandard : Les tarifs des packages pour la catégorie standard
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilePackages');

-- Exploration de la branche "Prix public"
HorsPackages           : NoeudIntermediaire = (NoeudIntermediaire) (lesPackages[IDX_HORS_PACKAGE]);
HorsPromotions         : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (HorsPackages . Children[IDX_HORS_PROMOTION]);
PrixPublicHorsContexte : array of Regle     = HorsPromotions.LesRegles;

TarifCategorie : TextData = self.DeterminerPrixPublic(PrixPublicHorsContexte);
self.SubstituerMacrosVariables(TarifCategorie, TarifDeReference);

if TarifCategoriesStandard <> NIL then
	
	CompilePromotions(HorsPackages.Children, TarifDeReference, TarifDeReference, NIL);
	
	-- Remarque : La raison de la présence de TarifReference à deux reprises est
	-- que dans le cas ou TarifCategoriesStandard = NIL (on est dans la catégorie standard),
	-- le tarif standard est directement équivalent au tarif de référence ??? Huh ?
	--
	-- L'utilisation de la variable TarifDeReference permet de récupérer directement la valeur 
	-- hors package sans devoir faire la recherche de la référence correspondante dans la
	-- table des tarifs packages.
	
else
	CompilePromotions(HorsPackages.Children, TarifDeReference, NIL, NIL);
end if;

indice : integer = 1;
for UnPackage in lesPackages do 
	if unPackage <> HorsPackages then
	   if TarifCategoriesStandard<> NIL then
			CompilePromotions((NoeudIntermediaire) (unPackage).Children,TarifDeReference,TarifCategoriesStandard[indice],TarifCategorie);
	   else
	   		CompilePromotions((NoeudIntermediaire) (unPackage).Children,TarifDeReference, NIL, TarifCategorie);
	   end if;
       indice = indice + 1;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilePackages : End');

end method;

------------------------------------------------------------
method MoteurBS.CompilePromotions(input lesPromotions: Framework.Array of MoteurTarifSrv.Noeud,
	input TarifDeReference: Framework.TextData,
	input TarifCategorieStandard: Framework.TextData,
	input TarifCategorie: Framework.TextData)
begin
--
--	Description : 	Lancement de la compilation des règles pour chaque noeud fils 
--
--	La compilation consiste en la détermination à chaque étape de la liste de règles hors catégorie 
--	hors package et hors promotion et finalement du prix public de cette liste de règles 
--	Le prix public hors package servira de chaîne de remplacement pour toute occurrence du tarif normal 
--
--	Détermination au préalable de la liste de règles hors promotion sachant que 
--	l'on recoit en paramètre le prix public hors package
--
--
--	Type :	concret
--
--	Parametres :    lesPromotions  		    : La liste des promotions à compiler
--					TarifDeReference        : Le tarif pour la catégorie standard, hors package et hors promotion
--					TarifCategorieStandard  : Le tarif du package dans la catégorie standard
--					TarifCategorie		    : Le tarif hors package
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilePromotions');

-- Exploration de la branche "Prix public" pour récupérer le prix public de la liste de promotions
HorsPromotions          : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (LesPromotions[IDX_HORS_PROMOTION]);
PrixPublicsHorsContexte	: array of Regle       = HorsPromotions.LesRegles; -- Le prix public de la liste de promotions

TarifSansPromotion : TextData = self.DeterminerPrixPublic(PrixPublicsHorsContexte);
self.SubstituerMacrosVariables(TarifSansPromotion, TarifDeReference, TarifCategorieStandard, TarifCategorie);

CompileRegles(HorsPromotions.LesRegles, TarifDeReference, TarifCategorieStandard, TarifCategorie, NIL);
for unePromotion in lesPromotions do
	
	if unePromotion <> HorsPromotions then
	   CompileRegles((NoeudPorteurDeRegles) (unePromotion).lesRegles, TarifDeReference, TarifCategorieStandard, 
	   										 TarifCategorie, TarifSansPromotion);
	end if;
	
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilePromotions : End');

return;

exception
	when e : GenericException do
		self.TraceExc(e,'CompilePromotions');
		raise;

end method;

------------------------------------------------------------
method MoteurBS.CompilerArbre
begin
--
--	Description : 	Lancement de la compilation de l'ensemble de l'arbre de recherche des règles
--
--	La compilation consiste en un parcours de toutes les branches de l'arbre dans le but de trouver
--  toutes les listes de règles stockées dans l'arbre et de compiler toutes les règles stockées dans
--  ces listes. 
--
--  La compilation d'une règle consiste en la compilation de la partie condition et de la partie expression
--  ainsi que de la vérification du type.
--
--	Les listes de règles consistent avant cette phase de compilation en une liste de chaînes. Toutes ces chaînes 
--  sont écrasées volontairement après leur compilation par une référence à NIL afin de les faire passer au 
--  ramasse - miettes (Garbage collector).
--
--  La moindre erreur de compilation ou de vérification de type doit normalement se solder par une exception qui
--  met fin (volontairement) à l'initialisation du moteur de tarification ce qui aura pour conséquence le fait
--  que le moteur ne renverra jamais ServiceStarted = TRUE et donc la tarification ne pourra pas démarrer tant
--  que la liste de règles contiendra des règles erronées.
--
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilerArbre');

-- Deuxième passe de la génération de l'arbre,
-- on va maintenant passer à la compilation des expressions
-- en substituant les différentes sortes de tarif à chaque niveau

-- Voir si il est possible de réaffecter le noeud dans un noeud du type
-- exact pour pouvoir éviter les casts dans la boucle for

-- for x in xxx do
--     tmpx : NoeudIntermediaire = x;
--     for y in tmpx.children
--		...
--	   end for;
-- end for;

-- Mesurer le gain en termes de performances

ChronoCompilation : Chronometre = new();
ChronoCompilation.Fire();

begin
	-- La compilation est lancée pour chaque devise
	-- A chacun de ces devises correspond un tableau de produits
	-- A chacun des produits correspond un tableau de services
	-- A chacun de ces services correspond un tableau de catégories

	if PerformControls=TRUE then
	   ErreursCompilation = new();	   -- Tableau contenant tous les RegleDesc posant des problèmes de compilation
	end if;
	
	Racine         : NoeudIntermediaire;
	DeviseCourante : NoeudIntermediaire;
	ProduitCourant : NoeudIntermediaire;
	ServiceCourant : NoeudServices;
	
	Racine  = (NoeudIntermediaire) (arbre);

	if Racine <> NIL then
		
		-- BOUCLE SUR LES DEVISES
		for i_dev in 1 to Racine.Children.Items do -- 1
		
			DeviseCourante = (NoeudIntermediaire) (Racine.Children[i_dev]);
			if DeviseCourante<>NIL then  -- 2
			   
			   -- BOUCLE SUR LES PRODUITS
			   for i_prd in 1 to DeviseCourante.Children.Items do -- 3
			   	   ProduitCourant = (NoeudIntermediaire) (DeviseCourante.Children[i_prd]);
			   	   if ProduitCourant<>NIL then  -- 4
					
					  -- BOUCLE SUR LES SERVICES
					  for i_ser in 1 to ProduitCourant.Children.Items do -- 5
						ServiceCourant = (NoeudServices) (ProduitCourant.Children[i_ser]);
						if ServiceCourant<>NIL then  -- 6
							CompileCategoriesEtPrivileges(ServiceCourant);		
						end if; -- 6
					  end for;  -- 5
					  	
			   	   end if;	-- 4			
			   end for; -- 3
			   
			end if;  -- 2
			
		end for; -- 1

	end if;
	

/*
	for uneDevise in (NoeudIntermediaire) (arbre).Children do
   		for unProduit in (NoeudIntermediaire) (uneDevise).Children do
			for unService in (NoeudIntermediaire) (unProduit).Children do	
					CompileCategoriesEtPrivileges((NoeudServices)(unService));
			end for;		
		end for;
	end for;
*/

exception
	when e : GenericException do
	   self.TraceExc(e,'MoteurBS.CompilerArbre');
	   raise;
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilerArbre : End');

PutMessage('Temps total de compilation : ',ChronoCompilation.AsText());


end method;

------------------------------------------------------------
method MoteurBS.CompileRegles(input lesRegles: Framework.Array of MoteurTarifSrv.Regle,
	input TarifDeReference: Framework.TextData,
	input TarifCategorieStandard: Framework.TextData,
	input TarifCategorie: Framework.TextData,
	input TarifSansPromotion: Framework.TextData)
begin
--
--	Description : 	Compilation d'une liste de règles après d'éventuelles substitutions
--
--	Type :	concret
--
--	Parametres :    lesRegles            : La liste de règles à compiler
--					TarifStandard        : 
--					TarifPackageStandard :  
--					TarifHorsPackage	 : 
--					TarifHorsPromotion   : 
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompileRegles');

PrixPublic : TextData = self.DeterminerPrixPublic(lesRegles);
self.SubstituerMacrosVariables(PrixPublic,TarifDeReference,TarifCategorieStandard,TarifCategorie, TarifSansPromotion);

for uneRegle in lesRegles do

	if SHOW_STRINGS = TRUE then
	   Task.Part.LogMgr.Put(uneRegle.EvalString.Value);
	   Task.Part.LogMgr.Put('=> ');	
	end if;
	
	if not uneRegle.PrixPublic = TRUE then

	   self.SubstituerMacrosVariables(uneRegle.EvalString,
	   								  TarifDeReference,			-- Si on souhaite n'autoriser que certains
	   								  TarifCategorieStandard,	-- types de tarifs, il suffit de passer
	   								  TarifCategorie,			-- les paramètres correspondants avec
	   								  TarifSansPromotion,		-- des valeurs à NIL
	   								  PrixPublic);   								  
	end if;
	CompilerUneRegle(uneRegle);

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompileRegles : End');

end method;

------------------------------------------------------------
method MoteurBS.CompilerUneRegle(input uneRegle: MoteurTarifSrv.Regle)
begin
--
--	Description : 	Compilation d'une règle (Partie condition et partie évaluation) à partir de 
--					la version base de données de la règle
--
--	La compilation consiste en l'appel du compilateur avec la méthode Compile qui retourne une instance d'une
--  expression ou NIL si l'expression n'a pas pu être compilée
--  
--  Cette méthode effectue également une vérification de type:
--	   Une condition doit toujours renvoyer un type booléen
--	   Une évaluation doit toujours renvoyer un type décimal
--
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilerUneRegle');


  exprCondition : ExpressionCompilee;
  exprEvaluation: ExpressionCompilee;
  
  -- On tente de compiler la partie condition
  begin
	-- Pour traiter le problème des chaînes vides dans les conditions des règles prix publics
	if uneRegle.PrixPublic=TRUE then
	   uneRegle.CondString.SetValue('');	
	end if;

	exprCondition = unCompilateur.Compile(uneRegle.CondString.Value);
	uneRegle.CondString = NIL; -- Passage au ramasse - miettes
	if exprCondition<>NIL then
	   if exprCondition.Expression = NIL or exprCondition.VerifieType()<>TYPE_BOOLEEN 
	   then AnomalieTarification(ERR_COMPILE_CONDITION_MAL_FORMEE_OU_TYPE_INCORRECT);
	   end if;
	else
	  AnomalieTarification(ERR_COMPILE_CONDITION_MAL_FORMEE);	
	end if;
  exception
   when e : GenericException do
   
	if PerformControls = TRUE then
	
		UneAnomalie : Anomalie = new();
		UneAnomalie.IDRegle = uneRegle.IDRegle;
		UneAnomalie.Message = e.Message;
		ErreursCompilation.AppendRow(uneAnomalie);

	else

		unMessage : TextData = new();
	    unMessage.SetValue(e.Message);   
		unMessage.Concat('[ ');
		unMessage.Concat(uneRegle.CondString);	
		unMessage.Concat(' ]');
		Self.TraceExc(e,unMessage.Value);
		raise;

	end if;
  end;

  -- On tente de compiler la partie evaluation
  begin
    unType : integer;
	if SHOW_STRINGS then
		Task.Part.LogMgr.PutLine(uneRegle.EvalString.Value);
	end if;
	exprEvaluation = unCompilateur.Compile(uneRegle.EvalString.Value);
	uneRegle.EvalString = NIL; -- Passage au ramasse - miettes
	if exprEvaluation <> NIL then
	   if exprEvaluation.Expression <> NIL  then
          unType = exprEvaluation.VerifieType();
          if unType <> AttributionTypeDecimal then 
			  AnomalieTarification(ERR_COMPILE_EVALUATION_DOIT_ETRE_NUMERIQUE);
		  end if;
	   else 
		  AnomalieTarification(ERR_COMPILE_EVALUATION_DOIT_ETRE_NUMERIQUE);
	   end if;
	else
	  AnomalieTarification(ERR_COMPILE_EVALUATION_MAL_FORMEE);
	end if;
  exception
   when e : GenericException do

	if PerformControls = TRUE then
	
		UneAnomalie : Anomalie = new();
		UneAnomalie.IDRegle = uneRegle.IDRegle;
		UneAnomalie.Message = e.Message;
		ErreursCompilation.AppendRow(uneAnomalie);
	else
		unMessage : TextData = new();
		unMessage.SetValue(e.Message);
		unMessage.Concat('[ ');
		unMessage.Concat(uneRegle.EvalString);	
		unMessage.Concat(' ]');
		Self.TraceExc(e,unMessage.Value);
		raise;
	end if;
  end;

  if ExprCondition<>NIL and ExprEvaluation<>NIL then
	 uneRegle.SetParams(exprCondition,exprEvaluation,uneRegle.PrixPublic);
	 NombreCompilees = NombreCompilees + 1; -- Tient compte des deux expressions de la règle
  end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilerUneRegle : End');

end method;

------------------------------------------------------------
method MoteurBS.ConstruireArbre(input lesRegles: Framework.Array of TarificationSrv.RegleDesc,
	input lesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudIntermediaire
begin
--
--	Description : 	Construction de l'ensemble de l'arbre à partir de la liste de règles
-- 					récupérée dans la table des règles ainsi que dans la tarification privilège
--
--					Cette méthode ne compile rien, elle ne fait que construire les branches de l'arbre
--					necéssaires à l'accès aux règles et à y greffer les règles sous leur forme chaîne
--
--					ConstruireBrancheRegles appelé pour chaque RegleDesc
--					ConstruireBranchePrivilege appelé pour chaque TarifClientDesc
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireArbre');

ChronoConstruction : Chronometre = new();
ChronoConstruction.Fire();

NombreNoeudsInt = 0;  -- Nombre de noeuds intermédiaires
NombreNoeudsFin = 0;  -- Nombre de noeuds finaux 
NombreExpl = 0;  	  -- Nombre de noeuds explorés
NombreListes = 0;     -- Nombre de listes de règles créées
NombreCompilees = 0;  -- Nombre de règles correctement compilées
NombrePrivCrees = 0;  -- Nombre de noeuds services créés
	
Arbre = NoeudIntermediaire(); -- Instanciation de la racine de l'arbre

-- Construction des règles (non privilèges)
for uneRegle in LesRegles do
  ConstruireBrancheRegles(uneRegle,unChemin);
end for;

-- Construction des règles (privilèges)
for UneRegle in LesPrivileges do
  ConstruireBranchePrivilege(uneRegle,unChemin);
end for;

PutMessage('Temps de construction de l''arbre : ',ChronoConstruction.AsText());

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireArbre : End');

return (NoeudIntermediaire) (arbre);


end method;

------------------------------------------------------------
method MoteurBS.ConstruireBranchePrivilege(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Construction d'une branche d'accès à un TarifClientDesc
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le Tarif privilège à insérer
--					unChemin	  : Le chemin d'accès tel que calculé par CalculerChemin
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireBranchePrivilege');

if unTarifClient<>NIL then

   -- TrouverCheminPrivileges effectue en même temps la recherche et la construction de la branche
   ListePriv : NoeudServices = TrouverCheminPrivileges(unTarifClient,unChemin);
   
   -- La liste n'a pas encore été créée. Ne devrait jamais se produire 
   -- car est censé être créé dans la méthode TrouverChemin. Ne sert donc que de garde-fou
   if ListePriv = NIL then
      AnomalieTarification(ERR_CONSTRUCTION_LISTE_REGLES_CONSTRUITE_TROP_TARD);
   end if;
 
   -- Instanciation de la règle privilège  
   unPrivilege : Privilege = new();
   unPrivilege.CodeClient = unTarifClient.CodeClient;
   unPrivilege.EvalString = unTarifClient.Montant;
   unPrivilege.IDPriv = unTarifClient.ID;   
   -- Insertion de la règle dans la liste
   ListePriv.AjouterPriv(unTarifClient.CodeClient.IntegerValue,unPrivilege);

else
   -- Oops, what's happened ? Has the sh... hit the fan ? 
	AnomalieTarification(ERR_CONSTRUCTION_TARIF_CLIENT_INCORRECT);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireBranchePrivilege : End');


end method;

------------------------------------------------------------
method MoteurBS.ConstruireBrancheRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Construction d'une branche d'accès à un RegleDesc
--
--	Type :	concret
--
--	Parametres :    unRegleDesc : La règle à insérer
--					unChemin    : Le chemin d'accès à la règle tel que calculé par CalculerChemin
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireBrancheRegle');

-- Construire la branche correspondant à la règle consiste à la compiler, 
-- trouver/construire le chemin correspondant dans l'arbre de recherche
-- et l'insérer dans la liste de règles (après avoir créé cette liste si necéssaire)

-- Création de la règle sans procéder à la compilation mais simplement en lui faisant
-- porter les expressions à compiler lors de la deuxième passe

laRegle : Regle = new();
laRegle.SetStrings(uneChaineCond=unRegleDesc.Condition,
				   uneChaineEval=unRegleDesc.Montant);
laRegle.IDRegle = unRegleDesc.ID;
laRegle.PrixPublic = unRegleDesc.PrixPublicBln;		
if PerformControls = TRUE then
	laRegle.DateDebutValidite = unRegleDesc.DateDebutValidite;
	laRegle.DateFinValidite = unRegleDesc.DateFinValidite;
end if;

-- Récupération d'une référence (par création ou reprise) vers la liste de règles concernées
ListeRegles : array of Regle = TrouverCheminRegles(unRegleDesc,unChemin).LesRegles;
   
-- La liste n'a pas encore été créée. Ne devrait jamais se produire 
-- car est censé être créé dans la méthode TrouverChemin. Ne sert donc que de garde-fou
if ListeRegles = NIL then
  uneErreur : AnomalieTarificationExc = new();
  uneErreur.SetWithParams(SP_ER_ERROR,'Erreur : Liste de règles créée dans ConstruireBrancheRegles');
  Task.Part.LogMgr.PutLine('Erreur : Liste de règles créée dans ConstruireBrancheRegles');
  raise uneErreur;	
end if;

-- Insertion de la règle dans la liste
ListeRegles.AppendRow(laRegle);
   
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireBrancheRegle : End');

end method;

------------------------------------------------------------
method MoteurBS.DeterminerPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.TextData
begin
--
--	Description : 	Détermination dans une liste de règles de la règle considérée comme le prix public
--
--	Type :	concret
--
--	Parametres :    ListeRegles   : La liste de règles
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--	PMT	|	05/06/1998	|	Simplification pour prendre en compte les évolutions concernant la macro-expansion
--  PMT | 	10/06/1998	|	Prise en compte du nouveau vocabulaire : "Tarif Normal devient "Prix public"
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DeterminerPrixPublic');

LePrixPublic : TextData = NIL;

-- Rechercher le prix public dans la liste de règles
for Regle in ListeRegles do

	if  Regle.PrixPublic then
		LePrixPublic = Regle.EvalString;
		exit;
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DeterminerPrixPublic : End');

return LePrixPublic;

exception
  when e : GenericException do
  	self.TraceExc(e,'DeterminerPrixPublic');
	raise;
  	
end method;

------------------------------------------------------------
method MoteurBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  PMT	 	| ??/05/1998  |   Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('BusinessServiceDesc.DoAction');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoAction : End (Levée d''une exception) ');
Raise unExc;
-- Fin du traitement


Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method MoteurBS.DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc
begin
--
--	Description : 	Lecture des règles normales
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoLireLesPrivileges');
Task.Part.LogMgr.PutLine('************* Lecture des privileges en cours ***************');

TmpPriv : array of TarifClientDesc = new();
unCache : array of CacheDesc;

aTransData : TransDesc = new();
aTransData.TransactionService = ACT_STD_READ;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)
unCache = (array of CacheDesc) (self.Transfer(aTransData,soTarificationBSMgr,TarifClientBS));

unCompteur : integer = 0;
for unCacheDesc in unCache do 
	TmpPriv.AppendRow((TarifClientDesc) (unCacheDesc.Record));
	unCompteur = unCompteur + 1;
end for;
PutMessage('Nombre de regles privileges : ',unCompteur);

Task.Part.LogMgr.PutLine('************* Lecture des privileges terminee ***************');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoLireLesPrivileges : End');

return TmpPriv;
end method;

------------------------------------------------------------
method MoteurBS.DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc
begin
--
--	Description : 	Lecture des règles normales
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoLireLesRegles');
Task.Part.LogMgr.PutLine('************* Lecture des regles en cours ***************');


-- Transfert pour effectuer la lecture des règles de tarification
-- Normalement, les règles ne pouvant pas être tarifées ne sont pas lues (Règles dont la date de début
-- est strictement supérieure à la date de référence).  Cela permet de n'insérer que les règles strictement
-- nécessaires

aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_READALL_REGLE;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)

TmpRegles : array of RegleDesc = (array of RegleDescSQL) (self.Transfer(aTransData,soTarificationBSMgr,RegleBS));
/*
unCompteur : integer = 0;
for unCacheDesc in unCache do 
	TmpRegles.AppendRow((RegleDesc) (unCacheDesc.Record));
	unCompteur = unCompteur + 1;
end for;
*/

PutMessage('Nombre de règles lues : ',TmpRegles.Items); -- Valeurs à NIL dans le tableau ???

Task.Part.LogMgr.PutLine('************* Lecture des regles terminee ***************');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoLireLesRegles : End');

return TmpRegles;
end method;

------------------------------------------------------------
method MoteurBS.DoStartService
begin

end method;

------------------------------------------------------------
method MoteurBS.Evalue: Framework.NumericData
begin
--
--	Description : 	Evaluation d'un événement de tarification 
--
--	Type :	concret
--
--	Parametres :    Aucun car les paramètres sont passés via le contexte
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : AnomalieTarificationExc si réception d'une GenericException (Conversion)
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Evalue');

unTarif        : NumericData;
SADevises      : NoeudIntermediaire;
SAProduits     : NoeudIntermediaire;
SAServices     : NoeudServices;
SACategories   : NoeudIntermediaire;
SAPackages     : NoeudIntermediaire;
SAPromotions   : NoeudPorteurDeRegles;

begin
	SADevises    = (NoeudIntermediaire) ((NoeudIntermediaire) (Arbre).Children[CT.CodeDevise.Value]);	
	if SADevises <> NIL then
	   
		SAProduits = (NoeudIntermediaire) (SADevises.Children[CT.CodeProduit.Value]);
		if SAProduits <> NIL then

			SAServices = (NoeudServices) (SAProduits.Children[CT.CodeService.Value]);
			if SAServices <> NIL then		    	

				unPrivilege	: Privilege = SAServices.LirePriv(CT.NumClient.IntegerValue); 
				if unPrivilege<>NIL then -- On vient de trouver un privilège, on doit donc l'évaluer
					unTarif = (NumericData) (unPrivilege.Eval.Evalue());	
				else
					-- pas de privilège pour le client, le service, la devise et la date de référence en cours
					-- on continue donc le déroulement de l'arbre
					
					SACategories = (NoeudIntermediaire)   (SAServices.Children[CT.CodeCategorie.Value]);
					if  SACategories <> NIL then

						SAPackages  = (NoeudIntermediaire)   (SACategories.Children[CT.CodePackage.Value]);
						if SAPackages <> NIL then
			
							SAPromotions = (NoeudPorteurDeRegles) (SAPackages.Children[CT.CodePromotion.Value]);
							if SAPromotions <> NIL then												

								case SAPromotions.Strategie is
								
									when STRATEGIE_STANDARD  do unTarif = EvaluerPremierApplicables  (SAPromotions.lesRegles);
									when STRATEGIE_MINI      do unTarif = EvaluerMiniApplicables     (SAPromotions.lesRegles);
									when STRATEGIE_MAXI      do unTarif = EvaluerMaxiApplicables     (SAPromotions.lesRegles);
									else AnomalieTarification(ERR_CONSTRUCTION_STRATEGIE_INVALIDE);

								end case;   

							else AnomalieTarification(ERR_EVT_REJETE_PROMOTION_INCONNUE);
							end if;
						
						else AnomalieTarification(ERR_EVT_REJETE_PACKAGE_INCONNU);
						end if;
						
					else AnomalieTarification(ERR_EVT_REJETE_CATEGORIE_INCONNUE);
					end if;
			
				end if; -- Privilèges
				
			else AnomalieTarification(ERR_EVT_REJETE_SERVICE_INCONNU);
			end if;
			
		else AnomalieTarification(ERR_EVT_REJETE_PRODUIT_INCONNU);
		end if;
		
	else AnomalieTarification(ERR_EVT_REJETE_DEVISE_INCONNUE);
	end if;

exception

	when e : GenericException do

	   -- Problème pendant l'évaluation d'un événenement de tarification
	   -- Lancement d'une exception spécifique pour signaler le problème et
	   -- pouvoir la reporter dans un fichier log
	   
	   unMessage : TextData = new(Value='Report d''une erreur (Message original) : \n');
	   unMessage.Concat(e.Message);
	   unMessage.Concat('\n');
	   unMessage.Concat('[CodeClient=%1,  CodeDevise=%2    , CodeCategorie=%3, CodeProduit=%4, CodeService=%5,\n');
	   unMessage.Concat(' CodePackage=%6, CodePromotion=%7 , DateDebut=%8,     DateFin=%9]\n\n\n');
	   unMessage.ReplaceParameters(unMessage,Parameter1=IntegerData(Value=CT.NumClient.IntegerValue)  , 
	   										 Parameter2=(IntegerData) (CT.CodeDevise)    ,
	   										 Parameter3=(IntegerData) (CT.CodeCategorie) , 
	   										 Parameter4=(IntegerData) (CT.CodeProduit)   ,
	   										 Parameter5=(IntegerData) (CT.CodeService)   ,
	   										 Parameter6=(IntegerData) (CT.CodePackage)   ,
	   										 Parameter7=(IntegerData) (CT.CodePromotion));

	   -- Levée de l'exception après constitution du message de trace
	   uneAnomalieEval : AnomalieEvaluationExc = new();
	   uneAnomalieEval.SetWithParams(SP_ER_ERROR, unMessage.Value);
	   raise uneAnomalieEval;

end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Evalue : End');

return unTarif;

end method;

------------------------------------------------------------
method MoteurBS.EvalueCRE(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.NumericData
begin
--
--	Description : 	Initiation du contexte puis appel de l'évaluation d'un événement de tarification 
--
--	Type :	concret
--
--	Parametres :    unEvt : L'événement de tarification à valoriser (= évaluer)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueCRE');

	unTarif        : NumericData = NIL;
	TarificationOK : boolean; -- vérification de levée d'exception 
		
begin
	DerniereErreur = EVT_VALIDE;
	TarificationOK = FALSE;
	
	-- Au départ, on considère l'événement comme valide (tarifable = EVT_VALIDE) mais pas
	-- tarifé (ERR_EVT_TARIFE). En cas d'exception, TarificationOK ne passera jamais à TRUE.
	
	-- une exception peut théoriquement se produire pendant le décodage d'un entier
	unNumClient : IntegerData = IntegerData(Value = unEvt.NumClient.IntegerValue); 
	
	-- initialisation du contexte avec les données du contexte d'application
	
	CT.Initialise(NumClient=unNumClient,
				  CodeCategorie=unEvt.CodeCategorie,
				  CodeService=unEvt.CodeService,
				  CodePackage=unEvt.CodePackage,
				  CodeProduit=unEvt.CodeProduit,
				  CodePromotion=unEvt.CodePromotion,
				  CodeDevise=unEvt.CodeDevise);
	
	-- Appel concret de l'évaluation
	unTarif = Self.Evalue();
	
	-- Si on arrive ici, c'est qu'aucune exception n'a été levée, cependant, unTarif peut encore
	-- se trouver à NIL. Dans ce cas, on renvoie ERR_EVT_REJETE_TARIF_IMPOSSIBLE sinon EVT_VALIDE.
	
	TarificationOK = TRUE; -- on arrive ici, donc pas d'exception levée et DerniereErreur = EVT_VALIDE
						   -- cependant, unTarif peut être égal à NIL

exception

    -- Dans le cas d'une exception prévue (de type AnomalieTarificationExc, lancée par AnomalieTarification
	-- après détection d'un cas d'erreur prévu), le code d'erreur est positionné correctement.
	-- on ne fait rien car on a déjà DerniereErreur positionnée
    when e : AnomalieTarificationExc do 
       --	DerniereErreur = DerniereErreur;
       Task.Part.LogMgr.PutLine(e.Message); -- log de l'erreur

	-- Dans le cas d'une exception non prévue (GenericException), l'événement reste à EVT_VALIDE, et doit donc
	-- être repositionné à ERR_EVT_REJETE_RAISON_INCONNUE
	when e : GenericException do
       DerniereErreur = ERR_EVT_REJETE_RAISON_INCONNUE;
       Task.Part.LogMgr.PutLine(e.Message); -- log de l'erreur

end;

LeTarif : NumericData;
if TarificationOK = TRUE and DerniereErreur = EVT_VALIDE and unTarif<>NIL
then 
	 LeTarif = unTarif;
	 DerniereErreur = ERR_EVT_TARIFE; -- ouf, tout est correct
else 
	 LeTarif = NIL; -- aie aie aie !!!

	 -- problème, mais EVT_VALIDE, donc problème non prévu. Si on a autre chose que EVT_VALIDE dans DerniereErreur,
	 -- cela veut dire qu'un problème identifié a donné lieu à la levée d'une exception (via AnomalieTarification) 
	 -- et par voie de conséquence, DerniereErreur est censé contenir un code d'erreur plus précis que 
	 -- EVT_REJETE_RAISON_INCONNUE.

	 if DerniereErreur = EVT_VALIDE 
	 then DerniereErreur = ERR_EVT_REJETE_RAISON_INCONNUE;
	 end if;
end if;

-- Positionnement du code d'erreur dans la structure de l'événement, quelque soit le résultat
unEvt.EtatCre.SetValue(DerniereErreur);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueCRE : End');

return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerMaxiApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie maximale
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueMaxiApplicables');

unRes   : NumericData;
unTarif : NumericData;
Cond    : BooleanData;

for uneRegle in lesRegles do

	Cond = (BooleanData) (uneRegle.Cond.Evalue());
    CompteurEval = CompteurEval + 1;
	
	-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
	if Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE then
		unRes = (NumericData) (uneRegle.Eval.Evalue());

		-- Calcul du tarif maximum
		-- unRes ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull 

		if unRes <> NIL and unRes.IsNull = FALSE and
		  (unTarif = NIL or unRes.IsGreaterThan(unTarif)) 
		then unTarif  =  unRes; 
		end if;	

	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueMaxiApplicables : End');

return unRes;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerMiniApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie minimimale
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueMiniApplicables');

unRes   : NumericData;
unTarif : NumericData;
Cond    : BooleanData;

for uneRegle in lesRegles do

	Cond = (BooleanData) (uneRegle.Cond.Evalue());
    CompteurEval = CompteurEval + 1;

	-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
	if Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE then
		unRes = (NumericData) (uneRegle.Eval.Evalue());

		-- Calcul du tarif minimum
		-- unRes ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull 
		if unRes <> NIL and unRes.IsNull = FALSE and
		  (unTarif = NIL or unRes.IsLessThan(unTarif)) 
		then unTarif  = unRes; 
		end if;	
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueMiniApplicables : End');


return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerPremierApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie standard (= La première règle vérifiée s'applique)
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvaluePremierApplicables');

unTarif : NumericData;
Cond 	: BooleanData;

for uneRegle in lesRegles do
    if      uneRegle.PrixPublic = TRUE then

     		unTarif = (NumericData) (uneRegle.Eval.Evalue()); -- Evaluation du tarif public
		    CompteurEval = CompteurEval + 1;

    else
    		Cond = (BooleanData) (uneRegle.Cond.Evalue());
		    CompteurEval = CompteurEval + 1;

			-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
    		if   Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE
    		then 
    			 unTarif = (NumericData) (uneRegle.Eval.Evalue());
	             exit; -- Sortie immédiate après vérification positive d'une règle
		    end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvaluePremierApplicables : End');

return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvalueTarifPrivilege(input leService: MoteurTarifSrv.NoeudServices): Framework.NumericData
begin
--
--	Description : 	Evaluation d'un tarif privilège
--
--	Type :	concret
--
--	Parametres :    leService : Le noeud service porteur de la liste des privilège pour le service qu'il représente
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueTarifPrivilege');

-- L'appel à LirePriv permet de se rendre indépendant de l'implémentation concrète de la recherche
-- d'un privilège dans le noeud. On peut donc hésiter entre une HashTable et d'autres méthodes de stockage

-- Recherche de l'existence ou non d'un privilège pour la devise, le produit, le service et le client en cours
--
-- LirePriv : Laisser l'exception se lever pour la récupérer plus tard, ne pas renvoyer NIL
--
unPrivilege	: Privilege = leService.LirePriv(CT.NumClient.IntegerValue); 
unTarif		: NumericData = NIL;
if unPrivilege = NIL 
then unTarif = NIL;  -- Rien trouvé, on renvoie NIL. A ce niveau, NIL n'est donc pas une condition d'erreur
else 
     unTarif = (NumericData) (unPrivilege.Eval.Evalue()); -- Trouvé ! On renvoie le résultat
--     CompteurEval = CompteurEval + 1;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueTarifPrivilege : End');

return unTarif;

-- Question : Que se passe t'il si pour une raison ou une autre, cette méthode renvoie NIL 
-- alors qu'elle ne devrait pas et que par la suite, l'évaluation normale se passe bien : 
-- Le tarif privilège est donc ignoré ce qui devient problématique. Peut - être faut t'il 
-- prévoir un traitement pour distinguer un problème dans l'évaluation d'une absence de tarif privilège.

end method;

------------------------------------------------------------
method MoteurBS.Init
begin
--
--	Description : 	Initialisation (au sens méthode Init) du moteur
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Init');

super.Init();
--CT = ContexteTarification(); -- Création du contexte (=instanciation)
--Initialise(CT);			   -- Lancement de l'initialisation (construction de l'arbre)

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Init : End');

end method;

------------------------------------------------------------
method MoteurBS.Initialise(input unContexte: ContexteTarificat.ContexteTarification,
	input GoCompile: Framework.boolean,
	input DoPerformControls: Framework.boolean)
begin
--
--	Description : 	Initialisation du moteur (= construction de l'arbre de recherche, compilation ...)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

-- Lecture des règles
-- Construction de l'arbre


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Initialise');

	PerformControls = DoPerformControls;
	DateReference = new();
	DateReference.SetCurrent();
	
	-- Initialisé ici pour éviter de tester si NIL dans TrouverChemin
	unChemin : array of IntegerData = new();
	unChemin.Clear(); 

	CT = unContexte;
	unCompilateur = new(Contexte=unContexte); -- Création d'une instance du compilateur avec liée à un contexte
	unCompilateur.MapDecimalToDouble();
	AttributionTypeDecimal = TYPE_NUMERIQUE;
/*
	Impossible d'i
	if PerformControls = TRUE then
	   unCompilateur.AppendPre(uneCle=CST_TARIF_A_RENSEIGNER, unObjet='1.0');
	end if;
*/
	
Task.Part.LogMgr.PutLine('INIT/LECTURE DES REGLES NORMALES ET DES REGLES PRIVILEGES');

	lesRegles : array of RegleDesc = DoLireLesRegles();
	lesPrivileges : array of TarifClientDesc = DoLireLesPrivileges();

Task.Part.LogMgr.PutLine('INIT/CONSTRUCTION EFFECTIVE DE L''ARBRE DE RECHERCHE DES REGLES');

	ConstruireArbre(lesRegles,lesPrivileges,unChemin);	  -- Construction de l'arbre de recherche des règles


/*
	GoCompile : BooleanData = new(Value=TRUE);
	post WantCompile(GoCompile);

	event loop
	  register CompileEvent;
	  when self.WantCompile do 
	       exit;
	  when self.CompileAccepted do 
	       GoCompile.Value = TRUE;
	       exit;
	  when self.CompileRejected do
	       GoCompile.Value = FALSE;
	end event;
*/
	
	if GoCompile=TRUE then
	   CompilerArbre();									  -- Compilation des règles 
	end if;

	

	
-- PHASE TERMINALE : (Sorry for that one), impression des différentes statistiques 

PutMessage('regles privileges creees      : ',NombrePrivCrees);
PutMessage('regles crees                  : ',NombreRegles);

PutMessage('Generation de l''arbre','');

PutMessage('noeuds services inseres       : ',NombreServInseres);
PutMessage('noeuds intermediaires         : ',NombreNoeudsInt);
PutMessage('noeuds finaux                 : ',NombreNoeudsFin);
PutMessage('listes de regles              : ',NombreListes);
PutMessage('noeuds explores               : ',NombreExpl);
PutMessage('regles correctement compilees : ',NombreCompilees);

Task.Part.LogMgr.PutLine('INIT/FIN');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Initialise : End');

return;

Exception
   when e : GenericException do
	   Task.Part.LogMgr.PutLine('EXCEPTION LEVEE, ARRET DU MOTEUR ...');
       Self.TraceExc(e,'MoteurBS.Initialise');
       raise;
end method;

------------------------------------------------------------
method MoteurBS.LireDerniereErreur: Framework.integer
begin
return DerniereErreur;
end method;

------------------------------------------------------------
method MoteurBS.LireErreursCompilation: Framework.Array of MoteurTarifSrv.Anomalie
begin
--
--	Description : Renvoi la liste des erreurs sous la forme d'un tableau de RegleDesc (ceux qui posent problème)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	12/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.LireErreursCompilation');

ListeErreurs : array of Anomalie = ErreursCompilation;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.LireErreursCompilation : End');

return ListeErreurs;
end method;

------------------------------------------------------------
method MoteurBS.PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long)
begin
--
--	Description : 	Affichage d'un nombre de ticks d'horloge (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(NumberTicks)');

unMessage.Concat(' ');
unMessage.Concat(NumberTicks);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(NumberTicks) : End');

end method;

------------------------------------------------------------
method MoteurBS.PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData)
begin
--
--	Description : 	Affichage d'un message (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(TextData)');

unMessage.Concat(' ');
unMessage.Concat(unCompl);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(TextData)');

end method;

------------------------------------------------------------
method MoteurBS.SubstituerMacrosVariables(input Tarif: Framework.TextData,
	input TarifDeReference: Framework.TextData = NIL,
	input TarifCategorieStandard: Framework.TextData = NIL,
	input TarifCategorie: Framework.TextData = NIL,
	input TarifSansPromotion: Framework.TextData = NIL,
	input TarifPrixPublic: Framework.TextData = NIL)
begin
--
--	Description : 	Substitution des différents types de tarifs possibles
--
-- 					Cette méthode effectue une substitution de macro-variables 
-- 					par échelons successifs afin d'autoriser des modes de réduction
-- 					plus puissants que par le tarif_normal uniquement.
--
-- 					Le fait de passer des valeurs à NIL permet de vérifier que le tarif correspondant n'est pas
-- 					trouvé dans la chaîne tarif passé en paramètre (1er paramètre)
--
-- 					De plus, le tarif est directement modifié via sa référence (au moyen d'un SetValue). 
--					La référence étant conservée, tous les tarifs concernés sont donc automatiquement mis à jour.
--
--	Type :	concret
--
--	Parametres :    Tarif                  : La chaîne sur laquelle les substitutions sont effectuées
--					TarifDeReference       : Le tarif pour la catégorie standard, hors package et hors promotion
--					TarifCategorieStandard : Le tarif du même package dans la catégorie standard
--					TarifCategorie         : Le tarif en dehors de tout package
--					TarifSansPromotion     : Le tarif sans promotion
--					TarifPrixPublic        : Le passage d'une règle conditionnelle à une règle "prix public"
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.SubstituerMacrosVariables');

Erreur : boolean = false;
ErreurParam : string;
EvalStringSubstituee : TextData = Tarif;

if  Tarif<>NIL then

	
	-- CST_TARIF_DE_REFERENCE
	if  not Erreur then
		if TarifDeReference<>NIL then
		   EvalStringSubstituee = unCompilateur.Expand( srcString  = EvalStringSubstituee,
		   												WithString = TarifDeReference,
		   												WithItem   = CST_TARIF_DE_REFERENCE); 
		else
		   Erreur = unCompilateur.DoesExpand(srcString  = EvalStringSubstituee, WithItem = CST_TARIF_DE_REFERENCE); 
		   ErreurParam = CST_TARIF_DE_REFERENCE;
		end if;
	end if;

	-- CST_TARIF_CATEGORIE_STANDARD
	if  not Erreur then
		if TarifCategorieStandard<>NIL then
		   EvalStringSubstituee = unCompilateur.Expand( srcString  = EvalStringSubstituee,
		   												WithString = TarifCategorieStandard,
		   												WithItem   = CST_TARIF_CATEGORIE_STANDARD); 
		else
		   Erreur = unCompilateur.DoesExpand(srcString  = EvalStringSubstituee, WithItem = CST_TARIF_CATEGORIE_STANDARD); 
		   ErreurParam = CST_TARIF_CATEGORIE_STANDARD;
		end if;
	end if;

	-- CST_TARIF_CATEGORIE
	if  not Erreur then
		if TarifCategorie<>NIL then
		   EvalStringSubstituee = unCompilateur.Expand( srcString  = EvalStringSubstituee,
		   												WithString = TarifCategorie,
		   												WithItem   = CST_TARIF_CATEGORIE); 
		else
		   Erreur = unCompilateur.DoesExpand(srcString  = EvalStringSubstituee, WithItem = CST_TARIF_CATEGORIE); 
		   ErreurParam = CST_TARIF_CATEGORIE;
		end if;
	end if;

	-- CST_TARIF_SANS_PROMOTION
	if  not Erreur then
		if TarifSansPromotion<>NIL then
		   EvalStringSubstituee = unCompilateur.Expand( srcString  = EvalStringSubstituee,
		   												WithString = TarifSansPromotion,
		   												WithItem   = CST_TARIF_SANS_PROMOTION); 
		else
		   Erreur = unCompilateur.DoesExpand(srcString  = EvalStringSubstituee, WithItem = CST_TARIF_SANS_PROMOTION); 
		   ErreurParam = CST_TARIF_SANS_PROMOTION;
		end if;
	end if;

	-- CST_TARIF_PRIX_PUBLIC
	if  not Erreur then
		if TarifPrixPublic<>NIL then
		   EvalStringSubstituee = unCompilateur.Expand( srcString  = EvalStringSubstituee,
		   												WithString = TarifPrixPublic,
		   												WithItem   = CST_TARIF_PRIX_PUBLIC); 
		else
		   Erreur = unCompilateur.DoesExpand(srcString  = EvalStringSubstituee, WithItem = CST_TARIF_PRIX_PUBLIC); 
		   ErreurParam = CST_TARIF_PRIX_PUBLIC;
		end if;
	end if;
	
end if;

if  Erreur then
   	Message : TextData = new();
   	Message.Concat('L''utilisation de ');
   	Message.Concat(ErreurParam);
   	Message.Concat(' n''est pas autorisee');
   	self.AnomalieTarification(Message.Value,Tarif.Value);
else
	Tarif.SetValue(EvalStringSubstituee);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.SubstituerMacrosVariables : End');

end method;

------------------------------------------------------------
method MoteurBS.TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean
begin
VChaine : TextData = unDouble.TextValue;
OK		: boolean  = TRUE;

-- trouver le point décimal, récupérer d'abord le chiffre après le
-- dernier chiffre significatif souhaité, et ensuite la partie à 
-- gauche de ce chiffre

if  VChaine.MoveToChar(DECIMAL_POINT) then

	VChaine.MoveNext(); -- on se positionne sur le point décimal
	
	PosFin  : integer = VChaine.Offset + 1 + Precision; -- calcul du chiffre à arrondir
	ChiffreApres : integer = VChaine.CutRange  (PosFin    , PosFin + 1).IntegerValue;
	
	-- Chiffre qui va porter l'unité supplémentaire en cas d'arrondi
	ChiffreArr   : integer = VChaine.CopyRange (PosFin - 1, PosFin    ).IntegerValue;
	if ChiffreApres > 5 then 
	   ChiffreArr = ChiffreArr + 1;
	end if;
	
	VChaine.SetValue(VChaine.CutRange(0,PosFin-2)); -- -2 car on va greffer le nouveau caractère
	VChaine.Concat(TextData(IntegerValue=ChiffreArr));

	-- Faire l'arrondi de ce que l'on a obtenu
	unDouble.SetValue(VChaine);

else 
	OK = false;
end if;

return OK;


end method;

------------------------------------------------------------
method MoteurBS.TrouverCheminPrivileges(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudServices
begin
--
--	Description : 	Recherche et construction d'une branche de l'arbre de recherche en fonction d'un tarif
--					privilège
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le tarif privilège à insérer
--					Le chemin d'accès au tarif client
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.TrouverCheminPrivileges');

-- Chemin d'accès : Les indices indiquent le niveau de l'arbre
--					Les valeurs stockés indiquent le rang dans le sous tableau des fils

unRang   : integer;
Courant  : NoeudIntermediaire;
Prochain : NoeudIntermediaire;
Services : NoeudServices;

CalculerChemin(unTarifClient,unChemin);  -- Création du chemin d'accès au noeud recherché (version TarifClientDesc)
Courant = (NoeudIntermediaire) (Arbre); -- On démarre de la racine, tant qu'à faire
for Parcours in unChemin do

    unRang = Parcours.Value;    -- Rang du noeud souhaité dans le tableau des fils
	NombreExpl = NombreExpl + 1;
	
	-- Lecture et création si necéssaire du prochain noeud de l'arborescence
	if		Parcours.IsA(RefTypeServiceDesc) then		-- Noeud porteur de services et d'une stratégie
			
			Services = (NoeudServices) (Courant.children[unRang]); -- Niveau suivant : Package, donc NoeudOperations
			if Services = NIL then
	           Services = NoeudServices();
			   Courant.Children[unRang]=Services;
			   NombreServInseres = NombreServInseres + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
	        end if;
			Courant = Services;
			
	else												-- Noeud intermédiaire

			Prochain = (NoeudIntermediaire) (Courant.children[unRang]); -- Niveau suivant : Devise ou catégorie ou package ou produits, donc NoeudIntermediaire
			if Prochain = NIL then
	           Prochain = NoeudIntermediaire();
			   Courant.Children[unRang]=Prochain;
			   NombreNoeudsInt = NombreNoeudsInt + 1;	 
	        end if;
	        Courant = Prochain;
			
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.TrouverCheminPrivileges : End');

return Services; 
end method;

------------------------------------------------------------
method MoteurBS.TrouverCheminRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudPorteurDeRegles
begin
--
--	Description : 	Recherche et construction d'une branche de l'arbre de recherche en fonction d'une règle normale
--
--	Type :	concret
--
--	Parametres :    unRegleDesc : La règle à insérer
--					Le chemin d'accès à la règle
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.TrouverCheminRegles');

-- Chemin d'accès : Les indices indiquent le niveau de l'arbre
--					Les valeurs stockés indiquent le rang dans le sous tableau des fils

unRang   : integer;
Courant  : NoeudIntermediaire;
Prochain : NoeudIntermediaire;
Final	 : NoeudPorteurDeRegles;

CalculerChemin(unRegleDesc,unChemin);  -- Création du chemin d'accès au noeud recherché (version RegleDesc)
Courant = (NoeudIntermediaire) (Arbre); -- On démarre de la racine, tant qu'à faire
for Parcours in unChemin do

    unRang = Parcours.Value;    -- Rang du noeud souhaité dans le tableau des fils
	
	-- Lecture et création si necéssaire du prochain noeud de l'arborescence
	if		Parcours.IsA(RefTypeServiceDesc) then		-- Noeud porteur d'opérations et d'une stratégie
			
			Prochain = (NoeudServices) (Courant.children[unRang]); -- Niveau suivant : Package, donc NoeudOperations
			if Prochain = NIL then
	           Prochain = NoeudServices();
			   Courant.Children[unRang]=Prochain;
			   NombreServInseres = NombreServInseres + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;
	        end if;
			Courant = Prochain;
						
		   		
	elseif	Parcours.IsA(RefTypePromotionDesc) then			-- Noeud porteur de règles

			Final = (NoeudPorteurDeRegles) (Courant.children[unRang]); -- Niveau suivant : Liste de règles, donc NoeudPorteurDeRegles
			if Final = NIL then
	           Final = NoeudPorteurDeRegles();
			   Courant.Children[unRang]=Final;
			   NombreNoeudsFin = NombreNoeudsFin + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
			   NombreListes = NombreListes+1;
			end if;
            if unRegleDesc.PrixPublicBln then
               Final.Strategie = (IntegerNullable) (unRegleDesc.CodeStrategie).Value;   -- Penser à renseigner le champs stratégie.	
            end if;
            
	else												-- Noeud intermédiaire

			Prochain = (NoeudIntermediaire) (Courant.children[unRang]); -- Niveau suivant : Devise ou catégorie ou package ou produits, donc NoeudIntermediaire
			if Prochain = NIL then
	           Prochain = NoeudIntermediaire();
			   Courant.Children[unRang]=Prochain;
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
	        end if;
			Courant = Prochain;
			
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.TrouverCheminRegles : End');

return Final;

exception
	when e : GenericException do
		self.TraceExc(e,'TrouverCheminRegles : Erreur de code stratégie');
		raise;
		
end method;

------------------------------------------------------------
method MoteurBS.TrouverListeRegles(input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData): Framework.Array of MoteurTarifSrv.Regle
begin
--
--	Description : 	Retourne la liste de règles correspondant au contexte
--					d'application passé en paramètre
--
--	Type :	concret
--
--	Parametres :    CodeDevise    : Code de la devise
--					CodeProduit   : Code du produit
--					CodeService   : Code du service
--					CodeCategorie : Code de la catégorie
--					CodePackage	  : Code du package
--					CodePromotion : Code de la promotion
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

--BreakCode = 0;
SAPromotions : NoeudPorteurDeRegles;

SADevises    : NoeudIntermediaire = (NoeudIntermediaire) ((NoeudIntermediaire) (Arbre).Children[CodeDevise.Value]);	
if SADevises <> NIL -- 1
then 
--    BreakCode = BreakCode + 1;
	SAProduits   : NoeudIntermediaire = (NoeudIntermediaire) (SADevises.Children[CodeProduit.Value]);
	if SAProduits <> NIL -- 2 
	then 
--		BreakCode = BreakCode + 1;
		SAServices   : NoeudServices      = (NoeudServices) (SAProduits.Children[CodeService.Value]);
		if SAServices <> NIL -- 3
		then 
--			BreakCode = BreakCode + 1;
			SACategories : NoeudIntermediaire    = (NoeudIntermediaire)   (SAServices.Children[CodeCategorie.Value]);
			if SACategories <> NIL -- 4 
			then 
--				BreakCode = BreakCode + 1;
				SAPackages   : NoeudIntermediaire    = (NoeudIntermediaire)   (SACategories.Children[CodePackage.Value]);
				if SAPackages <> NIL -- 5
				then 
--					BreakCode = BreakCode + 1;
					SAPromotions = (NoeudPorteurDeRegles) (SAPackages.Children[CodePromotion.Value]);
					if SAPromotions <> NIL -- 6 
					then
--					 BreakCode = BreakCode + 1; 
					end if; -- 6
				end if; -- 5;
			end if; -- 4
		end if; -- 3
	end if; -- 2
end if; -- 1


uneListeDeRegles : array of Regle;
if SAPromotions <> NIL 
then
--	 BreakCode = BreakCode + 1;
     uneListeDeRegles = SAPromotions.LesRegles;
end if;

return uneListeDeRegles;

end method;

------------------------------------------------------------
method MoteurBS.TrouveSousChemin(input CodeDevise: Framework.integer,
	input CodeProduit: Framework.integer = -1,
	input CodeService: Framework.integer = -1,
	input CodeCategorie: Framework.integer = -1,
	input CodePackage: Framework.integer = -1,
	input CodePromotion: Framework.integer = -1): Framework.boolean
begin
--
--	Description : 	Exploration "partielle" de l'arbre pour déterminer les branches réellement définies
--					Renvoie le dernier noeud parcouru
--
--	Type :	concret
--
--	Parametres :    CodeDevise    : Code de la devise
--					CodeProduit   : Code du produit
--					CodeService   : Code du service
--					CodeCategorie : Code de la catégorie
--					CodePackage	  : Code du package
--					CodePromotion : Code de la promotion
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	08/06/1998	|	Creation.
--+

Parcours : Noeud;

if CodeDevise <> -1 then
   Parcours = (NoeudIntermediaire) (arbre).Children[CodeDevise];
   if Parcours <> NIL and CodeProduit <> -1 then
	  Parcours = (NoeudIntermediaire) (Parcours).Children[CodeProduit];
	  if Parcours <> NIL and CodeService <> -1 then
		 Parcours = (NoeudIntermediaire) (Parcours).Children[CodeService];
		 if Parcours <> NIL and CodeCategorie <> -1 then
			Parcours = (NoeudIntermediaire) (Parcours).Children[CodeCategorie];
			if Parcours <> NIL and CodePackage <> -1 then
			   Parcours = (NoeudIntermediaire) (Parcours).Children[CodePackage];
			   if Parcours  <> NIL and CodePromotion <> -1 then
				  Parcours = (NoeudIntermediaire) (Parcours).Children[CodePromotion];
			   end if;
			end if;
		 end if;
	  end if;
   end if;
end if;

return Parcours<>NIL;
end method;

------------------------------------------------------------
method MoteurBSControles.DoStartService
begin
CT : ContexteTarification = new();
Initialise(unContexte=CT,GoCompile=FALSE, DoPerformControls=TRUE);
end method;

------------------------------------------------------------
method MoteurBSControles.Init
begin
super.Init();

end method;

------------------------------------------------------------
method MoteurBSMgr.DoAfterSyncServices
begin
--
--	Description :	Enregistrement des dépendances de MoteurBSMgr vers ses fournisseurs
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT		  |	06/05/1998	|	Création.
--	PMT		  |	28/05/1998	|	Prise en compte du démarrage à la demande (moteur)
--+

-- Création d'une instance de MoteurBS


Moteur : MoteurBS = new();
CT : ContexteTarification = ContexteTarification();
self.AppendRow(MoteurBS,Moteur);


/*
DEVRAIT NORMALEMENT FONCTIONNER DE CETTE MANIERE. A VOIR AVEC PV ET DN

self.AppendRow(MoteurBSControles);
self.AppendRow(MoteurBSProduction);
*/

-- L'appel de la méthode Initialise doit se faire plus tard
end method;

------------------------------------------------------------
method MoteurBSMgr.DoInitService
begin
--
--	Description :	Enregistrement des dépendances de MoteurBSMgr vers ses fournisseurs
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT		  |	06/05/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBSMgr.DoInitService');

self.Dependances.AppendRow(soTarificationBSMgr);
self.Dependances.AppendRow(soCatalogueBSMgr);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBSMgr.DoInitService : End');

end method;

------------------------------------------------------------
method MoteurBSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MoteurBSProduction.DoStartService
begin
CT : ContexteTarification = new();
Initialise(unContexte=CT,GoCompile=TRUE, DoPerformControls=FALSE);
end method;

------------------------------------------------------------
method MoteurBSProduction.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Noeud.Init
begin
--
--	Description : Initialisation d'un noeud générique (générique au sens de la tarification)
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Noeud.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Noeud.Init : End');

end method;

------------------------------------------------------------
method NoeudIntermediaire.Init
begin
--
--	Description : Initialisation d'un noeud intermédiaire
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NoeudIntermediaire.Init');

super.Init();
Children = new();  -- on n'initialise que le tableau de fils, mais pas les fils

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NoeudIntermediaire.Init : End');


end method;

------------------------------------------------------------
method NoeudPorteurDeRegles.Init
begin
--
--	Description : Initialisation d'un noeud porteur de règles
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NoeudPorteurDeRegles.Init');

super.Init();
lesRegles = new(); 
strategie = STRATEGIE_INDEFINI;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NoeudPorteurDeRegles.Init : End');

end method;

------------------------------------------------------------
method NoeudServices.AjouterPriv(input unCodeClient: Framework.integer,
	input unPrivilege: MoteurTarifSrv.Privilege)
begin
--
--	Description : Ajout d'un privilège pour le service représenté par le Noeud
--
--	Type :	concret
--
--	Parametres :    unCodeClient : Le code client associé au privilège
--					unPrivilege	 : Le privilege à insérer	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NoeudServices.AjouterPriv');

begin
  Privileges.Enter(Element=unPrivilege,Key=unCodeClient); -- Insertion dans la HashTable
exception
  when e : GenericException do
  begin
	-- Gestion des erreurs, en production, on ne devrait jamais accepter d'insertions multiples
	-- pour un même tuple (devise,produit,service,client)
	-- On doit donc obligatoirement lever une exception pour faire échouer le moteur
	
	if not ACCEPT_DUPLICATES then
		tmpErreur : TextData = new(Value='Attention : Numero de client probablement duplique : ');
		tmpErreur.Concat(IntegerData(Value=unCodeClient));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, tmpErreur.Value);
		raise;
	end if;
  end;
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NoeudServices.AjouterPriv : End');

end method;

------------------------------------------------------------
method NoeudServices.Init
begin
--
--	Description : Initialisation d'un noeud de type service
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NoeudServices.Init');

super.Init();
Privileges = new();
HashFunc : HashFuncs = new(KeyType=SP_KT_INTEGER);
Privileges.Setup(Size=HASHTABLE_BUCKETS,Functions=HashFunc,UniqueKey=not ACCEPT_DUPLICATES);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NoeudServices.Init : End');

end method;

------------------------------------------------------------
method NoeudServices.LirePriv(input CodeClient: Framework.integer): MoteurTarifSrv.Privilege
begin
--
--	Description : Lecture (= Extraction) d'un privilège pour le service représenté par le Noeud et pour
--  			  le code client passé en paramètre. Renvoie NIL si non trouvé, sinon, l'instance du
-- 				  privilège associé au tuple (devise,produit,service,client)
--
--	Type :	concret
--
--	Parametres :    unCodeClient : Le code client à rechercher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+


-- Remarque : Les codes devise, produit et services sont implicites (Déterminés par le noeud sur
-- lequel on effectue l'appel de méthode)

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- NoeudServices.LirePriv');

unPrivilege : Privilege;
unPrivilege = (Privilege) (Privileges.Find(Key=CodeClient));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- NoeudServices.LirePriv : End');

return unPrivilege;
end method;

------------------------------------------------------------
method Privilege.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Privilege.SetParams(input NumCli: Framework.IntegerData,
	input uneEvaluation: CompilateurClasses.ExpressionCompilee)
begin
Eval = uneEvaluation; 
--CodeClient = NumCli;
end method;

------------------------------------------------------------
method Privilege.SetStrings(input uneChaineEval: Framework.TextData)
begin
EvalString = new(Value = uneChaineEval.Value);

end method;

------------------------------------------------------------
method Regle.EvaluatesAs: Framework.DataValue
begin
return Eval.Evalue();
end method;

------------------------------------------------------------
method Regle.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Regle.SetParams(input uneCondition: CompilateurClasses.ExpressionCompilee,
	input uneEvaluation: CompilateurClasses.ExpressionCompilee,
	input IsPrixPublic: Framework.boolean)
begin
Cond = uneCondition;
Eval = uneEvaluation; 
PrixPublic = IsPrixPublic;
end method;

------------------------------------------------------------
method Regle.SetStrings(input uneChaineCond: Framework.TextData,
	input uneChaineEval: Framework.TextData)
begin
CondString = new(Value = uneChaineCond.Value);
EvalString = new(Value = uneChaineEval.Value);
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'moteurta';


end MoteurTarifSrv;
begin TOOL BatchTarifSrv;

includes AddFrameworkBD;
includes ContexteTarificat;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes FrameworkBD;
includes MoteurTarifSrv;
includes GenericDBMS;
includes Framework;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  BatchTarification;
forward  EvenementTarificationInvalideExc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 66;
constant TEST_NUMBER = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class BatchTarification inherits from DataAccessSrvBD.ServiceDesc

has public  constant DECIMAL_POINT = '.';

has public  attribute DateReference: Framework.DateTimeData;
has public  attribute EvenementsLus: Framework.Array of DataAccessSrvBD.CacheDesc;

has public  method ControlerEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer;
has public  method DoInitService;
has public  method DoLireLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method EcrireEvtRejete(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer);
has public  method EcrireEvtTarife(input unEvt: TarificationSrv.EvenementTarificationDesc);
has public  method EvalueEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer;
has public  method GenererEntreeDansFichierLog(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer);
has public  method Init;
has public  method PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long);
has public  method PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData);
has public  method StartBatch;
has public  method TraiterUnLot(input LesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc);
has public  method TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class EvenementTarificationInvalideExc inherits from TarificationSrv.AnomalieTarificationExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soMoteurBSMgr : MoteurTarifSrv.MoteurBSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'BC1E6B50-EE3E-11D1-AF00-41C1BE86AA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method BatchTarification.ControlerEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer
begin
--
--	Description : 	Contrôles d'un événement de tarification avant son traitement
--
--	Type :	concret
--
--	Parametres :    unEvt : Evenement à contrôler
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.ControlerEvt');

aRes : integer = EVT_VALIDE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.ControlerEvt : End');

return aRes;

end method;

------------------------------------------------------------
method BatchTarification.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ServiceDesc
--
--	History :
--
--	PMT		|	06/05/1997	|	Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.DoInitService');

self.Dependances.AppendRow(soTarificationBSMgr);
self.Dependances.AppendRow(soMoteurBSMgr);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method BatchTarification.DoLireLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
--
--	Description : 	Contrôles d'un événement de tarification avant son traitement
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.DoLireLesEvenements');

Task.Part.LogMgr.PutLine('************* Lecture evenements de tarification en cours ***************');

unCache : array of EvenementTarificationDesc;
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_READALL_EVT;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)
unCache = (array of EvenementTarificationDesc) (self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS));

PutMessage('Nombre d''evenements lus : ',unCache.Items);
Task.Part.LogMgr.PutLine('************* Lecture des evenements terminee ***************');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.DoLireLesEvenements : End');


return unCache;

end method;

------------------------------------------------------------
method BatchTarification.EcrireEvtRejete(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer)
begin
--
--	Description : 	Ecriture d'un événement rejeté dans la table des événements rejetés
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement rejeté
--					Raison : Code d'errreur décrivant la raison du rejet
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EcrireEvtRejete');

unEvt.EtatCre.SetValue(Raison);
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_APPEND_EVTREJETE;
aTransData.TransObject = unEvt;
self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS);
self.GenererEntreeDansFichierLog(unEvt, Raison);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EcrireEvtRejete : End');


end method;

------------------------------------------------------------
method BatchTarification.EcrireEvtTarife(input unEvt: TarificationSrv.EvenementTarificationDesc)
begin
--
--	Description : 	Ecriture d'un événement correctement tarifé dans la table des événements tarifés
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement tarifé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EcrireEvtTarife');

unEvt.EtatCre.SetValue(ERR_EVT_TARIFE);
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_APPEND_EVTTARIFE;
aTransData.TransObject = unEvt;
self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EcrireEvtTarife : End');

end method;

------------------------------------------------------------
method BatchTarification.EvalueEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer
begin
--
--	Description : 	Evaluation d'un événement de tarification
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement tarifé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EvalueEvt');

TarifTTC : NumericData;  -- Résultat 
EvtVal   : integer =  ERR_EVT_REJETE_RAISON_INCONNUE;      -- Code d'erreur

begin
	-- 1ERE Etape : Appel du moteur pour valoriser l'événement
	aTransData : TransDesc = new();
	aTransData.TransActionService = ACT_TARIF_EVALUE;
	aTransData.TransObject = unEvt;
	unEvt.TarifTTC = (DoubleData) (self.Transfer(aTransData,soMoteurBSMgr,MoteurBS));
	EvtVal = unEvt.EtatCre.Value;
	aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement
exception -- Aucune exception ne devrait arriver ici
	when e : GenericException do
	  Task.Part.LogMgr.PutLine('Attention (Alarme moteur) : Aucune exception ne devrait être captée ici [BatchTarification.EvalueCRE]');
	  unEvt.TarifTTC.SetValue(0);
	  unEvt.EtatCRE.SetValue(ERR_EVT_REJETE_RAISON_INCONNUE);
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EvalueEvt : End');

return EvtVal;
end method;

------------------------------------------------------------
method BatchTarification.GenererEntreeDansFichierLog(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer)
begin
--
--	Description : 	Ecriture d'une entrée dans le fichier de log pour décrire une erreur 
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement rejeté
--					Raison : Code d'errreur décrivant la raison du rejet
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/07/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog');

/*

Exc : ImplementationExc = new();
Exc.SetWithParams(SP_ER_ERROR,' Oops ! Forgot something ?');
raise Exc;

*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog : End');

end method;

------------------------------------------------------------
method BatchTarification.Init
begin
--
--	Description : 	Initialisation du batch de tarification
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.Init');

super.Init();
DateReference = new();				-- Création de la date de référence à la date du jour
DateReference.SetCurrent(DR_DAY);	-- Pb : Comment paramétrer le batch de tarification
									-- sans faire appel à un service objet

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.Init : End');

end method;

------------------------------------------------------------
method BatchTarification.PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long)
begin
--
--	Description : 	Affichage d'un nombre de ticks d'horloge (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.PutMessage(NumberTicks)');

unMessage.Concat(' ');
unMessage.Concat(NumberTicks);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.PutMessage(NumberTicks) : End');

end method;

------------------------------------------------------------
method BatchTarification.PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData)
begin
--
--	Description : 	Affichage d'un message (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.PutMessage(TextData)');

unMessage.Concat(' ');
unMessage.Concat(unCompl);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.PutMessage(TextData) : End');

end method;

------------------------------------------------------------
method BatchTarification.StartBatch
begin
--
--	Description : 	Méthode de démarrage du batch de tarification
--
--	Type :	concret
--
--	Parametres :    Aucune (= Start Method)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.StartBatch');

self.InitService();

CT : ContexteTarification = ContexteTarification();


-- Demande de compilation
aTransData : TransDesc = new();
aTransData.TransActionService = ACT_TARIF_COMPILE;
aTransData.TransObject = NIL;
self.Transfer(aTransData,soMoteurBSMgr,MoteurBS);
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement

-- Demande de contrôle
aTransData  = new();
aTransData.TransActionService = ACT_TARIF_CONTROLE;
aTransData.TransObject = NIL;
self.Transfer(aTransData,soMoteurBSMgr,MoteurBS);
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement

-- Démarrage effectif du moteur
aTransData  = new();
aTransData.TransActionService = ACT_TARIF_INITIALISE;
aTransData.TransObject = CT;
self.Transfer(aTransData,soMoteurBSMgr,MoteurBS);
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement


lesEvenements : array of EvenementTarificationDesc = DoLireLesEvenements();
TraiterUnLot(lesEvenements);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.StartBatch : End');

end method;

------------------------------------------------------------
method BatchTarification.TraiterUnLot(input LesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc)
begin
--
--	Description : 	Traitement d'un lot d'événements de tarification (= une table evtsource)
--
--	Type :	concret
--
--	Parametres :    LesEvenements : La liste des événements du lot
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.TraiterUnLot');

TarifTTC : NumericData;

Task.Part.LogMgr.PutLine('TRT/EVALUATION DES CRE');

ChronoEval : Chronometre = new();
ChronoEval.Fire();

-- Evaluation des événements de tarification et réécriture des événements de 
-- tarification dans les tables correspondantes.

NbTarifes : integer = 0;
NbRejetes : integer = 0;
EvtVal    : integer = ERR_EVT_REJETE_RAISON_INCONNUE;

-- Tarification de tous les événements

for unEvt in lesEvenements do

  -- Le  traitement d'exception est effectué à l'intérieur de la boucle pour ne pas
  -- interrompre le traitement en cas de problème sur un événement
  
  begin
	unEvt.DateTarification.SetValue(DateReference); -- positionnement de la date exacte de l'évaluation de 
													-- l'événement de tarification avant toute possibilité
													-- de levée d'exception. L'événement sera réécrit quelque
													-- soit l'issue de son traitement.

	 -- Avant tout, on doit contrôler la validité de l'événement de tarification
	 EvtVal = ControlerEvt(unEvt); -- DoCheckValidity ???
	 if EvtVal <> EVT_VALIDE then
		unEvt.EtatCRE.SetValue(EvtVal);
		Exc : EvenementTarificationInvalideExc = new();
		Exc.SetWithParams(SP_ER_ERROR,'Evenement de tarification invalide');
		raise Exc;
	 end if;

	 -- Ensuite, on procède à son évaluation
    EvtVal = EvalueEvt(unEvt);
	if EvtVal <> ERR_EVT_TARIFE  -- et à l'écriture
	then EcrireEvtRejete(unEvt,EvtVal); -- dans la table des evt rejetés si un problème est survenu
	else 
	--	 TroncatureSure(unEvt.TarifTTC, 2); -- pas si sûre que çà (sic)
		 EcrireEvtTarife(unEvt);		-- dans la table des evt tarifés si tout s'est bien passé
	end if;
    
  exception
    
    -- si on arrive dans ces blocs d'exceptions, cela veut dire que l'exception a été levée dans l'évaluation
    
    when e : EvenementTarificationInvalideExc do
		EcrireEvtRejete(unEvt, ERR_EVT_REJETE_INVALIDE);
    when e: GenericException do
		EcrireEvtRejete(unEvt, ERR_EVT_REJETE_RAISON_INCONNUE);
  end; 

end for;

PutMessage('Temps total d''evaluation : ',ChronoEval.AsText());
Task.Part.LogMgr.PutLine('TRT FIN');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.TraiterUnLot : End');

end method;

------------------------------------------------------------
method BatchTarification.TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean
begin
--
--	Description : 	Troncature (méthode : Chaîne) d'un DoubleData
--
--	Type :	concret
--
--	Parametres :    unDouble : Le nombre à tronquer
--					Precision : Le nombre de chiffres souhaités (après le caractère décimal)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.TroncatureSure');

VChaine : TextData = unDouble.TextValue;
OK		: boolean  = TRUE;

-- trouver le point décimal, récupérer d'abord le chiffre après le
-- dernier chiffre significatif souhaité, et ensuite la partie à 
-- gauche de ce chiffre

if  VChaine.MoveToChar(DECIMAL_POINT) then

	VChaine.MoveNext(); -- on se positionne sur le point décimal
	
	PosFin  : integer = VChaine.Offset + Precision; -- calcul du chiffre à arrondir
	ChiffreApres : integer = VChaine.CutRange  (PosFin    , PosFin + 1).IntegerValue;
	
	-- Chiffre qui va porter l'unité supplémentaire en cas d'arrondi
	ChiffreArr   : integer = VChaine.CopyRange (PosFin - 1, PosFin    ).IntegerValue;
	if ChiffreApres >= 5 then 
	   ChiffreArr = ChiffreArr + 1;
	end if;
	
	VChaine.SetValue(VChaine.CutRange(0,PosFin-1)); -- -1 car on va greffer le nouveau caractère
	VChaine.Concat(TextData(IntegerValue=ChiffreArr));

	-- Faire l'arrondi de ce que l'on a obtenu
	unDouble.SetValue(VChaine);

else 
	OK = false;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.TroncatureSure : End');

return OK;


end method;

------------------------------------------------------------
method EvenementTarificationInvalideExc.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'batchtar';
	StartingMethod = (class = BatchTarification, method = StartBatch);


end BatchTarifSrv;
begin TOOL BatchTarifValidationSrv;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes ContexteTarificat;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes DicoBD;
includes DicoSrvBD;
includes FileDataAccessSrv;
includes FrameworkBD;
includes MoteurTarifSrv;
includes GenericDBMS;
includes Framework;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  BatchTarification;
forward  EvenementTarificationInvalideExc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 66;
constant TEST_NUMBER = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class BatchTarification inherits from DataAccessSrvBD.ServiceDesc

has public  constant A1 = 9;
has public  constant A2 = 9;
has public  constant A3 = 8;
has public  constant DECIMAL_POINT = '.';

has public  attribute BufferOD: TarificationSrv.OperationDiverseDesc;
has public  attribute ConversionTVA: Framework.DoubleNullable;
has public  attribute DateReference: Framework.DateTimeData;
has public  attribute EvenementsLus: Framework.Array of DataAccessSrvBD.CacheDesc;
has public  attribute InstanceYear2000: Framework.DateTimeData;
has public  attribute InstanceZeroValue: Framework.DoubleData;
has public  attribute Sequenceurs: Framework.Array of Framework.IntegerData;
has public  attribute TableServicesODs: Framework.Array of TarificationSrv.ServiceOD;

has public  method CleCompteBD(input Value: Framework.TextData): Framework.IntegerData;
has public  method ControlerEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer;
has public  method DoInitService;
has public  method DoLireLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method EcrireEvtRejete(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer);
has public  method EcrireEvtTarife(input unEvt: TarificationSrv.EvenementTarificationDesc);
has public  method EvalueEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer;
has public  method GenererEntreeDansFichierLog(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer);
has public  method GenererEntreeDansFichierLog(input unMessage: Framework.TextData);
has public  method Init;
has public  method OD_ConstruireTableCorrespondanceServicesODs;
has public  method OD_DecrementerSequence(input CodeService: Framework.integer): Framework.integer;
has public  method OD_FormaterDateEnDateSAB(input uneDate: Framework.DateTimeData): Framework.integer;
has public  method OD_FormaterEvenementEnOD(input unEvt: TarificationSrv.EvenementTarificationDesc): DataAccessSrvBD.ObjectSelfDesc;
has public  method OD_IncrementerSequence(input CodeService: Framework.integer): Framework.integer;
has public  method OD_InitialiserLesSequences;
has public  method OD_MoisDeTarification(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.TextData;
has public  method OD_ServiceODParCodeService(input unCodeService: Framework.integer): TarificationSrv.ServiceOD;
has public  method PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long);
has public  method PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData);
has public  method StartBatch;
has public  method TarificationEnDur(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.DoubleData;
has public  method TraiterUnLot(input LesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc);
has public  method TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class EvenementTarificationInvalideExc inherits from TarificationSrv.AnomalieTarificationExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method BatchTarification.CleCompteBD(input Value: Framework.TextData): Framework.IntegerData
begin
C     : array of IntegerData = new();
Total : integer;
Res	  : IntegerData;
X	  : integer;
Z 	  : integer;
K	  : IntegerData;

NCSansCle : TextData = new(Value=Value.Value);

-- Extraction des chiffres du code client
for i in 1 to 7 do 
  C[i] = new(TextValue = NCSansCle.CopyRange(i-1,i));
end for;

Total = 9*A1+8*A2+7*A3+6*C[1].Value+5*C[2].Value+4*C[3].Value+3*C[4].Value+2*C[5].Value;
Res   = new();
Res.Mod(Total, 11);

if Res.Value=0 or Res.Value=1 
then X = Res.Value;
else X = 11 - Res.Value;
end if;

Z = X - C[6].Value;
if Z < 0 then Z = Z * -1; end if;

K = new(Value = Z + C[7].Value);
if K.Value>=10 then
   BK : IntegerData = K.Clone(Deep = TRUE);
   K.SetValue(K.Value / 10  + BK.Mod(BK.Value,10).Value);   
end;

return K;

end method;

------------------------------------------------------------
method BatchTarification.ControlerEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer
begin
--
--	Description : 	Contrôles d'un événement de tarification avant son traitement
--
--	Type :	concret
--
--	Parametres :    unEvt : Evenement à contrôler
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.ControlerEvt');

aRes : integer = EVT_VALIDE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.ControlerEvt : End');

return aRes;

end method;

------------------------------------------------------------
method BatchTarification.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : ServiceDesc
--
--	History :
--
--	PMT		|	06/05/1997	|	Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.DoInitService');

self.Dependances.AppendRow(soTarificationBSMgr);
--self.Dependances.AppendRow(soMoteurBSMgr); /* $MOTEUR */

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method BatchTarification.DoLireLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
--
--	Description : 	Contrôles d'un événement de tarification avant son traitement
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.DoLireLesEvenements');

Task.Part.LogMgr.PutLine('************* Lecture evenements de tarification en cours ***************');

unCache : array of EvenementTarificationDesc;
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_READALL_EVT;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)
unCache = (array of EvenementTarificationDesc) (self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS));

PutMessage('Nombre d''evenements lus : ',unCache.Items);
Task.Part.LogMgr.PutLine('************* Lecture des evenements terminee ***************');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.DoLireLesEvenements : End');


return unCache;

end method;

------------------------------------------------------------
method BatchTarification.EcrireEvtRejete(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer)
begin
--
--	Description : 	Ecriture d'un événement rejeté dans la table des événements rejetés
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement rejeté
--					Raison : Code d'errreur décrivant la raison du rejet
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EcrireEvtRejete');

unEvt.EtatCre.SetValue(Raison);
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_APPEND_EVTREJETE;
aTransData.TransObject = unEvt;
self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS);
self.GenererEntreeDansFichierLog(unEvt, Raison);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EcrireEvtRejete : End');


end method;

------------------------------------------------------------
method BatchTarification.EcrireEvtTarife(input unEvt: TarificationSrv.EvenementTarificationDesc)
begin
--
--	Description : 	Ecriture d'un événement correctement tarifé dans la table des événements tarifés
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement tarifé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EcrireEvtTarife');

-- ECRITURE DE L'EVENEMENT DANS LA TABLE DES EVENEMENTS TARIFES
unEvt.EtatCre.SetValue(ERR_EVT_TARIFE);
aTransData : TransDesc = new();
aTransData.TransactionService = ACT_TARIF_APPEND_EVTTARIFE;
aTransData.TransObject = unEvt;
self.Transfer(aTransData,soTarificationBSMgr,EvenementTarificationBS);

-- GENERATION DE LA LIGNE "OPERATION DIVERSE" CORRESPONDANTE
aTransData = new();
aTransData.TransActionService = ACT_STD_APPEND;
unCacheDesc : CacheDesc = new();
unCacheDesc.Record = OD_FormaterEvenementEnOD(unEvt);
aTransData.TransObject = unCacheDesc;
self.Transfer(aTransData, soTarificationBSMgr, OperationDiverseBS);
aTransData = NIL;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EcrireEvtTarife : End');

end method;

------------------------------------------------------------
method BatchTarification.EvalueEvt(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.integer
begin
--
--	Description : 	Evaluation d'un événement de tarification
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement tarifé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.EvalueEvt');

TarifTTC : NumericData;  -- Résultat 
EvtVal   : integer =  ERR_EVT_REJETE_RAISON_INCONNUE;      -- Code d'erreur

begin
	-- 1ERE Etape : Appel du moteur pour valoriser l'événement
	aTransData : TransDesc = new();
	aTransData.TransActionService = ACT_TARIF_EVALUE;
	aTransData.TransObject = unEvt;
--	unEvt.TarifTTC = (DoubleData) (self.Transfer(aTransData,soMoteurBSMgr,MoteurBS)); /* $MOTEUR */
	unEvt.TarifTTC = self.TarificationEnDur(unEvt);
	EvtVal = unEvt.EtatCre.Value;
	aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement
exception -- Aucune exception ne devrait arriver ici
	when e : GenericException do
	  Task.Part.LogMgr.PutLine('Attention (Alarme moteur) : Aucune exception ne devrait être captée ici [BatchTarification.EvalueCRE]');
	  unEvt.TarifTTC.SetValue(0);
	  unEvt.EtatCRE.SetValue(ERR_EVT_REJETE_RAISON_INCONNUE);
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.EvalueEvt : End');

return EvtVal;
end method;

------------------------------------------------------------
method BatchTarification.GenererEntreeDansFichierLog(input unEvt: TarificationSrv.EvenementTarificationDesc,
	input Raison: Framework.integer)
begin
--
--	Description : 	Ecriture d'une entrée dans le fichier de log pour décrire une erreur 
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement rejeté
--					Raison : Code d'errreur décrivant la raison du rejet
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/07/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog');

/*

Exc : ImplementationExc = new();
Exc.SetWithParams(SP_ER_ERROR,' Oops ! Forgot something ?');
raise Exc;

*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog : End');

end method;

------------------------------------------------------------
method BatchTarification.GenererEntreeDansFichierLog(input unMessage: Framework.TextData)
begin
--
--	Description : 	Ecriture d'une entrée dans le fichier de log pour décrire une erreur 
--
--	Type :	concret
--
--	Parametres :    unEvt  : Evenement rejeté
--					Raison : Code d'errreur décrivant la raison du rejet
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	03/07/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog');

/*

Exc : ImplementationExc = new();
Exc.SetWithParams(SP_ER_ERROR,' Oops ! Forgot something ?');
raise Exc;

*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.GenererEntreeDansFichierLog : End');

end method;

------------------------------------------------------------
method BatchTarification.Init
begin
--
--	Description : 	Initialisation du batch de tarification
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.Init');

super.Init();
DateReference = new();				-- Création de la date de référence à la date du jour
DateReference.SetCurrent(DR_DAY);	-- Pb : Comment paramétrer le batch de tarification
									-- sans faire appel à un service objet
TableServicesOds = new();			-- Table de correspondance entre les services et les ODs
InstanceZeroValue = new(TextValue='0.0');
InstanceYear2000  = new(TextValue='01-Jan-2000'); -- Créer une instance du premier jour  de l'an 2000
ConversionTVA = new();				-- Taux de conversion de TTC vers HT, en f° des dates de validité
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.Init : End');


end method;

------------------------------------------------------------
method BatchTarification.OD_ConstruireTableCorrespondanceServicesODs
begin
-- Récupération de la liste des services et création d'une table de correspondance indexée par le code service

aTransData : TransDesc = new();
aTransData.TransActionService = ACT_STD_READ;
aTransData.TransObject = NIL;
LesServices : array of CacheDesc = (array of CacheDesc) (self.Transfer(aTransData, soCatalogueBSMgr, ServiceBS));
CurrService : ServiceOD;
leService   : Service_Desc;

for unService in lesServices do

	leService = (Service_Desc) (unService.Record);
	CurrService = TableServicesODs[leService.CodeService.Value];
	if CurrService <> NIL 
	then
	   Exc : AnomalieTarificationExc = new();
	   Exc.SetWithParams(SP_ER_ERROR, 'OperationDiverseBS.ConstruireTableCorrespondanceServicesODs : Code service dupliqué');
	   raise Exc;
	else
	   CurrService = new();
	   CurrService.CodeOD = leService.CodeOD.Value;
	   CurrService.RubriqueOD = leService.RubriqueOD.Value;
	   CurrService.Libelle1 = leService.LibelleFacturation.Value;
	   CurrService.Libelle2 = 'NONDEF';
	   TableServicesODs[leService.CodeService.Value] = CurrService;	
	end if;
		
end for;



end method;

------------------------------------------------------------
method BatchTarification.OD_DecrementerSequence(input CodeService: Framework.integer): Framework.integer
begin
-- Décrémentation du numéro de séquence pour un code service donné

aResult : integer = 0;
Sequence : IntegerData = Sequenceurs[CodeService];
if Sequence <> NIL then
   Sequence.Subtract(Sequence,1); -- Value ?
   aResult = Sequence.Value;
else
   Exc : AnomalieTarificationExc = new();
   Exc.SetWithParams(SP_ER_ERROR, 'IncrementerSequence/Une sequence a NIL');
   raise Exc;
end if;

return aResult;

end method;

------------------------------------------------------------
method BatchTarification.OD_FormaterDateEnDateSAB(input uneDate: Framework.DateTimeData): Framework.integer
begin
uneDateSAB : integer = 0;
Prefix     : integer = 0;
Day        : integer = 0;
Month      : integer = 0;
Year       : integer = 0;

begin
--	Task.Part.LogMgr.Put('Date : ');
--	Task.Part.LogMgr.PutLine(uneDate.Value);
	aDateFormat : DateFormat = new(Template='yyyymmdd');
	DateAsText : TextData   = aDateFormat.FormatDate(uneDate); -- La date est maintenant dans un format pratique
															   -- pour l'extraction des champs necéssaires au
															   -- format SAB. De plus, le format est garanti
															   -- contrairement au format par défaut de Forté
															   -- (Problème d'une évolution potentielle du
															   -- format par défaut des dates).
	Prefix = DateAsText.CutRange(0,2).IntegerValue - 19;       -- Récupérer le préfixe
	Prefix = Prefix * 1000000;								   -- Affectation du poids le plus fort 
	
	uneDateSAB = DateAsText.IntegerValue;					   -- On peut récupérer directement le reste
	uneDateSAB = uneDateSAB + Prefix;						   -- Et on ajoute le code de préfixe
	
exception
	when e : GenericException do uneDateSAB = 0; -- Problème quelquonque (devrait gérer les cas ou la 
												 -- date est à NIL ou à IsNull = TRUE
end;

return uneDateSAB;								 

end method;

------------------------------------------------------------
method BatchTarification.OD_FormaterEvenementEnOD(input unEvt: TarificationSrv.EvenementTarificationDesc): DataAccessSrvBD.ObjectSelfDesc
begin
begin
	BufferOD.Etablissement.SetValue(1);
	BufferOD.Agence.SetValue(1);
	BufferOD.Servic.SetValue('1');
	BufferOD.SousService.SetValue('1');
	BufferOD.CodeUtilisateur.SetValue(9);
	BufferOD.Plan.SetValue(1);
	
	unServiceOD : ServiceOD = OD_ServiceODParCodeService(unEvt.CodeService.Value);
	
/*
	if unServiceOD = NIL then -- $TEST
	   unServiceOD = new();
	end if;
*/
	
	if unServiceOD = nil then
		Exc : AnomalieTarificationExc = new();
		Exc.SetWithParams(SP_ER_ERROR, 'Code service ou OD inexistant');
		raise Exc;
	else
		BufferOD.Opera.SetValue(unServiceOD.CodeOD);		 -- Code OD de l'OD
		BufferOD.Rubrique2.SetValue(unServiceOD.RubriqueOD); -- Code rubrique de l'OD
		BufferOD.Libelle1.SetValue(unServiceOD.Libelle1);	 -- Premier libellé de tarification
		BufferOD.Libelle2.SetValue(unServiceOD.Libelle2);	 -- Deuxième libellé de tarification
	end if;
	
	BufferOD.CodeEvenement.SetValue('TAR'); -- Voir comment traiter les rétrocessions
	BufferOD.NoPiece.SetValue(0);
	
	NoSeq : integer = OD_IncrementerSequence(unEvt.CodeService.Value);
	BufferOD.NoSequence.SetValue(NoSeq);
	BufferOD.Multicre.SetValue(FALSE);
	
	if NoSeq = 1 
	then BufferOD.CodeEtat.SetValue('002'); -- Mettre à 002 uniquement pour la première ligne de la séquence
	else BufferOD.CodeEtat.SetValue('   ');
	end if;
	
	BufferOD.TypeClientTiers1.SetValue(' ');
	BufferOD.NumeroClient1.SetValue(unEvt.NumClient.TextValue);
	BufferOD.TypeClientTiers2.SetValue(' ');
	BufferOD.NumeroClient2.SetValue('');
	
	unEvt.DateFacturation.SetValue(DateReference); -- Mettre à la date du jour pour l'instant /* $TEST */
	BufferOD.Date1.SetValue(OD_FormaterDateEnDateSAB(unEvt.DateFacturation));
	BufferOD.Date2.SetValue(0);
	BufferOD.Date3.SetValue(0);
	BufferOD.Date4.SetValue(0);
	BufferOD.DateValeur1.SetValue(0);
	BufferOD.DateValeur2.SetValue(0);
	BufferOD.DateValeur3.SetValue(0);
	BufferOD.DateValeur4.SetValue(0);
	
	if     unEvt.CodeDevise.Value = DEVISE_FRANC then BufferOD.Devise1.SetValue('FRF'); 
	elseif unEvt.CodeDevise.Value = DEVISE_EURO  then BufferOD.Devise1.SetValue('EUR');
	else
		   Exc : AnomalieTarificationExc = new();
		   Exc.SetWithParams(SP_ER_ERROR, 'OD_FormaterEvenementEnOD : Code devise incorrect');
		   raise Exc;
	end if;
		 
		
	BufferOD.Devise2.SetValue('');
	BufferOD.Montant1.SetValue(unEvt.TarifTTC);
	if unServiceOD.CodeOD = '*PC' then
	   BufferOD.Montant2.SetValue(100.0); -- Droit d'entrée en fonction des codes services
	end if;
	
	BufferOD.Montant3.SetValue(0);
	BufferOD.Montant4.SetValue(0);
	BufferOD.Montant5.SetValue(0);
	BufferOD.Montant6.SetValue(0);
	BufferOD.Montant7.SetValue(0);
	BufferOD.Montant8.SetValue(0);
	BufferOD.CodeSynonyme1.SetValue('');
	BufferOD.Compte1.SetValue(unEvt.CompteAFacturer);
	BufferOD.CodeSynonyme2.SetValue('');
	BufferOD.Compte2.SetValue('');
	BufferOD.CodeSynonyme3.SetValue('');
	BufferOD.Compte3.SetValue('');
	BufferOD.NoCheque.SetValue('');
	BufferOD.Rubrique1.SetValue(OD_MoisDeTarification(unEvt)); -- Mois de tarification
	BufferOD.Rubrique3.SetValue('');
	BufferOD.Rubrique4.SetValue('');
	
	TarifHT : DoubleNullable = new();
	TarifHT.Divide(unEvt.TarifTTC, ConversionTVA);
	BufferOD.MontantCommission1.SetValue(TarifHT);

	BufferOD.MontantCommission1.SetValue('1.0');	
	BufferOD.DateCommission1.SetValue(0);
	BufferOD.MontantTVA1.SetValue(0);
	BufferOD.MontantCommission2.SetValue(0);
	BufferOD.DateCommission2.SetValue(0);
	BufferOD.MontantTVA2.SetValue(0);
	BufferOD.MontantCommission3.SetValue(0);
	BufferOD.DateCommission3.SetValue(0);
	BufferOD.MontantTVA3.SetValue(0);
	BufferOD.MontantCommission4.SetValue(0);
	BufferOD.DateCommission4.SetValue(0);
	BufferOD.MontantTVA4.SetValue(-1.0);

exception
	when e : GenericException do 
    	OD_DecrementerSequence(unEvt.CodeService.Value); -- Comment contrôler le code service ?
end;

return BufferOD;
end method;

------------------------------------------------------------
method BatchTarification.OD_IncrementerSequence(input CodeService: Framework.integer): Framework.integer
begin
-- Incrémentation du numéro de séquence pour un code service donné

aResult : integer = 0;
Sequence : IntegerData = Sequenceurs[CodeService];
if Sequence <> NIL then
   Sequence.Add(Sequence,1); -- Value ?
   aResult = Sequence.Value;
else
   Exc : AnomalieTarificationExc = new();
   Exc.SetWithParams(SP_ER_ERROR, 'IncrementerSequence/Une sequence a NIL');
   raise Exc;
end if;

return aResult; 

end method;

------------------------------------------------------------
method BatchTarification.OD_InitialiserLesSequences
begin
Sequenceurs = new(); -- new fait ici afin de planter plus tard si on oublie l'appel à InitialiserLesSequences
					 -- De plus, les séquenceurs sont remis à zéro de fait

-- On procède à la lecture de tous les services
aTransData : TransDesc = new();
aTransData.TransActionService = ACT_STD_READ;
aTransData.TransObject = NIL;
LesServices : array of CacheDesc = (array of CacheDesc) (self.Transfer(aTransData, soCatalogueBSMgr, ServiceBS));
LeService   : Service_Desc;

-- On instancie (ce qui aura pour effet de remettre à zéro)
for unService in lesServices do
	
	LeService = (Service_Desc) (unService.Record);
	Sequenceurs [ leService.CodeService.Value ] = new(Value=0);	
	Task.Part.LogMgr.Put('S');
	Task.Part.LogMgr.Put(LeService.CodeService.Value);	
	Task.Part.LogMgr.Put(' ');
end for;

-- L'intérêt de la boucle, outre de mettre les valeurs à zéro est que le tableau est correctement
-- dimensionné, et donc, pendant la génération des ODs, il n'y aura pas de baisse de performance


end method;

------------------------------------------------------------
method BatchTarification.OD_MoisDeTarification(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.TextData
begin
return '';
end method;

------------------------------------------------------------
method BatchTarification.OD_ServiceODParCodeService(input unCodeService: Framework.integer): TarificationSrv.ServiceOD
begin
unServiceOD : ServiceOD = TableServicesODs[unCodeService];
return unServiceOD;

end method;

------------------------------------------------------------
method BatchTarification.PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long)
begin
--
--	Description : 	Affichage d'un nombre de ticks d'horloge (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.PutMessage(NumberTicks)');

unMessage.Concat(' ');
unMessage.Concat(NumberTicks);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.PutMessage(NumberTicks) : End');

end method;

------------------------------------------------------------
method BatchTarification.PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData)
begin
--
--	Description : 	Affichage d'un message (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.PutMessage(TextData)');

unMessage.Concat(' ');
unMessage.Concat(unCompl);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.PutMessage(TextData) : End');

end method;

------------------------------------------------------------
method BatchTarification.StartBatch
begin
--
--	Description : 	Méthode de démarrage du batch de tarification
--
--	Type :	concret
--
--	Parametres :    Aucune (= Start Method)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.StartBatch');

self.InitService();

-- INSTANCIATION ET LANCEMENT DU MOTEUR : CE CODE DEVRAIT NORMALEMENT DISPARAITRE 
-- (UTILISATION DE DEUX CLASSES HERITANT DE MOTEURBS, AFIN PERMETTRE UN PARAMETRAGE
-- PLUS PRATIQUE ET UN HEBERGEMENT DES DEUX SERVICES (MOTEURBSPRODUCTION ET MOTEURBSCONTROLES)

BufferOD = new();
BufferOD.DoResetAttributes();
BufferOD.SelfDesc = new();
BufferOD.DoResetSelfDesc();

CT : ContexteTarification = ContexteTarification();

-- Demande de compilation
aTransData : TransDesc = new();
aTransData.TransActionService = ACT_TARIF_COMPILE;
aTransData.TransObject = NIL;
--self.Transfer(aTransData,soMoteurBSMgr,MoteurBS); /* $MOTEUR */
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement

-- Demande de contrôle
aTransData  = new();
aTransData.TransActionService = ACT_TARIF_CONTROLE;
aTransData.TransObject = NIL;
 --self.Transfer(aTransData,soMoteurBSMgr,MoteurBS); /* $MOTEUR */
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement

-- Démarrage effectif du moteur
aTransData  = new();
aTransData.TransActionService = ACT_TARIF_INITIALISE;
aTransData.TransObject = CT;
--self.Transfer(aTransData,soMoteurBSMgr,MoteurBS); /* $MOTEUR */
aTransData = NIL; -- Pour éviter de saturer la mémoire trop rapidement

-- CONSTRUCTION DE LA TABLE DE CORRESPONDANCE ENTRE LES SERVICES ET LES ODS
OD_ConstruireTableCorrespondanceServicesODs();

-- LECTURE DU TAUX DE TVA EN COURS DE VALIDITE
aTransData = new();
aTransData.TransActionService = ACT_TARIF_TAUX;
aTransData.TransObject = DateReference;
ConversionTVA = (DoubleNullable) (self.Transfer(aTransData, soTarificationBSMgr, TauxTVABS));

-- CREATION DU FICHIER DES ODS ET INITIALISATION DES SEQUENCEURS
aTransData = new();
aTransData.TransActionService = ACT_FILE_INIT;
aTransData.TransObject = NIL;
self.Transfer(aTransData, soTarificationBSMgr, OperationDiverseBS);
OD_InitialiserLesSequences();

-- LECTURE DES EVENEMENTS ET TARIFICATION/FACTURATION DE CES MOUVEMENTS
  lesEvenements : array of EvenementTarificationDesc;
begin
  lesEvenements = DoLireLesEvenements();
exception
  when e : GenericException do 
    GenererEntreeDansFichierLog('Attention, problème pendant la lecture d''un lot d''évenements de tarification'); 
end;

TraiterUnLot(lesEvenements); -- Normalement, cette méthode capte et logue toute les exceptions, 
							 -- L'exécution de la fermeture de fichier est donc garantie !

-- FERMETURE DU FICHIER DES ODS
aTransData = new();
aTransData.TransActionService = ACT_FILE_TERMINATE;
aTransData.TransObject = NIL;
self.Transfer(aTransData, soTarificationBSMgr, OperationDiverseBS);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.StartBatch : End');

end method;

------------------------------------------------------------
method BatchTarification.TarificationEnDur(input unEvt: TarificationSrv.EvenementTarificationDesc): Framework.DoubleData
begin

-- Ici, on ne se pose pas la question de savoir si l'événement est déjà
-- tarifé, car si on arrive ici, ce test est déjà effectué. L'évaluation ne
-- devrait jamais être effectué sur un événement déjà tarifé !!!

unResult : DoubleData = new();
Tarif : string;

Code : integer = unEvt.CodeService.Value;
CP   : integer = unEvt.CodeProduit.Value;

-- Remarque : Problème déjà rencontré, le fait de mettre des zéros au début d'une constante numérique
-- pose des problèmes à l'analyseur lexical

case Code is

	when 4 do Tarif = '0.0';				-- Renvoi de code confidentiel
	when 3 do Tarif = '0.0';				-- Cloture de compte
	when 7 do Tarif = '0.0';				-- Ouverture de compte
	when 116 do Tarif = '0.0';				-- Carte Aurore Banque Directe
	when 69 do Tarif = '75.0';				-- Transfert vers étranger en FRF
	when 70 do Tarif = '145.0';			-- Transfert vers étranger en devises
	when 71 do Tarif = '75.0';				-- Transfert de l'étranger en FRF
	when 72 do Tarif = '145.0';			-- Transfert de l'étranger en devises
	when 73 do Tarif = '175.0';			-- Paiement d'un chèque à l'étranger en devises
	when 74 do Tarif = '135.0';			-- Encaissement chèque étranger en FRF
	when 75 do Tarif = '175.0';			-- Encaissement chèque étranger en devises
--	when 									-- Domiciliation des revenus ???
	when 85 do Tarif = '0.0';				-- Recherche pour réclamation sur carte fondée 
	when 86 do Tarif = '200.0';			-- Recherche pour réclamation sur carte non fondée France
	when 87 do Tarif = '400.0';			-- Recherche pour réclamation sur carte non fondée Etranger
	when 21 do Tarif = '50.0';				-- Rejet de chèque pour autre motif que provision insuffisante
	when 53 do Tarif = '50.0';				-- Recherche de documents divers
	when 56 do Tarif = '50.0';				-- Duplicata de relevé de compte > 2 mois
	when 59 do Tarif = '400.0'; 			-- Saisie attribution ATD
	when 60 do Tarif = '750.0';			-- Ouverture d'un dossier de succession
	when 99 do Tarif = '144.0';			-- Assurance compte
	when 100 do Tarif = '150.0'; 			-- Assurance clefs, papiers 1er adhérent
	when 101 do Tarif = '100.0';			-- Assurance clefs, papiers 2ème adhérent
	when 145 do Tarif = '0.0';				-- Service minitel
	when 146 do Tarif = '0.0';				-- Serveur vocal
	when 147 do Tarif = '0.0'; 				-- Avertissement serveur vocal
	when 91 do Tarif = '0.0';				-- Web Banque Directe
	when 92 do Tarif = '0.0'; 				-- Abonnement mensuel (Minitel, Web, Intellibanque ?)
	when 93 do Tarif = '5.0';				-- Envoi de pages de télécopie
	else
		if 	   Code>= 103 and Code<= 115        then Tarif = '120.0';	-- Placements financiers
		elseif Code>= 117 and Code<= 121        then Tarif = '200.0';   -- Crédits
		elseif (Code=102 and CP>=17 and CP<=18)	then Tarif = '150.0';   -- Transfert PEL, CEL vers l'extérieur
		elseif (Code=140 and CP>=17 and CP<=18) then Tarif = '0.0';     -- Transfert PEL, CEL de l'extérieur
		elseif (Code>= 122 and Code<= 137)  
		    or (Code = 102 and CP=22)
		    or (Code = 140 and CP=22)			then Tarif = '140.0';	-- Titres
		elseif Code>= 145 and Code<= 147		then Tarif = '130.0';	-- Minitel, Web, Serveur vocal
		else 
			Tarif = '10000.00'; -- Tarif par défaut
		end if;		
	
				
				
end case;

unResult.SetValue(Tarif);
unEvt.EtatCre.SetValue(ERR_EVT_TARIFE);

return unResult;
end method;

------------------------------------------------------------
method BatchTarification.TraiterUnLot(input LesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc)
begin
--
--	Description : 	Traitement d'un lot d'événements de tarification (= une table evtsource)
--
--	Type :	concret
--
--	Parametres :    LesEvenements : La liste des événements du lot
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.TraiterUnLot');

TarifTTC : NumericData;

Task.Part.LogMgr.PutLine('TRT/EVALUATION DES CRE');

ChronoEval : Chronometre = new();
ChronoEval.Fire();

-- Evaluation des événements de tarification et réécriture des événements de 
-- tarification dans les tables correspondantes.

NbTarifes : integer = 0;
NbRejetes : integer = 0;
EvtVal    : integer = ERR_EVT_REJETE_RAISON_INCONNUE;

-- Tarification de tous les événements

for unEvt in lesEvenements do

  -- Le  traitement d'exception est effectué à l'intérieur de la boucle pour ne pas
  -- interrompre le traitement en cas de problème sur un événement
  
  begin
	unEvt.DateTarification.SetValue(DateReference); -- positionnement de la date exacte de l'évaluation de 
													-- l'événement de tarification avant toute possibilité
													-- de levée d'exception. L'événement sera réécrit quelque
													-- soit l'issue de son traitement.

	 -- Avant tout, on doit contrôler la validité de l'événement de tarification
	 EvtVal = ControlerEvt(unEvt); -- DoCheckValidity ???
	 if EvtVal <> EVT_VALIDE then
		unEvt.EtatCRE.SetValue(EvtVal);
		Exc : EvenementTarificationInvalideExc = new();
		Exc.SetWithParams(SP_ER_ERROR,'Evenement de tarification invalide');
		raise Exc;
	 end if;

	 -- Ensuite, on procède à son évaluation si ce n'est pas déjà fait (on peut avoir des événements déjà tarifés)
    if unEvt.EtatCre.Value = ERR_EVT_TARIFE then
    	EvtVal = ERR_EVT_TARIFE;   	-- On ne tarifie pas, c'est déjà fait !!!
	else
	    EvtVal = EvalueEvt(unEvt);
    end if;
    
	if EvtVal <> ERR_EVT_TARIFE  -- et à l'écriture
	then EcrireEvtRejete(unEvt,EvtVal); -- dans la table des evt rejetés si un problème est survenu
	else 
	--	 TroncatureSure(unEvt.TarifTTC, 2); -- pas si sûre que çà (sic)
		 EcrireEvtTarife(unEvt);		-- dans la table des evt tarifés si tout s'est bien passé
	end if;
    
  exception
    
    -- si on arrive dans ces blocs d'exceptions, cela veut dire que l'exception a été levée dans l'évaluation
    
    when e : EvenementTarificationInvalideExc do
		EcrireEvtRejete(unEvt, ERR_EVT_REJETE_INVALIDE);
    when e: GenericException do
		EcrireEvtRejete(unEvt, ERR_EVT_REJETE_RAISON_INCONNUE);
  end; 

end for;

PutMessage('Temps total d''evaluation : ',ChronoEval.AsText());
Task.Part.LogMgr.PutLine('TRT FIN');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.TraiterUnLot : End');

end method;

------------------------------------------------------------
method BatchTarification.TroncatureSure(input output unDouble: Framework.DoubleData,
	input Precision: Framework.integer): Framework.boolean
begin
--
--	Description : 	Troncature (méthode : Chaîne) d'un DoubleData
--
--	Type :	concret
--
--	Parametres :    unDouble : Le nombre à tronquer
--					Precision : Le nombre de chiffres souhaités (après le caractère décimal)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	17/06/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BatchTarification.TroncatureSure');

VChaine : TextData = unDouble.TextValue;
OK		: boolean  = TRUE;

-- trouver le point décimal, récupérer d'abord le chiffre après le
-- dernier chiffre significatif souhaité, et ensuite la partie à 
-- gauche de ce chiffre

if  VChaine.MoveToChar(DECIMAL_POINT) then

	VChaine.MoveNext(); -- on se positionne sur le point décimal
	
	PosFin  : integer = VChaine.Offset + Precision; -- calcul du chiffre à arrondir
	ChiffreApres : integer = VChaine.CutRange  (PosFin    , PosFin + 1).IntegerValue;
	
	-- Chiffre qui va porter l'unité supplémentaire en cas d'arrondi
	ChiffreArr   : integer = VChaine.CopyRange (PosFin - 1, PosFin    ).IntegerValue;
	if ChiffreApres >= 5 then 
	   ChiffreArr = ChiffreArr + 1;
	end if;
	
	VChaine.SetValue(VChaine.CutRange(0,PosFin-1)); -- -1 car on va greffer le nouveau caractère
	VChaine.Concat(TextData(IntegerValue=ChiffreArr));

	-- Faire l'arrondi de ce que l'on a obtenu
	unDouble.SetValue(VChaine);

else 
	OK = false;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BatchTarification.TroncatureSure : End');

return OK;


end method;

------------------------------------------------------------
method EvenementTarificationInvalideExc.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'batchtar';
	StartingMethod = (class = BatchTarification, method = StartBatch);


end BatchTarifValidationSrv;
begin TOOL ParserWin;

includes AddDicoBD;
includes AddFrameworkBD;
includes BatchTarifSrv;
includes BatchTarifValidationSrv;
includes CatalogueSrv;
includes CompilateurClasses;
includes ContexteClt;
includes ContexteSrv;
includes ContexteTarificat;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes DicoBD;
includes ExpressionClasses;
includes FileDataAccessSrv;
includes MoteurTarifSrv;
includes ParserClasses;
includes ParserErrors;
includes ParserExpression;
includes GenericDBMS;
includes DisplayProject;
includes Framework;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ArbreAnnuaire;
forward  ArbreClients;
forward  Export;
forward  ExRegleDesc;
forward  IntegriteCompilateurExc;
forward  ParserWindow is mapped;
forward  TestCompilateur;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant COMPILE_N_TIMES = 1;
constant EVALHIGH = 10;
constant EVALLOW = 20;
constant HPK = 1;
constant HPR = 1;
constant LOG_GRPFLAG = 24;
constant MAX_ARBRES = 100;
constant MAX_CLIENTS = 50;
constant MAX_RG_CAT = 3;
constant MAX_RG_COND = 5;
constant MAX_RG_DEV = 2;
constant MAX_RG_EVAL = 5;
constant MAX_RG_OPER = 1;
constant MAX_RG_PACK = 1;
constant MAX_RG_PROD = 1;
constant MAX_RG_PROM = 1;
constant PK1 = 1;
constant PR1 = 1;
constant TEST_NUMBER = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ArbreAnnuaire inherits from DataStructuresClasses.SearchTree

has public  method DoAcceptDuplicates: Framework.boolean;
has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;
has public  method DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DoRaiseExceptionWhenDuplicateValues: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ArbreClients inherits from DataStructuresClasses.SearchTree

has public  method DoAcceptDuplicates: Framework.boolean;
has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;
has public  method DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DoRaiseExceptionWhenDuplicateValues: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class Export inherits from FileDataAccessSrv.FileDataServiceDesc

has public  method DoStartService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=on);

end class;

class ExRegleDesc inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeCategorie: DicoBD.RefTarifDesc;
has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodePackage: AddDicoBD.RefTypePackageDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodePromotion: AddDicoBD.RefTypePromotionDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;
has public  attribute CodeStrategie: AddDicoBD.RefTypeStrategieDesc;
has public  attribute Commentaire: AddDicoBD.CommentaireDesc;
has public  attribute Condition: AddDicoBD.ConditionDesc;
has public  attribute DateDebutValidite: DicoBD.DteDesc;
has public  attribute DateFinValidite: DicoBD.DteDesc;
has public  attribute DateProduction: DicoBD.DteDesc;
has public  attribute Montant: AddDicoBD.MontantDesc;
has public  attribute NomRegle: AddDicoBD.NomRegleDesc;
has public  attribute PrixPublicBln: DicoBD.TypBooleanNullable;
has public  attribute ProductionBln: DicoBD.TypBooleanNullable;

has public  method DoCheckValidity: Framework.boolean;
has public  method DoResetAttributes;
has public  method DoResetSelfDesc;
has public  method DoResetService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class IntegriteCompilateurExc inherits from Framework.GenericException

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TestCompilateur inherits from Framework.Object

has public  attribute uneExpressionCompilee: CompilateurClasses.ExpressionCompilee;

has public  method Expand(input src: Framework.TextData,
	input str: Framework.TextData): Framework.TextData;
has public  method Init;
has public  method Test(input TypeDec: Framework.integer,
	input CompileN: Framework.integer,
	input EvalNHigh: Framework.integer,
	input EvalNLow: Framework.integer,
	input uneExpression: Framework.string,
	input output TempsCompilation: Framework.IntervalData,
	input output TempsEvaluation: Framework.IntervalData): Framework.DataValue;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ParserWindow is mapped inherits from DisplayProject.UserWindow

has public  constant A1 = 9;
has public  constant A2 = 9;
has public  constant A3 = 8;
has public  constant CAT_COL = 3;
has public  constant CAT_STD = 1;
has public  constant CAT_VIP = 2;
has public  constant NB_CLI = 100;
has public  constant TI_ARBRE = 2;
has public  constant TI_ASSOC = 1;
has public  constant TI_HASH = 3;

has public  attribute ArbreClientsPartiel: ParserWin.ArbreClients;
has public  attribute ExpressionTestee: Framework.string;
has public  attribute laPile: DataStructuresClasses.Stack;
has public  attribute NombreRegles: Framework.integer;
has public  attribute StructureClients: Framework.Object;
has public  attribute unGenerateur: Framework.RandomNumber;
has public  attribute unIotaGen: DataStructuresClasses.IotaGen;
has private attribute unRandom: Framework.RandomNumber;
has public  attribute unTest: ParserWin.TestCompilateur;

has public  method CleCompteBD(input Value: Framework.TextData): Framework.IntegerData;
has public  method Compilation(copy input sourceCode: Framework.TextData,
	input montrerErreurs: Framework.boolean): Framework.boolean;
has public  method ControlerCompilateur;
has public  method CreerContexte(input NombreClients: Framework.integer);
has public  method CreerEvenementsValidation;
has public  method CreerLesEvenements(input GenererErreurs: Framework.boolean = FALSE);
has public  method CreerLesRegles;
has public  method CreerRegle(input Cat: Framework.integer,
	input Promo: Framework.integer,
	input Pack: Framework.integer,
	input Eval: Framework.string,
	input EvalAlt: Framework.string,
	input PP: Framework.boolean = TRUE): TarificationSrv.RegleDesc;
has public  method Display;
has public  method DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc;
has public  method DoTrapErrors;
has public  method DoTrapTokens;
has public  method ErreurControle(input e: Framework.GenericException,
	copy input Message: Framework.TextData);
has public  method GenererLesEvenements(input GenererErreurs: Framework.boolean = FALSE): Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method GenererLesEvenementsValidation(input GenererErreurs: Framework.boolean): Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable;
has public  method GenererNumeroClient: Framework.TextData;
has public  method Init;
has public  method InsererLesClients;
has public  method LancerLeBatchTarif;
has public  method LancerLeBatchTarif2;
has public  method LancerMoteurTarif;
has public  method TestCollectionNil;
has public  method TesterCast;
has public  method TesterCompilation;
has public  method TesterExpansion;
has public  method TesterExpression(input anExpr: Framework.string,
	input aValue: Framework.TextData);
has public  method TesterHashTableFillArray;
has public  method TesterIotaGen;
has public  method TestFD;
has public  method TestPile;
has public  method UpdateExpressionList;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+5151463100002ebb000026b29fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100006a00000100030001000000000003000021010200000000050400001c
+026b6b44e96d6f6e7374726174696f6e206574207465737420646573206d6f64
+756c6573206465206c6120746172696669636174696f6e2028436f6d70696c61
+7465757220642765787072657373696f6e732c20636f6e74657874652c206d6f
+74657572206574206261746368299cd80506007a08004d009fff010101010f10
+11120101011700009fff010000000d00005dc05dbf0000000003030303000204
+04a0a00000000000000000009d5dc09d5dbf0000000000000108066801000000
+5dc05dbf00000002010000000009000006000021010200000000070706013d08
+004d0204045465737401010a010f1011120101011700019fff230000000d879d
+01df130b249e000000000303030300050202a0a00000220000000000009d130b
+9d249e000000000000010808e301ff8100000000000000000201000000000300
+020902080000210502000000000a0b0c0d0e0a06007a08004d009fff01010401
+0f1011120101011700009fff240000000d159cdb121b24750000000003030303
+0007040460600000000000000000009d121b9d247500000000000001080f6301
+000000121b2475001e1e54657374206465732073747275637475726573206465
+20646f6e6ee965730201000000000900000f0000210b02000000001011121314
+15161718191a10060092082081029fff21210401212121212121212100009fff
+410000000d9d01f49d03d3009c03d30000000003030303000a0101a0a0000000
+0000000000009c9c9d03d30000000000000103010b1b020100009e0044209400
+000000001b00001c021515447572e965206427696e73657274696f6e203a200a
+18110600f6082089020e0e4475726565496e73657274696f6e01020b21212121
+2101010117000208085465787444617461420000000d9d06639d03d300c609ce
+0000000003030303000a010280a00000000000000000009cc69d09ce00000000
+000001030201070026000009ff8100009e004000140301001206009208208102
+9fff21210401212121212121212100009fff430000000d9d01fe9d052b009c04
+7a0000000003030303000a0101a0a00000000000000000009c9c9d047a000000
+0000000103010b1c020100009e0044201400000000001c00001c021616447572
+e96520646520726563686572636865203a200a18130600f6082089020e0e4475
+72656552656368657263686501020b2121212121010101170003080854657874
+44617461440000000d9d066e9d052b00c609ce0000000003030303000a010280
+a00000000000000000009cc69d09ce00000000000001030201070026000009ff
+8100009e00400014030100140600f6082089020f0f4e6f6d6272654465436c69
+656e747301020b21212121210101011700040808546578744461746147000000
+0d9d198d9d03e800c602d90000000003030303000a010280a000000000000000
+00009cc69d02d90000000000000103020107000a000009ff8100009e00400014
+03010015060092082081029fff21210401212121212121212100009fff480000
+000d9d11219d03de009c06250000000003030303000a0101a0a0000000000000
+0000009c9c9d06250000000000000103010b1d020100009e0044201400000000
+001d00001c022020202020204e6f6d62726520646520636c69656e747320e020
+67e96ee97265720a28160600b2080009020d0d54797065496e73657274696f6e
+01020421212121210101011700050707496e7465676572450000000d9d01df9d
+0177016d0e720000000003030303000a010180800000220000000000009d016d
+9d0e7200000000000001030201041e0700000004010217175b204de974686f64
+65206427696e73657274696f6e205d000000001e00002103020001a6011f2021
+1f0001a6030122000000002200001c0214145461626c652064276173736f6369
+6174696f6e732a200001a6030223000000002300001c02121241726272652064
+652072656368657263686526210001a6030324000000002400001c0212124164
+726573736167652064697370657273e92617060078080201020f0f4372656174
+696f6e436c69656e747301020421212121212121211700069fff460000000d9d
+119e9d01d500e506d60000000003030303000a0101a0a0000000000000000000
+9ce59d06d6000000000000010b22224372e96174696f6e2064657320636c6965
+6e747320284a6575206427657373616929000201000000001806007808020102
+111152656368657263686572436c69656e747301020421212121212121211700
+079fff490000000d9d19989d01d500e502e40000000003030303000a0101a0a0
+0000000000000000009ce59d02e4000000000000010b0a0a5265636865726368
+6572000201000000001906007808020102080854657374486173680102042121
+2121212121211700089fff4b0000000d9d02f89d07ef00e5054a000000000303
+0303000a0101a0a00000000000000000009ce59d054a000000000000010b1818
+5465737420486173685461626c652e46696c6c4172726179000201000000001a
+060078080201020c0c5465737465724c6150696c650102042121212121212121
+1700099fff4e0000000d9d0ab39d07bb00e5030d0000000003030303000a0101
+a0a00000000000000000009ce59d030d000000000000010b0e0e546573746572
+206c612070696c65000201000000000b06007a08004d009fff010104010f1011
+120101011700009fff260000000d159cdb121b24750000000003030303000704
+0460600000000000000000009d121b9d24750000000000000108256301000000
+121b247500171745787072657373696f6e202f204576616c756174696f6e0201
+00000000090000250000210302000000002627282606007a08004d009fff0101
+0a010f1011120101011700009fff3a0000000d9cbb9d01190b5a228100000000
+03030303000b0202a0a00000000000000000009d0b5a9d228100000000000001
+08296301ff81000b312257000000020100000000090000290000210d02000000
+002a2b2c2d2e2f303132333435362a060092082081020b0b5469747265436861
+696e65212104012121212121212121000a9fff0c0000000d739c9c009c041c00
+0000000303030300260101a0a00000000000000000009c9c9d041c0000000000
+000103010b37020100009e0044201400000000003700001c021515436861ee6e
+6520e020616e616c79736572203a200a182b0600f6082089020c0c54656d7073
+436f6d70696c6501020b212121212101010117000b0808546578744461746131
+0000000d9d03619d071f00c608ca00000000030303030026010280a000000000
+00000000009cc69d08ca00000000000001030201070022000009ff8100009e00
+4000140301002c0600f6082089020808526573756c74617401020b2121212121
+01010117000c08085465787444617461300000000d9d03379d059300c6198300
+000000030303030026010280a00000000000000000009cc69d19830000000000
+0001030201070066000009ff8100009e004000140301002d060092082081029f
+ff21210401212121212121212100009fff3b0000000d9c9c9d05a8009c02a500
+0000000303030300260101a0a00000000000000000009c9c9d02a50000000000
+000103010b38020100009e0044209400000000003800001c020e0e4576616c75
+6174696f6e203a200a102e0600f6082089020b0b54656d70734576616c756501
+020b212121212101010117000d08085465787444617461320000000d9d13209d
+072900c609af00000000030303030026010280a00000000000000000009cc69d
+09af00000000000001030201070026000009ff8100009e004000140301002f06
+00b40800090207074c73744578707201020b212121212101010117000e070749
+6e74656765722e0000000d9d05358700db178f00000000030303030026010280
+a00000220000000000009cdb9d178f0000000000000103020104390700000003
+203900002120020001a6013a3b3c3d3e3f404142434445464748494a4b4c4d4e
+4f505152535455565758593a0001a603005a000000005a00001c020404507269
+78103b0001a603005b000000005b00001c020606446576697365103c0001a603
+005c000000005c00001c02090943617465676f726965103d0001a603005d0000
+00005d00001c020303416765103e0001a603005e000000005e00001c020d0d32
+2b28332a34292b28352a3629103f0001a603005f000000005f00001c02060641
+67653c323510400001a6030060000000006000001c0207074167653c3d323510
+410001a6030061000000006100001c020909284167653c3d32352910420001a6
+030062000000006200001c0209092828312b32292a332910430001a603006300
+0000006300001c020d0d28284167652b32292a332b322910440001a603006400
+0000006400001c021616284167653d3138292065742028507269783d32303029
+18450001a6030065000000006500001c021616284167653d3138292065742028
+507269783d3430302918460001a6030066000000006600001c0204042d416765
+10470001a6030067000000006700001c0214142d416765202a202b2041676520
+2f202d2041676518480001a6030068000000006800001c020f0f43617465676f
+7269653d275649502710490001a6030069000000006900001c02101043617465
+676f7269653c3e2756495027224a0001a603006a000000006a00001c020b0b2d
+322e32202a202d322e32104b0001a603006b000000006b00001c020909507269
+782a312e3035104c0001a603006c000000006c00001c02121254617269665f4e
+6f726d616c202f20342e30184d0001a603006d000000006d00001c0210105461
+7269665f4e6f726d616c202f2034184e0001a603006e000000006e00001c0214
+142854617269665f4e6f726d616c202f2041676529324f0001a603006f000000
+006f00001c021a1a2854617269665f4e6f726d616c202f20284167652a312e30
+292938500001a6030070000000007000001c02414128283730302a5461726966
+5f4e6f726d616c292b28322a54617269665f4e6f726d616c29292d2854617269
+665f4e6f726d616c2a54617269665f4e6f726d616c2984510001a60300710000
+00007100001c022424284461746543617274652d446174654a4a293c28273120
+616e272b2736206d6f697327294a520001a6030072000000007200001c024e4e
+28283730302a54617269665f4e6f726d616c292b284d756c7469706c69636174
+6575722a54617269665f4e6f726d616c29292d2854617269665f4e6f726d616c
+2a54617269665f4e6f726d616c2950530001a6030073000000007300001c0222
+22282730312f30312f3031272d2732206d6f697327293c2730312f31312f3230
+30302746540001a6030074000000007400001c021b1b50726978202a20302e33
+37383420696e662031206d696e2032303020550001a603007500000000750000
+1c021b1b50726978202a20302e3337383420696e662031206d696e2031303020
+560001a6030076000000007600001c021b1b50726978202a20302e3337383420
+7375702031206d696e2032303020570001a6030077000000007700001c021b1b
+50726978202a20302e33373834207375702031206d696e2031303020580001a6
+030078000000007800001c021c1c282730332f30322f3939272d2731206d6f69
+7327292b273120616e2720590001a6030079000000007900001c021414323020
+2f20332e3020696e6620302e303030303218300600840820090208086c65536f
+7572636501020a212121212101010117000f0808546578744461746116000000
+0d9c9c9d021e02c4194f000000000303030300260202a0a00000000000000000
+009d02c49d194f00000000000001030107500007005500000500040000ff8101
+31060078080201020b0b416e616c7973657242746e01020a2121212121212121
+1700109fff0e0000000d9cfa9d095c00f0043b000000000303030300260202a0
+a00000220000000000009cf09d043b000000000000010b090926416e616c7973
+6572000201000000003206007808020102111143616c63756c446563696d616c
+4461746101020a21212121212121211700119fff4c0000000d9d1ab19d093d00
+f00714000000000303030300260202a0a00000220000000000009cf09d071400
+0000000000010b121243616c63756c20446563696d616c446174610002010000
+0000330600b20800090207075479706544656301020421212121210101011700
+120707496e7465676572500000000d9d1ab19d0252021305a800000000030303
+030026010180800000000000000000009d02139d05a800000000000001030201
+047a070000000401011b1b4174747269627574696f6e20647520747970652064
+e963696d616c000000007a00002102020001a6017b7c7b0001a603017d000000
+007d00001c02070744e963696d616c107c0001a603027e000000007e00001c02
+0606446f75626c651034060078080201020b0b54657374436f6c6c42746e0102
+0a21212121212121211700139fff510000000d9d1d759d059e00f0043b000000
+000303030300260202a0a00000220000000000009cf09d043b00000000000001
+0b111126436f6c6c656374696f6e20e0204e494c000201000000003506007808
+0201020707496f746147656e01020421212121212121211700149fff52000000
+0d9d1d949d071500e50228000000000303030300260101a0a000000000000000
+00009ce59d0228000000000000010b0707496f746147656e0002010000000036
+060078080201021313436f6e74726f6c65436f6d70696c617465757201020a21
+212121212121211700159fff670000000d9d062f9d097100f008620000000003
+03030300260202a0a00000220000000000009cf09d0862000000000000010b24
+2426436f6e7472f46c65206427696e74e967726974e920647520636f6d70696c
+6174657572000201000000002706007a08004d009fff01010a010f1011120101
+011700009fff3c0000000d9cb19d0d1004a408380000000003030303000b0202
+a0a00000000000000000009d04a49d083800000000000001087f6301ff810004
+07080e0012125b205465737420646573206361737473205d0201000000000900
+007f000021030200000000808182800600f60820890207074361737452657301
+020b212121212101010117001608085465787444617461390000000d499d01a1
+00c606a200000000030303030027010280a00000000000000000009cc69d06a2
+00000000000001030201070019000009ff8100009e0040001403010081060078
+080201020808546573744361737401020421212121212121211700179fff3800
+00000d536800e501d5000000000303030300270101a0a0000000000000000000
+9ce59d01d5000000000000010b06065465737465720002010000000082060078
+080201020a0a5465737449734e756c6c01020421212121212121211700189fff
+4d0000000d739d02d900e506cb000000000303030300270101a0a00000000000
+000000009ce59d06cb000000000000010b212154657374206427756e20636173
+742073757220756e2049734e756c6c3d74727565000201000000002806007a08
+004d009fff01010a010f1011120101011700009fff3d0000000d9d09479d0d05
+03fd1a150000000003030303000b0202a0a00000000000000000009d03fd9d1a
+150000000000000108836301ff8100036119eb0025255b205465737420646520
+6c27657870616e73696f6e20642765787072657373696f6e73205d0201000000
+0009000083000021030200000000848586840600f6082089020c0c457870616e
+73696f6e53726301020b21212121210101011700190808546578744461746136
+0000000d9d03e87d00c60d1a00000000030303030028010280a0000000000000
+0000009cc69d0d1a00000000000001030201070034000009ff8100009e004000
+14030100850600f6082089020c0c457870616e73696f6e52657301020b212121
+212101010117001a08085465787444617461370000000d9d03de9d01d500c615
+7100000000030303030028010280a00000000000000000009cc69d1571000000
+00000001030201070056000009ff8100009e0040001403010086060078080201
+020c0c457870616e73696f6e42746e010204212121212121212117001b9fff35
+0000000d7d9200e5029b000000000303030300280101a0a00000000000000000
+009ce59d029b000000000000010b0909457870616e73696f6e00020100000000
+0c06007a08004d00070754616246696c65010104010f10111201010117001c9f
+ff5c0000000d159cdb121b247500000000030303030007040460600000000000
+000000009d121b9d24750000000000000108876301000000121b247500292954
+6573742046696c65537472756374757265446573632065742046696c65446174
+6153657276696365020100000000090000870000210b020000000088898a8b8c
+8d8e8f90919288060092082081029fff21210401212121212121212100009fff
+5d0000000d879d014d009c048f0000000003030303000c0101a0a00000000000
+000000009c9c9d048f0000000000000103010b93020100009e00442014000000
+00009300001c021616436861ee6e65206e6f6e20666f726d6174e965203a0a18
+890600f6082089020a0a434e466f726d6174656501020b212121212101010117
+001d080854657874446174615e0000000d9d05749d015800c612cc0000000003
+030303000c010280a00000000000000000009cc69d12cc000000000000010302
+0107004b000009ff8100009e004000140301008a060092082081029fff212104
+01212121212121212100009fff5f0000000d9cbb9d02d9009c045b0000000003
+030303000c0101a0a00000000000000000009c9c9d045b000000000000010301
+0b94020100009e0044201400000000009400001c021616466f726d6174206465
+206c6120636861ee6e65203a0a188b0600f608208902070743466f726d617401
+020b212121212101010117001e08085465787444617461600000000d9d057e9d
+02ee00c612cc0000000003030303000c010280a00000000000000000009cc69d
+12cc0000000000000103020107004b000009ff8100009e004000140301008c06
+0092082081029fff21210401212121212121212100009fff610000000d9d0124
+9d0484009c03b40000000003030303000c0101a0a00000000000000000009c9c
+9d03b40000000000000103010b95020100009e0044201400000000009500001c
+021212436861ee6e6520666f726d6174e965203a0a188d0600f6082089020909
+43466f726d6174656501020b212121212101010117001f080854657874446174
+61620000000d9d05939d045b00c612cc0000000003030303000c010280a00000
+000000000000009cc69d12cc0000000000000103020107004b000009ff810000
+9e004000140301008e0600b2080009020a0a74797065466f726d617401020421
+212121210101011700200707496e7465676572630000000d9d19259d02670361
+03410000000003030303000c010180800000000000000000009d03619d034100
+0000000000010302010496070000000401010000000000009600002104020001
+a6019798999a970001a603019b000000009b00001c020707426f6f6ce9656e10
+980001a603029c9c000000009c9c00001c020606456e7469657210990001a603
+039c9d000000009c9d00001c0209094e756de97269717565109a0001a603049c
+9e000000009c9e00001c02040444617465108f0600b4080009020d0d4c737443
+4e466f726d6174656501020b21212121210101011700210707496e7465676572
+640000000d9d19259d015800db09c40000000003030303000c010280a0000022
+0000000000009cdb9d09c400000000000001030201049c9f0700000003049c9f
+00002100020001a601900600780802010215155465737446696c655374727563
+747572654465736301020b21212121212121211700229fff650000000d9d1ce3
+9d043100e5059d0000000003030303000c0102a0a00000220000000000009ce5
+9d059d000000000000010b15155465737446696c655374727563747572654465
+7363000201000000009106008408200902090946656e4578706f727401020a21
+2121212101010117002308085465787444617461660000000d9d01049d06590a
+dd22960000000003030303000c0202a0a00000000000000000009d0add9d2296
+0000000000000103020107008a00000500130000ff810192060078080201020e
+0e54657374466f726d61745465787401020421212121212121211700249fff68
+0000000d9d059d9d055500e501d50000000003030303000c0101a0a000002200
+00000000009ce59d01d5000000000000010b0606546573746572000201000000
+000d06007a08004d009fff010104010f1011120101011700009fff250000000d
+159cdb121b247500000000030303030007040460600000000000000000009d12
+1b9d247500000000000001089ca06301000000121b2475000d0d436f6d6d616e
+6465732053514c0201000000000900009ca00000210502000000009ca19ca29c
+a39ca49ca59ca1060078080201020d0d4372656572436f6e746578746501020a
+21212121212121211700259fff3e0000000d9d01439d013900e5079100000000
+03030303000d0202a0a00000220000000000009ce59d0791000000000000010b
+1d1d4372e96174696f6e206427756e65207461626c6520636f6e746578746500
+0201000000009ca2060078080201020b0b43726565725265676c657301020a21
+212121212121211700269fff3f0000000d9d01439d046f00e5079c0000000003
+030303000d0202a0a00000220000000000009ce59d079c000000000000010b1b
+1b4372e96572206c65732072e8676c657320616ce961746f6972657300020100
+0000009ca3060078080201020f0f43726565724576656e656d656e747301020a
+21212121212121211700279fff400000000d9d01439d02ee00e5079c00000000
+03030303000d0202a0a00000220000000000009ce59d079c000000000000010b
+24244372e96572206c657320e976e96e656d656e747320646520746172696669
+636174696f6e000201000000009ca4060078080201020d0d4372656572526567
+6c6573544e01020a21212121212121211700289fff4f0000000d9d01389d05fb
+00e5079c0000000003030303000d0202a0a00000220000000000009ce59d079c
+000000000000010b13134372e96572206c65732072e8676c657320544e000201
+000000009ca506007808020102191943726565724576656e656d656e74735661
+6c69646174696f6e01020a21212121212121211700299fff690000000d9d016d
+9d07c600e50b500000000003030303000d0202a0a00000220000000000009ce5
+9d0b50000000000000010b37374372e96572206c657320e976e96e656d656e74
+7320646520746172696669636174696f6e20706f7572206c612076616c696461
+74696f6e000201000000000e06007a08004d000000010104010f101112010101
+1700009fff530000000d159cdb121b2475000000000303030300070404606000
+00000000000000009d121b9d247500000000000001089ca66301000000121b24
+750022224c616e63656d656e7420647520626174636820646520746172696669
+636174696f6e0201000000000900009ca60000210202000000009ca79ca89ca7
+06007a08004d00000001010a010f1011120101011700009fff550000000d9d01
+049d012e02ee0f810000000003030303000e0202a0a00000000000000000009d
+02ee9d0f8100000000000001089ca96301ff810002c40f570000000201000000
+000900009ca90000210302000000009caa9cab9cac9caa060092082081020000
+21210401212121212121212100009fff560000000d9cbb53009c041200000000
+03030303009ca70101a0a00000000000000000009c9c9d041200000000000001
+03010b9cad020100009e0044209400000000009cad00001c0216164261746368
+20646520746172696669636174696f6e0a189cab0600780802010210104c616e
+63657242617463685461726966010204212121212121212117002a9fff540000
+000d739d018100e505dc0000000003030303009ca70101a0a000000000000000
+00009ce59d05dc000000000000010b1a1a4c616e636572206c65206261746368
+206d61696e74656e616e74000201000000009cac0600780802010211114c616e
+6365724261746368546172696632010204212121212121212117002b9fff6a00
+00000d9d06c19d018100e508190000000003030303009ca70101a0a000000000
+00000000009ce59d0819000000000000010b27274c616e636572206c65206261
+746368206d61696e74656e616e74202856616c69646174696f6e290002010000
+00009ca806007a08004d00000001010a010f1011120101011700009fff570000
+000d9d01049d0501048f0f810000000003030303000e0202a0a0000000000000
+0000009d048f9d0f8100000000000001089cae6301ff810004650f5700000002
+01000000000900009cae0000210402000000009caf9cb09cb19cb29caf060092
+08208102000021210401212121212121212100009fff580000000d9cbb53009c
+04460000000003030303009ca80101a0a00000000000000000009c9c9d044600
+00000000000103010b9cb3020100009e0044201400000000009cb300001c0217
+174d6f7465757220646520746172696669636174696f6e0a209cb00600780802
+010211114c616e6365724d6f7465757254617269660102042121212121212121
+17002c9fff590000000d739d018100e506100000000003030303009ca80101a0
+a00000000000000000009ce59d0610000000000000010b1b1b4c616e63657220
+6c65206d6f74657572206d61696e74656e616e74000201000000009cb10600a0
+080009020808436f6d70696c6572010204212121212101010117002d0707426f
+6f6c65616e5a0000000d9d09669d02ee00c604500000000003030303009ca801
+0180800000000000000000009cc69d045000000000000001030201041313436f
+6d70696c6572206c65732072e8676c6573000000009cb20600a0080009020b0b
+496e7365726572496e666f010204212121212101010117002e0707426f6f6c65
+616e5b0000000d9cc69d030300c6079c0000000003030303009ca80101808000
+00000000000000009cc69d079c00000000000001030201042525496e73e97265
+72206c657320696e666f726d6174696f6e7320646520636f6e7472f46c657300
+000000090000210502000000000c0e0b0d0a9cb31a919c9c9d01109d01709d01
+7b9d01e39d01f29d02719d02869d02e49d03019d03789d03d69d03f49d046b9d
+04e39d05419d05699d05f39d06009d060b9d06279d06329d064c9d06579d0671
+9d06f89d07699d07df9d084f9d08c79d08d49d09379d094e9d09b49d09d19d0a
+469d0ab79d0b149d0b2a9d0b9e9d0c019d0c2b9d0c369d0c429d0c4d9d0c5b9d
+0c669d0c779d0c829d0c8d9d0c989d0cad9d0cb89d0cc69d0cd19d0ce09d0ceb
+9d0cfc9d0d079d0d189d0d239d0d389d0d439d0d619d0d6c9d0d8a9d0d959d0d
+a19d0dac9d0dc89d0dd39d0dea9d0df59d0e0d9d0e189d0e2b9d0e369d0e479d
+0e529d0e6c9d0e779d0e8f9d0e9a9d0eb69d0ec19d0ee39d0eee9d0f379d0f42
+9d0f6e9d0f799d0fcf9d0fda9d10049d100f9d10329d103d9d10609d106b9d10
+8e9d10999d10bc9d10c79d10eb9d10f69d11129d11809d11e99d12629d12ea9d
+12f69d13019d13109d131b9d13299d139b9d13ff9d148c9d15019d150e9d157c
+9d15dc9d165b9d16e49d16f19d17649d17d99d18409d18d19d18e69d19429d19
+609d19d39d1a309d1a4e9d1abe9d1b1c9d1b369d1ba89d1c189d1c269d1c319d
+1c409d1c4c9d1c5b9d1c679d1c799d1c859d1c929d1cfe9d1d099d1d899d1df7
+9d1e619d1ed09d1ee59d1f669d1fe39d206d9d20e49d218b9d220f9d221e9d22
+849d22959d22f39d23129d23929d24229d24889d249b9d24f99d25199d259b9d
+26159d26a39d26b29d0200191a38626377919b9c9c9ca09d01109d012e9d0158
+9d01599d016d9d01709d017a9d017b9d019d9d01c99d01ca9d01de9d01e39d01
+ed9d01f29d02109d023b9d023c9d026e9d02719d027b9d02869d02a49d02d19d
+02d29d02d49d02e49d02e89d03019d03359d03629d03639d03669d036b9d0378
+9d03969d03c39d03c49d03c69d03d69d03da9d03f49d04289d04559d04569d04
+599d045e9d046b9d04a09d04cd9d04ce9d04d19d04d69d04e39d05019d052e9d
+052f9d05319d05419d05459d05699d059b9d05c99d05ca9d05cd9d05d39d05f3
+9d05fd9d06009d060b9d060f9d06279d06329d06369d064c9d06579d065b9d06
+719d069e9d06cb9d06cc9d06f89d07279d07549d07559d07699d078f9d07bc9d
+07bd9d07df9d08099d08369d08379d084f9d086d9d08989d08999d08c49d08c7
+9d08d19d08d49d08f29d091f9d09209d09349d09379d09419d094e9d09779d09
+a19d09a29d09a49d09b49d09b89d09d19d0a039d0a309d0a319d0a349d0a399d
+0a469d0a749d0aa19d0aa29d0aa59d0aaa9d0ab79d0ad59d0b019d0b029d0b04
+9d0b149d0b189d0b2a9d0b5b9d0b889d0b899d0b8c9d0b919d0b9e9d0bca9d0b
+f59d0bf69d0bf99d0bff9d0c019d0c0b9d0c2b9d0c369d0c3a9d0c429d0c4d9d
+0c519d0c5b9d0c669d0c6a9d0c779d0c829d0c869d0c8d9d0c989d0c9c9d0cad
+9d0cb89d0cbc9d0cc69d0cd19d0cd59d0ce09d0ceb9d0cef9d0cfc9d0d079d0d
+0b9d0d189d0d239d0d279d0d389d0d439d0d479d0d619d0d6c9d0d709d0d8a9d
+0d959d0d999d0da19d0dac9d0db09d0dc89d0dd39d0dd79d0dea9d0df59d0df9
+9d0e0d9d0e189d0e1c9d0e2b9d0e369d0e3a9d0e479d0e529d0e569d0e6c9d0e
+779d0e7b9d0e8f9d0e9a9d0e9e9d0eb69d0ec19d0ec59d0ee39d0eee9d0ef29d
+0f379d0f429d0f469d0f6e9d0f799d0f7d9d0fcf9d0fda9d0fde9d10049d100f
+9d10139d10329d103d9d10419d10609d106b9d106f9d108e9d10999d109d9d10
+bc9d10c79d10cb9d10eb9d10f69d10fa9d11129d11409d116d9d116e9d11739d
+11789d11809d11a99d11d59d11d69d11e99d12189d12459d12469d12629d128e
+9d12bc9d12bd9d12c09d12c69d12ea9d12f49d12f69d13019d13059d13109d13
+1b9d131f9d13299d13529d137f9d13809d139b9d13c09d13ed9d13ee9d13ff9d
+14309d145d9d145e9d148c9d14aa9d14d79d14d89d14fe9d15019d150b9d150e
+9d153b9d15669d15679d156a9d156f9d157c9d15a29d15cb9d15cc9d15dc9d16
+049d162f9d16309d165b9d16799d16a79d16a89d16e19d16e49d16ee9d16f19d
+17239d174e9d174f9d17529d17579d17649d17969d17c39d17c49d17c79d17cc
+9d17d99d18039d182c9d182d9d18409d18659d18909d18919d18ce9d18d19d18
+db9d18e69d19049d192f9d19309d19329d19429d19469d19609d19909d19bd9d
+19be9d19c19d19c69d19d39d19f19d1a1d9d1a1e9d1a209d1a309d1a349d1a4e
+9d1a7b9d1aa89d1aa99d1aac9d1ab19d1abe9d1adc9d1b099d1b0a9d1b0c9d1b
+1c9d1b209d1b369d1b659d1b929d1b939d1b969d1b9b9d1ba89d1bd79d1c059d
+1c069d1c099d1c0f9d1c189d1c229d1c269d1c319d1c359d1c409d1c4c9d1c51
+9d1c5b9d1c679d1c6c9d1c799d1c859d1c8a9d1c929d1cc49d1cf19d1cf29d1c
+f59d1cfc9d1cfe9d1d099d1d099d1d3c9d1d699d1d6a9d1d899d1db89d1de69d
+1de79d1dea9d1def9d1df79d1e239d1e509d1e519d1e619d1e7f9d1eaa9d1eab
+9d1ecd9d1ed09d1edb9d1ee59d1f119d1f3e9d1f3f9d1f669d1f909d1fbd9d1f
+be9d1fe39d20119d203e9d203f9d206d9d20999d20c69d20c79d20e49d211c9d
+21499d214a9d218b9d21a99d21d49d21d59d220c9d220f9d221a9d221e9d223d
+9d226b9d226c9d22819d22849d228f9d22959d22b49d22df9d22e09d22e29d22
+f39d22f89d23129d23419d236d9d236e9d23929d23c29d23f09d23f19d24229d
+24419d246f9d24709d24859d24889d24939d249b9d24ba9d24e59d24e69d24e8
+9d24f99d24fe9d25199d25499d25759d25769d259b9d25c99d25f79d25f89d25
+fb9d26159d26469d26739d26749d26779d26a39d26ad9d26b20301
-212f34c7


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service DefaultDbSession : GenericDBMS.DBSession = (DialogDuration = SESSION,
	Visibility = environment,
	ExternalManager = 'DBRelationClientele',
	ResourceName = '@rcbd',
	UserName = 'ops$munerot',
	UserPassword = 'munerot',
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '5C4E6610-D47D-11D1-8F0B-15A8FB10AA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ArbreAnnuaire.DoAcceptDuplicates: Framework.boolean
begin
-- Doit t'on accepter les valeurs (sémantiquement) en double
-- False par défaut

return false;
end method;

------------------------------------------------------------
method ArbreAnnuaire.DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer
begin
E1 : integer = (IntegerData) (Key1).Value;
E2 : integer = (IntegerData) (Key2).Value;
EO : integer;

if E1<E2 then EO = -1;
elseif E1>E2 then EO = 1;
else EO = 0;
end if;

return EO;
end method;

------------------------------------------------------------
method ArbreAnnuaire.DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
-- A définir par l'utilisateur de la classe

if CaseBranch = 1 then
   (Stack) (Param).Push(aNode);	
else
   Task.Part.LogMgr.Put((IntegerData) (aNode.Key));
   Task.Part.LogMgr.Put(' ');
   Task.Part.LogMgr.PutLine((TextData) (aNode.Value));
end if;

end method;

------------------------------------------------------------
method ArbreAnnuaire.DoRaiseExceptionWhenDuplicateValues: Framework.boolean
begin
return false;
end method;

------------------------------------------------------------
method ArbreAnnuaire.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ArbreClients.DoAcceptDuplicates: Framework.boolean
begin
-- Doit t'on accepter les valeurs (sémantiquement) en double
-- False par défaut

return false;
end method;

------------------------------------------------------------
method ArbreClients.DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer
begin
E1 : integer = (IntegerData) (Key1).Value;
E2 : integer = (IntegerData) (Key2).Value;
EO : integer;

if E1<E2 then EO = -1;
elseif E1>E2 then EO = 1;
else EO = 0;
end if;

return EO;
end method;

------------------------------------------------------------
method ArbreClients.DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
-- A définir par l'utilisateur de la classe

if CaseBranch = 1 then
   (Stack) (Param).Push(aNode);	
else
   Task.Part.LogMgr.Put((IntegerData) (aNode.Key));
   Task.Part.LogMgr.Put(' ');
   Task.Part.LogMgr.PutLine((TextData) (aNode.Value));
end if;

end method;

------------------------------------------------------------
method ArbreClients.DoRaiseExceptionWhenDuplicateValues: Framework.boolean
begin
return false;
end method;

------------------------------------------------------------
method ArbreClients.Init
begin
super.Init();
end method;

------------------------------------------------------------
method Export.DoStartService
begin
-- faut t'il passer en paramètre la liste des FileStructureDesc pour laisser l'utilisateur de la 
-- classe les modifier selon ses besoins ?

end method;

------------------------------------------------------------
method Export.Init
begin
super.Init();

unExRegleDesc : ExRegleDesc = new();
unExRegleDesc.DoResetAttributes();
unExRegleDesc.SelfDesc = new();
unExRegleDesc.DoResetSelfDesc();
self.FileMap = unExRegleDesc;

Filename.SetValue('c:\\tests\\test.txt');
DefaultFillerCharacter = '.';

-- Mise à jour des flags
self.FlagRead = TRUE;
self.FlagAppend = TRUE;
self.FlagRewrite = FALSE;

self.RecordLength = 400;

end method;

------------------------------------------------------------
method ExRegleDesc.DoCheckValidity: Framework.boolean
begin
--
--	Description : 	contrôle l'ensemble des attributs de self.UneRegle : RegleDesc
--
--	Type :	Concret
--
--	Parameters :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	History :
--

--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity ');

aResult : boolean = TRUE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleDesc.DoCheckValidity : End');

return aResult;




		
end method;

------------------------------------------------------------
method ExRegleDesc.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+

Self.CodeCategorie = New();
Self.CodeDevise = New();
Self.CodeService = New();
Self.CodePackage = New();
Self.CodeProduit = New();
Self.CodeStrategie= New();
Self.CodePromotion = New();
Self.Commentaire = New();
Self.Condition = New();
Self.Montant = New();
Self.NomRegle = New();
Self.PrixPublicBln = New(value = FALSE);
Self.ProductionBln = New(value = FALSE);
self.DateProduction = New();
Self.DateDebutValidite = New();
Self.DateFinValidite = New();




end method;

------------------------------------------------------------
method ExRegleDesc.DoResetSelfDesc
begin
--
--	Description : 	Instanciation de la structure de description des données du record.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Création.
--+

SelfDesc.clear();

-- Length=1 pour tester le lancement d'une exception si chaîne trop longue sur un numérique
SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex = 1, Length=6, Sign=SIGN_DISABLE, CompletionCharacter='*'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeService';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeService;
SelfDesc[SelfDesc.Items].ItemUserName = 'Id Service';
--SelfDesc[SelfDesc.Items].ParentItemName='CodeService';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex = 7, Length=4, Sign=SIGN_DISABLE, CompletionCharacter='~'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeCategorie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeCategorie;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeCategorie';

SelfDesc.AppendRow(BooleanFileStructureDesc(StartIndex = 11, Length=1, CompletionCharacter='£', FalseLabel='F', TrueLabel='T'));
SelfDesc[SelfDesc.Items].ItemName = 'PrixPublicBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.PrixPublicBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'PrixPublicBln';

SelfDesc.AppendRow(BooleanFileStructureDesc(StartIndex = 12, Length=1, CompletionCharacter='#')); 
SelfDesc[SelfDesc.Items].ItemName = 'ProductionBln';
SelfDesc[SelfDesc.Items].ItemReference = Self.ProductionBln;
SelfDesc[SelfDesc.Items].ItemUserName = 'ProductionBln';

SelfDesc.AppendRow(DateFileStructureDesc(StartIndex = 13, Length=9, CompletionCharacter='@'));
SelfDesc[SelfDesc.Items].ItemName = 'dateProduction';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateProduction;
SelfDesc[SelfDesc.Items].ItemUserName = 'DateProduction';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=22, Length=4, Justification = JUSTIFY_RIGHT, CompletionCharacter='µ'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeDevise';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeDevise;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeDevise';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=26, Length=2, CompletionCharacter='§'));
SelfDesc[SelfDesc.Items].ItemName = 'CodePackage';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePackage;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePackage';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex=28,Length=4, CompletionCharacter='%'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeProduit';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeProduit;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodeProduit';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex = 32, Length=4, CompletionCharacter=''''));
SelfDesc[SelfDesc.Items].ItemName = 'CodePromotion';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodePromotion;
SelfDesc[SelfDesc.Items].ItemUserName = 'CodePromotion';

SelfDesc.AppendRow(IntegerFileStructureDesc(StartIndex = 36, Length=4, CompletionCharacter='*'));
SelfDesc[SelfDesc.Items].ItemName = 'CodeStrategie';
SelfDesc[SelfDesc.Items].ItemReference = Self.CodeStrategie;
SelfDesc[SelfDesc.Items].ItemUserName = 'Code Strategie';

SelfDesc.AppendRow(TextFileStructureDesc(StartIndex = 40,Length=32, CompletionCharacter='@'));
SelfDesc[SelfDesc.Items].ItemName = 'NomRegle';
SelfDesc[SelfDesc.Items].ItemReference = Self.NomRegle;
SelfDesc[SelfDesc.Items].ItemUserName = 'NomRegle';

-- Length = 100, 9 pour tester la troncature des chaînes de caractères
SelfDesc.AppendRow(TextFileStructureDesc(StartIndex = 72, Length=9, CharacterCase=CHARACTER_CASE_UPPER, CompletionCharacter='"'));
SelfDesc[SelfDesc.Items].ItemName = 'Commentaire';
SelfDesc[SelfDesc.Items].ItemReference = Self.Commentaire;
SelfDesc[SelfDesc.Items].ItemUserName = 'Commentaire';

SelfDesc.AppendRow(TextFileStructureDesc(StartIndex = 172, Length=100, CharacterCase=CHARACTER_CASE_LOWER, CompletionCharacter='|'));
SelfDesc[SelfDesc.Items].ItemName = 'Condition';
SelfDesc[SelfDesc.Items].ItemReference = Self.Condition;
SelfDesc[SelfDesc.Items].ItemUserName = 'Condition';

SelfDesc.AppendRow(TextFileStructureDesc(StartIndex = 272, Length=100, CharacterCase=CHARACTER_CASE_ANY, CompletionCharacter='*'));
SelfDesc[SelfDesc.Items].ItemName = 'Montant';
SelfDesc[SelfDesc.Items].ItemReference = Self.Montant;
SelfDesc[SelfDesc.Items].ItemUserName = 'Montant';

-- Avant : 9, remplacé par 7 pour tester le caractère de remplissage par défaut
SelfDesc.AppendRow(DateFileStructureDesc(StartIndex = 372, Length = 7, CompletionCharacter='#', CustomFormat='yymm dd'));
SelfDesc[SelfDesc.Items].ItemName = 'DateDebutValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateDebutValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de début de validité';

SelfDesc.AppendRow(DateFileStructureDesc(StartIndex=381, Length=9, CompletionCharacter='&'));
SelfDesc[SelfDesc.Items].ItemName = 'DateFinValidite';
SelfDesc[SelfDesc.Items].ItemReference = Self.DateFinValidite;
SelfDesc[SelfDesc.Items].ItemUserName = 'Date de fin de validité';
end method;

------------------------------------------------------------
method ExRegleDesc.DoResetService
begin
Self.ServiceMgr = soTarificationDSMgr;
Self.unService = RegleDS;


end method;

------------------------------------------------------------
method ExRegleDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method IntegriteCompilateurExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TestCompilateur.Expand(input src: Framework.TextData,
	input str: Framework.TextData): Framework.TextData
begin
--
--	Description : Test de l'expansion d'une expression
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PMT    |   07/04/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TestCompilateur.Expand');
Contexte : Contexte;
Compilateur : Compilateur = new(Contexte = Contexte);
uneExpansion: TextData = Compilateur.Expand(srcString=src,WithString=str,WithItem='Tarif_Normal');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TestCompilateur.Test : End');
return uneExpansion;

end method;

------------------------------------------------------------
method TestCompilateur.Init
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TestCompilateur.Init');

super.Init();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TestCompilateur.Init : End');

end method;

------------------------------------------------------------
method TestCompilateur.Test(input TypeDec: Framework.integer,
	input CompileN: Framework.integer,
	input EvalNHigh: Framework.integer,
	input EvalNLow: Framework.integer,
	input uneExpression: Framework.string,
	input output TempsCompilation: Framework.IntervalData,
	input output TempsEvaluation: Framework.IntervalData): Framework.DataValue
begin
--
--	Description : 
--
--	Type : Concret
--
--	Parametres : 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : 
--
--	Historique : 
--
--	PV    |   03/03/1998   |   Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TestCompilateur.Test');


Contexte : Contexte = NIL;
-- Mettre la ligne suivante en commentaire pour tester sans
-- utiliser de contexte
--Contexte = ContexteTarification();

Compilateur : Compilateur = new(Contexte = Contexte);
if TypeDec = 2 
 then Compilateur.MapDecimalToDouble();
 else Compilateur.MapDecimalToDecimal();
end if;

Compilateur.ClearPres();
Compilateur.AppendPre(unObjet='2*Prix',uneCle='Tarif_Normal');
Compilateur.AppendPre(unObjet='2*Tarif_Normal',uneCle='Multiplicateur');


unChronometre : Chronometre = new();
unChronometre.Fire();

for i in 1 to CompileN do
   uneExpressionCompilee  = Compilateur.Compile(uneExpression);
end for;
TempsCompilation = unChronometre.AsInterval();

if uneExpressionCompilee <> nil then

	if uneExpressionCompilee.VerifieType() = TYPE_BOOLEEN or
	   uneExpressionCompilee.VerifieType() = TYPE_NUMERIQUE then
		if Contexte <> NIL then
			Contexte.Initialise();
		end if;
		Valeur : DataValue;
		unChronometre = new();
		unChronometre.Fire();
		for Indice1 in 1 to EvalNLow do
			for Indice2 in 1 to EvalNHigh do
				Valeur = uneExpressionCompilee.Evalue();
--				task.part.logmgr.putline(Valeur.TextValue);
			end for;
		end for;
		TempsEvaluation = unChronometre.AsInterval();
		task.part.logmgr.putline('');
		task.part.logmgr.putline('Resutats :');
		task.part.logmgr.putline('----------');
		task.part.logmgr.putline(EvalNLow);
		task.part.logmgr.putline(EvalNHigh);
		task.part.logmgr.putline(TempsCompilation);
		task.part.logmgr.putline(TempsEvaluation);
	end if;
	
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TestCompilateur.Test : End');

if uneExpressionCompilee<>nil 
then return uneExpressionCompilee.Evalue();
else return nil;
end if;


end method;

------------------------------------------------------------
method ParserWindow.CleCompteBD(input Value: Framework.TextData): Framework.IntegerData
begin
C     : array of IntegerData = new();
Total : integer;
Res	  : IntegerData;
X	  : integer;
Z 	  : integer;
K	  : IntegerData;

NCSansCle : TextData = new(Value=Value.Value);

-- Extraction des chiffres du code client
for i in 1 to 7 do 
  C[i] = new(TextValue = NCSansCle.CopyRange(i-1,i));
end for;

Total = 9*A1+8*A2+7*A3+6*C[1].Value+5*C[2].Value+4*C[3].Value+3*C[4].Value+2*C[5].Value;
Res   = new();
Res.Mod(Total, 11);

if Res.Value=0 or Res.Value=1 
then X = Res.Value;
else X = 11 - Res.Value;
end if;

Z = X - C[6].Value;
if Z < 1 then Z = Z * -1; end if;

K = new(Value = Z + C[7].Value);


if K.Value>=10 then
   BK : IntegerData = K.Clone(Deep = TRUE);
   K.Value = (K.Value / 10) + BK.Mod(BK.Value,10).Value;   
end if;

return K;

end method;

------------------------------------------------------------
method ParserWindow.Compilation(copy input sourceCode: Framework.TextData,
	input montrerErreurs: Framework.boolean): Framework.boolean
begin
--
--	Description : Lancement de la compilation à partir du texte se trouvant
--  dans la fenêtre de code. 
--
--	Type :	concret
--
--	Parametres :   SourceCode : Le code source sous forme d'un TextData
--				   MontrerErreurs : Doit-t-on montrer les erreurs ?	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	02/02/1998	|	Creation.
--+


/*

aRes:boolean = unParser.Compile(SourceCode);
return aRes;

*/

return false;
end method;

------------------------------------------------------------
method ParserWindow.ControlerCompilateur
begin
unCompilateur : Compilateur = new();
unCompilateur.MapDecimalToDecimal();

begin
	-- unContexte.Initialise(...)
	
	TesterExpression('1=1'                               , 'TRUE');
	TesterExpression('1<>1'                              , 'FALSE');
	TesterExpression('1+2+3+4+5+6'						 , '21');
	TesterExpression('1+2*3'							 , '9');
	TesterExpression('2.2*2.2'							 , '4.84');
	TesterExpression('2+(3*4)+(5*6)','44');
	TesterExpression('((1+2)*3)','9');
	TesterExpression('Prix','400.0');
	TesterExpression('Devise','FF');
	TesterExpression('Categorie','VIP');
	TesterExpression('Age','18');

	-- opérateurs et, ou, non
	TesterExpression('non BonClient et non BonClient','FALSE');
	TesterExpression('non non BonClient','TRUE');
	TesterExpression('non BonClient ou BonClient','TRUE');
	TesterExpression('(non BonClient) et non BonClient','FALSE');
	TesterExpression('non non non non BonClient','TRUE');
	TesterExpression('non (non (BonClient ou non BonClient)))','TRUE');

	-- Opérateurs arrondis inf et sup
	TesterExpression('Prix*0.3784 inf 1 min 200','200.0');
	TesterExpression('Prix*0.3784 inf 1 min 100','151.0');
	TesterExpression('Prix*0.3784 sup 1 min 200','100.0');
	TesterExpression('Prix*0.3784 sup 1 min 100','152.0');

	-- Opérateur arrondi automatique
	TesterExpression('6.1 arr 0.5','6.0');
	TesterExpression('6.4 arr 0.5','6.5');
	TesterExpression('6.8 arr 0.5','7.0');
	TesterExpression('6.8 arr 5.0','5.0');

	-- dates
	TesterExpression('(''01/01/01''-''2 mois'')<''01/11/2000''', 'FALSE');

	-- accès variables et comparaisons
	TesterExpression('Categorie=''VIP''','TRUE');
	TesterExpression('Categorie<>''VIP''','FALSE');
	TesterExpression('(''1 an''+''6 mois'')','1:1:0 0:0:0:0');
	self.Window.MessageDialog('Le compilateur fonctionne correctement');
exception
	when e : ErreurCompilateur do 
  	   ErreurControle(e,'Impossible de compiler l''expression : %1');
	when e : GenericException do
	   ErreurControle(e,'Erreur non prévue : %1');
	when e : IntegriteCompilateurExc do
	   ErreurControle(e,'Erreur d''intégrité du compilateur (Résultat inattendu) : %1');
end;
end method;

------------------------------------------------------------
method ParserWindow.CreerContexte(input NombreClients: Framework.integer)
begin
	    sql delete from contexte; -- Equivalent drop table
	    
	    NumClient : IntegerData = new();
	    Age:IntegerData = new();
	    Categorie : IntegerData = new();
	    Devise : IntegerData = new();
	    Prix : IntegerData = new();
	    
	    unEntier : integer;
	    
	    for unClient in 1 to NombreClients do
	
	 		numclient.SetValue(unClient);
	 		age.SetValue(GenererNombre(70));
	 	
	 		Categorie.SetValue(GenererNombre(MAX_RG_CAT).Value);
/*
	 		case unEntier is
	 		  when 1 do Categorie.SetValue('STD');
	 		  when 2 do Categorie.SetValue('VIP');
			  when 3 do Categorie.SetValue('COL');
	 		  else Categorie.SetValue('STD');
	 		end case;
*/
			
	 		Devise.SetValue(GenererNombre(MAX_RG_DEV).Value);
/*
	 		case unEntier is
	 		  when 1 do Devise.SetValue('FF');
	 		  when 2 do Devise.SetValue('EU');
	 		  else Devise.SetValue('FF');
	 		end case;
*/	 			
	 		Prix.SetValue(GenererNombre(1000));
	 		
			sql insert into contexte (id,numclient,age,categorie,devise,prix)
				values (contexteid.nextval,:numclient,:age,:categorie,:devise,:prix);
	
		end for;

end method;

------------------------------------------------------------
method ParserWindow.CreerEvenementsValidation
begin
		sql delete from evtSource;

	    unID : integer = 1;
	    		
		lesEvenements : array of EvenementTarificationDesc = GenererLesEvenementsValidation(FALSE);

		for unEvt in lesEvenements do
			sql insert into evtSource
			(idutlqqo,dtmajqqo,id
			 ,CodeDevise, CodeProduit
			 ,CodeService,CodeCategorie
			 ,CodePackage,CodePromotion
			 ,NumClient, NumContrat
			 ,CodeAgence,CodeEtab
			 ,CodeCanal, DateOperation
			 ,DateTarification, DateFacturation
			 ,Montant, Quantite
			 ,TarifTTC, EtatCRE
			 ,CompteAFacturer, NumCompte
)
			values
			(0,'01/01/98',:unID,
			 :unEvt.CodeDevise,  :unEvt.CodeProduit,
			 :unEvt.CodeService, :unEvt.CodeCategorie,
			 :unEvt.CodePackage, :unEvt.CodePromotion,
			 :unEvt.NumClient,   :unEvt.NumContrat,
			 :unEvt.CodeAgence,  :unEvt.CodeEtab,
			 :unEvt.CodeCanal,   :unEvt.DateOperation,
			 :unEvt.DateTarification, :unEvt.DateFacturation,
			 :unEvt.Montant, :unEvt.Quantite,
			 :unEvt.TarifTTC,:unEvt.EtatCRE,
			 :unEvt.CompteAFacturer, :unEvt.NumCompte
			 );
		
			unID = unID + 1;
				
		end for;

end method;

------------------------------------------------------------
method ParserWindow.CreerLesEvenements(input GenererErreurs: Framework.boolean = FALSE)
begin
		sql delete from evtSource;

	    unID : integer = 1;
	    		
		lesEvenements : array of EvenementTarificationDesc = GenererLesEvenements(GenererErreurs);
		for unEvt in lesEvenements do
			sql insert into evtSource
			(idutlqqo,dtmajqqo,id
			 ,CodeDevise, CodeProduit
			 ,CodeService,CodeCategorie
			 ,CodePackage,CodePromotion
			 ,NumClient, NumContrat
			 ,CodeAgence,CodeEtab
			 ,CodeCanal, DateOperation
			 ,DateTarification, DateFacturation
			 ,Montant, Quantite
			 ,TarifTTC, EtatCRE
			 ,CompteAFacturer, NumCompte
)
			values
			(0,'01/01/84',:unID,
			 :unEvt.CodeDevise,  :unEvt.CodeProduit,
			 :unEvt.CodeService, :unEvt.CodeCategorie,
			 :unEvt.CodePackage, :unEvt.CodePromotion,
			 :unEvt.NumClient,   :unEvt.NumContrat,
			 :unEvt.CodeAgence,  :unEvt.CodeEtab,
			 :unEvt.CodeCanal,   :unEvt.DateOperation,
			 :unEvt.DateTarification, :unEvt.DateFacturation,
			 :unEvt.Montant, :unEvt.Quantite,
			 :unEvt.TarifTTC,:unEvt.EtatCRE,
			 :unEvt.CompteAFacturer, :unEvt.NumCompte
			 );
		
			unID = unID + 1;
				
		end for;

end method;

------------------------------------------------------------
method ParserWindow.CreerLesRegles
begin
/*
COMMENTAIRE                             VARCHAR2(100)
CONDITION                               VARCHAR2(100)
MONTANT		                            VARCHAR2(100)
CODECATEGORIE                           NUMBER
CODEDEVISE                              NUMBER
ID                             NOT NULL NUMBER
IDUTLQQO                                NUMBER
DATEDEBUTVALIDITE                       DATE
DATEFINVALIDITE                         DATE
CODEPACKAGE                             NUMBER
CODESERVICE                             NUMBER
CODEPRODUIT                             NUMBER
CODEPROMOTION                           NUMBER
PRIXPUBLICBLN                           NUMBER(1)
DTMAJQQO                                DATE
NOMREGLE                                VARCHAR2(100)
CODESTRATEGIE                           NUMBER
DATEPRODUCTION                          DATE
PRODUCTIONBLN                           NUMBER(1)
*/	
	
if TEST_NUMBER = 1 then

		sql delete from regles; 
		lesRegles : array of RegleDesc = DoLireLesRegles();
		unID : integer = 1;
		IsPrixPub : integer = 0;
		
		for i in lesRegles do
			
			if i.PrixPublicBln then IsPrixPub = 1;
							   else IsPrixPub = 0;
			end if;
				
			sql insert into Regles 
		   (idutlqqo,dtmajqqo,
			id,commentaire,
			condition,montant,
			PrixPublicBln, NomRegle,
			DateDebutValidite,DateFinValidite,
			CodeDevise,CodeCategorie,
			CodePackage,CodePromotion,
			CodeProduit,CodeService,
			ProductionBln,DateProduction,
			CodeStrategie) 
			values
			(0,'01/01/95',
			:unID,'un commentaire',
			:i.Condition , :i.Montant,
			:IsPrixPub, 'NomRegle',
			'01/01/80','01/01/99',
			:i.CodeDevise, :i.CodeCategorie,
			:i.CodePackage,:i.CodePromotion,
			:i.CodeProduit,:i.CodeService,
			1,'01/01/98',
			:i.CodeStrategie);
			
			unId = unID + 1;
		end for;


else
		sql delete from regleTN; 
		lesRegles : array of RegleDesc = DoLireLesRegles();
		unID : integer = 1;
		IsPrixPub : integer = 0;
		
		for i in lesRegles do
			
			if i.PrixPublicBln then IsPrixPub = 1;
							   else IsPrixPub = 0;
			end if;
				
			sql insert into RegleTN 
		   (idutlqqo,dtmajqqo,
			id,commentaire,
			condition,montant,
			PrixPublicBln, NomRegle,
			DateDebutValidite,DateFinValidite,
			CodeDevise,CodeCategorie,
			CodePackage,CodePromotion,
			CodeProduit,CodeService,
			ProductionBln,DateProduction,
			CodeStrategie) 
			values
			(0,'01/01/95',
			:unID,'un commentaire',
			:i.Condition , :i.Montant,
			:IsPrixPub, 'NomRegle',
			'01/01/80','01/01/99',
			:i.CodeDevise, :i.CodeCategorie,
			:i.CodePackage,:i.CodePromotion,
			:i.CodeProduit,:i.CodeService,
			1,'01/01/98',
			2);
			
			unId = unID + 1;
		end for;
end if;
end method;

------------------------------------------------------------
method ParserWindow.CreerRegle(input Cat: Framework.integer,
	input Promo: Framework.integer,
	input Pack: Framework.integer,
	input Eval: Framework.string,
	input EvalAlt: Framework.string,
	input PP: Framework.boolean = TRUE): TarificationSrv.RegleDesc
begin
-- Cool Helper method

unRegleDesc : RegleDesc = new();
unRegleDesc.DoResetAttributes();
unRegleDesc.Commentaire.SetValue('Commentaire');
unRegleDesc.CodeDevise.SetValue(1);
unRegleDesc.CodeCategorie.SetValue(Cat);
unRegleDesc.CodeProduit.SetValue(1); -- NS 
unRegleDesc.CodeService.SetValue(1); -- NS
unRegleDesc.CodePromotion.SetValue(Promo); 
unRegleDesc.CodePackage.SetValue(Pack);
unRegleDesc.PrixPublicBln.SetValue(PP);
if not PP then 
   unRegleDesc.Condition.SetValue('Age<25');
   unRegleDesc.Montant.SetValue(EvalAlt);
else
   unRegleDesc.Condition.SetValue('1=1');
   unRegleDesc.Montant.SetValue(Eval);

end if;

return unRegleDesc;

end method;

------------------------------------------------------------
method ParserWindow.Display
begin
self.Open();
event loop
	when task.Shutdown do exit;
	when <TestFileStructureDesc>.Click do TestFD();
    when <CreationClients>.Click do InsererLesClients();
	when <ExpansionBtn>.click do TesterExpansion();
	when <CreerRegles>.Click do CreerLesRegles();
	when <CreerReglesTN>.Click do CreerLesRegles();
	when <CreerEvenements>.Click do CreerLesEvenements();
	when <CreerContexte>.Click do CreerContexte(MAX_CLIENTS);
	when <TestCast>.Click do TesterCast();
	when <AnalyserBtn>.click do TesterCompilation();
	when <LstExpr>.Click do UpdateExpressionList();
	when <TestHash>.Click do TesterHashTableFillArray();
	when <TestCollBtn>.Click do TestCollectionNil();
	when <LancerBatchTarif>.Click do LancerLeBatchTarif();	
	when <LancerBatchTarif2>.Click do LancerLeBatchTarif2();	
	when <TestIsNull>.Click do
		 unDecimalNullable : DecimalNullable = new();
		 unDecimalNullable.IsNull = true;
		 unNumericData : NumericData = (NumericData) (unDecimalNullable);
		 ok : boolean = unDecimalNullable.IsGreaterThan(DoubleData(Value=10.0));

	when <TestFormatText>.Click do
	  begin
	  	aTextFormat : TextFormat = new(Template = CFormat.Value);		 
		CFormatee.SetValue(aTextFormat.FormatText(CNFormatee));
	  exception
	    when e : UsageException do
	      self.Window.MessageDialog(e.Message);
	  end;
		
	when <CalculDecimalData>.Click do 
		
	   unDecimalData : DecimalData = new();	
	   unDecimalData.Scale = 4;
	   unDecimalData.Multiply(400.0,0.3784);
	   self.Window.MessageDialog(unDecimalData.TextValue);

	   unDoubleData : DoubleData = new();	
	   unDoubleData.Multiply(400.0,0.3784);
	   self.Window.MessageDialog(unDoubleData.TextValue);

	when <TesterLaPile>.Click do TestPile();
	when <IotaGen>.Click do TesterIotaGen();
	when <LancerMoteurTarif>.Click do LancerMoteurTarif();
	
	when <ControleCompilateur>.Click do ControlerCompilateur();
	when <CreerEvenementsValidation>.Click do CreerEvenementsValidation();	
end event;
self.Close();


end method;

------------------------------------------------------------
method ParserWindow.DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc
begin
lRD : array of RegleDesc = new();

if TEST_NUMBER = 1 then -- Test aléatoire
    
	Cond : Assoc = new();
	Cond.Append('1','Age<25');
	Cond.Append('2','Prix<>300');
	Cond.Append('3','Prix=200');
	Cond.Append('4','Prix>200');
	Cond.Append('5','Categorie=''VIP''');
	
	Eval : Assoc = new();
/*
	Eval.Append('1','100.00+(Prix*2.0)');
	Eval.Append('2','Prix*(Age*0.80)/100');
	Eval.Append('3','100.00');
	Eval.Append('4','150.00');
	Eval.Append('5','Prix/2.0');
*/
	Eval.Append('1','1.00');
	Eval.Append('2','2.00');
	Eval.Append('3','3.00');
	Eval.Append('4','4.00');
	Eval.Append('5','5.00');
	
	NumCondition  : IntegerData = new();
	NumEvaluation : IntegerData = new();
	
	NombreRegles = 0;
	
	unRegleDesc : RegleDesc;
	for Devise in 1 to MAX_RG_DEV do
	  for Categorie in 1 to MAX_RG_CAT do
		for Produits in 1 to MAX_RG_PROD do
			for Operations in 1 to MAX_RG_OPER do		
				for Package in 1 to MAX_RG_PACK do
					for Promotion in 1 to MAX_RG_PROM do
						for Conditions in 1 to MAX_RG_COND do
							for Evaluations in 1 to MAX_RG_EVAL do
	
								unRegleDesc = new();
								unRegleDesc.DoResetAttributes();
								unRegleDesc.DateDebutValidite.SetValue('01-Jan-1998');
								unRegleDesc.DateFinValidite.SetValue('01-May-1998');
								unRegleDesc.DateProduction.SetValue('01-May-1998');
								unRegleDesc.Commentaire.SetValue('Commentaire');
								unRegleDesc.CodeDevise.SetValue(Devise);
								unRegleDesc.CodeCategorie.SetValue(Categorie);
								unRegleDesc.CodeProduit.SetValue(Produits);
								
								unRegleDesc.CodeService.SetValue(Operations);
--								unRegleDesc.CodeService.Add(unRegleDesc.CodeService,12345678);
								
								unRegleDesc.CodePromotion.SetValue(Promotion);
								unRegleDesc.CodePackage.SetValue(Package);
								NumCondition.SetValue(GenererNombre(MAX_RG_COND));
								unRegleDesc.Condition.SetValue(Cond.FindByKey(NumCondition.TextValue).GetItem());
								NumEvaluation.SetValue(GenererNombre(MAX_RG_EVAL));
								unRegleDesc.Montant.SetValue(Eval.FindByKey(NumEvaluation.TextValue).GetItem());
								unRegleDesc.ProductionBln.SetValue(TRUE);
								
								if Conditions = 1 and Evaluations=1 then 
								   unRegleDesc.CodeStrategie.SetValue(STRATEGIE_MAXI);
								   unRegleDesc.PrixPublicBln.SetValue(TRUE);
								else
								   unRegleDesc.CodeStrategie.SetValue(STRATEGIE_INDEFINI);
								   unRegleDesc.PrixPublicBln.SetValue(FALSE);
								end if;
	
								LRD.AppendRow(unRegleDesc);
								NombreRegles = NombreRegles + 1;
															
							end for; -- Evaluations
						end for; -- Conditions
					end for; -- Promotions
				end for; -- Package
			end for; -- Operations
		end for; -- Produits
	  end for; -- Categorie
	end for; -- Devise
else
	-- Test des capacités de réduction du tarif normal
	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= HPR, Eval='200.00'         , EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= HPR, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= PR1, Eval='Tarif_Normal/2' , EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= PR1, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= HPR, Eval='Tarif_Normal/4' , EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= HPR, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= PR1, Eval='Tarif_Normal/5' , EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= PR1, Eval=''               , EvalAlt='',PP=FALSE));

	
	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= HPR, Eval='Tarif_Normal/8' , EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= HPR, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= PR1, Eval='Tarif_Normal/10', EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= PR1, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= HPR, Eval='Tarif_Normal/20', EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= HPR, Eval=''               , EvalAlt='',PP=FALSE));

	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= PR1, Eval='Tarif_Normal/40', EvalAlt='',PP=TRUE));
	LRD.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= PR1, Eval=''               , EvalAlt='',PP=FALSE));


end if;	

return LRD;
end method;

------------------------------------------------------------
method ParserWindow.DoTrapErrors
begin
-- <ListeErreurs>.SetElementList(unParser.GetErrors());
end method;

------------------------------------------------------------
method ParserWindow.DoTrapTokens
begin
-- Méthode appelée pour permettre un traitement sur les tokens
-- devrait être une méthode abstraite à ce niveau de la hiérarchie
-- des classes.

-- affichage des tokens dans la liste
/*

unTableau : array of ListElement = new();
		
for CurrTok in unParser.GetTokenizer().GetTokens() do
  		 unElement : ListElement = new(); 
   		 unElement.TextValue.SetValue(CurrTok.GetVal());
   		 unTableau.AppendRow(unElement);
end for;
		
<lesTokens>.SetElementList(unTableau);
NombreTokens.SetValue(unParser.GetTokenizer().GetTokenCount());

*/
end method;

------------------------------------------------------------
method ParserWindow.ErreurControle(input e: Framework.GenericException,
	copy input Message: Framework.TextData)
begin
GlobalMessage : TextData = new();
GlobalMessage.SetValue(Message);
GlobalMessage.ReplaceParameters(GlobalMessage,Parameter1=TextData(Value=ExpressionTestee));
GlobalMessage.Concat(' avec le message suivant : ');
GlobalMessage.Concat(e.Message);
self.Window.MessageDialog(GlobalMessage.Value);
end method;

------------------------------------------------------------
method ParserWindow.GenererLesEvenements(input GenererErreurs: Framework.boolean = FALSE): Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
ListeEvTarif : array of EvenementTarificationDesc = new();
unEvTarif    : EvenementTarificationDesc;

if unGenerateur = nil then
   unGenerateur = new(); -- Seed positionné automatiquement
end if;

DateReference : DateTimeData = new();
DateReference.SetCurrent(DR_DAY);

for iex in 1 to 2 do

	for i in 1 to MAX_CLIENTS do
	
		unEvTarif = new();
		unEvTarif.DoResetAttributes();
		unEvTarif.NumClient.SetValue(i);
		unEvTarif.CodeDevise.SetValue(GenererNombre(MAX_RG_DEV));
		unEvTarif.CodeService.SetValue(GenererNombre(MAX_RG_OPER));
		if  GenererErreurs = TRUE and i>MAX_CLIENTS-5
			then 
			 case iex is
			   when 1 do unEvTarif.CodeProduit.SetValue(12);
			   when 2 do unEvTarif.CodeService.SetValue(12);
			   when 3 do unEvTarif.CodeDevise.SetValue(12);
			   when 4 do unEvTarif.CodeCategorie.SetValue(12);
			 end case;
			else unEvTarif.CodeProduit.SetValue(GenererNombre(MAX_RG_PROD));
		end if;
		unEvTarif.CodePackage.SetValue(GenererNombre(MAX_RG_PACK));
		unEvTarif.CodePromotion.SetValue(GenererNombre(MAX_RG_PROM));
		unEvTarif.CodeCategorie.setValue(GenererNombre(MAX_RG_CAT));
		unEvTarif.DateOperation.setValue(DateReference);
	    ListeEvTarif.AppendRow(unEvTarif);
	    
	end for;

end for;

return ListeEvTarif;


end method;

------------------------------------------------------------
method ParserWindow.GenererLesEvenementsValidation(input GenererErreurs: Framework.boolean): Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
lesEvenements : array of EvenementTarificationDesc = new();
NumCompte 	  : TextData = new();
Evenement     : EvenementTarificationDesc;

DateReference : DateTimeData = new();
DateReference.SetCurrent(DR_DAY);

NumClientText : TextData = new();
unGenerateur  : RandomNumber = new();
unGenerateur.SetSeed(1);

for NumClient in 7000001 to 7000001+NB_CLI-1 do

	NumClientText.SetValue(NumClient);
	Evenement = new();
	Evenement.DoResetAttributes();
	NumCompte.SetValue(NumClient);
	NumCompte.Concat('150');
	NumCompte.Concat(CleCompteBD(NumClientText));
	Evenement.CodeEtab.SetValue(1);
	Evenement.CodeCanal.SetValue(1);
	Evenement.CodeAgence.SetValue(1);
	Evenement.NumClient.SetValue(NumClient);
	Evenement.NumCompte.SetValue(NumCompte);
	Evenement.CompteAFacturer.SetValue(NumCompte);
	Evenement.CodeDevise.SetValue(1);
	Evenement.CodeProduit.SetValue(1);

	Evenement.CodeService.SetValue(unGenerateur.Get());
	Evenement.CodeService.Mod(Evenement.CodeService,43); -- Table servicetest

	Evenement.CodePromotion.SetValue(1);	
	Evenement.CodePackage.SetValue(1);	
	Evenement.CodeCategorie.SetValue(1);
	Evenement.DateOperation.setValue(DateReference);
	Evenement.DateFacturation.setValue(DateReference);
	Evenement.DateTarification.setValue(DateReference);
	Evenement.EtatCre.SetValue(0);
	lesEvenements.AppendRow(Evenement);
		
end for;

return lesEvenements;

end method;

------------------------------------------------------------
method ParserWindow.GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable
begin
-- Génération d'un nombre aléatoire entre 1 et MaxRange
unEntier : IntegerNullable = new();
unEntier.SetValue(unGenerateur.Get());
unEntier.Mod(unEntier.Value,MaxRange);
unEntier.Value = unEntier.Value + 1;
if unEntier.Value > MaxRange then
   Exc : GenericException = new();
   Exc.SetWithParams(SP_ER_ERROR,'Dépassement d''échelle');
   raise Exc;
end if;
return unEntier;
end method;

------------------------------------------------------------
method ParserWindow.GenererNumeroClient: Framework.TextData
begin
unNumClient : TextData = new();
unChiffre   : IntegerData = new();
for i in 1 to 7 do
  unChiffre.SetValue(unRandom.Get());
  unChiffre.Mod(unChiffre.Value,10);
  unNumClient.Concat(unChiffre.TextValue);
end for;
return unNumClient;
end method;

------------------------------------------------------------
method ParserWindow.Init
begin
super.Init();

unGenerateur = new();
unGenerateur.SetSeed(9321765408); -- Pour avoir toujours le même jeu de test

leSource = new(); 
unTest = new();
resultat = new();
TempsCompile = new();
TempsEvalue = new();
ExpansionSrc = new();
ExpansionRes = new();
CastRes = new();
laPile = new();

DureeInsertion = new();
DureeRecherche = new();
TypeInsertion = 1;
LstExpr=1;
NombreDeClients = new();

unRandom = new();

unIotaGen = new();

CFormatee = new();
CNFormatee = new();
CFormat = new();

FenExport = new();


end method;

------------------------------------------------------------
method ParserWindow.InsererLesClients
begin
TempsArbre: IntervalData;
HashTable : HashTable;
HashFunc  : HashFuncs;

Assoc	  : AssocItem;

unClient  : TarifClientDesc;
Nombre    : integer;

begin
  Nombre = NombreDeClients.IntegerValue;
exception
  when e : GenericException do Nombre = 10;
end;

if Nombre > 0 then


	-- Ici, l'arbre est créé dans le but de fournir un accès facile au numéros de clients,
	-- et à en supprimer d'une manière sélective
	
	-- Création et démarrage d'un chronomètre
	unChrono : Chronometre = new();
	unChrono.Fire();
				
	-- Insertion des clients dans l'arbre
	CodeClient : IntegerData;

	for ie in 1 to MAX_ARBRES do
	
		ArbreClientsPartiel = new();
		for i in 1 to Nombre do
			CodeClient = new(Value=GenererNumeroClient().IntegerValue);
			unMontant  : TextData = new(IntegerValue=i);
			ArbreClientsPartiel.Insert(CodeClient,unMontant,ArbreClients);
		end for;

		Task.Part.LogMgr.Put('Arbre : ');
		Task.Part.LogMgr.Put(ie);

		if ie<>MAX_ARBRES then
/*
		  ArbreClientsPartiel.DeleteChildren(Notification=False,CaseBranch=0,Param=NIL);
*/
          ArbreClientsPartiel = NIL;
        end;
        
		
	end for;
	
	TempsArbre = unChrono.AsInterval(); -- On le conserve, on en aura peut t'être besoin (TI_ARBRE)
	
	DureeInsertion.SetValue(TempsArbre.TextValue);
	Task.Part.LogMgr.PutLine(TempsArbre.TextValue);
	unChrono = nil;

	case <TypeInsertion>.IntegerValue is
	
	  when TI_ARBRE do 

		-- On clone l'arbre pour en avoir une copie sans suppressions de clients
		StructureClients = ArbreClientsPartiel.Clone(Deep=true); -- On créé une autre copie (en profondeur) de l'arbre

		LaPile = new();  -- Création d'une pile que l'on va passer en paramètres
		ArbreClientsPartiel.DeepLeftTraversalInOrder(CaseBranch=1,Param=laPile);
		Etat : boolean;
		
		-- Suppression dans l'arbre partiel d'un client sur deux
		for i in 1 to laPile.GetSize() do
			CodeClient = (IntegerData) ((SearchTree) (laPile.Pop()).GetKey());
			if Etat then 
			   ArbreClientsPartiel.DeleteNodeForKey(CodeClient,CaseBranch=0,Param=nil);	
			end if;
			Etat = not Etat;	
		end for;		

		-- Ici, normalement laPile est vide
		while not LaPile.IsEmpty() do 
		   laPile.Pop(); -- Weird
		end while;

		unResult : SearchTree = ArbreClientsPartiel.LookupNode(CodeClient,CaseBranch=0,Param=NIL);
		unResult = ArbreClientsPartiel.LookupNode(NIL,CaseBranch=0,Param=NIL);
				
/*  CODE DESTINE A EFFECTUER UNE RECHERCHE, A DEPLACER
		uneValeur : Object;
		ok : boolean = true;
		for i in 1 to Nombre do
			CodeClient = (IntegerData) ((ArbreClients) (LaPile.Pop()).GetValue());
			uneValeur = Arbre.LookupValue(CodeClient,CaseBranch=1,Param=LaPile);
			if uneValeur = nil then ok = false; end if;
		end for;
		
		Task.Part.LogMgr.PutLine(unChrono.AsText());
		unChrono = nil;
		
		if ok 
		then self.Window.MessageDialog('Recherche OK');	
		else self.Window.MessageDialog('Recherche erronée');
		end if;
*/		
		
	  when TI_ASSOC do
	    unAssocGen : AssocGen = new();
		for i in 1 to Nombre do
			CodeClient : IntegerData = new(Value=GenererNumeroClient().IntegerValue);
			unMontant  : TextData = new(IntegerValue=i);
			unAssocItemGen : AssocItemGen = new();
			unAssocItemGen.SetParams(CodeClient,unMontant);
			unAssocGen.Append(unAssocItemGen);		
		end for;
		StructureClients = unAssocGen;
	
	  when TI_HASH do
		HashTable = new();
		HashFunc = new(KeyType=SP_KT_INTEGER);
		HashTable.Setup(20,HashFunc);
		for i in 1 to Nombre do
			CodeClient : IntegerData = new(Value=GenererNumeroClient().IntegerValue);
			unMontant  : TextData = new(IntegerValue=i);
			HashTable.Enter(Key=CodeClient.Value,Element=unMontant);
		end for;
		StructureClients = HashTable;
	
	end case;
else
	self.Window.MessageDialog('Vous devez indiquer un nombre de clients > 0');	
end if;

if 	   StructureClients <> nil then
	if     StructureClients.IsA(SearchTree) then

		   Task.Part.LogMgr.PutLine('Exploration en profondeur d''abord : ');	
		   (ArbreClients) (StructureClients).DeepLeftTraversalInOrder(CaseBranch=0,Param=nil);
		   Task.Part.LogMgr.PutLine('Suppression : ');	
		   (ArbreClients) (StructureClients).DeleteChildren(Notification=true,CaseBranch=0,Param=nil);
		   StructureClients = nil;
	       self.Window.MessageDialog('Arbre constitué');	
		   
	elseif StructureClients.IsA(GenericHashTable)  then

	       self.Window.MessageDialog('HashTable constituée');	

	elseif StructureClients.IsA(AssocGen)   then

	       self.Window.MessageDialog('AssocGen constituée');	

	end if;
end if;


end method;

------------------------------------------------------------
method ParserWindow.LancerLeBatchTarif
begin
sql delete from evtrejetes;
sql delete from evttarifes;
CreerLesEvenements(GenererErreurs=TRUE);
unBatch : BatchTarifSrv.BatchTarification = new();
unBatch.StartBatch();
end method;

------------------------------------------------------------
method ParserWindow.LancerLeBatchTarif2
begin
sql delete from evtrejetes;
sql delete from evttarifes;
CreerEvenementsValidation();
unBatch : BatchTarifValidationSrv.BatchTarification = new();
unBatch.StartBatch();
end method;

------------------------------------------------------------
method ParserWindow.LancerMoteurTarif
begin
unMoteur : MoteurBS = new();
CT : ContexteTarification = ContexteTarification();
unMoteur.Initialise(unContexte = CT, GoCompile = Compiler, DoPerformControls = InsererInfo);

Errs  : array of Anomalie = unMoteur.LireErreursCompilation();
NbErr : integer = Errs.Items;

if NbErr > 0 then
	Task.Part.LogMgr.Put(unMoteur.LireErreursCompilation.Items);
	Task.Part.LogMgr.Put(' erreurs de compilation detectees :');
	for i in 1 to NbErr do
		Task.Part.LogMgr.Put('[');
		Task.Part.LogMgr.Put(Errs[i].IDRegle);
		Task.Part.LogMgr.Put(']');
		Task.Part.LogMgr.PutLine(Errs[i].Message);
	end for;
end if;

end method;

------------------------------------------------------------
method ParserWindow.TestCollectionNil
begin
uneColl : array of object;

for unObj in uneColl do
	
end for;

end method;

------------------------------------------------------------
method ParserWindow.TesterCast
begin
		unChrono : Chronometre = new();
		unChrono.Fire();
		
		unDouble : DoubleNullable = new();
--		unDouble : DoubleData = new();
		unAutre  : DoubleData;
		
		for i in 1 to 200000 do
		  unAutre = (DoubleData) (unDouble);
--		  unAutre = unDouble;
		end for;

		CastRes.SetValue(unChrono.AsText());
		unChrono = nil;

end method;

------------------------------------------------------------
method ParserWindow.TesterCompilation
begin
begin
		Texte     : TextData = new();
		Texte.SetValue(leSource); -- recopie physique pour éviter de modifier le texte source
		uneValeur : DataValue;
		
		unChrono : Chronometre = new();
		unChrono.Fire();
		
		TempsCompilation : IntervalData = new();
		TempsEvaluation  : IntervalData = new();

		TempsCompile.SetValue('');
		TempsEvalue.SetValue('');
		
		Self.Window.UpdateDisplay();

  		uneValeur = unTest.Test(TypeDec,COMPILE_N_TIMES,EVALLOW,EVALHIGH,Texte.Value,TempsCompilation,TempsEvaluation);
		TempsCompile.SetValue(TempsCompilation);
		TempsEvalue.SetValue(TempsEvaluation);
		
		if uneValeur<>nil 
        then Resultat.SetValue(uneValeur.TextValue);
        else Resultat.SetValue('Expression mal formée');
		end if;
	exception
		when e : ErreurCompilateur do Resultat.SetValue(e.Message);
		when e : GenericException do Resultat.SetValue(e.Message);
	end;


end method;

------------------------------------------------------------
method ParserWindow.TesterExpansion
begin
		uneValeur : TextData;
		unChrono : Chronometre = new();
		unChrono.Fire();
--		for i in 1 to 1000 do
	  		uneValeur = unTest.Expand(ExpansionSrc,ExpansionRes);
--		end for;
		TempsCompile.SetValue(unChrono.AsText());
		leSource.SetValue(uneValeur);	    
		unChrono = nil;

end method;

------------------------------------------------------------
method ParserWindow.TesterExpression(input anExpr: Framework.string,
	input aValue: Framework.TextData)
begin
ExpressionTestee = anExpr; -- avant la levée d'une éventuelle exception

unCompilateur : Compilateur = new();
uneExpression : ExpressionCompilee = unCompilateur.Compile(anExpr);
if uneExpression.VerifieType <> TYPE_INCONNU then

   ValComp : TextData = uneExpression.Evalue().TextValue;
   Ok : boolean = TRUE; -- par défaut, tout est ok

   if ValComp.IsNotEqual(aValue) then
      Ok = FALSE;
   end if;
   
   if not ok = TRUE then
	   Exc : IntegriteCompilateurExc = new();
	   Msg : TextData = new();
	   Msg.ReplaceParameters('L''évaluation a échouée en terme de comparaison sur l''expression %1. Attendu : %2, trouvé : %3',
	       Parameter1 = TextData(Value=anExpr),
	       Parameter2 = aValue,
	       Parameter3 = ValComp);
	   Exc.SetWithParams(SP_ER_ERROR, Msg.Value);
	   raise Exc;
   end if;
else
   Exc : IntegriteCompilateurExc = new();
   Msg : TextData = new();
   Msg.ReplaceParameters('Le contrôle de type a échoué sur l''expression %1',Parameter1=TextData(Value=anExpr));
   Exc.SetWithParams(SP_ER_ERROR, Msg.Value);
   raise Exc;
end if;


end method;

------------------------------------------------------------
method ParserWindow.TesterHashTableFillArray
begin
x : Array of TextData = new();   -- Assume this has been filled up;
x.AppendRow(TextData(Value='1'));
x.AppendRow(TextData(Value='2'));
x.AppendRow(TextData(Value='3'));
x.AppendRow(TextData(Value='4'));

hashtab : HashTable = new;
strfunc : HashFuncs = new(keyType = SP_KT_STRING);
hashtab.Setup(size = 20, functions = strfunc, uniqueKey = FALSE);
for t in x do
	hashtab.Enter(element = t, key = t.Value);
end for;
-- Now take all elements out, and get into a new array of TextData
o : Array of Object;
newtxt : Array of TextData;
o = hashtab.FillArray();
-- Casting the Array
newtxt = (Array of TextData) (o);

trouve : object = hashtab.Find(Key='1');
if trouve=nil 
then self.Window.MessageDialog('=nil');
else self.Window.MessageDialog('<>nil');
end if;

end method;

------------------------------------------------------------
method ParserWindow.TesterIotaGen
begin
unEntier : IntegerData = (IntegerData) (unIotaGen.Execute());
Window.MessageDialog(unEntier.TextValue);
end method;

------------------------------------------------------------
method ParserWindow.TestFD
begin
unFileDataService : Export  = new();
unFileDataService.StartService();
unFileDataService.OpenFile();

lesRegles  : array of RegleDesc = DoLireLesRegles();
aTransData : TransDesc = new();
aCacheDesc : CacheDesc = new();

for uneRegle in lesRegles do

	uneRegle.SelfDesc = new();
	aCacheDesc.Record = uneRegle;
	aTransData.TransObject = aCacheDesc;
	begin
	  unFileDataService.Append(aTransData);
	exception
	  when e : FileDataAccessExc do
	  when e : FileStructureDescExc do
	  when e : GenericException do
	end;
	
end for; 

unFileDataService.CloseFile();
end method;

------------------------------------------------------------
method ParserWindow.TestPile
begin
Pile : Stack = new();
for i in 1 to 10 do
   Pile.Push(IntegerData(Value=i)) ;
end for ;
Pile.Reverse(); -- Inversion de la pile

uneAutrePile : Stack = new();
unEntier : IntegerData;

while not Pile.IsEmpty() do

--	unEntier = IntegerData(Value=(IntegerData) (Pile.Peek()).Value);
	unEntier = (IntegerData) (Pile.Peek(Clone=TRUE));
	if unEntier.Mod(unEntier,2).IsEqual(IntegerData(Value=0)).IsEqual(BooleanData(Value=TRUE))
	 then uneAutrePile.Push(Pile.Pop());
	 else Pile.Pop();
	end if;
			
end while ;

Task.Part.LogMgr.PutLine(UneAutrePile.GetSize()) ;

end method;

------------------------------------------------------------
method ParserWindow.UpdateExpressionList
begin
unIndex : integer = <LstExpr>.IntegerValue;
if unIndex<>-1 then
    leSource.SetValue(<LstExpr>.ExtractListElementByIndex(<LstExpr>.IndexValue).TextValue);
end if;

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'parserwi';
	StartingMethod = (class = ParserWindow, method = Display);


end ParserWin;
begin TOOL Annuaire;

includes FrameworkBD;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  AnnuaireTelephone;
forward  PaireInfoTel;
forward  TripletInfoTel;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class AnnuaireTelephone inherits from FrameworkBD.ObjectBD

has private constant ANU_GROUPE = 'GROUPE.TXT';
has private constant ANU_INDIVIDU = 'INDIVIDU.TXT';
has private constant ANU_PARTENAIRE = 'PARTENAIRE.TXT';

has public  attribute lalisteGroupe: Framework.Array of Annuaire.PaireInfoTel;
has private attribute lalisteIndividu: Framework.Array of Annuaire.TripletInfoTel;
has public  attribute lalistePartenaire: Framework.Array of Annuaire.PaireInfoTel;

has private method ChargementBase;
has public  method GetListeGroupe: Framework.Array of Annuaire.PaireInfoTel;
has public  method GetListeIndividu(input pGroupe: Framework.string): Framework.Array of Annuaire.PaireInfoTel;
has public  method GetListePartenaire: Framework.Array of Annuaire.PaireInfoTel;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=on, override=on, default=off);

end class;

class PaireInfoTel inherits from FrameworkBD.ObjectBD

has public  attribute leNom: Framework.string;
has public  attribute leNumeroTel: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TripletInfoTel inherits from Annuaire.PaireInfoTel

has public  attribute leGroupe: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soAnnuaireTelephone : Annuaire.AnnuaireTelephone = (DialogDuration = SESSION,
	Visibility = user,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'DA6DB016-3FBD-11D1-9D1F-5478D244AA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method AnnuaireTelephone.ChargementBase
begin
--
--	Description :	Chargement de la base d'annuaire 
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AnnuaireTelephone.ChargementBase');

-- Declarations

fichierAnnuaire : File = new;
str : TextData = new;
deb,fin : integer;
paire : PaireInfoTel;
triplet : TripletInfoTel;
nomfichier : TextData = new;

-- Traitement
/*
Lecture des groupes
*/

nomfichier = task.Part.OperatingSystem.GetEnv('ANNU_ROOT');

if (nomfichier=NIL) then
	uneCTITechExc : ActionExc = new();
	uneCTITechExc.message = 'Variable d\'environnement ANNU_ROOT non définie';
	Self.TraceExc(uneCTITechExc,'AnnuaireTelephone.ChargementBase');
-- DN 10/10/97	task.ErrorMgr.AddError(uneCTITechExc);
	raise uneCTITechExc;
end if;

nomfichier.concat('\\');
nomfichier.concat(ANU_GROUPE);
fichierAnnuaire.SetLocalName(name = nomfichier.value);
fichierAnnuaire.Open(SP_AM_READ, isBinary = FALSE);
while (fichierAnnuaire.ReadLine(target=str,includeEOL=FALSE) <> -1 ) do --1
	paire = new;
	deb = 0;
	str.MoveToChar(',');
	fin = str.Offset;
	paire.leNom = str.CopyRange(deb,fin).value;
	deb = fin+1;
	fin = str.ActualSize;
	paire.leNumeroTel = str.CopyRange(deb,fin).value;
	lalisteGroupe.AppendRow(paire);
end while; --1
fichierAnnuaire.Close();

/*
Lecture des partenaires
*/

nomfichier = task.Part.OperatingSystem.GetEnv('ANNU_ROOT');
nomfichier.concat('\\');
nomfichier.concat(ANU_PARTENAIRE);
fichierAnnuaire.SetLocalName(name = nomfichier.value);
fichierAnnuaire.Open(SP_AM_READ, isBinary = FALSE);
while (fichierAnnuaire.ReadLine(target=str,includeEOL=FALSE) <> -1 ) do --2
	paire = new;
	deb = 0;
	str.MoveToChar(',');
	fin = str.Offset;
	paire.leNom = str.CopyRange(deb,fin).value;
	deb = fin+1;
	fin = str.ActualSize;
	paire.leNumeroTel = str.CopyRange(deb,fin).value;
	lalistePartenaire.AppendRow(paire);
end while; --2
fichierAnnuaire.Close();


/*
Lecture des individus
*/


nomfichier = task.Part.OperatingSystem.GetEnv('ANNU_ROOT');
nomfichier.concat('\\');
nomfichier.concat(ANU_INDIVIDU);
fichierAnnuaire.SetLocalName(name = nomfichier.value);
fichierAnnuaire.Open(SP_AM_READ, isBinary = FALSE);
while (fichierAnnuaire.ReadLine(target=str,includeEOL=FALSE) <> -1 ) do --3
	triplet = new;
	deb = 0;
	str.MoveToChar(',');
	fin = str.Offset;
	triplet.leNom = str.CopyRange(deb,fin).value;
	deb = fin+1;
	str.MoveNext();
	str.MoveToChar(',');
	fin = str.Offset;
	triplet.leNumeroTel = str.CopyRange(deb,fin).value;
	deb = fin+1;
	fin = str.ActualSize;
	triplet.leGroupe = str.CopyRange(deb,fin).value;
	lalisteIndividu.AppendRow(triplet);
end while;
fichierAnnuaire.Close(); --3


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AnnuaireTelephone.ChargementBase : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'AnnuaireTelephone.ChargementBase');
		Raise;
	-- DN 10/10/97
	When e: ActionExc do
		Self.TraceExc(e, 'AnnuaireTelephone.ChargementBase');
		
end method;

------------------------------------------------------------
method AnnuaireTelephone.GetListeGroupe: Framework.Array of Annuaire.PaireInfoTel
begin
--
--	Description :	Renvoi la liste des groupes présents dans l'annuaire
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AnnuaireTelephone.GetListeGroupe');

-- Declarations
uneListe : array of PaireInfoTel;

-- Traitement
uneListe = lalisteGroupe.clone(deep=TRUE);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AnnuaireTelephone.GetListeGroupe : End');

-- On renvoie la liste
return uneListe;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'AnnuaireTelephone.GetListeGroupe');
		Raise;
 

end method;

------------------------------------------------------------
method AnnuaireTelephone.GetListeIndividu(input pGroupe: Framework.string): Framework.Array of Annuaire.PaireInfoTel
begin
--
--	Description :	Renvoi la liste des individus et leur numero de telephone, appartenant à un groupe, présents dans l'annuaire
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pGroupe : string = groupe d'appartenance des individus (chaine vide si tous)
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AnnuaireTelephone.GetListeIndividu');

-- Declarations

uneListe : array of PaireInfoTel = new;
unIndividu : PaireInfoTel;

-- Traitement

for row in lalisteIndividu do --1
	if ((pGroupe='') or (pGroupe=row.leGroupe)) then --11
		unIndividu = new(leNom=row.leNom, leNumeroTel=row.leNumeroTel);
		uneListe.AppendRow(unIndividu);
	else --11
		-- Rien à faire
	end if; --11
end for; --1

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AnnuaireTelephone.GetListeIndividu : End');

return uneListe;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'AnnuaireTelephone.GetListeIndividu');
		Raise;
 

end method;

------------------------------------------------------------
method AnnuaireTelephone.GetListePartenaire: Framework.Array of Annuaire.PaireInfoTel
begin
--
--	Description :	Renvoi la liste des partenaires présents dans l'annuaire
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AnnuaireTelephone.GetListePartenaire');

-- Declarations
uneListe : array of PaireInfoTel;

-- Traitement
uneListe = lalistePartenaire.Clone(deep=TRUE);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AnnuaireTelephone.GetListePartenaire : End');

-- On renvoie la liste
return uneListe;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'AnnuaireTelephone.GetListePartenaire');
		Raise;
 

end method;

------------------------------------------------------------
method AnnuaireTelephone.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN		30/05/1997		Création
--+

super.Init();

lalisteGroupe = new;
lalisteIndividu = new;
lalistePartenaire = new;

self.ChargementBase();
end method;

------------------------------------------------------------
method PaireInfoTel.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

super.Init();
end method;

------------------------------------------------------------
method TripletInfoTel.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'annuaire';


end Annuaire;
begin TOOL DisplayBD;

includes DataAccessSrvBD;
includes DicoSrvBD;
includes FrameworkBD;
includes DisplayProject;
includes Framework;
includes SystemMonitor;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionMgrDesc;
forward  ActionParamDesc;
forward  AgentFrontCommClt;
forward  ControlWinDesc;
forward  ControlWindow is mapped;
forward  ControlWinNode;
forward  ControlWinRecord;
forward  CtrlTooManyInstanceExc;
forward  DetailAffParamDesc;
forward  FrontCommCltDesc;
forward  LoginWinDesc is mapped;
forward  Logos is mapped;
forward  MenuCtx is mapped;
forward  StandardIcons is mapped;
forward  StandardPictures is mapped;
forward  StandardWin is mapped;
forward  StandardWinRTpl is mapped;
forward  StdBtn is mapped;
forward  Surligneur;
forward  ToolBarModel is mapped;
forward  WindowCount;
forward  WinRecord;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant CTW_ASYNCDISP = 2;
constant CTW_SYNCDISP = 1;
constant DSP_CONSULTCOLOR = 80;
constant DSP_NAVIGCOLOR = 24;
constant DSP_UPDATECOLOR = 43;
constant LOG_GRPFLAG = 2;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ActionMgrDesc inherits from FrameworkBD.ObjectBD

has public  attribute ActionMgrAof: DisplayBD.ActionMgrDesc;
has public  attribute ActionMgrCti: DisplayBD.ActionMgrDesc;
has public  attribute ActionMgrGed: DisplayBD.ActionMgrDesc;
has public  attribute ActionMgrs: Framework.Array of DisplayBD.ActionMgrDesc;
has public  attribute ApplicationName: Framework.string;
has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  attribute InterfaceMgr: DataAccessSrvBD.InterfaceMgrDesc;
has public  attribute MyControlWin: DisplayBD.ControlWinDesc;
has public  virtual attribute SessionUser: DataAccessSrvBD.SessionUserDesc = (set =_SetDummy(), get =Self.MyControlWin.SessionUser);

has public  method _SetDummy;
has public  method Action(input pCommande: DisplayProject.MenuCommand,
	input pObjet: Framework.Object = NIL);
has public  method Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method ActionPourAof(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method ActionPourCti(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method ActionPourGed(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method CheckPreActionAof;
has public  method CheckPreActionCti;
has public  method CheckPreActionGed;
has public  method CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean;
has public  method DetailAff(input DetailWin: Framework.ClassType,
	input unDataContext: DataAccessSrvBD.DataContext = NIL,
	input pCodeAction: Framework.integer = 0,
	input pOrigin: DisplayBD.StandardWin = NIL);
has public  method DetailAff(input DetailWin: Framework.ClassType,
	input ModeAff: Framework.integer,
	input unDataContext: DataAccessSrvBD.DataContext = NIL,
	input pCodeAction: Framework.integer = 0,
	input pOrigin: DisplayBD.StandardWin = NIL);
has public  method DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ActionParamDesc inherits from Framework.Object

has public  attribute CodeAction: Framework.integer;
has public  attribute unObjet: Framework.Object;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AgentFrontCommClt inherits from SystemMonitor.SystemAgent

has public  constant ADMINISTRATION_FRONTCOMM_INST = 1;
has public  constant AVEPROCESSING_FRONTCOMM_INST = 4;
has public  constant INITIALISERINST_CMD = 1;
has public  constant MAXPROCESSING_FRONTCOMM_INST = 2;
has public  constant METHODCALLS_FRONTCOMM_INST = 5;
has public  constant MINPROCESSING_FRONTCOMM_INST = 3;

has public  attribute CommTimeWatch: DataAccessSrvBD.TimeWatch;

has public  method AttachMO(input managedObject: Framework.Object);
has public  method GetMOTypeName: Framework.string;
has public  method Init;
has public  method InitCmdProcessor;
has public  method ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object;
has public  method UpdateInstrument(input inst: SystemMonitor.Instrument);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ControlWinDesc inherits from FrameworkBD.ObjectBD

has public  attribute _InitWin: DisplayBD.StandardWin;
has public  attribute AppIconImage: Framework.ImageData;
has public  attribute ApplicationName: Framework.string;
has private attribute aSequence: FrameworkBD.SequenceDesc;
has public  attribute DictionaryBSMgr: DicoSrvBD.DictionaryBSMgr;
has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  virtual attribute InitWin: DisplayBD.StandardWin = (set =_SetInitWin(InitWin), get =_GetInitWin());
has public  attribute MenuRef: DisplayProject.MenuBar;
has public  attribute MyActionMgr: DisplayBD.ActionMgrDesc;
has public  attribute SessionUser: DataAccessSrvBD.SessionUserDesc;
has private attribute WindowCount: DisplayBD.WindowCount;
has public  attribute Windows: Framework.Array of DisplayBD.ControlWinRecord;

has public  event FermerEvt;

has public  method _GetInitWin: DisplayBD.StandardWin;
has public  method _SetInitWin(input pValue: DisplayBD.StandardWin);
has public  method CalculerNumeroInstance(input pControlWinRecord: DisplayBD.ControlWinRecord): Framework.integer;
has public  method CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean;
has public  method Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input pParent: DisplayBD.StandardWin = NIL);
has public  method Display(input aWindow: DisplayBD.StandardWin,
	input AppName: Framework.string,
	input pParent: DisplayBD.StandardWin = NIL);
has public  method Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input AppName: Framework.string,
	input pParent: DisplayBD.StandardWin = NIL);
has public  method Display(input aWindow: DisplayBD.StandardWin,
	input pParent: DisplayBD.StandardWin = NIL);
has public  method GetMenu(input pName: Framework.string): DisplayProject.Submenu;
has public  method Init;
has public  method InitWindow(input pStandardWin: DisplayBD.StandardWin,
	input pParent: DisplayBD.StandardWin = NIL): DisplayBD.StandardWin;
has public  method MainTaskEventLoop;
has public  method PlaySecurityOnMenu(input pSubMenu: DisplayProject.Submenu): DisplayProject.Submenu;
has public  method Quitter;
has public  method RegisterClose(input aWindow: DisplayBD.StandardWin);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ControlWinNode inherits from DisplayProject.DisplayNode

has public  attribute WindowName: Framework.string;
has public  attribute WinHdle: DisplayBD.StandardWin;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ControlWinRecord inherits from Framework.Object

has public  attribute ClassType: Framework.ClassType;
has public  attribute MaxInstance: Framework.integer;
has public  attribute NumberOfWin: Framework.integer;
has public  attribute Objects: Framework.Array of DisplayBD.WinRecord;
has public  attribute RecClassName: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class CtrlTooManyInstanceExc inherits from FrameworkBD.GenericExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DetailAffParamDesc inherits from Framework.Object

has public  attribute AffMode: Framework.integer;
has public  attribute Origin: DisplayBD.StandardWin;
has public  attribute unDataContext: DataAccessSrvBD.DataContext;
has public  attribute uneDetailWin: Framework.ClassType;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class FrontCommCltDesc inherits from DataAccessSrvBD.ServiceDesc

has public  attribute AgentFComm: DisplayBD.AgentFrontCommClt;
has public  attribute FrontCommSrv: DataAccessSrvBD.FrontCommSrvDesc;
has public  attribute IsUsingFrontCommSrv: Framework.boolean;


has public  method Connect(output SessionId: DataAccessSrvBD.SessionId) where completion = (return = ConnectDone, exception = ConnectExc);
has public  method Connect(input Username: Framework.string,
	input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc) where completion = (return = ConnectUserDone, exception = ConnectUserExc);
has public  method GetRoleLst(input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc;
has public  method Init;
has public  method SplitTimeWatch(input pTimeSplit: Framework.integer);
has public  method StartFrontCommAgent(input pAgentName: Framework.TextData);
has public  method Transfer(input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.BusinessServiceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Transfer(input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.InterfaceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=off);

end class;

class Surligneur inherits from FrameworkBD.ObjectBD

has public  attribute laCouleurDefaut: Framework.integer;
has public  attribute laCouleurSurligne: Framework.integer;
has private attribute laLigneChoisie: Framework.integer;

has public  method GetListeLigneSelectionnee: Framework.integer;
has public  method Init;
has public  method Rafraichir(input output pArrayField: DisplayProject.ArrayField);
has public  method SelectionnerLigne(input output pArrayField: DisplayProject.ArrayField,
	input pNumLigne: Framework.integer);

has public  event handler ColumnTemplateEHdl(input pFieldWidget: DisplayProject.FieldWidget,
	input pTableau: DisplayProject.ArrayField);
has public  event handler SurligneurEHdl(input pTableau: DisplayProject.ArrayField);

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class WindowCount inherits from Framework.Object

has public  attribute Value: Framework.integer;

has public  method Init;

has property
	shared=(allow=on, override=off, default=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class WinRecord inherits from Framework.Object

has public  attribute uneTask: Framework.TaskDesc;
has public  attribute uneWindow: DisplayBD.StandardWin;
has public  attribute unSequenceNumber: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ControlWindow is mapped inherits from DisplayProject.UserWindow

has public  attribute FlatDisplay: Framework.boolean;
has public  attribute MyControlWinDesc: DisplayBD.ControlWinDesc;

has public  method BuildTree(input pParent: DisplayBD.ControlWinNode,
	input pControlWinDesc: DisplayBD.ControlWinDesc);
has public  method Display(input pControlWinDesc: DisplayBD.ControlWinDesc);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

has
+5151463100000491000003aa9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000200000f00000100110001000000000003000021010200000000050400001c
+020606427572656175100506007a08004d009fff010101010f10111201010101
+00009fff010000000d00005dc05dbf000000000303030300020404a0a0000000
+0000000000009d5dc09d5dbf0000000000000108076b010000005dc05dbf0000
+0002010000000009000007000021010200000000080806007c08000d00050547
+72696430010104010f1011120101011700019fff0e0000000d00000cb20fc900
+0000000303030300050404606000002203e807d000009d0cb29d0fc900000000
+000001080910010000000c880fa0000000020100000000040201009fff009fff
+00010100000a0000000404010000020b000c00090000210202000000000b0c0a
+06000302010000000000000b06007a08004d00060650616e656c30010104010f
+1011120101011700029fff0d0000000d00000bb80fa000010001030503030008
+040460600000220bb80fa000009d0bb89d0fa000000000000001080d6301ff81
+000b8e0f760000000201000000000900000d0000210102000000000e0e060103
+080009020a0a57696e4f75746c696e6501020421212121210101011700030e0e
+436f6e74726f6c57696e4e6f64650c0000000d00000b8e0f7600000000030303
+03000b0404a0a0000022000000000f109d0b8e9d0f7600000000000001030202
+06f321110000000005010102022c0f0f00001c0221210a436c697175657a2073
+7572206c612066656eea74726520e02061637469766572221000001c02001011
+00002101020600bc0112120600bc030302000401011300141000001300001c02
+080846656eea74726573101400001c020a0a57696e646f774e616d65100c0600
+f6082089020b0b5374617475735f4c696e652102042121212121010101170005
+080854657874446174610f0000000d009d0bc200c60fa0000200010350030300
+08010480a00000440000000000009cc69d0fa00000000000000103020107003e
+040009ff8100009e004000140301000606005e08002e009fff03030303030303
+030303030300009fff0200000008009fff000000000000000000000002011501
+15000021000200000000151a919c9c9caa9d010a9d01159d01939d019f9d01ab
+9d02119d021c9d028f9d02b89d02bf9d02ca9d02db9d02eb9d02fd9d036f9d03
+a09d03aa40191a38626377919b9c9c9ca09caa9cc89cf29cf39d01079d010a9d
+01149d01159d01389d01629d01639d01779d018e9d01939d019d9d019f9d01ab
+9d01cf9d01f99d01fa9d020e9d02119d021b9d021c9d02529d027c9d027d9d02
+809d02889d028f9d02939d02b89d02bc9d02bf9d02c99d02ca9d02db9d02df9d
+02eb9d02ef9d02fd9d032e9d03599d035a9d035d9d03629d036f9d038d9d039c
+9d039d9d039f9d03a09d03aa9d03aa0301
-027f0571


end class;

class LoginWinDesc is mapped inherits from DisplayProject.UserWindow

has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  attribute MyControlWin: DisplayBD.ControlWinDesc;
has public  attribute Parent: Framework.Object;

has public  method Connect;
has public  method Display;
has public  method DoAfterConnect(input pSessionUser: DataAccessSrvBD.SessionUserDesc);
has public  method GetRoleLst(input pUsername: Framework.string): Framework.Array of Framework.ListElement;
has public  method Init;
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+51514631000012a0000010879fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060100000201
+000100001900000100500001000000000003000021010200000000050400001c
+0205054c6f67696e100506007a08004d009fff010101010f1011120101010100
+009fff010000000d00005dc05dbf000000000303030300020404a0a000000000
+00000000009d5dc09d5dbf000000000000010807680100000000000000000000
+02010000000009000007000021010200000000080806007c08000d0005054772
+696430010104010f1011120101011700019fff0c0000000d000005dc0fc90000
+00000303030300050404606000002205dc07d000009d05dc9d0fc90000000000
+00010809100100000000000000000000020100000000040101009fff009fff20
+010100000a000004040100020b00090000210102000000000b0a060003020100
+00000000000b06007a08004d00060650616e656c30010104010f101112010101
+1700029fff0d0000000d000005b20fa000010001030503030008040460600000
+2203e80fa000009d05b29d0fa000000000000001080c6001ff81000000000000
+00000201000000000900000c0000210102000000000d0d06007c08000d000000
+010104010f1011120101011700009fff0e0000000d9fd79fd705c70fb5000000
+0003512a03000b040460600000220000000000009d05c79d0fb5000000000000
+01080e1001000000000000000000000201000000000402020000000000010100
+000f000000000404000000000210001112130000000e00002103020000000010
+13110f06000302010000000000001006007c08000d000000010104010f101112
+0101011700009fff0f0000000d1f0004500d1a0001000103030303000d040360
+600000220000000000009d04509d0d1a0100000000000108141001ff81000000
+0000000000020100000000040202009fff009fff200101001315000000000404
+000000000216171800191a1b00140000210402000000001618191b1506000302
+010000000028281606009208208102000021210401212121212121212100009f
+ff100000000d9d02af9c9c00d001fe000100010303030300100101a0a0000000
+0000000000009cd09d01fe0000000000000103010b1c0103640100009e004420
+1400000000001c00001c0206064e6f6d203a0a10170600030208000000000000
+180600f6082089020808557365726e616d650102042121212121010101170003
+08085465787444617461110000000d9d050c9c9c00c607bb0001000203050303
+0010010180a00000440000000000009cc69d07bb000000000000010302010700
+1e040009ff8100009e0040001403010019060092082081020000212104012121
+21212121212100009fff120000000d2a9d02b000d00484000200010303030300
+100101a0a00000000000000000009cd09d04840000000000000103010b1d0103
+640100009e0044201400000000001d00001c020f0f4d6f742064652070617373
+65203a0a101a06000302080000000000001b0600f60820890208085061737377
+6f7264010204212121212101010117000408085465787444617461130000000d
+9d050c9d02ba00c607bb00020002030503030010010580a0001e440000001e00
+009cc69d07bb0000000000000103020107001e040009ff8100009e1040001403
+01001e0600b4080009020404526f6c6501020421212121210101011700050707
+496e7465676572160000000d9d050c1f00db07bb000100020305030300130105
+80a0001b220000000000009cdb9d07bb00000000000001030201041f07000000
+03041f00002100020001a6011106007c08000d000000010104010f1011120101
+011700009fff170000000d9d0d8200041c01df0001000203030303000d010160
+600000000000000000009d041c9d01df00000000000001082010010000000000
+0000000000020100000000040201009fff009fff000101000021000000040400
+0000022200230020000021020200000000222321060003020100002828001422
+0601130802010208084c6f67696e42746e01020421212121212121211700069f
+ff180000000d002a01a101a10001000103030303001101018080000000000000
+0000009d01a19d01a100000000000001020124002400010f0001252500011200
+01802020260001082020009d0400000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000004040404040000000000000000000000000000000000000000000000
+0000000404020202010300000000000000000000000000000000000000000000
+0000040402020201030300000000000000000000000000000000000000000000
+0004040202020103030300000000000000000000000000000404040000000000
+0404020202010303030000000000000000000000000000040202020100000004
+0402020201030303000000000000000000000000000000040202020103000404
+0202020103030300000000000000000000000000000000040202020103040402
+0202010303030000000000000000000000000000000000040202020104040202
+0201030303000000000000000000000000000000000000040202020204020202
+0103030300000000000000000000000000000000000000040202020202020201
+0303030000000000000000000000000000000000000000040202020202020103
+0303000000000000000000000000000000000000000000020202020202010303
+0300000000000000000000000000000000000000000000000202020201030303
+0000000000000000000000000000000000000000000000000002010103030300
+0000000000000000000000000000000000000000000000000000030303030000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000026000110000105000fc0c0c0000080008000
+80808000ff0023060113080201020a0a416e6e756c657242746e010204212121
+21212121211700079fff190000000d009d022801a101a1000200010303030300
+11010180800000000000000000009d01a19d01a1000000000000010200270027
+00010f000128280001120001802020290001082020009d040000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000005050505050000000505050505000000000000000000000000000000
+0000000005010101010304000505010101040400000000000000000000000000
+0000000005050101010304040505010104040400000000000000000000000000
+0000000004050501010304050501010304040400000000000000000000000000
+0000000000050501010105050101030404040000000000000000000000000000
+0000000000040505010101010103040404000000000000000000000000000000
+0000000000000205010101010304040400000000000000000000000000000000
+0000000000000005010101030404040000000000000000000000000000000000
+0000000000000505010101010304000000000000000000000000000000000000
+0000000000050501010101010103040000000000000000000000000000000000
+0000000005050101030501010103040400000000000000000000000000000000
+0000000505010103040505010101030404000000000000000000000000000000
+0000050501010304040405050101010304040000000000000000000000000000
+0000050101010304040000050501010103040400000000000000000000000000
+0000000503030304040000000503030303040400000000000000000000000000
+0000000000040404040000000000040404040400000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000029000110000106
+0012c0c0c0800000008080000000808080ff0000120600030206000000000000
+1306007c08000d000000010104010f1011120101011700009fff140000000d1f
+9d045b01430d1a0002000103030303000d040360600000220000000000009d01
+439d0d1a01000000000001082a1001ff81000000000000000002010000000004
+0102009fff009fff20010100102b0000000404000000022c2d1e002a00002102
+02000000002c1e2b06000302010000000028282c060092082081029fff212104
+01212121212121212100009fff150000000d9d02a51f00d00209000100010303
+030300130101a0a00000000000000000009cd09d02090000000000000103010b
+2e0103640100009e0044201400000000002e00001c02070752f46c65203a0a10
+2d06000302080000000000000606005e08002e009fff03030303030303030303
+030300009fff0200000008009fff000000000000000000000002012f012f0000
+210002000000002f1a919c9c9ca99d01099d01149d018e9d01999d01a59d020b
+9d02169d02959d02a29d02ae9d032d9d033b9d03479d03a69d03b49d03c09d04
+309d048e9d04a59d04b19d05229d05829d058c9d06079d06139d061f9d06749d
+067b9d0a8e9d0aa69d0aff9d0b069d0f199d0f349d0f409d0fbb9d0fc79d0fd3
+9d10319d10409d104c9d107d9d10878c191a38626377919b9c9c9ca09ca99cc7
+9cf19cf29d01069d01099d01139d01149d01379d01619d01629d01769d018b9d
+018e9d01989d01999d01a59d01c99d01f39d01f49d02089d020b9d02159d0216
+9d02349d02609d02619d02759d028c9d02959d029f9d02a29d02ae9d02cc9d02
+f69d02f79d030b9d03249d032d9d03379d033b9d03479d03659d03919d03929d
+03949d03a69d03aa9d03b49d03c09d03ee9d041a9d041b9d041e9d04239d0430
+9d044e9d04799d047a9d047c9d048e9d04929d04a59d04b19d04df9d050c9d05
+0d9d05109d05159d05229d054b9d05769d05779d057a9d05809d05829d058c9d
+058c9d05aa9d05d69d05d79d05eb9d06029d06079d06119d06139d061f9d0645
+9d066f9d06709d06749d06789d067b9d06859d0a8e9d0aa69d0ace9d0afa9d0a
+fb9d0aff9d0b039d0b069d0b109d0f199d0f349d0f409d0f5e9d0f8a9d0f8b9d
+0f9f9d0fb69d0fbb9d0fc59d0fc79d0fd39d0ff19d101c9d101d9d101f9d1031
+9d10359d10409d104c9d106a9d10799d107a9d107c9d107d9d10879d10870301
-13e95896


end class;

class Logos is mapped inherits from DisplayProject.UserWindow


has public  method Display;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+5151463100008d3e00008cba9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100000d000001000b0001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005d435d42000000000303030300020404a0a00000000000000000009d
+5d439d5d420000000000000108066b010000005d435d42000000020100000000
+09000006000021020200000000070807060096080081000a0a4d656469756d4c
+6f676f21210421212121212121212100019fff0c0000000d9d03959d06100139
+06c1000000000303030300050101a0a00000000000000000009d01399d06c100
+0000000000010300080900000100000900010f00010a0a0001120001801e9ca6
+0b0001089ca69ca6009d1374edededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededed04040458ed58040404ededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededed0404
+0482ed58040404ededededededededededededededededed04040434ed820404
+04ededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededed8804040458ed58040428ededededededededededededededededed0404
+042eed58040404adeded825c7b88edededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededede987ededede957ededededed
+edededededededededededededededededededededededededededededededed
+edededededededededa604040482ed2e04040aededededededededededededed
+edededed04043434ed58042e0a88eded800000e4edededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededed000001eded00
+00deedededededededededededededededededededededededededededededed
+ededededededededededededededed820a040483ed2e040404ededededededed
+edededededededededed0404ededed58042eedededede40000e4edededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+000024ed880000deedededededededededededededededededededededededed
+edededededede4a6ededededededededededededededed580482eded880404ed
+edededededededededededededededed0a042e82ed88040482ededed5d0000e4
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededed000006edede955ededededededededededededededededededed
+ededededededededededed5c00e9edededededededededededededed88040488
+eded58042eededededededededededededededededed820a0458eded340404ed
+eded7a0000e45d5de9edededededede957e9e9edededed82e9e9ed885de9eded
+edededed885788ede98888eded8887ededed88e988ededededede9e9edededed
+ededededededededede9e9ed000024eded88edededededededed8888edededed
+88e9edededededededed8887edededede90000edededededededed88edededed
+ed8204040aeded3404045eedededededededededededededededededed825e82
+ededed8234ededede9000000000000005dededde000000000000edededde0000
+0700000000ededed8800000000000000deed5d00005ceded4f000087ededde00
+000000deededededededededed3200000000000000edab0000e4ed500000ed00
+0000e9ed5500000000deedededed2c000000000088e9000000000000eded8824
+00000006e9eded882e64ededed523482edededededededededededededededed
+edededededededededededededede40000004f55000000eded0000de80070000
+32eded00000000de2a0000deeded2400002ade000000deede40000e9eded3200
+00eded060000e4570000deededededededed4f000000552a0000deed88000031
+ed310000e4000024ed2c00004fe4de0032ededde000000000000e90700000000
+0000eded000000e4de0000e9ededededededed88edededededededededededed
+edededededededededededededededededededede40000e4edede90000e4edde
+ededed800000e4ededde0000a6eded000001ede90000deeded870000deede400
+00e4eded4f0000a6e9000055ededab0000e9edededededed000000ededed0000
+00eded000050ede4000000dee9e487000031edede90000abed000000edededed
+ededde0000a5ededed010000e9edede400deedededededededededededededed
+edededededededededededededededededededededededededed5c0000e488ed
+ed000000eded5d0000000000deeded060000ededed000000ede400005cededed
+0000deed310000e9eded320000872c0000000000000000e4ededededed880000
+00ededed000000ede90000deedde0000deededede400000000000000007be400
+00e4ededededededde000088ededed000000000000000000edededededededed
+edededededededededededededededededededededededededededededededed
+e400005ceded87000000edde00004fe90000e4eded25000087eded00002aede4
+00007bededed0000deed500000e4ededde0000ede40000e9e9e9e9e9abededed
+ededed87000000ededed00002aeded0000deede40000edededede400004fe9e9
+e9e9e9ede40000deededededededde0000abededed00000080e9e98080e9eded
+edededededededededededededededededededededededededededededededed
+edededededede40000deededde0000e4e9000007ede90000deeded060000eded
+ed000001ede90000deedede90000deede40000e4ed8800000082e9000000eded
+edede9e9edededededed00000082ede9000025ed870000e4edde0000edededed
+e90000deedededededed88000000ededededa5edde0000e9ededed000000e9ed
+ededede9edededededededededededededededededededededededededededed
+edededededededededededede40000000000000000edab000000500100000000
+87250000ededed000024ededde00000001000000deede90000000000000000ab
+edde000000e4320700e9edededededede40000000100000000eded000055ed2c
+0000edededededde0000005d5dde00e9ed2a0000000700005dede40000000100
+edab000000e4e9570000edededededededededededededededededededededed
+edededededededededededededededededede40000000000002487ededde0000
+00de0000002587250000a6ed87000000eded87de000000250000deedede40000
+00dede000082ededde0000000000dea5ededededededed550000002a000000ed
+870000e4edde0000ededededededde0000000000deedededde00000000007aed
+edde00000000edede90000000000007aedededededededededededededededed
+ededededededededededededededededededededededededededededede9eded
+ededededabe9edededabededededabedededededededededededabe9ed880000
+deedededabe9a5edededabededededede9e9e9edededededededededededede9
+e9edabedabedededabedededababedededededededede980a5ededededededed
+e97a88edededededab5780ededededede980e9abedededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededed0000deededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededab0000deededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededab0000deededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededede9a588ededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+0b00011000019d0100009d03000000002c0000560000870000c00000ff000000
+2c002c2c00562c00872c00c02c00ff2c000056002c5600565600875600c05600
+ff56000087002c8700568700878700c08700ff870000c0002cc00056c00087c0
+00c0c000ffc00000ff002cff0056ff0087ff00c0ff00ffff0000002c2c002c56
+002c87002cc0002cff002c002c2c2c2c2c562c2c872c2cc02c2cff2c2c00562c
+2c562c56562c87562cc0562cff562c00872c2c872c56872c87872cc0872cff87
+2c00c02c2cc02c56c02c87c02cc0c02cffc02c00ff2c2cff2c56ff2c87ff2cc0
+ff2cffff2c0000562c0056560056870056c00056ff0056002c562c2c56562c56
+872c56c02c56ff2c560056562c5656565656875656c05656ff56560087562c87
+56568756878756c08756ff875600c0562cc05656c05687c056c0c056ffc05600
+ff562cff5656ff5687ff56c0ff56ffff560000872c0087560087870087c00087
+ff0087002c872c2c87562c87872c87c02c87ff2c870056872c56875656878756
+87c05687ff56870087872c8787568787878787c08787ff878700c0872cc08756
+c08787c087c0c087ffc08700ff872cff8756ff8787ff87c0ff87ffff870000c0
+2c00c05600c08700c0c000c0ff00c0002cc02c2cc0562cc0872cc0c02cc0ff2c
+c00056c02c56c05656c08756c0c056c0ff56c00087c02c87c05687c08787c0c0
+87c0ff87c000c0c02cc0c056c0c087c0c0c0c0c0ffc0c000ffc02cffc056ffc0
+87ffc0c0ffc0ffffc00000ff2c00ff5600ff8700ffc000ffff00ff002cff2c2c
+ff562cff872cffc02cffff2cff0056ff2c56ff5656ff8756ffc056ffff56ff00
+87ff2c87ff5687ff8787ffc087ffff87ff00c0ff2cc0ff56c0ff87c0ffc0c0ff
+ffc0ff00ffff2cffff56ffff87ffffc0ffffffffff0000001111111818181e1e
+1e2525252c2c2c3434343c3c3c4444444d4d4d5656565f5f5f6969697272727d
+7d7d8787879292929d9d9da8a8a8b4b4b4c0c0c0ccccccd8d8d8e5e5e5f2f2f2
+ffffff0000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000080600960800810007074269674c6f676f2121
+0421212121212121212100029fff0d0000000d2a5e03610e3300000000030303
+0300050101a0a00000000000000000009d03619d0e3300000000000001030008
+0c00000100000c00010f00010d0d000112000180539d015d0e0001089d015d9d
+015d009d7127d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7edededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededd7d7d7d7d7
+d7ededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededd7d7d7d7d7d7eded
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededd7d7d7d7d7d7ededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededd7d7d7d7d7d7edededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededd7d7d7d7d7d7ededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededd7d7d7d7d7d7edededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededd7d7d7d7d7d7ededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededd7d7d7d7d7d7edededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededd7d7d7d7d7d7ededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+d7d7d7d7d7d7edededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededd7d7d7
+d7d7d7ededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededededd7d7d7d7d7d7
+edededededededededededededededed0404040404040482ededed5804040404
+04042eededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededed2e0404040404047cededed82040404
+0404042eedededededededededededededededededededd7d7d7d7d7d7ededed
+ededededededededededededed0404040404040483ededed580404040404042e
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededed0404040404040482ededed58040404040404
+2eedededededededededededededededededededd7d7d7d7d7d7edededededed
+edededededededededed040404040404045fededed580404040404042eededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededed880404040404040458ededed580404040404042eeded
+edededededededededededededededededd7d7d7d7d7d7ededededededededed
+ededededededed0404040404040459ededed580404040404042eedededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededed820404040404040482ededed580404040404042eededededed
+ededededededededededededededd7d7d7d7d7d7edededededededededededed
+edededed0404040404040459ededed580404040404040aadedededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededed820404040404040482ededed2e0404040404042eedededededededed
+edededededededededededd7d7d7d7d7d7ededededededededededededededed
+ed0404040404040434ededed5804040404040404adedededededed32de2c2c2c
+32ededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededede9e9e95de988ededededed5707
+2c88edededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ed820404040404040482ededed2e0404040404042eededededededededededed
+ededededededededd7d7d7d7d7d7edededededededededededededededed0404
+04040404042eededed580404040404040489edededededed00000000000088ed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededed870000000000e4ededededde00000000e9
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededed8204
+04040404040483ededed2e0404040404042eedededededededededededededed
+edededededd7d7d7d7d7d7edededededededededededededededed0404040a3a
+3a3a5eededed580404043434343488edededededed000000000000ededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededede90000000000deededede90000000000deededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededededed820a0a0a0a
+04040483ededed2e0a0a0a0404042eededededededededededededededededed
+ededd7d7d7d7d7d7edededededededededededededededed0404042eedededed
+ededed5804040458ededededededededede9000000000000edededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededed87000000000055ededede90000000000deedededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededed88e9ededededed
+ededededededededededededededededededededededededed88888834040404
+83ededed8888885e0404042eedededededededededededededededededededd7
+d7d7d7d7d7edededededededededededededededed0404040482edededededed
+580404042eededededededededede9000000000007ededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededede90000000000deededede90000000000e4ededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededede900deedededededededed
+ededededededededededededededededededededededededed2e04040482eded
+edededed820404042eedededededededededededededededededededd7d7d7d7
+d7d7edededededededededededededededed0a0404042eedededededed820404
+040482ededededededededab000000000000edededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededede9000000000031edededede4000000deabedededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededed88070055ededededededededededed
+ededededededededededededededededededededed820404040483ededededed
+ed2e0404042eedededededededededededededededededededd7d7d7d7d7d7ed
+ededededededededededededededed34040404042e5882ededed882e0404042e
+5882ededededededed000000000000ededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+e900000000004fededededede98080abedededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededde00004fedededededededededededededed
+ededededededededededededededededed822e0404040a88ededededed580404
+04045fedededededededededededededededededededd7d7d7d7d7d7edededed
+edededededededededededed820a040404040483edededed5e0a040404042eed
+edededededed000000000000edededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededededededede90000
+00000055edededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededde00000055ededededededededededededededededed
+edededededededededededed822e040404040434edededed582e040404040a88
+edededededededededededededededededededd7d7d7d7d7d7ededededededed
+edededededededededed880a0404040483ededededed3a0a0404042eedededed
+ededed00000000000088e95de432e4e988ededededededededededed88e95d57
+e4e45de988ededededededededed82e9e9e9e9ededed88e95d5de9ededededed
+edededededededed88e95757e988eded88e988888888edededed8888888787ed
+edededededede9e98888e9edededededededededede9e95de9e9edededededed
+edededededededededededededededededededed87e9e9e988ede90000000000
+deedededed8887ededededededededededededededededed88e982ededededed
+edededed87e9e9e988edededededededededededededededed88888788ededed
+edededededed3200000000deededededededededededededededed888888eded
+ededededededededed8204040404043488edededed58040404040a5eedededed
+ededededededededededededededededd7d7d7d7d7d7edededededededededed
+edededededededed883a0a040483edededededed5e340a042eededededededed
+000000000000070000000000000032edededededededed822c00000000000000
+00002ce9ed88edededede90000000000e4ed32000000000000deedededededed
+ededed880700000000000007e90000000000deededed5d0000000000e4ededed
+edede90000000000e9ededededededed32000000000000002c88edededededed
+ededededededededededededededed5d01000000000000320000000000deeded
+ed880000000000e9edededde00000000deeded88de00000007e9ededededed32
+000000000000dee9ededededededededededed88320100000000000032e9eded
+edede40000000000000000000000deededededededed3201000000000132eded
+edededededed820404040a3a88ededededed580404040a64edededededededed
+edededededededededededededd7d7d7d7d7d7ededededededededededededed
+ededededededed88825e88edededededededed825e3aededededededed000000
+00000000000000000000000001e9edededededde000000000000000000000000
+00e9ededededede4000000000032070000000000000000deededededededede9
+000000000000000000000000000000deededed5d00000000005cededededede9
+0000000000e9ededededed5d0000000000000000000000e4edededededededed
+edededededededededed88de00000000000000000000000000004fededed8700
+00000000e9edededde00000000deede9000000000000e9ededede40000000000
+0000000000deededededededededed2c00000000000000000000005dedede400
+000000000000000000000000ededededed3200000000000000000000e4ededed
+ededed880a343a88ededededededed580a345e88edededededededededededed
+ededededededededededd7d7d7d7d7d7edededededededededededededededed
+edededededededededededededededededededededededededed000000000000
+0000000000000000000001e9ededede90000000000000000000000000000deed
+edededede40000000000000000000000000000000032ededededede900000000
+000000000000000000000000deededede40000000000e4ededededede9000000
+0000e9edededede400000000000000000000000000e4edededededededededed
+edededededed8807000000000000000000000000000000deededed8800000000
+005cedededde000000002ae90700000000002aededed32000000000000000000
+000000deedededededede9de000000000000000000000000e4ed570000000000
+000000000000000000ededed88de00000000000000000000000032ededededed
+ed88edededededededededed8888edededededededededededededededededed
+edededededededd7d7d7d7d7d7ededededededededededededededededededed
+ededededededededededededededededededededededed00000000000000dee4
+e455000000000000deededede900000000dee480e4de00000000000088ededed
+ede40000000000000000de4f2a000000000000e9ededededde0000000000002a
+dede00000000000000deededed5d0000000000e4ededededede90000000000e9
+ededede9000000000000e4e9e9e40000000000e9edededededededededededed
+edededde000000000000de554f2a00000000000055ededed8700000000005ced
+ededde0000000006e4000000000000e4edede400000000002a7ae9e4de000000
+0032edededededde00000000000000000000000000e4edde0000000000000000
+00000000002aededed2c00000000002ae480550000000000e4ededededededed
+edededededededededededededededededededededededededededededededed
+ededededd7d7d7d7d7d7edededededededededededededededededededededed
+edededededededededededededededededededed000000000000e9edededede9
+000000000000e9edede900007aabedededed88de0000000000e9edededede400
+0000000000deabedededde0000000000e9ededede900000000000080edededed
+800000000000deededede400000000005cededededede90000000000e9ededed
+000000000000e9edededede900000000deedededededededededededededede9
+00000000000080edededab800000000000deededed88000000000080edededde
+000000000000000000000000e9ede9000000000024edededededde00000000e9
+ededede40000000000000080abedede9e424e9ededabe90000000000deededed
+abedededede90000000000deedededed870000000000abededededededededed
+edededededededededededededededededededededededededededededededed
+edd7d7d7d7d7d7ededededededededededededededededededededededededed
+edededededededededededededededede9000000000000edededededede40000
+000000e4eded88dee9edededededed87e40000000000e9edededed5d00000000
+002aededededede90000000000e4edededde0000000000e4ededededed870000
+000000deededede40000000000e4ededededede90000000000e9edede9000000
+000055ededededededde00000000e9edededededededededededededde000000
+0000e4ededededede90000000000deededed880000000000e4edededde000000
+00000000dee9e9e955eded320000000000e9ededededede900000000deededed
+010000000000deedededededededededededede9000000000055edededededed
+eded010000000000e9ededededede900000000e4edededededededededededed
+ededededededededededededededededededededededededededededededd7d7
+d7d7d7d7edededededededededededededededededededededededededededed
+edededededededededededededed000000000000ededededededed0000000000
+06ededededededed88e9320700000000000000e9edededede40000000000e4ed
+edededede90000000000e4ededed000000000000ededededededed0000000000
+deededede40000000000e4ededededede40000000000e9ededde000000000000
+dededededede0700000000deededededededededededededed000000000000ab
+ededededede90000000000deededede900000000005cedededde000000000000
+7aedededededed88000000000000dedededededede000000000087ede4000000
+00002aededededededededededededede90000000000e4ededededededede900
+0000000000de2c2c32322cde0000000000ededededededededededededededed
+edededededededededededededededededededededededededededd7d7d7d7d7
+d7ededededededededededededededededededededededededededededededed
+ededededededededededed000000000000eded88ededed88de000000000088ed
+eded88e9320000000000000000000000e9edededede40000000000e4edededed
+ede90000000000e4edede90000000000deededededededed0000000000deeded
+ede40000000000e4ededededede900000000005deded01000000000000000000
+0000000000000000deedededededededededededed88000000000000edededed
+edede90000000000deededede90000000000e4edededde0000000000deededed
+edededede9000000000000000000000000000000000000e9ede4000000000055
+ededededededededededededede9000000000055ededededededede900000000
+000000000000000000000000000087ededededededededededededededededed
+ededededededededededededededededededededededededd7d7d7d7d7d7eded
+edededededededededededededededededededededededededededededededed
+edededededededab000000000000edededededededde0000000000e988ede932
+000000000000002a0000000000e9edededede40000000000e4ededededede900
+00000000e4edede90000000000deededededededed0000000000deededede400
+00000000e4ededededed5d00000000005ceded00000000000000000000000000
+00000000002aedededededededededededede900000000002aedededededede9
+000000000055ededede90000000000e4edededde0000000000e9edededededed
+ede9000000000000000000000000000000000000e9edde0000000000e4ededed
+edededededededededede90000000000e4ededededededed5d00000000000000
+0000000000000000000000e9edededededededededededededededededededed
+edededededededededededededededededededededd7d7d7d7d7d7ededededed
+edededededededededededededededededededededededededededededededed
+edededede9000000000006edededededed87000000000000edede9de00000000
+002480e9e40000000000e9edededede40000000000e4ededededede900000000
+00e4edede90000000000deededededededed0000000000deededede400000000
+00e4e9edededede900000000005dededde0000000000e9e9e9e9e9e9e9e9e9e9
+a587abedededededededededededed87000000000000edededededede9000000
+000055ededed870000000000e4edededde00000000deedededededededede900
+0000000000e9e9e9e9e9e9e9e9e9e9e9e9edede40000000000deedededededed
+ededededededede90000000000deededededededede90000000000de8080e980
+e9e98080808080e9edededededededededededededededededededededededed
+ededededededededededededededededededd7d7d7d7d7d7edededededededed
+edededededededededededededededededededededededededededededededed
+ede900000000000088ededededede40000000000deedede400000000005587ed
+87e40000000000e988ededede40000000000e4ededededede90000000000e4ed
+eded000000000000e9edededededed0000000000deededede40000000000e4ed
+edededed5c0000000000e9edede40000000000e4edededededededededededed
+ededededededededededededed000000000000e9ededededede9000000000031
+ededede9000000000080edededde000000002aededededededededed00000000
+0000edededededededededededededede4000000000000ededededededededed
+edededede90000000000deededededededede90000000000deededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededd7d7d7d7d7d7ededededededededededed
+edededededededededededededededededededededededededededededed8700
+0000000000e9edededededde0000000000e4ede9de0000000000e9ededede400
+00000000e9edededede40000000000e4ededededede90000000000e4edededde
+0000000000e4edededededed0000000000de88edede40000000000deedededed
+88070000000000e9edede9000000000000e9ededededededededede9e9ededed
+ededededededededededde000000000032ededededede900000000004fededed
+e9000000000080edededde00000000deededededededededed550000000000e4
+edededededededededede9eded88000000000000e4ededededededededededed
+ede9000000000000edededededededed000000000000e9ededededededededed
+ede9edededededededededededededededededededededededededededededed
+ededededededededededededd7d7d7d7d7d7edededededededededededededed
+ededededededededededededededededededededededededededed8700000000
+0000075de9e9e9de000000000000e9abe9000000000000e9edede92c00000000
+00e4e957e9ede40000000000e4ededededede90000000000e4ededede9000000
+000000e488edede9e40000000000deededede9000000000000e9e988e9070000
+00000000e9ededab240000000000dee9edededededed88e400e4edededededed
+ededededededede9000000000000e4ededede93200000000004fededed880000
+00000080edededde00000000deededededededededede9000000000000e4eded
+ededededed882c00edededde000000000000e488edededed825de4ededed8800
+0000000000e9ededede9e4edede40000000000de87ededededededede93224ed
+edededededededededededededededededededededededededededededededed
+edededededededededd7d7d7d7d7d7ededededededededededededededededed
+edededededededededededededededededededededededede900000000000000
+00000000000000000000e4ededabde00000000000157e4010000000000000000
+005cede40000000000e4ededededede90000000000e4ededededde0000000000
+0000000100000000000000deededede900000000000000000000000000000000
+00e9ededede9000000000000002c5de95d5707000000e4ededededededededed
+edededededde0000000000000001010000000000000055ededed870000000000
+80edededde00000000deededededededededededde000000000000dee9888888
+5dde000000edededed000000000000000007de07000000deededededde000000
+0000000001000000ededed24000000000000e488eded88e9de000000edededed
+edededededededededededededededededededededededededededededededed
+ededededededd7d7d7d7d7d7edededededededededededededededededededed
+ededededededededededededededededededededed8700000000000000000000
+00000000000055edededede40000000000000000000000000000000000005c88
+e40000000000e4ededededede90000000000e4ededededabde00000000000000
+0000000000000000deedededede400000000000000000000000000000000e9ed
+ededede4000000000000000000000000000000e4edededededededededededed
+ededab2a000000000000000000000000000000deededede900000000005ceded
+edde00000000deedededededededededededde00000000000000000000000000
+0000edededede900000000000000000000000000deedededede9000000000000
+0000000000ededede900000000000000000000000000000000ededededededed
+edededededededededededededededededededededededededededededededed
+edededd7d7d7d7d7d7ededededededededededededededededededededededed
+edededededededededededededededededede900000000000000000000000000
+00005587edededed87de0000000000000000de0000000000000000e9ede40000
+000000e4ededededede90000000000e4ededededed87de000000000000000000
+0000000000deededededab550000000000000000dee40000000000e9edededed
+ed7a000000000000000000000000004fe9ededededededededededededededed
+e9de000000000000000000000000000055ededed870000000000e9edededde00
+000000deedededededededededededed55000000000000000000000000247aed
+edededede92a0000000000000000000000deededededede40000000000000000
+0000edededede92a000000000000000000000000247aedededededededededed
+edededededededededededededededededededededededededededededededed
+d7d7d7d7d7d7edededededededededededededededededededededededededed
+ededededededededededededededed87de2a2a242adee9552a00000000dee9ed
+ededededededab4f00000000244fe9ab7a00000000dee4e9edede92424242a24
+e9ededededede92424000024e4ededededededed80de0000000000dee4000000
+0000deedededededed7ade0000000024e487e90000000000e9ededededededab
+e4de00000000000000de55e9abedededededededededededededededededabe4
+2a000000000055e9000000000055edededed0000000000e9edededde00000000
+deededededededededededededede9de0000000000000000de7aabededededed
+ededede4de00000000000000244fe9edededededed80de0000000000002ae4ed
+ededededede4de0000000000000000dee4ededededededededededededededed
+edededededededededededededededededededededededededededededd7d7d7
+d7d7d7ededededededededededededededededededededededededededededed
+ededededededededededededededededededededededa5e9e9ededededededed
+ededededededabe9abededededededababededededededededabedededededed
+edededededededededededededededededededaba5e9e9ededed0000000000de
+ededededededededabe9e9a5abedededededededabededededededededededed
+e9e9e9e9e9abedededededededededededededededededededededededede9e9
+80e9edededababedababedededededededabededededededededabedababeded
+edededededededededededededede97a7a80e9abedededededededededededed
+ededede980e47ae9ededededededededededededab80e47a80abedededededed
+ededededab80e4e47a80abededededededededededededededededededededed
+ededededededededededededededededededededededededededd7d7d7d7d7d7
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededed880000000000deededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededd7d7d7d7d7d7ededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededed0000000000deedededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededd7d7d7d7d7d7edededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededed0000000000deededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededd7d7d7d7d7d7ededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededed0000000000deedededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededd7d7d7d7d7d7edededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededab0000000000deededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededd7d7d7d7d7d7ededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededed0000000000deedededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededd7d7d7d7d7d7edededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededab0000000000deededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededd7d7d7d7d7d7ededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededabe9e9a5e9e9edededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededd7d7d7d7d7d7edededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededd7
+d7d7d7d7d7ededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededededededededd7d7d7d7
+d7d7edededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededd7d7d7d7d7d7ed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededededededededd7d7d7d7d7d7edededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededd7d7d7d7d7d7ededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededededededededd7d7d7d7d7d7edededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededd7d7d7d7d7d7ededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededededededededd7d7d7d7d7d7edededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededd7d7d7d7d7d7ededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+edededededededededededededededededededededededededededededededed
+ededededd7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7592f2f2f2f83d7d7d7d7d7d7
+5959d7d7d7d7d7d7d7592f2f2fadd7d7d7d7d7d7d7d7d7592f2f2f59d7d7d7d7
+d72f2f2f2f2f59d7d7d7832f2f2f83d7d7d7d7d783592f2f2f59b3d7d7d7d7d7
+5383d7d7d78359d7d7d7d7d7d75983d7d7d7d7d7d7d7d7d7832f2f2f595983d7
+d7d7d7d7d7592f2f2f2fadd7d7d7d7d7d7d7d7d7592f2f59d7d7d7d7592f2f2f
+2f83d7d7d7d7d7d7d7d759add7d7d7d7d759add7d7d7d7ad592f2f5983d7d7d7
+d7d7d759add7d7d78359595983d7d7d7d7d7d7d7d7d7d7d7ad59595959b3d7d7
+d7d7d7d78359595983d7d7d7d7d7d759add7d7d7d7d759add7d7d77d595983ad
+d7d7d7d7d7d7d7d7d7d7d7d7835959add7d7d7ad83d7d7d7d75959595959d7d7
+d7ad83d7d7d7d7d7d7a7a7d7d7d77d59597d59595983d7d7d783837d8383add7
+d7d783add7d7d7d7d7ad83d7d7d7d78383838383add7d7d7d7d7d7ad838383d7
+d7d7d7d7d7d78383838383d7d7d7d7d7d7592f65653b2fd7d7d7d7d7d12f2ead
+d7d7d7d7d7832f65653b83d7d7d7d7d7d7d7d7d72f35655f2f59d7d7d7d72f35
+6565658fd7d7ad2f3b653b5fd7d7d7d7590a3565653b2f2fadd7d7d7d72f5fd7
+d7d759042fd7d7d7d7d72f83d7d7d7d7d7d7d7d7d7592f65653b3b2f59d7d7d7
+d7d72f3b656565b3d7d7d7d7d7d7d7d77d2e3b3b35add7d7d72f353b3b3b89d7
+d7d7d7d7d7d7d7352fd7d7d7d7592fb3d7d7d75f2f113b3b3b0b2fd7d7d7d7d7
+2fadd7d7d7592f3b3b2f59d7d7d7d7d7d7d7d7d7d7830b3b3b352fadd7d7d7ad
+2f0b353b350b2fadd7d7d7d72f83d7d7d7d7d72fadd7d7d72f2f3b352fa7d7d7
+d7d7d7d7d7d7d7d7592f3b3b2fd7d7d75f2fd7d7d7ad0b353b3b3bd7d7d7ad0b
+53d7d7d7d7d75959d7d7d73b3b350b3535353bd7d7d72f35353b3b89d7d7d72f
+2fadd7d7d7d7832fd7d7d7b30b353535352f59add7d7d7d7830b35352fa7d7d7
+d7d7b30a35353535b3d7d7d7d7d75935d7d7b32f89d7d7d7d75935352fd7d7d7
+d7d7592fd7d7d7d7d7d7d7d7d7d7d7d7d72f59d7d75f2fd7d7d7d72f83d7d7d7
+d7d7d7ad2fb3d7d7b3d7d7d7830b65d7d7d7d78f352fd7d7d7d72f83d7d7d759
+0b2f2fd7d7d7d72f83d7d7d7d7d7d7d7d7d75935d7d7d7d7890b59d7d7d7d72e
+add7d7d7d7d7d7d7d7d7d7d7d73559d7d7d7d7d7d7d72f5fd7d7d7d7d7d7d7d7
+d7d7d7d7890badd7d7d72e5fd7d7d7830b5fb3d7d7d78f0b59d7d7d7d72fadd7
+d7d75959d7d7352fd7d7d7d7d7d7d7d7d7d7832fd7d7b32f83d7d7d72f358fd7
+d7d78f352fd7d7d7d72f83d7d7d7d7d72fadd7d7d72f59d7b3352fd7d7d7d7d7
+d7d7d7d7d72f89d7d78fd7d7d7b335d7d7d7ad2fd7d7d7d7d7d7d7ad0b0b59d7
+d7d7d75959d7d7d7d7d7b32f89d7d7d7d7d7d72f89d7d7d7d7d7d7d72f0b2fad
+d7d7d7832fd7d7d7b32fb3d7d7b38f352fd7d7d7d7832fd7b3352fd7d7d7d7b3
+0badd7d7d7d7d7d7d7d7d7592fd7b3592fb3d7d7d7d72e89890aadd7d7d7d789
+0a2fadd7d7d7d7d7d7d7d7d7d7d72f59b3892f5fd7d7d7d72f5fd7d7d7d7d7d7
+b30b2fadd7d7d7d7d72f35d7d7d7d7d7d7890aadd7d7d72f83d7d7d7592f8f2f
+2fd7d7d72f83d7d7d7d7d7d7d7d7d75935d7d7d7d7d75f0bd7d7d7d72f89d7d7
+d7d7d7d7d7d7d7d7d7d75f0a59d7d7d7d7d7d72f59d7d7d7d7d7d7d7d7d7d7d7
+d7d7352fd7d7830ad7d7d7d72f35d7d7d7d7d7d7890bd7d7d7d72fadd7d7d759
+59d7d7352fd7d7d7d7d7d7d7d7d7d7832fd7d7d72f83d7d7830bb3d7d7d7d7d7
+b30b83d7d7d72f83d7d7d7d7d72fadd7d7d72f59d7d72f2fd7d7d7d7d7d7d7d7
+d7d7352fd7d7d7d7d7d78fb3d7d7d7ad2fd7d7d7d7d7d7d7ad2f8f0b59d7d7d7
+5959d7d7d7d7d7d72f89d7d7d7d7d7d72f89d7d7d7d7d7d7d72f65352fd7d7d7
+832fd7d7d7b32fb3d7d7d7d7b32f83d7d7d7832fd7d7592fd7d7d7d7b30badd7
+d7d7d7d7d7d7d7d7590b2f2f2f65d7d7d7d7832fb3d7352fd7d7d7d7d78f352f
+59d7d7d7d7d7d7d7d7d7d72f0b2f0b0b5fd7d7d7d72f0a2f2f2f83d7d7d78f35
+2f59d7d7d7d72f5fd7d7d7d7d7d7d72f83d7d7d72f83d7d7d7592fd78f0b2fd7
+d72f83d7d7d7d7d7d7d7d7d75935d7d7d7d7d7ad0badd7d7d72f2f2f2f2fadd7
+d7d7d7d7d7d7d7d7410b2f83d7d7d7d72f0b2f2f2f83d7d7d7d7d7d7d7d7d789
+0badd72f5fd7d7d7d72f83d7d7d7d7d7d7d72fadd7d7d72fadd7d7d7590b2f2f
+0b65d7d7d7d7d7d7d7d7d7d783052f2f2f0bb3d7d7592fd7d7d7d7d7d7d72f59
+d7d7d72f83d7d7d7d7d72fadd7d7d72f2f2f2f0b8fd7d7d7d7d7d7d7d7d7d78f
+112f59d7d7d7d7d7d7d7d7d7ad0b2f2f2f59d7d7d7ad2fd78f0b59d7d75959d7
+d7d7d7d7d72f89d7d7d7d7d7d72f2f2f5353add7d7d72fadb3352fd7d7832fd7
+d7d7b32fb3d7d7d7d7d75959d7d7d7830b532f0b65d7d7d7d7ad0b2f535359d7
+d7d7d7d7d759358fb3b3d7d7d7d7d72e0b2f2f2f0badd7d7d7d7d7b3652f59d7
+d7d7d7d7d7d7d7d72f358f8f652f83d7d7d72f5f8f8f8fb3d7d7d7d7d7650b59
+d7d7d72f59d7d7d7d7d7d7ad0b89d7d7d72f83d7d7d7592fd7d78f2f59d72f83
+d7d7d7d7d7d7d7d7d75935d7d7d7d7d7830bd7d7d7d72f5f8f8f8fd7d7d7d7d7
+d7d7d7d7d7d78f352fadd7d7d72f35656565b3d7d7d7d7d7d7d7d7d7d72f5983
+2fd7d7d7d7d72f83d7d7d7d7d7d7d70badd7d7d72fadd7d7d7592f65352fadd7
+d7d7d7d7d7d7d7d7d7830b65656bb3d7d7d7592fd7d7d7d7d7d7d72f59d7d7d7
+2f83d7d7d7d7d72fadd7d7d72f2f41112fd7d7d7d7d7d7d7d7d7d7d7d7b3410b
+53d7d7d7d7d7d7d7d7ad0b3b414165d7d7d7ad2fd7d7890b59d75959d7d7d7d7
+d7d72f89d7d7d7d7d7d72f353b3b41b3d7d7d72fadd7b3352fd7832fd7d7d7b3
+2fb3d7d7d7d7d75959d7d7d7830b3b0b2fb3d7d7d7d7ad0b3b3b3b3bd7d7d7d7
+d7d75935d7d7d7d7d7d7d7832f656565653535d7d7d7d1d7d7d75f2fd7d7d7d7
+d7d7d7d7d72f5fd7d7d7352fd7d7d72f83d7d7d7d7d7d7d7d7d7d75f2fd7d7d7
+5f0badd7d7d7d7d7592fd7d7d7d72f83d7d7d7592fd7d7d78f2f592f83d7d7d7
+d7d7d7d7d7d75935d7d7d7d7d72f35d7d7d7d72fadd7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d73559d7d7d72f83d7d7d7d7d7d7d7d7d7d7d7d7d7d7890b2f5fd7d7
+d7d7d7352fadd7d7d7d7d7592fd7d7d7d72fadd7d7d75959d7b3352fd7d7d7d7
+d7d7d7d7d7d7832fd7d7d7d7d7d7d7890b83d7d7d7d7d7ad0b89d7d7d72f83d7
+d7d7d7ad0bb3d7d7d72f59d78f2f59d7d7d7d7d7d7d7d7d7d7d7d7d78f2fadd7
+d7d7d7d7d7d7ad2fd7d7d7d7d7d7d7892fd7d7d7890b593559d7d7d7d7d7d72f
+89d7d7d7d7d7d72f89d7d7d7d7d7d7d72fadd7d7b30b595f2fd7d7d7b32fb3d7
+d7d7d7ad2f5fd7d7d7832fd78f2f59d7d7d7d7b30bb3d7d7d7d7d7d7d7d7d759
+35d7d7d7d7d7d7d72f35d7d7d7d7892fadd7d75959adad2f35d7d7d7d7d7d7d7
+d7d72f59adad830b3bd7d7d72f59adadadd7d7d7ad53adad5935d7d7d7b3352f
+59add7ad2f0b65d7d7d7d72f83d7d7d7592fd7d7d7d7890b0b83d7d7d7d7d7d7
+d7d7d7592fd7d7ad832f2fb3d7d7d7d72f83d7d7d7d7d7d7d7d7d7d7d7d75989
+d7b32f5fd7d7d72f59d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7350bb3d7d7d7d7d7
+b32f2f83d7d7ad530b89d7d7d7d72fadd7d7d75959d7d7b32f59d7d7d7d7d7d7
+d7d7d7832fd7d7d7d7d7d7d7d7352f83d7d7d7832f35d7d7d7d7352fadd7d7d7
+592fd7d7d7d72f59d7d78f0b83d7d7d7d7d7d7d7d7d783d7d7b32f89d7d7d7d7
+d7d7d7ad2fd7d7d7d7d7d7d7ad2fd7d7d7d7650b0559d7d7d7d7d7d72f89d7d7
+d7d7d7d72f89d7d7d7d7d7d7d72fadd7d7d78f2f0b2fd7d7d7b30badd7d7d7ad
+2f35b3d7d7d7832fd7d7890b83d7d7d7b30badd7d7d7d7d7d7d7d7d75959d7d7
+d7d7d7d7ad2fb3d7d7d7d7d73559d7d78f352f2f35b3d7d7d7d7d7d7d7d7d72f
+0b0b0b0b3bd7d7d7d72f0b0b0b0b2fd7d7b3350b0b358fd7d7d7d7b3410b0b0b
+0b358fd7d7d7d7d72f83d7d7d7592fd7d7d7d7d7890b83d7d7d7d7d7d7d7d7d7
+590b0b0b0b0b3bb3d7d7d7d7d72f0b2f0b2f83d7d7d7d7d7d7d7d75f0b2f0b35
+b3d7d7d72f0b0b0b2f59d7d7d7d7d7d7d7d7d7d7d7655fd7d7d7d7d7d7d78f35
+0b2f2f0b0b65d7d7d7d7d72fadd7d7d75959d7d7d7890b83d7d7d7d7d7d7d7d7
+832fd7d7d7d7d7d7d7d7b33b0b2f2f2f0b3bb3d7d7d7d7b33b0b2f2f2f0b8fd7
+d7d7d72f59d7d7d73b2fadd7d7d7d7d7d7d7d72f2f2f2f35d7d7d7d7d7d7d7d7
+ad0b2f2f2f2fadd7d7ad2fd7d7d7d7d7650b59d7d7d7d7d7d72f89d7d7d7d7d7
+d72f2f2f2f2f59d7d7d72fadd7d7d7d78f0b2fd7d7d7b30b2f2f2f2f0b35b3d7
+d7d7d7832fd7d7d75f2fb3d7d7b30b2f2f2f2fadd7d7d7d7d7d7d7d7d7d7d7d7
+d7d7b3d7d7d7d7d7d7d7b3d7d7d7d7b3b3d7d7d7d7d7d7d7d7d7d7d7b3b3b3b3
+b3d7d7d7d7d7b3b3b3b3b3b3d7d7d7d7b3b3b3d7d7d7d7d7d7d7b38f8fb3d7d7
+d7d7d7d7d7b3d7d7d7d7b3b3d7d7d7d7d7d7b3d7d7d7d7d7d7d7d7d7d7b3b3b3
+b3b3b3d7d7d7d7d7d7d7b38f8f8f8fb3d7d7d7d7d7d7d7d7d7b38f8fd7d7d7d7
+d7b38f8f8f8fb3d7d7d7d7d7d7d7d7d7d7d7d7b3d7d7d7d7d7d7d7d7d78f6565
+8fb3d7d7d7d7d7d78fd7d7d7d7b3b3d7d7d7d78f8fd7d7d7d7d7d7d7d7b38fd7
+d7d7d7d7d7d7d7d7d7b3656565b3d7d7d7d7d7d7d7d78f65658fb3d7d7d7d7d7
+8f8fd7d7d7d76bb3d7d7d7d7d7d7d7d7b3656565b3d7d7d7d7d7d7d7d7b36565
+656565b3d7d7b365d7d7d7d7d7d78f8fd7d7d7d7d7d765b3d7d7d7d7d7d76565
+65656589d7d7d765b3d7d7d7d7d78f65d7d7d7d765414165658fd7d7d7d7d7d7
+b365d7d7d7d7658fd7d7d74141414165b3d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7d7
+d7d7d7d7d7d7d7d7d7d7d7d7d70e00011000019d0100009d03000000002c0000
+560000870000c00000ff0000002c002c2c00562c00872c00c02c00ff2c000056
+002c5600565600875600c05600ff56000087002c8700568700878700c08700ff
+870000c0002cc00056c00087c000c0c000ffc00000ff002cff0056ff0087ff00
+c0ff00ffff0000002c2c002c56002c87002cc0002cff002c002c2c2c2c2c562c
+2c872c2cc02c2cff2c2c00562c2c562c56562c87562cc0562cff562c00872c2c
+872c56872c87872cc0872cff872c00c02c2cc02c56c02c87c02cc0c02cffc02c
+00ff2c2cff2c56ff2c87ff2cc0ff2cffff2c0000562c0056560056870056c000
+56ff0056002c562c2c56562c56872c56c02c56ff2c560056562c565656565687
+5656c05656ff56560087562c8756568756878756c08756ff875600c0562cc056
+56c05687c056c0c056ffc05600ff562cff5656ff5687ff56c0ff56ffff560000
+872c0087560087870087c00087ff0087002c872c2c87562c87872c87c02c87ff
+2c870056872c5687565687875687c05687ff56870087872c8787568787878787
+c08787ff878700c0872cc08756c08787c087c0c087ffc08700ff872cff8756ff
+8787ff87c0ff87ffff870000c02c00c05600c08700c0c000c0ff00c0002cc02c
+2cc0562cc0872cc0c02cc0ff2cc00056c02c56c05656c08756c0c056c0ff56c0
+0087c02c87c05687c08787c0c087c0ff87c000c0c02cc0c056c0c087c0c0c0c0
+c0ffc0c000ffc02cffc056ffc087ffc0c0ffc0ffffc00000ff2c00ff5600ff87
+00ffc000ffff00ff002cff2c2cff562cff872cffc02cffff2cff0056ff2c56ff
+5656ff8756ffc056ffff56ff0087ff2c87ff5687ff8787ffc087ffff87ff00c0
+ff2cc0ff56c0ff87c0ffc0c0ffffc0ff00ffff2cffff56ffff87ffffc0ffffff
+ffff0000001111111818181e1e1e2525252c2c2c3434343c3c3c4444444d4d4d
+5656565f5f5f6969697272727d7d7d8787879292929d9d9da8a8a8b4b4b4c0c0
+c0ccccccd8d8d8e5e5e5f2f2f2ffffff00000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000e1a919c9c9c
+a39d01039d010f9d016f9d01769d15009d180d9d18669d186d9d89ad9d8cba26
+191a38626377919b9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d010f
+9d01379d01659d01669d01689d016f9d01739d01769d01819d15009d180d9d18
+329d185c9d185d9d185f9d18669d186a9d186d9d18799d89ad9d8cba0301
-641e68dd


end class;

class MenuCtx is mapped inherits from DisplayProject.UserWindow



has public  method Display: DisplayProject.MenuCommand where completion = (return = DisplayDone, exception = DisplayExc);
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+5151463100000391000002f59fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000400000301
+000100000e00000100010001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b010000005dc05dbf000000020100000000
+09000006000021010200000000070706007c08000d000b0b4d656e7543747847
+726964010104010f1011120101011700019fff0c0000000d0000018c02e40000
+0000030303030005010160600000220000000000009d018c9d02e40100000000
+000108081001ff8100016202ba000000020100000000040301009fff009fff20
+010100000900000000040400000000020a000b000c0008000021030200000000
+0c0b0a0906000302010000000000000a0600920820810206064d6f64436d6423
+210401212121212121212100049fff0d0000000d0000009c02ba000100010303
+030300070101a0a00000000000000000009c9c9d02ba0000000000000103010b
+0d020100009e0044201400000000000d00001c020c0c54657874204772617068
+6963100b0600f6082089020a0a4d6f64436d645f4f4c44230204212121212101
+01011700030606537472696e670d0000000d009ca7009c02ba00020001035103
+030007010480a00000440000000a00009c9c9d02ba0200000000000103020107
+000a040009000000009e004000140301000c06009c0800810006064d6f645365
+7023210d21212121212121212100029fff0e0000000d9cd09d01580001011b00
+0300013e500303000701018080000022000000000000019d011b000000000000
+01030001009f8101029cd09d01589d01ea9d0158010d1a919c9c9ca39d01039d
+010e9d01969d01a39d01af9d020f9d02239d02919d02f52f191a38626377919b
+9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d010e9d01379d01619d01
+629d01769d018f9d01969d01a09d01a39d01af9d01d39d01fc9d01fd9d01ff9d
+020f9d02139d02239d02519d027b9d027c9d027f9d02849d02919d02b59d02e0
+9d02e19d02e39d02e79d02f49d02f50301
-016c9583


end class;

class StandardIcons is mapped inherits from DisplayProject.UserWindow


has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+51514631000005d1000005779fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100000c000001000b0001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b0100000000000000000000020100000000
+09000006000021010200000000070706009608008100070741707049636f6e21
+210421212121212121212100019fff0c0000000d9d010f9cd0008700bb000000
+000329030300050101a0a0000000000000000000879cbb000000000000010300
+080800000100000800010f000109090001120001800d120a0001081212009cea
+ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
+ffffffffffff000000ffffffffffffffffffffffffffff00fbfffb0000000000
+0000ffffffffffffff00fffbfffbfffbfffbff00ffffffffffffff00fbfffbff
+fbfffbfffb00ffffffffffffff00fffbfffbfbfbfbfbfb00ffffffffffffff00
+fbfffbfffbfffffbfb00ffffffffffffff00fffbfffffffbfbffff00ffffffff
+ffffff00fbfbfbfbfbfbfbfbfb00ffffffffffffff00fbfffbfffbfffbff00ff
+ffffffffffffff000000000000000000ffffffffffffffffffffffffffffffff
+ffffffffffffffffffff0a00011000019d0100009d0300000000bf000000bf00
+bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000fffbf0a0a0a480
+8080ff000000ff00ffff000000ffff00ff00ffffffffff0a1a919c9c9ca39d01
+039d010e9d01679d016e9d026a9d05771c191a38626377919b9c9c9ca09ca39c
+c19ceb9cec9d01009d01039d010d9d010e9d01339d015d9d015e9d01609d0167
+9d016b9d016e9d01789d026a9d05770301
-02e52b0a


end class;

class StandardPictures is mapped inherits from DisplayProject.UserWindow


has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+515146310000c8f60000c2879fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+0001000031000001000b0001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b010000005dc05dbf000000020100000000
+090000060000212602000000000708090a0b0c0d0e0f10111213141516171819
+1a1b1c1d1e1f202122232425262728292a2b2c07060096080081000e0e46696c
+654f70656e53796d626f6c21210421212121212121212100019fff0c0000000d
+9d01772a007d00bb000000000303030300050101a0a00000000000000000007d
+9cbb000000000000010301082d00000100002d00010f00012e2e000112000180
+0c122f0001081212009cd8ffffffffffffffffffffffffffffffffffffffff00
+0000ffffffffffffffffffffffffffff00fbfffb00000000000000ffffffffff
+ffff00fffbfffbfffbfffbff00ffffffffffffff00fbfffbfffbfffbfffb00ff
+ffffffffffff00fffbfffb0000000000000000000000ffff00fbfffb00030303
+03030303030300ffffff00fffb0003030303030303030300ffffffff00fb0003
+030303030303030300ffffffffff000003030303030303030300ffffffffffff
+0000000000000000000000ffffffffffffffffffffffffffffffffffffffffff
+ffffff2f00011000019d0100009d0300000000bf000000bf00bfbf000000bfbf
+00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000fffbf0a0a0a4808080ff000000ff
+00ffff000000ffff00ff00ffffffffff08060096080081000f0f46696c65436c
+6f736553796d626f6c21210421212121212121212100029fff0d0000000d7d2a
+008700bb000000000300030300050101a0a0000000000000000000879cbb0000
+00000000010301083000000100003000010f000131310001120001800d123200
+01081212009ceaffffffffffffffffffffffffffffffffffffffffffffffffff
+ffffffffffffffffffffffffff000000ffffffffffffffffffffffffffff00fb
+fffb00000000000000ffffffffffffff00fffbfffbfffbfffbff00ffffffffff
+ffff00fbfffbfffbfffbfffb00ffffffffffffff00fffbfffbfbfbfbfbfb00ff
+ffffffffffff00fbfffbfffbfffffbfb00ffffffffffffff00fffbfffffffbfb
+ffff00ffffffffffffff00fbfbfbfbfbfbfbfbfb00ffffffffffffff00fbfffb
+fffbfffbff00ffffffffffffffff000000000000000000ffffffffffffffffff
+ffffffffffffffffffffffffffffffffff3200011000019d0100009d03000000
+00bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff0906
+0096080081000a0a556e646f4163746976652121042121212121212121210003
+9fff0e0000000d5e9d012e009c00a7000000000303030300050101a0a0000000
+0000000000009c9c9ca7000000000000010301083300000100003300010f0001
+34340001120001800f10350001081010009cf007070707070707070707070707
+0707070707000000000000000000070707070707070007070707070707070000
+0707070707000707070707070707070700070707070000000000000000000707
+0007070707070707070707070700000700000707070707000707070707070000
+0000070707070000070707070700000000000707070000000000000000000000
+0007070700000000000000000000000000070707000000000000000000000000
+0707070707000000000000000000070707070707070700000707070707070707
+0707070707070700070707070707070707070707070707070707070707070707
+0707073500011000019d0100009d0300000000bf000000bf00bfbf000000bfbf
+00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000fffbf0a0a0a4808080ff000000ff
+00ffff000000ffff00ff00ffffffffff0a060096080081000a0a5265646f4163
+7469766521210421212121212121212100049fff0f0000000d9d016d9d014300
+9c00a7000000000303030300050101a0a00000000000000000009c9c9ca70000
+00000000010300083600000100003600010f000137370001120001800f103800
+01081010009cf007070707070707070707070707070707070707070707070707
+0707000707070707070707070707070707070000070707070707070700000000
+0000000000070707070700000000000000000000000007070700000000000000
+0000000000000707070000000000000000000000000707070000000000070707
+0707000007070707000000000707070707070007070707070000070000070707
+0707070707070707070007070000000000000000000707070700070707070707
+0707070700070707070700000707070707070707000707070707070700000000
+00000000000707070707070707070707070707070707073800011000019d0100
+009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6
+caf0000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ff
+ffffffff0b060096080081000a0a536176654163746976652121042121212121
+2121212100059fff100000000d9d02869d013900a700a7000000000303030300
+050101a0a00000000000000000009ca79ca70000000000000103000839000001
+00003900010f00013a3a00011200018010103b0001081010009d010007070707
+0707070707070707070707070700000000000000000000000000000707000300
+0707070707070707000700070700030007070707070707070000000707000300
+0707070707070707000300070700030007070707070707070003000707000300
+0707070707070707000300070700030007070707070707070003000707000303
+0000000000000000030300070700030303030303030303030303000707000303
+0000000000000000000300070700030300000000000007070003000707000303
+0000000000000707000300070700030300000000000007070003000707070000
+000000000000000000000007070707070707070707070707070707073b000110
+00019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0
+c0c0dcc0a6caf000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ff
+ff00ff00ffffffffff0c060096080081000d0d50726576696577416374697665
+21210421212121212121212100069fff110000000d9d03809d011900a700a700
+0000000303030300050101a0a00000000000000000009ca79ca7000000000000
+010300083c00000100003c00010f00013d3d00011200018010103e0001081010
+009d010007070707070707070707070707070707070707000000000000000007
+0707070707070700ffffffffffff00000707070707070700ffffffffffff00ff
+0007070707070700ffffffffffff00000000070707070700ffffffffffffffff
+ff00070707070700ffffffffffffffffff00070707070700ffffffffffffffff
+ff00070707070700ffffffffffffffffff00070707070700ffffffffffffffff
+ff00070707070700ffffffffffffffffff00070707070700ffffffffffffffff
+ff00070707070700ffffffffffffffffff000707070707000000000000000000
+0000070707070707070707070707070707070707070707070707070707070707
+070707073e00011000019d0100009d0300000000bf000000bf00bfbf000000bf
+bf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000fffbf0a0a0a4808080ff000000
+ff00ffff000000ffff00ff00ffffffffff0d0600960800810009094375744163
+7469766521210421212121212121212100079fff120000000d9d06a29d015800
+a700a7000000000303030300050101a0a00000000000000000009ca79ca70000
+00000000010300083f00000100003f00010f0001404000011200018010104100
+01081010009d0100070707070707070707070707070707070707070707070007
+0707000707070707070707070707000707070007070707070707070707070007
+0707000707070707070707070707000007000007070707070707070707070700
+0700070707070707070707070707070000000707070707070707070707070707
+0007070707070707070707070707070400040707070707070707070707070704
+0704040407070707070707070704040407040707040707070707070704070704
+0704070704070707070707070407070407040707040707070707070704070704
+0707040407070707070707070704040707070707070707070707070707070707
+07070707070707074100011000019d0100009d0300000000bf000000bf00bfbf
+000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000fffbf0a0a0a4808080
+ff000000ff00ffff000000ffff00ff00ffffffffff0e0600960800810011115a
+6f6f6d5072657669657741637469766521210421212121212121212100089fff
+130000000d9d048f9d012e00a700a7000000000303030300050101a0a0000000
+0000000000009ca79ca7000000000000010300084200000100004200010f0001
+43430001120001801010440001081010009d0100070707070707070707070707
+070707070000000000000000000707070707070700ffffffffffffff00000707
+0707070700ffffffffffffff000700070707070700ffffffffffffff00000000
+0707070700ffffffffffffffffffff000707070700ffffffffffffff00000000
+0707070700ffffffffffff00f80707f80007070700ffffffffff00f8fefe07f8
+f800070700ffffffffff0007fe0707f80700070700ffffffffff0007070707f8
+0700070700ffffffffff00f80707fef8f800070700ffffffffffff00f80707f8
+00f8070700ffffffffffffff00000000f800000700ffffffffffffffffffff00
+07000000000000000000000000000000070700004400011000019d0100009d03
+00000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff0f060096080081000b0b5072696e7441637469766521210421212121212121
+212100099fff140000000d9d057e9d013900a700a70000000003030303000501
+01a0a00000000000000000009ca79ca700000000000001030008450000010000
+4500010f000146460001120001801010470001081010009d0100070707070707
+07070707070707070707070707070700000000000000000007070707070700ff
+ffffffffffffff0007070707070700ff0000000000ff0007070707070700ffff
+ffffffffffff0007070707070700ff0000000000ff0000000007070700ffffff
+ffffffffff000700070007000000000000000000000700070000000707070707
+0707070707000700070000000000000000000000000000070700000707070707
+07f8f8f807070007000700070707070707fbfbfb070700000007000000000000
+0000000000000007000707000707070707070707070007000707070700000000
+0000000000000007070707070707070707070707070707070707470001100001
+9d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0
+dcc0a6caf0000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00
+ff00ffffffffff10060096080081000a0a436f70794163746976652121042121
+21212121212121000a9fff150000000d9d07919d014300a700a7000000000303
+030300050101a0a00000000000000000009ca79ca70000000000000103000848
+00000100004800010f0001494900011200018010104a0001081010009d010007
+0707070707070707070707070707070000000000000707070707070707070700
+ffffffff000007070707070707070700ff0000ff00ff00070707070707070700
+ffffffff000404040404040707070700ff000000ff04ffffffff040407070700
+ffffffffff04ff0000ff04ff04070700ff0000000004ffffffff040404040700
+ffffffffff04ff000000ffffff040700ff0000000004ffffffffffffff040700
+ffffffffff04ff0000000000ff040700000000000004ffffffffffffff040707
+070707070704ff0000000000ff040707070707070704ffffffffffffff040707
+070707070704040404040404040407070707070707070707070707070707074a
+00011000019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bf
+bfc0c0c0c0dcc0a6caf000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000fffbf0a0a0a4808080ff000000ff00ffff00
+0000ffff00ff00ffffffffff11060096080081000b0b50617374654163746976
+65212104212121212121212121000b9fff160000000d9d08969d0158009c00a7
+000000000303030300050101a0a00000000000000000009c9c9ca70000000000
+00010300084b00000100004b00010f00014c4c0001120001800f104d00010810
+10009cf007070707070707070707070707070707070707070700000000070707
+07070707070000000000fbfb00000000000707070003f80300fb0000fb00f803
+f800070700f8f80007070707070700f8030007070003f80000000000000000f8
+f800070700f803f803f803f803f803f8030007070003f803f803040404040404
+0400070700f803f803f804ffffffffff040407070003f803f80304ffffffffff
+04ff040700f803f803f804ff040404ff040404040003f803f80304ffffffffff
+ffffff0400f803f803f804ff040404040404ff0407000000000004ffffffffff
+ffffff04070707070707040404040404040404044d00011000019d0100009d03
+00000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff12060096080081000f0f466972737444617461416374697665212104212121
+212121212121000c9fff170000000d9d09b99d01620073007300000000030303
+0300050101a0a00000000000000000007373000000000000010300084e000001
+00004e00010f00014f4f0001120001800b0b500001080b0b0079070707070707
+0707070707070700000707070707000707070000070707070000070707000007
+0707000000070707000007070000000007070700000700000000000707070000
+0707000000000707070000070707000000070707000007070707000007070700
+000707070707000707070707070707070707075000011000019d0100009d0300
+000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff
+1306009608008100121250726576696f75734461746141637469766521210421
+2121212121212121000d9fff180000000d9d0a6b9d0162007300730000000003
+03030300050101a0a00000000000000000007373000000000000010300085100
+000100005100010f000152520001120001800b0b530001080b0b007907070707
+0707070707070707070707070707000707070707070707070000070707070707
+0707000000070707070707070000000007070707070700000000000707070707
+0707000000000707070707070707000000070707070707070707000007070707
+0707070707070007070707070707070707070707075300011000019d0100009d
+0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffff
+ffff14060096080081000e0e4e65787444617461416374697665212104212121
+212121212121000e9fff190000000d9d0b119d016d0073007300000000030303
+0300050101a0a000000000000000000073730000000000000103000854000001
+00005400010f000155550001120001800b0b560001080b0b0079070707070707
+0707070707070707000707070707070707070700000707070707070707070000
+0007070707070707070000000007070707070707000000000007070707070700
+0000000707070707070700000007070707070707070000070707070707070707
+000707070707070707070707070707070707075600011000019d0100009d0300
+000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff
+15060096080081000e0e4c617374446174614163746976652121042121212121
+21212121000f9fff1a0000000d9d0bc29d016d00730073000000000303030300
+050101a0a0000000000000000000737300000000000001030008570000010000
+5700010f000158580001120001800b0b590001080b0b00790707070707070707
+0707070700070707070700000707070000070707070000070707000000070707
+0000070707000000000707000007070700000000000700000707070000000007
+0700000707070000000707070000070707000007070707000007070700070707
+07070000070707070707070707070707075900011000019d0100009d03000000
+00bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff1606
+0096080081000c0c4d534d61696c416374697665212104212121212121212121
+00109fff1b0000000d9d0cb29d0162009200a7000000000303030300050101a0
+a0000000000000000000929ca7000000000000010300085a00000100005a0001
+0f00015b5b0001120001800e105c0001081010009ce007070707070707070707
+0707070707070707070707070707070707070707070700000000000000000000
+0000000000000000f8fb00fb00fbfbfbf8fbf8fb000000070000fb07fb07fb07
+fbf8fb00030000fb0300000000000000000000030300000700f8000700070707
+070700000300000000000700040404fc04040400000007070707000700fffcff
+fcff010100070707070707000700fffcfffcf901040007070707070700070004
+fcff0404000707070707070707000700ffffff00070707070707070707070007
+000400070707070707070707070707000700070707075c00011000019d010000
+9d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6ca
+f000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffff
+ffffff17060096080081000e0e57696e646f7741637469766174652121042121
+2121212121212100119fff1c0000000d9d02902a00a700b10000000003030303
+00050101a0a00000000000000000009ca79cb1000000000000010300085d0000
+0100005d00010f00015e5e00011200018010115f0001081111009d0110ffffff
+ffffffffffffffffffffffffffffff000000000000000000000000000000ffff
+ff00ffffffffff00ffffffffff00ffffffff00ffff00ffff00ffff00ffff00ff
+ffffff00ff00ffffff00ff00ffffff00ffffffff00ffffffffff00ffffffffff
+00ffffffff00ffffffffff00ffffffffff00ffffffff00000000000000000000
+000000ffffffff00ffffffffff00ffffffffff00ffffffff00ffff00ffff00ff
+ff00ffff00ffffffff00ff00ffffff00ff00ffffff00ffffffff00ffffffffff
+00ffffffffff00ffffffff00ffffffffff00ffffffffff00ffffff0000000000
+00000000000000000000ffffff00000000000000000000000000ffffffffffff
+ffffffffffffffffffffffffff5f00011000019d0100009d0300000000bf0000
+00bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000fffbf0a0
+a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff180600960800
+8100101053696d706c65466f726d416374697665212104212121212121212121
+00129fff1d0000000d9d064e3f009c00a7000000000303030300050101a0a000
+00000000000000009c9c9ca7000000000000010300086000000100006000010f
+000161610001120001800f10620001081010009cf00000000000000000000000
+000000000000fe06fe06fe06fe06fe06fe06fe06000006000000000000fe0000
+000000fe0000fe06fe06fe06fe0600060606000600000600000000fe06fe0000
+000000fe0000fe06fe06fe06fe06fe06fe06fe06000006000000000000fe0000
+000000fe0000fe06fe06fe06fe06000606060006000006000000000006fe0000
+000000fe0000fe06fe06fe06fe06fe06fe06fe06000006000000000000fe0000
+000000fe0000fe06fe06fe06fe06000606060006000006fe06fe06fe06fe0000
+000000fe0000fe06fe06fe06fe06fe06fe06fe06000000000000000000000000
+00000000006200011000019d0100009d0300000000bf000000bf00bfbf000000
+bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000fffbf0a0a0a4808080ff0000
+00ff00ffff000000ffff00ff00ffffffffff1906009608008100111154616275
+6c6172466f726d41637469766521210421212121212121212100139fff1e0000
+000d9d07294900870092000000000303030300050101a0a00000000000000000
+008792000000000000010300086300000100006300010f000164640001120001
+800d0e650001080e0e009cb60101010101010101010101010101010705070705
+0707050707050701010101010101010101010101010101070107070707070707
+0707070101050107010107010107010107010107010707070707070707070701
+0105010701010701010701010701010701070707070707070707070101050107
+0101070101070101070101070107070707070707070707010105010701010701
+0107010107010107010707070707070707070701010101010101010101010101
+01016500011000019d0100009d0300000000bf000000bf00bfbf000000bfbf00
+bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000fffbf0a0a0a4808080ff000000ff00
+ffff000000ffff00ff00ffffffffff1a06009608008100090941646441637469
+766521210421212121212121212100149fff1f0000000d9d07da2a00bc00c600
+0000000303030300050101a0a00000000000000000009cbc9cc6000000000000
+010300086600000100006600010f000167670001120001801213680001081313
+009d015607070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070407070707070707070707070707070707070704040707070707
+0707070407070707070707070402040707070707040704070407070707070704
+0202040707070707040404070707070707070402020204070704040404040404
+0707070707040202040707070707040404070707070707070402040707070707
+0407040704070707070707040407070707070707070407070707070707070407
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707680001100001
+9d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0
+dcc0a6caf0000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00
+ff00ffffffffff1b060096080081000a0a536f72744163746976652121042121
+2121212121212100159fff200000000d9d09a53f00b100bb0000000003030303
+00050101a0a00000000000000000009cb19cbb00000000000001030008690000
+0100006900010f00016a6a00011200018011126b0001081212009d0132070707
+0707070707070707070707070707070707070707070007070707070707040707
+070707070707f800f80707070707070407070707070707070000000707070707
+070407070707070707f8000700f8070707070704070707070707070000000000
+070707070704070707070707f80007070700f807070707040707070707070000
+0007000000070707070407070707070707070707070707070707070407070707
+0707000000000000070707070704070707070707000707070000070707070704
+0707070707070707070000070707070404040404070707070707000007070707
+07f8040404f80707070707000007070707070707040404070707070700000707
+070007070707f804f80707070707000000000000070707070704070707070707
+0707070707070707070707070707076b00011000019d0100009d0300000000bf
+000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000000000000000000000fffb
+f0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff1c060096
+080081000c0c46696c7465724163746976652121042121212121212121210016
+9fff210000000d9d0bcd4900bc00c6000000000303030300050101a0a0000000
+0000000000009cbc9cc6000000000000010300086c00000100006c00010f0001
+6d6d00011200018012136e0001081313009d0156070707070707070707070707
+0707070707070707070707070707070707070707070707070707070700000000
+00000000000000070707070707070707000607f8070707060007070707070707
+0707070700070707070600070707070707070707070707070007070600070707
+0700000007070707070707070007000707070707000101000707070707070700
+07000707070700fb000007070707070707070006000707070700fbf800070707
+070707070700000007070700fb070007070707070707070707070707070700fb
+f800070707070707070707070707070700fb0700070707070707070707070707
+07070700fbf80007070707070707070707070707070700000007070707070707
+0707070707070707070000070707070707070707070700070007000700070707
+0707070707070707070707070707070707070707070707070707070707070707
+070707070707070707076e00011000019d0100009d0300000000bf000000bf00
+bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000fffbf0a0a0a480
+8080ff000000ff00ffff000000ffff00ff00ffffffffff1d060096080081000a
+0a46696e6441637469766521210421212121212121212100179fff220000000d
+9d0ac83f00b100c6000000000303030300050101a0a00000000000000000009c
+b19cc6000000000000010300086f00000100006f00010f000170700001120001
+801113710001081313009d014307070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070000000707070000
+0007070707070707070707000700070707000700070707070707070707070000
+0007070700000007070707070707070700000000000700000000000707070707
+0707070000000000070007000000070707070707070000000000000000000000
+0000070707070700000700000007000000000000000007070707000007000000
+07000000000000000007070707000007000000000000fb000000000007070707
+0000000000000007000000000000000707070700070000000707070707000700
+0000070707070007000000070707070700070000000707070700000000000707
+0707070000000000070707070707070707070707070707070707070707070707
+070707070707070707070707070707077100011000019d0100009d0300000000
+bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000000000ff
+fbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff1e0600
+96080081000c0c44656c65746541637469766521210421212121212121212100
+189fff230000000d9d08a01f00b100b1000000000303030300050101a0a00000
+000000000000009cb19cb1000000000000010300087200000100007200010f00
+0173730001120001801111740001081111009d01210707070707070707070707
+07070707070707070707070707000007070707070707070707070707070000ff
+0000070707070707070707070700ff00ff00ff000707070707070707070700ff
+00ff00ff070707070707070707070700ff00ff07070701010707070707070707
+0707000707f80101f8f8070707000000f801010007f80101f8f80707070700ff
+ff00f8f801010101f8f800070707070700ffff0007f8010101f8ff0007070707
+070700ff07070101010101ff0007070707070700ff07f80101f8f80101000707
+070707070707070101f8f8ff0101f80707070707070707f80101f8fffffff801
+07070707070707070101f8f80000000701f80707070707070701f8f807070707
+07f8f8070707070707070707070707070707070707077400011000019d010000
+9d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6ca
+f000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffff
+ffffff1f060096080081000e0e566965774f6e6c794163746976652121042121
+2121212121212100199fff240000000d9d052b4900b100c60000000003030303
+00050101a0a00000000000000000009cb19cc600000000000001030008750000
+0100007500010f000176760001120001801113770001081313009d0143070707
+070707070707070707070707070707070707070707f8f8f8f8f8f8f8f8f8f8f8
+f8f8070707070707f8f8f8f8f8f8f8f8f8f8f8f800070707070707f8ffffffff
+ffffffffffffff00070707070707f8fff8f8f8fff8f8ffffffff000707070707
+07f8ffffffffffffffffffffff00070707070707f8fff8f8fff8f8ffffffffff
+00070707070707f80000ffffffffffffffffff0007070707070700ff00f8f8ff
+f8ffff0000ff00070707070700f8ff00ffffffffff00ff00ff00070707070007
+f8ff0707ffffff00ffff00ff00070707000000f8ffffff000000ffffffffff00
+07070700fefe00000000fefe0000000000000007070700fe0600070700fe0600
+0707070707070707070007070007070007070007070707070707070707000007
+0707070000070707070707070707070707070707070707070707070707070707
+7700011000019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00
+bfbfc0c0c0c0dcc0a6caf0000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000fffbf0a0a0a4808080ff000000ff00ffff
+000000ffff00ff00ffffffffff20060096080081000c0c557064617465416374
+697665212104212121212121212121001a9fff250000000d9d04313400b100bb
+000000000303030300050101a0a00000220000000000009cb19cbb0000000000
+00010300087800000101007800010f0001797900011200018011127a00010812
+12009d013207070707070707070707070707070707070707070707f8f8f8f8f8
+f8f8f8f8f8f8f8f80707070707f8f8f8f8f8f8f8f8f8f8f8f8000707070707f8
+ffffffffffffffffffffff000707070707f8fff8f8f8fff8f8ffffffff000707
+070707f8ffffffffffffffffffffff000707070707f8fff8f8fff8f8ffffffff
+ff000707070707f8ffffffffffffffffffffff000707070707f8fffff8f8fff8
+ffffffffff000707070707f8ffffffffffffffffffffff000707070707f8ff07
+07ffffffffffffffff000707070707f8ffffffffffffffffffffff0007070707
+0700000000000000000000000000070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+07070707070707070707070707070707070707070707077a00011000019d0100
+009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6
+caf0000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ff
+ffffffff21060096080081000707517569747465722121042121212121212121
+21001b9fff260000000d9ca79d030d00d000d0000000000303030300050101a0
+a00000000000000000009cd09cd0000000000000010300087b00000100007b00
+010f00017c7c00011200018014147d0001081414009d01900707070707070707
+070707070707070707f80707070707070707070000000000000000fefef80707
+070707070707070000000000000000fefef8070707070707fefe0700f8f8f8f8
+f8f8fe0404f8070707070707fe0606fef8f8f8f8f8fe040404f8070707070707
+fe060606f8f8f8f8fe04040404f807070706060606060606fefef8fe04040404
+04f8070707060606060606060000f8fe0404040404f807070706060606060606
+f8f8f8fe0404040404f8070707070707fe060600f8f8f8fe0404040404f80707
+07070707fe060000f8f8f8fe0404040404f8070707070707fe00f800f8f8f8fe
+0403040404f807070707070707f8f800f8f8f8fe0403040404f8070707070707
+07f80700f8f8f8fe0404040404f807070707070707070700f8f8f8fe04040404
+07f807070707070707070707070707fe0404040707f807070707070707070707
+070707fe04040407070707070707070707070707070707fe0404070707070707
+0707070707070707070707fe0407070707070707070707070707070707070707
+07070707070707077d00011000019d0100009d03000000008000000080008080
+00000080800080008080c0c0c0c0dcc0a4c8f000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000fffbf0a0a0a4808080
+ff000000ff00ffff000000ffff00ff00ffffffffff2206009608008100060646
+65726d6572212104212121212121212121001c9fff270000000d9d01f49d02ee
+014d014d000000000303030300050101a0a00000000000000000009d014d9d01
+4d000000000000010300087e00000100007e00010f00017f7f00011200018020
+20800001082020009d0400070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707fefefe070707070707070707
+0707070707070707f80707070707070707070707fefefe070707070707070707
+0707070707070707f80707070707070707070707fefefefe0707000000000000
+0000000000fefe00f80707070707070707070707fefefefe0707000000000000
+0000000000fefe00f80707070707070707070707fefefe06fe0700f8f8f8f8f8
+f8f8f8f8fe040400f80707070707fefefefefefefefefe0606fe00f8f8f8f8f8
+f8f8f8fe04040400f80707070707fefefefefefefefefe060606fef8f8f8f8f8
+f8f8fe0404040400f80707070707fefe0606060606060606060606fef8f8f8f8
+f8fe040404040400f80707070707fefe060606060606060606060606fefef8f8
+fe04040404040400f80707070707fefe0606060606060606060606060000f8f8
+fe04040404040400f80707070707fefe0606060606060606060606060000f8f8
+fe04040404040400f80707070707fefe060606060606060606060600f8f8f8f8
+fe04040404040400f80707070707fefe0606060606060606060600f8f8f8f8f8
+fe04040404040400f80707070707fefe0000000006060606060000f8f8f8f8f8
+fe04040404040400f80707070707fefe0000000006060606060000f8f8f8f8f8
+fe04040404040400f8070707070707f8f8f8f8f8fefe060600f800f8f8f8f8f8
+fe04030304040400f80707070707070707070707fefefe00f8f800f8f8f8f8f8
+fe04030004040400f80707070707070707070707fefefef8f80700f8f8f8f8f8
+fe04040404040400f80707070707070707070707fefefef8f80700f8f8f8f8f8
+fe04040404040400f80707070707070707070707070707f8070700f8f8f8f8f8
+fe04040404040400f80707070707f8f8f8f8f8f8f8f8f8f8f807070707070707
+fe04040404040400f8f8f8070707070707070707070707070707070707070707
+fe04040404000007070707070707070707070707070707070707070707070707
+fe04040400070707070707070707070707070707070707070707070707070707
+fe04040007070707070707070707070707070707070707070707070707070707
+fe04000707070707070707070707070707070707070707070707070707070707
+fe04000707070707070707070707070707070707070707070707070707070707
+fe00070707070707070707070707070707070707070707070707070707070707
+fe000707070707070707078000011000019d0100009d03000000008000000080
+00808000000080800080008080c0c0c0c0dcc0a4c8f000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000fffbf0a0a0a4
+808080ff000000ff00ffff000000ffff00ff00ffffffffff2306009608008100
+0707416e6e756c6572212104212121212121212121001d9fff280000000d9d04
+129d032d00a700a7000000000303030300050101a0a00000000000000000009c
+a79ca7000000000000010300088100000100008100010f000182820001120001
+801010830001081010009d01000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f10100f0f0f0f0f0f0f10100f0f0f0f0f10
+10100f0f0f0f0f1010100f0f0f0f0f0f1010100f0f0f1010100f0f0f0f0f0f0f
+0f1010100f1010100f0f0f0f0f0f0f0f0f0f10101010100f0f0f0f0f0f0f0f0f
+0f0f0f1010100f0f0f0f0f0f0f0f0f0f0f0f10101010100f0f0f0f0f0f0f0f0f
+0f1010100f1010100f0f0f0f0f0f0f0f1010100f0f0f1010100f0f0f0f0f0f10
+10100f0f0f0f0f1010100f0f0f0f0f10100f0f0f0f0f0f0f10100f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f8300011000019d0100009d0300000000808080
+8000008080000080000080800000808000808080400040400080ff0040804000
+ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000
+ff8080ffff8080ffff0080ff8040000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000240600960800
+81000808416e6e756c657232212104212121212121212121001e9fff29000000
+0d9d04ec9d02cf014d014d000000000303030300050101a0a000000000000000
+00009d014d9d014d000000000000010300088400000100008400010f00018585
+0001120001802020860001082020009d04000707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707f9f9f9
+f9f9070707f9f9f9f9f907070707070707070707070707070707070707f90101
+010100f807f9f9010101f8f80707070707070707070707070707070707f9f901
+010100f8f8f9f90101f8f8f80707070707070707070707070707070707f8f9f9
+010100f8f9f9010100f8f8f8070707070707070707070707070707070707f9f9
+010101f9f9010100f8f8f807070707070707070707070707070707070707f8f9
+f9010101010100f8f8f807070707070707070707070707070707070707070706
+f90101010100f8f8f80707070707070707070707070707070707070707070707
+f901010100f8f8f80707070707070707070707070707070707070707070707f9
+f90101010100f80707070707070707070707070707070707070707070707f9f9
+01010101010100f8070707070707070707070707070707070707070707f9f901
+0100f901010100f8f807070707070707070707070707070707070707f9f90101
+00f8f9f901010100f8f80707070707070707070707070707070707f9f9010100
+f8f8f8f9f901010100f8f807070707070707070707070707070707f901010100
+f8f80707f9f901010100f8f807070707070707070707070707070707f9000000
+f8f8070707f900000000f8f8070707070707070707070707070707070707f8f8
+f8f80707070707f8f8f8f8f80707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707078600011000019d0100009d030000
+0000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f0000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff25
+060096080081000808496d7072696d6572212104212121212121212121001f9f
+ff2a0000000d9d06cb9d032d00d000d0000000000303030300050101a0a00000
+000000000000009cd09cd0000000000000010300088700000100008700010f00
+0188880001120001801414890001081414009d01900f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e0e0e0e0e
+000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f0f0f0f0f0f000e
+0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000000000f0f
+0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f0000000000000000
+00000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f0f0f0f00
+0000000000000000000000000f0f000f0f0f0f000f0f0f0f0f0f0101010f0f00
+0f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f0f0f0000000000
+00000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f000f0f0f
+0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f8900011000019d0100009d03000000008080808000008080000080
+000080800000808000808080400040400080ff0040804000ff804000ffffffc0
+c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ffff8080ff
+ff0080ff80400000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000002606009608008100090950726563
+6564656e7421210421212121212121212100209fff2b0000000d9d082e9d0337
+00d000d0000000000303030300050101a0a00000000000000000009cd09cd000
+0000000000010300088a00000100008a00010f00018b8b00011200018014148c
+0001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f
+0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f
+0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f
+0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f
+0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f
+0f0f00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f8c00011000019d
+0100009d03000000008080808000008080000080000080800000808000808080
+400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff0000
+ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff8040000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000027060096080081000a0a52656368657263686572212104212121
+21212121212100219fff2c0000000d9d01389d04e200d000d000000000030303
+0300050101a0a00000000000000000009cd09cd0000000000000010300088d00
+000100008d00010f00018e8e00011200018014148f0001081414009d01900f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f01010101010f0f0f0f0f0f0f0f0f0f0f0f0f0f010113
+1301010f0f0f0f0f0f0f0f0f0f0f0f0f0f011313131313010101010101010f0f
+0f0f0f0f0f01131313131313131313131303000f0f0f0f0f0f0113130f010101
+010f13131303000f0f0f0f0f0f01130f0113130000130f131303000f0f0f0f0f
+0f0113010e0e0e0f0f01130f1303000f0f0f0f0f0f0113011313131313031313
+0f03000f0f0f0f0f0f0113010e0f0f0f0f03130f1303000f0f0f0f0f0f01130f
+01131300000303130f03000f0f0f0f0f0f0113130f000001011414031303000f
+0f0f0f0f0f01030303030303031314140303000f0f0f0f0f0f0f000000000000
+0006131414000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f06131414000f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f061314000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f8f00011000019d0100009d03000000008080
+808000008080000080000080800000808000808080400040400080ff00408040
+00ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff80
+00ff8080ffff8080ffff0080ff80400000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000002806009608
+0081000b0b526563686572636865723221210421212121212121212100229fff
+2d0000000d9d02529d04ec014d014d000000000303030300050101a0a0000000
+0000000000009d014d9d014d000000000000010300089000000100009000010f
+000191910001120001802020920001082020009d04000f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0101
+01010101010f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0101
+01010101010f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f01010f11
+110f11110f01010f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f010f0f110f
+0f110f0f110f0f0101010101010101010f0f0f0f0f0f0f0f0f0f0f010f0f110f
+0f110f0f110f0f0101010101010101010f0f0f0f0f0f0f0f0f0f0f010e0e0e0e
+0e0e0e0e0e0e0e0e0e0e0e0e0e0e0303000f0f0f0f0f0f0f0f0f0f010e0e110f
+0f010101000101110f0f110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e110f
+0f010101000101110f0f110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e0f01
+010e13130e00000111110f11110f0303000f0f0f0f0f0f0f0f0f0f010e0e010e
+0e130e0e130f0f000101110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e010e
+0e130e0e130f0f000101110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e0113
+130e13130f13130003030f11110f0303000f0f0f0f0f0f0f0f0f0f010e0e010e
+0e130f0f130f0f000303110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e010e
+0e130f0f130f0f000303110f0f110303000f0f0f0f0f0f0f0f0f0f010e0e0f01
+010f13130f00000103030311110f0303000f0f0f0f0f0f0f0f0f0f010e0e110f
+0f0100000001010f1414140303110303000f0f0f0f0f0f0f0f0f0f010e0e110f
+0f0100000001010f1414140303110303000f0f0f0f0f0f0f0f0f0f0103030303
+03030303030303061313141414030303000f0f0f0f0f0f0f0f0f0f0f00000000
+000000000000000006061314141400000f0f0f0f0f0f0f0f0f0f0f0f00000000
+000000000000000006061314141400000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f061313141414000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0606131414000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0606131414000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0000000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f9200011000019d010000
+9d03000000008080808000008080000080000080800000808000808080400040
+400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff00
+00ffff00ffffff8000ff8080ffff8080ffff0080ff8040000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000002906009608008100070753756976616e74212104212121212121212121
+00239fff2e0000000d9d09479d033700d000d0000000000303030300050101a0
+a00000000000000000009cd09cd0000000000000010300089300000100009300
+010f000194940001120001801414950001081414009d01900f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f
+0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f01
+00080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f
+0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800000f
+0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f
+0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f
+0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f9500011000019d0100009d03000000008080808000008080
+000080000080800000808000808080400040400080ff0040804000ff804000ff
+ffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ffff
+8080ffff0080ff80400000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000002a06009608008100080856
+616c696465723221210421212121212121212100249fff2f0000000d9d050c9d
+050c014d014d000000000303030300050101a0a00000000000000000009d014d
+9d014d000000000000010300089600000100009600010f000197970001120001
+802020980001082020009d040007070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+070707fafafafafa070707070707070707070707070707070707070707070707
+0707fafa02020204f80707070707070707070707070707070707070707070707
+07fafa02020204f8f80707070707070707070707070707070707070707070707
+fafa02020204f8f8f80707070707070707070707070707fafafa0707070707fa
+fa02020204f8f8f80707070707070707070707070707fa02020204070707fafa
+02020204f8f8f8070707070707070707070707070707fa02020204f807fafa02
+020204f8f8f807070707070707070707070707070707fa02020204f8fafa0202
+0204f8f8f80707070707070707070707070707070707fa02020204fafa020202
+04f8f8f8070707070707070707070707070707070707fa02020202fa02020204
+f8f8f807070707070707070707070707070707070707fa0202020202020204f8
+f8f80707070707070707070707070707070707070707fa02020202020204f8f8
+f807070707070707070707070707070707070707070702020202020204f8f8f8
+07070707070707070707070707070707070707070707070202020204f8f8f807
+070707070707070707070707070707070707070707070707020404f8f8f80707
+07070707070707070707070707070707070707070707070707f8f8f8f8070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+070707070707070707070707079800011000019d0100009d0300000000800000
+008000808000000080800080008080c0c0c0c0dcc0a4c8f00000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000fffbf0a0
+a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff2b0600960800
+8100080856616c696465723321210421212121212121212100259fff30000000
+0d9d066e9d04c301f401f4000000000303030300050101a0a000000000000000
+00009d01f49d01f4000000000000010300089900000100009900010f00019a9a
+00011200018030309b0001083030009d09000707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707fafafafafafafafafafa0707
+0707070707070707070707070707070707070707070707070707070707070707
+07070707fafafafafafafafafafa070707070707070707070707070707070707
+070707070707070707070707070707070707fafafafa0202020202020404f8f8
+0707070707070707070707070707070707070707070707070707070707070707
+0707fafafafa0202020202020404f8f807070707070707070707070707070707
+07070707070707070707070707070707fafafafa0202020202020404f8f8f8f8
+0707070707070707070707070707070707070707070707070707070707070707
+fafafafa0202020202020404f8f8f8f807070707070707070707070707070707
+0707070707070707070707070707fafafafa0202020202020404f8f8f8f8f8f8
+070707070707070707070707070707070707070707070707070707070707fafa
+fafa0202020202020404f8f8f8f8f8f8070707070707070707070707fafafafa
+fafa07070707070707070707fafafafa0202020202020404f8f8f8f8f8f80707
+070707070707070707070707fafafafafafa07070707070707070707fafafafa
+0202020202020404f8f8f8f8f8f8070707070707070707070707fafa02020202
+02020404070707070707fafafafa0202020202020404f8f8f8f8f8f807070707
+07070707070707070707fafa0202020202020404070707070707fafafafa0202
+020202020404f8f8f8f8f8f80707070707070707070707070707fafa02020202
+02020404f8f80707fafafafa0202020202020404f8f8f8f8f8f8070707070707
+07070707070707070707fafa0202020202020404f8f80707fafafafa02020202
+02020404f8f8f8f8f8f807070707070707070707070707070707fafa02020202
+02020404f8f8fafafafa0202020202020404f8f8f8f8f8f80707070707070707
+07070707070707070707fafa0202020202020404f8f8fafafafa020202020202
+0404f8f8f8f8f8f8070707070707070707070707070707070707fafa02020202
+02020404fafafafa0202020202020404f8f8f8f8f8f807070707070707070707
+07070707070707070707fafa0202020202020404fafafafa0202020202020404
+f8f8f8f8f8f80707070707070707070707070707070707070707fafa02020202
+02020202fafa0202020202020404f8f8f8f8f8f8070707070707070707070707
+07070707070707070707fafa0202020202020202fafa0202020202020404f8f8
+f8f8f8f807070707070707070707070707070707070707070707fafa02020202
+020202020202020202020404f8f8f8f8f8f80707070707070707070707070707
+07070707070707070707fafa02020202020202020202020202020404f8f8f8f8
+f8f8070707070707070707070707070707070707070707070707fafa02020202
+02020202020202020404f8f8f8f8f8f807070707070707070707070707070707
+07070707070707070707fafa0202020202020202020202020404f8f8f8f8f8f8
+0707070707070707070707070707070707070707070707070707020202020202
+0202020202020404f8f8f8f8f8f8070707070707070707070707070707070707
+070707070707070707070202020202020202020202020404f8f8f8f8f8f80707
+0707070707070707070707070707070707070707070707070707070702020202
+020202020404f8f8f8f8f8f80707070707070707070707070707070707070707
+07070707070707070707070702020202020202020404f8f8f8f8f8f807070707
+0707070707070707070707070707070707070707070707070707070707070202
+04040404f8f8f8f8f8f807070707070707070707070707070707070707070707
+0707070707070707070707070707020204040404f8f8f8f8f8f8070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+f8f8f8f8f8f8f8f8070707070707070707070707070707070707070707070707
+07070707070707070707070707070707f8f8f8f8f8f8f8f80707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707079b00011000019d0100009d030000
+0000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f0000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff2c
+06009608008100070756616c6964657221210421212121212121212100269fff
+310000000d9d041c9d055500a700a7000000000303030300050101a0a0000000
+0000000000009ca79ca7000000000000010300089c9c00000100009c9c00010f
+00019c9d9c9d00011200018010109c9e0001081010009d01000f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f12120f0f0f0f0f0f0f0f0f0f
+0f0f0f0f12120f0f0f0f0f0f0f0f0f0f0f0f0f1212120f0f0f0f0f0f0f0f0f0f
+0f0f0f12120f0f0f0f0f0f0f0f0f0f0f0f0f1212120f0f0f0f0f0f12120f0f0f
+0f0f12120f0f0f0f0f0f0f1212120f0f0f1212120f0f0f0f0f0f0f0f1212120f
+0f12120f0f0f0f0f0f0f0f0f0f1212121212120f0f0f0f0f0f0f0f0f0f0f1212
+12120f0f0f0f0f0f0f0f0f0f0f0f0f12120f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f9c9e0001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000009c9e1a919c9c9ca39d01039d01339d01929d01999d02839d05
+909d05ee9d05f59d06f19d09fe9d0a5a9d0a619d0b639d0e709d0ece9d0ed59d
+0fd79d12e49d13429d13499d145c9d17699d17ca9d17d19d18e49d1bf19d1c4e
+9d1c559d1d689d20759d20da9d20e19d21f49d25019d25609d25679d267a9d29
+879d29e59d29ec9d2aff9d2e0c9d2e6b9d2e729d2f749d32819d32e29d32e99d
+33739d36809d36e49d36eb9d37759d3a829d3ae29d3ae99d3b739d3e809d3ee0
+9d3ee79d3f719d427e9d42dd9d42e49d43d69d46e39d47439d474a9d486d9d4b
+7a9d4bdc9d4be39d4ce59d4ff29d50539d505a9d51229d542f9d548a9d54919d
+55fa9d59079d59639d596a9d5aaf9d5dbc9d5e1a9d5e219d5f8a9d62979d62f3
+9d62fa9d64509d675d9d67bb9d67c29d68f69d6c039d6c639d6c6a9d6dc09d70
+cd9d712b9d71329d72779d75849d75de9d75e59d77889d7a959d7af19d7af89d
+7f0b9d82189d82739d827a9d838d9d869a9d86f89d86ff9d8b129d8e1f9d8e7b
+9d8e829d90259d93329d938f9d93969d95399d98469d98a49d98ab9d9a4e9d9d
+5b9d9dbc9d9dc39da1d69da4e39da53e9da5459da6e89da9f59daa539daa5a9d
+ae6d9db17a9db1d89db1df9dbaf29dbdff9dbe5b9dbe649dbf799dc2879d018e
+191a38626377919b9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d0133
+9d015f9d01889d01899d018b9d01929d01969d01999d01a39d02839d05909d05
+bd9d05e49d05e59d05e79d05ee9d05f29d05f59d05ff9d06f19d09fe9d0a269d
+0a509d0a519d0a539d0a5a9d0a5e9d0a619d0a6b9d0b639d0e709d0e989d0ec4
+9d0ec59d0ec79d0ece9d0ed29d0ed59d0edf9d0fd79d12e49d130c9d13389d13
+399d133b9d13429d13469d13499d13539d145c9d17699d17949d17c09d17c19d
+17c39d17ca9d17ce9d17d19d17db9d18e49d1bf19d1c189d1c449d1c459d1c47
+9d1c4e9d1c529d1c559d1c5f9d1d689d20759d20a49d20d09d20d19d20d39d20
+da9d20de9d20e19d20eb9d21f49d25019d252a9d25569d25579d25599d25609d
+25649d25679d25719d267a9d29879d29af9d29db9d29dc9d29de9d29e59d29e9
+9d29ec9d29f69d2aff9d2e0c9d2e359d2e619d2e629d2e649d2e6b9d2e6f9d2e
+729d2e7c9d2f749d32819d32ae9d32d89d32d99d32db9d32e29d32e69d32e99d
+32f39d33739d36809d36b09d36da9d36db9d36dd9d36e49d36e89d36eb9d36f5
+9d37759d3a829d3aae9d3ad89d3ad99d3adb9d3ae29d3ae69d3ae99d3af39d3b
+739d3e809d3eac9d3ed69d3ed79d3ed99d3ee09d3ee49d3ee79d3ef19d3f719d
+427e9d42a89d42d39d42d49d42d69d42dd9d42e19d42e49d42ee9d43d69d46e3
+9d470f9d47399d473a9d473c9d47439d47479d474a9d47549d486d9d4b7a9d4b
+a89d4bd29d4bd39d4bd59d4bdc9d4be09d4be39d4bed9d4ce59d4ff29d50219d
+50499d504a9d504c9d50539d50579d505a9d50649d51229d542f9d54569d5480
+9d54819d54839d548a9d548e9d54919d549b9d55fa9d59079d592f9d59599d59
+5a9d595c9d59639d59679d596a9d59749d5aaf9d5dbc9d5de69d5e109d5e119d
+5e139d5e1a9d5e1e9d5e219d5e2b9d5f8a9d62979d62bf9d62e99d62ea9d62ec
+9d62f39d62f79d62fa9d63049d64509d675d9d67879d67b19d67b29d67b49d67
+bb9d67bf9d67c29d67cc9d68f69d6c039d6c2f9d6c599d6c5a9d6c5c9d6c639d
+6c679d6c6a9d6c749d6dc09d70cd9d70f79d71219d71229d71249d712b9d712f
+9d71329d713c9d72779d75849d75a99d75d49d75d59d75d79d75de9d75e29d75
+e59d75ef9d77889d7a959d7ab99d7ae79d7ae89d7aea9d7af19d7af59d7af89d
+7b029d7f0b9d82189d823d9d82699d826a9d826c9d82739d82779d827a9d8284
+9d838d9d869a9d86c09d86ee9d86ef9d86f19d86f89d86fc9d86ff9d87099d8b
+129d8e1f9d8e459d8e719d8e729d8e749d8e7b9d8e7f9d8e829d8e8c9d90259d
+93329d93599d93859d93869d93889d938f9d93939d93969d93a09d95399d9846
+9d986e9d989a9d989b9d989d9d98a49d98a89d98ab9d98b59d9a4e9d9d5b9d9d
+849d9db29d9db39d9db59d9dbc9d9dc09d9dc39d9dcd9da1d69da4e39da5089d
+a5349da5359da5379da53e9da5429da5459da54f9da6e89da9f59daa1b9daa49
+9daa4a9daa4c9daa539daa579daa5a9daa649dae6d9db17a9db1a09db1ce9db1
+cf9db1d19db1d89db1dc9db1df9db1e99dbaf29dbdff9dbe249dbe509dbe519d
+be539dbe5b9dbe609dbe649dbe709dbf799dc2870301
-f83f9e07


end class;

class StandardWin is mapped inherits from DisplayProject.UserWindow

has public  constant MSG_QUIT_2 = 'Valider la fenêtre avant de quitter ?';
has public  constant MSG_QUITALL_2 = 'Quitter l\'application ?';
has public  constant MSG_QUITALL_3 = 'Valider puis quitter l\'application ?';

has public  attribute ActionHab: DataAccessSrvBD.ActionDesc;
has public  attribute CodeAction: Framework.integer;
has public  attribute DicoServiceMgr: DataAccessSrvBD.BusinessServiceMgrDesc;
has public  attribute FermerEvtFlag: Framework.boolean;
has public  attribute FlagInitReadData: Framework.boolean;
has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  attribute IdUtl: Framework.integer;
has public  attribute InstanceNumber: Framework.integer;
has public  attribute IsChanged: Framework.boolean;
has public  attribute IsShutdownConfirmed: Framework.boolean;
has public  attribute IsShutdownOK: Framework.boolean;
has public  attribute MaximumInstance: Framework.integer;
has public  attribute MyActionMgr: DisplayBD.ActionMgrDesc;
has public  attribute MyClassType: Framework.ClassType;
has public  attribute MyControlWin: DisplayBD.ControlWinDesc;
has public  attribute MyDataContext: DataAccessSrvBD.DataContext;
has public  attribute MyTransData: DataAccessSrvBD.TransDesc;
has public  attribute MyTransType: DataAccessSrvBD.BusinessServiceMgrDesc;
has public  attribute Parent: DisplayBD.StandardWin;
has public  attribute SessionId: DataAccessSrvBD.SessionId;
has public  attribute SessionUser: DataAccessSrvBD.SessionUserDesc;
has public  attribute Status_Line: Framework.string;
has public  attribute StdEventNotifier: DataAccessSrvBD.StdEventNotifier;

has public  event FermerEvt;

has public  method Action(input pCommande: DisplayProject.MenuCommand,
	input pObjet: Framework.Object = NIL);
has public  method Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method ActiverBureau;
has public  method AffStatusLine(input Message: Framework.string);
has public  method AffStatusLine(input Message: Framework.TextData);
has public  method Display;
has public  method Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input pParent: DisplayBD.StandardWin = NIL);
has public  method DoBeforeCloseWindow;
has public  method DoBeforeQuitApplication;
has public  method EventLoop;
has public  method ExitWindow;
has public  method Fermer;
has public  method GetParamAction(input pCodeParam: Framework.integer): DataAccessSrvBD.ParamDesc;
has public  method GetStructureDesc(input pObject: DataAccessSrvBD.ObjectSelfDesc,
	input pItemName: Framework.TextData): DataAccessSrvBD.StructureDesc;
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method NewWindow;
has public  method PostEventLoop;
has public  method PrintCmd;
has private method Quitter;
has public  method RegisterClose(input aWindow: DisplayBD.StandardWin);
has public  method RegisterClose;
has public  method RequestFocusOn(input ItemName: Framework.string,
	input aWidget: DisplayProject.Widget);
has public  method Resize(input aCompound: DisplayProject.CompoundField,
	input HeightPolicy: Framework.integer,
	input WidthPolicy: Framework.integer);
has public  method SetStateForUsage(input aWidget: DisplayProject.Widget,
	input aFieldName: Framework.TextData,
	input aUsage: Framework.integer,
	input aState: Framework.integer);
has public  method TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string);
has public  method Transfer: Framework.Object;
has public  method Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object where completion = (return = TransferDone, exception = TransferExc);

has public  event handler EventLoopHandler();
has public  event handler ResizeEHandler();

implements	DataAccessSrvBD.TransferIf;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

has
+5151463100000606000004c59fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+0001000018000001001b0001000000000003000021010200000000050400001c
+020f0f5374616e646172642057696e646f77170506007a08004d009fff010101
+010f1011120101010100009fff010000000d00005dc05dbf0000000003030303
+00020404a0a00000000000000000009d5dc09d5dbf0000000000000108076801
+0000005dc05dbf00000002010000000009000007000021010200000000080806
+007c08000d0005054772696430010104010f1011120101011700019fff0c0000
+000d00000cdc0fc9000000000303030300050404606000002203e807d000009d
+0cdc9d0fc900000000000001080910010000000cb20fa0000000020100000000
+040201009fff009fff00010100000a0000000404010000020b000c0009000021
+0202000000000b0c0a06000302010000000000000b06007a08004d0006065061
+6e656c30010104010f1011120101011700029fff0e0000000d00000bb80fa000
+010001030503030008040460600000220bb80fa000009d0bb89d0fa000000000
+000001080d6001ff81000b8e0f760000000201000000000900000d0000210102
+000000000e0e060092082081029fff21210401212121212121212100009fff0f
+0000000d6868009c01580001000103030303000b0101a0a00000220000000000
+009c9c9d01580000000000000103010b0f020100009e0044201400000000000f
+00001c02060650616e656c0a100c060084082009020b0b5374617475735f4c69
+6e6502020c2121212121010101170003080854657874446174610d0000000d00
+9d0bc200f00fa0000200010350030300080204a0a00000440000000000009cf0
+9d0fa00100000000000103020107003f06000500010000fffe000606005e0800
+2e009fff03030303030303030303030300009fff0200000008009fff00000000
+0000000000000002011001100000210302000000001112131106005c08000e00
+040466696c6501030303030303030303030300049fff10000000080605052646
+696c6500000000000000000000000201140103ff001400002102020000000015
+161506006a0800020005057072696e7403030302030303030303030300059fff
+1100000008119fff0000000000000000000000010200121606006a080002000a
+0a7072696e74736574757003030302030303030303030300069fff1200000008
+119fff0000000000000000000000010200111206005c08000e00060641637469
+6f6e01030303030303030303030300079fff150000000806070726416374696f
+6e00000000000000000000000201170103ff0017000021010200000000181806
+006a0800020009094e657757696e646f7703030302030303030303030300089f
+ff1600000008120b0b264e65772057696e646f77000000000000000000000001
+020eff1306005c08000e00040448656c7001030303030303030303030300099f
+ff1700000008069fff0000000000000000000000020119010303001900002100
+0200000000191a919c9c9cb39d01139d011e9d019c9d01a89d01b49d021a9d02
+259d027f9d028d9d02fa9d032b9d03389d03759d03819d03b79d03f29d04339d
+043e9d04839d04bb9d04c55a191a38626377919b9c9c9ca09cb39cd19cfb9cfc
+9d01109d01139d011d9d011e9d01419d016b9d016c9d01809d01979d019c9d01
+a69d01a89d01b49d01d89d02029d02039d02179d021a9d02249d02259d02439d
+026c9d026d9d026f9d027f9d02839d028d9d02be9d02e99d02ea9d02ed9d02f2
+9d02fa9d03189d03279d03289d032a9d032b9d03359d03389d035a9d036e9d03
+6f9d03719d03729d03759d037f9d03819d03a49d03b39d03b49d03b79d03df9d
+03ee9d03ef9d03f29d04169d042c9d042d9d042f9d04309d04339d043d9d043e
+9d04659d047f9d04809d04839d04a59d04b49d04b59d04b79d04b89d04bb9d04
+c59d04c50301
-040054a8


end class;

class StandardWinRTpl is mapped inherits from DisplayProject.UserWindow


has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

has
+51514631000003ca0000031c9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100000f00000100130001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005d435d42000000000305030300020404a0a00000000000000000009d
+5d439d5d420000000000000108066b0100000000000000000000020100000000
+09000006000021010200000000070706007c08000d000a0a5265706f72744772
+6964010104010f1011120101011700019fff0c0000000d0000012e0361000000
+00030303030005040460600000220000000000009d012e9d0361000000000000
+010808100100000000000000000000020100000000040201009fff009fff2001
+040000090000000404000100020a000000080000210102000000000a09060003
+02020000000000000a06007c08000d000a0a4865616465724772696401010401
+0f1011120101011700029fff0d0000000d000000fa0337000100010303030300
+07010460600000220000000000009cfa9d033700000000000001080b10010000
+0000000000000000020100000000040102009fff009fff20010100000c000000
+0404000100020d000e000b0000210202000000000d0e0c060003020900000000
+00000d0600920820810205055469746c6521210401212121212121212100039f
+ff0e0000000d000000d001770001000103030303000a0104a0a0000022000000
+0000009cd09d01770000000000000103010b0f020100009e0044001400000000
+000f00001c0206065469746c650a100e06009208208102040444617465212104
+01212121212121212100049fff0f0000000d9d01810000d0018c000100020303
+0303000a0104a0a00000220000000000009cd09d018c0000000000000103010b
+10020100009e0044002400000000001000001c020505446174650a10101a919c
+9c9ca39d01039d010e9d01919d019c9d01a89d022a9d02369d02429d02a19d02
+af9d030f9d031c32191a38626377919b9c9c9ca09ca39cc19ceb9cec9d01009d
+01039d010d9d010e9d01369d01609d01619d01759d018c9d01919d019b9d019c
+9d01a89d01d09d01f99d01fa9d020e9d02259d022a9d02349d02369d02429d02
+659d028e9d028f9d02919d02a19d02a59d02af9d02d19d02fc9d02fd9d02ff9d
+030f9d03139d031c0301
-016aaf63


end class;

class StdBtn is mapped inherits from DisplayProject.UserWindow


has public  method Display;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+5151463100000a3f000009e89fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100000c000001000b0001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b010000005dc05dbf000000020100000000
+0900000600002101020000000007070601130802010209095369676e616c4274
+6e01020421212121212121211700019fff0c0000000d9d02679d038a01d501d5
+00000000030303030005010180800000000000000000009d01d59d01d5000000
+00000001020008000800010f0001090900011200018025250a0001082525009d
+0559070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070701070703
+0107010307070707070707070707070707070707070707070707070707070703
+0103010301070107070707070707070707070707070707070707070707070707
+0707010301030103070301070703010307070707070707070707070707070707
+0707070707070103010301030103010301030703010707070707070707070707
+0707070707070707070707030103010301070703010301030703010707070707
+0707070707070707070707070707010301030103010307030107070301030703
+0707070707070707070707070707070707070703070301030107010307070707
+0703010701070707070707070707070707070707070707070703010707030103
+0707070707070703070307070707070707070707070707070707070707070103
+0007000707070707070707070107010007070707070707070707070707070707
+0707070007000000000707070000000707000700ff0007070707070707070707
+0707070707070707000007070707000000070707000000000000000007070707
+0707070707070707070707070700000700000000070000000000070707000700
+0707070707070707070707070707070707070007000707000707070007070007
+0707000700070707070707070707070707070707070707000707000007070707
+0700000707070700000007070707070707070707070707070707070700070707
+0707070707070707070707000700070707070707070707070707070707f80707
+0707000707070700070007070707070700000707070707070707070707070707
+07f8f80707070700070707070707070707070707070007070707070707070707
+070707f80707f807f80707070007070007070707070007070707000707070707
+07070707070707070707f8f8f8f8070707070007070000000000070707070700
+00000707070707070707070707070707f8f8f900000000000000070707070707
+0707070000000000070707070707070707070707070707070707070707000707
+0707070707070700000000000007070707070707070707070707070707070707
+0000000007070707070707000000fbff00ff0007070707070707070707070707
+070707070000000000000000000000000000fbfffbfffb000707070707070707
+0707070707000700000000fffb000007070707070000000000fffb0000070707
+070707070707000000000000000000fffb000000000000000000000000000000
+0000000007070707070700000000fbfffb000000000000000000fafa00fafafa
+fafafafa00fafa0000070707070700000000fa00fa000000fafafafa00fa0000
+00000000f9f9f9f9f90000fa000007070707070000f9f9f9f9f9000000000000
+0000000000f9f9f9f90000000000f900fa0000070707070700fcfcfcfcfcfc00
+f9f900000000f9f9f900000000fcfcfcfcfc00f9f9f900000707070707000000
+0000000000fcfc00f9f9f9000000000000fcfc00000000fcfcfc000000070707
+0707fdfdfdfdfdfd000000fcfc0000fcfc00fcfcfcfc00000000000000000000
+fc0007070707070000000000000000000000fcfcfc0000000000000000000000
+0000000000000007070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070a00011000
+019d0100009d0300000000800000008000808000000080800080008080c0c0c0
+c0dcc0a4c8f080ffff40808080ff00404000ff8000ff80808040008000ff8000
+404080ff004080ffff8000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff
+00ff00ffffffffff0a1a919c9c9ca39d01039d010e9d01689d016f9d06db9d09
+e81b191a38626377919b9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d
+010e9d01359d01639d01649d01689d016c9d016f9d01799d06db9d09e80301
-05c19c0b


end class;

class ToolBarModel is mapped inherits from DisplayProject.UserWindow


has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+515146310000444c0000412a9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100001f000001000b0001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000305030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b0100000000000000000000020100000000
+09000006000021010200000000070706007a08004d000a0a546f6f6c7350616e
+656c010104010f1011120101011700019fff0c0000000d000a014d1731000000
+00035103030005010160600000220000000000009d014d9d1731000000000000
+0108086001ff8100000000000000000201000000000900000800002105020000
+0000090a0b0c0d0906007c08000d000c0c4461746147726964546f6f6c010104
+010f1011120101011700029fff0d0000000d9d0ff31f00f003de000000000303
+03030007010160600000220000000000009cf09d03de01000000000001080e10
+01ff810000000000000000020100000000040104009fff009fff00010100000f
+0000000000040400000000000210001100120013000e00002104020000000010
+1112130f0600030201000000001e1e10060113080201020e0e46697273744461
+74615f546f6f6c01020421212121212121211700039fff0e0000000d1f0000c6
+00c600010001030303030009010180800000000000000000009cc69cc6000000
+00000001020014001400010f000115150001120001800b0b160001080b0b0079
+0707070707070707070707070700000707070707000707070000070707070000
+0707070000070707000000070707000007070000000007070700000700000000
+0007070700000707000000000707070000070707000000070707000007070707
+000007070700000707070707000707070707070707070707071600011000019d
+0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dc
+c0a6caf000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff
+00ffffffffff1106011308020102101050726576696f757344617461546f6f6c
+01020421212121212121211700049fff0f0000000d9d01040000c600c6000100
+02030303030009010180800000000000000000009cc69cc60000000000000102
+0017001700010f000118180001120001800b0b190001080b0b00790707070707
+0707070707070707070707070700070707070707070707000007070707070707
+0700000007070707070707000000000707070707070000000000070707070707
+0700000000070707070707070700000007070707070707070700000707070707
+07070707070007070707070707070707070707071900011000019d0100009d03
+00000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff12060113080201020c0c4e65787444617461546f6f6c010204212121212121
+21211700059fff100000000d9d01ea0000c600c6000100030303030300090101
+80800000000000000000009cc69cc60000000000000102001a001a00010f0001
+1b1b0001120001800b0b1c0001080b0b00790707070707070707070707070707
+0007070707070707070707000007070707070707070700000007070707070707
+0700000000070707070707070000000000070707070707000000000707070707
+0707000000070707070707070700000707070707070707070007070707070707
+07070707070707070707071c00011000019d0100009d0300000000bf000000bf
+00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000fffbf0a0a0a4
+808080ff000000ff00ffff000000ffff00ff00ffffffffff1306011308020102
+0c0c4c61737444617461546f6f6c01020421212121212121211700069fff1100
+00000d9d02cf0000c600c6000100040303030300090101808000000000000000
+00009cc69cc60000000000000102001d001d00010f00011e1e0001120001800b
+0b1f0001080b0b00790707070707070707070707070007070707070000070707
+0000070707070000070707000000070707000007070700000000070700000707
+0700000000000700000707070000000007070000070707000000070707000007
+0707000007070707000007070700070707070700000707070707070707070707
+07071f00011000019d0100009d0300000000bf000000bf00bfbf000000bfbf00
+bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000fffbf0a0a0a4808080ff000000ff00
+ffff000000ffff00ff00ffffffffff0a06007c08000d0010105374616e646172
+6447726964546f6f6c010104010f1011120101011700079fff120000000d9d02
+c400012404ae00000000030303030007010160600000000000000000009d0124
+9d04ae0100000000000108201001ff8100000000000000000201000000000401
+04009fff009fff00010100002100000000000404000000000002220023002400
+25002000002104020000000022242523210600030201000000001e1e22060113
+080201020909536176655f546f6f6c01020421212121212121211700089fff13
+0000000d1f0000fa00fa0001000103030303000a010180800000000000000000
+009cfa9cfa00000000000001020026002600010f000127270001120001801010
+280001081010009d010007070707070707070707070707070707070000000000
+0000000000000000000707000300070707070707070700070007070003000707
+0707070707070000000707000300070707070707070700030007070003000707
+0707070707070003000707000300070707070707070700030007070003000707
+0707070707070003000707000303000000000000000003030007070003030303
+0303030303030303000707000303000000000000000000030007070003030000
+0000000007070003000707000303000000000000070700030007070003030000
+0000000007070003000707070000000000000000000000000007070707070707
+070707070707070707072800011000019d0100009d0300000000bf000000bf00
+bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000fffbf0a0a0a480
+8080ff000000ff00ffff000000ffff00ff00ffffffffff23060113080201020c
+0c507265766965775f546f6f6c010204212121212121212117000b9fff160000
+000d9d01380000fa00fa0001000203030303000a010180800000000000000000
+009cfa9cfa00000000000001020029002900010f00012a2a0001120001801010
+2b0001081010009d010007070707070707070707070707070707070707000000
+0000000000070707070707070700ffffffffffff00000707070707070700ffff
+ffffffff00ff0007070707070700ffffffffffff00000000070707070700ffff
+ffffffffffffff00070707070700ffffffffffffffffff00070707070700ffff
+ffffffffffffff00070707070700ffffffffffffffffff00070707070700ffff
+ffffffffffffff00070707070700ffffffffffffffffff00070707070700ffff
+ffffffffffffff00070707070700ffffffffffffffffff000707070707000000
+0000000000000000070707070707070707070707070707070707070707070707
+070707070707070707072b00011000019d0100009d0300000000bf000000bf00
+bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000fffbf0a0a0a480
+8080ff000000ff00ffff000000ffff00ff00ffffffffff24060113080201020f
+0f5a6f6f6d50726576696577546f6f6c01020421212121212121211700099fff
+140000000d9d02520000fa00fa0001000303030303000a010180800000000000
+000000009cfa9cfa0000000000000102002c002c00010f00012d2d0001120001
+8010102e0001081010009d010007070707070707070707070707070707000000
+0000000000000707070707070700ffffffffffffff000007070707070700ffff
+ffffffffff000700070707070700ffffffffffffff000000000707070700ffff
+ffffffffffffffff000707070700ffffffffffffff000000000707070700ffff
+ffffffff00f80707f80007070700ffffffffff00f8fefe07f8f800070700ffff
+ffffff0007fe0707f80700070700ffffffffff0007070707f80700070700ffff
+ffffff00f80707fef8f800070700ffffffffffff00f80707f800f8070700ffff
+ffffffffff00000000f800000700ffffffffffffffffffff0007000000000000
+000000000000000000070700002e00011000019d0100009d0300000000bf0000
+00bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000fffbf0a0
+a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff250601130802
+01020a0a5072696e745f546f6f6c010204212121212121212117000a9fff1500
+00000d9d036b0000fa00fa0001000403030303000a0101808000000000000000
+00009cfa9cfa0000000000000102002f002f00010f0001303000011200018010
+10310001081010009d0100070707070707070707070707070707070707070707
+00000000000000000007070707070700ffffffffffffffff0007070707070700
+ff0000000000ff0007070707070700ffffffffffffffff0007070707070700ff
+0000000000ff0000000007070700ffffffffffffffff00070007000700000000
+0000000000000700070000000707070707070707070700070007000000000000
+000000000000000007070000070707070707f8f8f80707000700070007070707
+0707fbfbfb070700000007000000000000000000000000000700070700070707
+0707070707070007000707070700000000000000000000000707070707070707
+07070707070707070707073100011000019d0100009d0300000000bf000000bf
+00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000fffbf0a0a0a4
+808080ff000000ff00ffff000000ffff00ff00ffffffffff0b06007c08000d00
+0c0c436f707947726964546f6f6c010104010f10111201010117000c9fff1700
+00000d9d08380001240395000000000303030300070101606000000000000000
+00009d01249d03950100000000000108321001ff810000000000000000020100
+000000040103009fff009fff0001010000330000000004040000000002340035
+00360032000021030200000000343536330600030201000000001e1e34060113
+0802010208084375745f546f6f6c010204212121212121212117000d9fff1800
+00000d1f0000fa00fa0001000103030303000b01018080000000000000000000
+9cfa9cfa00000000000001020037003700010f00013838000112000180101039
+0001081010009d01000707070707070707070707070707070707070707070700
+0707070007070707070707070707070007070700070707070707070707070700
+0707070007070707070707070707070000070000070707070707070707070707
+0007000707070707070707070707070700000007070707070707070707070707
+0700070707070707070707070707070704000407070707070707070707070707
+0407040404070707070707070707040404070407070407070707070707040707
+0407040707040707070707070704070704070407070407070707070707040707
+0407070404070707070707070707040407070707070707070707070707070707
+0707070707070707073900011000019d0100009d0300000000bf000000bf00bf
+bf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000000000fffbf0a0a0a48080
+80ff000000ff00ffff000000ffff00ff00ffffffffff35060113080201020909
+436f70795f546f6f6c010204212121212121212117000e9fff190000000d9d01
+380000fa00fa0001000203030303000b010180800000000000000000009cfa9c
+fa0000000000000102003a003a00010f00013b3b00011200018010103c000108
+1010009d01000707070707070707070707070707070700000000000007070707
+07070707070700ffffffff000007070707070707070700ff0000ff00ff000707
+07070707070700ffffffff000404040404040707070700ff000000ff04ffffff
+ff040407070700ffffffffff04ff0000ff04ff04070700ff0000000004ffffff
+ff040404040700ffffffffff04ff000000ffffff040700ff0000000004ffffff
+ffffffff040700ffffffffff04ff0000000000ff040700000000000004ffffff
+ffffffff040707070707070704ff0000000000ff040707070707070704ffffff
+ffffffff04070707070707070404040404040404040707070707070707070707
+0707070707073c00011000019d0100009d0300000000bf000000bf00bfbf0000
+00bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000fffbf0a0a0a4808080ff00
+0000ff00ffff000000ffff00ff00ffffffffff36060113080201020a0a506173
+74655f546f6f6c010204212121212121212117000f9fff1a0000000d9d025200
+00f000fa0001000303030303000b010180800000000000000000009cf09cfa00
+00000000000102003d003d00010f00013e3e0001120001800f103f0001081010
+009cf00707070707070707070707070707070707070707070000000007070707
+070707070000000000fbfb00000000000707070003f80300fb0000fb00f803f8
+00070700f8f80007070707070700f8030007070003f80000000000000000f8f8
+00070700f803f803f803f803f803f8030007070003f803f80304040404040404
+00070700f803f803f804ffffffffff040407070003f803f80304ffffffffff04
+ff040700f803f803f804ff040404ff040404040003f803f80304ffffffffffff
+ffff0400f803f803f804ff040404040404ff0407000000000004ffffffffffff
+ffff04070707070707040404040404040404043f00011000019d0100009d0300
+000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff
+0c06007c08000d000e0e45787441707047726964546f6f6c010104010f101112
+0101011700109fff1b0000000d9d15e40a010f01240000000003030303000701
+0160600000000000000000009d010f9d01240100000000000108401001ff8100
+00000000000000020100000000040101009fff009fff00010100004100000404
+0000024200400000210102000000004241060003020100000000000042060113
+080201020a0a4d534d61696c546f6f6c01020421212121212121211700119fff
+1c0000000d000000e500fa0001000103030303000c0101808000000000000000
+00009ce59cfa00000000000001020043004300010f000144440001120001800e
+10450001081010009ce007070707070707070707070707070707070707070707
+07070707070707070707000000000000000000000000000000000000f8fb00fb
+00fbfbfbf8fbf8fb000000070000fb07fb07fb07fbf8fb00030000fb03000000
+00000000000000030300000700f8000700070707070700000300000000000700
+040404fc04040400000007070707000700fffcfffcff01010007070707070700
+0700fffcfffcf901040007070707070700070004fcff04040007070707070707
+07000700ffffff00070707070707070707070007000400070707070707070707
+070707000700070707074500011000019d0100009d0300000000bf000000bf00
+bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000fffbf0a0a0a480
+8080ff000000ff00ffff000000ffff00ff00ffffffffff0d06007c08000d000c
+0c556e646f47726964546f6f6c010104010f1011120101011700129fff1d0000
+000d00000119027b00000000030303030007010160600000000000000000009d
+01199d027b0100000000000108461001ff810000000000000000020100000000
+040102009fff009fff0001010000470000000404000000024800490046000021
+0202000000004849470600030201000000001e1e48060113080201020909556e
+646f5f546f6f6c01020421212121212121211700139fff1e0000000d1f0000f0
+00fa0001000103030303000d010180800000000000000000009cf09cfa000000
+0000000102004a004a00010f00014b4b0001120001800f104c0001081010009c
+f007070707070707070707070707070707070700000000000000000007070707
+0707070007070707070707070000070707070700070707070707070707070007
+0707070000000000000000000707000707070707070707070707070000070000
+0707070707000707070707070000000007070707000007070707070000000000
+0707070000000000000000000000000707070000000000000000000000000007
+0707000000000000000000000000070707070700000000000000000007070707
+0707070700000707070707070707070707070707070007070707070707070707
+07070707070707070707070707070707074c00011000019d0100009d03000000
+00bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff4906
+01130802010209095265646f5f546f6f6c01020421212121212121211700149f
+ff1f0000000d9d01380000f000fa0001000203030303000d0101808000000000
+00000000009cf09cfa0000000000000102004d004d00010f00014e4e00011200
+01800f104f0001081010009cf007070707070707070707070707070707070707
+0707070707070707000707070707070707070707070707070000070707070707
+0707000000000000000000070707070700000000000000000000000007070700
+0000000000000000000000000707070000000000000000000000000707070000
+0000000707070707000007070707000000000707070707070007070707070000
+0700000707070707070707070707070007070000000000000000000707070700
+0707070707070707070700070707070700000707070707070707000707070707
+07070000000000000000000707070707070707070707070707070707074f0001
+1000019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0
+c0c0c0dcc0a6caf0000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000
+ffff00ff00ffffffffff4f1a919c9c9ca39d01039d010e9d01789d01879d0215
+9d02239d022f9d02889d028f9d03199d06269d06839d068a9d07149d0a219d0a
+7a9d0a819d0b0b9d0e189d0e719d0e789d0f029d120f9d12a29d12b09d12bc9d
+13109d13179d142a9d17379d17909d17979d18aa9d1bb79d1c139d1c1a9d1d2d
+9d203a9d20919d20989d21ab9d24b89d25439d25509d255c9d25af9d25b69d26
+c99d29d69d2a2c9d2a339d2b469d2e539d2eaa9d2eb19d2fb39d32c09d33459d
+33509d335c9d33b19d33b89d34aa9d37b79d383c9d38489d38549d38a89d38af
+9d39b19d3cbe9d3d149d3d1b9d3e1d9d412a9cc4191a38626377919b9c9c9ca0
+9ca39cc19ceb9cec9d01009d01039d010d9d010e9d01369d01609d01619d0175
+9d01789d01829d01879d01b19d01dc9d01dd9d01f19d020c9d02159d021f9d02
+239d022f9d025b9d02839d02849d02889d028c9d028f9d02999d03199d06269d
+06549d067e9d067f9d06839d06879d068a9d06949d07149d0a219d0a4b9d0a75
+9d0a769d0a7a9d0a7e9d0a819d0a8b9d0b0b9d0e189d0e429d0e6c9d0e6d9d0e
+719d0e759d0e789d0e829d0f029d120f9d123d9d12699d126a9d127e9d12999d
+12a29d12ac9d12b09d12bc9d12e39d130b9d130c9d13109d13149d13179d1321
+9d142a9d17379d17619d178b9d178c9d17909d17949d17979d17a19d18aa9d1b
+b79d1be49d1c0e9d1c0f9d1c139d1c179d1c1a9d1c249d1d2d9d203a9d20629d
+208c9d208d9d20919d20959d20989d20a29d21ab9d24b89d24e29d250e9d250f
+9d25239d253c9d25439d254d9d25509d255c9d25829d25aa9d25ab9d25af9d25
+b39d25b69d25c09d26c99d29d69d29fd9d2a279d2a289d2a2c9d2a309d2a339d
+2a3d9d2b469d2e539d2e7b9d2ea59d2ea69d2eaa9d2eae9d2eb19d2ebb9d2fb3
+9d32c09d32ec9d33189d33199d332d9d33429d33459d334f9d33509d335c9d33
+849d33ac9d33ad9d33b19d33b59d33b89d33c29d34aa9d37b79d37e19d380b9d
+380c9d38209d38379d383c9d38469d38489d38549d387b9d38a39d38a49d38a8
+9d38ac9d38af9d38b99d39b19d3cbe9d3ce59d3d0f9d3d109d3d149d3d189d3d
+1b9d3d259d3e1d9d412a0301
-f4b37ded


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionMgrDesc._SetDummy
begin
-- Only used for read only virtual attributes : due to code generation bug of Forte

end method;

------------------------------------------------------------
method ActionMgrDesc.Action(input pCommande: DisplayProject.MenuCommand,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description :	Plays the action of the menu command	
--
--	Type :	Concret
--
--	Parametres :	Input	-->	pCommande	: Menu command selected
--					Input	--> pObjet :	Paramètres de l'action
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Ajout des habilitations.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.Action(MenuCommand)');

Case pCommande.CommandType is
	When CT_CUSTOM do
		if pCommande.AppData <> NIL then
			if pCommande.AppData.IsA(Type=ActionParamDesc) then
				Self.Action((ActionParamDesc)(pCommande.AppData).CodeAction, (ActionParamDesc)(pCommande.AppData).unObjet);
			end if;
		end if;
	Else do
		unExc : ActionExc = new;
		unExc.Message.SetValue('MenuCommand <> CT_CUSTOM');
		Self.TraceExc(unExc,'ActionMgrDesc.Action');
		Raise unExc;
End Case;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.Action(MenuCommand) : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.Action(MenuCommand)');
		Raise;

end method;

------------------------------------------------------------
method ActionMgrDesc.Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description :	Plays the action if the user has the ability to execute it
--
--	Type :	Concret
--
--	Parametres :	Input	-->	pAction	: Code of the action to execute
--					Input	--> pObjet :	Paramètres de l'action
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Ajout des habilitations.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.Action(Action)');

--if not Self.CheckSecurity(pAction) and PLAY_SECURITY then
if PLAY_SECURITY then
	if not Self.CheckSecurity(pAction) then
		TmpPar1 : TextData = new(value='ActionMgrDesc.Action(Action)');
		TmpPar2 : IntegerData = new(value=pAction);
		e : SecurityExc = new();
		e.message.ReplaceParameters(
			e.Message,
			TmpPar1,
			TmpPar2.TextValue);
			raise e;
	end if;
end if;

Case pAction is
--
-- Section GED : 
--
   when ACT_GED_INITIALISER do
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_TERMINER do 
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_AFFICHERDOCDIVERS do
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_AFFICHERJUSTIFICATIFS do
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_AFFICHERMODELE do
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_AFFICHERSIGNATURE do
      Self.ActionPourGed(pAction,pObjet);
   when ACT_GED_RECHERCHER do
      Self.ActionPourGed(pAction,pObjet);
--      
-- fin de section Ged.
--

--      
-- Début de section Cti :
--
	When ACT_CTI_ACCESS do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_REGISTERNOTIFIER do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_DEREGISTERNOTIFIER do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_INITIALISERCTI do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_TERMINERCTI do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_PREPARETRANSFERT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_ANNULEPREPARETRANSFERT do
		Self.ActionPourCTI(pAction,pObjet);	
	When ACT_CTI_ANNULERCONSULTATION do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_APPELCLIENT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_ARRETERENREGISTREMENT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_ATTENTE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_CHANGEMENTMOTDEPASSE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_CONSULTATIONCOMPTE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_DECROCHE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_DEMARRERENREGISTREMENT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_INFOAPPEL do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_INFOCLIENT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_INITIALISERCONSULTATION do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_LIBERER do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_LOGIN do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_LOGOUT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_PAUSE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_QUITTER do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_RACCROCHE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_REECOUTE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_REECOUTECLIENT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_TRANSFERT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_TRANSFERTDIRECT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_VALIDERCONFERENCE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_VALIDERTRANSFERT do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_ANNULERAPPELCAMPAGNE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_DIFFERERAPPELCAMPAGNE do
		Self.ActionPourCTI(pAction,pObjet);
	When ACT_CTI_SYNCCTI do
		Self.ActionPourCTI(pAction,pObjet);
--
-- Fin de section CTI.
--

--      
-- Début de section AOF :
-- JBB le 28/01/1998

	when ACT_AOF_OPEN do
		Self.ActionPourAof(pAction,pObjet);
		
	when ACT_AOF_CLOSE do
		Self.ActionPourAof(pAction,pObjet);

	when ACT_AOF_EXECUTE do
		Self.ActionPourAof(pAction,pObjet);

--
-- Fin de section AOF.
--

	When ACT_DETAIL do
		unDetailaffParam : DetailAffParamDesc = (DetailAffParamDesc)(pObjet);
		Self.DetailAff(unDetailAffParam.uneDetailWin,unDetailAffParam.AffMode, unDetailAffParam.unDataContext, pAction, unDetailAffParam.Origin);
	Else do
		DoAction(pAction,pObjet);
End Case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.Action(Action) : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.Action(Action)');
		Raise;

end method;

------------------------------------------------------------
method ActionMgrDesc.ActionPourAof(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description : Traitement des actions que ActionMgrDesc délègue a un gestionaire d'action
--  spécialisé pour AltOffice. Ce dernier est désigné par l'attribut ActionMgrAo.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pAction : integer
--								pObjet : Object
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 26/11/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.ActionPourAo');

-- Declarations

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreActionAof();
End if;
-- Fin de verification des pre-conditions

-- Traitement

Self.ActionMgrAof.Action(pAction,pObjet);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-  ActionMgrDesc.ActionPourAo : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, ' ActionMgrDesc.ActionPourAo');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.ActionPourCti(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description : Traitement des actions que ActionMgrDesc délègue a un gestionaire d'action
--  spécialisé pour la ged. Ce dernier est désigné par l'attribut ActionMgrGed.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pAction : integer
--								pObjet : Object
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 19/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.ActionPourCti');

-- Declarations

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreActionCti();
End if;
-- Fin de verification des pre-conditions

-- Traitement

Self.ActionMgrCti.Action(pAction,pObjet);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-  ActionMgrDesc.ActionPourCti : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, ' ActionMgrDesc.ActionPourCti');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.ActionPourGed(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description : Traitement des actions que ActionMgrDesc délègue a un gestionaire d'action
--  spécialisé pour la ged. Ce dernier est désigné par l'attribut ActionMgrGed.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> pAction : integer
--								pObjet : Object
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 19/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.ActionPourGed');

-- Declarations

-- Verification des pre-conditions
if Task.Part.LogMgr.Test(Type = SP_MT_DEBUG, ServiceId = SP_ST_USER1, Group = LOG_GRPFLAG, Level = 10) then
	Self.CheckPreActionGed();
End if;
-- Fin de verification des pre-conditions

-- Traitement

Self.ActionMgrGed.Action(pAction,pObjet);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-  ActionMgrDesc.ActionPourGed : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, ' ActionMgrDesc.ActionPourGed');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.CheckPreActionAof
begin
--
--	Description : 	Vérification des préconditions de ActionAo : l'attribut ActionMgrAo
--  doit être instancié.
--
--	Type :	Abstrait
--
--	Parametres : Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : ImplemtntationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 26/11/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.CheckPreActionAof');

-- Declarations

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

if Self.ActionMgrAof = NIL then
	Exc : ImplementationExc = New();
	Exc.Date.SetCurrent();
	Exc.Message.SetValue('ActionMgrDesc.ActionMgrAof non instancie !');
	Raise Exc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.CheckPreActionAo : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.CheckPreActionAof');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.CheckPreActionCti
begin
--
--	Description : 	Vérification des préconditions de ActionGed : l'attribut ActionMgrGed
--  doit être instancié.
--
--	Type :	Abstrait
--
--	Parametres : Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : ImplemtntationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 19/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.CheckPreActionCti');

-- Declarations

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

if Self.ActionMgrCti = NIL then
	Exc : ImplementationExc = New();
	Exc.Date.SetCurrent();
	Exc.Message.SetValue('ActionMgrDesc.ActionMgrCti non instancie !');
	Raise Exc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.CheckPreActionCti : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.CheckPreActionCti');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.CheckPreActionGed
begin
--
--	Description : 	Vérification des préconditions de ActionGed : l'attribut ActionMgrGed
--  doit être instancié.
--
--	Type :	Abstrait
--
--	Parametres : Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : ImplemtntationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 19/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.CheckPreActionGed');

-- Declarations

-- Si les règles de cohérence ne sont pas vérifiées, on envoit une exception correspondante

if Self.ActionMgrGed = NIL then
	Exc : ImplementationExc = New();
	Exc.Date.SetCurrent();
	Exc.Message.SetValue('ActionMgrDesc.ActionMgrGed non instancie !');
	Raise Exc;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.CheckPreActionGed : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.CheckPreActionGed');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean
begin
--
--	Description :	Tests if the action can be done by the current user
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeAction :	Code action of the action
--					Return	--> TRUE = YES, FALSE = NO
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.CheckSecurity');

-- Declarations
aResult : Boolean = FALSE;

-- Traitement
aResult = Self.SessionUser.CheckSecurity(pCodeAction);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.CheckSecurity : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.CheckSecurity');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrDesc.DetailAff(input DetailWin: Framework.ClassType,
	input unDataContext: DataAccessSrvBD.DataContext = NIL,
	input pCodeAction: Framework.integer = 0,
	input pOrigin: DisplayBD.StandardWin = NIL)
begin
--
--	Description :	Displays the Window using the Window controller	
--
--	Type :	Concret
--
--	Parametres :	Input	-->	DetailWin	: ClassType of the window to display
--					Input	--> unDataContext	: Data context of the Window
--					Input	--> pCodeAction : Code action of the action
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : ActionMgrDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Ajout des habilitations (affectation du code action).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.DetailAff');

unDetail : StandardWin;
unDetail = (StandardWin) (DetailWin.InstanceAlloc());
if unDataContext <> NIL then
	unDetail.MyDataContext = unDataContext.clone(Deep=TRUE);
end if;
unDetail.CodeAction = pCodeAction;

-- Prise en compte du contexte : initialisation de la fenêtre
-- Fin Prise en compte du contexte

MyControlWin.Display(unDetail, pOrigin);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.DetailAff : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.DetailAff');
		Raise;

end method;

------------------------------------------------------------
method ActionMgrDesc.DetailAff(input DetailWin: Framework.ClassType,
	input ModeAff: Framework.integer,
	input unDataContext: DataAccessSrvBD.DataContext = NIL,
	input pCodeAction: Framework.integer = 0,
	input pOrigin: DisplayBD.StandardWin = NIL)
begin
--
--	Description :	Displays the Window using the Window controller	
--
--	Type :	Concret
--
--	Parametres :	Input	-->	DetailWin	: ClassType of the window to display
--					Input	-->	ModeAff		: FS_VIEWONLY or FS_UPDATE 
--					Input	--> unDataContext	: Data context of the Window
--					Input	--> pCodeAction : Code action of the action
--					Input	--> pOrigin		: Parent of the actual window
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : ActionMgrDesc.Action
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Ajout des habilitations (affectation du code action).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrDesc.DetailAff');

unDetail : StandardWin;
unDetail = (StandardWin) (DetailWin.InstanceAlloc());
if unDataContext <> NIL then
	unDetail.MyDataContext = unDataContext.clone(Deep=TRUE);
end if;
unDetail.CodeAction = pCodeAction;

-- Prise en compte du contexte : initialisation de la fenêtre
-- Fin Prise en compte du contexte

MyControlWin.Display(unDetail, ModeAff, pOrigin);

--Self.AffStatusLine('');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrDesc.DetailAff : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrDesc.DetailAff');
		Raise;

end method;

------------------------------------------------------------
method ActionMgrDesc.DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object)
begin

end method;

------------------------------------------------------------
method ActionMgrDesc.Init
begin
super.Init();
Self.ActionMgrs = new();
end method;

------------------------------------------------------------
method ActionParamDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method AgentFrontCommClt.AttachMO(input managedObject: Framework.Object)
begin
--
--	Description :	Cette méthode permet d'attacher l'agent au ManagedObject
--
--	Type :	Concret
--
--	Parametres : managedObject : La reference du manager rattaché à cet agent
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommClt.AttachMO');

-- Declarations
uneException 			: ImplementationExc;
SystemInstrumentIndex	: integer;
unInst 					: CompoundInst;


-- Verification des pre-conditions
if (managedObject = NIL) then
	uneException = new();
	uneException.Severity = SP_ER_ERROR;
	uneException.Message = 'Attention, le ManagedObject est NIL';	
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
super.AttachMO(managedObject);
SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

unInst = new();
unInst.Name.SetValue('Performances ');
unInst.Name.concat(managedObject.ClassName);
unInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommClt.ADMINISTRATION_FRONTCOMM_INST);
Self.AddInstrument(inst = unInst);

unMinProcessingTimeInst : CounterInst = new();
unMinProcessingTimeInst.Name.SetValue('Minimum Processing Time');
unMinProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommClt.MINPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unMinProcessingTimeInst);

unMaxProcessingTimeInst : CounterInst = new();
unMaxProcessingTimeInst.Name.SetValue('Maximum Processing Time');
unMaxProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommClt.MAXPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unMaxProcessingTimeInst);

unAveProcessingTimeInst : CounterInst = new();
unAveProcessingTimeInst.Name.SetValue('Average Processing Time');
unAveProcessingTimeInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommClt.AVEPROCESSING_FRONTCOMM_INST);
unInst.AddSubInstrument(unAveProcessingTimeInst);

unMethodCallsCountInst : CounterInst = new();
unMethodCallsCountInst.Name.SetValue('Method Calls Count');
unMethodCallsCountInst.InstrumentID = (SystemInstrumentIndex + AgentFrontCommClt.METHODCALLS_FRONTCOMM_INST);
unInst.AddSubInstrument(unMethodCallsCountInst);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommClt.AttachMO : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommClt.AttachMO. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentFrontCommClt.GetMOTypeName: Framework.string
begin
--
--	Description :	Cette méthode retourne le nom du ManagedObject
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommClt.GetMOTypeName');

-- Declarations
unMOName				: String;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
unMOName = self.ManagedObject.ClassName;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommClt.GetMOTypeName : End');
Return unMOName;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommClt.GetMOTypeName. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentFrontCommClt.Init
begin
super.Init();

-- La mehtode AttachMO utilise MOType pour verifier le type
-- du Managed Object
self.SetMOType(MOType=FrontCommCltDesc);

Self.CommTimeWatch = new();

end method;

------------------------------------------------------------
method AgentFrontCommClt.InitCmdProcessor
begin
--
--	Description :	Cette méthode permet de mettre en place de commande
--
--	Type :	Concret
--
--	Parametres : 
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommClt.InitCmdProcessor');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
super.InitCmdProcessor();

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;

	self.CommandProcessor.AddCommand(cmdName = 'InitialiserInstruments',
								 argDesc = '', 
								 cmdIndex = SystemCmdIndex + AgentManager.INITIALISERINST_CMD,
								 helpText = 'Syntax : InitialiserInstruments',
								 argNames = '',
								 groupName = 'Banque Directe',
								 menuString = 'Initialiser les instruments');
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommClt.InitCmdProcessor : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommClt.InitCmdProcessor. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method AgentFrontCommClt.ProcessCmdRequest(input cmdIndex: Framework.ui2,
	input parameters: Framework.GenericArray of Framework.Object,
	input outStream: Framework.Stream = NIL): Framework.Object
begin
--
--	Description :	Cette méthode est appelée quand une commande est exécutéé
--
--	Type :	Concret
--
--	Parametres : cmdIndex.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommClt.ProcessCmdRequest');

-- Declarations
unObjet					: object = NIL;
SystemInstrumentIndex	: Integer;


-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	SystemCmdIndex : integer = SystemAgent.CommandIndexValues.AGENT_CMD_LASTVALUE;
	case (cmdIndex - SystemCmdIndex) 
		when AgentManager.INITIALISERINST_CMD do
			if (Self.CommTimeWatch <> NIL) then
				Self.CommTimeWatch.MaxProcessingTime = 0;
				Self.CommTimeWatch.MinProcessingTime = 2147483647;
				Self.CommTimeWatch.AveProcessingTime = 0;
				Self.CommTimeWatch.MethodCallsCount  = 0;
				Self.CommTimeWatch.TotalProcessingTime = 0;				
			end if;
		
		else
			super.ProcessCmdRequest(cmdIndex, parameters, outStream);
	end case;
else
	super.ProcessCmdRequest(cmdIndex, parameters, outStream);
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommClt.ProcessCmdRequest : End');
Return unObjet;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommClt.ProcessCmdRequest. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return NIL;
end method;

------------------------------------------------------------
method AgentFrontCommClt.UpdateInstrument(input inst: SystemMonitor.Instrument)
begin
--
--	Description :	Cette méthode est appelée quand un instrument est appelé
--
--	Type :	Concret
--
--	Parametres : Inst : Inst spécifié.
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- AgentFrontCommClt.UpdateInstrument');

-- Declarations
SystemInstrumentIndex	: integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Debut du traitement
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, 'AgentFrontCommClt.UpdateInstrument. Instrument = ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, inst.Name);

SystemInstrumentIndex = SystemAgent.InstrumentIDValues.AGENT_IID_LASTVALUE;

case (inst.InstrumentID - SystemInstrumentIndex) 
	when AgentFrontCommClt.ADMINISTRATION_FRONTCOMM_INST do
		for unSousInst in (CompoundInst)(Inst).SubInstruments do
			(CounterInst(unSousInst)).ClearValue();
			case (unSousInst.InstrumentID - SystemInstrumentIndex)
				when AgentFrontCommClt.MAXPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MaxProcessingTime));

				when AgentFrontCommClt.MINPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MinProcessingTime));

				when AgentFrontCommClt.AVEPROCESSING_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.AveProcessingTime));

				when AgentFrontCommClt.METHODCALLS_FRONTCOMM_INST do
					(CounterInst(unSousInst)).Increment(amount=(Self.CommTimeWatch.MethodCallsCount));
			end case;
		end for;

	else do
		super.UpdateInstrument(inst);
end case;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- AgentFrontCommClt.UpdateInstrument : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('AgentFrontCommClt.UpdateInstrument. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, unMessage);
		return;
end method;

------------------------------------------------------------
method ControlWinDesc._GetInitWin: DisplayBD.StandardWin
begin
--
--	Description :	Return a handle on InitWin.
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 05/03/1998  |  Initial version.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- ControlWinDesc._GetInitWin');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- ControlWinDesc._GetInitWin : End');

Return Self._InitWin;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc._GetInitWin');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc._SetInitWin(input pValue: DisplayBD.StandardWin)
begin
--
--	Description :	Declare the InitWin and disable the automatic
--					propagation of Task.Shutdown for this win.
--					Cf technote #11315 and #8457
--
--	Type :	Concret
--
--	Parametres :	Input	--> pValue : the InitWin to set.
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	 |	JJ/MM/SSAA	|	Intervention.
-- JB BRIAUD |  05/03/1998  |   Initial version.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- ControlWinDesc._SetInitWin');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self._InitWin = pValue;
Self._InitWin.window.SystemClosePolicy =  SC_ENABLEDSHUTDOWNONLY;
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 255, '- ControlWinDesc._SetInitWin : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc._SetInitWin');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.CalculerNumeroInstance(input pControlWinRecord: DisplayBD.ControlWinRecord): Framework.integer
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.CalculerNumeroInstance');
unResult : integer = 1;

For Win in pControlWinRecord.Objects do
	if Win.uneWindow.InstanceNumber = unResult then
		unResult = unResult + 1;
	end if;
end for;
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.CalculerNumeroInstance : End');

Return unResult;
end method;

------------------------------------------------------------
method ControlWinDesc.CheckSecurity(input pCodeAction: Framework.integer): Framework.boolean
begin
--
--	Description :	Tests if the action can be done by the current user
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeAction :	Code action of the action
--					Return	--> TRUE = YES, FALSE = NO
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.CheckSecurity');

-- Declarations
aResult : Boolean = FALSE;

-- Traitement
aResult = Self.SessionUser.CheckSecurity(pCodeAction);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.CheckSecurity : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc.CheckSecurity');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input pParent: DisplayBD.StandardWin = NIL)
begin
Self.Display(aWindow=aWindow, Mode = Mode, AppName = Self.ApplicationName, pParent = pParent);

end method;

------------------------------------------------------------
method ControlWinDesc.Display(input aWindow: DisplayBD.StandardWin,
	input AppName: Framework.string,
	input pParent: DisplayBD.StandardWin = NIL)
begin
Display(aWindow, CTW_SYNCDISP, AppName, pParent);
end method;

------------------------------------------------------------
method ControlWinDesc.Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input AppName: Framework.string,
	input pParent: DisplayBD.StandardWin = NIL)
begin
--
--	Description :	Modèle de méthode standard	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Parm1 :	Desc
--					Output	--> Parm2 :	Desc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  DNG       |             |  Version initiale.
--  JB BRIAUD | 05/03/1998  |  Prise en compte de la séquence.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.Display');

-- Declarations
NewWindow : ClassType;
NewWindow = aWindow.GetClassType;
NewWinRecClassName : String = aWindow.ClassName;
NewTitle : TextData = new;
Found : Boolean = FALSE;
OkToDisplay : Boolean = FALSE;
TmpWinRecord : WinRecord = new;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

TmpWinRecord.unSequenceNumber = Self.aSequence.NextValue();

if PLAY_SECURITY then
	if not Self.MyActionMgr.CheckSecurity(aWindow.CodeAction) then
		TmpPar1 : TextData = new(value='ControlWinDesc.Display');
		TmpPar2 : IntegerData = new(value=aWindow.CodeAction);
		e : SecurityExc = new();
		e.message.ReplaceParameters(
			e.Message,
			TmpPar1,
			TmpPar2.TextValue);
			raise e;
	end if;
end if;

for Win in Windows do
	if NewWinRecClassName = Win.RecClassName then
		if Win.NumberOfWin < aWindow.MaximumInstance then
			NewTitle = AppName;
			NewTitle.Concat(' - ');
			NewTitle.Concat(aWindow.Window.Title);
			NewTitle.Concat(' - #');
			aWindow.InstanceNumber = Self.CalculerNumeroInstance(Win);
			NewTitle.Concat(aWindow.InstanceNumber);
			aWindow.Window.Title = NewTitle;
			TmpWinRecord.uneWindow = aWindow;
			Win.Objects.AppendRow(TmpWinRecord);
			Win.NumberOfWin = Win.NumberOfWin + 1;
			OkToDisplay = TRUE;
		end if;
		Found = TRUE;
	end if;
end for;

if not Found and aWindow.MaximumInstance > 0 then
	Windows.appendRow();
	Windows[Windows.Items].RecClassName = NewWinRecClassName;
	if AppName <>'' then
		NewTitle = AppName;
	else
		NewTitle = Self.ApplicationName;
	end if;
	NewTitle.Concat(' - ');
	NewTitle.Concat(aWindow.Window.Title);
	NewTitle.Concat(' - #');
	aWindow.InstanceNumber = 1;
	NewTitle.Concat(aWindow.InstanceNumber);
	aWindow.Window.Title = NewTitle;
	TmpWinRecord.uneWindow = aWindow;
	Windows[Windows.Items].Objects.AppendRow(TmpWinRecord);
	Windows[Windows.Items].NumberOfWin = 1;
	OkToDisplay = TRUE;
end if;

if OkToDisplay then

	if aWindow.InstanceNumber < aWindow.MaximumInstance then
		for Win in Windows do
			if NewWinRecClassName = Win.RecClassName then
				For obj in Win.Objects do
					if obj.uneWindow.<NewWindow> <> NIL then
						obj.uneWindow.<NewWindow>.State = MS_ENABLED;
					end if;
				end for;
			end if;
		end for;
	else
		for Win in Windows do
			if NewWinRecClassName = Win.RecClassName then
				For obj in Win.Objects do
					if obj.uneWindow.<NewWindow> <> NIL then
						obj.uneWindow.<NewWindow>.State = MS_DISABLED;
					end if;
				end for;
			end if;
		end for;
	end if;

	aWindow = Self.InitWindow(aWindow, pParent);
	Self.WindowCount.Value = Self.WindowCount.Value + 1;
	
	Case Mode is 
		when CTW_SYNCDISP do
			aWindow.Display();
			TmpWinRecord.uneTask = task.taskDesc;

		when CTW_ASYNCDISP do
			TmpWinRecord.uneTask = start task aWindow.Display();

	end case;

else
	E: CtrlTooManyInstanceExc = new;
	Raise E;
end if;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.Display : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc.Display');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.Display(input aWindow: DisplayBD.StandardWin,
	input pParent: DisplayBD.StandardWin = NIL)
begin
Display(aWindow, CTW_SYNCDISP, pParent);
end method;

------------------------------------------------------------
method ControlWinDesc.GetMenu(input pName: Framework.string): DisplayProject.Submenu
begin
--
--	Description :	Initializes the menu and returns it.
--
--	Type :	Concret
--
--	Parametres :	Input	--> pName : original submenu
--					Return	--> the submenu with the security played (same instance then the input parameter)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.GetMenu');

aResult : SubMenu;

if MenuRef <> NIL then
	For unMenu in Self.MenuRef.Children do
		if unMenu.IsA(Type=SubMenu) then
			if unMenu.Name.IsEqual(Source=pName,IgnoreCase=TRUE) then
				aResult = (SubMenu)(unMenu).clone(Deep=TRUE);
				exit;
			end if;
		end if;
	End for;
end if;

if PLAY_SECURITY then
	Self.PlaySecurityOnMenu(aResult);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.GetMenu : End');

Return aResult;

Exception 
	When e: GenericExc do
		Self.TraceExc(e,'ControlWinDesc.GetMenu');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.Init
begin
super.Init();
Self.Windows = new;
Self.aSequence = New();
Self.aSequence.SetValue(1);
Self.aSequence.SetIncrement(1);
Self.WindowCount = new();
end method;

------------------------------------------------------------
method ControlWinDesc.InitWindow(input pStandardWin: DisplayBD.StandardWin,
	input pParent: DisplayBD.StandardWin = NIL): DisplayBD.StandardWin
begin
--
--	Description :	Initializes the standard window class
--
--	Type :	Concret
--
--	Parametres :	Input	--> pSubMenu : original submenu
--					Return	--> the submenu with the security played (same instance then the input parameter)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.PlaySecurityOnMenu');

pStandardWin.Window.IconImage = Self.AppIconImage;
pStandardWin.Window.SmallIconImage = pStandardWin.Window.IconImage;
pStandardWin.MyControlWin = Self;
pStandardWin.FrontComm = Self.FrontComm;
pStandardWin.MyActionMgr = Self.MyActionMgr;
pStandardWin.SessionUser = Self.SessionUser;
pStandardWin.DicoServiceMgr = Self.DictionaryBSMgr; -- Dictionary Service Manager Définition
--pStandardWin.window.SystemClosePolicy =  SC_ENABLEDSHUTDOWNONLY;
pStandardWin.Parent = pParent;

if PLAY_SECURITY then
	pStandardWin.ActionHab = Self.SessionUser.GetAction(pStandardWin.CodeAction);
end if;

Return pStandardWin;
end method;

------------------------------------------------------------
method ControlWinDesc.MainTaskEventLoop
begin
Event Loop
	When Self.FermerEvt do
		Self.WindowCount.Value = Self.WindowCount.Value - 1;
		if Self.WindowCount.Value <= 0 then
			exit;
		end if;
End Event;

end method;

------------------------------------------------------------
method ControlWinDesc.PlaySecurityOnMenu(input pSubMenu: DisplayProject.Submenu): DisplayProject.Submenu
begin
--
--	Description :	Play the security on the submenu and
--					retires all unauthorised command.
--
--	Type :	Concret
--
--	Parametres :	Input	--> pSubMenu : original submenu
--					Return	--> the submenu with the security played (same instance then the input parameter)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.PlaySecurityOnMenu');

-- Declarations
aResult : SubMenu = pSubMenu;
iSep : integer;
TmpSep : MenuSeparator;

-- Traitement
For aMnuElt in aResult.Children do
	if aMnuElt.IsA(MenuSeparator) then
		if TmpSep <> NIL and iSep = 0 then
			aMnuElt.State = MS_INVISIBLE;
		end if;
		iSep =0;
		TmpSep = (MenuSeparator)(aMnuElt);
	elseif aMnuElt.IsA(MenuCommand) then
		if aMnuElt.AppData <> NIL then
			TmpActPrm : ActionParamDesc = (ActionParamDesc)(aMnuElt.AppData);
			if Self.CheckSecurity(TmpActPrm.CodeAction) then
				if TmpSep <> NIL then
					iSep = iSep + 1;
				end if;
			else
				aMnuElt.State = MS_INVISIBLE;
			end if;
		else
			aMnuElt.State = MS_INVISIBLE;
		end if;
	end if;
end for;
if TmpSep <> NIL and iSep = 0 then
	TmpSep.State = MS_INVISIBLE;
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.PlaySecurityOnMenu : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc.PlaySecurityOnMenu');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.Quitter
begin
--
--	Description :	Quit application by closing all windows.
--
--	Type :	Concret
--
--	Parametres :	Input	-->
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	|	22/03/1998	|	Initial version.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ControlWinDesc.Quitter');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Go : Boolean = TRUE;
if Self.InitWin <> NIL then
	if Self.InitWin.Window <> NIL then
		Post Self.InitWin.FermerEvt();
		Go = FALSE;
	end if;
end if;
if Go then
	For WinRec in Windows do
		if WinRec.Objects <> NIL then
			if WinRec.Objects.Items > 0 then
				For unWinRecord in Winrec.Objects do
					post unWinRecord.uneWindow.FermerEvt;
				End for;
			end if;
		end if;
	End for;
end if;
-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ControlWinDesc.Quitter : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ControlWinDesc.Quitter');
		Raise;
end method;

------------------------------------------------------------
method ControlWinDesc.RegisterClose(input aWindow: DisplayBD.StandardWin)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- ControlWinDesc.RegisterClose');
--NewWindow : ClassType = new;
--NewWindow = aWindow.GetClassType();
NewWinRecClassName : String = aWindow.ClassName;

for Win in Windows do
--	if NewWindow = Win.ClassType and Win.NumberOfWin > 0 then
	if NewWinRecClassName = Win.RecClassName then
		For obj in Win.Objects do
			if obj.uneWindow = aWindow then
				Win.NumberOfWin = Win.NumberOfWin - 1;
				Win.Objects.DeleteRow(obj);
				exit;
			end if;
		end for;	
		For obj in Win.Objects do
			obj.uneWindow.<NewWindow>.State = MS_ENABLED;
		end for;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- ControlWinDesc.RegisterClose : End');

Return;

Exception
	When e:GenericException do
		Self.TraceExc(e,'ControlWinDesc.RegisterClose');
		Raise;
 


end method;

------------------------------------------------------------
method ControlWinNode.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ControlWinRecord.Init
begin
super.Init();
ClassType = new;
Objects = new;
end method;

------------------------------------------------------------
method CtrlTooManyInstanceExc.Init
begin
super.Init();
Self.Message = new(value='Trop d''instances de cette fenêtre...');
end method;

------------------------------------------------------------
method DetailAffParamDesc.Init
begin
super.Init();
AffMode = CTW_ASYNCDISP;

end method;

------------------------------------------------------------
method FrontCommCltDesc.Connect(output SessionId: DataAccessSrvBD.SessionId)
begin
--
--	Description : 	makes the connection to the businessTransactionService for the client.
--
--	Type :	Abstract
--
--	Parameters :	Copy Ouput	--> SessionId :	Identification of the session given.
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- FrontCommCltDesc.Connect');

Self.FrontCommSrv.Connect(SessionId);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- FrontCommCltDesc.Connect : End');

Return;
end method;

------------------------------------------------------------
method FrontCommCltDesc.Connect(input Username: Framework.string,
	input Password: Framework.string,
	copy output SessionUser: DataAccessSrvBD.SessionUserDesc)
begin
--
--	Description : 	makes the connection to the businessTransactionService for the client.
--
--	Type :	Abstract
--
--	Parameters :	Copy Ouput	--> SessionUser :	Identification of the session given.
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- FrontCommCltDesc.Connect');

-- Traitement
Self.FrontCommSrv.Connect(UserName,Password,SessionUser);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- FrontCommCltDesc.Connect : End');
Return;

Exception
	When ge : GenericException do
		Self.TraceExc(ge,'FrontCommSrvDesc.Connect');
		Raise;
end method;

------------------------------------------------------------
method FrontCommCltDesc.GetRoleLst(input pUsername: Framework.string): Framework.Array of DataAccessSrvBD.RoleDesc
begin
--
--	Description :		Méthode de recherche des rôles d'un utilisateur
--
--	Type :	Concret
--
--	Parametres :	Input -->	pUserName	:	UserName
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : LoginWin
--
--	History :
--
--	D. Nguyen	|	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- FrontCommCltDesc.GetRoleLst');

aResult : Array of RoleDesc;
aResult = Self.FrontCommSrv.GetRoleLst(pUserName);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- FrontCommCltDesc.GetRoleLst : End');

Return aResult;

Exception
	When e:GenericException do
		Self.TraceExc(e,'FrontCommCltDesc.GetRoleLst');
		Raise;
		
end method;

------------------------------------------------------------
method FrontCommCltDesc.Init
begin
super.Init();
Self.ServiceStarted = FALSE;
Self.IsUsingFrontCommSrv = TRUE;
Start task Self.InitService();

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	Self.StartFrontCommAgent('FrontaleCommunication');
End if;

end method;

------------------------------------------------------------
method FrontCommCltDesc.SplitTimeWatch(input pTimeSplit: Framework.integer)
begin
--
--	Description :	Cette méthode permet de mettre à jour les éléments de perf.
--
--	Type :	Concret
--
--	Parametres : pTimeSplit
--
--	Pre-condition : 
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	30/09/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommCltDesc.SplitTimeWath');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
Self.AgentFComm.CommTimeWatch.MethodCallsCount = Self.AgentFComm.CommTimeWatch.MethodCallsCount + 1;
Self.AgentFComm.CommTimeWatch.CalculerMinProcessingTime(pTimeSplit);
Self.AgentFComm.CommTimeWatch.CalculerMaxProcessingTime(pTimeSplit);
Self.AgentFComm.CommTimeWatch.CalculerAveProcessingTime(pTimeSplit);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommCltDesc.SplitTimeWath : End');
Return;

exception
	when ge : GenericException do
		raise;
end method;

------------------------------------------------------------
method FrontCommCltDesc.StartFrontCommAgent(input pAgentName: Framework.TextData)
begin
--
--	Description :	Cette méthode permet de demarrer l'agent de la fontale de comm
--
--	Type :	Concret
--
--	Parametres :
--
--	Pre-condition :
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. ACHHAB	  |	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommCltDesc.StartFrontCommAgent');

-- Declarations
uneException : ImplementationExc;

-- Verification des pre-conditions
if (Self.AgentFComm <> NIL) then
	uneException = new();
	uneException.Message = 'L''agent est déjà demarré';
	raise uneException;
end if;
-- Fin de verification des pre-conditions

-- Debut du traitement
Self.AgentFComm = new();
Self.AgentFComm.AttachMO(self);
Self.AgentFComm.Name.SetValue('ABD_');
if (pAgentName = NIL) then
	Self.AgentFComm.Name.Concat(Self.ClassName);
else
	Self.AgentFComm.Name.Concat(pAgentName);
end if;
Self.AgentFComm.State = SM_ONLINE;
partAgent : ActivePartitionAgent = ActivePartitionAgent(task.Part.ActPartAgent);
Self.AgentFComm.SetParentAgent(parentAgent = partAgent, name = Self.AgentFComm.Name);
partAgent.AddSubAgent(subAgent = Self.AgentFComm, subAgentInfo = Self.AgentFComm.GetInfo());
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommCltDesc.StartFrontCommAgent : End');
Return;

exception
	when ge : GenericException do
		unMessage : TextData = new();
		unMessage.ReplaceParameters('FrontCommCltDesc.StartFrontCommAgent. Excpetion : <%1> est recue.', TextData(value = ge.ClassName));
		return;

end method;

------------------------------------------------------------
method FrontCommCltDesc.Transfer(input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.BusinessServiceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessService.
--
--	Type :	Abstract
--
--	Parametres :	Copy Input	--> TransData :	Data Transport structure.
--					Input	-->	BusinessService required for action.
--					Input	-->	TransOrigin	:	Origin of the demand
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	18/01/1997	|	Creation.
--	D. NGUYEN	|	16/12/97	|	Optimisation et correction de bug.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommCltDesc.Transfer');


--aObject 	: Object;
aResult 	: Object;
aStopWatch 	: StopWatch;
aTimesplit 	: Integer;

-- Recherche de précédence
if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aStopWatch = new();
	aStopWatch.Fire();
end if;

	TmpMec : Boolean;
	FlagFound : Boolean;
	For aMec in Self.TransferMecanisms do
		if aMec.unServiceMgr = TransType then
			TmpMec = aMec.UseByValue;
			FlagFound = TRUE;
			exit;
		end if;
	End for;
	if not flagFound then
		if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
			TmpMec = FALSE;
		else
			TmpMec = TRUE;
		end if;
		TmpTransferMec : TransferMecanism = new(unServiceMgr=TransType,UseByValue=TmpMec);
		Self.TransferMecanisms.Appendrow(TmpTransferMec);
	end if;
	if TmpMec then
		if Self.IsUsingFrontCommSrv then
			aResult = Self.FrontCommSrv.Transfer(TransData,TransType, ClassType, TransOrigin);
		else
			aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
		end if;
	else
		aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
	end if;
--	if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
--		aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
--	else
--		aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
--	end if;

/* -- Code pour une frontale partagée (IsShared = TRUE) : désactivé 
Event Loop 
	PostRegister
	start task Self.FrontCommSrv.Transfer(TransData,TransType, ClassType, TransOrigin) where completion = event;

	When Self.FrontCommSrv.TransferDone(aObject) do
		aResult = aObject;
		exit;
	When Self.FrontCommSrv.TransferExc(Exc) do
		Raise Exc;
end event;
*/

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTimeSplit);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommCltDesc.Transfer : End');
Return aResult;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'FrontCommCltDesc.Transfer');
		Raise;
end method;

------------------------------------------------------------
method FrontCommCltDesc.Transfer(input TransData: DataAccessSrvBD.TransDesc,
	input TransType: DataAccessSrvBD.InterfaceMgrDesc,
	input ClassType: Framework.ClassType,
	input TransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Transfers the Data and Action Required to the BusinessService.
--
--	Type :	Abstract
--
--	Parametres :	Copy Input	--> TransData :	Data Transport structure.
--					Input	-->	InterfaceService required for action.
--					Input	-->	TransOrigin	:	Origin of the demand
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	Historique :
--
--	D. NGUYEN	|	18/05/1997	|	Creation.
--	D. NGUYEN	|	16/12/97	|	Optimisation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommDesc.Transfer');


--aObject : Object;
aResult : Object;
aStopWatch 	: StopWatch;
aTimesplit 	: Integer;

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aStopWatch = new();
	aStopWatch.Fire();
end if;

if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
	aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
else
	if Self.IsUsingFrontCommSrv then
		aResult = Self.FrontCommSrv.Transfer(TransData,TransType, ClassType, TransOrigin);
	else
		aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
--		if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
--			aResult = TransType.TransferByRef(TransData, ClassType, TransOrigin);
--		else
--			aResult = TransType.TransferByValue(TransData, ClassType, TransOrigin);
--		end if;
	end if;
end if;

/* -- Code pour une frontale partagée (IsShared = TRUE) : désactivé 

Event Loop 
	PostRegister
	if (SystemAgent)(Task.Part.ActPartAgent).Name.value = TransType.CheckPartition() then
		start task TransType.TransferByRef(TransData, ClassType, TransOrigin) where completion = event;
	else
		start task Self.FrontCommSrv.Transfer(TransData,TransType, ClassType, TransOrigin) where completion = event;
	end if;
	When TransType.TransferByRefDone(aObject) do
		aResult = aObject;
		exit;
	When TransType.TransferByRefExc(Exc) do
		Raise Exc;
	When Self.FrontCommSrv.TransferItDone(aObject) do
		aResult = aObject;
		exit;
	When Self.FrontCommSrv.TransferItExc(Exc) do
		Raise Exc;
end event;
*/

if Task.Part.LogMgr.Test(Type = SP_MT_PERFORMANCE, ServiceId = SP_ST_USER1, Group = 2, Level = 1) then
	aTimeSplit = aStopWatch.Split();
	start task Self.SplitTimeWatch(aTimeSplit);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommDesc.Transfer : End');
Return aResult;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'FrontCommDesc.Transfer');
		Raise;
end method;

------------------------------------------------------------
method Surligneur.GetListeLigneSelectionnee: Framework.integer
begin
--
--	Description :	Retourne (par return) une liste (Array of IntegerData)
--  des numéros de lignes du tableau (ArrayField) qui sont
--  actuellement sélectionnées.
--  Il y a autant d'items retournés que de lignes selectionnées
--  dans le widget.
--  Retourne NIL si aucune ligne est sélectionnée.
--
--  Remarque : La liste est triée par ordre croissant
--  des numéros de ligne selectionnés dans le cas
--  d'une sélection multiple.
--
--  Restriction : Cette méthode n'est plus garantie
--  si la couleur par défaut est changée entre
--  deux sélections.	
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	-->
--					Return  --> un tableau d'IntegerData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 03/04/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ClassModel.MethodModel');
/*
uneListeLigneSelectionnee : array of IntegerData = New();
for i in Self.laListeLigneChoisie do
	if i.Value = 1 then
		uneListeLigneSelectionnee.AppendRow(i);
	end if;
end for;
	return uneListeLigneSelectionnee;
/*************************************************************
-- Declarations

uneListeLigneSelectionnee : array of IntegerData = New();

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

for i in Self.laListeLigneChoisie do
	if (i<> NIL) then
		if (i.IntegerValue <> Self.laCouleurDefaut) then
			unRang : IntegerData = New();
			unRang.SetValue(Self.laListeLigneChoisie.FindRowForObject(i));
			uneListeLigneSelectionnee.AppendRow(unRang);
		end if;
	end if;
end for;

-- Fin du traitement
************************************************/
-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ClassModel.MethodModel : End');

///////////////Return uneListeLigneSelectionnee;
*/
return Self.laLigneChoisie;
Exception
	When e : GenericException do
		Self.TraceExc(e, 'ClassModel.MethodModel');
		Raise;
end method;

------------------------------------------------------------
method Surligneur.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Classe
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 03/04/1997  |   Version initiale.
--+

super.Init();
Self.laCouleurSurligne = C_PALEYELLOW;
Self.laCouleurDefaut = C_DEFAULT;
Self.LaLigneChoisie = 0;
end method;

------------------------------------------------------------
method Surligneur.Rafraichir(input output pArrayField: DisplayProject.ArrayField)
begin
--
--	Description :	Rafraichi l'affichage du tableau (pArrayField).
--  Cette fonctionnalité est indispenssable
--  si le widget subi un scolling.
--  (Il y a peut être d'autre cas)	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pArrayField :	Le tableau a rafraichir.
--					Output	--> 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  	|	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD 	| 	03/04/1997  |   Version initiale.
--	D NGUYEN	|	14/06/1997	|	Pb de bug si le tableau change de taille d'affichage... en cours
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Surligneur.Rafraichir');


laLigneHaute : integer = pArrayField.toprow;
LigneVisible : integer = pArrayField.visiblerows;

for i in pArrayField.BodyGrid.Children do
	if Self.laLigneChoisie = i.Row + laLigneHaute - 1 then
		i.FillColor = Self.laCouleurSurligne;
	else
		i.FillColor = Self.laCouleurDefaut;
	end if;
end for;

/**********************************************************************
-- Declarations

laLigneDuHaut : integer = pArrayField.toprow;
leNbLigneVisible : integer = pArrayField.visiblerows;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- Prend le nombre de ligne visible dans l'ArrayField
Self.laColonne = pArrayField.bodygrid.columns;

for i in 1 to leNbLigneVisible do
	-- Verifie si la ligne a deja ete selectionnee
	if laListeLigneChoisie[laLigneDuHaut + i - 1] = NIL then
		for col in 0 to Self.laColonne - 1 do
			pArrayField.bodygrid.children[ i  + (leNbLigneVisible * col) ].fillcolor =
				Self.laCouleurDefaut;
		end for;

		-- Verifie si les lignes visibles actuellement doivent etre surlignees
	elseif  Self.laListeLigneChoisie[laLigneDuHaut + i - 1].Value = Self.laCouleurDefaut then 
		for col in 0 to Self.laColonne - 1 do
			pArrayField.bodygrid.children[ i + (leNbLigneVisible * col) ].fillcolor = 
				Self.laCouleurDefaut;
		end for;
	else
		for col in 0 to Self.laColonne - 1 do
			pArrayField.bodygrid.children[  i + (leNbLigneVisible * col) ].fillcolor =
				Self.laCouleurSurligne;
		end for;
	end if;
end for;

-- Fin du traitement
*************************************************************/

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Surligneur.Rafraichir : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Surligneur.Rafraichir');
		Raise;
end method;

------------------------------------------------------------
method Surligneur.SelectionnerLigne(input output pArrayField: DisplayProject.ArrayField,
	input pNumLigne: Framework.integer)
begin
--
--	Description :	Surligne la ligne pNumeroLigne
--  du widget pArrayField
--  Ce dernier DOIT provenir de l'évènement ChildClick ou Click
--  comme suit :
--
--maCellule   : DataField;
--maColonne : Integer;
--
--... du code
--
--event loop
--
--	... du code
--
--	when <monArrayField>.childclick(MaCellule = child) do
--
--		MaColonne = <monArrayField>.getrowforfield(MaCellule_I);
--		if MaColonne <> 0 then
--			self.LeSurligneur.SelectionnerLigne(<monArrayField>, MaColonne);
--		end if;
--
--	..... des when
--
--end loop;
--
--	Type :	Concret
--
--	Parametres :	Input	--> pArrayField
--					Output	--> pNumLigne : (<>0) le numéro de la ligne qui est
--								sélectionnée dans pArrayField
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 03/04/1997  |   Version Initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- Surligneur.SelectionnerLigne');

Self.laLigneChoisie = pNumLigne;
Self.Rafraichir(pArrayField);

/*******************************************************************
-- Declarations

 laLigneDuHaut : integer;
 laLigneDuHaut = pArrayField.toprow;

 body   : gridfield = pArrayField.bodygrid;
 numvis : integer   = pArrayField.visiblerows;
 
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

if (Self.leUnique = TRUE) then
	Self.laListeLigneChoisie.Clear();
	Self.laListeLigneChoisie[pNumLigne] = new(value = Self.laCouleurSurligne); -- pb potentiel de code DN
	Self.Rafraichir(pArrayField);
else
 -- Nombre de ligne visible dans pArrayField
 Self.laColonne = pArrayField.bodygrid.columns;

	-- check if this item has been touched before
	if (Self.laListeLigneChoisie[pNumLigne] = NIL) then
		Self.laListeLigneChoisie[pNumLigne] = new(value = Self.laCouleurSurligne);
		for col in 0 to Self.laColonne - 1 do
			body.children[  pNumLigne - laLigneDuHaut + (numvis*col) + 1].fillcolor =
				Self.laCouleurSurligne;
		end for;
		return;
	elseif Self.laListeLigneChoisie[pNumLigne].value = Self.laCouleurSurligne then
		Self.laListeLigneChoisie[pNumLigne].value = Self.laCouleurDefaut;
		for col in 0 to Self.laColonne - 1 do
			body.children[ pNumLigne - laLigneDuHaut + (numvis*col) + 1].fillcolor =
				Self.laCouleurDefaut;
		end for;
		return;
	else
		Self.laListeLigneChoisie[pNumLigne].value = Self.laCouleurSurligne;
		for col in 0 to Self.laColonne - 1 do
			body.children[  pNumLigne - laLigneDuHaut + (numvis*col) + 1].fillcolor =
				Self.laCouleurSurligne;
		end for;
		return;
	end if;
end if;

**********************************************************************************/

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- Surligneur.SelectionnerLigne : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'Surligneur.SelectionnerLigne');
		Raise;
end method;

------------------------------------------------------------
event handler Surligneur.ColumnTemplateEHdl(input pFieldWidget: DisplayProject.FieldWidget,
	input pTableau: DisplayProject.ArrayField)
begin
when pFieldWidget.AfterFocusGain do
	Self.SelectionnerLigne(pTableau, pTableau.CurrentRow);
end event;

------------------------------------------------------------
event handler Surligneur.SurligneurEHdl(input pTableau: DisplayProject.ArrayField)
begin
	for i in 1 to pTableau.Columns+1 do
		register ColumnTemplateEHdl(pTableau.GetColumnTemplate(i), pTableau);
	end for;

	when pTableau.afterfieldscrolled do
		Self.Rafraichir(pTableau);

--	when pTableau.AfterResize do
--		Task.Part.LogMgr.PutLine('Fenetre du SURLIGNEUR resizee !!!');
--		pTableau.UpdateFieldFromData();
--		-- Self.window.UpdateDisplay();
end event;

------------------------------------------------------------
method WindowCount.Init
begin
super.Init();
Self.Value = 0;
end method;

------------------------------------------------------------
method WinRecord.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ControlWindow.BuildTree(input pParent: DisplayBD.ControlWinNode,
	input pControlWinDesc: DisplayBD.ControlWinDesc)
begin
TmpWin : StandardWin;
if pParent.Parent = NIL then
	TmpWin = pControlWinDesc.InitWin;
	if TmpWin <> NIL and TmpWin.Window <> NIL then
		unNode : ControlWinNode = new;
		unNode.IsFolder = TRUE;
		unNode.IsFilled = TRUE;
		unNode.IsOpened = TRUE;
		unNode.Parent = pParent;
		unNode.WindowName = TmpWin.Window.Title.value;
		unNode.WinHdle = TmpWin;
		Self.BuildTree(unNode, pControlWinDesc);
		if unNode.FirstChild = NIL then
			unNode.IsFolder = FALSE;
			unNode.IsFilled = FALSE;
			unNode.IsOpened = FALSE;
		end if;
	end if;
	For CtrlWin in pControlWinDesc.Windows do
		For Win in CtrlWin.Objects do
			if (Win.uneWindow.Parent = NIL or Win.UneWindow.Parent.Window = NIL) and Win.uneWindow <> TmpWin then
				TmpNode : ControlWinNode = new;
				TmpNode.IsFolder = TRUE;
				TmpNode.IsFilled = TRUE;
				TmpNode.IsOpened = TRUE;
				TmpNode.Parent = pParent;
				TmpNode.WindowName = Win.uneWindow.Window.Title.value;
				TmpNode.WinHdle = Win.uneWindow;
				Self.BuildTree(TmpNode, pControlWinDesc);
				if TmpNode.FirstChild = NIL then
					TmpNode.IsFolder = FALSE;
					TmpNode.IsFilled = FALSE;
					TmpNode.IsOpened = FALSE;
				end if;
			end if;
		end for;
	End for;
	
else
	TmpWin = pParent.WinHdle;
	
	For CtrlWin in pControlWinDesc.Windows do
		For Win in CtrlWin.Objects do
			if Win.uneWindow.Parent = TmpWin then
				unNode : ControlWinNode = new;
				unNode.IsFolder = TRUE;
				unNode.IsFilled = TRUE;
				unNode.IsOpened = TRUE;
				unNode.Parent = pParent;
				unNode.WindowName = Win.uneWindow.Window.Title.value;
				unNode.WinHdle = Win.uneWindow;
				Self.BuildTree(unNode, pControlWinDesc);
				if unNode.FirstChild = NIL then
					unNode.IsFolder = FALSE;
					unNode.IsFilled = FALSE;
					unNode.IsOpened = FALSE;
				end if;
			end if;
		end for;
	End for;
end if;
end method;

------------------------------------------------------------
method ControlWindow.Display(input pControlWinDesc: DisplayBD.ControlWinDesc)
begin
--
--	Description :	Affichage de la fenêtre bureau	
--
--	Type :	Concret
--
--	Parametres :	Auncun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	10/08/1997	|	Création.
--	D. NGUYEN	  |	24/12/1997	|	Correction de bug sur sélection hors valeur.
--+
Self.Window.Title.setValue(pControlWinDesc.ApplicationName);
Self.Window.Title.Concat(' - Bureau');
Self.Window.Statustext = Status_Line;
Self.Window.DisableAppInput(isSelfDisabled=FALSE);
WinOutline = new;
WinOutline.IsFolder = TRUE;
WinOutline.IsFilled = TRUE;
WinOutline.IsOpened = TRUE;
WinOutline.WindowName = 'Root';
if Self.FlatDisplay or pControlWinDesc.InitWin = NIL then
	For CtrlWin in pControlWinDesc.Windows do
		For Win in CtrlWin.Objects do
			unNode : ControlWinNode = new;
			unNode.IsFolder = FALSE;
			unNode.IsFilled = FALSE;
			unNode.IsOpened = FALSE;
			unNode.Parent = WinOutline;
			unNode.WindowName = Win.uneWindow.Window.Title.value;
			unNode.WinHdle = Win.uneWindow;
		End for;
	end for;
else
	Self.BuildTree(WinOutline,pControlWinDesc);
end if;
self.Open();
event loop
	
	When <WinOutline>.Click(DisplayNode=Node) do
		if DisplayNode <> NIL then
			unNode : ControlWinNode = (ControlWinNode)(DisplayNode);
			unNode.WinHdle.Window.Activate();
			unNode.WinHdle.Window.BringToFront();
			exit;
		End if;	
end event;
Self.Window.EnableAppInput();
self.Close();

Return;

Exception
	When e: CancelException do
		task.Part.LogMgr.Putline('Cancel');
		Self.Window.PurgeEvents();
		Self.Close();
end method;

------------------------------------------------------------
method ControlWindow.Init
begin
super.Init();
Self.Status_Line = new;
Self.FlatDisplay = FALSE;
end method;

------------------------------------------------------------
method LoginWinDesc.Connect
begin
--
--	Description :		Méthode de connection utilisateur
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--
--	D. Nguyen	|	07/05/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- LoginWin.Connect');
If PLAY_SECURITY then
	TmpSession : SessionUserDesc;
	Self.FrontComm.connect(Self.UserName.value, Self.Password.value,TmpSession);
	if TmpSession.IdUtl > 0 then
		MyControlWin.SessionUser = TmpSession;
	else
		unExc : SecurityExc = new();
		unExc.setWithParams(severity= SP_ER_USER, Message='Données de connexion invalide : la connexion n''est pas prise en compte.');
		Raise unExc;
	end if;
	Task.Part.LogMgr.Put(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,10,'- LoginWin.Connect : SessionUser.Id=');
	Task.Part.LogMgr.Putline(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,10,MyControlWin.SessionUser.id);
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- LoginWin.Connect : End');
	if Self.<Role>.IndexValue > 0 then
		MyControlWin.SessionUser.Role = (RoleDesc)(Self.<Role>.ExtractListElement(Self.Role).ObjectValue);
	end if;
	Self.DoAfterConnect(Self.MyControlWin.SessionUser);
end if;
Return;

Exception
	When e: SecurityExc do
		Self.TraceExc(e,'LoginWinDesc.Display');
		Self.Window.MessageDialog(e.Message, MT_ERROR);
		Self.MyControlWin.SessionUser.IdUtl = 0;

end method;

------------------------------------------------------------
method LoginWinDesc.Display
begin
--
--	Description :		Exemple de méthode display pour une fenêtre simple
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--
--	D. Nguyen	|	07/05/1997	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- LoginWin.Display');
if Self.MyControlWin.SessionUser <> NIL then
	if Self.MyControlWin.SessionUSer.IdUtl > 0 then
		Self.UserName = Self.MyControlWin.SessionUser.UserName;
		Self.<Role>.SetElementList(Self.GetRoleLst(Self.UserName.value));
		if Self.MyControlWin.SessionUser.Role <> NIL then
			Self.<Role>.SetElementList(NIL);
		end if;
		Self.Role = Self.MyControlWin.SessionUser.Role.Id;
		Self.DoAfterConnect(Self.MyControlWin.SessionUser);
	end if;	
end if;
Self.<LoginBtn>.State = FS_DISABLE;

self.Open();
event loop
	when task.Shutdown do
		Self.Username = NIL;
		Self.Password = NIL;
		exit;
	when <loginBtn>.Click do
		
		if PLAY_SECURITY then
			Self.Connect();
			if Self.MyControlWin.SessionUser.IdUtl > 0 then
				exit;
			end if;
		else
			exit;
		end if;
	when <AnnulerBtn>.Click do
		Self.Username = NIL;
		Self.Password = NIL;
		Self.<LoginBtn>.State = FS_DISABLE;
		exit;
	When <UserName>.AfterValueChange do
		if Self.PassWord <> NIL then
			if not Self.PassWord.IsNull and Self.PassWord.Value <> '' then 
				-- Appel à la recherche de la liste des rôles
				Task.Part.LogMgr.PutLine('----> Recherche des listelements');
				Self.<Role>.SetElementList(Self.GetRoleLst(Self.UserName.value));
			end if;
		else
				Self.<LoginBtn>.State = FS_DISABLE;
				Self.<Role>.SetElementList(NIL);
				Self.Role = 0;
		end if;
	When <PassWord>.AfterValueChange do
		if Self.UserName <> NIL then
			if not Self.UserName.IsNull and Self.UserName.Value <> '' then 
				-- Appel à la recherche de la liste des rôles
				Task.Part.LogMgr.PutLine('----> Recherche des listelements');
				Self.<Role>.SetElementList(Self.GetRoleLst(Self.UserName.value));
				Self.<LoginBtn>.State = FS_ENABLE;
			end if;
		else
				Self.<LoginBtn>.State = FS_DISABLE;
				Self.<Role>.SetElementList(NIL);
				Self.Role = 0;
		end if;
		
end event;
if not PLAY_SECURITY then
	MyControlWin.SessionUser = new();
end if;
self.Close();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- LoginWin.Display : End');

Return;

Exception
	When e:GenericException do
		Self.TraceExc(e,'LoginWin.Display');
		Self.Window.MessageDialog('Erreur lors de la connexion...',MT_ERROR);
		Raise;
 

end method;

------------------------------------------------------------
method LoginWinDesc.DoAfterConnect(input pSessionUser: DataAccessSrvBD.SessionUserDesc)
begin
/*
Hypothèse : Parent = InitApp à l'instanciation de la fenêtre.
			L'attribut Poste (téléphonique) à été ajouté dans la fenêtre.
Exemple : (Cet exemple est applicable pour tout ajout fonctionnel)
TmpInit : InitApp = (InitApp)(Self.Parent);
if Self.Poste = 0 then
	unExc : AppExc = new();
	Raise unExc; -- Ceci necessite surcharge de la méthode Connect avec Super.Connect 
				 -- pour traitement spécifique de l'exception.
else
	TmpInit.ConnectCTI(pSessionUser.Role.AgentId, Self.Poste); -- déclenche la connexion au CTI avant de revenir à InitApp
end if;
*/
end method;

------------------------------------------------------------
method LoginWinDesc.GetRoleLst(input pUsername: Framework.string): Framework.Array of Framework.ListElement
begin
--
--	Description :		Méthode de recherche des rôles d'un utilisateur
--
--	Type :	Concret
--
--	Parametres :	Input -->	pUserName	:	UserName
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : LoginWin
--
--	History :
--
--	D. Nguyen	|	16/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,1,'- LoginWin.GetRoleLst');

aResult : Array of ListElement;
TmpRes : Array of RoleDesc = Self.FrontComm.GetRoleLst(pUserName);
TmpListElement : ListElement;

For aRole in TmpRes do
	if aResult = NIL then
		aResult = new();
	end if;
	TmpListElement = new();
	TmpListElement.IntegerValue = aRole.Id;
	TmpListElement.TextValue = aRole.Libelle;
	TmpListElement.ObjectValue = aRole;
	aResult.Appendrow(TmpListElement);	
End for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT,SP_ST_USER1,LOG_GRPFLAG,2,'- LoginWin.GetRoleLst : End');

Return aResult;

Exception
	When e:GenericException do
		Self.TraceExc(e,'LoginWin.GetRoleLst');
		Raise;
		
end method;

------------------------------------------------------------
method LoginWinDesc.Init
begin
--
--	Description :	Initialisation de la classse	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--
--	D. Nguyen	|	07/05/1997	|	Création.
--+
super.Init();
self.Username = new;
self.Password = new;


end method;

------------------------------------------------------------
method LoginWinDesc.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parametres :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	Historique :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method Logos.Display
begin
self.Open();
event loop
	when task.Shutdown do
		exit;
end event;
self.Close();
end method;

------------------------------------------------------------
method Logos.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MenuCtx.Display: DisplayProject.MenuCommand
begin
aResult : MenuCommand;
TmpWidget : FieldWidget;
TmpColor : integer;
FlagLeave : Boolean = FALSE;
self.Open();
Self.<MenuCtxGrid>.RequestFocus;
event loop
	when self.<MenuCtxGrid>.ChildClick(unWidget=Child) do
		aResult = (MenuCommand)(unWidget.AppData);
		exit;
	when self.Window.BeforeFocusLoss do
		Task.Part.LogMgr.PutLine('MenuCtx.BeforeFocusLoss');
		exit;
	when task.Shutdown do
		exit;
end event;
self.Close();
For unWidget in Self.<MenuCtxGrid>.Children do
	if unWidget.state <> FS_INVISIBLE then
		unWidget.Parent = NIL;
	end if; 
End for;

Return aResult;
end method;

------------------------------------------------------------
method MenuCtx.Init
begin
super.Init();
end method;

------------------------------------------------------------
method StandardIcons.Init
begin
super.Init();
end method;

------------------------------------------------------------
method StandardPictures.Init
begin
super.Init();
end method;

------------------------------------------------------------
method StandardWin.Action(input pCommande: DisplayProject.MenuCommand,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description :	Déclenche l'action via le manager	
--
--	Type :	Concret
--
--	Parametres :	Input	-->	pCommande : MenuCommand sélectionné par l'utilisateur
--					Input	--> pObjet :	Paramètres de l'action
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : StandardWin
--
--	Historique :
--
--	D. NGUYEN	|	29/01/1998	|	Création sur DI PGI5-S1.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.Action(MenuCommand)');

Self.AffStatusLine('');
if Self.MyActionMgr <> NIL then
	Self.MyActionMgr.Action(pCommande,pObjet);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.Action(MenuCommand) : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.Action(MenuCommand)');
		Raise;

end method;

------------------------------------------------------------
method StandardWin.Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description :	Déclenche l'action via le manager	
--
--	Type :	Concret
--
--	Parametres :	Input	-->	pAction :	Action demandée
--					Input	--> pObjet :	Paramètres de l'action
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : StandardWin
--
--	Historique :
--
--	D. NGUYEN	|	29/01/1998	|	Création sur DI PGI5-S1.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.Action(Action)');

Self.AffStatusLine('');
if Self.MyActionMgr <> NIL then
	Self.MyActionMgr.Action(pAction,pObjet);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.Action(Action) : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.Action(Action)');
		Raise;

end method;

------------------------------------------------------------
method StandardWin.ActiverBureau
begin
unControlWin : ControlWindow = new;
Start Task unControlWin.Display(Self.MyControlWin);

end method;

------------------------------------------------------------
method StandardWin.AffStatusLine(input Message: Framework.string)
begin
--
--	Description : 	Displays the text un the status bar of the window.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	Message : Message to be displayed
--
--	Pre-condition : None
--
--	Post-condition : The message is displayed
--
--	Exceptions : None
--
--	Usage : StandardWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
Status_Line = Message;
Self.Window.StatusText = Status_Line;

end method;

------------------------------------------------------------
method StandardWin.AffStatusLine(input Message: Framework.TextData)
begin
--
--	Description : 	Affiche le message dans la zone de status à partir d'un message de type TextData.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	Message :	Message à afficher
--
--	Pre-condition : le message est différent de NIL
--
--	Post-condition : le message est affiché
--
--	Exceptions : Aucune
--
--	Usage : StandardWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Création.
--+
AffStatusLine(Message.Value);
end method;

------------------------------------------------------------
method StandardWin.Display
begin
--
--	Description : 	Display of the Data Window
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : The window exists
--
--	Post-condition : The window is displayed
--
--	Exceptions : None
--
--	Usage : DataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.Display');

Self.InitDisplay(Self.FlagInitReadData);
self.Open();
Self.EventLoop();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.Display : End');

Return;

Exception

	When e: CancelException do
		Task.Part.LogMgr.PutLine('!!!!!!!!!!!! Sortie sur CancelException');
		ExitWindow();
		Task.Part.LogMgr.Putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DataWin : Display... Task Canceled');
		Return;

	When e: CtrlTooManyInstanceExc do
		Self.AffStatusLine('Trop d''instances de cette fenêtre...');
		Self.EventLoop();

	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.Display');
		Raise;
		
end method;

------------------------------------------------------------
method StandardWin.Display(input aWindow: DisplayBD.StandardWin,
	input Mode: Framework.integer,
	input pParent: DisplayBD.StandardWin = NIL)
begin
--
--	Description : 	Display of the Data Window using the Window Controler.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aWindow :	Window to display
--					Input -->	Mode :	Mode of display
--
--	Pre-condition : The window exists
--
--	Post-condition : The window is displayed
--
--	Exceptions : None
--
--	Usage : DataWin.NewWindow
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

MyControlWin.display(aWindow,Mode,APP_APPLICATIONNAME,pParent);

Return;
end method;

------------------------------------------------------------
method StandardWin.DoBeforeCloseWindow
begin
--
--	Description :	Cette méthode est appelée juste avant de fermer
--					la fenêtre.
--
--	Limitation	 :	Il convient de ne pas de créer de tâches dans cette
--					méthode, a moins d'assurer la synchronisation
--					d'une manière sure.
--					Dans le cas contraire, la sortie de la fenêtre
--					se poursuivrait, ne permettant probablement pas
--					au traitement de cette méthode de se terminer.
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> aucun
--					Output	--> aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 04/03/1998  |   Version initiale.
--+

-- Declarations

-- Traitement

-- Peut être utilisé au niveau concret.

-- Fin du traitement
end method;

------------------------------------------------------------
method StandardWin.DoBeforeQuitApplication
begin
--
--	Description :	Cette méthode est appelée juste avant de quitter
--					l'application. Elle peut permettre de désalouer
--					des resources externes sur le poste client
--					comme des dll d'intégration ...
--
--	Limitation	 :	Il convient de ne pas de créer des tâches dans cette
--					méthode, a moins d'assurer la synchronisation
--					d'une manière sure.
--					Dans le cas contraire, la sortie de l'application
--					se poursuivrait , ne permettant probablement pas
--					au traitement de cette méthode de se terminer.
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> aucun
--					Output	--> aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 04/03/1998  |   Version initiale.
--+

-- Declarations

-- Traitement

-- Peut être utilisé au niveau concret.

-- Fin du traitement



end method;

------------------------------------------------------------
method StandardWin.EventLoop
begin
event loop
	Preregister
		register EventLoopHandler();
	PostRegister
		PostEventLoop();
end event;

Return;

Exception

	When e: CtrlTooManyInstanceExc do
		Self.AffStatusLine('Trop d''instances de cette fenêtre...');
		Self.EventLoop();

	When e: CancelException do
		Task.Part.LogMgr.PutLine('!!!!!!!!!!!! Sortie sur CancelException');
		ExitWindow();
		Task.Part.LogMgr.Putline(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.EventLoop... Task Canceled');
		Return;

	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.Display');
		Raise;

end method;

------------------------------------------------------------
method StandardWin.ExitWindow
begin
--
--	Description : 	Operations done just before closing the window.
--					The current action is finished properly and currents locks are unlocked.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The window is ready to be closed.
--
--	Exceptions : None
--
--	Usage : DataWin
--
--	Historique :
--
--	D. NGUYEN		|	21/05/1997	|	Creation.
--  JB BRIAUD       |   05/03/1998  |   Quit event & DoBefore.
--	D. NGUYEN		|	17/03/1998	|	Remise à niveau : conception d'origine de la sortie.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.ExitWindow');

DoBeforeCloseWindow();

-- MyControlWin.PostJustBeforeEffectiveKill();

--Task.PostShutDown();
Self.RegisterClose();
Self.RecycleMemory(); -- To correct a bug of deallocation of the nested windows
--self.Close();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.ExitWindow : End');

end method;

------------------------------------------------------------
method StandardWin.Fermer
begin
--
--	Description :	Fermeture de la fenêtre.
--
--	Type :	Concret
--
--	Parametres :	Input	-->
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	JB BRIAUD	|	05/03/1998	|	Ajout du cartouche.
--	D. NGUYEN	|	17/03/1998	|	Changement de conception : retour au principe d'origine (shutdown).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Fermer');

-- Declarations
Rep : Integer;
	
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- The purpose is to seek for the initwin in the ControlWin.
-- If we are the InitWin then, ShutDown is equal to Quit application.
if Self.MyControlWin <> Nil 
	and Self.MycontrolWin.InitWin = Self 
	and not Self.IsShutdownConfirmed 
	and not FermerEvtFlag then
		Self.Quitter();
		Self.IsShutdownOK = FALSE;
else -- We aren't the InitWin
	Self.IsShutdownOK = TRUE;
	if not Self.IsShutdownConfirmed and Self.<Panel0>.HasDataChanged then
		Rep = Self.Window.Questiondialog(Self.MSG_QUIT_2, BS_YESNOCANCEL, BV_YES);
		Self.IsShutdownConfirmed = TRUE;
	elseif not Self.IsShutdownConfirmed and not Self.<Panel0>.HasDataChanged and Self.IsChanged then
		Rep = Self.Window.Questiondialog(Self.MSG_QUIT_2, BS_YESNO, BV_YES);
		Self.IsShutdownConfirmed = TRUE;
	end if;
end if;
if Self.IsShutdownOK then
	Self.IsShutdownConfirmed = FALSE;
	Self.ExitWindow();
	if Self.MyControlWin <> NIL then
		Post Self.MyControlWin.FermerEvt;
	end if;
end if;


-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Fermer : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.Fermer');
		Raise;
end method;

------------------------------------------------------------
method StandardWin.GetParamAction(input pCodeParam: Framework.integer): DataAccessSrvBD.ParamDesc
begin
--
--	Description :	Get an Action from the UserSession.	
--
--	Type :	Concret
--
--	Parametres :	Input	--> pCodeParam :	Code of the parameter wanted
--					Return	--> ParamDesc corresponding to the parameter (NIL if no parameter).
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : StandardWin
--
--	Historique :
--
--	D. NGUYEN	|	06/02/1998	|	Création.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.GetParamAction');

-- Declarations
aResult : ParamDesc;

-- Traitement
if Self.ActionHab <> NIL then
	aResult = Self.ActionHab.GetParam(pCodeParam);
End if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.GetParamAction : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.GetParamAction');
		Raise;
end method;

------------------------------------------------------------
method StandardWin.GetStructureDesc(input pObject: DataAccessSrvBD.ObjectSelfDesc,
	input pItemName: Framework.TextData): DataAccessSrvBD.StructureDesc
begin
--
--	Description : Parcours les attributs et les liens d'un ObjetMetier (ObjectSelfDesc)
--  a la recherche d'un element auto-descriptif (StructureDesc) dont on donne le nom interne.
--
--	Type :	Concret
--
--	Parametres :	Input	--> pObject : ObjectSelfDesc
--					Output	--> pItemName : TextData
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 12/10/1997  |   Version initiale. 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.GetStructureDesc');

-- Declarations

unResult : StructureDesc;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement
if pObject <> NIL then
	pObject.DoResetAttributes();
	if pObject.SelfDesc = NIL then
		pObject.SelfDesc = New();
	end if;
	pObJect.DoResetSelfDesc();
	
	for uneStruct in pObject.SelfDesc do
		-- Condition d'arret
		if unResult <> NIL then
			exit;
		end if;
		if uneStruct <> NIL then
			if pItemName.IsEqual(Source = uneStruct.ItemName, IgnoreCase = TRUE) then
				unResult = uneStruct;
				
			elseif uneStruct.ItemReference.IsA(ObjectSelfDesc) then
				unResult = GetStructureDesc((ObjectSelfDesc)(uneStruct.ItemReference), pItemName);
			
			elseif uneStruct.ItemReference.IsA(GenericArray) then
				-- Il suffit dans ce cas de retourner le *premier* StructureDesc
				-- si toutefois l'ItamName correspond au critere de recherche.
				
				if (GenericArray)(uneStruct.ItemReference) = NIL then
					uneStruct.ItemReference = New();
				end if;
				(GenericArray)(uneStruct.ItemReference).AppendRow();
				unObject : Object = (Object)((GenericArray)(uneStruct.ItemReference).FindObjectForRow(1));
				
				if unObject.IsA(ObjectSelfDesc) then
					unObjectSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(unObject);
					unResult = GetStructureDesc(unObjectSelfDesc, pItemName);
				end if; -- IsA(ObjectSelfDesc)
				-- Dans le cadre d'un ObjectSelfDesc, il n' peut y avoir que
				-- des tableaux d'ObjectSelfDesc. Les autres cas de tableaux
				-- sont invalides.
			end if;
		end if; -- uneStruct <> NIL
	end for; -- uneStruct
end if; -- pObjet <> NIL

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.GetStructureDesc : End');
Return unResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardWin.GetStructureDesc');
		Raise;
end method;

------------------------------------------------------------
method StandardWin.Init
begin
super.init;
--IcWin:StandardIcons=new;
--Self.Window.IconImage=IcWin.<AppIcon>.ImageValue;
Self.Window.StatusText=Status_Line;
Self.MaximumInstance = 9999;		-- Maximum number of instance displayed
-- DN 17/10/97 : Pb R3 Self.Window.Menu.State = MS_INVISIBLE;
Self.FlagInitReadData = TRUE;
Self.CodeAction = ACT_DETAIL;
Self.FermerEvtFlag = FALSE;

end method;

------------------------------------------------------------
method StandardWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.InitDisplay');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.InitDisplay : End');

Return;

end method;

------------------------------------------------------------
method StandardWin.NewWindow
begin
hWin : StandardWin;
unClassType : ClassType = Self.GetClassType();
hWin = (StandardWin)(unClassType.InstanceAlloc());
Self.MyControlWin.Display(hWin,CTW_ASYNCDISP);
end method;

------------------------------------------------------------
method StandardWin.PostEventLoop
begin

end method;

------------------------------------------------------------
method StandardWin.PrintCmd
begin
Doc : PrintDocument;
ClonedWindow : StandardWin;
aStandardWinRTpl : StandardWinRTpl= new;
aDateTime : DateTimeData = new;
TmpTxt : TextData = new;
if self.Window.PrintDialog(
		PrintOptions = Self.Window.WindowSystem.DefaultPrintOptions,
		ShowSetUpDialog = FALSE,
		ShowJobDialog = TRUE) = BV_OK then
	TmpTxt.SetValue(Self.Window.Title);
	aStandardWinRTpl.<Title>.Text.value = TmpTxt.value;
	aDateTime.setcurrent();
	aStandardWinRTpl.<Date>.Text.Setvalue(aDateTime);
	aStandardWinRTpl.<ReportGrid>.HeightPolicy = SP_NATURAL;
	Doc = Self.Window.WindowSystem.OpenPrintDocument(
		PrintOptions = Self.Window.WindowSystem.DefaultPrintOptions,
		DocName = TmpTxt.value);
	ClonedWindow = (StandardWin)(Self.CloneWindowOnly());
--			Doc.SetWorkingPage(Page=aStandardWinRTpl, HeightPolicy = SP_NATURAL, WidthPolicy=SP_EXPLICIT); -- DN 16/12/96
	Doc.SetWorkingPage(Page=aStandardWinRTpl, HeightPolicy = SP_NATURAL, WidthPolicy=SP_TO_PARENT); -- DN 16/12/96
	ClonedWindow.Window.Row = 2;
	ClonedWindow.Window.Column = 1;
	ClonedWindow.Window.Parent = aStandardWinRTpl.<ReportGrid>; 
	ClonedWindow.Resize(ClonedWindow.Window,SP_NATURAL,SP_TO_PARENT);
	aStandardWinRTpl.Window.UpdateFieldFromData();
	ClonedWindow.Window.ExpandFieldForPrint(
	  isRecursive = TRUE, RemoveScrollBars = TRUE);
	aStandardWinRTpl.Window.UpdateFieldFromData();
	
	Doc.PrintWorkingPage();
	self.Window.WindowSystem.ClosePrintDocument(PrintDoc = Doc);
end if;
Exception
	When e: CancelException do
		Self.AffStatusLine('Impression annulée...');
	Else Do
		Self.Window.WindowSystem.CancelPrintDocument(PrintDoc = Doc);
		Raise;

end method;

------------------------------------------------------------
method StandardWin.Quitter
begin
--
--	Description :	Quitte l'application.
--
--	Type :	Concret
--
--	Parametres :	Input	-->
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	JB BRIAUD	|	05/03/1998	|	Initial version.
--	D. NGUYEN	|	22/03/1998	|	Debug from Forte "bug" on Main task.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Quitter');

-- Declarations
Rep : Integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

if Self.<Panel0>.HasDataChanged then
	Rep = Self.Window.Questiondialog(Self.MSG_QUITALL_3, BS_YESNOCANCEL, BV_CANCEL);
	if Rep = BV_NO then
		Self.<Panel0>.HasDataChanged = FALSE;
		Self.IsShutdownConfirmed = TRUE;
		Self.IsShutdownOK = TRUE;
	elseif Rep = BV_YES then
		Self.IsShutdownConfirmed = TRUE;
		Self.IsShutdownOK = TRUE;
	else
		Self.IsShutdownOK = FALSE;
		Self.IsShutdownConfirmed = FALSE;
	end if;
else -- HasDatachanged
	Rep = Self.Window.Questiondialog(Self.MSG_QUITALL_2, BS_YESNO, BV_NO);
	if Rep = BV_YES then
		Self.IsShutdownConfirmed = TRUE;
		Self.IsShutdownOK = TRUE;
	else
		Self.IsShutdownConfirmed = FALSE;
		Self.IsShutdownOK = FALSE;
	end if;
end if; -- HasDataChanged

if Self.IsShutdownOK then
	DoBeforeQuitApplication();
	if Self.MyControlWin.InitWin <> NIL then
		start task MyControlWin.Quitter();
	else
		self.Fermer();
	end if;
	
end if;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Quitter : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.Quitter');
		Raise;
end method;

------------------------------------------------------------
method StandardWin.RegisterClose(input aWindow: DisplayBD.StandardWin)
begin
--
--	Description : 	Registering of the close of the window in the window controler.
--					This method must be overloaded in concret level to define the name
--					of the window controler service object 
--
--	Type :	Abstract
--
--	Parametres :	Input -->	aWindow :	Window to close
--
--	Pre-condition : The Window exists
--
--	Post-condition : The window is no more referenced in the controler.
--
--	Exceptions : None
--
--	Usage : UserWin
--
--	Historique :
--
--	D. NGUYEN		|	9/06/1997	|	Creation.
--+

MyControlWin.RegisterClose(aWindow);

end method;

------------------------------------------------------------
method StandardWin.RegisterClose
begin
--
--	Description : 	Registering of the close of the window in the window controler.
--					This method must be overloaded in concret level to define the name
--					of the window controler service object 
--
--	Type :	Abstract
--
--	Parametres :	Input -->	aWindow :	Window to close
--
--	Pre-condition : The Window exists
--
--	Post-condition : The window is no more referenced in the controler.
--
--	Exceptions : None
--
--	Usage : UserWin
--
--	Historique :
--
--	D. NGUYEN		|	9/07/1997	|	Creation.
--+

if MyControlWin <> NIL then
	MyControlWin.RegisterClose(Self);
end if;
end method;

------------------------------------------------------------
method StandardWin.RequestFocusOn(input ItemName: Framework.string,
	input aWidget: DisplayProject.Widget)
begin

-- Recursive Method which Requests focus on the field with the ItemName

if aWidget.Isa(Type=CompoundField) then
	For aField in (CompoundField)(aWidget).children do
		if aField.Name.Value = ItemName then
			aField.RequestFocus();
			exit;
		else
			Self.RequestFocusOn(ItemName = ItemName, aWidget=aField); 
		End if;
	End For;
end if;
end method;

------------------------------------------------------------
method StandardWin.Resize(input aCompound: DisplayProject.CompoundField,
	input HeightPolicy: Framework.integer,
	input WidthPolicy: Framework.integer)
begin

-- Recursive Method which changes size policy from a widget to his children

If HeightPolicy <> 0 then
	aCompound.HeightPolicy = HeightPolicy;
end if;
If WidthPolicy <> 0 then
	aCompound.WidthPolicy = WidthPolicy;
end if;
For aField in aCompound.children do
	if aField.Isa(Type=CompoundField) then
		Self.Resize(aCompound = (CompoundField)(aField), HeightPolicy = HeightPolicy, WidthPolicy = WidthPolicy); 
	End if;
End For;

end method;

------------------------------------------------------------
method StandardWin.SetStateForUsage(input aWidget: DisplayProject.Widget,
	input aFieldName: Framework.TextData,
	input aUsage: Framework.integer,
	input aState: Framework.integer)
begin

-- Recursive Method which changes the state for usage from a widget to his children with the name of aFieldName

if aWidget.Isa(Type=CompoundField) then
	For aField in (CompoundField)(aWidget).children do
		Self.SetStateForUsage(aWidget = aField, aFieldName = aFieldName, aUsage = aUsage, aState = aState); 
	End For;
Elseif aWidget.Isa(Type=FieldWidget) then
	if aWidget.Name.Value = aFieldName.Value then
		(FieldWidget)(aWidget).SetstateForUsage(Usage=aUsage, State = aState);
	End if;
End if;


end method;

------------------------------------------------------------
method StandardWin.TraceExc(input aExc: Framework.GenericException,
	input Source: Framework.string)
begin
--
--	Description : 	Méthode standard de trace des exceptions.
--					Son usage est fortement recommandé dans les blocs d'exception.
--
--	Type :	Abstract
--
--	Parametres :	Input	--> aExc 	:	Exception à traiter
--					Input	--> Source 	:	Class.Method ayant détecté l'exception
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Global
--
--	Historique :
--
--	D.NGUYEN	|	18/04/1997	|	Création.
--+

TmpMsg : TextData = new();
TmpMsg.setValue('* Exc : ');
TmpMsg.Concat(Source);
TmpMsg.concat('... \n');
TmpMsg.Concat(aExc.Message);
TmpMsg.Concat(' - Severity : ');
TmpMsg.concat(aExc.severity);
Task.Part.LogMgr.PutLine(SP_MT_DEBUG,SP_ST_USER1,LOG_GRPFLAG,1,TmpMsg);

Return;
end method;

------------------------------------------------------------
method StandardWin.Transfer: Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method Transfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class DataWin
--
--	Pre-condition : Refer to Abstract method of the class DataWin
--
--	Post-condition : Refer to Abstract method of the class DataWin
--
--	Exceptions : Refer to Abstract method of the class DataWin
--
--	Usage : StandardWin
--
--	Historique :
--
--	D. NGUYEN	|	05/12/1996	|	Creation.
--	D. NGUYEN	|	30/01/1998	|	Prise en compte de l'interface.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin.Transfer');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardWin.Transfer : End');

Return Self.Transfer(MyTransData, MyTransType, MyClassType, StdEventNotifier);


end method;

------------------------------------------------------------
method StandardWin.Transfer(input aTransData: DataAccessSrvBD.TransDesc,
	input aServiceMgr: DataAccessSrvBD.ServiceMgrDesc,
	input aClassType: Framework.ClassType,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method Transfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class DataWin
--
--	Pre-condition : Refer to Abstract method of the class DataWin
--
--	Post-condition : Refer to Abstract method of the class DataWin
--
--	Exceptions : Refer to Abstract method of the class DataWin
--
--	Usage : StandardWin
--
--	Historique :
--
--	D. NGUYEN	|	30/01/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardWin : Transfer');
aResult : Object;
if FrontComm = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'StandardWin.Transfer : Attribute FrontComm is NIL');
	Raise e;
elseif not (aServiceMgr.IsA(InterfaceMgrDesc) or aServiceMgr.IsA(BusinessServiceMgrDesc)) then
 	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'StandardWin.Transfer : Bad service manager');
	Raise e;
end if;
if aServiceMgr.IsA(BusinessServiceMgrDesc) then
	aResult = FrontComm.Transfer(aTransData, (BusinessServiceMgrDesc)(aServiceMgr), aClassType, aTransOrigin);
else
	aResult = FrontComm.Transfer(aTransData, (InterfaceMgrDesc)(aServiceMgr), aClassType, aTransOrigin);
end if;

Return aResult;

end method;

------------------------------------------------------------
event handler StandardWin.EventLoopHandler()
begin
/*
When <Print>.Activate do
	PrintCmd();
When <NewWindow>.Activate do
	NewWindow();
*/
when Self.Window.FunctionKeyPress(unTouche=keyId,unMod=modifier) do
	if unTouche = FN_F5 and unMod = 0 then
		Self.ActiverBureau();
	end if;

	When Self.FermerEvt do
		Self.FermerEvtFlag = TRUE;
		Task.PostShutDown();

	when task.Shutdown do
		Fermer();
		if Self.IsShutdownOK then
			exit;
		end if;
/*
When Self.FermerEvt do
	Task.PostShutDown();
--	Self.Fermer();
--	Exit;

when task.shutdown do
	if Self.MyControlWin <> Nil and Self.MycontrolWin.InitWin = Self then
		Self.Quitter();
	else
		Self.Fermer();
		exit;
	end if;
*/
end event;

------------------------------------------------------------
event handler StandardWin.ResizeEHandler()
begin

end event;

------------------------------------------------------------
method StandardWinRTpl.Init
begin
super.Init();
end method;

------------------------------------------------------------
method StdBtn.Display
begin
self.Open();
event loop
	when task.Shutdown do
		exit;
	when <SignalBtn>.Click do
		Self.<SignalBtn>.State = FS_DISABLE;

end event;
self.Close();
end method;

------------------------------------------------------------
method StdBtn.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ToolBarModel.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 1;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'displayb';


end DisplayBD;
begin TOOL InterfacesBD;

includes DataAccessSrvBD;
includes FrameworkBD;
includes DisplayProject;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  InterfaceAofExc;
forward  InterfaceCrpExc;
forward  InterfaceCtiExc;
forward  InterfaceExc;
forward  InterfaceGedExc;
forward  InterfaceMqsExc;
forward  InterfaceUniExc;
forward  TransInterfaceAofDesc;
forward  TransInterfaceCrpDesc;
forward  TransInterfaceCtiDesc;
forward  TransInterfaceDesc;
forward  TransInterfaceGedDesc;
forward  TransInterfaceMqsDesc;
forward  TransInterfaceUniDesc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class InterfaceExc inherits from FrameworkBD.GenericExc

has public  attribute CompletionCode: Framework.integer;
has public  attribute NativeCode: Framework.integer;
has public  attribute NativeMessage: Framework.TextData;
has public  attribute ReasonCode: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceAofExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceCrpExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceCtiExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceGedExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceMqsExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class InterfaceUniExc inherits from InterfacesBD.InterfaceExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceDesc inherits from DataAccessSrvBD.TransDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceAofDesc inherits from InterfacesBD.TransInterfaceDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceCrpDesc inherits from InterfacesBD.TransInterfaceDesc

has public  attribute Canal: Framework.integer;
has public  attribute Mode: Framework.integer;
has public  attribute Val: Framework.boolean;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceCtiDesc inherits from InterfacesBD.TransInterfaceDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceGedDesc inherits from InterfacesBD.TransInterfaceDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceMqsDesc inherits from InterfacesBD.TransInterfaceDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TransInterfaceUniDesc inherits from InterfacesBD.TransInterfaceDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method InterfaceAofExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceCrpExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceCtiExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceExc.Init
begin
super.Init();
Self.setWithParams(severity= SP_ER_USER, Message='Problème interface : ');

end method;

------------------------------------------------------------
method InterfaceGedExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceMqsExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceUniExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceAofDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceCrpDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceCtiDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceGedDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceMqsDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransInterfaceUniDesc.Init
begin
super.Init();
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'interfac';


end InterfacesBD;
begin TOOL CtiItBD;

includes Annuaire;
includes DataAccessSrvBD;
includes DisplayBD;
includes FrameworkBD;
includes InterfacesBD;
includes DDEProject;
includes DisplayProject;
includes Framework;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionMgrCtiDesc;
forward  AnnulerAppelCampagneParam;
forward  AppelClientParam;
forward  ApplicatifCTI;
forward  BarreCTI is mapped;
forward  ComplementaryDDEData;
forward  ConferenceEVTParam;
forward  CTIApplicatif;
forward  CTIEventParam;
forward  CTIGraveExc;
forward  CTITechExc;
forward  DDEData;
forward  DiffererAppelCampagneParam;
forward  EvenementSoftphone;
forward  InfoAppelParam;
forward  InfoClientParam;
forward  InitialiserConsultationParam;
forward  InterfaceCTI;
forward  LoginParam;
forward  MCConferenceWin is mapped;
forward  MCTransfertWin is mapped;
forward  ParamCTI;
forward  ReecouteParam;
forward  RendezVous;
forward  TransfertDirectParam;
forward  TransfertEVTParam;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant CTI_KEY_AGENTID = 'AGENTID';
constant CTI_KEY_APPID = 'APPLICATIONID';
constant CTI_KEY_CALLTYPE = 'CALLTYPE';
constant CTI_KEY_CAMPAGNE = 'GSW_CAMPAIGN_NAME';
constant CTI_KEY_CLIENTID = 'CLIENTID';
constant CTI_KEY_ENREGISTREMENT = 'RECORD';
constant CTI_KEY_GSW_RECORD_HANDLE = 'GSW_RECORD_HANDLE';
constant CTI_KEY_TRANSACTIONID = 'TRANSACTIONID';
constant CTI_MES_ACTIF = '1';
constant CTI_MES_INACTIF = '0';
constant CTI_SPW_STATUS = 'MIN';
constant CTI_SVI_DEBPLAGE1 = 22100;
constant CTI_SVI_DEBPLAGE2 = 22200;
constant CTI_SVI_FINPLAGE1 = 22111;
constant CTI_SVI_FINPLAGE2 = 22211;
constant LOG_GRPFLAG = 30;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ActionMgrCtiDesc inherits from DisplayBD.ActionMgrDesc

has public  attribute TransDataInterfaceCTI: InterfacesBD.TransInterfaceCtiDesc;

has public  method Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL);
has public  method ActionCTI(input pAction: Framework.integer,
	input pObjet: Framework.Object);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class AnnulerAppelCampagneParam inherits from Framework.Object

has public  attribute pNomCampagne: Framework.string;
has public  attribute pTelephone: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class AppelClientParam inherits from Framework.Object

has public  attribute pCLIENTID: Framework.string;
has public  attribute pCLIENTPHONE: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ApplicatifCTI inherits from FrameworkBD.ObjectBD

has private constant CSP_ANSWERCALL = 'AnswerCall';
has private constant CSP_ATTACHDATA = 'UpdateData';
has private constant CSP_ATTACHDATAEX = 'AttachDataEx';
has private constant CSP_CALLPARK = 'ParkCall';
has private constant CSP_CALLPICKUP = 'PickUpCall';
has private constant CSP_CANCELFORWARD = 'CancelForward';
has private constant CSP_CLOSE = 'Close';
has private constant CSP_CONFCOMPLETE = 'ConfComplete';
has private constant CSP_CONFINIT = 'ConfInit';
has public  constant CSP_DELETEALLUSERDATA = 'DeleteAllUserData';
has private constant CSP_DELETEDATA = 'DeleteData';
has private constant CSP_DIAL = 'Dial';
has private constant CSP_FORWARD = 'Forward';
has public  constant CSP_HOLDCALL = 'HoldCall';
has private constant CSP_LOGIN = 'LogIn';
has private constant CSP_LOGOUT = 'LogOut';
has private constant CSP_OPEN = 'Open';
has private constant CSP_REGISTERDNS = 'RegisterDNs';
has private constant CSP_RELEASECALL = 'ReleaseCall';
has private constant CSP_RETRIEVECALL = 'RetrieveCall';
has public  constant CSP_SENDUSEREVENT = 'SendUserEvent';
has public  constant CSP_SETAFTERCALLWORK = 'SetAfterCallWork';
has private constant CSP_SETBUSY = 'SetBusy';
has public  constant CSP_SETMANUALREADY = 'SetManualReady';
has private constant CSP_SETNOTBUSY = 'SetNotBusy';
has private constant CSP_SETNOTREADY = 'SetNotReady';
has private constant CSP_SETREADY = 'SetReady';
has private constant CSP_TRANSFERCOMPLETE = 'TransferComplete';
has private constant CSP_TRANSFERINIT = 'TransferInit';
has private constant CSP_TRANSFERMUTE = 'TransferMute';
has public  constant CSP_UNHOLDCALL = 'UnHoldCall';
has private constant CSP_UNREGISTERDNS = 'UnregisterDNs';
has private constant CSP_UPDATEDATA = 'UpdateData';

has public  attribute Connected: Framework.boolean;
has public  attribute local: CtiItBD.ParamCTI;
has private attribute SystemConversation: DDEProject.DDEConversation;

has public  event Terminer;

has public  method AcquitterRappel;
has public  method AnnulerAppelCampagne(input pParam: CtiItBD.AnnulerAppelCampagneParam);
has public  method AnnulerConsultation;
has public  method AppelClient(input pParam: CtiItBD.AppelClientParam);
has public  method ArreterEnregistrement;
has public  method Attente;
has public  method ChangementMotDePasse;
has public  method ConsultationCompte;
has public  method Decroche;
has public  method DemarrerEnregistrement;
has public  method DiffererAppelCampagne(input pParam: CtiItBD.DiffererAppelCampagneParam);
has private method ExecCommande(input pCommande: Framework.string,
	input pParam1: Framework.string = '(nul)',
	input pParam2: Framework.string = '(nul)',
	input pParam3: Framework.string = '(nul)',
	input pParam4: Framework.string = '(nul)');
has private method ExecuteCde(input command: Framework.TextData);
has public  method InfoAppel(input pParam: CtiItBD.InfoAppelParam);
has public  method InfoClient(input pParam: CtiItBD.InfoClientParam);
has public  method Init;
has public  method InitialiserConnection;
has public  method InitialiserConsultation(input pParam: CtiItBD.InitialiserConsultationParam);
has public  method Liberer;
has public  method Login(input pParam: CtiItBD.LoginParam);
has public  method Logout;
has public  method MajCampagne;
has public  method Pause;
has public  method Quitter;
has public  method Raccroche;
has public  method RecupereAppel;
has public  method Reecoute(input pParam: CtiItBD.ReecouteParam);
has public  method ReecouteClient;
has public  method registerEcouteEtat where completion = (return = registerEcouteEtatDone, exception = registerEcouteEtatNotDone);
has public  method registerEventHandler;
has private method RequestExec(input command: Framework.TextData);
has public  method SetAfterCallWork;
has public  method SetManualReady;
has public  method SetNotReady;
has public  method TerminerConnection;
has public  method TransfertDirect(input pParam: CtiItBD.TransfertDirectParam);
has public  method ValiderConference;
has public  method ValiderTransfert;
has private method zzzTraceSPEvent(input pSP_EVENT: Framework.string,
	input pDATA: CtiItBD.DDEData);

has private event handler EcouteEtatEVH();
has private event handler ExecCompleteEH(input command: Framework.TextData,
	input tryCount: Framework.integer);

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ComplementaryDDEData inherits from Framework.Object

has public  attribute Key: Framework.string;
has public  attribute Value: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ConferenceEVTParam inherits from FrameworkBD.ObjectBD

has public  attribute type_conf: Framework.integer;
has public  attribute validation: Framework.boolean;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class CTIApplicatif inherits from FrameworkBD.ObjectBD

has private constant ESP_ADDRESSALLOCATED = 'EventAddressAllocated';
has private constant ESP_ADDRESSFREED = 'EventAddressFreed';
has private constant ESP_ADDRESSINFO = 'EventAddressInfo';
has private constant ESP_AGENTAFTERCALLWORK = 'EventAgentAfterCallWork';
has private constant ESP_AGENTBUSY = 'EventAgentBusy';
has private constant ESP_AGENTLOGIN = 'EventAgentLogin';
has private constant ESP_AGENTLOGOUT = 'EventAgentLogout';
has private constant ESP_AGENTMANUALREADY = 'EventAgentManualReady';
has private constant ESP_AGENTNOTBUSY = 'EventAgentNotBusy';
has private constant ESP_AGENTNOTREADY = 'EventAgentNotReady';
has private constant ESP_AGENTREADY = 'EventAgentReady';
has private constant ESP_ATTACHEDDATACHANGED = 'EventAttachedDataChanged';
has private constant ESP_CALLFORWARDCANCEL = 'EventCallForwardCancel';
has private constant ESP_CALLFORWARDSET = 'EventCallForwardSet';
has private constant ESP_CALLHOLDED = 'EventCallHolded';
has private constant ESP_CALLPARKED = 'EventCallParked';
has private constant ESP_CALLUNHOLDED = 'EventCallUnHolded';
has private constant ESP_CALLUNPARKED = 'EventCallUnParked';
has private constant ESP_CONFERENCED = 'EventConferenced';
has private constant ESP_DESTINATIONBUSY = 'EventDestinationBusy';
has private constant ESP_DIALING = 'EventDialing';
has private constant ESP_ERROR = 'EventError';
has private constant ESP_ESTABLISHED = 'EventEstablished';
has private constant ESP_RELEASED = 'EventReleased';
has private constant ESP_RETRIEVED = 'EventRetrieved';
has private constant ESP_RINGING = 'EventRinging';
has private constant ESP_SERVERDISCONNECT = 'EventServerDisconnect';
has private constant ESP_SPERROR = 'EventSPError';
has private constant ESP_TRANSFERED = 'EventTransfered';
has public  constant ESP_USEREVENT = 'EventUserEvent';

has public  attribute Connected: Framework.boolean;
has private attribute laListeEvenementSoftphone: Framework.Array of CtiItBD.EvenementSoftphone;
has public  attribute local: CtiItBD.ParamCTI;
has public  attribute SoftPhoneConversation: DDEProject.DDEConversation;

has public  event CtiApplicatifEvt(input EventCode: Framework.integer,
	input EventData: CtiItBD.CTIEventParam = NIL);
has public  event Terminer;

has public  method AnnulePrepareTransfert;
has public  method AppelArrive(input typeAppel: Framework.string);
has public  method EstSvi(input pNumTel: Framework.string): Framework.boolean;
has public  method Init;
has public  method InitialiserConnection;
has public  method LinkStartSoftPhone;
has public  method NotifierEvenement(copy input pCodeEvt: Framework.integer,
	copy input pParam1: Framework.string = '\'\'',
	copy input pParam2: Framework.string = '\'\'',
	copy input pParamBool: Framework.boolean = FALSE,
	copy input pParamBool2: Framework.boolean = FALSE,
	copy input pParamBool3: Framework.boolean = FALSE,
	copy input pParamBool4: Framework.boolean = FALSE,
	copy input pParamStringSup: Framework.string = '\'\'');
has public  method PrepareTransfert;
has public  method ReactionAgentLogin;
has public  method ReactionAgentLogout;
has public  method ReactionAgentManualReady;
has public  method ReactionAgentNotReady;
has public  method ReactionAgentReady;
has public  method ReactionConferenced;
has public  method ReactionDestinationBusy;
has public  method ReactionDialing;
has public  method ReactionEstablished;
has public  method ReactionReleased;
has public  method ReactionRinging;
has public  method ReactionTransfered;
has public  method ReactionUserEvent;
has public  method registerEcouteEtat where completion = (return = registerEcouteEtatDone, exception = registerEcouteEtatNotDone);
has public  method registerHotLink where completion = (return = registerHotLinkDone, exception = registerHotLinkNotDone);
has public  method Sync;
has public  method TerminerConnection;
has private method TraitementEvenement(input pNomEvenement: Framework.string,
	input pDataEvenement: Framework.TextData);

has private event handler EcouteEtatEVH();
has public  event handler HotLinkEVH();

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=on, override=on, default=off);

end class;

class CTIEventParam inherits from Framework.Object

has public  attribute Param1: Framework.string;
has public  attribute Param2: Framework.string;
has public  attribute Param3: Framework.string;
has public  attribute ParamBool: Framework.boolean;
has public  attribute ParamBool2: Framework.boolean;
has public  attribute ParamBool3: Framework.boolean;
has public  attribute ParamBool4: Framework.boolean;
has public  attribute paramInt: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class CTIGraveExc inherits from InterfacesBD.InterfaceCtiExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class CTITechExc inherits from InterfacesBD.InterfaceCtiExc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class DDEData inherits from FrameworkBD.ObjectBD

has public  attribute AgentID: Framework.string;
has public  attribute ANI: Framework.string;
has public  attribute CallID: Framework.string;
has public  attribute CallResult: Framework.string;
has public  attribute CallType: Framework.string;
has public  attribute CollectedDigits: Framework.string;
has public  attribute ConnID: Framework.string;
has public  attribute data: Framework.Array of CtiItBD.ComplementaryDDEData;
has public  attribute DNIS: Framework.string;
has public  attribute LastCollectedDigit: Framework.string;
has public  attribute OtherDN: Framework.string;
has public  attribute OtherQueue: Framework.string;
has public  attribute OtherTrunk: Framework.string;
has public  attribute ThisDN: Framework.string;
has public  attribute ThisQueue: Framework.string;
has public  attribute ThisTrunk: Framework.string;
has public  attribute TimeInQueue: Framework.string;

has public  method Constructor(input Text: Framework.TextData): CtiItBD.DDEData;
has private method FindNext(input Text: Framework.TextData): Framework.string;
has public  method GetKeyValue(input pKey: Framework.string): Framework.string;
has public  method Init;
has public  method zzzDump;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class DiffererAppelCampagneParam inherits from Framework.Object

has public  attribute pDateRappel: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class EvenementSoftphone inherits from FrameworkBD.ObjectBD

has public  attribute leNom: Framework.TextData;
has public  attribute lesParams: Framework.TextData;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InfoAppelParam inherits from Framework.Object

has public  attribute pAPPID: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InfoClientParam inherits from Framework.Object

has public  attribute pCLIENTID: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InitialiserConsultationParam inherits from Framework.Object

has public  attribute pPHONE: Framework.string;
has public  attribute pTYPE_CONS: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class InterfaceCTI inherits from DataAccessSrvBD.InterfaceServiceDesc

has public  attribute local: CtiItBD.ParamCTI;
has public  attribute nbutilisateur: Framework.integer;
has public  attribute ServiceCTIRC: CtiItBD.CTIApplicatif;
has public  attribute ServiceRCCTI: CtiItBD.ApplicatifCTI;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method LanceSoftphone(input pNumEssai: Framework.integer = 0);
has public  method TraiteCTIEvent;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=on);

end class;

class LoginParam inherits from Framework.Object

has public  attribute pLoginId: Framework.string;
has public  attribute pNumTel: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ParamCTI inherits from FrameworkBD.ObjectBD

has public  constant TIM_Rafraichissement = 1;

has public  attribute AppelArriveEmis: Framework.boolean;
has public  attribute AppId: Framework.string;
has public  attribute CallID: Framework.string;
has public  attribute ClientId: Framework.string;
has public  attribute ConnId: Framework.string;
has public  attribute ConnIDTrans: Framework.string;
has public  attribute DemandeUnHold: Framework.boolean;
has public  attribute EnregistrementAutomatique: Framework.boolean;
has public  attribute EnregistrementEnCours: Framework.boolean;
has public  attribute EtatModuleCTI: Framework.integer;
has public  attribute EtatPABX: Framework.string;
has public  attribute lastDDEData: CtiItBD.DDEData;
has public  attribute lastEtat: Framework.string;
has public  attribute lastEtatValide: Framework.boolean;
has public  attribute leTimer: Framework.Timer;
has public  attribute LoginID: Framework.string;
has public  attribute NomCampagne: Framework.string;
has public  attribute Rdv: CtiItBD.RendezVous;
has public  attribute RecordHandle: Framework.string;
has public  attribute thisDN: Framework.string;

has public  event AnnuleTransfertEvt(input pRaison: Framework.string);
has public  event ChangementEtatEvt(input pEtatActuel: Framework.string);
has public  event RendezVousEvt;

has public  method GetTempsEcoule: Framework.string;
has public  method Init;
has public  method SetEtat(input pEtat: Framework.string);
has public  method Transition(input pEtatMCTI: Framework.integer,
	input pOrigine: Framework.string = '?');

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class ReecouteParam inherits from Framework.Object

has public  attribute pAPPID: Framework.string;
has public  attribute pCLIENTID: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class RendezVous inherits from Framework.Object

has public  attribute abouti: Framework.boolean;
has public  attribute Calling_List: Framework.string;
has public  attribute Campaign_Name: Framework.string;
has public  attribute ClientId: Framework.string;
has public  attribute Date_Time: Framework.string;
has public  attribute Existe: Framework.boolean;
has public  attribute Fini: Framework.boolean;
has public  attribute Phone: Framework.string;
has public  attribute Record_Handle: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TransfertDirectParam inherits from Framework.Object

has public  attribute pPHONE: Framework.string;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TransfertEVTParam inherits from FrameworkBD.ObjectBD

has public  attribute Numero: Framework.string;
has public  attribute TransfertAnnule: Framework.boolean;
has public  attribute TransfertGuichet: Framework.boolean;
has public  attribute TransfertMotDePasse: Framework.boolean;
has public  attribute TypeTransfert: Framework.integer;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class BarreCTI is mapped inherits from DisplayBD.StandardWin

has public  attribute EnregistrementAutomatique: Framework.boolean;
has public  attribute EnregistrementEnCours: Framework.boolean;
has public  attribute ImageEnr: Framework.ImageData;
has public  attribute SonnerieEnCours: Framework.boolean;

has public  method DoGestionAppelArrive(input Param1: Framework.string,
	input Param2: Framework.string,
	input Param3: Framework.string,
	input ParamBool: Framework.boolean);
has public  method DoGestionChangementEtat(input Param1: Framework.string);
has public  method DoGestionCommunicationEtablie;
has public  method DoGestionCommunicationTerminee;
has public  method DoGestionConfirmerRendezVous(input ParamBool: Framework.boolean);
has public  method DoGestionConsultationEtablie;
has public  method DoGestionConsultationInitialisee;
has public  method DoGestionConsultationTerminee(input Param1: Framework.string);
has public  method DoGestionErreurSoftphone(input Param1: Framework.string);
has public  method DoGestionQuitter;
has public  method DoGestionTransfertAnnule;
has public  method DoGestionTransfertPrepare;
has public  method DoStdEventNotifier(input pType: Framework.integer,
	input pObject: Framework.Object);
has public  method GestionChangementEtat(input pEtat: Framework.string);
has public  method GestionEtatSync(input pEtat: Framework.string,
	input pEnregAuto: Framework.boolean,
	input pEnregEnCours: Framework.boolean,
	input pSonnerieEnCours: Framework.boolean,
	input pTimer: Framework.string,
	input pTransfertPrepare: Framework.boolean);
has public  method Init;
has public  method RegisterToCTI;
has public  method TransfertCTI;

has public  event handler CtiEvh();
has public  event handler EventLoopHandler();
has public  event handler EventNotifyEvh();

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin');

has
+5151463100001c950000194c9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060200000301
+000100001500000200c10001000000000003000021010200000000050400001c
+020909426172726520435449170506007a08004d009fff010101010f10111201
+01010100009fff010000000d00005dc05dbf000000000303030300020404a0a0
+0000000000000000009d5dc09d5dbf0000000000000108076801000000000000
+000000000201000000000900000700002102020000000008090806007c08000d
+0005054772696430230104010f1011120101011700019fff0c0000000d00000c
+dc0fc900000000030303030005040460600000220000000000009d0cdc9d0fc9
+00000000000001080a100100000000000000000000020100000000040201009f
+ff009fff00010100000b0000000404010000020c000d000a0000210202000000
+000d0c0b06000302010000000000000c06007a08004d00060650616e656c3001
+0104010f1011120101011700039fff0e0000000d00000bb80fa0000100010305
+03030008040460600000220bb80fa000009d0bb89d0fa000000000000001080e
+6001ff8100000000000000000201000000000900000e0000210102000000000f
+0f060092082081029fff21210401212121212121212100009fff0f0000000d68
+68009c01580001000103030303000c0101a0a00000220000000000009c9c9d01
+580000000000000103010b10020100009e0044201400000000001000001c0206
+0650616e656c0a100d060084082009020b0b5374617475735f4c696e6502020c
+2121212121010101170002080854657874446174610d0000000d009d0bc200f0
+0fa0000200010350030300080204a0a00000440000000000009cf09d0fa00100
+000000000103020107003f06000500010000fffe000906007c08000d000d0d43
+74694f7574696c7347726964010104010f1011120101011700049fff9e000100
+0c0000000d00000c7401580000000003502a0300050101606000000000000000
+00009d0c749d01580000000000000108111001fffe0000000000000000020100
+000000040901009fff009fff2001010000120000000000000000000004040000
+00000000000000000213001400150016001700180019001a001b001100002109
+02000000001314151617181a1b1912060003020100001e1e0000130601130802
+01020b0b446563726f63686542746e22020421212121212121211700059fff9e
+0001000d0000000d001f01240124000100010303030300090101808000000000
+0000001c1d9d01249d01240000000000000102001e001c00001c020a0a44e963
+726f636865720a101d00001c0200101e00010f00011f1f000112000180141420
+000104140a009cc8111111111111111111111111222222222222111111220000
+0000000022111220000000000000022122000022222222000022200002211111
+1220000220000211111111200002222222111111112222221111111111111111
+1111111112211111112211111111200222222200211111112000000000002111
+1112000020202000021111220000000000000221122000002020200000212200
+0000000000000022200000002020200000022000000000000000000212222222
+22222222222111111111111111111111200001100001030009ffff00c0c0c000
+000014060113080201020c0c52616363726f63686542746e2202042121212121
+2121211700069fff9e0001000e0000000d009d018c0124012400020001030303
+030009010180800000000000000021229d01249d012400000000000001020023
+002100001c020b0b52616363726f636865720a102200001c0200102300010f00
+012424000112000180141425000104140a009cc8000000003330000000000011
+1111333111111100012222223332222222100122222233322222221012222222
+3332222222211222211033300112222111111100333000111111122221003330
+0012222101111100333000111110000000003330000000000000033333333300
+0000000000333333300000000000000333330000000000000000333000000000
+0000000003000000000000001110000001110000000111111111111110000012
+2222222222221000012222222222222221004444444444444444444425000110
+000105000fc0c0c0000000ffff00ff0000ffffff15060113080201020a0a4c69
+626572657242746e22020421212121212121211700079fff9e0001000f000000
+0d009d02f80143012e0003000103030303000901018080000000000000002627
+9d01439d012e00000000000001020028002600001c0206064c696272650a1027
+00001c0200102800010f0001292900011200018017152a000104160b009cfd00
+0000000000000000008100000000000000000002810000000000000000002281
+0000000000000000022281000000000000000002208100000000000000002220
+8100000000000000022200810000000000000022200081000000000000002220
+0081000000000000022200008102000000000022220000810220000000022220
+0000810222000000022200000081022220000022220000008102222200022220
+0000008102222220222220000000810022222222220000000081000222222220
+0000000081000022222220000000008100000222220000000000810000002222
+000000000081000000022000000000008100000000000000000000812a000110
+0001030009c0c0c000000000ff0016060113080201020a0a417474656e746542
+746e22020421212121212121211700089fff9e000100100000000d009d048401
+1901240004000103030303000901018080000022000000002b2c9d01199d0124
+0000000000000102002d002b00001c020808417474656e74650a102c00001c02
+00102d00010f00012e2e00011200018013142f000104140a009cbe0000000000
+0000000000000000011100000000000000011122100000000000001221221110
+0000000000122122122100000000111221221221000000012212212212210000
+0001221221221221000000012212212212210000000122122122122100110001
+2222222222210122100122222222222112221001222222222222222100012222
+2222222222100001222222222222210000012222222222221000000012222222
+222100000000012222222210000000000011111111000000002f000110000103
+0009c0c0c0000000ffff0017060113080201020c0c5472616e73666572744274
+6e22020421212121212121211700099fff9e000100110000000d009d05e60124
+012400050001030303030009010180800000000000000030319d01249d012400
+000000000001020032003000001c020b0b5472616e7366e97265720a10310000
+1c0200103200010f00013333000112000180141400000118143c009d04b0c6c6
+c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000
+000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000000000000000000000000000c6c6c6000000ffff00ffff00ff
+ff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000
+ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff
+00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ff
+ff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00ffff00
+000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff00ffff
+00ffff00ffff00000000000000ffff00ffff00000000000000000000c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000ffff00
+ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff0000
+0000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000c0c0c0
+c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000000000
+00ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6c6c6ff
+0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00
+ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff0000c0c0
+c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff0000
+0000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6c6c6c6
+c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff00000000c0c0
+c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0
+c0c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0
+c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0c00000
+00ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0c0c0ff
+0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000ffff00
+ffff00000000000000ffff00ffff00000000000000000000c0c0c0ff0000c0c0
+c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ffff0000
+0000000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff000000000000
+00ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00
+ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ffff0000
+0000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000
+ffff00ffff00000000ffff00ffff00000000c6c6c60000000000000000000000
+00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000000000000000000000c0c0c018060113080201020808506175736542746e
+220204212121212121212117000a9fff9e000100120000000d009d0753012401
+2400060001030303030009010180800000000000000034359d01249d01240000
+0000000001020036003400001c02060650617573650a103500001c0200103600
+010f00013737000112000180141400000118143c009d04b0c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000ff
+ff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00
+000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff0000
+0000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00000000000000
+000000000000000000000000000000000000000000ffff00ffff00ffff000000
+00c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c6000000ff
+ff00ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000c0c0c0
+c6c6c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff00ffff
+00ffff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00000000000000000000000000
+000000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6c6c6c6
+c6c6c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff000000ff
+ff00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0
+000000ffff00ffff00ffff00000000ffffffffffffffffff000000ffff00ffff
+00ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c00000000000ff00
+00ff0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000
+ff0000ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ffff0000
+0000c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff0000ff
+0000ff0000ff000000000000000000000000000000000000000000c0c0c0c6c6
+c6c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff0000ff00
+00ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6
+c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c000
+00ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c00000
+ff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff
+0000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c00000ff00
+00ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c619060113080201020e0e46696e456e726567697374726572
+230204212121212121212117000d9fff9e000100150000000d009d08c0012401
+2400070001030303030009010180800000000000000038399d01249d01240000
+000000000102003a003800001c020c0c456e7265676973747265720a10390000
+1c0200103a00010f00013b3b00011200018014143c000104140a009cc8331111
+1111111111113333300000000000000333333311111111111133330333300000
+0000033330003333200044443333400003333000000333300000003333000033
+3300001000033334433334000110000433333333440001100004033333304400
+0110000440333304440001100004433333344400011000003333333300000110
+0113333003333110011011333300003333110110133330000003333101103333
+1000000133330113333100000000133331333300000000000033333331111111
+11111113313c000110000105000f000000c0c0c000ffffff0000ffffff1a0601
+13080201020b0b456e726567697374726572220204212121212121212117000b
+9fff9e000100130000000d009d0a2c0124012400080001030303030009010180
+80000000000000003d3e9d01249d01240000000000000102003f003d00001c02
+0c0c456e7265676973747265720a103e00001c0200103f00010f000140400001
+12000180141441000104140a009cc81111111111111111111110000000000000
+0000011011111111111111110100000000000000000000003020200044444444
+4000000000000000000000000000000000000000001000044444444444000110
+0004404444044400011000040004400044000110000440444404440001100004
+4444444444000110000000000000000001100111000000001110011011111000
+0001111101101111100000011111011011111000000111110110011100000000
+111001100000000000000000011111111111111111111141000110000105000f
+000000c0c0c000ffffff0000ffffff1b0600f608208902070745746174437469
+020204212121212101010117000c080854657874446174619e00010014000000
+0d0a9d0b990092010f00090001030503030009010180a0000044000000004243
+929d010f020000000000010301053c00070005040009ff8100009e0040201403
+01004200001c0210104574617420636f6e7365696c6c65720a114300001c0200
+100606005e08002e009fff03030303030303030303030300009fff0200000008
+009fff0000000000000000000000020144014400002103020000000045464745
+06005c08000e00040466696c65010303030303030303030303000e9fff100000
+00080605052646696c6500000000000000000000000201480103ff0048000021
+020200000000494a4906006a0800020205057072696e74030303020303030303
+030303000f9fff1100000008459fff0000000000000000000000010200124a06
+006a080002020a0a7072696e7473657475700303030203030303030303030010
+9fff1200000008459fff0000000000000000000000010200114606005c08000e
+000606416374696f6e01030303030303030303030300119fff15000000080607
+0726416374696f6e000000000000000000000002014b0103ff004b0000210102
+000000004c4c06006a0800020209094e657757696e646f770303030203030303
+0303030300129fff1600000008460b0b264e65772057696e646f770000000000
+00000000000001020eff4706005c08000e00040448656c700103030303030303
+0303030300139fff1700000008069fff000000000000000000000002014d0103
+03004d0000210002000000004d1a919c9c9cad9d010d9d01199d01979d01a39d
+01af9d02159d02209d027a9d02889d02f59d039b9d03ae9d03ba9d04169d0428
+9d042f9d04369d05109d05229d05819d05949d059b9d05a29d067c9d06949d06
+f19d06ff9d07069d070d9d081c9d082e9d088b9d089b9d08a29d08a99d09799d
+098b9d09ea9d09fd9d0a049d0a0b9d0ece9d0f299d0f379d0f3e9d0f459d1408
+9d14699d147d9d14849d148b9d15659d157d9d15db9d15ef9d15f69d15fd9d16
+d79d16ef9d17629d177a9d17819d17b29d17bf9d17fc9d18089d183e9d18799d
+18ba9d18c59d190a9d19429d194c9cd3191a38626377919b9c9c9ca09cad9ccb
+9cf59cf69d010a9d010d9d01179d01199d013c9d01669d01679d017b9d01929d
+01979d01a19d01a39d01af9d01d39d01fd9d01fe9d02129d02159d021f9d0220
+9d023e9d02679d02689d026a9d027a9d027e9d02889d02b99d02e49d02e59d02
+e89d02ed9d02f59d03249d034e9d034f9d03639d03889d039b9d03a59d03ae9d
+03ba9d03e79d04119d04129d04169d041a9d04289d042c9d042f9d04339d0436
+9d04409d05109d05229d05509d057c9d057d9d05819d05859d05949d05989d05
+9b9d059f9d05a29d05ac9d067c9d06949d06c09d06ec9d06ed9d06f19d06f59d
+06ff9d07039d07069d070a9d070d9d07179d081c9d082e9d085a9d08869d0887
+9d088b9d088f9d089b9d089f9d08a29d08a69d08a99d08b39d09799d098b9d09
+b99d09e59d09e69d09ea9d09ee9d09fd9d0a019d0a049d0a089d0a0b9d0a159d
+0ece9d0ef89d0f249d0f259d0f299d0f2d9d0f379d0f3b9d0f3e9d0f429d0f45
+9d0f4f9d14089d14389d14649d14659d14699d146d9d147d9d14819d14849d14
+889d148b9d14959d15659d157d9d15aa9d15d69d15d79d15db9d15df9d15ef9d
+15f39d15f69d15fa9d15fd9d16079d16d79d16ef9d17209d174a9d174b9d1750
+9d17559d17629d17669d177a9d177e9d17819d179f9d17ae9d17af9d17b19d17
+b29d17bc9d17bf9d17e19d17f59d17f69d17f89d17f99d17fc9d18069d18089d
+182b9d183a9d183b9d183e9d18669d18759d18769d18799d189d9d18b39d18b4
+9d18b69d18b79d18ba9d18c49d18c59d18ec9d19069d19079d190a9d192c9d19
+3b9d193c9d193e9d193f9d19429d194c9d194c0301
-848115fe


end class;

class MCConferenceWin is mapped inherits from DisplayBD.StandardWin

has public  attribute TypeTransfert: Framework.integer;

has public  event FinConfEvt;

has public  method ExitWindow;
has public  method GestionTransfertAnnule;
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method ReactionFinConference(input pResultat: CtiItBD.ConferenceEVTParam);

has public  event handler EventLoopHandler();

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin');

has
+51514631000007c20000063f9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100000f000002001b0001000000000003000021010200000000050400001c
+020f0f5374616e646172642057696e646f77170506007a08004d009fff010101
+010f1011120101011700009fff010000000d00005d435d420000000003030303
+00020404a0a00000000000000000009d5d439d5d420000000000000108076b01
+0000000000000000000002010000000009000007000021010200000000080806
+007c08000d0005054772696430010104010f1011120101011700019fff0c0000
+000d000001f4070a000000000303030300050404606000002201f4070800009d
+01f49d070a000000000000010809100100000000000000000000020100000000
+040201009fff009fff20010100000a0000000404010000020b000c0009000021
+0202000000000b0c0a06000302010000000000000b06007a08004d0006065061
+6e656c30010104010f1011120101011700029fff0e0000000d000000d006e000
+010001035103030008040460600000220000000000009cd09d06e00000000000
+0001080d6301ff8100000000000000000201000000000900000d000021020200
+0000000e0f0e060092082081029fff21210401212121212121212100009fff9e
+0001000c0000000d6868009c01580001000103030303000b0101a0a000002200
+00000000009c9c9d01580000000000000103010b10020100009e004420140000
+0000001000001c02060650616e656c0a100f06007c08000d000808526f6f7447
+726964010104010f1011120101011700039fff9e0001000d0000000d0000018c
+06b70000000003030303000b040460600000220000000000009d018c9d06b700
+0000000000010811100100000000000000000000020100000000040102009fff
+009fff2001010000120000000404000000021300140011000021020200000000
+131412060003020100002828282813060078080201020b0b416e6e756c65725f
+50424e01020421212121212121211700049fff9e0001000e0000000d342a010f
+02d90001000103030303000f0105a0a00014000000000000009d010f9d02d900
+0000000000010b0707416e6e756c65720002010000000014060078080201020e
+0e436f6e666572656e63655f50424e01020421212121212121211700059fff9e
+0001000f0000000d9d03802a010f02d90001000203030303000f0105a0a00013
+000000000000009d010f9d02d9000000000000010b0a0a436f6e66e972656e63
+65000201000000000c060084082009020b0b5374617475735f4c696e6523020c
+2121212121010101170006080854657874446174610d0000000d009cdb00f006
+e0000200010350030300080204a0a00000440000000000009cf09d06e0010000
+0000000103020107001a04000500010000fffe000606005e08002e009fff0303
+0303030303030303030300009fff0200000008009fff00000000000000000000
+0002011501150000210302000000001617181606005c08000e00040466696c65
+03030303030303030303030300079fff10000000080605052646696c65000000
+00000000000000000201190103ff00190000210202000000001a1b1a06006a08
+00020205057072696e7403030302030303030303030300089fff110000000816
+9fff0000000000000000000000010200121b06006a080002020a0a7072696e74
+736574757003030302030303030303030300099fff1200000008169fff000000
+0000000000000000010200111706005c08000e000606416374696f6e03030303
+0303030303030303000a9fff150000000806070726416374696f6e0000000000
+00000000000002011c0103ff001c0000210102000000001d1d06006a08000202
+09094e657757696e646f77030303020303030303030303000b9fff1600000008
+170b0b264e65772057696e646f77000000000000000000000001020eff180600
+5c08000e00040448656c70030303030303030303030303000c9fff1700000008
+069fff000000000000000000000002011e010303001e0000210002000000001e
+1a919c9c9cb39d01139d011e9d019c9d01a89d01b49d02199d02259d02839d02
+919d03169d03229d032e9d03979d04089d04749d04a59d04b29d04ef9d04fb9d
+05319d056c9d05ad9d05b89d05fd9d06359d063f6b191a38626377919b9c9c9c
+a09cb39cd19cfb9cfc9d01109d01139d011d9d011e9d01419d016b9d016c9d01
+809d01979d019c9d01a69d01a89d01b49d01d89d02019d02029d02169d02199d
+02239d02259d02479d02709d02719d02739d02839d02879d02919d02bb9d02e5
+9d02e69d02fa9d03119d03169d03209d03229d032e9d035b9d03859d03869d03
+979d03c79d03f39d03f49d04089d04399d04639d04649d04679d046c9d04749d
+04929d04a19d04a29d04a49d04a59d04af9d04b29d04d49d04e89d04e99d04eb
+9d04ec9d04ef9d04f99d04fb9d051e9d052d9d052e9d05319d05599d05689d05
+699d056c9d05909d05a69d05a79d05a99d05aa9d05ad9d05b79d05b89d05df9d
+05f99d05fa9d05fd9d061f9d062e9d062f9d06319d06329d06359d063f9d063f
+0301
-0692209d


end class;

class MCTransfertWin is mapped inherits from DisplayBD.StandardWin

has public  constant TR_AUCUN = '(Aucun)';
has public  constant TR_SVIGUICHET = 2;
has public  constant TR_SVIMDP = 1;

has public  attribute leTypeTransfert: Framework.integer;

has public  event FinTransfertEvt;

has public  method AnnulerTransfert;
has private method ControleCoherenceTransfert;
has public  method DoGestionConsultationInitialisee;
has public  method DoGestionTransfertAnnule;
has public  method ExitWindow;
has public  method FinTransfert(input pResultat: CtiItBD.TransfertEVTParam);
has public  method GestionConsultationInitialisee;
has public  method GetNumero: Framework.string;
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has private method InitListes;
has public  method MajListeIndividu;
has private method TraitementTransfertAutre;
has private method TraitementTransfertSVI;

has public  event handler EventLoopHandler();

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin');

has
+51514631000015e1000011339fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+0001000021000002001b0001000000000003000021010200000000050400001c
+02151543686f69782064752064657374696e617461697265170506007a08004d
+009fff010101010f1011120101010100009fff010000000d00005dc05dbf0000
+00000303030300020404a0a00000000000000000009d5dc09d5dbf0000000000
+000108076b010000000000000000000002010000000009000007000021010200
+000000080806007c08000d0005054772696430010104010f1011120101011700
+019fff0c0000000d00000ca80fa0000000000303030300050404606000002203
+e807d000009d0ca89d0fa0000000000000010809100100000000000000000000
+020100000000040201009fff009fff00010100000a0000000404010000020b00
+0c00090000210202000000000b0c0a06000302010000000000000b06007a0800
+4d00060650616e656c30010104010f1011120101011700029fff0e0000000d00
+000bb80fa000010001035103030008040460600000220bb80fa000009d0bb89d
+0fa000000000000001080d6301ff810000000000000000020100000000090000
+0d0000210202000000000e0f0e060092082081029fff21210401212121212121
+212100009fff9e0001000c0000000d6868009c01580001000103030303000b01
+01a0a00000220000000000009c9c9d01580000000000000103010b1002010000
+9e0044201400000000001000001c02060650616e656c0a100f06007c08000d00
+0000010104010f1011120101011700009fff9e0001000d0000000d00000b6f0b
+300000000003030303000b010160600000000000000000009d0b6f9d0b300000
+00000000010811100100000000000000000000020100000000040a01009fff00
+9fff200101000012000000000000000000000004040000000000000000000000
+02130014001516170018191a001b001c1d1e001f20110000210a020000000013
+141517181e1c1a1f1b12060003020200000000960013060092082081029fff21
+210401212121212121212100009fff9e0001000e0000000d9200013904c30001
+000103030303000f0101a0a00000000000000000009d01399d04c30000000000
+000103010b2101018c0000009e0044209400000000002100001c020f0f446573
+74696e617461697265203a0a10140600a0080009020c0c5472616e7366657274
+53564901020421212121210101011700030b0b426f6f6c65616e446174619e00
+01000f0000000d929d0139013908e90002000103030303000f01018080000000
+0000000000009d01399d08e9000000000000010301017800041a1a5472616e73
+66657274206175205365727665757220566f63616c000000001506007c08000d
+009fff010104010f1011120101011700009fff9e000100100000000d9d010f9d
+027100e509a50003000103030303000f010160600000000000000000009ce59d
+09a5000000000000010822100100000000000000000000020100000000040102
+009fff009fff2001010000230000000404000000022425260022000021020200
+000000242623060003020800000000000024060092082081029fff2121040121
+2121212121212100009fff9e000100110000000d001f009c01ea000100010303
+030300150101a0a00000000000000000009c9c9d01ea0000000000000103010b
+27020100009e0044209400000000002700001c020909466f6e6374696f6e0a10
+250600030208000000000000260600b40800090214146c61466f6e6374696f6e
+53564943686f6973696501020b21212121210101011700040707496e74656765
+729e000100120000000d9d01ea0000e507bb00010002030503030015010280a0
+0000220000000028299ce59d07bb00000000000001030201042a070000000302
+2800001c0201010a102900001c0200102a00002102020001a6012b2c2b0001a6
+03012d000000002d00001c021f1f4368616e67656d656e7420646520636f6465
+20636f6e666964656e7469656c202c0001a603022e000000002e00001c021616
+436f6e73756c746174696f6e20646520636f6d70746517160600030201000000
+000000170600a0080009020e0e5472616e736665727441757472650102042121
+2121210101011700050b0b426f6f6c65616e446174619e000100130000000d92
+9d0356013906100004000103030303000f010180800000000000000000009d01
+399d06100000000000000103010178000411115472616e736665727420642761
+7070656c000000001806007c08000d009fff010104010f101112010101170000
+9fff9e000100140000000d9ce59d048f02b009ee0005000103030303000f0101
+60600000000000000000009d02b09d09ee00000000000001082f100100000000
+000000000000020100000000040302009fff009fff2001010000300000000000
+04040000000000023100320033003400350036002f0000210602000000003132
+3334353630060003020800000000000031060092082081029fff212104012121
+21212121212100009fff9e000100150000000d871f009c01ab00010001030303
+0300180101a0a00000000000000000009c9c9d01ab0000000000000103010b37
+020100009e0044209400000000003700001c02070747726f7570650a10320600
+b40800090208086c6547726f75706501020b2121212121010101170006060653
+7472696e679e000100160000000d9d02320000e507bb00010002030503030018
+010280a00000220000000000009ce59d07bb0000000000000103020104380300
+000003043800002104020001a601393a3b3c390001a603013d000000003d0000
+1c0203034f6e65103a0001a603023e000000003e00001c02030354776f103b00
+01a603033f000000003f00001c0205055468726565103c0001a6030440000000
+004000001c020404466f75721033060092082081029fff212104012121212121
+21212100009fff9e000100170000000d739d0104009c01c00002000103030303
+00180101a0a00000000000000000009c9c9d01c00000000000000103010b4102
+0100009e0044209400000000004100001c020909496e6469766964750a103406
+00b4080009020a0a6c65496e64697669647501020b2121212121010101170007
+0606537472696e679e000100180000000d9d02329ce500e507bb000200020305
+03030018010280a00000220000000000009ce59d07bb00000000000001030201
+04420300000003044200002104020001a60143444546430001a6030147000000
+004700001c0203034f6e6510440001a6030248000000004800001c0203035477
+6f10450001a6030349000000004900001c020505546872656510460001a60304
+4a000000004a00001c020404466f75721035060092082081029fff2121040121
+2121212121212100009fff9e000100190000000d009d01ea009c023200030001
+0303030300180101a0a00000000000000000009c9c9d02320000000000000103
+010b4b020100009e0044209400000000004b00001c020b0b50617274656e6169
+72650a10360600b4080009020c0c6c6550617274656e6169726501020b212121
+21210101011700080606537472696e679e0001001a0000000d9d02329d01ca00
+e507bb00030002030503030018010280a00000220000000000009ce59d07bb00
+000000000001030201044c0300000003044c00002104020001a6014d4e4f504d
+0001a6030151000000005100001c0203034f6e65104e0001a603025200000000
+5200001c02030354776f104f0001a6030353000000005300001c020505546872
+656510500001a6030454000000005400001c020404466f757210190600030201
+0000000000001a06009c080081009fff21210d21212121212121212100009fff
+9e0001001d0000000d9c9c9d074900010a8b0006000103030303000f01018080
+000000000000000000019d0a8b00000000000001030001009fff01029c9c9d07
+499d0b269d0749011b060092082081029fff2121040121212121212121210000
+9fff9e000100210000000d929d0753013906830007000103030303000f0101a0
+a00000000000000000009d01399d06830000000000000103010b5501018c0000
+009e0044209400000000005500001c02141454797065206465207472616e7366
+657274203a0a181c0600b2080009020f0f6c65547970655472616e7366657274
+01020421212121210101011700090707496e74656765729e0001001c0000000d
+9d01249d088c016d09710008000103030303000f010180800000000000000000
+009d016d9d097100000000000001030201045607000000040102000000000000
+5600002103020001a601575859570001a603015a000000005a00001c02060644
+697265637410580001a603025b000000005b00001c020808496e646972656374
+10590001a603035c000000005c00001c020a0a436f6e66e972656e6365101d06
+000302010000000000001e06009c080081009fff21210d212121212121212121
+00009fff9e0001001b0000000d9c9c9d0a0300010a610009000103030303000f
+01018080000000000000000000019d0a6100000000000001030001009fff0102
+9c9c9d0a039d0afc9d0a03011f06007c08000d009fff010104010f1011120101
+011700009fff9e0001001e0000000d9d068d9d0a0d016204a3000a0001030303
+03000f010160600000000000000000009d01629d04a300000000000001085d10
+0100000000000000000000020100000000040102009fff009fff20010100005e
+0000000404000000025f0060005d0000210202000000005f605e060003020100
+00282828285f0600780802010206064f4b5f50424e0102042121212121212121
+17000a9fff9e0001001f0000000d2a2a010f02130001000103030303001f0105
+a0a00060000000000000009d010f9d0213000000000000010b02024f4b000201
+0000000060060078080201020b0b416e6e756c65725f50424e01020421212121
+2121212117000b9fff9e000100200000000d9d02672a010f0213000100020303
+0303001f0105a0a0005f000000000000009d010f9d0213000000000000010b07
+07416e6e756c6572000201000000002006000302080000000000000c06008408
+2009020b0b5374617475735f4c696e6523020c212121212101010117000c0808
+54657874446174610d0000000d009d0bb800f00fa00002000103500303000802
+04a0a00000440000000000009cf09d0fa00100000000000103020107003f0600
+0500010000fffe000606005e08002e009fff0303030303030303030303030000
+9fff0200000008009fff00000000000000000000000201610161000021030200
+0000006263646206005c08000e00040466696c65030303030303030303030303
+000d9fff10000000080605052646696c65000000000000000000000002016501
+03ff006500002102020000000066676606006a0800020205057072696e740303
+03020303030303030303000e9fff1100000008629fff00000000000000000000
+00010200126706006a080002020a0a7072696e74736574757003030302030303
+0303030303000f9fff1200000008629fff000000000000000000000001020011
+6306005c08000e000606416374696f6e03030303030303030303030300109fff
+150000000806070726416374696f6e00000000000000000000000201680103ff
+0068000021010200000000696906006a0800020209094e657757696e646f7703
+030302030303030303030300119fff1600000008630b0b264e65772057696e64
+6f77000000000000000000000001020eff6406005c08000e00040448656c7003
+030303030303030303030300129fff1700000008069fff000000000000000000
+000002016a010303006a0000210002000000006a1a919c9c9cb99d01199d0124
+9d01a29d01ae9d01ba9d02209d022c9d028a9d02989d03359d03499d03559d03
+b69d03cd9d04599d04d99d04e59d04f19d054f9d05609d056c9d05e09d05e99d
+05f09d05fc9d06079d062e9d06399d06579d06639d06e89d07749d07849d0790
+9d07ee9d07fd9d08649d08729d087d9d08889d08939d089e9d08a99d08b69d08
+c19d08cd9d092d9d093e9d09a89d09b69d09c19d09cc9d09d79d09e29d09ed9d
+09fa9d0a059d0a119d0a719d0a849d0af19d0aff9d0b0a9d0b159d0b209d0b2b
+9d0b369d0b439d0b4e9d0b5a9d0b669d0bc89d0c2b9d0c479d0cc09d0ccd9d0c
+d89d0ce69d0cf19d0d019d0d0c9d0d1e9d0d2a9d0d8c9d0e0d9d0e199d0e259d
+0e849d0eef9d0efb9d0f689d0f999d0fa69d0fe39d0fef9d10259d10609d10a1
+9d10ac9d10f19d11299d11339d012c191a38626377919b9c9c9ca09cb99cd79d
+01019d01029d01169d01199d01239d01249d01479d01719d01729d01869d019d
+9d01a29d01ac9d01ae9d01ba9d01de9d02089d02099d021d9d02209d022a9d02
+2c9d024e9d02779d02789d027a9d028a9d028e9d02989d02ba9d02e49d02e59d
+02f99d03209d03359d033f9d03499d03559d03779d03a19d03a29d03a49d03b6
+9d03ba9d03cd9d04069d04329d04339d04389d04599d047b9d04a89d04a99d04
+bd9d04d49d04d99d04e39d04e59d04f19d05139d053c9d053d9d053f9d054f9d
+05539d05609d056c9d05a99d05d49d05d59d05d89d05de9d05e09d05e49d05e9
+9d05ed9d05f09d05fa9d05fc9d06079d060b9d062e9d06399d063d9d06579d06
+639d069e9d06ca9d06cb9d06d09d06e89d070a9d07379d07389d074c9d07679d
+07749d077e9d07849d07909d07b29d07db9d07dc9d07de9d07ee9d07f29d07fd
+9d082d9d08589d08599d085c9d08629d08649d086e9d08729d087d9d08819d08
+889d08939d08979d089e9d08a99d08ad9d08b69d08c19d08c59d08cd9d08ef9d
+091a9d091b9d091d9d092d9d09319d093e9d09709d099c9d099d9d09a09d09a6
+9d09a89d09b29d09b69d09c19d09c59d09cc9d09d79d09db9d09e29d09ed9d09
+f19d09fa9d0a059d0a099d0a119d0a339d0a5e9d0a5f9d0a619d0a719d0a759d
+0a849d0ab89d0ae59d0ae69d0ae99d0aef9d0af19d0afb9d0aff9d0b0a9d0b0e
+9d0b159d0b209d0b249d0b2b9d0b369d0b3a9d0b439d0b4e9d0b529d0b5a9d0b
+669d0b889d0bb39d0bb49d0bb69d0bba9d0bc79d0bc89d0bea9d0c169d0c179d
+0c199d0c2b9d0c2f9d0c479d0c7f9d0cad9d0cae9d0cb19d0cb79d0cc09d0cca
+9d0ccd9d0cd89d0cdc9d0ce69d0cf19d0cf59d0d019d0d0c9d0d109d0d1e9d0d
+2a9d0d4c9d0d779d0d789d0d7a9d0d7e9d0d8b9d0d8c9d0dae9d0ddc9d0ddd9d
+0df19d0e089d0e0d9d0e179d0e199d0e259d0e4d9d0e779d0e789d0e849d0eb1
+9d0edd9d0ede9d0eef9d0efb9d0f2c9d0f579d0f589d0f5b9d0f609d0f689d0f
+869d0f959d0f969d0f989d0f999d0fa39d0fa69d0fc89d0fdc9d0fdd9d0fdf9d
+0fe09d0fe39d0fed9d0fef9d10129d10219d10229d10259d104d9d105c9d105d
+9d10609d10849d109a9d109b9d109d9d109e9d10a19d10ab9d10ac9d10d39d10
+ed9d10ee9d10f19d11139d11229d11239d11259d11269d11299d11339d113303
+01
-39b73ba9


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionMgrCtiDesc.Action(input pAction: Framework.integer,
	input pObjet: Framework.Object = NIL)
begin
--
--	Description :	Traite des actions spécifique du CTI
--
--	Type :	Concret
--
--	Parametres :	Input	--> pAction : Code action
--								pObject : Objet sur lequel l'action est effectuée.
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 02/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrCtiDesc.Action');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

Case pAction is
	When ACT_CTI_ACCESS do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_REGISTERNOTIFIER do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_DEREGISTERNOTIFIER do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_INITIALISERCTI do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_TERMINERCTI do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_PREPARETRANSFERT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_ANNULEPREPARETRANSFERT do
		Self.ActionCTI(pAction,pObjet);	
	When ACT_CTI_ANNULERCONSULTATION do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_APPELCLIENT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_ARRETERENREGISTREMENT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_ATTENTE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_CHANGEMENTMOTDEPASSE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_CONSULTATIONCOMPTE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_DECROCHE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_DEMARRERENREGISTREMENT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_INFOAPPEL do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_INFOCLIENT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_INITIALISERCONSULTATION do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_LIBERER do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_LOGIN do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_LOGOUT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_PAUSE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_QUITTER do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_RACCROCHE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_REECOUTE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_REECOUTECLIENT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_TRANSFERT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_TRANSFERTDIRECT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_VALIDERCONFERENCE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_VALIDERTRANSFERT do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_ANNULERAPPELCAMPAGNE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_DIFFERERAPPELCAMPAGNE do
		Self.ActionCTI(pAction,pObjet);
	When ACT_CTI_SYNCCTI do
		Self.ActionCTI(pAction,pObjet);
   Else do
		DoAction(pAction,pObjet);
End Case;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrCtiDesc.Action : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrCtiDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrCtiDesc.ActionCTI(input pAction: Framework.integer,
	input pObjet: Framework.Object)
begin
--
--	Description : factorise la construction du transdata.
--
--	Type :	Concret
--
--	Parametres :	Input	--> pAction : Code action
--                              pObject : Objet sur lequel est effectué l'action.
--					Output	--> Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--  JB BRIAUD | 03/10/1997  |   Version initiale.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgrCtiDesc.ActionCti');

-- Declarations

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

if TransDataInterfaceCTI = NIL then
	TransDataInterfaceCTI = new();
end if;
TransDataInterfaceCTI.TransActionService = pAction;
TransDataInterfaceCTI.TransObject = pObjet;
FrontComm.Transfer(	TransData = TransDataInterfaceCTI,
					TransType = InterfaceMgr,
					ClassType = InterfaceCTI);

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgrCtiDesc.ActionCti : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ActionMgrCtiDesc.ActionCti');
		Raise;
end method;

------------------------------------------------------------
method ActionMgrCtiDesc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method AnnulerAppelCampagneParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method AppelClientParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ApplicatifCTI.AcquitterRappel
begin
--
--	Description :		Acquitter auprès de Campaign Manager une demande de rappel
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	FG			08/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.AcquitterRappel');

-- Declarations

-- Traitement
-- constitution de la chaine paramètre 

param : TextData;

param = new;

-- Données de base
param.concat(local.thisDN); param.concat(',');					-- thisDN
param.concat(local.thisDN); param.concat(',');					-- eventDN
param.concat('0'); param.concat(',');							-- ConnId
param.concat('0'); param.concat(',');							-- CallId
param.concat(local.LoginID); param.concat(',');					-- AgentID
param.concat('0'); param.concat(',');							-- ANI
param.concat('1'); param.concat(',');							-- CallType
param.concat('AGENT_REQ_TYPE'); param.concat(',');				-- key
param.concat('ScheduledCallAcknowledge'); param.concat(',');		-- value
param.concat('GSW_RECORD_HANDLE'); param.concat(',');			-- key
param.concat(local.rdv.Record_Handle); param.concat(',');			-- value

self.ExecCommande(CSP_SENDUSEREVENT,param.value);


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.AcquitterRappel : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.AcquitterRappel');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.AnnulerAppelCampagne(input pParam: CtiItBD.AnnulerAppelCampagneParam)
begin
--
--	Description :		Annule l'appel d'un client programmé pour une campagne
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	FG			04/07/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.AnnulerAppelCampagne');

-- Declarations

-- Traitement

-- Il faut préciser l'identifiant du client et la reference de campagne

-- constitution de la chaine paramètre 

param : TextData;

param = new;

-- Données de base
param.concat(local.thisDN); param.concat(',');					-- thisDN
param.concat(local.thisDN); param.concat(',');					-- eventDN
param.concat('0'); param.concat(',');							-- ConnId
param.concat('0'); param.concat(',');							-- CallId
param.concat(local.LoginID); param.concat(',');					-- AgentID
param.concat('0'); param.concat(',');							-- ANI
param.concat('1'); param.concat(',');							-- CallType
param.concat('AGENT_REQ_TYPE'); param.concat(',');				-- key
param.concat('DoNotCall'); param.concat(',');					-- value
param.concat('GSW_RECORD_HANDLE'); param.concat(',');			-- key
param.concat(' '); param.concat(',');							-- value
if Not (pParam.pNomCampagne ='') then
	param.concat('GSW_CALLING_LIST'); param.concat(',');			-- key
	param.concat(pParam.pNomCampagne); param.concat(',');			-- value
end if;
-- GSW_PHONE correspond au numero contacte lors de la campagne
param.concat('GSW_PHONE'); param.concat(',');					-- key
param.concat(pParam.pTelephone); param.concat(',');				-- value
param.concat('GSW_MESSAGE'); param.concat(',');					-- key
param.concat('Annulation par conseiller'); 						-- value

self.ExecCommande(CSP_SENDUSEREVENT,param.value);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.AnnulerAppelCampagne : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.AnnulerAppelCampagne');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.AnnulerConsultation
begin
--
--	Description :		Annule la consultation en cours
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.AnnulerConsultation');

-- Declarations

-- Traitement

-- Il faut préciser le CallID (ConnID Softphone de l'appel original)
self.ExecCommande(CSP_RETRIEVECALL,local.thisDN, local.ConnID);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.AnnulerConsultation : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.AnnulerConsultation');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.AppelClient(input pParam: CtiItBD.AppelClientParam)
begin
--
--	Description :		Appel d'un client (composition numéro de téléphone)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	-->	pCLIENTID : string = Identifiant du client
--								pCLIENT_PHONE : string = Numero de telephone du client
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.AppelClient');

-- Declarations

-- Traitement

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 1 do
		self.local.Transition(2,'AppelClient');
		local.ClientID = pParam.pCLIENTID;
		-- On compose le numéro de téléphone
		self.ExecCommande(CSP_DIAL,local.thisDN,pParam.pCLIENTPHONE);
	else
		self.local.Transition(0,'AppelClient');
end case;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.AppelClient : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.AppelClient');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ArreterEnregistrement
begin
--
--	Description :		Arrête l'enregistrement de la conversation
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ArreterEnregistrement');

-- Declarations

-- Traitement
if Not (local.EnregistrementAutomatique) then
	self.ExecCommande(CSP_UPDATEDATA,local.thisDN,local.ConnID,CTI_KEY_ENREGISTREMENT,CTI_MES_INACTIF);
	local.EnregistrementEnCours = FALSE;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ArreterEnregistrement : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ArreterEnregistrement');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Attente
begin
--
--	Description :		Mise en attente du client (pendant une conversation)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Attente');

-- Declarations

-- Traitement

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 1 do
		-- on met le client en attente
		self.local.Transition(4,'Attente');
		self.ExecCommande(CSP_HOLDCALL,local.thisDN,local.ConnID);
		local.SetEtat(CTI_ET_ATTENTE);

	when 4 do
		-- Si le client est en attente, on le recupère
		self.local.Transition(1,'Attente');
		self.ExecCommande(CSP_UNHOLDCALL,local.thisDN,local.ConnID);
		local.SetEtat(CTI_ET_OCCUPE);

	else
		self.local.Transition(0,'Attente');
end case;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Attente : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Attente');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ChangementMotDePasse
begin
--
--	Description :		Transfert direct vers le SVI pour changement du mot de passe
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			08/10/1997		Correction bug (fiche ano 3)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ChangementMotDePasse');

-- Declarations

-- Traitement

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 9 do
		self.local.Transition(6,'TransfertDirect');
		
		self.ExecCommande(CSP_ATTACHDATA, local.thisDN, local.ConnID,CTI_KEY_APPID, CTI_SVI_MOTDEPASSE);
		self.ExecCommande(CSP_ATTACHDATA, local.thisDN, local.ConnID,CTI_KEY_AGENTID, local.LoginId);
		
		self.ExecCommande(CSP_TRANSFERMUTE,local.thisDN, CTI_SVI_NUMERO, local.ConnID);
		
	else
		self.local.Transition(0,'TransfertDirect');
end case;



-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ChangementMotDePasse : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ChangementMotDePasse');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ConsultationCompte
begin
--
--	Description :		Transfert direct vers le SVI, fonction consultation de compte
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			08/10/1997		Correction bug (fiche ano 3)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ConsultationCompte');

-- Declarations

-- Traitement
case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 9 do
		self.local.Transition(6,'TransfertDirect');
		
		self.ExecCommande(CSP_ATTACHDATA, local.thisDN, local.ConnID,CTI_KEY_APPID, CTI_SVI_CONSULTECOMPTE);
		self.ExecCommande(CSP_ATTACHDATA, local.thisDN, local.ConnID,CTI_KEY_AGENTID, local.LoginId);
		self.ExecCommande(CSP_TRANSFERMUTE,local.thisDN, CTI_SVI_NUMERO, local.ConnID);

	else
		self.local.Transition(0,'TransfertDirect');
end case;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ConsultationCompte : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ConsultationCompte');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Decroche
begin
--
--	Description :		Décroche (prise de ligne) après l'arrivée d'un appel
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Decroche');

-- Declarations

-- Traitement
self.ExecCommande(CSP_ANSWERCALL,local.thisDN, local.ConnID);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Decroche : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Decroche');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.DemarrerEnregistrement
begin
--
--	Description :		Lance l'enregistrement de la conversation
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.DemarrerEnregistrement');

-- Declarations

-- Traitement
if Not(local.EnregistrementAutomatique) then
	self.ExecCommande(CSP_UPDATEDATA,local.thisDN,local.ConnID,CTI_KEY_ENREGISTREMENT,CTI_MES_ACTIF);
	local.EnregistrementEnCours = TRUE;
end if;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.DemarrerEnregistrement : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.DemarrerEnregistrement');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.DiffererAppelCampagne(input pParam: CtiItBD.DiffererAppelCampagneParam)
begin
--
--	Description :		Differer un appel programmé pour une campagne
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	FG			04/07/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.DiffererAppelCampagne');

-- Declarations

-- Traitement
-- constitution de la chaine paramètre 

param : TextData;

param = new;

-- Données de base
param.concat(local.thisDN); param.concat(',');					-- thisDN
param.concat(local.thisDN); param.concat(',');					-- eventDN
param.concat('0'); param.concat(',');							-- ConnId
param.concat('0'); param.concat(',');							-- CallId
param.concat(local.LoginID); param.concat(',');					-- AgentID
param.concat('0'); param.concat(',');							-- ANI
param.concat('1'); param.concat(',');							-- CallType
param.concat('AGENT_REQ_TYPE'); param.concat(',');				-- key
param.concat('ScheduledCallReschedule'); param.concat(',');		-- value
param.concat('GSW_RECORD_HANDLE'); param.concat(',');			-- key
param.concat(local.recordhandle); param.concat(',');			-- value
param.concat('GSW_DATE_TIME'); param.concat(',');				-- key
param.concat(pParam.pDaterappel); param.concat(',');			-- value
param.concat('GSW_CALLBACK_TYPE'); param.concat(',');			-- key
param.concat('Campaign'); -- param.concat(',');					-- value

-- ***** modifications Fabien du 08/08 *****
-- param.concat('GSW_PHONE'); param.concat(',');					-- key
-- param.concat('pParam.pPhone'); param.concat(',');				-- value
-- param.concat('GSW_CAMPAIGN_NAME'); param.concat(',');			-- key
-- param.concat('pParam.pNomCampagne'); param.concat(',');			-- value
-- ***** fin des modifications *****

self.ExecCommande(CSP_SENDUSEREVENT,param.value);


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.DiffererAppelCampagne : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.DiffererAppelCampagne');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ExecCommande(input pCommande: Framework.string,
	input pParam1: Framework.string = '(nul)',
	input pParam2: Framework.string = '(nul)',
	input pParam3: Framework.string = '(nul)',
	input pParam4: Framework.string = '(nul)')
begin
--
--	Description :	Construit puis lance la commande vers le DDE commande (Softphone)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pCommande : string = commande Softphone a éxécuter
--								pParam1 : string = premier paramètre de la commande
--								pParam2 : string = second paramètre de la commande
--								pParam3 : string = troisième paramètre de la commande
--								pParam4 : string = quatrième paramètre de la commande
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			24/07/1977		Adaptation pour socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ExecCommande');

-- Declarations
commande : TextData = new;

-- Traitement

if (pParam1 ='(nul)') then --1
	-- Pas de paramètre
	commande.value = pCommande;
	
elseif (pParam2='(nul)') then --1
	-- Un paramètre
	commande.ReplaceParameters('%1,%2',
			TextData(value=pCommande),
			TextData(value=pParam1));

elseif (pParam3='(nul)') then --1
	-- Deux paramètres
	commande.ReplaceParameters('%1,%2,%3',
			TextData(value=pCommande),
			TextData(value=pParam1),
			TextData(value=pParam2));
			
elseif (pParam4='(nul)') then --1
	-- Trois paramètres
	commande.ReplaceParameters('%1,%2,%3,%4',
			TextData(value=pCommande),
			TextData(value=pParam1),
			TextData(value=pParam2),
			TextData(value=pParam3));
			
else --1
	-- Quatre paramètres
	commande.ReplaceParameters('%1,%2,%3,%4,%5',
			TextData(value=pCommande),
			TextData(value=pParam1),
			TextData(value=pParam2),
			TextData(value=pParam3),
			TextData(value=pParam4));
end if; --1

self.ExecuteCde(commande);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,commande.value);

end method;

------------------------------------------------------------
method ApplicatifCTI.ExecuteCde(input command: Framework.TextData)
begin
TryCount : integer = 1;

event loop
	preregister
		register ExecCompleteEH(command=command, tryCount=TryCount);
	postregister
		self.RequestExec(command=command);
end event;

end method;

------------------------------------------------------------
method ApplicatifCTI.InfoAppel(input pParam: CtiItBD.InfoAppelParam)
begin
--
--	Description :		Envoi au CTI l'identifiant RC de l'appel (pour indexation)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pAPPID : string = Identifiant RC de l'appel
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			35/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.InfoAppel');

-- Declarations

-- Traitement
-- Attachement du numero RC de l'appel

local.AppId = pParam.pAPPID;
if (local.EtatModuleCTI = 3) then
	-- Si c'est un appel sortant qui n'est pas abouti, on attend plus tard
else
	local.AppId = ''; -- On l'attache donc il n'est plus a attacher plus tard
	self.ExecCommande(CSP_UPDATEDATA, local.thisDN, local.ConnID, CTI_KEY_TRANSACTIONID, pParam.pAPPID);
end if;



-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.InfoAppel : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.InfoAppel');
		Raise;
		
end method;

------------------------------------------------------------
method ApplicatifCTI.InfoClient(input pParam: CtiItBD.InfoClientParam)
begin
--
--	Description :		Renseigne le numéro de client lorsqu'il n'était pas connu à l'arrivée dans la RC
--						(identification incorrecte)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pCLIENTID : string = identifiant du client
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.InfoClient');

-- Declarations

-- Traitement
self.local.ClientId = pParam.pCLIENTID;
self.ExecCommande(CSP_UPDATEDATA, local.thisDN, local.ConnID, CTI_KEY_CLIENTID, pParam.pCLIENTID);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.InfoClient : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.InfoClient');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			24/07/1997		Adaptation socle
--+


super.Init();
Self.SystemConversation = new();
Self.Connected 			= FALSE;

end method;

------------------------------------------------------------
method ApplicatifCTI.InitialiserConnection
begin
if (Not Self.connected) then
	-- connection du lien DDE 'System'
	application : TextData = new(value='SoftPhoneApp');
	topic 		: TextData = new(value='System');
	autoLaunch 	: Boolean  = FALSE;
	self.SystemConversation.InitiateConnection (
				   	application=application,
				   	topic=topic,
				   	autoLaunch = autoLaunch);
	Self.Connected = TRUE;
	
	Start task Self.registerEventHandler();
	Start task self.registerEcouteEtat();

end if;

exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.InitialiserConsultation');
		Raise;
		
	when uneSystemResourceExc : SystemResourceException do
		if (uneSystemResourceExc.ReasonCode = SP_ER_DDE_SERVERAPPNOTACTIVE) then

			-- Attend une seconde et recommance
			task.Delay(1000);	
			self.InitialiserConnection();
			
		elseif (uneSystemResourceExc.ReasonCode = SP_ER_WINDOWLIMIT) then
			uneCTITechExc : CTITechExc = new();
			Self.TraceExc(uneCTITechExc,'ApplicatifCTI.InitialiserConnection');
			task.ErrorMgr.AddError(uneCTITechExc);
			raise uneCTITechExc;
		end if;
		
	when uneUsageExc : UsageException do
		uneCTITechExc : CTITechExc = new();
		Self.TraceExc(uneCTITechExc,'ApplicatifCTI.InitialiserConnection');
		if (uneUsageExc.ReasonCode = SP_ER_PARAMETERERROR) then
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, paramètres vides.');
		else
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, connexion déjà établie.');		
		end if;
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;


end method;

------------------------------------------------------------
method ApplicatifCTI.InitialiserConsultation(input pParam: CtiItBD.InitialiserConsultationParam)
begin
--
--	Description :		Initialise une consultation (transfert indirect) ou une conférence
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pPHONE : string = numéro appelé
--					Output	--> pTYPE_CONS : integer = indicateur consultation/conférence
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--	DN			09/10/1997		Correction suite fiche ano 9
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.InitialiserConsultation');

-- Declarations

-- Traitement

-- Consultation ou conférence

if (self.local.LoginID = pParam.pPHONE) or (self.local.thisDN = pParam.pPHONE) then
	post self.local.AnnuleTransfertEvt(pRaison='CTI : Transfert ou conférence avec soi même non autorisé');

else
	if (pParam.pTYPE_CONS = CTI_TR_INDIRECT) then --1
		case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
			when 9 do
				self.local.Transition(7,'InitialiserConsultation(INDIRECT)');
			else
				self.local.Transition(0,'InitialiserConsultation(INDIRECT)');
		end case;
		-- ceci afin de forcer le ClientID comme derniere donnee attachee, pour la montee de fiche
		self.ExecCommande(CSP_ATTACHDATA,local.thisDN, local.ConnID, CTI_KEY_CLIENTID, local.ClientID);

		self.ExecCommande(CSP_TRANSFERINIT, local.thisDN, pParam.pPHONE, local.ConnID);

	elseif (pParam.pTYPE_CONS = CTI_TR_CONFERENCE) then --1
		case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
			when 9 do
				self.local.Transition(8,'InitialiserConsultation(CONS)');
			else
				self.local.Transition(0,'InitialiserConsultation(CONS)');
		end case;
		-- ceci afin de forcer le ClientID comme derniere donnee attachee, pour la montee de fiche
		self.ExecCommande(CSP_ATTACHDATA,local.thisDN, local.ConnID, CTI_KEY_CLIENTID,local.ClientID);

		self.ExecCommande(CSP_CONFINIT, local.thisDN, pParam.pPHONE, local.ConnID);

	else --1
	end if; --1
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.InitialiserConsultation : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.InitialiserConsultation');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Liberer
begin
--
--	Description :		Libere le conseiller. Son etat passe d'ACW à libre
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Liberer');

-- Declarations

-- Traitement

-- Passage de ACW à LIBRE
-- On confirme le mode SetManualReady
self.SetManualReady();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Liberer : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Liberer');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Login(input pParam: CtiItBD.LoginParam)
begin
--
--	Description :		Login téléphonique du conseiller
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pLoginId : string = identifiant téléphonique du conseiller
--								pNumTel : string = numéro de poste téléphonique
--					Output	-->
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Login');

-- Declarations

-- Traitement

self.ExecCommande(CSP_OPEN);
self.ExecCommande(CSP_REGISTERDNS,pParam.pNumTel);
local.thisDN = pParam.pNumTel;
self.ExecCommande(CSP_LOGIN,pParam.pNumTel,pParam.pLoginId,pParam.pNumTel);
local.LoginID = pParam.pLoginID;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Login : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Login');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Logout
begin
--
--	Description :		Déconnexion téléphonique du conseiller
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Logout');

-- Declarations

-- Traitement

self.ExecCommande(CSP_LOGOUT,local.thisDN);


-- Automatique sur l'évt associé * local.SetEtat(CTI_ET_NOTLOGGED);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Logout : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Logout');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.MajCampagne
begin
--
--	Description :		Met à jour la campagne d'appel suite à un appel de rendez-vous
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/08/1997		Création et adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.MajCampagne');

-- Declarations
param : TextData;

-- Traitement
param = new;

-- Mise à jour de la campagne d'appel (première étape)

param.concat(local.thisDN); param.concat(',');					-- thisDN
param.concat(local.thisDN); param.concat(',');					-- eventDN
param.concat('0'); param.concat(',');							-- ConnId
param.concat('0'); param.concat(',');							-- CallId
param.concat(local.LoginID); param.concat(',');					-- AgentID
param.concat('0'); param.concat(',');							-- ANI
param.concat('1'); param.concat(',');							-- CallType
param.concat('AGENT_REQ_TYPE'); param.concat(',');				-- key
param.concat('UpdateCallCompletionStats'); param.concat(',');	-- value
param.concat('GSW_RECORD_HANDLE'); param.concat(',');			-- key
param.concat(local.rdv.record_handle); param.concat(',');		-- value
param.concat('GSW_CALLING_LIST'); param.concat(',');			-- key
param.concat(local.rdv.calling_list); param.concat(',');		-- value
param.concat('GSW_CALL_RESULT'); param.concat(',');				-- key
if (local.rdv.abouti) then
	-- Appel Traité
	param.concat('1'); param.concat(',');						-- value
else
	-- L'appel n'a pas abouti
	param.concat('4'); param.concat(',');						-- value
end if;
param.concat('LIST_DB_ACTION'); param.concat(',');				-- key
param.concat('Update'); 										-- value

self.ExecCommande(CSP_SENDUSEREVENT,param.value);

-- Mise à jour de la campagne d'appel (seconde étape)

param.concat(local.thisDN); param.concat(',');					-- thisDN
param.concat(local.thisDN); param.concat(',');					-- eventDN
param.concat('0'); param.concat(',');							-- ConnId
param.concat('0'); param.concat(',');							-- CallId
param.concat(local.LoginID); param.concat(',');					-- AgentID
param.concat('0'); param.concat(',');							-- ANI
param.concat('1'); param.concat(',');							-- CallType
param.concat('AGENT_REQ_TYPE'); param.concat(',');				-- key
param.concat('RecordProcessed'); param.concat(',');				-- value
param.concat('GSW_RECORD_HANDLE'); param.concat(',');			-- key
param.concat(local.rdv.record_handle); param.concat(',');		-- value
param.concat('GSW_TREATEMENT'); param.concat(',');				-- key
param.concat('RecordTreatCampaign'); param.concat(',');			-- value

self.ExecCommande(CSP_SENDUSEREVENT,param.value);

--self.ExecCommande(CSP_DELETEALLUSERDATA,local.thisDN,local.ConnId);
local.Rdv.existe = FALSE;
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.MajCampagne : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.MajCampagne');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Pause
begin
--
--	Description :		Le conseiller signale qu'il prend une pause (au sens téléphonique) ou qu'il revient
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Pause');

-- Declarations

-- Traitement
-- Si on est déjà en pause, on revient disponible
if (local.EtatPABX=CTI_ET_PAUSE) then --1
	self.SetManualReady();
else --1
	-- Sinon on passe en pause
	self.SetNotReady();
end if; --1
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Pause : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Pause');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Quitter
begin


end method;

------------------------------------------------------------
method ApplicatifCTI.Raccroche
begin
--
--	Description :		Le conseille met fin à la communication et libère la ligne 
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Raccrocher');

-- Declarations

-- Traitement
self.ExecCommande(CSP_RELEASECALL,local.thisDN, local.ConnID);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Raccrocher : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Raccrocher');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.RecupereAppel
begin
--
--	Description :		Recupere le client (après annulation d'une consultation par le destinataire)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			28/08/1997		Création
--	DN			09/10/1997		Correction suite gestion des erreurs
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.RecupereAppel');

-- Declarations

-- Traitement

-- Si le client est en attente, on le recupère
self.ExecCommande(CSP_UNHOLDCALL,local.thisDN,local.ConnID);
local.DemandeUnHold = TRUE ;
--local.SetEtat(CTI_ET_OCCUPE);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.RecupereAppel : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.RecupereAppel');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.Reecoute(input pParam: CtiItBD.ReecouteParam)
begin
--
--	Description :		Demande de réécoute d'un enregistrement
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pCLIENTID : string = identifiant du client
--								pAPPID : string = identifiant RC de l'appel
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.Reecoute');

-- Declarations

-- Traitement
self.ExecCommande(CSP_ATTACHDATA, local.thisDN, CTI_KEY_CLIENTID, pParam.pCLIENTID);
self.ExecCommande(CSP_ATTACHDATA, local.thisDN, 'APPID', pParam.pAPPID);
self.ExecCommande(CSP_CONFINIT,'Nice');
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.Reecoute : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.Reecoute');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ReecouteClient
begin
--
--	Description :		Permet au client d'entendre l'enregistrement
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ReecouteClient');

-- Declarations

-- Traitement
self.ExecCommande(CSP_CONFCOMPLETE,'');
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ReecouteClient : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ReecouteClient');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.registerEcouteEtat
begin
--
--	Description :		Ecoute de l'evenement de changement d'état
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			28/07/1997		Création et adaptation socle
--	DN			09/10/1997		Modif pour capture d'exception
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.registerEcouteEtat');

-- Declarations

-- Traitement
registration : EventRegistration;
event loop
	preregister
		registration = register EcouteEtatEVH();
 
	when Self.Terminer do
		registration.DeregisterHandler();
		
	when task.ShutDown do
		exit;


end event;

	
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.registerEcouteEtat : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.registerEcouteEtat');
		Raise;
		
	when uneUsageExc : UsageException do
		if (uneUsageExc.ReasonCode = SP_ER_INVALIDSTATE) then
			return;
		else
			Self.TraceExc(uneUsageExc, 'ApplicatifCTI.registerEcouteEtat');
			raise;
		end if;
		
	When uneCTITechExc : CTITechExc do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Message intercepte dans CTIApplicatif.registerEcouteEtat');
	


end method;

------------------------------------------------------------
method ApplicatifCTI.registerEventHandler
begin
event loop
	when Self.SystemConversation.Disconnected do
		if (Self.Connected) then
			Self.Connected = FALSE;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Deconnection de System Conversation. Serveur tombe');
			Self.TerminerConnection();

			uneCTIGraveExc : CTIGraveExc = new();
			uneCTIGraveExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'CTI : Erreur grave : SoftPhone n\'est plus connecté');
			Self.TraceExc(uneCTIGraveExc,'ApplicatifCTI.registerEventHandler');
			task.ErrorMgr.AddError(uneCTIGraveExc);
			raise uneCTIGraveExc;

		end if;
end event;

exception
	When uneCTITechExc : CTITechExc do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Message intercepte dans ApplicatifCTI.registerEventHandler');
	When e: CancelException do
		Return;
		
	When grave : CTIGraveExc do
		Return;

end method;

------------------------------------------------------------
method ApplicatifCTI.RequestExec(input command: Framework.TextData)
begin
begin

SystemConversation.RequestExec(command=command);

exception
	-- tester  les exceptions associées a RequestExec
	when uneUsageExc : UsageException do
		task.part.logmgr.putline(command);
		uneCTIGraveExc : CTIGraveExc = new();
		uneCTITechExc : CTITechExc = new();
		if (uneUsageExc.ReasonCode = SP_ER_PARAMETERERROR) then
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, paramètres vides');
		elseif (uneUsageExc.ReasonCode = SP_ER_INVALIDSTATE) then
			uneCTIGraveExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'CTI : Erreur grave : pas de connection SoftPhone');
			Self.TraceExc(uneCTIGraveExc,'ApplicatifCTI.RequestExec');
			task.ErrorMgr.AddError(uneCTIGraveExc);
			raise uneCTIGraveExc;
		else
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, Raison inconnue');		
		end if;
		Self.TraceExc(uneCTITechExc,'ApplicatifCTI.RequestExec');
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;
end;
end method;

------------------------------------------------------------
method ApplicatifCTI.SetAfterCallWork
begin
--
--	Description :		Demande le passage à l'état AfterCallWork
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			25/07/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.SetAfterCallWork');

-- Declarations

-- Traitement
self.ExecCommande(CSP_SETMANUALREADY,local.thisDN);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.SetAfterCallWork : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.SetAfterCallWork');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.SetManualReady
begin
--
--	Description :		Demande le passage à l'état ManualReady
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			25/07/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.SetManualReady');

-- Declarations

-- Traitement
self.ExecCommande(CSP_SETMANUALREADY,local.thisDN);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.SetManualReady : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.SetManualReady');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.SetNotReady
begin
--
--	Description :		Demande le passage à l'état NotReady
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			25/07/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.SetNotReady');

-- Declarations

-- Traitement
self.ExecCommande(CSP_SETNOTREADY,local.thisDN);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.SetNotReady : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.SetNotReady');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.TerminerConnection
begin
if (Self.Connected) then
	Self.SystemConversation.TerminateConnection();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Deconnection de System Conversation. Demande Applicative');
	self.Connected = FALSE;
	post Self.Terminer;
end if;

exception
	when uneException : UsageException do
		uneCTITechExc : CTITechExc = new();
		uneCTITechExc.NativeMessage = new(value='Conversation SoftPhoneConversation not connected');
		Self.TraceExc(uneCTITechExc,'CTIApplicatif.TerminerConnection');
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;	

end method;

------------------------------------------------------------
method ApplicatifCTI.TransfertDirect(input pParam: CtiItBD.TransfertDirectParam)
begin
--
--	Description :		Demande un transfert direct du client
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pPHONE : string = numéro de téléphone du destinataire
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			09/10/1997		Correction suite fiche ano 9
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.TransfertDirect');

-- Declarations

-- Traitement

if (self.local.LoginID = pParam.pPHONE) or (self.local.thisDN = pParam.pPHONE) then
	post self.local.AnnuleTransfertEvt(pRaison='CTI : Transfert sur soi même non autorisé');

else
	case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
		when 9 do
			self.local.Transition(6,'TransfertDirect');
		
			-- ceci afin de forcer le ClientID comme derniere donnee attachee, pour la montee de fiche
			self.ExecCommande(CSP_ATTACHDATA,local.thisDN, local.ConnID, CTI_KEY_CLIENTID, self.local.ClientID);

			self.ExecCommande(CSP_TRANSFERMUTE,local.thisDN, pParam.pPHONE, local.ConnID);

		else
			self.local.Transition(0,'TransfertDirect');
	end case;
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.TransfertDirect : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.TransfertDirect');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ValiderConference
begin
--
--	Description :		Valide une conférence initialisée (passage en conférence effective)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ValiderConference');

-- Declarations

-- Traitement
self.ExecCommande(CSP_CONFCOMPLETE,local.thisDN, local.ConnIDTrans);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ValiderConference : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ValiderConference');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.ValiderTransfert
begin
--
--	Description :		Valide un transfert indirect initialisé
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.ValiderTransfert');

-- Declarations

-- Traitement
self.ExecCommande(CSP_TRANSFERCOMPLETE,local.thisDN);
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.ValiderTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.ValiderTransfert');
		Raise;
end method;

------------------------------------------------------------
method ApplicatifCTI.zzzTraceSPEvent(input pSP_EVENT: Framework.string,
	input pDATA: CtiItBD.DDEData)
begin
--
--	Description :	Trace l'arrivée d'un evenement SoftPhone
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pSP_EVENT : string = nom de l'evenement Softphone recu
--								pDATA : string = données attachée à l'evenement
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.TraceSPEvent');

-- Declarations


-- Traitement

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'ESP : ');
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pSP_EVENT);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' recu.');

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ApplicatifCTI.TraceSPEvent : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ApplicatifCTI.TraceSPEvent');
		Raise;
 

end method;

------------------------------------------------------------
event handler ApplicatifCTI.EcouteEtatEVH()
begin
when local.RendezVousEvt() do
	-- Si un rendez-vous arrive on le prend systématiquement
	-- Donc on l'acquitte

	-- ***** modifications Fabien 08/08 : acquittement de rappel vers CM *****
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'debut acquittement');
	self.AcquitterRappel();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'fin de acquittement');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,local.Rdv.fini);


-- Si il y a une demande de changement d'état
when local.ChangementEtatEvt(etat=pEtatActuel) do
	-- On la traduit en commande Softphone
	
	if (etat = CTI_ET_LIBRE) then
		-- On teste si un rendez vous existe !
		if (local.Rdv.Existe) then
			if (local.Rdv.fini) then
				-- L'appel est déjà fait, il faut mettre à jour la base CM
				self.MajCampagne();
			else
				-- C'est le moment de faire cet appel
				unAppel : AppelClientParam = new();
				unAppel.pCLIENTID = local.rdv.ClientId;
				unAppel.pCLIENTPHONE = local.rdv.Phone;
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'lancement de l appel de rendez vous');
				self.AppelClient(unAppel);
			end if;
		end if;
	
	elseif (etat = CTI_ET_ACW) then
	/*	Rien a faire
		Automatique dans le cas d'un mode MANUELIN
		self.SetAfterCallWork();
	*/
	
	elseif (etat = CTI_ET_ATTENTE) then
		-- Rien a faire, géré par la methode self.Attente
	
	elseif (etat = CTI_ET_AUTOIN) then
		-- On n'est pas dispo, on fait un appel
	
	elseif (etat = CTI_ET_NOTLOGGED) then
		-- On libère le poste téléphonique
		self.ExecCommande(CSP_UNREGISTERDNS,local.ThisDN,local.thisDN);
		-- On ferme la connexion avec TServer
		self.ExecCommande(CSP_CLOSE,'');
	elseif (etat = CTI_ET_LOGGED) then
		-- Pour le moment, on se logge en AUTO-IN donc il faut se déclarer disponible
		-- avec SETREADY (alternative : SETMANUALREADY en mode MANUALIN)
		self.ExecCommande(CSP_SETMANUALREADY,local.thisDN,local.thisDN);
	elseif (etat = CTI_ET_OCCUPE) then
		-- Rien a faire, c'est géré par le PABX
	
	elseif (etat = CTI_ET_PAUSE) then
		-- On passe en pause (Indisponible)
		--self.SetNotReady();
	
	else
		-- Rien à faire, c'est pas prévu
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Etat non prévu !!!');
	end if;

end event;

------------------------------------------------------------
event handler ApplicatifCTI.ExecCompleteEH(input command: Framework.TextData,
	input tryCount: Framework.integer)
begin
when SystemConversation.ExecComplete(cmd=Command, isOkay=IsOkay,	
		 			rc=ReturnCode,isBusy=IsBusy) do		 			
	if 	(not isOkay) then
		if (isBusy) then
			-- try again  
			if (TryCount > 3) then
				uneCTITechExc : CTITechExc = new();
				uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
							message = 'Echec à l''appel système non disponible');
				unMessage : TextData = new(value='ApplicatifCTI.');
				unMessage.Concat(Command);
				Self.TraceExc(uneCTITechExc,unMessage.value);
				task.ErrorMgr.AddError(uneCTITechExc);
				raise uneCTITechExc;
			else
				self.RequestExec(command=command);
				TryCount = TryCount + 1;
			end if;
	 	else
			uneCTITechExc : CTITechExc = new(nativeCode=rc);
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
						message = 'Echec à l''execution');
			Self.TraceExc(uneCTITechExc,'ApplicatifCTI.Dial');
			task.ErrorMgr.AddError(uneCTITechExc);
			raise uneCTITechExc;
	 	end if;
	end if; 
	exit;			 			
end event;

------------------------------------------------------------
method ComplementaryDDEData.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ConferenceEVTParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CTIApplicatif.AnnulePrepareTransfert
begin
--
--	Description :	Annulation de la preparation d'un transfet
--					Passage du mode Preparation du transfert (9) à Normal (1)
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.AnnulePrepareTransfert');

-- Declarations


-- Traitement
case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 9 do
		self.local.Transition(1,'AnnulePrepareTransfert');
		self.NotifierEvenement(EVT_CTI_TRANSFERTANNULE);
	else
		self.local.Transition(0,'AnnulePrepareTransfert');
end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.AnnulePrepareTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.AnnulePrepareTransfert');
		Raise;
end method;

------------------------------------------------------------
method CTIApplicatif.AppelArrive(input typeAppel: Framework.string)
begin
--
--	Description :	Genération de l'événement AppelArrive
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			09/10/1997		Creation (suite a appel possible sur Ringing ou Transfered)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.AppelArrive');

	
numclient : string = self.local.lastDDEData.GetKeyValue(pKey = CTI_KEY_CLIENTID);
		
if (numclient='') then
	numclient= CTI_SVI_CLIENTRESERVE;
else
	-- Rien a faire
end if;

self.local.ClientId = numclient;


statutenreg : string = self.local.lastDDEData.GetKeyValue(pKey = CTI_KEY_ENREGISTREMENT);
if (statutenreg = '') then
	-- Pas de donnée attachée pour l'enregistrement
	-- Pas d'enregistrement auto
	local.EnregistrementAutomatique = FALSE;
elseif (statutenreg = CTI_MES_ACTIF) then
	-- Enregistrement auto en cours
	local.EnregistrementAutomatique = TRUE;
elseif (statutenreg = CTI_MES_INACTIF) then
	-- Pas d'enregistrement auto en cours
	local.EnregistrementAutomatique = FALSE;
else
	-- Rien à faire
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Type enregistrement incorrect');
end if;
local.EnregistrementEnCours = local.EnregistrementAutomatique;

local.RecordHandle = self.local.lastDDEData.GetKeyValue(pKey=CTI_KEY_GSW_RECORD_HANDLE);
local.NomCampagne = self.local.lastDDEData.GetKeyValue(pKey=CTI_KEY_CAMPAGNE);

If self.EstSvi(self.local.lastDDEData.OtherDN) And (typeappel = '4') then
	local.AppelArriveEmis = FALSE;
else
	self.NotifierEvenement(EVT_CTI_APPELARRIVE,numclient,typeappel,local.EnregistrementAutomatique,FALSE,FALSE,FALSE,local.NomCampagne);
	local.AppelArriveEmis = TRUE;
end if;
	
local.CallId = self.local.lastDDEData.CallID;
local.ConnId = self.local.lastDDEData.ConnId;


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.AppelArrive : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.AppelArrive');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.EstSvi(input pNumTel: Framework.string): Framework.boolean
begin
--
--	Description :	Genération de l'événement EstSvi
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			09/10/1997		Creation (cf fiche ano 9 pour determination origine de l'appel)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.EstSvi');

	
result : boolean;

numText : TextData = new(value=pNumTel);

num : integer = numText.IntegerValue;
 

if (num >= CTI_SVI_DEBPLAGE1) AND (num <= CTI_SVI_FINPLAGE1) then
	-- Message en provenance du SVI 1
	task.part.logmgr.putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, 'Provenance SVI 1 ');
	result = TRUE;
elseif (num >= CTI_SVI_DEBPLAGE2) AND (num <= CTI_SVI_FINPLAGE2) then
	-- Message en provenance du SVI 2
	task.part.logmgr.putline(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, 'Provenance SVI 2 ');
	result = TRUE;
else
	result = FALSE;
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.EstSvi : End');

Return result;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.EstSvi');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.Init
begin
super.Init();
self.SoftPhoneConversation 	= new();
--self.zzzArrayNotifier			= new();
Self.Connected = FALSE;


-- Construction de la liste des évènements Softphone

laListeEvenementSoftphone = new;

unEvenementSoftphone : EvenementSoftphone;

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ADDRESSALLOCATED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ADDRESSFREED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ADDRESSINFO);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTAFTERCALLWORK);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

--unEvenementSoftphone = new;
--unEvenementSoftphone.leNom= new(value= ESP_AGENTBUSY);
--laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLFORWARDCANCEL);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLFORWARDSET);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTLOGIN);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTLOGOUT);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTMANUALREADY);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTNOTBUSY);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTNOTREADY);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_AGENTREADY);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ATTACHEDDATACHANGED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLHOLDED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLPARKED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLUNHOLDED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CALLUNPARKED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_CONFERENCED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_DIALING);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ESTABLISHED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_RINGING);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_RELEASED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_SERVERDISCONNECT);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_TRANSFERED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_RETRIEVED);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_DESTINATIONBUSY);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_ERROR);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_SPERROR);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

unEvenementSoftphone = new;
unEvenementSoftphone.leNom= new(value= ESP_USEREVENT);
laListeEvenementSoftphone.AppendRow(object=unEvenementSoftphone);

end method;

------------------------------------------------------------
method CTIApplicatif.InitialiserConnection
begin
if (Not self.connected) then

	-- connection du lien DDE 'SoftPhone'
	application : TextData = new(value='SoftPhoneAppSimul'); -- SIMUL PABX
	topic 		: TextData = new(value='SoftPhoneSimul'); -- SIMUL PABX
	autoLaunch 	: Boolean  = FALSE;
	self.SoftPhoneConversation.InitiateConnection (
			   	application=application,
			   	topic=topic,
			   	autoLaunch = autoLaunch);
	Self.Connected = TRUE;

	-- Abonnement aux events SoftPhone
	start task registerHotLink() where completion = Event;
	Start task self.registerEcouteEtat();
end if;
 
exception 
	when uneSystemResourceExc : SystemResourceException do
		if (uneSystemResourceExc.ReasonCode = SP_ER_DDE_SERVERAPPNOTACTIVE) then
		
			-- Ca ne doit plus arriver
			
			-- Attend une seconde et recommance
			task.Delay(1000);	
			self.InitialiserConnection();
			
		elseif (uneSystemResourceExc.ReasonCode = SP_ER_WINDOWLIMIT) then
			uneCTITechExc : CTITechExc = new();
			Self.TraceExc(uneCTITechExc,'APICTI.InitialiserConnection');
			task.ErrorMgr.AddError(uneCTITechExc);
			raise uneCTITechExc;
		end if;

	
	when uneUsageExc : UsageException do
		uneCTITechExc : CTITechExc = new();
		Self.TraceExc(uneCTITechExc,'APICTI.Dial');
		if (uneUsageExc.ReasonCode = SP_ER_PARAMETERERROR) then
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, paramètres vides.');
		else
			uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'Attention, connexion déjà établie.');		
		end if;
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;

end method;

------------------------------------------------------------
method CTIApplicatif.LinkStartSoftPhone
begin
for unEvt in laListeEvenementSoftphone do
 start task SoftPhoneConversation.RequestLinkStart(item=unEvt.leNom, isHot=TRUE);
end for;

end method;

------------------------------------------------------------
method CTIApplicatif.NotifierEvenement(copy input pCodeEvt: Framework.integer,
	copy input pParam1: Framework.string = '\'\'',
	copy input pParam2: Framework.string = '\'\'',
	copy input pParamBool: Framework.boolean = FALSE,
	copy input pParamBool2: Framework.boolean = FALSE,
	copy input pParamBool3: Framework.boolean = FALSE,
	copy input pParamBool4: Framework.boolean = FALSE,
	copy input pParamStringSup: Framework.string = '\'\'')
begin
--
--	Description :		Nofitie un evenement à tous les abonnés
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	-->	pCodeEvt : integer = code de l'evenement
--								pParam1 : string = premier paramètre de l'evenement (optionnel)
--								pParam2 : string = second  paramètre de l'evenement (optionnel)
--								pParamBool : boolean = troisieme parametre (optionnel)
--								pParamBool2 : boolean = quatrieme parametre (optionnel)
--								pParamBool3 : boolean = cinquieme parametre (optionnel)
--								pParamBool4 : boolean = sixieme parametre (optionnel)
--								pParamStringSup : string = troisieme paramètre chaine (optionnel)
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			25/07/1997		Creation / Adaptation socle
--	DN			20/08/1997		Mise à jour pour notifier
--	DN			08/10/1997		Modif pour inclure un paramètre string suplémentaire (fiche ano 10)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.NotifierEvenement');

-- Declarations

-- Traitement

unCTIEventParam : CTIEventParam = new();
unCTIEventParam.Param1 = pParam1;
unCTIEventParam.Param2 = pParam2;
unCTIEventParam.Param3 = pParamStringSup;
unCTIEventParam.ParamBool = pParamBool;
unCTIEventParam.ParamBool2 = pParamBool2;
unCTIEventParam.ParamBool3 = pParamBool3;
unCTIEventParam.ParamBool4 = pParamBool4;


post self.CTIApplicatifEvt(EventCode=pCodeEvt,EventData=unCTIEventParam);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.NotifierEvenement : End');

Return;

Exception
	When e : GenericException do
-- Pb avec le socle :		Self.TraceExc(e, 'CTIApplicatif.NotifierEvenement');
		Raise;


	
end method;

------------------------------------------------------------
method CTIApplicatif.PrepareTransfert
begin
--
--	Description :	Passage en mode Preparation du transfert (9)
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création 
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.PrepareTransfert');

-- Declarations


-- Traitement
case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 1 do
		self.local.Transition(9,'PrepareTransfert');
		self.NotifierEvenement(EVT_CTI_TRANSFERTPREPARE);

	else
		self.local.Transition(0,'PrepareTransfert');
		unExc : CTITechExc = new();
		unExc.Message = new(value='Un transfert est déjà préparé');
		Raise unExc;

end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.PrepareTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.PrepareTransfert');
		Raise;
end method;

------------------------------------------------------------
method CTIApplicatif.ReactionAgentLogin
begin
--
--	Description :	Réaction à l'événement AgentLogin
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionAgentLogin');

-- Declarations


-- Traitement

-- Le conseiller passe loggé
local.EtatModuleCTI = 1;
local.SetEtat(CTI_ET_LOGGED);


-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionAgentLogin : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionAgentLogin');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionAgentLogout
begin
--
--	Description :	Réaction à l'événement AgentLogout
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionAgentLogout');

-- Declarations


-- Traitement

local.SetEtat(CTI_ET_NOTLOGGED);
	
-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionAgentLogout : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionAgentLogout');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionAgentManualReady
begin
--
--	Description :	Réaction à l'événement AgentManualReady
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionAgentManualReady');

-- Declarations


-- Traitement

-- Manual Ready = LIBRE
local.SetEtat(CTI_ET_LIBRE);


-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionAgentManualReady : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionAgentManualReady');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionAgentNotReady
begin
--
--	Description :	Réaction à l'événement AgentNotReady
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionAgentNotReady');

-- Declarations


-- Traitement

-- Not Ready = PAUSE
local.SetEtat(CTI_ET_PAUSE);

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionAgentNotReady : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionAgentNotReady');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionAgentReady
begin
--
--	Description :	Réaction à l'événement AgentReady
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionAgentReady');

-- Declarations


-- Traitement

-- Ready = LIBRE
local.SetEtat(CTI_ET_LIBRE);

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionAgentReady : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionAgentReady');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionConferenced
begin
--
--	Description :	Réaction à l'événement Conferenced
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionConferenced');

-- Declarations


-- Traitement

-- On est destinataire d'une conférence
-- Il faut maintenant utiliser le ConnID de l'appel initial (attaché au CONFERENCED)
local.ConnID = self.local.lastDDEData.ConnID;

statutenreg : string = self.local.lastDDEData.GetKeyValue(pKey = CTI_KEY_ENREGISTREMENT);
if (statutenreg = '') then
	-- Pas de donnée attachée pour l'enregistrement
	-- Pas d'enregistrement auto
	local.EnregistrementAutomatique = FALSE;
elseif (statutenreg = CTI_MES_ACTIF) then
	-- Enregistrement auto en cours
	local.EnregistrementAutomatique = TRUE;
elseif (statutenreg = CTI_MES_INACTIF) then
	-- Pas d'enregistrement auto en cours
	local.EnregistrementAutomatique = FALSE;
else
	-- Rien à faire
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Type enregistrement incorrect');
end if;
local.EnregistrementEnCours = local.EnregistrementAutomatique;
self.sync();

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionConferenced : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionConferenced');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionDestinationBusy
begin
--
--	Description :	Réaction à l'événement DestinationBusy
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionDestinationBusy');

-- Declarations


-- Traitement

-- Occupé : Si c'etait pour un rendez-vous, le rendez-vous est annulé
if (local.rdv.existe) then
	local.rdv.fini = TRUE;
	local.rdv.abouti = FALSE;
end if;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionDestinationBusy : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionDestinationBusy');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionDialing
begin
--
--	Description :	Réaction à l'événement Dialing
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionDialing');

-- Declarations


-- Traitement
case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 2 do
		self.local.Transition(3,'Dialing');
	
		local.lastEtat = local.EtatPABX;
		local.lastEtatValide = TRUE;
		self.local.SetEtat(CTI_ET_AUTOIN);
--		task.delay(500); -- DN RUSE
		-- C'est un appel sortant
		local.ConnID = self.local.lastDDEData.ConnID;
	
		typeappel : string = '3'; -- On force l'appel comme étant Sortant
		
		statutenreg : string = self.local.lastDDEData.GetKeyValue(pKey = CTI_KEY_ENREGISTREMENT);
		if (statutenreg = '') then
			-- Pas de donnée attachée pour l'enregistrement
			-- Pas d'enregistrement auto
			local.EnregistrementAutomatique = FALSE;
		elseif (statutenreg = CTI_MES_ACTIF) then
			-- Enregistrement auto en cours
			local.EnregistrementAutomatique = TRUE;
		elseif (statutenreg = CTI_MES_INACTIF) then
			-- Pas d'enregistrement auto en cours
			local.EnregistrementAutomatique = FALSE;
		else
			-- Rien à faire
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Type enregistrement incorrect');
		end if;
		local.EnregistrementEnCours = local.EnregistrementAutomatique;
		nomCampagne : string = '';
		if (local.rdv.Existe) then
			-- Si c'est un appel dans le cadre d'un rendez-vous, on renseigne le nom de campagne
			nomCampagne = local.rdv.Campaign_Name;
		end if;
		
		self.NotifierEvenement(EVT_CTI_APPELARRIVE,local.ClientID,typeappel,local.EnregistrementAutomatique,FALSE,FALSE,FALSE,nomCampagne);
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Sortant ');
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,local.ClientID);
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' type ');
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,typeappel);
	
	when 6 do
		self.local.Transition(6,'Dialing');
		-- C'est direct, donc le transfert est maintenant effectif

	when 7 do
		self.local.Transition(7,'Dialing');
		local.ConnIDTrans = self.local.lastDDEData.ConnID;
		self.NotifierEvenement(EVT_CTI_CONSULTATIONINITIALISEE);
		
		
	when 8 do
		self.local.Transition(8,'Dialing');
		local.ConnIDTrans = self.local.lastDDEData.ConnID;
		self.NotifierEvenement(EVT_CTI_CONSULTATIONINITIALISEE);
		
	else
		self.local.Transition(0,'Dialing');
		
end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionDialing : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionDialing');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionEstablished
begin
--
--	Description :	Réaction à l'événement Established
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionEstablished');

-- Declarations

-- Traitement

-- Si on a un evenement ESTABLISHED c'est qu'une communication est établie

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 3 do
		self.local.Transition(1,'Established');
		-- C'est un appel sortant, il est géré maintenant comme un appel entrant
		self.NotifierEvenement(EVT_CTI_COMMUNICATIONETABLIE);
		local.SetEtat(CTI_ET_OCCUPE);
		if (local.rdv.existe) then
			-- Si c'est un Rdv, il est abouti 
			local.rdv.abouti = TRUE;
		end if;
		
	when 5 do
		self.local.Transition(1,'Established');
		-- Appel entrant
		
		local.SetEtat(CTI_ET_OCCUPE);
		self.NotifierEvenement(EVT_CTI_COMMUNICATIONETABLIE);

		local.lastEtatValide = FALSE;
		
	when 7 do
		self.local.Transition(7,'Established');
		-- La consultation (Tr Indirect) est établie
		self.NotifierEvenement(EVT_CTI_CONSULTATIONETABLIE);
		local.lastEtatValide = FALSE;
		
	when 8 do
		self.local.Transition(8,'Established');
		-- La consultation (conférence) est établie
		self.NotifierEvenement(EVT_CTI_CONSULTATIONETABLIE);
		local.lastEtatValide = FALSE;
		
	else
	
		self.local.Transition(0,'Established');
		
end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionEstablished : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionEstablished');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionReleased
begin
--
--	Description :	Réaction à l'événement Released
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionReleased');

-- Declarations


-- Traitement

-- Si on a un evenement RELEASED c'est qu'une communication est terminée

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 1 do
		self.local.Transition(1,'Released');

		-- Si on n'est ni en conférence, ni en transfert indirect, la communication est terminée
		self.NotifierEvenement(EVT_CTI_COMMUNICATIONTERMINEE);

		if (local.rdv.existe) then
			-- Rendez vous traité
			local.rdv.fini = TRUE;
		end if;

		if (local.lastEtatValide) then
			-- Il y a un état antérieur à restaurer (lié à un appel sortant)
			local.SetEtat(local.lastEtat);
			local.lastEtatValide = FALSE;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sortant');
		elseif (self.local.lastDDEData.dnis = local.thisDN) then
			-- C'est un appel sur le DN, donc on retourne en MANUALIN
			local.SetEtat(CTI_ET_LIBRE);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur DN');
		else
			-- C'est un appel sur le Groupe ou sur l'Agent, on passe en ACW
			local.SetEtat(CTI_ET_ACW);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur Groupe ou agent');
		end if;
	when 2 do
		self.local.Transition(1,'Released');
		
		-- Appel sortant en cours annulé avant le Dialing, retour à l'état précédent

		local.SetEtat(local.lastEtat);
		local.lastEtatValide = FALSE;
		
		if (local.rdv.existe) then
			-- Rendez vous traité
			local.rdv.fini = TRUE;
			local.rdv.abouti = FALSE;
		end if;
		self.Sync(); -- Synchro des fenêtre
		
	when 3 do
		self.local.Transition(1,'Released');
		
		-- Appel sortant en cours annulé après Dialing, retour à l'état précédent

		local.SetEtat(local.lastEtat);
		local.lastEtatValide = FALSE;
		
		if (local.rdv.existe) then
			-- Rendez vous traité
			local.rdv.fini = TRUE;
			local.rdv.abouti = FALSE;
		end if;
		self.Sync(); -- Synchro des fenêtre
		
	when 4 do
		self.local.Transition(1,'Released');
		-- Le client en attente à raccroché, la communication est terminée
		self.NotifierEvenement(EVT_CTI_COMMUNICATIONTERMINEE);

		if (local.rdv.existe) then
			-- Rendez vous traité
			local.rdv.fini = TRUE;
		end if;

		if (local.lastEtatValide) then
			-- Il y a un état antérieur à restaurer (lié à un appel sortant)
			local.SetEtat(local.lastEtat);
			local.lastEtatValide = FALSE;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sortant');
		elseif (self.local.lastDDEData.dnis = local.thisDN) then
			-- C'est un appel sur le DN, donc on retourne en MANUALIN
			local.SetEtat(CTI_ET_LIBRE);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur DN');
		else
			-- C'est un appel sur le Groupe ou sur l'Agent, on passe en ACW
			local.SetEtat(CTI_ET_ACW);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur Groupe ou agent');
		end if;
		
	when 5 do
		self.local.Transition(1,'Released');


		-- Appel arrivant raccroché par le client		
		local.SetEtat(local.lastEtat);
		local.lastEtatValide = FALSE;
		self.Sync();

	when 6 do
		self.local.Transition(1,'Released');

	
		-- Transfert direct
		-- Il faut tester qui a raccroché
		
		self.NotifierEvenement(EVT_CTI_TRANSFERTANNULE);
		
/*		if (self.local.lastDDEData.ConnID = local.ConnID) then
			-- C'est un transfert direct qui se termine
			-- C'est le client qui a raccroché

			self.NotifierEvenement(EVT_CTI_CONSULTATIONTERMINEE,CTI_TR_ANNULECLIENT);

			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Client raccroche');

		elseif (self.local.lastDDEData.ConnID = local.ConnIDTrans) then
			-- C'est le destinataire qui a raccroché
			-- Tr Direct est terminé
			self.NotifierEvenement(EVT_CTI_CONSULTATIONTERMINEE,CTI_TR_ANNULECONS);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Cons raccroche');
		else
			-- Pas prévu
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Release non identifié');
		end if;
*/
	when 7 do
		self.local.Transition(1,'Released');
		
		-- Transfert indirect
		-- Il faut tester qui a raccroché
		
		if (self.local.lastDDEData.ConnID = local.ConnID) then
			-- C'est un transfert indirect qui se termine
			-- C'est le client qui a raccroché

			self.NotifierEvenement(EVT_CTI_CONSULTATIONTERMINEE,CTI_TR_ANNULECLIENT);

			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Client raccroche');

		elseif (self.local.lastDDEData.ConnID = local.ConnIDTrans) then
			-- C'est le destinataire qui a raccroché
			-- Tr Indirect est terminé
			self.NotifierEvenement(EVT_CTI_CONSULTATIONTERMINEE,CTI_TR_ANNULECONS);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Cons raccroche');
		else
			-- Pas prévu
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Release non identifié');
		end if;
			
	when 8 do
		self.local.Transition(1,'Released');
		
		-- Conférence 
		-- Il faut tester qui a raccroché
		if (self.local.lastDDEData.ConnID = local.ConnID) then
			-- C'est une conférence qui se termine
			-- La communication est terminée
			self.NotifierEvenement(EVT_CTI_COMMUNICATIONTERMINEE);
			local.SetEtat(CTI_ET_ACW);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Fin de communication suite à conférence');
			
		elseif (self.local.lastDDEData.ConnID = local.ConnIDTrans) then
			-- Conférence établie
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Conférence établie ou conseiller raccroche');
			-- C'est une situation dangereuse !!!
			-- Equivalent à une communication simple
			-- donc on fait comme si on annule une consultation
			self.NotifierEvenement(EVT_CTI_TRANSFERTANNULE);
		else
			-- Pas prévu
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Release non identifié');
		end if;

	when 9 do
		-- Le client raccroche avant qu'on le transfert
		self.local.Transition(1,'Released');
		self.NotifierEvenement(EVT_CTI_TRANSFERTANNULE);

		-- Si on n'est ni en conférence, ni en transfert indirect, la communication est terminée
		self.NotifierEvenement(EVT_CTI_COMMUNICATIONTERMINEE);

		if (local.rdv.existe) then
			-- Rendez vous traité
			local.rdv.fini = TRUE;
		end if;

		if (local.lastEtatValide) then
			-- Il y a un état antérieur à restaurer (lié à un appel sortant)
			local.SetEtat(local.lastEtat);
			local.lastEtatValide = FALSE;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sortant');
		elseif (self.local.lastDDEData.dnis = local.thisDN) then
			-- C'est un appel sur le DN, donc on retourne en MANUALIN
			local.SetEtat(CTI_ET_LIBRE);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur DN');
		else
			-- C'est un appel sur le Groupe ou sur l'Agent, on passe en ACW
			local.SetEtat(CTI_ET_ACW);
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Appel sur Groupe ou agent');
		end if;
	
	else
	
		self.local.Transition(0,'Released');
		
end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionReleased : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionReleased');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionRinging
begin
--
--	Description :	Réaction à l'événement Ringing
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--	DN			08/10/1997		Modif pour ajout NomCampagne dans AppelArrive (fiche ano 10)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionRinging');

-- Declarations


-- Traitement

case self.local.EtatModuleCTI	-- Réaction à l'évènement selon l'état du module CTI
	when 1 do
		self.local.Transition(5,'Ringing');

		local.lastEtat = local.EtatPABX; -- On sauvegarde l'état de départ
		local.lastEtatValide = TRUE;

		-- Si on a un evenement RINGING c'est qu'un appel arrive
		typeappel : string = self.local.lastDDEData.calltype;
		if (typeappel='') then
			typeappel= '0'; -- Indéfini
		else
			-- Rien a faire
		end if;

		self.AppelArrive(typeappel);

	else

		self.local.Transition(0,'Ringing');

end case;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionRinging : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionRinging');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionTransfered
begin
--
--	Description :	Réaction à l'événement Transfered
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionTransfered');

-- Declarations


-- Traitement

-- On est destinataire d'un transfert
-- Il faut maintenant utiliser le ConnID de l'appel initial (attaché au TRANSFERED)
local.ConnID = self.local.lastDDEData.ConnID;

statutenreg : string = self.local.lastDDEData.GetKeyValue(pKey = CTI_KEY_ENREGISTREMENT);
if (statutenreg = '') then
	-- Pas de donnée attachée pour l'enregistrement
	-- Pas d'enregistrement auto
	local.EnregistrementAutomatique = FALSE;
elseif (statutenreg = CTI_MES_ACTIF) then
	-- Enregistrement auto en cours
	local.EnregistrementAutomatique = TRUE;
elseif (statutenreg = CTI_MES_INACTIF) then
	-- Pas d'enregistrement auto en cours
	local.EnregistrementAutomatique = FALSE;
else
	-- Rien à faire
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Type enregistrement incorrect');
end if;
local.EnregistrementEnCours = local.EnregistrementAutomatique;

If Not local.AppelArriveEmis then
	-- On fait un appel arrivé comme pour le ringing
	self.AppelArrive('4'); -- Type 4 car l'appel arrivé vient du SVI
else
	-- On se contente de synchroniser les applicatifs
	self.sync();
End if;
	
	



-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionTransfered : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionTransfered');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.ReactionUserEvent
begin
--
--	Description :	Réaction à l'événement UserEvent
--
--	Type :	Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			22/08/1997		Création (découpage de TraitementEvenement)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.ReactionUserEvent');

-- Declarations


-- Traitement

-- Gestion des messages attachés au UserEvent (notamment ceux de Campaign Manager)
msg : string;
msg = self.local.lastDDEData.GetKeyValue('GSW_USER_EVENT');

if (msg= 'ScheduledCallRescheduleAcknowledge') then
	-- Le rendez-vous est confirmé
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'reschedule confirme');
	self.NotifierEvenement(pCodeEvt=EVT_CTI_CONFIRMERDV,pParamBool=TRUE);

elseif (msg= 'ScheduledCallRescheduleError') then
	-- Le rendez-vous est infirmé
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'reschedule a echoue');
	self.NotifierEvenement(pCodeEvt=EVT_CTI_CONFIRMERDV,pParamBool=FALSE);

elseif (msg= 'ScheduledCall') then
	-- On nous signale qu'il faut rappeler un client
	-- Constitution des données de rappel
	
	local.rdv.Existe = TRUE;
	local.rdv.Fini = FALSE;
	local.rdv.Abouti = FALSE;
	local.rdv.Record_Handle = self.local.lastDDEData.GetKeyValue('GSW_RECORD_HANDLE');
	local.rdv.Calling_List  = self.local.lastDDEData.GetKeyValue('GSW_CALLING_LIST');
	local.rdv.Phone = self.local.lastDDEData.GetKeyValue('GSW_PHONE');
	local.rdv.Date_Time = self.local.lastDDEData.GetKeyValue('GSW_DATE_TIME');
	local.rdv.Campaign_Name = self.local.lastDDEData.GetKeyValue('GSW_CAMPAIGN_NAME');
	local.rdv.ClientID = self.local.lastDDEData.GetKeyValue(CTI_KEY_CLIENTID);
			
	post self.local.RendezVousEvt();
	-- ***** modifications Fabien du 11/08 *****
				
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'client à rappeler : ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,local.rdv.ClientID);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'pour la campagne : ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,local.rdv.Campaign_Name);
			
	if (local.EtatPABX = CTI_ET_LIBRE) then
		-- C'est le moment de faire cet appel (on confirme l'etat pour prendre en compte le rendez-vouz)
		local.SetEtat(CTI_ET_LIBRE);
	else
		-- on attend la fin de l appel et l'etat libre pour rappeler le client
	end if;
			
-- /*		Evenement non utilisé pour le moment

elseif (msg= 'UpdateCallCompletionStatsAcknowledge') then
	-- La mise à jour de l'appel reprogrammé s'est bien passée
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'mise a jour de la liste de rappel bien deroulee ');
			
/*		Evenement non utilisé pour le moment		

elseif (msg= 'UpdateCallCompletionStatsError') then
	-- La mise à jour de l'appel reprogrammé ne s'est pas bien passée
		
elseif (msg= 'UpdateCallCompletionAcknowledge') then
	-- Idem UpdateCallCompletionStatsAcknowledge
			
elseif (msg= 'UpdateCallCompletionError') then
	-- Idem UpdateCallCompletionStatsError

elseif (msg= 'RecordProcessedAcknowledge') then
	-- L'appel est bien traité
elseif (msg= 'RecordProcessedError') then
	-- L'appel n'a pas été bien traité
*/		
end if;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.ReactionUserEvent : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.ReactionUserEvent');
		Raise;
 

end method;

------------------------------------------------------------
method CTIApplicatif.registerEcouteEtat
begin
--
--	Description :		Ecoute de l'evenement de changement d'état
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			28/07/1997		Création et adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ApplicatifCTI.registerEcouteEtat');

-- Declarations

-- Traitement
registration : EventRegistration;
event loop
	preregister
		registration = register EcouteEtatEVH();
		
	when Self.Terminer do
		registration.DeregisterHandler();

	when task.ShutDown do
	exit;

end event;
		
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.registerEcouteEtat : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.registerEcouteEtat');
		Raise;
		
	when uneUsageExc : UsageException do
		if (uneUsageExc.ReasonCode = SP_ER_INVALIDSTATE) then
			return;
		else
			Self.TraceExc(uneUsageExc, 'CTIApplicatif.registerEcouteEtat');
			raise;
		end if;
	When uneCTITechExc : CTITechExc do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Message intercepte dans CTIApplicatif.registerEcouteEtat');

end method;

------------------------------------------------------------
method CTIApplicatif.registerHotLink
begin
registration : EventRegistration;
event loop
	preregister
		registration = register HotLinkEVH();
 
	postregister
		self.LinkStartSoftPhone();
		
	when Self.Terminer do
		registration.DeregisterHandler();
		
	-- Abonnement à l'événement SoftPhoneConversation.Disconnected
	-- Evénement DDE reçu quand le serveur DDE (SoftPhone) tombe ou 
	-- la connection DDE tombe		
	when Self.SoftPhoneConversation.Disconnected do
		if (Self.Connected) then 
			Self.Connected = FALSE;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Deconnection de SoftPhone Conversation. Serveur tombe');
			Self.TerminerConnection();
			
			uneCTIGraveExc : CTIGraveExc = new();
			uneCTIGraveExc.SetWithParams(severity = SP_ER_ERROR,
								message = 'CTI : Erreur grave : SoftPhone n\'est plus connecté');
			Self.TraceExc(uneCTIGraveExc,'ApplicatifCTI.registerEventHandler');
			task.ErrorMgr.AddError(uneCTIGraveExc);
			raise uneCTIGraveExc;
			
		end if;
	
end event;

exception
	When uneCTITechExc : CTITechExc do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Message intercepte dans CTIApplicatif.registerHotLinkEVH');
		
--	When grave : CTIGraveExc do
--		Return;
end method;

------------------------------------------------------------
method CTIApplicatif.Sync
begin
SonnerieEnCours : Boolean = FALSE;
TransfertPrepare : Boolean = FALSE;
case local.EtatModuleCTI
	when 3 do
		SonnerieEnCours = TRUE;
	when 5 do
		SonnerieEnCours = TRUE;
	when 9 do
		TransfertPrepare = TRUE;
end case;

if (local.EtatPABX = CTI_ET_OCCUPE) or (local.EtatPABX = CTI_ET_ATTENTE) then
	-- Il faut remonter la durée d'appel
	self.NotifierEvenement(	pCodeEvt=EVT_CTI_ETATSYNC,
							pParam1=local.EtatPABX,
							pParam2 = local.GetTempsEcoule(),
							pParamBool=local.EnregistrementAutomatique,
							pParamBool2=local.EnregistrementEnCours,
							pParamBool3=SonnerieEnCours,
							pParamBool4=TransfertPrepare
							);

else
	self.NotifierEvenement(	pCodeEvt=EVT_CTI_ETATSYNC,
							pParam1=local.EtatPABX,
							pParamBool=local.EnregistrementAutomatique,
							pParamBool2=local.EnregistrementEnCours,
							pParamBool3=SonnerieEnCours,
							pParamBool4=TransfertPrepare
							);
end if;
end method;

------------------------------------------------------------
method CTIApplicatif.TerminerConnection
begin
if (Self.Connected) then
	Self.SoftPhoneConversation.TerminateConnection();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Deconnection de SoftPhone Conversation. Demande Applicative');
	Self.Connected = FALSE;
end if;

post Self.Terminer;

self.NotifierEvenement(EVT_CTI_QUITTER);

 
exception
	when uneException : UsageException do
		uneCTITechExc : CTITechExc = new();
		uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
							message = 'Attention, Conversation SoftPhoneConversation not connected');
		Self.TraceExc(uneCTITechExc,'CTIApplicatif.TerminerConnection');
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;
	

	 
end method;

------------------------------------------------------------
method CTIApplicatif.TraitementEvenement(input pNomEvenement: Framework.string,
	input pDataEvenement: Framework.TextData)
begin
--
--	Description :	Traitement de la reception d'evenements Softphone
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pNomEvenement : string = nom de l'évènement reçu
--								pDataEvenement : TextData = Chaine associée à l'évènement
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--	DN			22/08/1997		Decoupage en methode
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CTIApplicatif.TraitementEvenement');

-- Declarations


-- Traitement

if ((pNomEvenement = ESP_ERROR) or (pNomEvenement = ESP_SPERROR)) then

	-- C'est une erreur, on l'affiche dans le Log :
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Erreur Softphone : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pDataEvenement.value);
	
	deb : integer = 0;
	pDataEvenement.MoveToChar(',');
	fin : integer = pDataEvenement.Offset;
	coderreur : integer = pDataEvenement.CopyRange(deb,fin).integervalue;
	MessageErreur : TextData = new();
	
	case coderreur -- Gestion de quelques erreurs Softphone (celles qu'on maitrise)
		when 1 do 		-- Connection Error
			MessageErreur.value = 'CTI : Erreur sur le système téléphonique';
			
		when 617 do 	-- User busy
			MessageErreur.value = 'CTI : Demande refusée (Agent occupé)';
			
		when 628 do 	-- Invalid Number / Domain/SIT -- ineffective other
			MessageErreur.value = 'CTI : Demande refusée (Un des paramètres est invalide)';
		
		when 696 do		-- Invalid DN
			MessageErreur.value = 'CTI : Demande refusée (Numéro de poste téléphonique invalide)';
			
		when 868 do		-- Agent state inconsistent with request
			MessageErreur.value = 'CTI : Demande refusée (Etat de l\'agent non cohérent)';
			
		when 869 do		-- Agent logged into maximum number of splits
			MessageErreur.value = 'CTI : Demande refusée (Agent déjà déclaré)';

		when 870 do		-- Incorrect number of agent digits
			MessageErreur.value = 'CTI : Demande refusée (Identifiant agent incorrect)';
			
		when 871 do		-- Agent not login
			MessageErreur.value = 'CTI : Demande refusée (Agent non déclaré)';
		
		else
			MessageErreur.value = 'CTI : Erreur sur le système téléphonique';
			
	end case;
	
	if (Not local.DemandeUnHold) then
		-- On ne remonte pas le message si il arrive suite au "forcage" de CallUnHold
		self.NotifierEvenement(EVT_CTI_ERREURSOFTPHONE,messageerreur.value);
		task.part.logmgr.put(messageerreur.value);
		task.part.logmgr.putline(local.EtatModuleCTI);
	else
		local.DemandeUnHold = FALSE;
	end if;
	
--	uneCTITechExc : CTITechExc = new();
--	uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
--						message = messageerreur);
--	task.ErrorMgr.AddError(uneCTITechExc);
--	raise uneCTITechExc;
	

else

	-- Decodage des paramètres
	self.local.lastDDEData  = DDEData().Constructor(pDataEvenement);
	
	-- Trace sur le log
	
	if (pNomEvenement = ESP_ADDRESSALLOCATED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_ADDRESSFREED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_ADDRESSINFO) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_AGENTAFTERCALLWORK) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_AGENTBUSY) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CALLFORWARDCANCEL) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CALLFORWARDSET) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_AGENTLOGIN) then
		Self.ReactionAgentLogin();	
	elseif (pNomEvenement = ESP_AGENTLOGOUT) then
		Self.ReactionAgentLogout();	
	elseif (pNomEvenement = ESP_AGENTMANUALREADY) then
		Self.ReactionAgentManualReady();	
	elseif (pNomEvenement = ESP_AGENTNOTBUSY) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_AGENTNOTREADY) then
		Self.ReactionAgentNotReady();	
	elseif (pNomEvenement = ESP_AGENTREADY) then
		Self.ReactionAgentReady();	
	elseif (pNomEvenement = ESP_ATTACHEDDATACHANGED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CALLHOLDED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CALLPARKED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CALLUNHOLDED) then
	-- Pas d'action associée
		local.DemandeUnHold = FALSE;
	elseif (pNomEvenement = ESP_CALLUNPARKED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_CONFERENCED) then
		Self.ReactionConferenced();	
	elseif (pNomEvenement = ESP_DIALING) then
		Self.ReactionDialing();	
	elseif (pNomEvenement = ESP_ESTABLISHED) then
		Self.ReactionEstablished();	
	elseif (pNomEvenement = ESP_RINGING) then
		Self.ReactionRinging();	
	elseif (pNomEvenement = ESP_RELEASED) then
		Self.ReactionReleased();	
	elseif (pNomEvenement = ESP_SERVERDISCONNECT) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_TRANSFERED) then
		Self.ReactionTransfered();	
	elseif (pNomEvenement = ESP_RETRIEVED) then
	-- Pas d'action associée
	elseif (pNomEvenement = ESP_DESTINATIONBUSY) then
		Self.ReactionDestinationBusy();	
	elseif (pNomEvenement = ESP_USEREVENT) then
		Self.ReactionUserEvent();	
	else
		-- C'est pas normal
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Evenement softphone inconnu');
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' recu.');
	end if;
	
end if;

-- Fin du traitement



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CTIApplicatif.TraitementEvenement : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CTIApplicatif.TraitementEvenement');
		Raise;
 

end method;

------------------------------------------------------------
event handler CTIApplicatif.EcouteEtatEVH()
begin

-- Si il y a un changement d'état
when local.ChangementEtatEvt(etat=pEtatActuel) do
	-- On informe les utilisateurs enregistrés
	self.NotifierEvenement(EVT_CTI_CHANGEMENTETAT, etat);
	
-- Si on annule le transfert por des raisons techniques
when local.AnnuleTransfertEvt(raison=pRaison) do
	-- On ferme signale l'annulation du transfert et la raison
	task.part.logmgr.putline(raison);
	self.AnnulePrepareTransfert();	
	self.NotifierEvenement(EVT_CTI_ERREURSOFTPHONE,raison);
	
	
end event;

------------------------------------------------------------
event handler CTIApplicatif.HotLinkEVH()
begin
when Self.SoftPhoneConversation.HotLinkDataArrived(itemname=Item,text=Text)  do
	
	if (text.value = '0') then
		-- C'est de la simulation
	else
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Message DDE recu = ');
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,itemname);
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,', Data = ');
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,text);
		self.TraitementEvenement(pNomEvenement=itemname.value, pDataEvenement=text);
	end if;

when Self.SoftPhoneConversation.LinkStatus(itemname=Item, active=isActive) do
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Event = SoftPhoneConversation.LinkStatus, ItemName = ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,itemname);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,', Etat = ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,active);
	if (active=FALSE) then
		uneCTITechExc : CTITechExc = new();
		uneCTITechExc.SetWithParams(severity = SP_ER_ERROR,
							message = 'Attention, Evenement %1 not linked', param1=itemname);
		Self.TraceExc(uneCTITechExc,'CTIApplicatif.HotLinkEVH');
		task.ErrorMgr.AddError(uneCTITechExc);
		raise uneCTITechExc;
	end if;
end event;

------------------------------------------------------------
method CTIEventParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CTIGraveExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method CTITechExc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DDEData.Constructor(input Text: Framework.TextData): CtiItBD.DDEData
begin
--
--	Description :	Creation d'un DDEData à partir de la chaine source
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Text : Textdata = chaine source
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DA			??/??/1997		Création
--	DN			28/07/1997		Adaptation normes
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DDEData.Constructor');

-- Declarations
DataArrayInstanciated : boolean = FALSE;

-- Traitement
 
self.ThisDN 				= self.FindNext(Text); 
self.ThisQueue 				= self.FindNext(Text); 
self.ConnID 				= self.FindNext(Text); 
self.CallID 				= self.FindNext(Text);
self.CallResult				= self.FindNext(Text);
self.AgentID				= self.FindNext(Text);
self.CollectedDigits		= self.FindNext(Text);
self.LastCollectedDigit		= self.FindNext(Text);
self.TimeInQueue			= self.FindNext(Text);
self.DNIS					= self.FindNext(Text);
self.ANI					= self.FindNext(Text);
self.ThisTrunk				= self.FindNext(Text);
self.OtherDN				= self.FindNext(Text);
self.OtherQueue				= self.FindNext(Text);
self.OtherTrunk				= self.FindNext(Text);
self.CallType				= self.FindNext(Text);

while (Text.LengthToEnd > 0) do
 	if (not DataArrayInstanciated) then 
 		self.data = new();
 		DataArrayInstanciated = TRUE;
 	end if;
	complementaryData : ComplementaryDDEData = new();
	complementaryData.Key	= self.FindNext(Text);
	complementaryData.Value	= self.FindNext(Text);
	self.data.AppendRow(complementaryData);
end while;




-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DDEData.Constructor : End');

return self;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DDEData.Constructor');
		Raise;
 

end method;

------------------------------------------------------------
method DDEData.FindNext(input Text: Framework.TextData): Framework.string
begin
--
--	Description :	Recherche de la première sous-chaine précédée d'une virgule
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Text : Textdata = chaine source
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DA			??/??/1997		Création
--	DN			28/07/1997		Adaptation normes
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DDEData.FindNext');

-- Declarations
marker 		: string =',';
ret 		: string;
startOffset : integer = Text.Offset;
endOffset 	: integer;

-- Traitement


if Text.MoveToChar(marker) then
	endOffset = Text.Offset; 
	Text.MoveNext();
else
	endOffset = startOffset + Text.LengthToEnd;
	Text.offset = endOffset;
end if;

ret = Text.CopyRange(startOffset, endOffset).value;


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DDEData.FindNext : End');

return ret;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DDEData.FindNext');
		Raise;
 

end method;

------------------------------------------------------------
method DDEData.GetKeyValue(input pKey: Framework.string): Framework.string
begin
--
--	Description :	Récupère la valeur d'une clé	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> pKey : string = clé demandée
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DDEData.GetKeyValue');

-- Declarations
result : string ='';

-- Traitement

for unDDEData in data do --1
	if (unDDEData.Key = pKey) then --11
		result = unDDEData.value;
		exit;
	else --11
		-- On continue a chercher
	end if; --11
end for;--1

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DDEData.GetKeyValue : End');

return result;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'DDEData.GetKeyValue');
		Raise;
 



end method;

------------------------------------------------------------
method DDEData.Init
begin
super.Init();
end method;

------------------------------------------------------------
method DDEData.zzzDump
begin
log : LogMgr = task.part.LogMgr;

log.putLine(self.ThisDN);
log.putLine(self.ThisQueue);
log.putLine(self.ConnID);
log.putLine(self.CallID);
log.putLine(self.CallResult);
log.putLine(self.AgentID);
log.putLine(self.CollectedDigits);
log.putLine(self.LastCollectedDigit);
log.putLine(self.TimeInQueue);
log.putLine(self.DNIS);
log.putLine(self.ANI);
log.putLine(self.ThisTrunk);
log.putLine(self.OtherDN);
log.putLine(self.OtherQueue);
log.putLine(self.OtherTrunk);
log.putLine(self.CallType);

-- Afficher le tableau data
for complementarydata in self.data do
	log.putLine(complementarydata.Key);
	log.putLine(complementarydata.Value);
end for;
end method;

------------------------------------------------------------
method DiffererAppelCampagneParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method EvenementSoftphone.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

super.Init();

leNom = new;
lesParams = new;
end method;

------------------------------------------------------------
method InfoAppelParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InfoClientParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InitialiserConsultationParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method InterfaceCTI.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstract
--
--	Parameters :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : None
--
--	Post-condition : The action required is done.
--
--	Exceptions : None
--
--	Usage : Globale from Communication Front
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--  JB BRIAUD   |   29/05/1997  |   Norme de ProjectModel.
--	DNA			|	19/08/1997	|	Maj pour adaptation socle (cf. DGET004A)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceDesc.Action');

-- Declarations
aResult : Object = NIL; 

-- Traitement
Case aTransData.TransActionService is

--
-- Actions concernant la notification
--

	when ACT_CTI_REGISTERNOTIFIER do
		Self.RegisterEvent((StdEventNotifier)(aTransData.TransObject));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'--- Un REGISTERNOTIFIER');

	when ACT_CTI_DEREGISTERNOTIFIER do
		Self.DeRegisterEvent((StdEventNotifier)(aTransData.TransObject));
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'--- Un DEREGISTERNOTIFIER');


--
-- Actions concernant le comportement du module Cti
--	
	when ACT_CTI_INITIALISERCTI do
		self.nbutilisateur=self.nbutilisateur+1;
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'--- INITIALISER ');
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,self.nbutilisateur);

		if (self.nbutilisateur = 1) then
			ServiceCTIRC.InitialiserConnection();
			ServiceRCCTI.InitialiserConnection();
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' REEL ');
		end if;
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'');


	when ACT_CTI_TERMINERCTI do
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'--- TERMINER ');
		Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,self.nbutilisateur);
		self.nbutilisateur=self.nbutilisateur-1;
		if (self.nbutilisateur = 0) then
			ServiceCTIRC.TerminerConnection();
			ServiceRCCTI.TerminerConnection();
			Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' REEL');
		end if;
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'');

--
-- Actions fonctionnelles 
--

	when ACT_CTI_SYNCCTI do
		ServiceCTIRC.Sync(); -- Synchro Explicite

	when ACT_CTI_PREPARETRANSFERT do
		ServiceCTIRC.PrepareTransfert();

	when ACT_CTI_ANNULEPREPARETRANSFERT do
		ServiceCTIRC.AnnulePrepareTransfert();

	when ACT_CTI_ANNULERCONSULTATION do
		ServiceRCCTI.AnnulerConsultation();

	when ACT_CTI_APPELCLIENT do
		ServiceRCCTI.AppelClient((AppelClientParam) (aTransData.TransObject));

	when ACT_CTI_ARRETERENREGISTREMENT do
		ServiceRCCTI.ArreterEnregistrement();
		ServiceCTIRC.Sync(); -- Synchro Implicite

	when ACT_CTI_ATTENTE do
		ServiceRCCTI.Attente();

	when ACT_CTI_CHANGEMENTMOTDEPASSE do
		ServiceRCCTI.ChangementMotDePasse();

	when ACT_CTI_CONSULTATIONCOMPTE do
		ServiceRCCTI.ConsultationCompte();

	when ACT_CTI_DECROCHE do
		ServiceRCCTI.Decroche();

	when ACT_CTI_DEMARRERENREGISTREMENT do
		ServiceRCCTI.DemarrerEnregistrement();
		ServiceCTIRC.Sync(); -- Synchro Implicite

	when ACT_CTI_INFOAPPEL do
		ServiceRCCTI.InfoAppel((InfoAppelParam) (aTransData.TransObject));

	when ACT_CTI_INFOCLIENT do
		ServiceRCCTI.InfoClient((InfoClientParam) (aTransData.TransObject));

	when ACT_CTI_INITIALISERCONSULTATION do
		ServiceRCCTI.InitialiserConsultation((InitialiserConsultationParam) (aTransData.TransObject));

	when ACT_CTI_LIBERER do
		ServiceRCCTI.Liberer();

	when ACT_CTI_LOGIN do
		ServiceRCCTI.Login((LoginParam) (aTransData.TransObject));

	when ACT_CTI_LOGOUT do
		ServiceRCCTI.Logout();

	when ACT_CTI_PAUSE do
		ServiceRCCTI.Pause();

	when ACT_CTI_QUITTER do
		ServiceRCCTI.Quitter();

	when ACT_CTI_RACCROCHE do
		ServiceRCCTI.Raccroche();
		ServiceCTIRC.Sync(); -- Synchro Implicite

	when ACT_CTI_REECOUTE do
		ServiceRCCTI.Reecoute((ReecouteParam) (aTransData.TransObject));

	when ACT_CTI_REECOUTECLIENT do
		ServiceRCCTI.ReecouteClient();

	when ACT_CTI_TRANSFERTDIRECT do
		ServiceRCCTI.TransfertDirect((TransfertDirectParam) (aTransData.TransObject));

	when ACT_CTI_VALIDERCONFERENCE do
		ServiceRCCTI.ValiderConference();

	when ACT_CTI_VALIDERTRANSFERT do
		ServiceRCCTI.ValiderTransfert();

	when ACT_CTI_ANNULERAPPELCAMPAGNE do
		ServiceRCCTI.AnnulerAppelCampagne((AnnulerAppelCampagneParam) (aTransData.TransObject));

	when ACT_CTI_DIFFERERAPPELCAMPAGNE do
		ServiceRCCTI.DiffererAppelCampagne((DiffererAppelCampagneParam) (aTransData.TransObject));

else do  -- Other whens
		aResult=NIL;
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BusinessServiceDesc.Action : End');


Return aResult;
-- Fin du traitement

Exception
	when uneCTITechExc : CTITechExc do
		return NIL;

	when uneCTIGraveExc : CTIGraveExc do
		raise;
	
	When e : GenericException do
		Self.TraceExc(e, 'ServiceDesc.Action');
		Raise;
end method;

------------------------------------------------------------
method InterfaceCTI.Init
begin
super.Init();
self.ServiceRCCTI = new();
self.ServiceCTIRC = new();

self.local = new();
self.ServiceRCCTI.local = self.local;
self.ServiceCTIRC.local = self.local;
self.nbutilisateur = 0;


self.LanceSoftphone();

self.ServiceStarted = TRUE;

start task self.TraiteCTIEvent;


end method;

------------------------------------------------------------
method InterfaceCTI.LanceSoftphone(input pNumEssai: Framework.integer = 0)
begin
-- Test de connection DDE 'SoftPhone'
application : TextData = new(value='SoftPhoneApp');
topic 		: TextData = new(value='System');
autoLaunch 	: Boolean  = FALSE;
SoftPhoneConversation : DDEConversation = new;

SoftPhoneConversation.InitiateConnection (
			   	application=application,
			   	topic=topic,
			   	autoLaunch = autoLaunch);

-- Si cela se passe bien, on fait rien, Softphone est prêt
 


exception -- Sinon, on récupère l'xception et on lance Softphone
	when uneSystemResourceExc : SystemResourceException do
		if (uneSystemResourceExc.ReasonCode = SP_ER_DDE_SERVERAPPNOTACTIVE) then
			-- Récupération de l'exécutable à lancer
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Lancement automatique de Softphone');
			chemin : TextData = task.Part.OperatingSystem.GetEnv('SPNT_ROOT');
			
			if (chemin = NIL) then
				uneCTITechExc : CTITechExc = new();
				uneCTITechExc.message = 'Variable d\'environnement SPNT_ROOT non définie';
				Self.TraceExc(uneCTITechExc,'InterfaceCTI.LanceSoftphone');
				task.ErrorMgr.AddError(uneCTITechExc);
				raise uneCTITechExc;
			end if;
			
			-- On lance l'appli Softphone en utilisant la commande NT "start"
			-- Syntaxe utilisée :
			-- 		start "Texte libre"  /MIN "programme"
	
			
			uneCommande : TextData = new(value='start \"Lancement automatique de Softphone\"  /MIN \"');
			uneCommande.concat(chemin);
			uneCommande.concat('\"');
			
			case pNumEssai
				when 0 do
					-- On essai à nouveau
					task.Delay(5000);
					self.LanceSoftphone(1);
				when 1 do
					task.Part.OperatingSystem.RunCommand(command=uneCommande, isSynchronous=TRUE);
					task.Delay(5000);
					self.LanceSoftphone(2);
				when 2 do
					task.Delay(5000);
					self.LanceSoftphone(3);
				else
					uneCTITechExc : CTITechExc = new();
					uneCTITechExc.message = 'Softphone ne peut pas être utilisée !';
					Self.TraceExc(uneCTITechExc,'InterfaceCTI.LanceSoftphone');
					task.ErrorMgr.AddError(uneCTITechExc);
					raise uneCTITechExc;
			end case;		

			
			
		elseif (uneSystemResourceExc.ReasonCode = SP_ER_WINDOWLIMIT) then
			uneCTITechExc : CTITechExc = new();
			Self.TraceExc(uneCTITechExc,'InterfaceCTI.LanceSoftphone');
			task.ErrorMgr.AddError(uneCTITechExc);
			raise uneCTITechExc;
		end if;

	
end method;

------------------------------------------------------------
method InterfaceCTI.TraiteCTIEvent
begin
--
--	Description :		Traite tous les événements du CTI
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			20/08/1997		Adaptation socle V1.0
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InterfaceCTI.TraiteCTIEvent');

-- Declarations

-- Traitement


event loop

	when task.ShutDown do
	exit;

	when self.ServiceCTIRC.CTIApplicatifEvt(code=EventCode,data=EventData) do

		uneTransInterfaceCTI : TransInterfaceCtiDesc = new();
		uneTransInterfaceCTI.TransObject = data;
		uneTransInterfaceCTI.TransActionService = code;
		self.Notify(aClassType=InterfaceCTI , aTransData = uneTransInterfaceCTI, aTransOrigin = NIL);

		case code
			when EVT_CTI_TRANSFERTANNULE do
				-- L'évenement provoque une action ! (Recuperation du client)
				self.ServiceRCCTI.RecupereAppel();
			when EVT_CTI_CONSULTATIONTERMINEE do
				if (data.param1 = CTI_TR_ANNULECONS) then
					-- L'évenement provoque une action ! (Recuperation du client)
					Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'RECUPEREAPPEL');
					self.ServiceRCCTI.RecupereAppel();
				end if;
			when EVT_CTI_COMMUNICATIONETABLIE do
				-- Quand la communication est établie, si l'appId n'est pas attachée, on le fait.
				if (local.AppId <> '') then
					param : InfoAppelParam = New;
					param.pAppId = local.AppId;
					self.ServiceRCCTI.InfoAppel(param);
					-- En même temps , on rattache le ClientId
					paramC : InfoClientParam = New;
					paramC.pClientId = local.ClientId;
					self.ServiceRCCTI.InfoClient(paramC);
				end if;
		end case;
		
	when self.ServiceCTIRC.Terminer() do
		exit;
	
	when self.ServiceRCCTI.Terminer() do
		exit;

	-- -------------------------------------------------------------------------------
	-- Evenements du Timer
	-- -------------------------------------------------------------------------------

	when self.local.leTimer.Tick() do
		-- On met à jour le Timer
		ServiceCTIRC.Sync();

end event;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InterfaceCTI.TraiteCTIEvent : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'InterfaceCTI.TraiteCTIEvent');
		Raise;
end method;

------------------------------------------------------------
method LoginParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method ParamCTI.GetTempsEcoule: Framework.string
begin
resultat : string;

if (self.leTimer.IsActive) then --1
	NbTicks   : IntegerData = new (value=self.leTimer.NumberTicks*TIM_Rafraichissement);
	NbSeconde : IntegerData = new;
	NbSeconde.Mod(NbTicks,60);
	NbTicks.Divide(NbTicks,60);
	
	preResult : TextData = new;
	
	if (NbTicks.value<10) then --11
		-- On complète par 0
		preResult.value = '0';
	else --11
		-- Rien à faire
	end if; --11
	
	preResult.Concat(NbTicks.TextValue);
	preResult.Concat(':');
	if (NbSeconde.value<10) then --12
		-- On complète par 0
		preResult.Concat('0');
	else --12
		-- Rien à faire
	end if; --12
	preResult.Concat(NbSeconde.TextValue);
	
	resultat = preResult.value;
	
	
else --1
	resultat = '00:00';
	self.leTimer.NumberTicks = 0;
end if; --1

return resultat;

end method;

------------------------------------------------------------
method ParamCTI.Init
begin
super.Init();


leTimer = new;
leTimer.TickInterval = TIM_Rafraichissement*1000;
leTimer.IsActive = FALSE;

CallID = '';
ConnIdTrans = '';
EnregistrementAutomatique = FALSE;
EnregistrementEnCours = FALSE;
EtatPABX = CTI_ET_NOTLOGGED;
LoginId = '';
thisDN = '';

lastEtatValide = FALSE;

AppId = '';

EtatModuleCTI = 1; -- cf. graphe d'état MCTI

DemandeUnHold = FALSE;
AppelArriveEmis = FALSE;

Rdv = new();
end method;

------------------------------------------------------------
method ParamCTI.SetEtat(input pEtat: Framework.string)
begin
--
--	Description :	Change l'etat téléphonique (et provoque un evenement)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--	DN			25/07/1997		Adaptation socle
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ParamCTI.SetEtat');

-- Declarations


-- Traitement

EtatPABX = pEtat;

post self.ChangementEtatEvt(self.EtatPABX);

if (pEtat = CTI_ET_OCCUPE) or (pEtat = CTI_ET_ATTENTE) then
	leTimer.IsActive = TRUE;
else
	leTimer.IsActive = FALSE;
	leTimer.NumberTicks = 0;
end if;


-- Fin du traitement


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ParamCTI.SetEtat : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ParamCTI.SetEtat');
		Raise;
 

end method;

------------------------------------------------------------
method ParamCTI.Transition(input pEtatMCTI: Framework.integer,
	input pOrigine: Framework.string = '?')
begin
--
--	Description :	Transition d'un état MCTI à un autre
--
--	Type :	Concret
--
--	Parametres :	Input	--> pEtatMCTI : integer = nouvel état
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			27/08/1997		Création (gestion par état)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ParamCTI.Transition');

-- Declarations

-- Traitement

if (pEtatMCTI > 0) then
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'>>>>>>>>>>> Transition de ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,self.EtatModuleCTI);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' vers ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pEtatMCTI);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' sur l\'évenement ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pOrigine);
	self.EtatModuleCTI = pEtatMCTI;
else
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'!!!!!!!!!!! Transition à partir de l\'état ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,self.EtatModuleCTI);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' sur l\'évenement ');
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pOrigine);
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,' non prévu.');
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ParamCTI.Transition : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'ParamCTI.Transition');
		Raise;
 

end method;

------------------------------------------------------------
method ReecouteParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RendezVous.Init
begin
super.Init();

self.Existe = False;
self.Fini = FALSE;
self.abouti = FALSE;
end method;

------------------------------------------------------------
method TransfertDirectParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TransfertEVTParam.Init
begin
super.Init();

self.numero = '';
self.TransfertAnnule = TRUE;
self.TransfertGuichet = FALSE;
self.TransfertMotDePasse = FALSE;
self.TypeTransfert = 0;

end method;

------------------------------------------------------------
method BarreCTI.DoGestionAppelArrive(input Param1: Framework.string,
	input Param2: Framework.string,
	input Param3: Framework.string,
	input ParamBool: Framework.boolean)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite à surcharg
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('BarreOutilCTIWin.DoGestionMethodModel');
Self.TraceExc(unExc, 'BarreOutilCTIWin.DoGestionMethodModel');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method BarreCTI.DoGestionChangementEtat(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionCommunicationEtablie
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionCommunicationTerminee
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionConfirmerRendezVous(input ParamBool: Framework.boolean)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionConsultationEtablie
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionConsultationInitialisee
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionConsultationTerminee(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionErreurSoftphone(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--	DN			09/10/1997		Modification suite fiche ano 8
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Affichage du message d'erreur dans la status line
self.AffStatusLine(Param1);

-- Fin du traitement

return;

end method;

------------------------------------------------------------
method BarreCTI.DoGestionQuitter
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionTransfertAnnule
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoGestionTransfertPrepare
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method BarreCTI.DoStdEventNotifier(input pType: Framework.integer,
	input pObject: Framework.Object)
begin
--
--	Description : 	Traitements spécifiques au projet sur Event de type inconnu
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	pRecord : Record to display.
--
--	Pre-condition : The record is not equal to NIL.
--
--	Post-condition : The display is done.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	11/07/1997	|	Creation.
--+

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('StandardDataWin.DoStdEventNotifier');
Self.TraceExc(unExc, 'StandardDataWin.DoStdEventNotifier');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method BarreCTI.GestionChangementEtat(input pEtat: Framework.string)
begin
--
--	Description :		Réaction à l'evènement ChangementEtat
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--	DN			31/12/1997		Correction bug (fiche anno 13)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.GestionChangementEtat');

-- Declarations

unEtat : string = pEtat;

-- Traitement

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'EEEEEEEEEEEEEE Etat :');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pEtat);


if (unEtat = CTI_ET_NOTLOGGED) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_AUTOIN) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.SonnerieEnCours = FALSE;
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_ENABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_LIBRE) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	if (self.SonnerieEnCours) then
		<DecrocheBtn>.State = FS_ENABLE;
		<PauseBtn>.State = FS_DISABLE;
		Self.EtatCti.SetValue(Source = '00:00');
	else
		<DecrocheBtn>.State = FS_DISABLE;
		<PauseBtn>.State = FS_ENABLE;
	end if;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
--	DN 31/12 <PauseBtn>.State = FS_ENABLE; 
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_OCCUPE) then --1
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_ENABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_ENABLE;
	<TransfertBtn>.State = FS_ENABLE;
	<PauseBtn>.State = FS_DISABLE;
	if (EnregistrementAutomatique) then --11
		<Enregistrer>.State = FS_DISABLE;
	else --11
		-- On peut déclencher l'enregistrement sélectif
		<Enregistrer>.State = FS_ENABLE;
	end if; --11

elseif (unEtat = CTI_ET_PAUSE) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_ENABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_ACW) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_ENABLE;
	<AttenteBtn>.State = FS_DISABLE; 
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_ENABLE; -- A la place de DISABLE
	<Enregistrer>.State = FS_DISABLE;
		
elseif (unEtat = CTI_ET_ATTENTE) then --1
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_ENABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;
else --1
	-- C'est pas prévu
end if; --1

self.DoGestionChangementEtat(pEtat);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.GestionChangementEtat : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.GestionChangementEtat');
		Raise;
end method;

------------------------------------------------------------
method BarreCTI.GestionEtatSync(input pEtat: Framework.string,
	input pEnregAuto: Framework.boolean,
	input pEnregEnCours: Framework.boolean,
	input pSonnerieEnCours: Framework.boolean,
	input pTimer: Framework.string,
	input pTransfertPrepare: Framework.boolean)
begin
--
--	Description :		Réaction à l'evènement EtatSync
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--	DN			31/12/1997		Correction bug (fiche ano 13)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.GestionEtatSync');

-- Declarations

-- Traitement

self.EnregistrementAutomatique = pEnregAuto;
self.EnregistrementEnCours = pEnregEnCours;
self.SonnerieEnCours = pSonnerieEnCours;

if (EnregistrementAutomatique) then
	self.<Enregistrer>.state = FS_DISABLE;
else
	self.<Enregistrer>.state = FS_ENABLE;
end if;

if (EnregistrementEnCours) then
	self.<Enregistrer>.ImageValue = self.<FinEnregistrer>.ImageValue;
else
	self.<Enregistrer>.ImageValue = self.ImageEnr;
end if;

if ((pEtat = CTI_ET_OCCUPE) and (self.EtatCti.value = CTI_ET_NOTLOGGED)) then
	-- Demarrage de la fenêtre
	self.GestionChangementEtat(pEtat=pEtat);
elseif (pEtat <> CTI_ET_OCCUPE) and (pEtat <> self.EtatCti.value) then
	self.GestionChangementEtat(pEtat=pEtat);
elseif (self.SonnerieEnCours) then				-- DN 31/12
	self.GestionChangementEtat(pEtat=pEtat);
end if;

if (pTransfertPrepare) then
	self.<CtiOutilsGrid>.state = FS_DISABLE;
end if;

if (pEtat = CTI_ET_OCCUPE) or (pEtat = CTI_ET_ATTENTE) then
	self.EtatCti.value = pTimer;
else
	self.<Enregistrer>.state = FS_DISABLE;
end if;


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.GestionEtatSync : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.GestionEtatSync');
		Raise;
end method;

------------------------------------------------------------
method BarreCTI.Init
begin
--
--	Description : 	Initialisation of the window.
--					This method must be overloaded in concret level for the access to service objects,
--					but it's recommanded to call the super before.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The characteritics of the window are positionned.
--
--	Exceptions : None
--
--	Usage : BarreCTI
--
--	Historique :
--
--	D. NGUYEN		|	23/10/1997	|	Creation.
--+

super.Init();
StdEventNotifier = new;
-- Initialisation des attributs propres à la barre d'outil CTI
self.EtatCti = new(value=CTI_ET_NOTLOGGED);

self.EnregistrementAutomatique = FALSE;
self.EnregistrementEnCours = FALSE;
ImageEnr = new(value=self.<Enregistrer>.ImageValue.Value);
Self.RegisterToCti();

end method;

------------------------------------------------------------
method BarreCTI.RegisterToCTI
begin
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_INITIALISERCTI);
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_REGISTERNOTIFIER, self.StdEventNotifier);
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_SYNCCTI);
end method;

------------------------------------------------------------
method BarreCTI.TransfertCTI
begin
--
--	Description :		Debut d'un transfert
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.TransfertCTI');

-- Declarations

-- Traitement
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_PREPARETRANSFERT);

hWin : MCTransfertWin = new();
Self.MyControlWin.Display(hWin,CTW_ASYNCDISP);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.TransfertCTI : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.TransfertCTI');
		Raise;

end method;

------------------------------------------------------------
event handler BarreCTI.CtiEvh()
begin

-- -------------------------------------------------------------------------------
-- Evenements de la Barre CTI vers le module CTI
-- -------------------------------------------------------------------------------

when <DecrocheBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_DECROCHE);
	self.SonnerieEnCours = FALSE;
	
when <RaccrocheBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_RACCROCHE);
	self.SonnerieEnCours = FALSE;
	
when <TransfertBtn>.Click Do
	Self.TransfertCTI();
	
when <LibererBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_LIBERER);
	
when <AttenteBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ATTENTE);
	
	
when <PauseBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_PAUSE);
	
when <Enregistrer>.Click Do
	if (self.EnregistrementEnCours) then --1
		-- Si enregistrement en cours on l'arrete
		self.EnregistrementEnCours = FALSE;
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ARRETERENREGISTREMENT);
	else --1
		-- Sinon on le démarre
		self.EnregistrementEnCours = TRUE;
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_DEMARRERENREGISTREMENT);
	end if; --1
	
/*
--------------------------------------------------------------------------------------
-- Evenements du module CTI vers la Barre CTI
--------------------------------------------------------------------------------------

when self.StdEventNotifier.StdEvent(unType=Type, unObjectSource=Object) do
	-- Travail sur une copie par sécurité
	unObject : Object = unObjectSource.Clone(deep=TRUE);

	case unType is
		when EVT_CTI_ETATSYNC do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionEtatSync(	pEtat= evtparam.Param1, pEnregAuto = evtparam.ParamBool,
									pEnregEnCours = evtparam.ParamBool2, pSonnerieEnCours=evtparam.ParamBool3,
									pTimer = evtparam.Param2, pTransfertPrepare = evtparam.ParamBool4);
		when EVT_CTI_APPELARRIVE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			-- Un appel arrive, on peut décrocher
			self.EnregistrementAutomatique = evtparam.ParamBool;
			self.EnregistrementEnCours = self.EnregistrementAutomatique;
			
			if (evtparam.Param2 <> '3') then
				-- C'est un appel entrant
				self.SonnerieEnCours = TRUE;
				<DecrocheBtn>.State = FS_ENABLE;
			else
				-- C'est un appel sortant
			end if;
				
			
			self.DoGestionAppelArrive(Param1 = evtparam.Param1, Param2 = evtparam.Param2, Param3 = evtParam.Param3, ParamBool = evtparam.ParamBool);
		
		when EVT_CTI_CHANGEMENTETAT do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionChangementEtat(pEtat=evtparam.param1);
			self.DoGestionChangementEtat(Param1=evtparam.param1);

		when EVT_CTI_COMMUNICATIONETABLIE do
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationEtablie();
			
		when EVT_CTI_COMMUNICATIONTERMINEE do
			-- La barre d'outil est dispo
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationTerminee();
			
		when EVT_CTI_CONSULTATIONINITIALISEE do
			self.<CtiOutilsGrid>.state = FS_DISABLE;
			self.DoGestionConsultationInitialisee();
			
		when EVT_CTI_CONSULTATIONETABLIE do
			self.DoGestionConsultationEtablie();
				
		when EVT_CTI_CONSULTATIONTERMINEE do
			
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			if (evtparam.Param1 <> CTI_TR_ANNULECLIENT) then
				self.<CtiOutilsGrid>.state = FS_ENABLE;
			else
			end if;
			self.DoGestionConsultationTerminee(Param1=evtparam.Param1);
			
		when EVT_CTI_ERREURSOFTPHONE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionErreurSoftphone(Param1=evtparam.Param1);
	
		when EVT_CTI_QUITTER do
			self.DoGestionQuitter();
			
		when EVT_CTI_TRANSFERTANNULE do
			-- Le transfert est annulé (ou on est en conference), la barre est accessible
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.DoGestionTransfertAnnule();
		
		when EVT_CTI_TRANSFERTPREPARE do
			-- Un transfert est préparé, la barre est inaccessible
			self.<CtiOutilsGrid>.STATE = FS_DISABLE;
			self.DoGestionTransfertPrepare();
			
		when EVT_CTI_CONFIRMERDV do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionConfirmerRendezVous(ParamBool=evtparam.paramBool);
	end case;

Exception
	-- Exception grave du CTI : on invalide la barre d'outil
	when uneCTIGraveExc : CTIGraveExc do
		self.<CtiOutilsGrid>.STATE = FS_DISABLE;
		raise uneCTIGraveExc;
*/
end event;

------------------------------------------------------------
event handler BarreCTI.EventLoopHandler()
begin
--
--	Description : 	Evènements à traiter dans l'event loop de la méthode display.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BarreCTI
--
--	Historique :
--
--	D. NGUYEN		|	23/10/1997	|	Creation.
--+
	
	-- Event Handler du CTI
	Register CtiEvh();
	Register EventNotifyEvh();
end event;

------------------------------------------------------------
event handler BarreCTI.EventNotifyEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de l'Event Notify de la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--+
	
	When StdEventNotifier.StdEvent(unType = Type, unObject = Object) do
	Begin
		Case unType is

		
--
-- Debut de section CTI
--
--	DN			31/12/1997		Correction bug (fiche anno 13)
				
		when EVT_CTI_ETATSYNC do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionEtatSync(	pEtat= evtparam.Param1, pEnregAuto = evtparam.ParamBool,
									pEnregEnCours = evtparam.ParamBool2, pSonnerieEnCours=evtparam.ParamBool3,
									pTimer = evtparam.Param2, pTransfertPrepare = evtparam.ParamBool4);
		when EVT_CTI_APPELARRIVE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			-- Un appel arrive, on peut décrocher
			self.EnregistrementAutomatique = evtparam.ParamBool;
			self.EnregistrementEnCours = self.EnregistrementAutomatique;
			
			if (evtparam.Param2 <> '3') then
				-- C'est un appel entrant
				self.SonnerieEnCours = TRUE;
				<DecrocheBtn>.State = FS_ENABLE;
				<PauseBtn>.State = FS_DISABLE; -- DN 31/12
			else
				-- C'est un appel sortant
			end if;
				
			
			self.DoGestionAppelArrive(Param1 = evtparam.Param1, Param2 = evtparam.Param2, Param3 = evtParam.Param3, ParamBool = evtparam.ParamBool);
		
		when EVT_CTI_CHANGEMENTETAT do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionChangementEtat(pEtat=evtparam.param1);
			self.DoGestionChangementEtat(Param1=evtparam.param1);

		when EVT_CTI_COMMUNICATIONETABLIE do
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationEtablie();
			
		when EVT_CTI_COMMUNICATIONTERMINEE do
			-- La barre d'outil est dispo
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationTerminee();
			
		when EVT_CTI_CONSULTATIONINITIALISEE do
			self.<CtiOutilsGrid>.state = FS_DISABLE;
			self.DoGestionConsultationInitialisee();
			
		when EVT_CTI_CONSULTATIONETABLIE do
			self.DoGestionConsultationEtablie();
				
		when EVT_CTI_CONSULTATIONTERMINEE do
			
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			if (evtparam.Param1 <> CTI_TR_ANNULECLIENT) then
				self.<CtiOutilsGrid>.state = FS_ENABLE;
			else
			end if;
			self.DoGestionConsultationTerminee(Param1=evtparam.Param1);
			
		when EVT_CTI_ERREURSOFTPHONE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionErreurSoftphone(Param1=evtparam.Param1);
	
		when EVT_CTI_QUITTER do
			self.DoGestionQuitter();
			
		when EVT_CTI_TRANSFERTANNULE do
			-- Le transfert est annulé (ou on est en conference), la barre est accessible
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.DoGestionTransfertAnnule();
		
		when EVT_CTI_TRANSFERTPREPARE do
			-- Un transfert est préparé, la barre est inaccessible
			self.<CtiOutilsGrid>.STATE = FS_DISABLE;
			self.DoGestionTransfertPrepare();
			
		when EVT_CTI_CONFIRMERDV do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionConfirmerRendezVous(ParamBool=evtparam.paramBool);
--
-- Fin de section CTI
--
			else do
				Self.DoStdEventNotifier(unType,unObject);
		end Case;
		Exception 
			When e : GenericException do
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
				
			-- Exception grave du CTI : on invalide la barre d'outil
			when uneCTIGraveExc : CTIGraveExc do
				self.<CtiOutilsGrid>.STATE = FS_DISABLE;
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(uneCTIGraveExc.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(uneCTIGraveExc.Severity);
				AffStatusLine(TmpMsg);
	End;


end event;

------------------------------------------------------------
method MCConferenceWin.ExitWindow
begin
--
--	Description : 	Operations done just before closing the window.
--					The current action is finished properly and currents locks are unlocked.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The window is ready to be closed.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.ExitWindow');

Self.MyActionMgr.Action(ACT_CTI_DEREGISTERNOTIFIER, Self.StdEventNotifier);
Super.ExitWindow();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.ExitWindow : End');

end method;

------------------------------------------------------------
method MCConferenceWin.GestionTransfertAnnule
begin
--
--	Description :		Réaction à l'evènement TransfertAnnule
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.GestionTransfertAnnule');

-- Declarations

-- Traitement

-- Le transfert est annulé (ou on est en conference), la barre est accessible
/*-- DN TEST self.<barreoutil>.STATE = FS_ENABLE;

if self.TransfertEnCours then
	post self.uneMCTransfertWin.AnnulerTransfertEVT();
end if;

if self.ConferenceEnCours then
	post self.uneMCConferenceWin.AnnulerConferenceEVT(CTI_TR_ANNULECONS);
end if;

*/-- DN TEST 
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.GestionTransfertAnnule : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.GestionTransfertAnnule');
		Raise;
end method;

------------------------------------------------------------
method MCConferenceWin.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

super.Init();

--MyTransType = soInterfaceMgrClt; -- BusinessServiceMgr auquel la fenêtre est liée
--MyClassType = InterfaceCTI; -- Service BusinessService

self.StdEventNotifier = new();

-- task.part.logmgr.putline('CONFERENCEWIN : Init');

end method;

------------------------------------------------------------
method MCConferenceWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : 	Initialisation of the display of window.
--					This method must be overloaded in concret level for the access to service objects,
--					but it's recommanded to call the super before.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The characteritics of the window are positionned.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	03/06/1997	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitDisplay');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : InitDisplay');

--super.InitDisplay();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : REGISTER');

Self.MyControlWin.MyActionMgr.Action(ACT_CTI_REGISTERNOTIFIER, self.StdEventNotifier);

<Conference_PBN>.State = FS_DISABLE;
<Annuler_PBN>.State = FS_ENABLE;

if (TypeTransfert = CTI_TR_INDIRECT) then
	-- Transfert Indirect
	<Conference_PBN>.label = new(value='Transfert');
else
	-- Conference, Rien à faire
	<Conference_PBN>.label = new(value='Conférence');
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitDisplay : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e,'StandardDataWin.InitDisplay');
		Raise;
end method;

------------------------------------------------------------
method MCConferenceWin.ReactionFinConference(input pResultat: CtiItBD.ConferenceEVTParam)
begin
--
--	Description :		Réaction à l'evènement FinConference (IHM Conference)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.ReactionFinConference');

-- Declarations

res : ConferenceEVTParam = pResultat;

-- Traitement

-- DN TEST self.ConferenceEnCours = FALSE;
if (res.Validation) then
	-- On envoi la commande correspondante
	if (res.type_conf = CTI_TR_INDIRECT) then
		-- Le client est transféré
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_VALIDERTRANSFERT);
	elseif (res.type_conf = CTI_TR_CONFERENCE) then
		-- On est en Conférence ce qui est géré ensuite comme un appel simple
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_VALIDERCONFERENCE);
	else
		-- Rien a faire pour le moment
	end if;
-- DN TEST 	self.<barreoutil>.state = FS_ENABLE;
else
	-- Recupere le client
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ANNULERCONSULTATION);
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.ReactionFinConference : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.ReactionFinConference');
		Raise;
end method;

------------------------------------------------------------
event handler MCConferenceWin.EventLoopHandler()
begin

register super.EventLoopHandler();


	when task.Shutdown do
		-- C'est le conseiller qui annule la conférence
		unParam : ConferenceEvtParam = new();
		unParam.validation = FALSE;
		self.ReactionFinConference(unParam);
		exit;
		
	when <Conference_PBN>.Click do
		unParam : ConferenceEvtParam = new();
		unParam.validation = TRUE;
		unParam.Type_Conf = TypeTransfert;
		self.ReactionFinConference(unParam);
		exit;
				
	when <Annuler_PBN>.Click do
		-- C'est le conseiller qui annule la conférence
		unParam : ConferenceEvtParam = new();
		unParam.validation = FALSE;
		self.ReactionFinConference(unParam);
		exit;
		
when self.FinConfEvt() do
		-- On nous signale de fermer la fenêtre
		exit;
		
--------------------------------------------------------------------------------------
-- Evenements du module CTI vers la Barre CTI
--------------------------------------------------------------------------------------

when self.StdEventNotifier.StdEvent(unType=Type, unObject=Object) do
	case unType is

		when EVT_CTI_TRANSFERTANNULE do
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : Transfert annulé');
			post self.FinConfEvt();

		when EVT_CTI_CONSULTATIONETABLIE do
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : Consultation établie');
			self.<Conference_PBN>.State = FS_ENABLE;
	
		when EVT_CTI_CONSULTATIONTERMINEE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			Orig : string =evtparam.Param1;
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : ConsultationTerminée');

			if (orig = CTI_TR_ANNULECLIENT) then
				-- C'est le client qui a raccroché
				-- La fenêtre conférence reste ouverte mais on ne peut que annuler
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : Client à raccroché');
				self.<Conference_PBN>.State = FS_DISABLE;
			else
				-- La consultation est terminée, on ferme la fenêtre
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'CONFERENCEWIN : Qui a raccroché ???');
				post self.FinConfEvt();
			end if;
				

	
	end case;
	

end event;

------------------------------------------------------------
method MCTransfertWin.AnnulerTransfert
begin
--
--	Description :		Gestion d'un transfert annule par le conseiller
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.AnnulerTransfert');

-- Declarations
unParam : TransfertEvtParam = new;

-- Traitement

unParam.TransfertAnnule = TRUE;
Self.FinTransfert(unParam);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.AnnulerTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.AnnulerTransfert');
		Raise;



end method;

------------------------------------------------------------
method MCTransfertWin.ControleCoherenceTransfert
begin
--
--	Description :		Controle la cohérence du type de transfert
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.ControleCoherenceTransfert');

-- Declarations

-- Traitement

/*
	Controle la cohérence du type de transfert par rapport aux autres paramètres
*/

-- Teste les combinaison non valide

case leTypeTransfert is 

	when CTI_TR_DIRECT do
		-- Pas de transfert direct vers un Individu
		
		if (leIndividu<>TR_AUCUN) then
			leTypeTransfert = CTI_TR_INDIRECT;
		elseif (lePartenaire<>TR_AUCUN) then
			leTypeTransfert = CTI_TR_INDIRECT;
		else
			-- Rien a faire
		end if;
		
	when CTI_TR_INDIRECT do
		-- Pas de transfert indirect vers le SVI
		if (transfertSVI.value) then
			leTypeTransfert = CTI_TR_DIRECT;

		elseif (leGroupe<>TR_AUCUN) and (leIndividu=TR_AUCUN) then
			-- Pas de transfert indirect vers un Groupe
			leTypeTransfert = CTI_TR_DIRECT;
		else
			-- Rien a faire
		end if;

	when CTI_TR_CONFERENCE do
		-- Pas de conference vers le SVI
		if (transfertSVI.value) then
			leTypeTransfert = CTI_TR_DIRECT;
		elseif (leGroupe<>TR_AUCUN) and (leIndividu=TR_AUCUN) then
			-- Pas de conference vers un Groupe
			leTypeTransfert = CTI_TR_DIRECT;
		else
			-- Rien a faire
		end if;
	else
		-- Rien a faire
end case;

self.<leTypeTransfert>.UpdateFieldFromData();
	
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.ControleCoherenceTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.ControleCoherenceTransfert');
		Raise;



end method;

------------------------------------------------------------
method MCTransfertWin.DoGestionConsultationInitialisee
begin
self.GestionConsultationInitialisee();
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'Fin transfert');
post self.FinTransfertEvt();
end method;

------------------------------------------------------------
method MCTransfertWin.DoGestionTransfertAnnule
begin
post self.FinTransfertEvt;

end method;

------------------------------------------------------------
method MCTransfertWin.ExitWindow
begin
--
--	Description : 	Operations done just before closing the window.
--					The current action is finished properly and currents locks are unlocked.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The window is ready to be closed.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.ExitWindow');

Self.MyActionMgr.Action(ACT_CTI_DEREGISTERNOTIFIER, Self.StdEventNotifier);
Super.ExitWindow();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.ExitWindow : End');

end method;

------------------------------------------------------------
method MCTransfertWin.FinTransfert(input pResultat: CtiItBD.TransfertEVTParam)
begin
--
--	Description :		Gestion de la selection pour transfert
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.FinTransfert');

-- Declarations

resTransfert : TransfertEVTParam = pResultat;

-- Traitement

if not (resTransfert.TransfertAnnule) then --1
-- Un transfert est demandé
	if (resTransfert.TransfertGuichet) then --11
		-- Transfert vers le SVI Guichet
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_CONSULTATIONCOMPTE);

	elseif (resTransfert.TransfertMotDePasse) then  --12
		-- Transfert vers le SVI Mot de Passe
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_CHANGEMENTMOTDEPASSE);

	elseif (resTransfert.TypeTransfert = CTI_TR_DIRECT) then  --13
		-- Transfert Direct
		unParam : TransfertDirectParam = new(pPHONE=resTransfert.numero);
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_TRANSFERTDIRECT,unParam);

	else	--14
		-- Transfert Indirect ou Conference
		unParam : InitialiserConsultationParam = new();
		unParam.pPHONE=resTransfert.numero;
		unParam.pType_Cons = resTransfert.TypeTransfert;
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_INITIALISERCONSULTATION,unParam);
		self.leTypeTransfert = resTransfert.TypeTransfert;
		-- C'est l'evenement Consultation Etablie qui se charge de la suite ...
	end if; -- 11
else --1
	-- Le transfert est annule
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ANNULEPREPARETRANSFERT);
end if; --1



-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.FinTransfert : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.FinTransfert');
		Raise;
end method;

------------------------------------------------------------
method MCTransfertWin.GestionConsultationInitialisee
begin
--
--	Description :		Réaction à l'evènement ConsultationInitialisee
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.GestionConsultationInitialisee');

-- Declarations

-- Traitement

-- La consultation est initialisée, on affiche le paneau de controle de conference

uneMCConferenceWin : MCConferenceWin = new(TypeTransfert=leTypeTransfert);
Self.MyControlWin.Display(uneMCConferenceWin,CTW_ASYNCDISP);
	
-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.GestionConsultationInitialisee : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.GestionConsultationInitialisee');
		Raise;
end method;

------------------------------------------------------------
method MCTransfertWin.GetNumero: Framework.string
begin
--
--	Description :		Recupère le numéro correspondant à la sélection
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.GetNumero');

-- Declarations

-- Traitement

/*
	Retourne une chaine contenant le numéro de téléphone du destinataire sélectionné
*/

numtel : string;

-- Transfert SVI ou autre ?

if (TransfertSVI) then
	-- Numéro de file ou quoi ???
elseif not (leIndividu = TR_AUCUN) then
	-- Numéro de l'individu
	unGroupe : string;
	if (leGroupe = TR_AUCUN) then
		unGroupe = '';
	else
		unGroupe = leGroupe;
	end if;
	
	for row in SOAnnuaireTelephone.GetListeIndividu(unGroupe) do
		if (leIndividu = row.leNom) then
			numtel=row.leNumeroTel;
			exit;
		else -- Rien a faire
		end if;
	end for;
	
elseif not (leGroupe = TR_AUCUN) then
	-- Numéro du groupe
	for row in SOAnnuaireTelephone.GetListeGroupe() do
		if (leGroupe = row.leNom) then
			numtel=row.leNumeroTel;
			exit;
		else -- Rien a faire
		end if;
	end for;

elseif not (lePartenaire = TR_AUCUN) then
	-- Numéro du partenaire
	for row in SOAnnuaireTelephone.GetListePartenaire() do
		if (lePartenaire = row.leNom) then
			numtel=row.leNumeroTel;
			exit;
		else -- Rien a faire
		end if;
	end for;

else
	-- Pas de destinataire choisi
	numtel = '';
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.GetNumero : End');

return numtel;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.GetNumero');
		Raise;

end method;

------------------------------------------------------------
method MCTransfertWin.Init
begin
--
--	Description :	Initialisation	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			30/05/1997		Création
--+

super.Init();

TransfertSVI = new(value=TRUE);
TransfertAutre = new(value=FALSE);

leTypeTransfert = CTI_TR_DIRECT;

self.InitListes(); -- Rempli les listes (fonction SVI, Groupe , Individu, Partenaire)

// JBB MyTransType = soInterfaceMgrClt; -- BusinessServiceMgr auquel la fenêtre est liée
MyClassType = InterfaceCTI; -- Service BusinessService

StdEventNotifier = new();

end method;

------------------------------------------------------------
method MCTransfertWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : 	Initialisation of the display of window.
--					This method must be overloaded in concret level for the access to service objects,
--					but it's recommanded to call the super before.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The characteritics of the window are positionned.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	03/06/1997	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitDisplay');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'TransfertWIN : InitDisplay');
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_REGISTERNOTIFIER, self.StdEventNotifier);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitDisplay : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e,'StandardDataWin.InitDisplay');
		Raise;
end method;

------------------------------------------------------------
method MCTransfertWin.InitListes
begin
--
--	Description :		Construction des listes pour l'affichage
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.InitListes');

-- Declarations

uneListeListElement : Array of ListElement;
unListElement : ListElement;

-- Traitement

--
-- Construction des listes pour les transferts
--

/*

Construction de la liste des groupes

*/

uneListeListElement = new;

-- Le premier elément est toujours le choix nul
unListElement = new (TextValue = TR_AUCUN);
uneListeListElement.AppendRow(unListElement);

for row in SOAnnuaireTelephone.GetListeGroupe() do
	unListElement = new (TextValue = row.leNom);
	uneListeListElement.AppendRow(unListElement);
end for;
<leGroupe>.SetElementList(uneListeListElement);
<leGroupe>.UpdateFieldFromData();


/*

 Construction de la liste des individus
 
*/

uneListeListElement = new;

-- Le premier elément est toujours le choix nul
unListElement = new (TextValue = TR_AUCUN);
uneListeListElement.AppendRow(unListElement);

for row in SOAnnuaireTelephone.GetListeIndividu('') do
	unListElement = new (TextValue = row.leNom);
	uneListeListElement.AppendRow(unListElement);
end for;
<leIndividu>.SetElementList(uneListeListElement);
<leIndividu>.UpdateFieldFromData();

/*

 Construction de la liste des partenaires
 
*/

uneListeListElement = new;

-- Le premier elément est toujours le choix nul
unListElement = new (TextValue = TR_AUCUN);
uneListeListElement.AppendRow(unListElement);

for row in SOAnnuaireTelephone.GetListePartenaire() do
	unListElement = new (TextValue = row.leNom);
	uneListeListElement.AppendRow(unListElement);
end for;
<lePartenaire>.SetElementList(uneListeListElement);
<lePartenaire>.UpdateFieldFromData();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.InitListes : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.InitListes');
		Raise;





end method;

------------------------------------------------------------
method MCTransfertWin.MajListeIndividu
begin
--
--	Description :		Mise à jour de la liste Individu en fonction du groupe courant
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.MajListeIndividu');

-- Declarations
uneListeListElement : Array of ListElement = new;
unListElement : ListElement;

-- Traitement

/*

 Reconstruction de la liste des individus
 
*/


-- Le premier elément est toujours le choix nul
unListElement = new (TextValue = TR_AUCUN);
uneListeListElement.AppendRow(unListElement);

-- Rempli la liste en fonction du groupe courant

tmpGroupe : string;

if (leGroupe=TR_AUCUN) then
	-- Pas de groupe;
	tmpGroupe = '';
else
	tmpGroupe = leGroupe;
end if;


for row in SOAnnuaireTelephone.GetListeIndividu(tmpGroupe) do
	unListElement = new (TextValue = row.leNom);
	uneListeListElement.AppendRow(unListElement);
end for;

<leIndividu>.SetElementList(uneListeListElement);
<leIndividu>.UpdateFieldFromData();

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.MajListeIndividu : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.MajListeIndividu');
		Raise;


end method;

------------------------------------------------------------
method MCTransfertWin.TraitementTransfertAutre
begin
--
--	Description :		Traitement d'un transfert vers une personne (autre que SVI)
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.TraitementTransfertAutre');

-- Declarations

-- Traitement

/*
	Transfert autre que vers le SVI
*/

numtel : string = self.GetNumero();
if ((numtel='') or (numtel='(nil)')) then
	self.window.MessageDialog('Aucun destinataire selectionné',MT_ERROR);
else
	unParam : TransfertEvtParam = new();
	unParam.TransfertAnnule = FALSE;
	unParam.TransfertGuichet = FALSE;
	unParam.TransfertMotDePasse = FALSE;
	unParam.TypeTransfert = leTypeTransfert;
	unParam.Numero = numTel;
	Self.FinTransfert(unParam);
end if;

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.TraitementTransfertAutre : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.TraitementTransfertAutre');
		Raise;



end method;

------------------------------------------------------------
method MCTransfertWin.TraitementTransfertSVI
begin
--
--	Description :		Traitement d'un transfert vers le SVI
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MCTransfertWin.TraitementTransfertSVI');

-- Declarations
unParam : TransfertEvtParam = new();

-- Traitement

/*
	Transfert vers le SVI
*/

unParam.TransfertAnnule = FALSE;

case laFonctionSVIChoisie is

	when TR_SVIMDP do	-- Transfert Mot de Passe
		unParam.TransfertGuichet = FALSE;
		unParam.TransfertMotDePasse = TRUE;
		
	when TR_SVIGUICHET do -- Transfert Guichet
		unParam.TransfertGuichet = TRUE;
		unParam.TransfertMotDePasse = FALSE;
		
	else
		-- Rien à faire
		unParam.TransfertAnnule = TRUE;
		
end case;

Self.FinTransfert(unParam);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MCTransfertWin.TraitementTransfertSVI : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MCTransfertWin.TraitementTransfertSVI');
		Raise;



end method;

------------------------------------------------------------
event handler MCTransfertWin.EventLoopHandler()
begin
	Register Super.EventLoopHandler();

	when task.Shutdown do
		Self.AnnulerTransfert();
		exit;

	-- Choix d'un transfert SVI
	when <TransfertSVI>.Click do
		TransfertAutre.value = FALSE;
		TransfertSVI.value = TRUE;
		leTypeTransfert = CTI_TR_DIRECT;
		self.ControleCoherenceTransfert();
		
	-- Choix d'un transfert autre que SVI
	when <TransfertAutre>.Click do
		TransfertSVI.value = FALSE;
		TransfertAutre.value = TRUE;
		leTypeTransfert = CTI_TR_INDIRECT;
		self.ControleCoherenceTransfert();
		
	-- Choix d'une fonction SVI
	when <laFonctionSVIChoisie>.AfterValueChange do
		-- Si on choisi une fonction SVI on choisi implicitement de faire un transfert SVI
		TransfertAutre.value = FALSE;
		TransfertSVI.value = TRUE;
		leTypeTransfert = CTI_TR_DIRECT;
		self.ControleCoherenceTransfert();
		
	-- Choix d'un groupe
	when <leGroupe>.AfterValueChange do
		-- Si on choisi un groupe on choisi implicitement de faire un transfert autre que SVI
		TransfertSVI.value = FALSE;
		TransfertAutre.value = TRUE;
		leTypeTransfert = CTI_TR_DIRECT;
		self.ControleCoherenceTransfert();
		-- On remet Partenaire a la VD
		lePartenaire = TR_AUCUN;
		-- On remet à jour la liste des individus
		self.MajListeIndividu();


	-- Choix d'un individu
	when <leIndividu>.AfterValueChange do
		-- Si on choisi un individu on choisi implicitement de faire un transfert autre que SVI
		TransfertSVI.value = FALSE;
		TransfertAutre.value = TRUE;
		leTypeTransfert = CTI_TR_INDIRECT;
		self.ControleCoherenceTransfert();
		-- On remet Partenaire a la VD
		lePartenaire = TR_AUCUN;
		
	-- Choix d'un partenaire
	when <lePartenaire>.AfterValueChange do
		-- Si on choisi un partenaire on choisi implicitement de faire un transfert autre que SVI
		TransfertSVI.value = FALSE;
		TransfertAutre.value = TRUE;
		leTypeTransfert = CTI_TR_INDIRECT;
		self.ControleCoherenceTransfert();
		-- On remet Groupe et Indididu a la VD
		leGroupe = TR_AUCUN;
		leIndividu = TR_AUCUN;
		-- On remet à jour la liste des individus puisque on a RAZ leGroupe
		self.MajListeIndividu();
		
	-- Choix d'un type de transfert
	when <leTypeTransfert>.AfterValueChange do
		self.ControleCoherenceTransfert();

	-- Validation du transfert
	when <OK_PBN>.Click do
		if (TransfertSVI) then
			self.TraitementTransfertSVI();
		else
			self.TraitementTransfertAutre();
		end if;
		
	-- Annule le transfert		
	when <Annuler_PBN>.Click do
		Self.MyActionMgr.Action(ACT_CTI_ANNULEPREPARETRANSFERT);
		exit;
		
--------------------------------------------------------------------------------------
-- Evenements du module CTI vers la Barre CTI
--------------------------------------------------------------------------------------

when self.FinTransfertEvt() do
		exit;

when self.StdEventNotifier.StdEvent(unType=Type, unObject=Object) do
	case unType is

		when EVT_CTI_TRANSFERTANNULE do
			self.DoGestionTransfertAnnule();

		when EVT_CTI_CONSULTATIONINITIALISEE do
			self.DoGestionConsultationInitialisee();

	end case;

end event;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'CtiItBD';


end CtiItBD;
begin TOOL DataAccessBD;

includes CtiItBD;
includes DataAccessSrvBD;
includes DicoBD;
includes DicoSrvBD;
includes DisplayBD;
includes FrameworkBD;
includes InterfacesBD;
includes DisplayProject;
includes Framework;
includes SystemMonitor;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  DetailWin is mapped;
forward  DicoTrt;
forward interface DicoTrtInt;
forward  InitAppDesc;
forward  MainWin is mapped;
forward  StandardCplxDataWin is mapped;
forward  StandardDataWin is mapped;
forward  StandardDicoWin is mapped;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant DTA_ADDFROMCURRENT = 1;
constant DTA_ADDNEW = 0;
constant DTA_VIEWOPTION_ACTIVE = 0;
constant DTA_VIEWOPTION_INACTIVE = 1;
constant LOG_GRPFLAG = 5;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class DicoTrt inherits from FrameworkBD.ObjectBD

has public  attribute DicoService: Framework.ClassType;
has public  attribute DicoServiceMgr: DataAccessSrvBD.BusinessServiceMgrDesc;
has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  attribute TransferTrt: DataAccessSrvBD.TransferTrt;

has public  method DicoTransfer(input aTransData: DataAccessSrvBD.TransDico): Framework.Object;
has public  method Init;
has public  method InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);

implements	DataAccessBD.DicoTrtInt;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

interface DicoTrtInt inherits from FrameworkBD.ObjectIf

has public  method InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);

has property
	componentFlags = 8;
end interface;

class InitAppDesc inherits from FrameworkBD.ObjectBD

has public  attribute Dependances: Framework.Array of Framework.Object;
has public  attribute FrontComm: DisplayBD.FrontCommCltDesc;
has public  attribute InitWin: DisplayBD.StandardWin;
has public  attribute MyControlWin: DisplayBD.ControlWinDesc;
has public  attribute MyInterfaceMgr: DataAccessSrvBD.InterfaceMgrDesc;


has public  method DoInitService;
has public  method DoOpenApplication;
has public  method Init;
has public  method InitService;
has public  method OpenApplication where completion = (return = OpenApplicationDone, exception = OpenApplicationExc);
has public  method SyncServices;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class StandardDataWin is mapped inherits from DisplayBD.StandardWin

has public  constant MSG_ADD_1 = 'Créer nouveau ?';
has public  constant MSG_ADD_2 = 'Ajouter une fiche ?';
has public  constant MSG_ADD_3 = 'Valider puis ajouter une fiche ?';
has public  constant MSG_APPEND_1 = 'Enregistrer Création ?';
has public  constant MSG_DELETE_1 = 'Suppression ?';
has public  constant MSG_DELETE_2 = 'Effacer cette fiche ?';
has public  constant MSG_DELETE_3 = 'Valider puis effacer cette fiche ?';
has public  constant MSG_NEXT_3 = 'Valider puis passer à la fiche suivante ?';
has public  constant MSG_PREV_3 = 'Valider puis passer à la fiche précédente ?';
has public  constant MSG_QUIT_2 = 'Valider la fenêtre avant de quitter ?';
has public  constant MSG_QUIT_3 = 'Valider puis quitter ?';
has public  constant MSG_QUITALL_2 = 'Quitter l\'application ?';
has public  constant MSG_QUITALL_3 = 'Valider puis quitter l\'application ?';
has public  constant MSG_SAVE_2 = 'Enregistrer ?';
has public  constant MSG_UPDATE_1 = 'Mise à jour ?';

has public  attribute ActionAppend: Framework.integer;
has public  attribute ActionDelete: Framework.integer;
has public  attribute ActionRead: Framework.integer;
has public  attribute ActionUpdate: Framework.integer;
has public  attribute AddConfirm: Framework.boolean;
has public  attribute AddPolicy: Framework.integer;
has public  attribute AppendConfirm: Framework.boolean;
has public  attribute BufferStructure: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute CurMode: Framework.string;
has public  attribute CurPos: Framework.TextData;
has public  attribute CurrentId: Framework.integer;
has public  attribute CurrentPosition: Framework.integer;
has public  attribute DataMode: Framework.integer;
has public  attribute DeleteConfirm: Framework.boolean;
has public  attribute DicoService: Framework.ClassType;
has public  attribute DicoTrt: DataAccessBD.DicoTrt;
has public  attribute DicoTypeLib: Framework.integer;
has public  attribute EnregistrementAutomatique: Framework.boolean;
has public  attribute EnregistrementEnCours: Framework.boolean;
has public  attribute EtatCti: Framework.TextData;
has private attribute FirstRead: Framework.boolean;
has public  attribute FlagAppend: Framework.boolean;
has public  attribute FlagCti: Framework.boolean;
has public  attribute FlagDelete: Framework.boolean;
has public  attribute FlagExecute: Framework.boolean;
has public  attribute FlagPanel0: Framework.boolean;
has public  attribute FlagRead: Framework.boolean;
has public  attribute FlagUpdate: Framework.boolean;
has public  attribute ImageEnr: Framework.ImageData;
has public  attribute InitAddValues: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute MyCache: DataAccessSrvBD.Cache;
has public  attribute OrigFillColor: Framework.integer;
has public  attribute OrigFilterCritera: Framework.string;
has public  attribute PlayValidity: Framework.boolean;
has public  attribute SonnerieEnCours: Framework.boolean;
has private attribute SubmitOnShutdown: Framework.boolean;
has public  attribute UpdateConfirm: Framework.boolean;
has public  attribute ValidateConfirm: Framework.boolean;
has public  attribute ViewMode: Framework.integer;
has public  attribute ViewPolicy: Framework.integer;

has public  method Add(input Mode: Framework.integer);
has public  method Add;
has public  method AffCurPos(input CurrentPosition: Framework.integer,
	input Total: Framework.integer);
has public  method AffectDataWin(input aObject: Framework.Object);
has public  method AffFirstPosition;
has private method AffLastPosition;
has public  method AffNextPosition;
has public  method AffPosition;
has private method AffPreviousPosition;
has public  method AffStatusLine(input Message: Framework.string);
has public  method AffStatusLine(input Message: Framework.TextData);
has public  method Append;
has public  method AppendEvent(input aObject: Framework.Object);
has public  method BusinessClassMaj(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pResult: DataAccessSrvBD.ObjectSelfDesc);
has public  method Connect(input output SessionId: DataAccessSrvBD.SessionId);
has public  method CopyMnu(input pSubMenuSrc: DisplayProject.Submenu,
	input output pSubMenuDst: DisplayProject.Submenu);
has public  method Delete;
has public  method DeleteEvent(input aObject: Framework.Object);
has public  method DeleteRecord(input aRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method DetailAff(input DetailWin: Framework.ClassType);
has public  method DetailAff(input DetailWin: Framework.ClassType,
	input ModeAff: Framework.integer);
has public  method DicoTransfer(input aTransData: DataAccessSrvBD.TransDico): Framework.Object;
has public  method DoAffectObject(output pObject: Framework.Object);
has public  method DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method DoAfterAdd;
has public  method DoAfterAppend;
has public  method DoAfterDelete;
has public  method DoAfterMenuCtxAction(input output pMenuCommand: DisplayProject.MenuCommand);
has public  method DoAfterMenuCtxAff(input output pMenuCommand: DisplayProject.MenuCommand);
has public  method DoAfterSetDataMode(input DataMode: Framework.integer);
has public  method DoAfterUpdate;
has public  method DoBeforeAdd;
has public  method DoBeforeAppend;
has public  method DoBeforeDelete;
has public  method DoBeforeMenuCtxAff(input output pMenu: DisplayProject.Submenu);
has public  method DoBeforeUpdate;
has public  method DoGestionAppelArrive(input Param1: Framework.string,
	input Param2: Framework.string,
	input Param3: Framework.string,
	input ParamBool: Framework.boolean);
has public  method DoGestionChangementEtat(input Param1: Framework.string);
has public  method DoGestionCommunicationEtablie;
has public  method DoGestionCommunicationTerminee;
has public  method DoGestionConfirmerRendezVous(input ParamBool: Framework.boolean);
has public  method DoGestionConsultationEtablie;
has public  method DoGestionConsultationInitialisee;
has public  method DoGestionConsultationTerminee(input Param1: Framework.string);
has public  method DoGestionErreurSoftphone(input Param1: Framework.string);
has public  method DoGestionQuitter;
has public  method DoGestionTransfertAnnule;
has public  method DoGestionTransfertPrepare;
has public  method DoStdEventNotifier(input pType: Framework.integer,
	input pObject: Framework.Object);
has public  method EventLoop;
has public  method ExitWindow;
has public  method Fermer;
has public  method GestionChangementEtat(input pEtat: Framework.string);
has public  method GestionEtatSync(input pEtat: Framework.string,
	input pEnregAuto: Framework.boolean,
	input pEnregEnCours: Framework.boolean,
	input pSonnerieEnCours: Framework.boolean,
	input pTimer: Framework.string,
	input pTransfertPrepare: Framework.boolean);
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method InitFillInFields(input aWidget: DisplayProject.Widget,
	input pTypeLib: Framework.integer = 0);
has public  method InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method MenuCtxAff(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input pX: Framework.integer,
	input pY: Framework.integer): DisplayProject.MenuCommand;
has public  method MenuCtxAff(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string);
has public  method PostEventLoop;
has private method Quitter;
has public  method Read;
has public  method RegisterClose(input aWindow: DisplayBD.StandardWin);
has public  method RegisterClose;
has public  method RegisterToCTI;
has public  method ResetAttributes(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc);
has public  method ResetMnu(input output pSubMenu: DisplayProject.Submenu);
has public  method ResetSelfDesc(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc);
has public  method ResetWindow;
has public  method SetDataMode(input DataMode: Framework.integer);
has public  method SetViewMode(input aViewMode: Framework.integer);
has public  method SetViewPolicy(input aViewPolicy: Framework.integer);
has public  method Submit;
has public  method TransfertCTI;
has public  method Update;
has public  method UpdateEvent(input aObject: Framework.Object);
has public  method UpdateRecord(input aRecord: DataAccessSrvBD.ObjectSelfDesc);

has public  event handler ArrayEvh(input pWidget: DisplayProject.ArrayField);
has public  event handler BriqueCompoundChildEvh(input unWidget: DisplayProject.CompoundField,
	input unMenuName: Framework.string,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL);
has public  event handler BriqueCompoundEvh(input unWidget: DisplayProject.CompoundField,
	input unMenuName: Framework.string,
	input WithChild: Framework.boolean = TRUE,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL);
has public  event handler BriqueEvh(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input WithChild: Framework.boolean = TRUE,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL);
has public  event handler BriqueFieldWidgetEvh(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL);
has public  event handler CtiEvh();
has public  event handler DefaultEvh();
has public  event handler DeplacementEvh();
has public  event handler EventLoopHandler();
has public  event handler EventNotifyEvh();
has public  event handler GeneralOutilsEvh();
has public  event handler StandardOutilsEvh();

implements	DataAccessBD.DicoTrtInt;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin');

has
+5151463100004b06000044539fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100002f000002001b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+0108076801000000000000000000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d0000131511e7000000000303030300050404606000002203e8
+07d000009d13159d11e700000000000001080910010000000000000000000002
+0100000000040201009fff009fff20010100000a0000000404000100020b0c0d
+00090000210202000000000b0d0a06000302010000000000000b06007c08000d
+000d0d42617272654861757447726964010104010f1011120101011700029fff
+9e000100100000000d000001a111bd0001000103030303000801046060000022
+0000000000009d01a19d11bd00000000000001080e1001ff8100000000000000
+00020100000000040104009fff009fff20010100000f00000000000404000000
+00000210001100120013000e000021040200000000101211130f060003020900
+00000000001006007c08000d0015154465706c6163656d656e744f7574696c73
+47726964230104010f1011120101011700039fff9e000100130000000d000001
+7702cf0001000103030303000b010160600000000000000000009d01779d02cf
+0000000000000108141001ff810000000000000000020100000000040102009f
+ff009fff00010100001500000004040000000216001700140000210202000000
+00161715060003020100001414141416060113080201020c0c50726563656465
+6e7442746e01020421212121212121211700049fff9e000100110000000d1515
+0124012400010001030303030010010180800000000000000018199d01249d01
+240000000000000102001a001800001c020a0a5072e963e964656e740a101900
+001c0200101a00010f00011b1b00011200018014141c0001081414009d01900f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800
+010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f
+0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f
+0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f00
+00080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1c00011000019d0100009d030000000080
+80808000008080000080000080800000808000808080400040400080ff004080
+4000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff
+8000ff8080ffff8080ffff0080ff804000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000017060113
+080201020a0a53756976616e7442746e01020421212121212121211700059fff
+9e000100120000000d9d016d1501240124000100020303030300100101808000
+0000000000001d1e9d01249d01240000000000000102001f001d00001c020808
+53756976616e740a101e00001c0200101f00010f000120200001120001801414
+210001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f
+0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f
+0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f
+08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f
+0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f
+0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f210001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000001106007c08000d0012125374616e646172644f7574696c7347
+726964010104010f1011120101011700089fff9e000100180000000d9d04a300
+017701770001000203030303000b010160600000000000000000009d01779d01
+770000000000000108221001ff81000000000000000002010000000004010100
+9fff009fff000101000023000004040000022400220000210102000000002423
+060003020100001414141424060113080201020b0b496d7072696d657242746e
+01020421212121212121211700099fff9e000100190000000d15150124012400
+010001030303030011010180800000000000000025269d01249d012400000000
+000001020027002500001c020909496d7072696d65720a102600001c02001027
+00010f000128280001120001801414290001081414009d01900f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e
+0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f0f0f0f
+0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e0000
+00000f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f00000000
+0000000000000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f
+0f0f0f000000000000000000000000000f0f000f0f0f0f000f0f0f0f0f0f0101
+010f0f000f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f0f0f00
+0000000000000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f
+000f0f0f0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f2900011000019d0100009d030000000080808080000080
+80000080000080800000808000808080400040400080ff0040804000ff804000
+ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ff
+ff8080ffff0080ff804000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000001206007c08000d001010
+4665726d65724f7574696c7347726964010104010f1011120101011700069fff
+9e000100160000000d9d07ef00017701770001000303030303000b0101606000
+00220000000000009d01779d017700000000000001082a1001ff810000000000
+000000020100000000040101009fff009fff00010100002b000004040000022c
+002a0000210102000000002c2b06000302010000141414142c06011308020102
+0a0a5175697474657242746e01020421212121212121211700079fff9e000100
+170000000d151501240124000100010303030300120101808000000000000000
+2d2e9d01249d01240000000000000102002f002d00001c020808517569747465
+720a102e00001c0200102f00010f000130300001120001801414310001081414
+009d01900707070707070707070707070707070707f807070707070707070700
+00000000000000fefef80707070707070707070000000000000000fefef80707
+07070707fefe0700f8f8f8f8f8f8fe0404f8070707070707fe0606fef8f8f8f8
+f8fe040404f8070707070707fe060606f8f8f8f8fe04040404f8070707060606
+06060606fefef8fe0404040404f8070707060606060606060000f8fe04040404
+04f807070706060606060606f8f8f8fe0404040404f8070707070707fe060600
+f8f8f8fe0404040404f8070707070707fe060000f8f8f8fe0404040404f80707
+07070707fe00f800f8f8f8fe0403040404f807070707070707f8f800f8f8f8fe
+0403040404f807070707070707f80700f8f8f8fe0404040404f8070707070707
+07070700f8f8f8fe0404040407f807070707070707070707070707fe04040407
+07f807070707070707070707070707fe04040407070707070707070707070707
+070707fe04040707070707070707070707070707070707fe0407070707070707
+07070707070707070707070707070707070707073100011000019d0100009d03
+00000000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff1306007c08000d009fff230104010f1011120101011700009fff9e0001001f
+0000000d9d0b3b3f00f0046f0001000403500303000b01016060000000000000
+0000009cf09d046f000000000000010832100100000000000000000000020100
+000000040102009fff009fff0001010000330000000404000000023400350032
+0000210202000000003435330600030201000000000000340600f60820890207
+074375724d6f646521020b212121212101010117000a0606537472696e679e00
+0100200000000d000000c6021e00010001030303030013010280a00000000000
+000000009cc69d021e00000000000001030201070007000009ff8100009e0040
+0014030100350600f6082089020606437572506f7321020b2121212121010101
+17000b0606537472696e679e000100210000000d9d02280000c6021e00010002
+030303030013010280a00000000000000000009cc69d021e0000000000000103
+0201070007000009ff8100009e004000140301000c0600030209000000000000
+0d06007c08000d000909436f72707347726964010104010f1011120101011700
+0c9fff9e000100140000000d009d01ab114111bd000200010303030300080404
+60600000220000000000009d11419d11bd000000000000010836100100000000
+000000000000020100000000040102009fff009fff2001010000370000000404
+0001000238003900360000210202000000003839370600030201000000000000
+3806007a08004d00060650616e656c30010104010f10111201010117000d9fff
+0e0000000d000011170fa00001000103050303000d040460600000220bb80fa0
+00009d11179d0fa000000000000001083a6001ff810000000000000000020100
+0000000900003a0000210102000000003b3b06007c08000d000c0c4469616c6f
+67756547726964020104010f10111201010117000e9fff9e0001001c0000000d
+9d03f29d07b10356072900000000030303030038010160600000000000000000
+009d03569d072900000000000001083c10010000000000000000000002010000
+0000040201009fff009fff20010100003d0000000404000000023e003f003c00
+00210202000000003e3f3d06000302020000000000003e060092082081029fff
+21210401212121212121212100009fff9e0001001d0000000d0000009c01f400
+01000103030303003b0101a0a00000000000000000009c9c9d01f40000000000
+000103010b40020100009e0044209400000000004000001c0209094469616c6f
+6775650a103f060084082009020b0b5374617475735f4c696e6502020c212121
+212101010117000f080854657874446174610d0000000d009ca7028607000002
+000103030303003b0204a0a00000440000001900009d02869d07000100000000
+000103020107001906000501040000ff81013906007c08000d000f0f42617272
+6544726f69746547726964010104010f1011120101011700109fff9e0001000c
+0000000d9d0faa00111701ea0001000203030303000d04016060000022000000
+0000009d11179d01ea0000000000000108411001ff8100000000000000000201
+00000000040201009fff009fff20010100004200000004040000000243004400
+4100002102020000000044434206000302070000141400004306007c08000d00
+0d0d4374694f7574696c7347726964010104010f1011120101011700169fff9e
+000100230000000d34150c740158000100010303030300390101606000000000
+00000000009d0c749d0158000000000000010845100100000000000000000000
+020100000000040901009fff009fff2001010000460000000000000000000004
+0400000000000000000000024700480049004a004b004c004d004e004f004500
+00210902000000004748494a4b4c4e4f4d46060003020100001e1e0000470601
+13080201020b0b446563726f63686542746e2202042121212121212121170017
+9fff9e000100240000000d001f01240124000100010303030300430101808000
+00000000000050519d01249d012400000000000001020052005000001c020a0a
+44e963726f636865720a105100001c0200105200010f00015353000112000180
+141454000104140a009cc8111111111111111111111111222222222222111111
+2200000000000022111220000000000000022122000022222222000022200002
+2111111220000220000211111111200002222222111111112222221111111111
+1111111111111112211111112211111111200222222200211111112000000000
+0021111112000020202000021111220000000000000221122000002020200000
+2122000000000000000022200000002020200000022000000000000000000212
+22222222222222222111111111111111111111540001100001030009ffff00c0
+c0c000000048060113080201020c0c52616363726f63686542746e2202042121
+2121212121211700189fff9e000100250000000d009d018c0124012400020001
+030303030043010180800000000000000055569d01249d012400000000000001
+020057005500001c020b0b52616363726f636865720a105600001c0200105700
+010f00015858000112000180141459000104140a009cc8000000003330000000
+0000111111333111111100012222223332222222100122222233322222221012
+2222223332222222211222211033300112222111111100333000111111122221
+0033300012222101111100333000111110000000003330000000000000033333
+3333000000000000333333300000000000000333330000000000000000333000
+0000000000000003000000000000001110000001110000000111111111111110
+0000122222222222221000012222222222222221004444444444444444444459
+000110000105000fc0c0c0000000ffff00ff0000ffffff49060113080201020a
+0a4c69626572657242746e22020421212121212121211700199fff9e00010026
+0000000d009d02f80143012e0003000103030303004301018080000000000000
+005a5b9d01439d012e0000000000000102005c005a00001c0206064c69627265
+0a105b00001c0200105c00010f00015d5d00011200018017155e000104160b00
+9cfd000000000000000000008100000000000000000002810000000000000000
+0022810000000000000000022281000000000000000002208100000000000000
+0022208100000000000000022200810000000000000022200081000000000000
+0022200081000000000000022200008102000000000022220000810220000000
+0222200000810222000000022200000081022220000022220000008102222200
+0222200000008102222220222220000000810022222222220000000081000222
+2222200000000081000022222220000000008100000222220000000000810000
+002222000000000081000000022000000000008100000000000000000000815e
+0001100001030009c0c0c000000000ff004a060113080201020a0a417474656e
+746542746e220204212121212121212117001a9fff9e000100270000000d009d
+0484011901240004000103030303004301018080000022000000005f609d0119
+9d012400000000000001020061005f00001c020808417474656e74650a106000
+001c0200106100010f00016262000112000180131463000104140a009cbe0000
+0000000000000000000000011100000000000000011122100000000000001221
+2211100000000000122122122100000000111221221221000000012212212212
+2100000001221221221221000000012212212212210000000122122122122100
+1100012222222222210122100122222222222112221001222222222222222100
+0122222222222222100001222222222222210000012222222222221000000012
+2222222221000000000122222222100000000000111111110000000063000110
+0001030009c0c0c0000000ffff004b060113080201020c0c5472616e73666572
+7442746e220204212121212121212117001b9fff9e000100280000000d009d05
+e60124012400050001030303030043010180800000000000000064659d01249d
+012400000000000001020066006400001c020b0b5472616e7366e97265720a10
+6500001c0200106600010f00016767000112000180141400000118143c009d04
+b0c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6000000ffff00ff
+ff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ff
+ff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff
+00ffff00ffff00ffff00000000000000ffff00ffff00000000000000000000c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000
+ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6
+c6c0c0c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ff
+ff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000
+c0c0c0c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000
+00000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6
+c6c6ff0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000
+ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff00
+00c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ff
+ff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff000000
+00c0c0c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6
+c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0
+c0c0c0c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0
+c0c0ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000
+ffff00ffff00000000000000ffff00ffff00000000000000000000c0c0c0ff00
+00c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ff
+ff00000000000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff000000
+00000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000
+ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ff
+ff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000ffff00ffff00000000c6c6c60000000000000000
+00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600
+0000000000000000000000000000c0c0c04c0601130802010208085061757365
+42746e220204212121212121212117001c9fff9e000100290000000d009d0753
+0124012400060001030303030043010180800000000000000068699d01249d01
+240000000000000102006a006800001c02060650617573650a106900001c0200
+106a00010f00016b6b000112000180141400000118143c009d04b0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c60000000000000000000000000000000000000000000000000000000000
+00000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00
+ffff00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00000000
+000000000000000000000000000000000000000000000000ffff00ffff00ffff
+00000000c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c600
+0000ffff00ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000
+c0c0c0c6c6c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00000000000000000000
+000000000000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff00
+0000ffff00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0
+c0c0c0000000ffff00ffff00ffff00000000ffffffffffffffffff000000ffff
+00ffff00ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c000000000
+00ff0000ff0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00
+ffff00ffff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000
+ff0000ff0000ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff
+0000ff0000ff0000ff000000000000000000000000000000000000000000c0c0
+c0c6c6c6c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff00
+00ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6
+c6c6c6c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000
+ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0
+c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0
+c00000ff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0
+0000ff0000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c000
+00ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c64d060113080201020e0e46696e456e726567697374
+726572230204212121212121212117001f9fff9e0001002c0000000d009d08c0
+012401240007000103030303004301018080000000000000006c6d9d01249d01
+240000000000000102006e006c00001c020c0c456e7265676973747265720a10
+6d00001c0200106e00010f00016f6f000112000180141470000104140a009cc8
+3311111111111111113333300000000000000333333311111111111133330333
+3000000000033330003333200044443333400003333000000333300000003333
+0000333300001000033334433334000110000433333333440001100004033333
+3044000110000440333304440001100004433333344400011000003333333300
+0001100113333003333110011011333300003333110110133330000003333101
+1033331000000133330113333100000000133331333300000000000033333331
+111111111111133170000110000105000f000000c0c0c000ffffff0000ffffff
+4e060113080201020b0b456e7265676973747265722202042121212121212121
+17001d9fff9e0001002a0000000d009d0a2c0124012400080001030303030043
+010180800000000000000071729d01249d012400000000000001020073007100
+001c020c0c456e7265676973747265720a107200001c0200107300010f000174
+74000112000180141475000104140a009cc81111111111111111111110000000
+0000000000011011111111111111110100000000000000000000003020200044
+4444444000000000000000000000000000000000000000001000044444444444
+0001100004404444044400011000040004400044000110000440444404440001
+1000044444444444000110000000000000000001100111000000001110011011
+1110000001111101101111100000011111011011111000000111110110011100
+0000001110011000000000000000000111111111111111111111750001100001
+05000f000000c0c0c000ffffff0000ffffff4f0600f608208902070745746174
+437469020204212121212101010117001e080854657874446174619e0001002b
+0000000d0a9d0b990092010f00090001030503030043010180a0000044000000
+007677929d010f020000000000010301053c00070005040009ff8100009e0040
+20140301007600001c0210104574617420636f6e7365696c6c65720a11770000
+1c0200104406007c08000d00111147656e6572616c4f7574696c734772696401
+0104010f1011120101011700119fff9e000100150000000d009d0cbc041c01c0
+00020001030303030039010160600000220000000000009d041c9d01c0000000
+0000000108781001ff810000000000000000020100000000040101009fff009f
+ff200101000079000004040000027a00780000210102000000007a7906000302
+010000141414147a06007c08000d0016165374616e646172644f7574696c7347
+72696456657274010104010f1011120101011700129fff9e0001002f0000000d
+151503c9016d00010001030303030044010160600000000000000000009d03c9
+9d016d00000000000001087b1001ff8100000000000000000201000000000403
+01009fff009fff00010100007c00000000040400000000027d007e007f007b00
+00210302000000007e7d7f7c06000302010000141414147d060113080201020a
+0a416a6f7574657242746e01220421212121212121211700149fff9e0001001b
+0000000d1515010f01190001000103030303007a010180800000000000000080
+819d010f9d011900000000000001020082008000001c0208084e6f7576656175
+0a108100001c0200108200010f00018383000112000180121384000108131300
+9d01560707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707040707070707070707070707070707070707070404070707070707
+0707040707070707070707040204070707070704070407040707070707070402
+0204070707070704040407070707070707040202020407070404040404040407
+0707070704020204070707070704040407070707070707040204070707070704
+0704070407070707070704040707070707070707040707070707070707040707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+070707070707070707070707070707070707070707070707078400011000019d
+0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dc
+c0a6caf000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff
+00ffffffffff7e060113080201020c0c5375707072696d657242746e01220421
+212121212121211700139fff9e0001001a0000000d1f9d015801040104000200
+0103030303007a010180800000000000000085869d01049d0104000000000000
+01020087008500001c020a0a5375707072696d65720a108600001c0200108700
+010f000188880001120001801111890001081111009d01210707070707070707
+0707070707070707070707070707070700000707070707070707070707070707
+0000ff0000070707070707070707070700ff00ff00ff00070707070707070707
+0700ff00ff00ff070707070707070707070700ff00ff07070701010707070707
+0707070707000707f80101f8f8070707000000f801010007f80101f8f8070707
+0700ffff00f8f801010101f8f800070707070700ffff0007f8010101f8ff0007
+070707070700ff07070101010101ff0007070707070700ff07f80101f8f80101
+000707070707070707070101f8f8ff0101f80707070707070707f80101f8ffff
+fff80107070707070707070101f8f80000000701f80707070707070701f8f807
+07070707f8f8070707070707070707070707070707070707078900011000019d
+0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dc
+c0a6caf000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff
+00ffffffffff7f06011308020102090953617576657242746e01020421212121
+212121211700159fff9e000100220000000d1f9d029000fa00fa000300010303
+0303007a01018080000000000000008a8b9cfa9cfa0000000000000102008c00
+8a00001c0207075361757665720a108b00001c0200108c00010f00018d8d0001
+1200018010108e0001081010009d010007070707070707070707070707070707
+0700000000000000000000000000000707000300070707070707070700070007
+0700030007070707070707070000000707000300070707070707070700030007
+0700030007070707070707070003000707000300070707070707070700030007
+0700030007070707070707070003000707000303000000000000000003030007
+0700030303030303030303030303000707000303000000000000000000030007
+0700030300000000000007070003000707000303000000000000070700030007
+0700030300000000000007070003000707070000000000000000000000000007
+070707070707070707070707070707078e00011000019d0100009d0300000000
+bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000000000ff
+fbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff060600
+5e08002e009fff03030303030303030303030300009fff0200000008009fff00
+0000000000000000000002018f018f000021040200000000909192939006005c
+08000e00040466696c6501030303030303030303030300209fff100000000806
+05052646696c6500000000000000000000000201940103ff0094000021020200
+00000095969506006a0800020205057072696e74030303020303030303030303
+00219fff1100000008909fff0000000000000000000000010200129606006a08
+0002020a0a7072696e74736574757003030302030303030303030300229fff12
+00000008909fff0000000000000000000000010200119106005c08000e000606
+416374696f6e01030303030303030303030300239fff15000000080607072641
+6374696f6e00000000000000000000000201970103ff00970000210102000000
+00989806006a0800020209094e657757696e646f770303030203030303030303
+0300249fff1600000008910b0b264e65772057696e646f770000000000000000
+00000001020eff9206005c08000e00040448656c700103030303030303030303
+0300259fff1700000008069fff00000000000000000000000201990103030099
+0000210002000000009306005c08000e00090943747874506f70557003030303
+030303030303030300269fff9e0001002d0000000806090943747874506f7055
+70000000029a00000000000002019b0103ff009a00001c0200109b0000210102
+000000009c9c9c9c06006a0800020007074974656d5473740303030203030303
+0303030300279fff9e0001002e000000089307074974656d547374000000039c
+9d000000000000010200ff9c9d00001c0200109c9d1a919c9c9cb89d01189d01
+239d01a19d01ad9d01b99d024b9d02599d02659d02f79d03039d030f9d036c9d
+037e9d03859d038c9d052f9d083c9d08999d08a99d08b09d08b79d0a5a9d0d67
+9d0df49d0dff9d0e0b9d0e679d0e789d0e7f9d0e869d10299d13369d13c19d13
+cc9d13d89d14339d14439d144a9d14519d15f49d19019d197f9d198b9d19979d
+1a059d1a749d1a809d1b089d1b149d1b209d1b869d1b919d1c1e9d1c2a9d1c36
+9d1c949d1ca59d1d129d1da09d1dac9d1db89d1e5e9d1e719d1e7d9d1ed99d1e
+eb9d1ef29d1ef99d1fd39d1fe59d20449d20579d205e9d20659d213f9d21579d
+21b49d21c29d21c99d21d09d22df9d22f19d234e9d235e9d23659d236c9d243c
+9d244e9d24ad9d24c09d24c79d24ce9d29919d29ec9d29fa9d2a019d2a089d2e
+cb9d2f2c9d2f409d2f479d2f4e9d30289d30409d309e9d30b29d30b99d30c09d
+319a9d31b29d32259d323d9d32449d32d09d32db9d32e79d337e9d338b9d3397
+9d33f29d34029d34099d34109d35799d38869d38e59d38f79d38fe9d39059d3a
+399d3d469d3da09d3daf9d3db69d3dbd9d3ed09d41dd9d420e9d421c9d42599d
+42659d429b9d42d69d43179d43229d43679d439f9d43a99d43f39d43fa9d4406
+9d444b9d44539d01a5191a38626377919b9c9c9ca09cb89cd69d01009d01019d
+01159d01189d01229d01239d01469d01709d01719d01859d019c9d01a19d01ab
+9d01ad9d01b99d01e89d02129d02139d02279d02429d024b9d02559d02599d02
+659d029c9d02c69d02c79d02db9d02f29d02f79d03019d03039d030f9d033d9d
+03679d03689d036c9d03709d037e9d03829d03859d03899d038c9d03969d052f
+9d083c9d08689d08949d08959d08999d089d9d08a99d08ad9d08b09d08b49d08
+b79d08c19d0a5a9d0d679d0d9b9d0dc79d0dc89d0ddc9d0df19d0df49d0dfe9d
+0dff9d0e0b9d0e389d0e629d0e639d0e679d0e6b9d0e789d0e7c9d0e7f9d0e83
+9d0e869d0e909d10299d13369d13689d13949d13959d13a99d13be9d13c19d13
+cb9d13cc9d13d89d14049d142e9d142f9d14339d14379d14439d14479d144a9d
+144e9d14519d145b9d15f49d19019d19239d194e9d194f9d19639d197a9d197f
+9d19899d198b9d19979d19c69d19ef9d19f09d19f39d19f89d1a059d1a339d1a
+5e9d1a5f9d1a629d1a679d1a749d1a809d1aab9d1ad79d1ad89d1aec9d1b039d
+1b089d1b129d1b149d1b209d1b449d1b6e9d1b6f9d1b839d1b869d1b909d1b91
+9d1bbf9d1bed9d1bee9d1c029d1c199d1c1e9d1c289d1c2a9d1c369d1c589d1c
+819d1c829d1c849d1c949d1c989d1ca59d1cd69d1d019d1d029d1d059d1d0a9d
+1d129d1d439d1d6f9d1d709d1d849d1d9b9d1da09d1daa9d1dac9d1db89d1de7
+9d1e119d1e129d1e269d1e4b9d1e5e9d1e689d1e719d1e7d9d1eaa9d1ed49d1e
+d59d1ed99d1edd9d1eeb9d1eef9d1ef29d1ef69d1ef99d1f039d1fd39d1fe59d
+20139d203f9d20409d20449d20489d20579d205b9d205e9d20629d20659d206f
+9d213f9d21579d21839d21af9d21b09d21b49d21b89d21c29d21c69d21c99d21
+cd9d21d09d21da9d22df9d22f19d231d9d23499d234a9d234e9d23529d235e9d
+23629d23659d23699d236c9d23769d243c9d244e9d247c9d24a89d24a99d24ad
+9d24b19d24c09d24c49d24c79d24cb9d24ce9d24d89d29919d29bb9d29e79d29
+e89d29ec9d29f09d29fa9d29fe9d2a019d2a059d2a089d2a129d2ecb9d2efb9d
+2f279d2f289d2f2c9d2f309d2f409d2f449d2f479d2f4b9d2f4e9d2f589d3028
+9d30409d306d9d30999d309a9d309e9d30a29d30b29d30b69d30b99d30bd9d30
+c09d30ca9d319a9d31b29d31e39d320d9d320e9d32139d32189d32259d32299d
+323d9d32419d32449d32779d32a39d32a49d32b89d32cd9d32d09d32da9d32db
+9d32e79d331f9d33499d334a9d335e9d33779d337e9d33889d338b9d33979d33
+c39d33ed9d33ee9d33f29d33f69d34029d34069d34099d340d9d34109d341a9d
+35799d38869d38b49d38e09d38e19d38e59d38e99d38f79d38fb9d38fe9d3902
+9d39059d390f9d3a399d3d469d3d719d3d9b9d3d9c9d3da09d3da49d3daf9d3d
+b39d3db69d3dba9d3dbd9d3dc79d3ed09d41dd9d41fb9d420a9d420b9d420d9d
+420e9d42189d421c9d423e9d42529d42539d42559d42569d42599d42639d4265
+9d42889d42979d42989d429b9d42c39d42d29d42d39d42d69d42fa9d43109d43
+119d43139d43149d43179d43219d43229d43499d43639d43649d43679d43899d
+43989d43999d439b9d439c9d439f9d43a99d43a99d43d49d43ec9d43ed9d43ef
+9d43f09d43f39d43f79d43fa9d44049d44069d44309d44479d44489d444b9d44
+509d44530301
-54382e3c


end class;

class DetailWin is mapped inherits from DataAccessBD.StandardDataWin

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+5151463100004b40000044819fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100000b000003001b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+0108076b01000000000000000000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d0000131511e7000000000303030300050404606000002203e8
+07d000009d13159d11e700000000000001080910010000000000000000000002
+0100000000040201009fff009fff20010100000a0000000404000100020b0c0d
+00090000210202000000000b0d0a06000302010000000000000b06007c08000d
+000d0d42617272654861757447726964010104010f1011120101011700029fff
+9e000100100000000d000001a111bd0001000103030303000801046060000022
+0000000000009d01a19d11bd00000000000001080e1001ff8100000000000000
+00020100000000040104009fff009fff20010100000f00000000000404000000
+00000210001100120013140e000021040200000000101113120f060003020900
+00000000001006007c08000d0015154465706c6163656d656e744f7574696c73
+47726964230104010f1011120101011700039fff9e000100130000000d000001
+7702cf0001000103030303000b010160600000000000000000009d01779d02cf
+0000000000000108151001ff810000000000000000020100000000040102009f
+ff009fff00010100001600000004040000000217001800150000210202000000
+00181716060003020100001414141417060113080201020c0c50726563656465
+6e7442746e01020421212121212121211700059fff9e000100110000000d1515
+01240124000100010303030300100101808000000000000000191a9d01249d01
+240000000000000102001b001900001c020a0a5072e963e964656e740a101a00
+001c0200101b00010f00011c1c00011200018014141d0001081414009d01900f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800
+010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f
+0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f
+0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f00
+00080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1d00011000019d0100009d030000000080
+80808000008080000080000080800000808000808080400040400080ff004080
+4000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff
+8000ff8080ffff8080ffff0080ff804000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000018060113
+080201020a0a53756976616e7442746e01020421212121212121211700049fff
+9e000100120000000d9d016d1501240124000100020303030300100101808000
+0000000000001e1f9d01249d012400000000000001020020001e00001c020808
+53756976616e740a101f00001c0200102000010f000121210001120001801414
+220001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f
+0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f
+0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f
+08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f
+0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f
+0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f220001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000001106007c08000d0012125374616e646172644f7574696c7347
+726964010104010f1011120101011700069fff9e000100180000000d9d037500
+017701770001000203030303000b010160600000000000000000009d01779d01
+770000000000000108231001ff81000000000000000002010000000004010500
+9fff009fff000101000024000000000000040400000000000002250000000000
+0000000023000021010200000000252406000302010000141414142506011308
+0201020b0b496d7072696d657242746e01020421212121212121211700079fff
+9e000100190000000d1515012401240001000103030303001101018080000000
+0000000026279d01249d012400000000000001020028002600001c020909496d
+7072696d65720a102700001c0200102800010f0001292900011200018014142a
+0001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0000000000000000
+000f0f0f0f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f00
+0e00000000000e000f0f0f0f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f0f0f0f
+0f0f0f0f0f0f000e00000000000e000000000f0f0f0f0f0f0f000e0e0e0e0e0e
+0e0e000f000f000f0f0f0f0f000000000000000000000f000f00000f0f0f0f00
+0f0f0f0f0f0f0f0f0f0f000f000f000f0f0f0f00000000000000000000000000
+0f0f000f0f0f0f000f0f0f0f0f0f0101010f0f000f000f0f0f0f0f000f0f0f0f
+0f0f1111110f0f0000000f0f0f0f0f000000000000000000000000000f000f0f
+0f0f0f0f000f0f0f0f0f0f0f0f0f000f000f0f0f0f0f0f0f0f00000000000000
+000000000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f2a00011000019d
+0100009d03000000008080808000008080000080000080800000808000808080
+400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff0000
+ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff8040000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000001206007c08000d0010104665726d65724f7574696c7347726964
+010104010f10111201010117000a9fff9e000100160000000d9d105100017701
+770001000303030303000b010160600000220000000000009d01779d01770000
+0000000001082b1001ff810000000000000000020100000000040101009fff00
+9fff00010100002c000004040000022d002b0000210102000000002d2c060003
+02010000141414142d060113080201020a0a5175697474657242746e01020421
+2121212121212117000b9fff9e000100170000000d1515012401240001000103
+030303001201018080000000000000002e2f9d01249d01240000000000000102
+0030002e00001c020808517569747465720a102f00001c0200103000010f0001
+31310001120001801414320001081414009d0190070707070707070707070707
+0707070707f80707070707070707070000000000000000fefef8070707070707
+0707070000000000000000fefef8070707070707fefe0700f8f8f8f8f8f8fe04
+04f8070707070707fe0606fef8f8f8f8f8fe040404f8070707070707fe060606
+f8f8f8f8fe04040404f807070706060606060606fefef8fe0404040404f80707
+07060606060606060000f8fe0404040404f807070706060606060606f8f8f8fe
+0404040404f8070707070707fe060600f8f8f8fe0404040404f8070707070707
+fe060000f8f8f8fe0404040404f8070707070707fe00f800f8f8f8fe04030404
+04f807070707070707f8f800f8f8f8fe0403040404f807070707070707f80700
+f8f8f8fe0404040404f807070707070707070700f8f8f8fe0404040407f80707
+0707070707070707070707fe0404040707f807070707070707070707070707fe
+04040407070707070707070707070707070707fe040407070707070707070707
+07070707070707fe040707070707070707070707070707070707070707070707
+070707073200011000019d0100009d0300000000800000008000808000000080
+800080008080c0c0c0c0dcc0a4c8f00000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000fffbf0a0a0a4808080ff000000
+ff00ffff000000ffff00ff00ffffffffff1306007c08000d009fff230104010f
+1011120101011700009fff9e0001001f0000000d9d0a8a3f00f0046f00010004
+03500303000b010160600000000000000000009cf09d046f0000000000000108
+33100100000000000000000000020100000000040102009fff009fff00010100
+0034000000040400000002350036003300002102020000000036353406000302
+01000000000000350600f60820890207074375724d6f646521020b2121212121
+0101011700090606537472696e679e000100200000000d000000c6021e000100
+01030303030013010280a00000000000000000009cc69d021e00000000000001
+030201070007000009ff8100009e00400014030100360600f608208902060643
+7572506f7321020b21212121210101011700080606537472696e679e00010021
+0000000d9d02280000c6021e00010002030303030013010280a0000000000000
+0000009cc69d021e00000000000001030201070007000009ff8100009e004000
+140301001406000302080000000000000c06000302090000000000000d06007c
+08000d000909436f72707347726964010104010f10111201010117000c9fff9e
+000100140000000d009d01ab114111bd00020001030303030008040460600000
+220000000000009d11419d11bd00000000000001083710010000000000000000
+0000020100000000040102009fff009fff200101000038000000040400010002
+39003a3b370000210202000000003a393806000302010000000000003906007a
+08004d00060650616e656c30010104010f10111201010117001d9fff0e000000
+0d000011170fa00001000103050303000d040460600000220bb80fa000009d11
+179d0fa000000000000001083c6301ff81000000000000000002010000000009
+00003c0000210102000000003d3d06007c08000d000c0c4469616c6f67756547
+726964020104010f10111201010117001e9fff9e0001001c0000000d9d03f29d
+07b10356072900000000030303030039010160600000000000000000009d0356
+9d072900000000000001083e1001000000000000000000000201000000000402
+01009fff009fff20010100003f000000040400000002400041003e0000210202
+0000000041403f060003020200000000000040060092082081029fff21210401
+212121212121212100009fff9e0001001d0000000d0000009c01f40001000103
+030303003d0101a0a00000000000000000009c9c9d01f4000000000000010301
+0b42020100009e0044209400000000004200001c0209094469616c6f6775650a
+1041060084082009020b0b5374617475735f4c696e6502020c21212121210101
+0117001f080854657874446174610d0000000d009ca702860700000200010303
+0303003d0204a0a00000440000001900009d02869d0700010000000000010302
+0107001900000501040000ff81013a06007c08000d000f0f426172726544726f
+69746547726964010104010f10111201010117000d9fff9e0001000c0000000d
+9d0faa00111701ea0001000203030303000d040160600000220000000000009d
+11179d01ea0000000000000108431001ff810000000000000000020100000000
+040201009fff009fff2001010000440000000404000000024500460043000021
+02020000000046454406000302070000141400004506007c08000d000d0d4374
+694f7574696c7347726964010104010f1011120101011700139fff9e00010023
+0000000d5e000c7401580001000103030303003a010160600000000000000000
+009d0c749d015800000000000001084710010000000000000000000002010000
+0000040901009fff009fff200101000048000000000000000000000404000000
+000000000000000249004a004b004c004d004e004f0050005100470000210902
+000000004f51504e4d4c4b4a4948060003020100001e1e000049060113080201
+020b0b446563726f63686542746e220204212121212121212117001c9fff9e00
+0100240000000d001f0124012400010001030303030045010180800000000000
+000052539d01249d012400000000000001020054005200001c020a0a44e96372
+6f636865720a105300001c0200105400010f0001555500011200018014145600
+0104140a009cc811111111111111111111111122222222222211111122000000
+0000002211122000000000000002212200002222222200002220000221111112
+2000022000021111111120000222222211111111222222111111111111111111
+1111111221111111221111111120022222220021111111200000000000211111
+1200002020200002111122000000000000022112200000202020000021220000
+0000000000002220000000202020000002200000000000000000021222222222
+222222222111111111111111111111560001100001030009ffff00c0c0c00000
+004a060113080201020c0c52616363726f63686542746e220204212121212121
+212117001b9fff9e000100250000000d009d0162012401240002000103030303
+0045010180800000000000000057589d01249d01240000000000000102005900
+5700001c020b0b52616363726f636865720a105800001c0200105900010f0001
+5a5a00011200018014145b000104140a009cc800000000333000000000001111
+1133311111110001222222333222222210012222223332222222101222222233
+3222222221122221103330011222211111110033300011111112222100333000
+1222210111110033300011111000000000333000000000000003333333330000
+0000000033333330000000000000033333000000000000000033300000000000
+0000000300000000000000111000000111000000011111111111111000001222
+2222222222100001222222222222222100444444444444444444445b00011000
+0105000fc0c0c0000000ffff00ff0000ffffff4b060113080201020a0a4c6962
+6572657242746e220204212121212121212117001a9fff9e000100260000000d
+009d02a50143012e0003000103030303004501018080000000000000005c5d9d
+01439d012e0000000000000102005e005c00001c0206064c696272650a105d00
+001c0200105e00010f00015f5f000112000180171560000104160b009cfd0000
+0000000000000000810000000000000000000281000000000000000000228100
+0000000000000002228100000000000000000220810000000000000000222081
+0000000000000002220081000000000000002220008100000000000000222000
+8100000000000002220000810200000000002222000081022000000002222000
+0081022200000002220000008102222000002222000000810222220002222000
+0000810222222022222000000081002222222222000000008100022222222000
+0000008100002222222000000000810000022222000000000081000000222200
+0000000081000000022000000000008100000000000000000000816000011000
+01030009c0c0c000000000ff004c060113080201020a0a417474656e74654274
+6e22020421212121212121211700199fff9e000100270000000d009d04070119
+012400040001030303030045010180800000220000000061629d01199d012400
+000000000001020063006100001c020808417474656e74650a106200001c0200
+106300010f00016464000112000180131465000104140a009cbe000000000000
+0000000000000001110000000000000001112210000000000000122122111000
+0000000012212212210000000011122122122100000001221221221221000000
+0122122122122100000001221221221221000000012212212212210011000122
+2222222221012210012222222222211222100122222222222222210001222222
+2222222210000122222222222221000001222222222222100000001222222222
+2100000000012222222210000000000011111111000000006500011000010300
+09c0c0c0000000ffff004d060113080201020c0c5472616e736665727442746e
+22020421212121212121211700189fff9e000100280000000d009d0540012401
+2400050001030303030045010180800000000000000066679d01249d01240000
+0000000001020068006600001c020b0b5472616e7366e97265720a106700001c
+0200106800010f00016969000112000180141400000118143c009d04b0c6c6c6
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6000000000000000000000000000000c6c6c6000000ffff00ffff00ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ff
+ff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff
+00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00ffff0000
+0000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff00ffff00
+ffff00ffff00000000000000ffff00ffff00000000000000000000c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000ffff00ff
+ff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6c0c0c0
+c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000
+00000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000c0c0c0c6
+c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000
+ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6c6c6ff00
+00c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ff
+ff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff0000c0c0c0
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff000000
+00c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0
+c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c6
+c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0c0000000
+ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0c0c0ff00
+00c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000ffff00ff
+ff00000000000000ffff00ffff00000000000000000000c0c0c0ff0000c0c0c0
+c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ffff000000
+00000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000
+ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ff
+ff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000ffff00ffff00000000000000ffff00ffff000000
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ff
+ff00ffff00000000ffff00ffff00000000c6c6c6000000000000000000000000
+000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c60000000000
+00000000000000000000c0c0c04e060113080201020808506175736542746e22
+020421212121212121211700179fff9e000100290000000d009d068301240124
+0006000103030303004501018080000000000000006a6b9d01249d0124000000
+0000000102006c006a00001c02060650617573650a106b00001c0200106c0001
+0f00016d6d000112000180141400000118143c009d04b0c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff0000
+0000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00
+ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff000000
+00c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff0000000000000000
+0000000000000000000000000000000000000000ffff00ffff00ffff00000000
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c6000000ffff
+00ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000c0c0c0c6
+c6c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff00ffff00
+ffff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff0000000000000000000000000000
+0000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6
+c6c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff000000ffff
+00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c0c0c000
+0000ffff00ffff00ffff00000000ffffffffffffffffff000000ffff00ffff00
+ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c00000000000ff0000
+ff0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00ffff00ff
+ff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000ff
+0000ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ffff000000
+00c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff0000ff00
+00ff0000ff000000000000000000000000000000000000000000c0c0c0c6c6c6
+c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff0000ff0000
+ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c0
+c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c00000
+ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c00000ff
+80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff00
+00ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c00000ff0000
+ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c64f060113080201020e0e46696e456e72656769737472657223
+020421212121212121211700149fff9e0001002c0000000d009d07c601240124
+0007000103030303004501018080000000000000006e6f9d01249d0124000000
+00000001020070006e00001c020c0c456e7265676973747265720a106f00001c
+0200107000010f00017171000112000180141472000104140a009cc833111111
+1111111111333330000000000000033333331111111111113333033330000000
+0003333000333320004444333340000333300000033330000000333300003333
+0000100003333443333400011000043333333344000110000403333330440001
+1000044033330444000110000443333334440001100000333333330000011001
+1333300333311001101133330000333311011013333000000333310110333310
+0000013333011333310000000013333133330000000000003333333111111111
+1111133172000110000105000f000000c0c0c000ffffff0000ffffff50060113
+080201020b0b456e72656769737472657222020421212121212121211700169f
+ff9e0001002a0000000d009d0909012401240008000103030303004501018080
+0000000000000073749d01249d012400000000000001020075007300001c020c
+0c456e7265676973747265720a107400001c0200107500010f00017676000112
+000180141477000104140a009cc8111111111111111111111000000000000000
+0001101111111111111111010000000000000000000000302020004444444440
+0000000000000000000000000000000000000000100004444444444400011000
+0440444404440001100004000440004400011000044044440444000110000444
+4444444400011000000000000000000110011100000000111001101111100000
+0111110110111110000001111101101111100000011111011001110000000011
+1001100000000000000000011111111111111111111177000110000105000f00
+0000c0c0c000ffffff0000ffffff510600f60820890207074574617443746902
+02042121212121010101170015080854657874446174619e0001002b0000000d
+0a9d0a4b0092010f00090001030503030045010180a000004400000000787992
+9d010f020000000000010301053c00070005040009ff8100009e004020140301
+007800001c0210104574617420636f6e7365696c6c65720a117900001c020010
+4606007c08000d00111147656e6572616c4f7574696c7347726964010104010f
+10111201010117000e9fff9e000100150000000d009d099a041c01c000020001
+03030303003a010160600000220000000000009d041c9d01c000000000000001
+087a1001ff810000000000000000020100000000040101009fff009fff200101
+00007b000004040000027c007a0000210102000000007c7b0600030201000014
+1414147c06007c08000d0016165374616e646172644f7574696c734772696456
+657274010104010f10111201010117000f9fff9e0001002f0000000d151503c9
+016d00010001030303030046010160600000000000000000009d03c99d016d00
+000000000001087d1001ff810000000000000000020100000000040301009fff
+009fff00010100007e00000000040400000000027f00800081007d0000210302
+000000007f80817e06000302010000141414147f060113080201020a0a416a6f
+7574657242746e01220421212121212121211700109fff9e0001001b0000000d
+9d03de1f010f01190001000103030303007c010180800000000000000082839d
+010f9d011900000000000001020084008200001c0208084e6f75766561750a10
+8300001c0200108400010f000185850001120001801213860001081313009d01
+5607070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070407070707070707070707070707070707070704040707070707070707
+0407070707070707070402040707070707040704070407070707070704020204
+0707070707040404070707070707070402020204070704040404040404070707
+0707040202040707070707040404070707070707070402040707070707040704
+0704070707070707040407070707070707070407070707070707070407070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+07070707070707070707070707070707070707070707078600011000019d0100
+009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6
+caf0000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ff
+ffffffff80060113080201020c0c5375707072696d657242746e012204212121
+21212121211700119fff9e0001001a0000000d9d052b1f010401040002000103
+030303007c010180800000000000000087889d01049d01040000000000000102
+0089008700001c020a0a5375707072696d65720a108800001c0200108900010f
+00018a8a00011200018011118b0001081111009d012107070707070707070707
+0707070707070707070707070707000007070707070707070707070707070000
+ff0000070707070707070707070700ff00ff00ff000707070707070707070700
+ff00ff00ff070707070707070707070700ff00ff070707010107070707070707
+070707000707f80101f8f8070707000000f801010007f80101f8f80707070700
+ffff00f8f801010101f8f800070707070700ffff0007f8010101f8ff00070707
+07070700ff07070101010101ff0007070707070700ff07f80101f8f801010007
+07070707070707070101f8f8ff0101f80707070707070707f80101f8fffffff8
+0107070707070707070101f8f80000000701f80707070707070701f8f8070707
+0707f8f8070707070707070707070707070707070707078b00011000019d0100
+009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6
+caf0000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ff
+ffffffff8106011308020102090953617576657242746e010204212121212121
+21211700129fff9e000100220000000d9d016d2a00fa00fa0003000103030303
+007c01018080000000000000008c8d9cfa9cfa0000000000000102008e008c00
+001c0207075361757665720a108d00001c0200108e00010f00018f8f00011200
+01801010900001081010009d0100070707070707070707070707070707070700
+0000000000000000000000000007070003000707070707070707000700070700
+0300070707070707070700000007070003000707070707070707000300070700
+0300070707070707070700030007070003000707070707070707000300070700
+0300070707070707070700030007070003030000000000000000030300070700
+0303030303030303030303030007070003030000000000000000000300070700
+0303000000000000070700030007070003030000000000000707000300070700
+0303000000000000070700030007070700000000000000000000000000070707
+07070707070707070707070707079000011000019d0100009d0300000000bf00
+0000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000fffbf0
+a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff3b06000302
+070000000000000606005e08002e009fff03030303030303030303030300009f
+ff0200000008009fff0000000000000000000000020191019100002104020000
+0000929394959206005c08000e00040466696c65010303030303030303030303
+00209fff10000000080605052646696c65000000000000000000000002019601
+03ff009600002102020000000097989706006a0800020205057072696e740303
+0302030303030303030300219fff1100000008929fff00000000000000000000
+00010200129806006a080002020a0a7072696e74736574757003030302030303
+030303030300229fff1200000008929fff000000000000000000000001020011
+9306005c08000e000606416374696f6e01030303030303030303030300239fff
+150000000806070726416374696f6e00000000000000000000000201990103ff
+00990000210102000000009a9a06006a0800020209094e657757696e646f7703
+030302030303030303030300249fff1600000008930b0b264e65772057696e64
+6f77000000000000000000000001020eff9406005c08000e00040448656c7001
+030303030303030303030300259fff1700000008069fff000000000000000000
+000002019b010303009b0000210002000000009506005c08000e000909437478
+74506f70557003030303030303030303030300269fff9e0001002d0000000806
+090943747874506f705570000000029c9c00000000000002019c9d0103ff009c
+9c00001c0200109c9d0000210102000000009c9e9c9e06006a08000202070749
+74656d54737403030302030303030303030300279fff9e0001002e0000000895
+07074974656d547374000000039c9f000000000000010200ff9c9f00001c0200
+109c9f1a919c9c9cb89d01189d01239d01a19d01ad9d01b99d024b9d02599d02
+659d02f79d03039d030f9d036c9d037e9d03859d038c9d052f9d083c9d08999d
+08a99d08b09d08b79d0a5a9d0d679d0e049d0e0f9d0e1b9d0e779d0e889d0e8f
+9d0e969d10399d13469d13d19d13dc9d13e89d14439d14539d145a9d14619d16
+049d19119d198f9d199b9d19a79d1a159d1a849d1a909d1a9c9d1b249d1b309d
+1b3c9d1ba29d1bad9d1c3a9d1c469d1c529d1cb09d1cc19d1d2e9d1dbc9d1dc8
+9d1dd49d1e7a9d1e8d9d1e999d1ef59d1f079d1f0e9d1f159d1fef9d20019d20
+609d20739d207a9d20819d215b9d21739d21d09d21de9d21e59d21ec9d22fb9d
+230d9d236a9d237a9d23819d23889d24589d246a9d24c99d24dc9d24e39d24ea
+9d29ad9d2a089d2a169d2a1d9d2a249d2ee79d2f489d2f5c9d2f639d2f6a9d30
+449d305c9d30ba9d30ce9d30d59d30dc9d31b69d31ce9d32419d32599d32609d
+32ec9d32f79d33039d339a9d33a79d33b39d34109d34209d34279d342e9d3597
+9d38a49d39039d39159d391c9d39239d3a579d3d649d3dbe9d3dcd9d3dd49d3d
+db9d3eee9d41fb9d42079d42389d42469d42839d428f9d42c59d43009d43419d
+434c9d43919d43c99d43d39d441f9d44279d44349d44799d44819d01a7191a38
+626377919b9c9c9ca09cb89cd69d01009d01019d01159d01189d01229d01239d
+01469d01709d01719d01859d019c9d01a19d01ab9d01ad9d01b99d01e89d0212
+9d02139d02279d02429d024b9d02559d02599d02659d029c9d02c69d02c79d02
+db9d02f29d02f79d03019d03039d030f9d033d9d03679d03689d036c9d03709d
+037e9d03829d03859d03899d038c9d03969d052f9d083c9d08689d08949d0895
+9d08999d089d9d08a99d08ad9d08b09d08b49d08b79d08c19d0a5a9d0d679d0d
+9b9d0dc79d0dc89d0ddc9d0df99d0e049d0e0e9d0e0f9d0e1b9d0e489d0e729d
+0e739d0e779d0e7b9d0e889d0e8c9d0e8f9d0e939d0e969d0ea09d10399d1346
+9d13789d13a49d13a59d13b99d13ce9d13d19d13db9d13dc9d13e89d14149d14
+3e9d143f9d14439d14479d14539d14579d145a9d145e9d14619d146b9d16049d
+19119d19339d195e9d195f9d19739d198a9d198f9d19999d199b9d19a79d19d6
+9d19ff9d1a009d1a039d1a089d1a159d1a439d1a6e9d1a6f9d1a729d1a779d1a
+849d1a909d1a9c9d1ac79d1af39d1af49d1b089d1b1f9d1b249d1b2e9d1b309d
+1b3c9d1b609d1b8a9d1b8b9d1b9f9d1ba29d1bac9d1bad9d1bdb9d1c099d1c0a
+9d1c1e9d1c359d1c3a9d1c449d1c469d1c529d1c749d1c9d9d1c9e9d1ca09d1c
+b09d1cb49d1cc19d1cf29d1d1d9d1d1e9d1d219d1d269d1d2e9d1d5f9d1d8b9d
+1d8c9d1da09d1db79d1dbc9d1dc69d1dc89d1dd49d1e039d1e2d9d1e2e9d1e42
+9d1e679d1e7a9d1e849d1e8d9d1e999d1ec69d1ef09d1ef19d1ef59d1ef99d1f
+079d1f0b9d1f0e9d1f129d1f159d1f1f9d1fef9d20019d202f9d205b9d205c9d
+20609d20649d20739d20779d207a9d207e9d20819d208b9d215b9d21739d219f
+9d21cb9d21cc9d21d09d21d49d21de9d21e29d21e59d21e99d21ec9d21f69d22
+fb9d230d9d23399d23659d23669d236a9d236e9d237a9d237e9d23819d23859d
+23889d23929d24589d246a9d24989d24c49d24c59d24c99d24cd9d24dc9d24e0
+9d24e39d24e79d24ea9d24f49d29ad9d29d79d2a039d2a049d2a089d2a0c9d2a
+169d2a1a9d2a1d9d2a219d2a249d2a2e9d2ee79d2f179d2f439d2f449d2f489d
+2f4c9d2f5c9d2f609d2f639d2f679d2f6a9d2f749d30449d305c9d30899d30b5
+9d30b69d30ba9d30be9d30ce9d30d29d30d59d30d99d30dc9d30e69d31b69d31
+ce9d31ff9d32299d322a9d322f9d32349d32419d32459d32599d325d9d32609d
+32939d32bf9d32c09d32d49d32e99d32ec9d32f69d32f79d33039d333b9d3365
+9d33669d337a9d33939d339a9d33a49d33a79d33b39d33df9d340b9d340c9d34
+109d34149d34209d34249d34279d342b9d342e9d34389d35979d38a49d38d29d
+38fe9d38ff9d39039d39079d39159d39199d391c9d39209d39239d392d9d3a57
+9d3d649d3d8f9d3db99d3dba9d3dbe9d3dc29d3dcd9d3dd19d3dd49d3dd89d3d
+db9d3de59d3eee9d41fb9d42079d42259d42349d42359d42379d42389d42429d
+42469d42689d427c9d427d9d427f9d42809d42839d428d9d428f9d42b29d42c1
+9d42c29d42c59d42ed9d42fc9d42fd9d43009d43249d433a9d433b9d433d9d43
+3e9d43419d434b9d434c9d43739d438d9d438e9d43919d43b39d43c29d43c39d
+43c59d43c69d43c99d43d39d43d39d43fe9d44179d44189d441b9d441c9d441f
+9d44249d44279d44329d44349d445e9d44759d44769d44799d447e9d44810301
-5545ad6c


end class;

class MainWin is mapped inherits from DataAccessBD.StandardDataWin

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+5151463100004b44000044859fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100000b000003001b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+0108076b01000000000000000000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d0000131511e7000000000303030300050404606000002203e8
+07d000009d13159d11e700000000000001080910010000000000000000000002
+0100000000040301009fff009fff20010100000a00000000040400010000020b
+0c0d000000090000210202000000000b0d0a06000302010000000000000b0600
+7c08000d000d0d42617272654861757447726964010104010f10111201010117
+00029fff9e000100100000000d000001a111bd00010001030303030008010460
+600000220000000000009d01a19d11bd00000000000001080e1001ff81000000
+0000000000020100000000040104009fff009fff20010100000f000000000004
+0400000000000210001100120013140e000021040200000000101113120f0600
+0302090000000000001006007c08000d0015154465706c6163656d656e744f75
+74696c7347726964230104010f1011120101011700039fff9e00010013000000
+0d0000017702cf0001000103030303000b010160600000000000000000009d01
+779d02cf0000000000000108151001ff81000000000000000002010000000004
+0102009fff009fff000101000016000000040400000002170018001500002102
+0200000000181716060003020100001414141417060113080201020c0c507265
+636564656e7442746e01020421212121212121211700059fff9e000100110000
+000d151501240124000100010303030300100101808000000000000000191a9d
+01249d01240000000000000102001b001900001c020a0a5072e963e964656e74
+0a101a00001c0200101b00010f00011c1c00011200018014141d000108141400
+9d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f
+0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f
+0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f
+0800010f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f
+0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f000008
+0f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f
+0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1d00011000019d0100009d0300
+0000008080808000008080000080000080800000808000808080400040400080
+ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff
+00ffffff8000ff8080ffff8080ffff0080ff8040000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+18060113080201020a0a53756976616e7442746e010204212121212121212117
+00049fff9e000100120000000d9d016d15012401240001000203030303001001
+018080000000000000001e1f9d01249d012400000000000001020020001e0000
+1c02080853756976616e740a101f00001c0200102000010f0001212100011200
+01801414220001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f
+0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f
+0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f
+0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08
+000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f
+0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f080000
+0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00
+000f0f0f00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f2200
+011000019d0100009d0300000000808080800000808000008000008080000080
+8000808080400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff
+0000ff0000ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff804000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000001106007c08000d0012125374616e646172644f7574
+696c7347726964010104010f1011120101011700069fff9e000100180000000d
+9d037500017701770001000203030303000b010160600000000000000000009d
+01779d01770000000000000108231001ff810000000000000000020100000000
+040105009fff009fff0001010000240000000000000404000000000000022500
+0000000000000000230000210102000000002524060003020100001414141425
+060113080201020b0b496d7072696d657242746e010204212121212121212117
+00079fff9e000100190000000d15150124012400010001030303030011010180
+800000000000000026279d01249d012400000000000001020028002600001c02
+0909496d7072696d65720a102700001c0200102800010f000129290001120001
+8014142a0001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00000000
+00000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f
+0f0f0f000e00000000000e000f0f0f0f0f0f0f0f0f0f000e0e0e0e0e0e0e0e00
+0f0f0f0f0f0f0f0f0f0f000e00000000000e000000000f0f0f0f0f0f0f000e0e
+0e0e0e0e0e0e000f000f000f0f0f0f0f000000000000000000000f000f00000f
+0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f0f0f0f000000000000000000
+000000000f0f000f0f0f0f000f0f0f0f0f0f0101010f0f000f000f0f0f0f0f00
+0f0f0f0f0f0f1111110f0f0000000f0f0f0f0f00000000000000000000000000
+0f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f000f0f0f0f0f0f0f0f000000
+00000000000000000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f2a0001
+1000019d0100009d030000000080808080000080800000800000808000008080
+00808080400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff00
+00ff0000ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000001206007c08000d0010104665726d65724f7574696c73
+47726964010104010f10111201010117000a9fff9e000100160000000d9d1051
+00017701770001000303030303000b010160600000220000000000009d01779d
+017700000000000001082b1001ff810000000000000000020100000000040101
+009fff009fff00010100002c000004040000022d002b0000210102000000002d
+2c06000302010000141414142d060113080201020a0a5175697474657242746e
+010204212121212121212117000b9fff9e000100170000000d15150124012400
+01000103030303001201018080000000000000002e2f9d01249d012400000000
+000001020030002e00001c020808517569747465720a102f00001c0200103000
+010f000131310001120001801414320001081414009d01900707070707070707
+070707070707070707f80707070707070707070000000000000000fefef80707
+070707070707070000000000000000fefef8070707070707fefe0700f8f8f8f8
+f8f8fe0404f8070707070707fe0606fef8f8f8f8f8fe040404f8070707070707
+fe060606f8f8f8f8fe04040404f807070706060606060606fefef8fe04040404
+04f8070707060606060606060000f8fe0404040404f807070706060606060606
+f8f8f8fe0404040404f8070707070707fe060600f8f8f8fe0404040404f80707
+07070707fe060000f8f8f8fe0404040404f8070707070707fe00f800f8f8f8fe
+0403040404f807070707070707f8f800f8f8f8fe0403040404f8070707070707
+07f80700f8f8f8fe0404040404f807070707070707070700f8f8f8fe04040404
+07f807070707070707070707070707fe0404040707f807070707070707070707
+070707fe04040407070707070707070707070707070707fe0404070707070707
+0707070707070707070707fe0407070707070707070707070707070707070707
+07070707070707073200011000019d0100009d03000000008000000080008080
+00000080800080008080c0c0c0c0dcc0a4c8f000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000fffbf0a0a0a4808080
+ff000000ff00ffff000000ffff00ff00ffffffffff1306007c08000d009fff23
+0104010f1011120101011700009fff9e0001001f0000000d9d0a8a3f00f0046f
+0001000403500303000b010160600000000000000000009cf09d046f00000000
+0000010833100100000000000000000000020100000000040102009fff009fff
+0001010000340000000404000000023500360033000021020200000000363534
+0600030201000000000000350600f60820890207074375724d6f646521020b21
+212121210101011700090606537472696e679e000100200000000d000000c602
+1e00010001030303030013010280a00000000000000000009cc69d021e000000
+00000001030201070007000009ff8100009e00400014030100360600f6082089
+020606437572506f7321020b21212121210101011700080606537472696e679e
+000100210000000d9d02280000c6021e00010002030303030013010280a00000
+000000000000009cc69d021e00000000000001030201070007000009ff810000
+9e004000140301001406000302080000000000000c0600030209000000000000
+0d06007c08000d000909436f72707347726964010104010f1011120101011700
+0c9fff9e000100140000000d009d01ab114111bd000200010303030300080404
+60600000220000000000009d11419d11bd000000000000010837100100000000
+000000000000020100000000040102009fff009fff2001010000380000000404
+0001000239003a3b370000210202000000003a39380600030201000000000000
+3906007a08004d00060650616e656c30010104010f10111201010117001d9fff
+0e0000000d000011170fa00001000103050303000d040460600000220bb80fa0
+00009d11179d0fa000000000000001083c6301ff810000000000000000020100
+0000000900003c0000210102000000003d3d06007c08000d000c0c4469616c6f
+67756547726964020104010f10111201010117001e9fff9e0001001c0000000d
+9d03f29d07b10356072900000000030303030039010160600000000000000000
+009d03569d072900000000000001083e10010000000000000000000002010000
+0000040201009fff009fff20010100003f000000040400000002400041003e00
+002102020000000040413f060003020200000000000040060092082081029fff
+21210401212121212121212100009fff9e0001001d0000000d0000009c01f400
+01000103030303003d0101a0a00000000000000000009c9c9d01f40000000000
+000103010b42020100009e0044209400000000004200001c0209094469616c6f
+6775650a1041060084082009020b0b5374617475735f4c696e6502020c212121
+212101010117001f080854657874446174610d0000000d009ca7028607000002
+000103030303003d0204a0a00000440000001900009d02869d07000100000000
+000103020107001900000501040000ff81013a06007c08000d000f0f42617272
+6544726f69746547726964010104010f10111201010117000d9fff9e0001000c
+0000000d9d0faa00111701ea0001000203030303000d04016060000022000000
+0000009d11179d01ea0000000000000108431001ff8100000000000000000201
+00000000040201009fff009fff20010100004400000004040000000245004600
+4300002102020000000046454406000302070000141400004506007c08000d00
+0d0d4374694f7574696c7347726964010104010f1011120101011700139fff9e
+000100230000000d5e000c7401580001000103030303003a0101606000000000
+00000000009d0c749d0158000000000000010847100100000000000000000000
+020100000000040901009fff009fff2001010000480000000000000000000004
+04000000000000000000000249004a004b004c004d004e004f00500051004700
+00210902000000004f51504e4d4c4b4a4948060003020100001e1e0000490601
+13080201020b0b446563726f63686542746e220204212121212121212117001c
+9fff9e000100240000000d001f01240124000100010303030300450101808000
+00000000000052539d01249d012400000000000001020054005200001c020a0a
+44e963726f636865720a105300001c0200105400010f00015555000112000180
+141456000104140a009cc8111111111111111111111111222222222222111111
+2200000000000022111220000000000000022122000022222222000022200002
+2111111220000220000211111111200002222222111111112222221111111111
+1111111111111112211111112211111111200222222200211111112000000000
+0021111112000020202000021111220000000000000221122000002020200000
+2122000000000000000022200000002020200000022000000000000000000212
+22222222222222222111111111111111111111560001100001030009ffff00c0
+c0c00000004a060113080201020c0c52616363726f63686542746e2202042121
+21212121212117001b9fff9e000100250000000d009d01620124012400020001
+030303030045010180800000000000000057589d01249d012400000000000001
+020059005700001c020b0b52616363726f636865720a105800001c0200105900
+010f00015a5a00011200018014145b000104140a009cc8000000003330000000
+0000111111333111111100012222223332222222100122222233322222221012
+2222223332222222211222211033300112222111111100333000111111122221
+0033300012222101111100333000111110000000003330000000000000033333
+3333000000000000333333300000000000000333330000000000000000333000
+0000000000000003000000000000001110000001110000000111111111111110
+000012222222222222100001222222222222222100444444444444444444445b
+000110000105000fc0c0c0000000ffff00ff0000ffffff4b060113080201020a
+0a4c69626572657242746e220204212121212121212117001a9fff9e00010026
+0000000d009d02a50143012e0003000103030303004501018080000000000000
+005c5d9d01439d012e0000000000000102005e005c00001c0206064c69627265
+0a105d00001c0200105e00010f00015f5f000112000180171560000104160b00
+9cfd000000000000000000008100000000000000000002810000000000000000
+0022810000000000000000022281000000000000000002208100000000000000
+0022208100000000000000022200810000000000000022200081000000000000
+0022200081000000000000022200008102000000000022220000810220000000
+0222200000810222000000022200000081022220000022220000008102222200
+0222200000008102222220222220000000810022222222220000000081000222
+2222200000000081000022222220000000008100000222220000000000810000
+0022220000000000810000000220000000000081000000000000000000008160
+0001100001030009c0c0c000000000ff004c060113080201020a0a417474656e
+746542746e22020421212121212121211700199fff9e000100270000000d009d
+04070119012400040001030303030045010180800000220000000061629d0119
+9d012400000000000001020063006100001c020808417474656e74650a106200
+001c0200106300010f00016464000112000180131465000104140a009cbe0000
+0000000000000000000000011100000000000000011122100000000000001221
+2211100000000000122122122100000000111221221221000000012212212212
+2100000001221221221221000000012212212212210000000122122122122100
+1100012222222222210122100122222222222112221001222222222222222100
+0122222222222222100001222222222222210000012222222222221000000012
+2222222221000000000122222222100000000000111111110000000065000110
+0001030009c0c0c0000000ffff004d060113080201020c0c5472616e73666572
+7442746e22020421212121212121211700189fff9e000100280000000d009d05
+400124012400050001030303030045010180800000000000000066679d01249d
+012400000000000001020068006600001c020b0b5472616e7366e97265720a10
+6700001c0200106800010f00016969000112000180141400000118143c009d04
+b0c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6000000ffff00ff
+ff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ff
+ff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff
+00ffff00ffff00ffff00000000000000ffff00ffff00000000000000000000c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000
+ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6
+c6c0c0c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ff
+ff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000
+c0c0c0c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000
+00000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6
+c6c6ff0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000
+ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff00
+00c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ff
+ff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff000000
+00c0c0c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6
+c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0
+c0c0c0c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0
+c0c0ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000
+ffff00ffff00000000000000ffff00ffff00000000000000000000c0c0c0ff00
+00c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ff
+ff00000000000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff000000
+00000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000
+ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ff
+ff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000ffff00ffff00000000c6c6c60000000000000000
+00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600
+0000000000000000000000000000c0c0c04e0601130802010208085061757365
+42746e22020421212121212121211700179fff9e000100290000000d009d0683
+012401240006000103030303004501018080000000000000006a6b9d01249d01
+240000000000000102006c006a00001c02060650617573650a106b00001c0200
+106c00010f00016d6d000112000180141400000118143c009d04b0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c60000000000000000000000000000000000000000000000000000000000
+00000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00
+ffff00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00000000
+000000000000000000000000000000000000000000000000ffff00ffff00ffff
+00000000c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c600
+0000ffff00ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000
+c0c0c0c6c6c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00000000000000000000
+000000000000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff00
+0000ffff00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0
+c0c0c0000000ffff00ffff00ffff00000000ffffffffffffffffff000000ffff
+00ffff00ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c000000000
+00ff0000ff0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00
+ffff00ffff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000
+ff0000ff0000ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff
+0000ff0000ff0000ff000000000000000000000000000000000000000000c0c0
+c0c6c6c6c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff00
+00ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6
+c6c6c6c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000
+ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0
+c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0
+c00000ff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0
+0000ff0000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c000
+00ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c64f060113080201020e0e46696e456e726567697374
+72657223020421212121212121211700149fff9e0001002c0000000d009d07c6
+012401240007000103030303004501018080000000000000006e6f9d01249d01
+2400000000000001020070006e00001c020c0c456e7265676973747265720a10
+6f00001c0200107000010f00017171000112000180141472000104140a009cc8
+3311111111111111113333300000000000000333333311111111111133330333
+3000000000033330003333200044443333400003333000000333300000003333
+0000333300001000033334433334000110000433333333440001100004033333
+3044000110000440333304440001100004433333344400011000003333333300
+0001100113333003333110011011333300003333110110133330000003333101
+1033331000000133330113333100000000133331333300000000000033333331
+111111111111133172000110000105000f000000c0c0c000ffffff0000ffffff
+50060113080201020b0b456e7265676973747265722202042121212121212121
+1700169fff9e0001002a0000000d009d09090124012400080001030303030045
+010180800000000000000073749d01249d012400000000000001020075007300
+001c020c0c456e7265676973747265720a107400001c0200107500010f000176
+76000112000180141477000104140a009cc81111111111111111111110000000
+0000000000011011111111111111110100000000000000000000003020200044
+4444444000000000000000000000000000000000000000001000044444444444
+0001100004404444044400011000040004400044000110000440444404440001
+1000044444444444000110000000000000000001100111000000001110011011
+1110000001111101101111100000011111011011111000000111110110011100
+0000001110011000000000000000000111111111111111111111770001100001
+05000f000000c0c0c000ffffff0000ffffff510600f608208902070745746174
+4374690202042121212121010101170015080854657874446174619e0001002b
+0000000d0a9d0a4b0092010f00090001030503030045010180a0000044000000
+007879929d010f020000000000010301053c00070005040009ff8100009e0040
+20140301007800001c0210104574617420636f6e7365696c6c65720a11790000
+1c0200104606007c08000d00111147656e6572616c4f7574696c734772696401
+0104010f10111201010117000e9fff9e000100150000000d009d099a041c01c0
+0002000103030303003a010160600000220000000000009d041c9d01c0000000
+00000001087a1001ff810000000000000000020100000000040101009fff009f
+ff20010100007b000004040000027c007a0000210102000000007c7b06000302
+010000141414147c06007c08000d0016165374616e646172644f7574696c7347
+72696456657274010104010f10111201010117000f9fff9e0001002f0000000d
+151503c9016d00010001030303030046010160600000000000000000009d03c9
+9d016d00000000000001087d1001ff8100000000000000000201000000000403
+01009fff009fff00010100007e00000000040400000000027f00800081007d00
+00210302000000007f80817e06000302010000141414147f060113080201020a
+0a416a6f7574657242746e01220421212121212121211700109fff9e0001001b
+0000000d9d03de1f010f01190001000103030303007c01018080000000000000
+0082839d010f9d011900000000000001020084008200001c0208084e6f757665
+61750a108300001c0200108400010f0001858500011200018012138600010813
+13009d0156070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070704070707070707070707070707070707070707040407070707
+0707070704070707070707070704020407070707070407040704070707070707
+0402020407070707070404040707070707070704020202040707040404040404
+0407070707070402020407070707070404040707070707070704020407070707
+0704070407040707070707070404070707070707070704070707070707070704
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707078600011000
+019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0
+c0dcc0a6caf00000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff
+00ff00ffffffffff80060113080201020c0c5375707072696d657242746e0122
+0421212121212121211700119fff9e0001001a0000000d9d052b1f0104010400
+02000103030303007c010180800000000000000087889d01049d010400000000
+000001020089008700001c020a0a5375707072696d65720a108800001c020010
+8900010f00018a8a00011200018011118b0001081111009d0121070707070707
+0707070707070707070707070707070707070000070707070707070707070707
+07070000ff0000070707070707070707070700ff00ff00ff0007070707070707
+07070700ff00ff00ff070707070707070707070700ff00ff0707070101070707
+07070707070707000707f80101f8f8070707000000f801010007f80101f8f807
+07070700ffff00f8f801010101f8f800070707070700ffff0007f8010101f8ff
+0007070707070700ff07070101010101ff0007070707070700ff07f80101f8f8
+0101000707070707070707070101f8f8ff0101f80707070707070707f80101f8
+fffffff80107070707070707070101f8f80000000701f80707070707070701f8
+f80707070707f8f8070707070707070707070707070707070707078b00011000
+019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0
+c0dcc0a6caf00000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff
+00ff00ffffffffff8106011308020102090953617576657242746e0102042121
+2121212121211700129fff9e000100220000000d9d016d2a00fa00fa00030001
+03030303007c01018080000000000000008c8d9cfa9cfa000000000000010200
+8e008c00001c0207075361757665720a108d00001c0200108e00010f00018f8f
+0001120001801010900001081010009d01000707070707070707070707070707
+0707070000000000000000000000000000070700030007070707070707070007
+0007070003000707070707070707000000070700030007070707070707070003
+0007070003000707070707070707000300070700030007070707070707070003
+0007070003000707070707070707000300070700030300000000000000000303
+0007070003030303030303030303030300070700030300000000000000000003
+0007070003030000000000000707000300070700030300000000000007070003
+0007070003030000000000000707000300070707000000000000000000000000
+0007070707070707070707070707070707079000011000019d0100009d030000
+0000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff3b
+06000302070000000000000606005e08002e009fff0303030303030303030303
+0300009fff0200000008009fff00000000000000000000000201910191000021
+040200000000929394959206005c08000e00040466696c650103030303030303
+0303030300209fff10000000080605052646696c650000000000000000000000
+0201960103ff009600002102020000000097989706006a080002020505707269
+6e7403030302030303030303030300219fff1100000008929fff000000000000
+0000000000010200129806006a080002020a0a7072696e747365747570030303
+02030303030303030300229fff1200000008929fff0000000000000000000000
+010200119306005c08000e000606416374696f6e010303030303030303030303
+00239fff150000000806070726416374696f6e00000000000000000000000201
+990103ff00990000210102000000009a9a06006a0800020209094e657757696e
+646f7703030302030303030303030300249fff1600000008930b0b264e657720
+57696e646f77000000000000000000000001020eff9406005c08000e00040448
+656c7001030303030303030303030300259fff1700000008069fff0000000000
+00000000000002019b010303009b0000210002000000009506005c08000e0009
+0943747874506f70557003030303030303030303030300269fff9e0001002d00
+00000806090943747874506f705570000000029c9c00000000000002019c9d01
+03ff009c9c00001c0200109c9d0000210102000000009c9e9c9e06006a080002
+0207074974656d54737403030302030303030303030300279fff9e0001002e00
+0000089507074974656d547374000000039c9f000000000000010200ff9c9f00
+001c0200109c9f1a919c9c9cb89d01189d01239d01a59d01b19d01bd9d024f9d
+025d9d02699d02fb9d03079d03139d03709d03829d03899d03909d05339d0840
+9d089d9d08ad9d08b49d08bb9d0a5e9d0d6b9d0e089d0e139d0e1f9d0e7b9d0e
+8c9d0e939d0e9a9d103d9d134a9d13d59d13e09d13ec9d14479d14579d145e9d
+14659d16089d19159d19939d199f9d19ab9d1a199d1a889d1a949d1aa09d1b28
+9d1b349d1b409d1ba69d1bb19d1c3e9d1c4a9d1c569d1cb49d1cc59d1d329d1d
+c09d1dcc9d1dd89d1e7e9d1e919d1e9d9d1ef99d1f0b9d1f129d1f199d1ff39d
+20059d20649d20779d207e9d20859d215f9d21779d21d49d21e29d21e99d21f0
+9d22ff9d23119d236e9d237e9d23859d238c9d245c9d246e9d24cd9d24e09d24
+e79d24ee9d29b19d2a0c9d2a1a9d2a219d2a289d2eeb9d2f4c9d2f609d2f679d
+2f6e9d30489d30609d30be9d30d29d30d99d30e09d31ba9d31d29d32459d325d
+9d32649d32f09d32fb9d33079d339e9d33ab9d33b79d34149d34249d342b9d34
+329d359b9d38a89d39079d39199d39209d39279d3a5b9d3d689d3dc29d3dd19d
+3dd89d3ddf9d3ef29d41ff9d420b9d423c9d424a9d42879d42939d42c99d4304
+9d43459d43509d43959d43cd9d43d79d44239d442b9d44389d447d9d44859d01
+a7191a38626377919b9c9c9ca09cb89cd69d01009d01019d01159d01189d0122
+9d01239d01469d01709d01719d01859d019e9d01a59d01af9d01b19d01bd9d01
+ec9d02169d02179d022b9d02469d024f9d02599d025d9d02699d02a09d02ca9d
+02cb9d02df9d02f69d02fb9d03059d03079d03139d03419d036b9d036c9d0370
+9d03749d03829d03869d03899d038d9d03909d039a9d05339d08409d086c9d08
+989d08999d089d9d08a19d08ad9d08b19d08b49d08b89d08bb9d08c59d0a5e9d
+0d6b9d0d9f9d0dcb9d0dcc9d0de09d0dfd9d0e089d0e129d0e139d0e1f9d0e4c
+9d0e769d0e779d0e7b9d0e7f9d0e8c9d0e909d0e939d0e979d0e9a9d0ea49d10
+3d9d134a9d137c9d13a89d13a99d13bd9d13d29d13d59d13df9d13e09d13ec9d
+14189d14429d14439d14479d144b9d14579d145b9d145e9d14629d14659d146f
+9d16089d19159d19379d19629d19639d19779d198e9d19939d199d9d199f9d19
+ab9d19da9d1a039d1a049d1a079d1a0c9d1a199d1a479d1a729d1a739d1a769d
+1a7b9d1a889d1a949d1aa09d1acb9d1af79d1af89d1b0c9d1b239d1b289d1b32
+9d1b349d1b409d1b649d1b8e9d1b8f9d1ba39d1ba69d1bb09d1bb19d1bdf9d1c
+0d9d1c0e9d1c229d1c399d1c3e9d1c489d1c4a9d1c569d1c789d1ca19d1ca29d
+1ca49d1cb49d1cb89d1cc59d1cf69d1d219d1d229d1d259d1d2a9d1d329d1d63
+9d1d8f9d1d909d1da49d1dbb9d1dc09d1dca9d1dcc9d1dd89d1e079d1e319d1e
+329d1e469d1e6b9d1e7e9d1e889d1e919d1e9d9d1eca9d1ef49d1ef59d1ef99d
+1efd9d1f0b9d1f0f9d1f129d1f169d1f199d1f239d1ff39d20059d20339d205f
+9d20609d20649d20689d20779d207b9d207e9d20829d20859d208f9d215f9d21
+779d21a39d21cf9d21d09d21d49d21d89d21e29d21e69d21e99d21ed9d21f09d
+21fa9d22ff9d23119d233d9d23699d236a9d236e9d23729d237e9d23829d2385
+9d23899d238c9d23969d245c9d246e9d249c9d24c89d24c99d24cd9d24d19d24
+e09d24e49d24e79d24eb9d24ee9d24f89d29b19d29db9d2a079d2a089d2a0c9d
+2a109d2a1a9d2a1e9d2a219d2a259d2a289d2a329d2eeb9d2f1b9d2f479d2f48
+9d2f4c9d2f509d2f609d2f649d2f679d2f6b9d2f6e9d2f789d30489d30609d30
+8d9d30b99d30ba9d30be9d30c29d30d29d30d69d30d99d30dd9d30e09d30ea9d
+31ba9d31d29d32039d322d9d322e9d32339d32389d32459d32499d325d9d3261
+9d32649d32979d32c39d32c49d32d89d32ed9d32f09d32fa9d32fb9d33079d33
+3f9d33699d336a9d337e9d33979d339e9d33a89d33ab9d33b79d33e39d340f9d
+34109d34149d34189d34249d34289d342b9d342f9d34329d343c9d359b9d38a8
+9d38d69d39029d39039d39079d390b9d39199d391d9d39209d39249d39279d39
+319d3a5b9d3d689d3d939d3dbd9d3dbe9d3dc29d3dc69d3dd19d3dd59d3dd89d
+3ddc9d3ddf9d3de99d3ef29d41ff9d420b9d42299d42389d42399d423b9d423c
+9d42469d424a9d426c9d42809d42819d42839d42849d42879d42919d42939d42
+b69d42c59d42c69d42c99d42f19d43009d43019d43049d43289d433e9d433f9d
+43419d43429d43459d434f9d43509d43779d43919d43929d43959d43b79d43c6
+9d43c79d43c99d43ca9d43cd9d43d79d43d79d44029d441b9d441c9d441f9d44
+209d44239d44289d442b9d44369d44389d44629d44799d447a9d447d9d44829d
+44850301
-55e3d170


end class;

class StandardCplxDataWin is mapped inherits from DataAccessBD.StandardDataWin

has public  constant DATA_STG_TOBS = 1;
has public  constant DATA_STG_TOPARENT = 2;

has public  attribute DataStrategy: Framework.integer;

has private method Add(input Mode: Framework.integer);
has public  method Append;
has public  method Delete;
has public  method Init;
has public  method Update;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+5151463100004b06000044539fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100000b000003001b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+0108076801000000000000000000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d0000131511e7000000000303030300050404606000002203e8
+07d000009d13159d11e700000000000001080910010000000000000000000002
+0100000000040201009fff009fff20010100000a0000000404000100020b0c0d
+00090000210202000000000b0d0a06000302010000000000000b06007c08000d
+000d0d42617272654861757447726964010104010f1011120101011700029fff
+9e000100100000000d000001a111bd0001000103030303000801046060000022
+0000000000009d01a19d11bd00000000000001080e1001ff8100000000000000
+00020100000000040104009fff009fff20010100000f00000000000404000000
+00000210001100120013000e000021040200000000101211130f060003020900
+00000000001006007c08000d0015154465706c6163656d656e744f7574696c73
+47726964230104010f1011120101011700039fff9e000100130000000d000001
+7702cf0001000103030303000b010160600000000000000000009d01779d02cf
+0000000000000108141001ff810000000000000000020100000000040102009f
+ff009fff00010100001500000004040000000216001700140000210202000000
+00161715060003020100001414141416060113080201020c0c50726563656465
+6e7442746e01020421212121212121211700049fff9e000100110000000d1515
+0124012400010001030303030010010180800000000000000018199d01249d01
+240000000000000102001a001800001c020a0a5072e963e964656e740a101900
+001c0200101a00010f00011b1b00011200018014141c0001081414009d01900f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800
+010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f
+0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f
+0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f00
+00080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1c00011000019d0100009d030000000080
+80808000008080000080000080800000808000808080400040400080ff004080
+4000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff
+8000ff8080ffff8080ffff0080ff804000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000017060113
+080201020a0a53756976616e7442746e01020421212121212121211700059fff
+9e000100120000000d9d016d1501240124000100020303030300100101808000
+0000000000001d1e9d01249d01240000000000000102001f001d00001c020808
+53756976616e740a101e00001c0200101f00010f000120200001120001801414
+210001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f
+0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f
+0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f
+08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f
+0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f
+0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f210001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000001106007c08000d0012125374616e646172644f7574696c7347
+726964010104010f1011120101011700089fff9e000100180000000d9d04a300
+017701770001000203030303000b010160600000000000000000009d01779d01
+770000000000000108221001ff81000000000000000002010000000004010100
+9fff009fff000101000023000004040000022400220000210102000000002423
+060003020100001414141424060113080201020b0b496d7072696d657242746e
+01020421212121212121211700099fff9e000100190000000d15150124012400
+010001030303030011010180800000000000000025269d01249d012400000000
+000001020027002500001c020909496d7072696d65720a102600001c02001027
+00010f000128280001120001801414290001081414009d01900f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e
+0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f0f0f0f
+0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e0000
+00000f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f00000000
+0000000000000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f
+0f0f0f000000000000000000000000000f0f000f0f0f0f000f0f0f0f0f0f0101
+010f0f000f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f0f0f00
+0000000000000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f
+000f0f0f0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f2900011000019d0100009d030000000080808080000080
+80000080000080800000808000808080400040400080ff0040804000ff804000
+ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ff
+ff8080ffff0080ff804000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000001206007c08000d001010
+4665726d65724f7574696c7347726964010104010f1011120101011700069fff
+9e000100160000000d9d07ef00017701770001000303030303000b0101606000
+00220000000000009d01779d017700000000000001082a1001ff810000000000
+000000020100000000040101009fff009fff00010100002b000004040000022c
+002a0000210102000000002c2b06000302010000141414142c06011308020102
+0a0a5175697474657242746e01020421212121212121211700079fff9e000100
+170000000d151501240124000100010303030300120101808000000000000000
+2d2e9d01249d01240000000000000102002f002d00001c020808517569747465
+720a102e00001c0200102f00010f000130300001120001801414310001081414
+009d01900707070707070707070707070707070707f807070707070707070700
+00000000000000fefef80707070707070707070000000000000000fefef80707
+07070707fefe0700f8f8f8f8f8f8fe0404f8070707070707fe0606fef8f8f8f8
+f8fe040404f8070707070707fe060606f8f8f8f8fe04040404f8070707060606
+06060606fefef8fe0404040404f8070707060606060606060000f8fe04040404
+04f807070706060606060606f8f8f8fe0404040404f8070707070707fe060600
+f8f8f8fe0404040404f8070707070707fe060000f8f8f8fe0404040404f80707
+07070707fe00f800f8f8f8fe0403040404f807070707070707f8f800f8f8f8fe
+0403040404f807070707070707f80700f8f8f8fe0404040404f8070707070707
+07070700f8f8f8fe0404040407f807070707070707070707070707fe04040407
+07f807070707070707070707070707fe04040407070707070707070707070707
+070707fe04040707070707070707070707070707070707fe0407070707070707
+07070707070707070707070707070707070707073100011000019d0100009d03
+00000000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff1306007c08000d009fff230104010f1011120101011700009fff9e0001001f
+0000000d9d0b3b3f00f0046f0001000403500303000b01016060000000000000
+0000009cf09d046f000000000000010832100100000000000000000000020100
+000000040102009fff009fff0001010000330000000404000000023400350032
+0000210202000000003435330600030201000000000000340600f60820890207
+074375724d6f646521020b212121212101010117000a0606537472696e679e00
+0100200000000d000000c6021e00010001030303030013010280a00000000000
+000000009cc69d021e00000000000001030201070007000009ff8100009e0040
+0014030100350600f6082089020606437572506f7321020b2121212121010101
+17000b0606537472696e679e000100210000000d9d02280000c6021e00010002
+030303030013010280a00000000000000000009cc69d021e0000000000000103
+0201070007000009ff8100009e004000140301000c0600030209000000000000
+0d06007c08000d000909436f72707347726964010104010f1011120101011700
+0c9fff9e000100140000000d009d01ab114111bd000200010303030300080404
+60600000220000000000009d11419d11bd000000000000010836100100000000
+000000000000020100000000040102009fff009fff2001010000370000000404
+0001000238003900360000210202000000003839370600030201000000000000
+3806007a08004d00060650616e656c30010104010f10111201010117000d9fff
+0e0000000d000011170fa00001000103050303000d040460600000220bb80fa0
+00009d11179d0fa000000000000001083a6001ff810000000000000000020100
+0000000900003a0000210102000000003b3b06007c08000d000c0c4469616c6f
+67756547726964020104010f10111201010117000e9fff9e0001001c0000000d
+9d03f29d07b10356072900000000030303030038010160600000000000000000
+009d03569d072900000000000001083c10010000000000000000000002010000
+0000040201009fff009fff20010100003d0000000404000000023e003f003c00
+00210202000000003e3f3d06000302020000000000003e060092082081029fff
+21210401212121212121212100009fff9e0001001d0000000d0000009c01f400
+01000103030303003b0101a0a00000000000000000009c9c9d01f40000000000
+000103010b40020100009e0044209400000000004000001c0209094469616c6f
+6775650a103f060084082009020b0b5374617475735f4c696e6502020c212121
+212101010117000f080854657874446174610d0000000d009ca7028607000002
+000103030303003b0204a0a00000440000001900009d02869d07000100000000
+000103020107001906000501040000ff81013906007c08000d000f0f42617272
+6544726f69746547726964010104010f1011120101011700109fff9e0001000c
+0000000d9d0faa00111701ea0001000203030303000d04016060000022000000
+0000009d11179d01ea0000000000000108411001ff8100000000000000000201
+00000000040201009fff009fff20010100004200000004040000000243004400
+4100002102020000000044434206000302070000141400004306007c08000d00
+0d0d4374694f7574696c7347726964010104010f1011120101011700169fff9e
+000100230000000d34150c740158000100010303030300390101606000000000
+00000000009d0c749d0158000000000000010845100100000000000000000000
+020100000000040901009fff009fff2001010000460000000000000000000004
+0400000000000000000000024700480049004a004b004c004d004e004f004500
+00210902000000004748494a4b4c4e4f4d46060003020100001e1e0000470601
+13080201020b0b446563726f63686542746e2202042121212121212121170017
+9fff9e000100240000000d001f01240124000100010303030300430101808000
+00000000000050519d01249d012400000000000001020052005000001c020a0a
+44e963726f636865720a105100001c0200105200010f00015353000112000180
+141454000104140a009cc8111111111111111111111111222222222222111111
+2200000000000022111220000000000000022122000022222222000022200002
+2111111220000220000211111111200002222222111111112222221111111111
+1111111111111112211111112211111111200222222200211111112000000000
+0021111112000020202000021111220000000000000221122000002020200000
+2122000000000000000022200000002020200000022000000000000000000212
+22222222222222222111111111111111111111540001100001030009ffff00c0
+c0c000000048060113080201020c0c52616363726f63686542746e2202042121
+2121212121211700189fff9e000100250000000d009d018c0124012400020001
+030303030043010180800000000000000055569d01249d012400000000000001
+020057005500001c020b0b52616363726f636865720a105600001c0200105700
+010f00015858000112000180141459000104140a009cc8000000003330000000
+0000111111333111111100012222223332222222100122222233322222221012
+2222223332222222211222211033300112222111111100333000111111122221
+0033300012222101111100333000111110000000003330000000000000033333
+3333000000000000333333300000000000000333330000000000000000333000
+0000000000000003000000000000001110000001110000000111111111111110
+0000122222222222221000012222222222222221004444444444444444444459
+000110000105000fc0c0c0000000ffff00ff0000ffffff49060113080201020a
+0a4c69626572657242746e22020421212121212121211700199fff9e00010026
+0000000d009d02f80143012e0003000103030303004301018080000000000000
+005a5b9d01439d012e0000000000000102005c005a00001c0206064c69627265
+0a105b00001c0200105c00010f00015d5d00011200018017155e000104160b00
+9cfd000000000000000000008100000000000000000002810000000000000000
+0022810000000000000000022281000000000000000002208100000000000000
+0022208100000000000000022200810000000000000022200081000000000000
+0022200081000000000000022200008102000000000022220000810220000000
+0222200000810222000000022200000081022220000022220000008102222200
+0222200000008102222220222220000000810022222222220000000081000222
+2222200000000081000022222220000000008100000222220000000000810000
+002222000000000081000000022000000000008100000000000000000000815e
+0001100001030009c0c0c000000000ff004a060113080201020a0a417474656e
+746542746e220204212121212121212117001a9fff9e000100270000000d009d
+0484011901240004000103030303004301018080000022000000005f609d0119
+9d012400000000000001020061005f00001c020808417474656e74650a106000
+001c0200106100010f00016262000112000180131463000104140a009cbe0000
+0000000000000000000000011100000000000000011122100000000000001221
+2211100000000000122122122100000000111221221221000000012212212212
+2100000001221221221221000000012212212212210000000122122122122100
+1100012222222222210122100122222222222112221001222222222222222100
+0122222222222222100001222222222222210000012222222222221000000012
+2222222221000000000122222222100000000000111111110000000063000110
+0001030009c0c0c0000000ffff004b060113080201020c0c5472616e73666572
+7442746e220204212121212121212117001b9fff9e000100280000000d009d05
+e60124012400050001030303030043010180800000000000000064659d01249d
+012400000000000001020066006400001c020b0b5472616e7366e97265720a10
+6500001c0200106600010f00016767000112000180141400000118143c009d04
+b0c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6000000ffff00ff
+ff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ff
+ff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff
+00ffff00ffff00ffff00000000000000ffff00ffff00000000000000000000c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000
+ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6
+c6c0c0c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ff
+ff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000
+c0c0c0c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000
+00000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6
+c6c6ff0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000
+ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff00
+00c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ff
+ff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff000000
+00c0c0c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6
+c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0
+c0c0c0c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0
+c0c0ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000
+ffff00ffff00000000000000ffff00ffff00000000000000000000c0c0c0ff00
+00c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ff
+ff00000000000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff000000
+00000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000
+ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ff
+ff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000ffff00ffff00000000c6c6c60000000000000000
+00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600
+0000000000000000000000000000c0c0c04c0601130802010208085061757365
+42746e220204212121212121212117001c9fff9e000100290000000d009d0753
+0124012400060001030303030043010180800000000000000068699d01249d01
+240000000000000102006a006800001c02060650617573650a106900001c0200
+106a00010f00016b6b000112000180141400000118143c009d04b0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c60000000000000000000000000000000000000000000000000000000000
+00000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00
+ffff00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00000000
+000000000000000000000000000000000000000000000000ffff00ffff00ffff
+00000000c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c600
+0000ffff00ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000
+c0c0c0c6c6c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff
+00ffff00ffff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00000000000000000000
+000000000000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff00
+0000ffff00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0
+c0c0c0000000ffff00ffff00ffff00000000ffffffffffffffffff000000ffff
+00ffff00ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c000000000
+00ff0000ff0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00
+ffff00ffff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000
+ff0000ff0000ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00000000c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff
+0000ff0000ff0000ff000000000000000000000000000000000000000000c0c0
+c0c6c6c6c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff00
+00ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6
+c6c6c6c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000
+ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0
+c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0
+c00000ff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0
+0000ff0000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c000
+00ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c64d060113080201020e0e46696e456e726567697374
+726572230204212121212121212117001f9fff9e0001002c0000000d009d08c0
+012401240007000103030303004301018080000000000000006c6d9d01249d01
+240000000000000102006e006c00001c020c0c456e7265676973747265720a10
+6d00001c0200106e00010f00016f6f000112000180141470000104140a009cc8
+3311111111111111113333300000000000000333333311111111111133330333
+3000000000033330003333200044443333400003333000000333300000003333
+0000333300001000033334433334000110000433333333440001100004033333
+3044000110000440333304440001100004433333344400011000003333333300
+0001100113333003333110011011333300003333110110133330000003333101
+1033331000000133330113333100000000133331333300000000000033333331
+111111111111133170000110000105000f000000c0c0c000ffffff0000ffffff
+4e060113080201020b0b456e7265676973747265722202042121212121212121
+17001d9fff9e0001002a0000000d009d0a2c0124012400080001030303030043
+010180800000000000000071729d01249d012400000000000001020073007100
+001c020c0c456e7265676973747265720a107200001c0200107300010f000174
+74000112000180141475000104140a009cc81111111111111111111110000000
+0000000000011011111111111111110100000000000000000000003020200044
+4444444000000000000000000000000000000000000000001000044444444444
+0001100004404444044400011000040004400044000110000440444404440001
+1000044444444444000110000000000000000001100111000000001110011011
+1110000001111101101111100000011111011011111000000111110110011100
+0000001110011000000000000000000111111111111111111111750001100001
+05000f000000c0c0c000ffffff0000ffffff4f0600f608208902070745746174
+437469020204212121212101010117001e080854657874446174619e0001002b
+0000000d0a9d0b990092010f00090001030503030043010180a0000044000000
+007677929d010f020000000000010301053c00070005040009ff8100009e0040
+20140301007600001c0210104574617420636f6e7365696c6c65720a11770000
+1c0200104406007c08000d00111147656e6572616c4f7574696c734772696401
+0104010f1011120101011700119fff9e000100150000000d009d0cbc041c01c0
+00020001030303030039010160600000220000000000009d041c9d01c0000000
+0000000108781001ff810000000000000000020100000000040101009fff009f
+ff200101000079000004040000027a00780000210102000000007a7906000302
+010000141414147a06007c08000d0016165374616e646172644f7574696c7347
+72696456657274010104010f1011120101011700129fff9e0001002f0000000d
+151503c9016d00010001030303030044010160600000000000000000009d03c9
+9d016d00000000000001087b1001ff8100000000000000000201000000000403
+01009fff009fff00010100007c00000000040400000000027d007e007f007b00
+00210302000000007e7d7f7c06000302010000141414147d060113080201020a
+0a416a6f7574657242746e01220421212121212121211700149fff9e0001001b
+0000000d1515010f01190001000103030303007a010180800000000000000080
+819d010f9d011900000000000001020082008000001c0208084e6f7576656175
+0a108100001c0200108200010f00018383000112000180121384000108131300
+9d01560707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707040707070707070707070707070707070707070404070707070707
+0707040707070707070707040204070707070704070407040707070707070402
+0204070707070704040407070707070707040202020407070404040404040407
+0707070704020204070707070704040407070707070707040204070707070704
+0704070407070707070704040707070707070707040707070707070707040707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+070707070707070707070707070707070707070707070707078400011000019d
+0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dc
+c0a6caf000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff
+00ffffffffff7e060113080201020c0c5375707072696d657242746e01220421
+212121212121211700139fff9e0001001a0000000d1f9d015801040104000200
+0103030303007a010180800000000000000085869d01049d0104000000000000
+01020087008500001c020a0a5375707072696d65720a108600001c0200108700
+010f000188880001120001801111890001081111009d01210707070707070707
+0707070707070707070707070707070700000707070707070707070707070707
+0000ff0000070707070707070707070700ff00ff00ff00070707070707070707
+0700ff00ff00ff070707070707070707070700ff00ff07070701010707070707
+0707070707000707f80101f8f8070707000000f801010007f80101f8f8070707
+0700ffff00f8f801010101f8f800070707070700ffff0007f8010101f8ff0007
+070707070700ff07070101010101ff0007070707070700ff07f80101f8f80101
+000707070707070707070101f8f8ff0101f80707070707070707f80101f8ffff
+fff80107070707070707070101f8f80000000701f80707070707070701f8f807
+07070707f8f8070707070707070707070707070707070707078900011000019d
+0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dc
+c0a6caf000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff
+00ffffffffff7f06011308020102090953617576657242746e01020421212121
+212121211700159fff9e000100220000000d1f9d029000fa00fa000300010303
+0303007a01018080000000000000008a8b9cfa9cfa0000000000000102008c00
+8a00001c0207075361757665720a108b00001c0200108c00010f00018d8d0001
+1200018010108e0001081010009d010007070707070707070707070707070707
+0700000000000000000000000000000707000300070707070707070700070007
+0700030007070707070707070000000707000300070707070707070700030007
+0700030007070707070707070003000707000300070707070707070700030007
+0700030007070707070707070003000707000303000000000000000003030007
+0700030303030303030303030303000707000303000000000000000000030007
+0700030300000000000007070003000707000303000000000000070700030007
+0700030300000000000007070003000707070000000000000000000000000007
+070707070707070707070707070707078e00011000019d0100009d0300000000
+bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf00000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000000000000000000000000000000000000ff
+fbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff060600
+5e08002e009fff03030303030303030303030300009fff0200000008009fff00
+0000000000000000000002018f018f000021040200000000909192939006005c
+08000e00040466696c6501030303030303030303030300209fff100000000806
+05052646696c6500000000000000000000000201940103ff0094000021020200
+00000095969506006a0800020205057072696e74030303020303030303030303
+00219fff1100000008909fff0000000000000000000000010200129606006a08
+0002020a0a7072696e74736574757003030302030303030303030300229fff12
+00000008909fff0000000000000000000000010200119106005c08000e000606
+416374696f6e01030303030303030303030300239fff15000000080607072641
+6374696f6e00000000000000000000000201970103ff00970000210102000000
+00989806006a0800020209094e657757696e646f770303030203030303030303
+0300249fff1600000008910b0b264e65772057696e646f770000000000000000
+00000001020eff9206005c08000e00040448656c700103030303030303030303
+0300259fff1700000008069fff00000000000000000000000201990103030099
+0000210002000000009306005c08000e00090943747874506f70557003030303
+030303030303030300269fff9e0001002d0000000806090943747874506f7055
+70000000029a00000000000002019b0103ff009a00001c0200109b0000210102
+000000009c9c9c9c06006a0800020207074974656d5473740303030203030303
+0303030300279fff9e0001002e000000089307074974656d547374000000039c
+9d000000000000010200ff9c9d00001c0200109c9d1a919c9c9cb89d01189d01
+239d01a19d01ad9d01b99d024b9d02599d02659d02f79d03039d030f9d036c9d
+037e9d03859d038c9d052f9d083c9d08999d08a99d08b09d08b79d0a5a9d0d67
+9d0df49d0dff9d0e0b9d0e679d0e789d0e7f9d0e869d10299d13369d13c19d13
+cc9d13d89d14339d14439d144a9d14519d15f49d19019d197f9d198b9d19979d
+1a059d1a749d1a809d1b089d1b149d1b209d1b869d1b919d1c1e9d1c2a9d1c36
+9d1c949d1ca59d1d129d1da09d1dac9d1db89d1e5e9d1e719d1e7d9d1ed99d1e
+eb9d1ef29d1ef99d1fd39d1fe59d20449d20579d205e9d20659d213f9d21579d
+21b49d21c29d21c99d21d09d22df9d22f19d234e9d235e9d23659d236c9d243c
+9d244e9d24ad9d24c09d24c79d24ce9d29919d29ec9d29fa9d2a019d2a089d2e
+cb9d2f2c9d2f409d2f479d2f4e9d30289d30409d309e9d30b29d30b99d30c09d
+319a9d31b29d32259d323d9d32449d32d09d32db9d32e79d337e9d338b9d3397
+9d33f29d34029d34099d34109d35799d38869d38e59d38f79d38fe9d39059d3a
+399d3d469d3da09d3daf9d3db69d3dbd9d3ed09d41dd9d420e9d421c9d42599d
+42659d429b9d42d69d43179d43229d43679d439f9d43a99d43f39d43fa9d4406
+9d444b9d44539d01a5191a38626377919b9c9c9ca09cb89cd69d01009d01019d
+01159d01189d01229d01239d01469d01709d01719d01859d019c9d01a19d01ab
+9d01ad9d01b99d01e89d02129d02139d02279d02429d024b9d02559d02599d02
+659d029c9d02c69d02c79d02db9d02f29d02f79d03019d03039d030f9d033d9d
+03679d03689d036c9d03709d037e9d03829d03859d03899d038c9d03969d052f
+9d083c9d08689d08949d08959d08999d089d9d08a99d08ad9d08b09d08b49d08
+b79d08c19d0a5a9d0d679d0d9b9d0dc79d0dc89d0ddc9d0df19d0df49d0dfe9d
+0dff9d0e0b9d0e389d0e629d0e639d0e679d0e6b9d0e789d0e7c9d0e7f9d0e83
+9d0e869d0e909d10299d13369d13689d13949d13959d13a99d13be9d13c19d13
+cb9d13cc9d13d89d14049d142e9d142f9d14339d14379d14439d14479d144a9d
+144e9d14519d145b9d15f49d19019d19239d194e9d194f9d19639d197a9d197f
+9d19899d198b9d19979d19c69d19ef9d19f09d19f39d19f89d1a059d1a339d1a
+5e9d1a5f9d1a629d1a679d1a749d1a809d1aab9d1ad79d1ad89d1aec9d1b039d
+1b089d1b129d1b149d1b209d1b449d1b6e9d1b6f9d1b839d1b869d1b909d1b91
+9d1bbf9d1bed9d1bee9d1c029d1c199d1c1e9d1c289d1c2a9d1c369d1c589d1c
+819d1c829d1c849d1c949d1c989d1ca59d1cd69d1d019d1d029d1d059d1d0a9d
+1d129d1d439d1d6f9d1d709d1d849d1d9b9d1da09d1daa9d1dac9d1db89d1de7
+9d1e119d1e129d1e269d1e4b9d1e5e9d1e689d1e719d1e7d9d1eaa9d1ed49d1e
+d59d1ed99d1edd9d1eeb9d1eef9d1ef29d1ef69d1ef99d1f039d1fd39d1fe59d
+20139d203f9d20409d20449d20489d20579d205b9d205e9d20629d20659d206f
+9d213f9d21579d21839d21af9d21b09d21b49d21b89d21c29d21c69d21c99d21
+cd9d21d09d21da9d22df9d22f19d231d9d23499d234a9d234e9d23529d235e9d
+23629d23659d23699d236c9d23769d243c9d244e9d247c9d24a89d24a99d24ad
+9d24b19d24c09d24c49d24c79d24cb9d24ce9d24d89d29919d29bb9d29e79d29
+e89d29ec9d29f09d29fa9d29fe9d2a019d2a059d2a089d2a129d2ecb9d2efb9d
+2f279d2f289d2f2c9d2f309d2f409d2f449d2f479d2f4b9d2f4e9d2f589d3028
+9d30409d306d9d30999d309a9d309e9d30a29d30b29d30b69d30b99d30bd9d30
+c09d30ca9d319a9d31b29d31e39d320d9d320e9d32139d32189d32259d32299d
+323d9d32419d32449d32779d32a39d32a49d32b89d32cd9d32d09d32da9d32db
+9d32e79d331f9d33499d334a9d335e9d33779d337e9d33889d338b9d33979d33
+c39d33ed9d33ee9d33f29d33f69d34029d34069d34099d340d9d34109d341a9d
+35799d38869d38b49d38e09d38e19d38e59d38e99d38f79d38fb9d38fe9d3902
+9d39059d390f9d3a399d3d469d3d719d3d9b9d3d9c9d3da09d3da49d3daf9d3d
+b39d3db69d3dba9d3dbd9d3dc79d3ed09d41dd9d41fb9d420a9d420b9d420d9d
+420e9d42189d421c9d423e9d42529d42539d42559d42569d42599d42639d4265
+9d42889d42979d42989d429b9d42c39d42d29d42d39d42d69d42fa9d43109d43
+119d43139d43149d43179d43219d43229d43499d43639d43649d43679d43899d
+43989d43999d439b9d439c9d439f9d43a99d43a99d43d49d43ec9d43ed9d43ef
+9d43f09d43f39d43f79d43fa9d44049d44069d44309d44479d44489d444b9d44
+509d44530301
-5438a42e


end class;

class StandardDicoWin is mapped inherits from DisplayBD.StandardWin

has public  attribute BufferStructure: DataAccessSrvBD.ObjectSelfDesc;
has public  attribute DicoTrt: DataAccessBD.DicoTrt;

has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0);
has public  method ResetAttributes(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc);
has public  method ResetSelfDesc(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc);

implements	DataAccessBD.DicoTrtInt;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin');

has
+515146310000060d000004ca9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100000b000002001b0001000000000003000021010200000000050400001c
+0214145374616e64617264204469636f2057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+0108076801000000000000000000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d00000cdc0fc9000000000303030300050404606000002203e8
+07d000009d0cdc9d0fc900000000000001080910010000000000000000000002
+0100000000040201009fff009fff00010100000a0000000404010000020b000c
+00090000210202000000000b0c0a06000302010000000000000b06007a08004d
+00060650616e656c30010104010f1011120101011700029fff0e0000000d0000
+0bb80fa000010001030503030008040460600000220bb80fa000009d0bb89d0f
+a000000000000001080d6001ff8100000000000000000201000000000900000d
+0000210102000000000e0e060092082081029fff212104012121212121212121
+00009fff0f0000000d6868009c01580001000103030303000b0101a0a0000022
+0000000000009c9c9d01580000000000000103010b0f020100009e0044201400
+000000000f00001c02060650616e656c0a100c060084082009020b0b53746174
+75735f4c696e6502020c2121212121010101170003080854657874446174610d
+0000000d009d0bc200f00fa0000200010350030300080204a0a0000044000000
+0000009cf09d0fa00100000000000103020107003f06000500010000fffe0006
+06005e08002e009fff03030303030303030303030300009fff0200000008009f
+ff00000000000000000000000201100110000021030200000000111213110600
+5c08000e00040466696c6501030303030303030303030300049fff1000000008
+0605052646696c6500000000000000000000000201140103ff00140000210202
+0000000015161506006a0800020205057072696e740303030203030303030303
+0300059fff1100000008119fff0000000000000000000000010200121606006a
+080002020a0a7072696e74736574757003030302030303030303030300069fff
+1200000008119fff0000000000000000000000010200111206005c08000e0006
+06416374696f6e01030303030303030303030300079fff150000000806070726
+416374696f6e00000000000000000000000201170103ff001700002101020000
+0000181806006a0800020209094e657757696e646f7703030302030303030303
+030300089fff1600000008120b0b264e65772057696e646f7700000000000000
+0000000001020eff1306005c08000e00040448656c7001030303030303030303
+030300099fff1700000008069fff000000000000000000000002011901030300
+19000021000200000000191a919c9c9cb89d01189d01239d01a19d01ad9d01b9
+9d021f9d022a9d02849d02929d02ff9d03309d033d9d037a9d03869d03bc9d03
+f79d04389d04439d04889d04c09d04ca5a191a38626377919b9c9c9ca09cb89c
+d69d01009d01019d01159d01189d01229d01239d01469d01709d01719d01859d
+019c9d01a19d01ab9d01ad9d01b99d01dd9d02079d02089d021c9d021f9d0229
+9d022a9d02489d02719d02729d02749d02849d02889d02929d02c39d02ee9d02
+ef9d02f29d02f79d02ff9d031d9d032c9d032d9d032f9d03309d033a9d033d9d
+035f9d03739d03749d03769d03779d037a9d03849d03869d03a99d03b89d03b9
+9d03bc9d03e49d03f39d03f49d03f79d041b9d04319d04329d04349d04359d04
+389d04429d04439d046a9d04849d04859d04889d04aa9d04b99d04ba9d04bc9d
+04bd9d04c09d04ca9d04ca0301
-0401241b


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method DicoTrt.DicoTransfer(input aTransData: DataAccessSrvBD.TransDico): Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method DicoTransfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class DicoTrt
--
--	Pre-condition : Refer to Abstract method of the class DicoTrt
--
--	Post-condition : Refer to Abstract method of the class DicoTrt
--
--	Exceptions : Refer to Abstract method of the class DicoTrt
--
--	Usage : DicoTrt
--
--	Historique :
--
--	D. NGUYEN	|	18/06/1997	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- DicoTrt.DicoTransfer');
--if FrontComm = NIL then
--	e : ImplementationExc = new;
--	e.SetWithParams(Severity=SP_ER_ERROR, message = 'DicoTrt.DicoTransfer : Attribute FrontComm is NIL');
--	Raise e;
--end if;
--Return FrontComm.Transfer(aTransData,DicoServiceMgr,DicoService, NIL);
if TransferTrt = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'DicoTrt.DicoTransfer : Attribute TransferTrt is NIL');
	Raise e;
end if;
Return TransferTrt.Transfer(aTransData,DicoServiceMgr,DicoService, NIL);
end method;

------------------------------------------------------------
method DicoTrt.Init
begin
super.Init();
Self.TransferTrt = new();
end method;

------------------------------------------------------------
method DicoTrt.InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DicoTrt.InitFillInFields...');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, aWidget.Name.Value);
if aWidget.IsA(Type=FillInField) or aWidget.IsA(Type=DropList) then
	for aDesc in pBufferStructure.SelfDesc do
		if aDesc.ItemName = aWidget.Name.Value then
			if aDesc.ItemReference.Isa(Type=DicoDesc) 
			 then
				-- Read the Dico
				aTransDico : TransDico = new();
				aTransDico.aClassType = aDesc.ItemReference.GetClassType();
				aTransDico.TransActionService = DICO_READ;
				aTransDico.TypeLib = pTypeLib;
				aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
				-- Change the FillInField List Elements
				if aDicoClass <> NIL then
					if aWidget.IsA(Type=FillInField) then
						(FillInField)(aWidget).setElementList(List=aDicoClass.ListElements);
					elseif aWidget.IsA(Type=DropList) then
						(DropList)(aWidget).setElementList(List=aDicoClass.ListElements);
					end if;
				else
					if aDesc.ItemReference.Isa(Type=TypBooleanNullable) and (TypBooleanNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=FillInField) then
							(FillInField)(aWidget).setElementList(List=(TypBooleanNullable)(aDesc.ItemReference).ListValues);
						elseif aWidget.IsA(Type=DropList) then
							(DropList)(aWidget).setElementList(List=(TypBooleanNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypIntegerNullable) and (TypIntegerNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=FillInField) then
							(FillInField)(aWidget).setElementList(List=(TypIntegerNullable)(aDesc.ItemReference).ListValues);
						elseif aWidget.IsA(Type=DropList) then
							(DropList)(aWidget).setElementList(List=(TypIntegerNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDateTimeNullable) and (TypDateTimeNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=FillInField) then
							(FillInField)(aWidget).setElementList(List=(TypDateTimeNullable)(aDesc.ItemReference).ListValues);
						elseif aWidget.IsA(Type=DropList) then
							(DropList)(aWidget).setElementList(List=(TypDateTimeNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDoubleNullable) and (TypDoubleNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=FillInField) then
							(FillInField)(aWidget).setElementList(List=(TypDoubleNullable)(aDesc.ItemReference).ListValues);
						elseif aWidget.IsA(Type=DropList) then
							(DropList)(aWidget).setElementList(List=(TypDoubleNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypTextNullable) and (TypTextNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=FillInField) then
							(FillInField)(aWidget).setElementList(List=(TypTextNullable)(aDesc.ItemReference).ListValues);
						elseif aWidget.IsA(Type=DropList) then
							(DropList)(aWidget).setElementList(List=(TypTextNullable)(aDesc.ItemReference).ListValues);
						end if;
					end if;
				end if;
			end if;
		end if; 
	end for;
elseif aWidget.Isa(Type=CompoundField) then
	for aChild in (CompoundField)(aWidget).Children do
		InitFillInFields(aChild, pBufferStructure, pTypeLib);
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- DicoTrt.InitFillInFields  : End');

Return;
end method;

------------------------------------------------------------
method DicoTrt.InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitRecordDicoValues');
FlagSelfDesc : Boolean = FALSE;
if aRecordSelfDesc.SelfDesc = NIL then
	aRecordSelfDesc.SelfDesc = new();
	aRecordSelfDesc.DoResetSelfDesc();
	FlagSelfDesc = TRUE;
elseif aRecordSelfDesc.SelfDesc.Items = 0 then
	aRecordSelfDesc.DoResetSelfDesc();
	FlagSelfDesc = TRUE;
end if;
for aDesc in aRecordSelfDesc.SelfDesc do
	if aDesc.ItemReference.Isa(Type=DicoDesc) 
	 then
		-- Read the Dico
		aTransDico : TransDico = new();
		aTransDico.aClassType = aDesc.ItemReference.GetClassType();
		aTransDico.TransActionService = DICO_READ;
		aTransDico.TypeLib = pTypeLib;
		aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
		-- Change the List Elements
		if aDicoClass <> NIL then
			(DicoDesc)(aDesc.ItemReference).SetListValues(aDicoClass.ListElements);
/* -- Prise en compte du SetListValues
			if aDesc.ItemReference.Isa(Type=TypBooleanNullable) then
				(TypBooleanNullable)(aDesc.ItemReference).ListValues = aDicoClass.ListElements;
			elseif aDesc.ItemReference.Isa(Type=TypIntegerNullable) then
				(TypIntegerNullable)(aDesc.ItemReference).ListValues = aDicoClass.ListElements;
			elseif aDesc.ItemReference.Isa(Type=TypDateTimeNullable) then
				(TypDateTimeNullable)(aDesc.ItemReference).ListValues = aDicoClass.ListElements;
			elseif aDesc.ItemReference.Isa(Type=TypDoubleNullable) then
				(TypDoubleNullable)(aDesc.ItemReference).ListValues = aDicoClass.ListElements;
			elseif aDesc.ItemReference.Isa(Type=TypTextNullable) then
				(TypTextNullable)(aDesc.ItemReference).ListValues = aDicoClass.ListElements;
			end if;
*/
		end if;
	end if; 
end for;
if FlagSelfDesc then
	aRecordSelfDesc.SelfDesc = NIL;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitRecordDicoValues : End');

Return;
end method;

------------------------------------------------------------
method InitAppDesc.DoInitService
begin
--
--	Description :	Modèle de méthode de type "Do" au niveau abstrait	
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> Parm1 :	Desc
--					Output	--> Parm2 :	Desc
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ServiceMgrDesc.DoInitService');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('ServiceMgrDesc.DoInitService');
Self.TraceExc(unExc, 'ServiceMgrDesc.DoInitService');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method InitAppDesc.DoOpenApplication
begin
--
--	Description : 	démarre l'application. En général par l'ouverture d'une ou plusieurs fenêtres.
--					La fenêtre principale de l'application doit obligatoirement être lancée en mode synchrone;
--					sinon, on sort de l'application.
--
--	Type :	Concret
--
--	Parametres :	Auncun
--
--	Pre-condition :	Aucun
--
--	Post-condition :	Aucun
--
--	Exceptions :	Aucun
--
--	Usage : InitApp
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--+

end method;

------------------------------------------------------------
method InitAppDesc.Init
begin
--
--	Description : 	Initialisation of the object.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : InitWin is created.
--
--	Exceptions : None
--
--	Utilisation : Démarrage
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

super.Init();
Initwin = new;
Self.Dependances = new;

end method;

------------------------------------------------------------
method InitAppDesc.InitService
begin
--
--	Description : 	Init of the service using dependancy with services.
--
--	Type :	Concret
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : 
--
--	Historique :
--
--	D. NGUYEN	|	19/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitAppDesc.InitService');

Self.SyncServices();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitAppDesc.InitService : End');

Return;
end method;

------------------------------------------------------------
method InitAppDesc.OpenApplication
begin
--
--	Description : 	Open of the application. This method Must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Utilisation : DataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitAppDesc.OpenApplication');

Self.DoOpenApplication();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitAppDesc.OpenApplication : End');

Return;
end method;

------------------------------------------------------------
method InitAppDesc.SyncServices
begin
--
--	Description : 	Synchronization of the service objects due at the startup of the current service.
--
--	Type :	Abstract
--
--	Parametres :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Startup of the application
--
--	Historique :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitAppDesc.SyncServices');

Go : Boolean = FALSE;

Boucle : While not Go do
	Begin
		Dependances.Clear();
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '----> BEFORE DoInitService');
		DoInitService();
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '----> BEFORE FOR');
		For unService in Dependances do
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '----> FOR');
			if unService = NIL then
				e : DistributedAccessException = new;
				Raise e;
			elseif (unService.IsA(Type=ServiceMgrDesc) and not (ServiceMgrDesc)(unService).ServiceStarted) or (unService.IsA(Type=ServiceDesc) and not (ServiceDesc)(unService).ServiceStarted) then
				e : DistributedAccessException = new;
				Raise e;
			end if;
		end for;

		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '- InitAppDesc.SyncServices : Exit Boucle');
		exit Boucle;
		Exception
			When e:DistributedAccessException do
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '----> DELAY');
				Task.Delay(1000);
				continue;
	End;
End While;
	
Go = FALSE;
Event Loop
	Postregister
		start task Self.OpenApplication() where completion = event;
	When Self.OpenApplicationDone do
		Go = TRUE;
		exit;
	When Self.OpenApplicationExc(aExc) do
		Self.TraceExc((GenericException)(aExc), 'InitAppDesc.SyncServices');
		exit;
End Event;

if Go then
	Self.MyControlWin.MainTaskEventLoop();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitAppDesc.SyncServices : End');

Return;

Exception
	When e:GenericException do
		Self.TraceExc(e, 'InitAppDesc.SyncServices');
		Raise e;
	When e:DistributedAccessException do
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '----> DELAY');
		Task.Delay(1000);
		Self.SyncServices();
end method;

------------------------------------------------------------
method DetailWin.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MainWin.Init
begin
super.Init();
end method;

------------------------------------------------------------
method StandardCplxDataWin.Add(input Mode: Framework.integer)
begin
--
--	Description : 	Creation of a new instance of the window.
--
--	Type :	Abstract
--
--	Parametres :	Input --> Mode :	DTA_ADDNEW (Creation with initialisation)
--										DTA_ADDFROMCURRENT (Creation by copy of the current)
--
--	Pre-condition : The mode must be alimented.
--
--	Post-condition : The instance is created in the interface
--
--	Exceptions : None
--
--	Usage : StandardCplxDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/03/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Add');

Case Self.DataStrategy is
	When Self.DATA_STG_TOBS do
		Super.Add(Mode);
	When Self.DATA_STG_TOPARENT do
		if Self.Parent.IsA(StandardDataWin) then
			(StandardDataWin)(Self.Parent).Add(Mode);
		else
			unExc : ImplementationExc = new();
			unExc.Message.SetValue('Bad usage of Strategy on ');
			unExc.Message.Concat(Self.ClassName);
			Self.TraceExc(unExc, 'StandardCplxDataWin.Add');
			Raise unExc;
		end if;
end case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardCplxDataWin.Add : End');

Return;
end method;

------------------------------------------------------------
method StandardCplxDataWin.Append
begin
--
--	Description : 	Append of an instance in the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : The instance exists
--
--	Post-condition : The instance is appended
--
--	Exceptions : None
--
--	Usage : StandardCplxDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/03/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Append');

Case Self.DataStrategy is
	When Self.DATA_STG_TOBS do
		Super.Append();
	When Self.DATA_STG_TOPARENT do
		-- Link to the Parent
End Case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Append : End');

Return;

end method;

------------------------------------------------------------
method StandardCplxDataWin.Delete
begin
--
--	Description : 	Delete of the current instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is deleted.
--
--	Exceptions : None
--
--	Usage : StandardCplxDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/03/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Delete');

Case Self.DataStrategy is
	When Self.DATA_STG_TOBS do
		Super.Append();
	When Self.DATA_STG_TOPARENT do
		-- Link to the Parent
End Case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardCplxDataWin.Delete : End');

Return;

end method;

------------------------------------------------------------
method StandardCplxDataWin.Init
begin
Super.init;
Self.DataStrategy = Self.DATA_STG_TOBS;
end method;

------------------------------------------------------------
method StandardCplxDataWin.Update
begin
--
--	Description : 	Update of the current instance of the data flow.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : The Instance exists
--
--	Post-condition : The instance has been updated
--
--	Exceptions : None
--
--	Usage : StandardCplxDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/03/1998	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Update');

Case Self.DataStrategy is
	When Self.DATA_STG_TOBS do
		Super.Update();
	When Self.DATA_STG_TOPARENT do
		-- Link to the Parent
End Case;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardCplxDataWin.Update : End');

Return;

end method;

------------------------------------------------------------
method StandardDataWin.Add(input Mode: Framework.integer)
begin
--
--	Description : 	Creation of a new instance of the window.
--
--	Type :	Abstract
--
--	Parametres :	Input --> Mode :	DTA_ADDNEW (Creation with initialisation)
--										DTA_ADDFROMCURRENT (Creation by copy of the current)
--
--	Pre-condition : The mode must be alimented.
--
--	Post-condition : The instance is created in the interface
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--  JB BRIAUD       |   05/03/1998  |   FlagPanel0 strategy.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Add');

Go : Boolean = FALSE;
if AddConfirm and FlagPanel0 then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_ADD_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		AffStatusLine('Add canceled...');
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;

if Go then
	TmpRecord : ObjectSelfDesc;
	CurrentId = 0;
	Case Mode is
		when DTA_ADDNEW do
			TmpRecord = BufferStructure.clone(Deep=TRUE);
			i : integer;
			For SDesc in InitAddValues.SelfDesc do
				i = i + 1;
				if TmpRecord.SelfDesc[i].ItemReference.IsA(Type=DataValue) then
					aItemReference : DataValue = (DataValue)(TmpRecord.SelfDesc[i].ItemReference);

					if (DataValue)(SDesc.ItemReference) <> NIL then
						if (DataValue)(SDesc.ItemReference).IsNull = TRUE then
							aItemReference.IsNull = TRUE;
						else
							aItemReference.setValue((DataValue)(SDesc.ItemReference).TextValue);
						end if;
					else
						aItemReference.setValue((DataValue)(SDesc.ItemReference).TextValue);
					end if;
				else
					aItemRefence : Object = TmpRecord.SelfDesc[i].ItemReference.clone(Deep=TRUE);
				end if;
			End for;
			TmpRecord.Id = 0;
			AffectDataWin(TmpRecord);
		when DTA_ADDFROMCURRENT do
			TmpObject : Object;
			DoAffectObject(TmpObject);
			TmpRecord = (ObjectSelfDesc)(TmpObject).clone(TRUE);
			TmpRecord.Id = 0;
			AffectDataWin(TmpRecord);
	End Case;
	DoAfterAdd();
	AffCurPos(0, MyCache.Objects.Items+1);
	<Panel0>.HasDataChanged = FALSE;
	SetDataMode(ACT_STD_APPEND);
End if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Add : End');

end method;

------------------------------------------------------------
method StandardDataWin.Add
begin
--
--	Description : 	Creation of a new instance of the window, default option.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is created in the interface in DTA_ADDNEW mode
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Add(DTA_ADDNEW);
end method;

------------------------------------------------------------
method StandardDataWin.AffCurPos(input CurrentPosition: Framework.integer,
	input Total: Framework.integer)
begin
--
--	Description : 	Display of the current position in the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	CurrentPosition
--					Input -->	Total :	Number of items in the data flow
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin AffCurPos');
CurPos.setValue(CurrentPosition);
CurPos.concat('/');
CurPos.concat(Total);

end method;

------------------------------------------------------------
method StandardDataWin.AffectDataWin(input aObject: Framework.Object)
begin
--
--	Description : 	Affectation of the display from the object received.
--					The object must contain the data to display.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject :	Contains the data to display
--
--	Pre-condition : None
--
--	Post-condition : The data are displayed.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AffectDataWin');

aBufferType : Classtype = BufferStructure.GetClassType();
if not aObject.Isa(aBufferType) then
	aClassType : ClassType = aBufferType;
	aObject = aClassType.InstanceAlloc();
end if;
--aRecord : RecordDesc = new(object=(ObjectSelfDesc)(aObject));
--DoAffRecord(aRecord);
DoAffRecord((ObjectSelfDesc)(aObject));
--aOrder : OrderDesc = (OrderDesc) (aObject);
--SellSecurityName = aOrder.SecurityName;
--Sellquantity = aOrder.quantity;
--Sellprice = aOrder.price;

	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.AffectDataWin : End');

Return;

end method;

------------------------------------------------------------
method StandardDataWin.AffFirstPosition
begin
--
--	Description : 	Displays the first position of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AffFirstPosition');
SavPosition : integer = CurrentPosition;
if CurrentPosition = 0 and MyCache.Objects.Items > 0 then
	CurrentPosition = 1;
end if;
if CurrentPosition > 0 and MyCache.Objects.Items > 0 then
	CurrentPosition = 1;
	AffPosition();
	<Panel0>.HasDataChanged = FALSE;
	SetDataMode(ACT_STD_READ);
Else
	CurrentPosition = 0;
	AffPosition();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.AffFirstPosition : End');

Return;

Exception
	When e : NoDataFoundExc do
		CurrentPosition = SavPosition;
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : ');
		TmpMsg.concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.concat(e.Severity);
		Task.Part.LogMgr.PutLine(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, TmpMsg);
		AffStatusLine('... Réessayer plus tard : données non accessibles pour l''instant.');
		Self.Window.PurgeEvents();

end method;

------------------------------------------------------------
method StandardDataWin.AffLastPosition
begin
--
--	Description : 	Displays the last position of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AffLastPosition');

SavPosition : Integer = CurrentPosition;
CurrentPosition = Self.MyCache.Objects.Items;
AffPosition();
<Panel0>.HasDataChanged = FALSE;
SetDataMode(ACT_STD_READ);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.AffLastPosition : End');

Return;

Exception
	When e : NoDataFoundExc do
		CurrentPosition = SavPosition;
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : ');
		TmpMsg.concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.concat(e.Severity);
		Task.Part.LogMgr.PutLine(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, TmpMsg);
		AffStatusLine('... Retry later : data not accessible right now');		
		Self.Window.PurgeEvents();

end method;

------------------------------------------------------------
method StandardDataWin.AffNextPosition
begin
--
--	Description : 	Displays the next position of the data flow.
--					If there's no next position, a new instance is created.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AffNextPosition');
SavPosition : integer = CurrentPosition;
if MyCache.Objects.Items > 0 then
	if Self.MyCache.Objects[CurrentPosition+1] <> NIL then
		CurrentPosition = CurrentPosition + 1;
		AffPosition();
		<Panel0>.HasDataChanged = FALSE;
		SetDataMode(ACT_STD_READ);
		AffStatusLine('');
	elseif ViewMode = FS_UPDATE and FlagAppend then
		if Self.AddPolicy = DTA_ADDNEW then
			AffStatusLine('Pas d''enregistrement suivant...');
		else -- Here is an Add() who take care of the <Panel0>.HasDatachanged attribute.
			if Self.FlagAppend then
				Begin
					Go : Boolean = FALSE;
					if not FlagPanel0 then
						Rep : Integer;
						if Self.<Panel0>.HasDataChanged then
							Rep = Self.Window.QuestionDialog(Self.MSG_ADD_3, BS_YESNOCANCEL, BV_YES);
							if Rep = BV_YES then
								Go = TRUE;
								Self.Window.DisableInput();
								Self.Submit();
								Self.Window.EnableInput();
							elseif Rep = BV_Cancel then
								Go = FALSE;
							elseif Rep = BV_No then
								Go = TRUE;
								Self.<Panel0>.HasDataChanged = FALSE;
							end if;
						else
							Rep = Self.Window.QuestionDialog(Self.MSG_ADD_2, BS_YESNO, BV_YES);
							if Rep = BV_YES then
								Go = TRUE;
							end if;
						end if;
					end if;
					if FlagPanel0 or (not FlagPanel0 and Go) then
						Self.Window.DisableInput();
						Add();
						Self.Window.EnableInput();
					end if;
				Exception 
					When e : GenericException do
						Self.Window.EnableInput();
						TmpMsg : TextData = new;
						TmpMsg.Setvalue(e.Message);
						TmpMsg.Concat(' - Severity : ');
						TmpMsg.Concat(e.Severity);
						AffStatusLine(TmpMsg);
				End;
			End if; -- FlagAppend
		end if;
	elseif ViewMode = FS_VIEWONLY then
		AffStatusLine('Pas d''enregistrement suivant...');
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.AffNextPosition : End');

Return;

Exception
	When e : NoDataFoundExc do
		CurrentPosition = SavPosition;
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : ');
		TmpMsg.concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.concat(e.Severity);
		Task.Part.LogMgr.PutLine(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, TmpMsg);
		AffStatusLine('... Retry later : data not accessible right now');
		Self.Window.PurgeEvents();

end method;

------------------------------------------------------------
method StandardDataWin.AffPosition
begin
--
--	Description : 	Displays the current position of the data flow.
--					if there's no data, the window is initialized.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin AffPosition');
if MyCache.Objects <> NIL then
	if CurrentPosition <= MyCache.Objects.Items then
		if MyCache.Objects[CurrentPosition] <> NIL then
			CurrentId = MyCache.Objects[CurrentPosition].Record.Id;
--			TmpRec : RecordDesc = new(object=MyCache.Objects[CurrentPosition].Record);
--			DoAffRecord(TmpRec);
			DoAffRecord(MyCache.Objects[CurrentPosition].Record.Clone(TRUE));
		else
			ResetWindow();
		end if;
	else
		Self.CurrentPosition = Self.CurrentPosition - 1;
		Self.AffPosition();
	end if;
	AffCurPos(CurrentPosition, MyCache.Objects.Items);
Else
	ResetWindow();
	AffCurPos(CurrentPosition, MyCache.Objects.Items);
end if;

end method;

------------------------------------------------------------
method StandardDataWin.AffPreviousPosition
begin
--
--	Description : 	Displays the previous position of the data flow.
--					If there's no previous position, a message is displayed.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AffPreviousPosition');
SavPosition : integer = CurrentPosition;
if MyCache.Objects.Items > 0 then
	if Self.MyCache.Objects[CurrentPosition-1] <> NIL then
		CurrentPosition = CurrentPosition - 1;
		AffPosition();
		<Panel0>.HasDataChanged = FALSE;
		SetDataMode(ACT_STD_READ);
		AffStatusLine('');
	else
		AffStatusLine('Pas d''enregistrement précédent...');
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.AffPreviousPosition : End');

Return;

Exception
	When e : NoDataFoundExc do
		CurrentPosition = SavPosition;
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : ');
		TmpMsg.concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.concat(e.Severity);
		Task.Part.LogMgr.PutLine(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, TmpMsg);
		AffStatusLine('... Retry later : data not accessible right now');
		Self.Window.PurgeEvents();

end method;

------------------------------------------------------------
method StandardDataWin.AffStatusLine(input Message: Framework.string)
begin
--
--	Description : 	Displays the text un the status bar of the window.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	Message : Message to be displayed
--
--	Pre-condition : None
--
--	Post-condition : The message is displayed
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
Status_Line = Message;
Self.Window.StatusText = Status_Line;
Self.Window.UpdateFieldFromData();

end method;

------------------------------------------------------------
method StandardDataWin.AffStatusLine(input Message: Framework.TextData)
begin
--
--	Description : 	Affiche le message dans la zone de status à partir d'un message de type TextData.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	Message :	Message à afficher
--
--	Pre-condition : le message est différent de NIL
--
--	Post-condition : le message est affiché
--
--	Exceptions : Aucune
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Création.
--+
AffStatusLine(Message.Value);
end method;

------------------------------------------------------------
method StandardDataWin.Append
begin
--
--	Description : 	Append of an instance in the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : The instance exists
--
--	Post-condition : The instance is appended
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--  JB BRIAUD       |   05/03/1998  |   FlagPanel0 strategy.
--+

Go : Boolean = FALSE;
if AppendConfirm and FlagPanel0 and not IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_APPEND_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Append');
	aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
	AffStatusLine('Création en cours...');
	TmpObject : Object;
	DoAffectObject(TmpObject);
	aCacheDesc.Record = (ObjectSelfDesc)(TmpObject);
	TmpMessage : TextData = new();
	TmpWarning : Warning;
	if Self.PlayValidity then
		TmpRecordSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(aCacheDesc.Record);
		InitRecordDicoValues(TmpRecordSelfDesc, Self.DicoTypeLib);
		TmpRecordSelfDesc.DoCheckValidity();
		TmpWarning = TmpRecordSelfDesc.DoCheckWarning();
		if TmpWarning <> NIL then
			TmpMessage = TmpWarning.Message;
			TmpMessage.Concat('\n');
		end if;
		aCacheDesc.Record.DtMajQqo.SetCurrent();
		aCacheDesc.record.IdUtlQqo=Self.SessionUser.IdUtl;
	end if;
	aCacheDesc.Record.Id = CurrentId;
	DoBeforeAppend();
	MyTransData.TransObject = aCacheDesc;
--	MyTransData.TransActionService = ACT_STD_APPEND;
	MyTransData.TransActionService = Self.ActionAppend;
	aCacheDesc = (CacheDesc)(Transfer());
	DoAfterAppend();
	if aCacheDesc <> NIL then
		MyCache.Append(aCacheDesc);
	end if;
	TmpMessage.Concat('Création effectuée...');
	AffStatusLine(TmpMessage);
	Self.CurrentPosition = Self.MyCache.Objects.Items;
	AffPosition();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Append : End');
else
	AffStatusLine('Création annulée...');
end if;

Return;

Exception 

	When e: RecordValidityExc do
		TmpText : TextData = new(Value=e.Message.value);
		e.Message.setValue(e.ItemName);

		uneStructureDesc : StructureDesc;
		uneStructureDesc = GetStructureDesc(BufferStructure, e.ItemName);
		if uneStructureDesc <> NIL then
			e.Message.setValue(uneStructureDesc.ItemUsername);
		end if;
		e.Message.Concat(':');
		e.Message.Concat(TmpText.value);
		Self.Window.PurgeEvents();
		Self.RequestFocusOn(ItemName=e.ItemName,aWidget=<Panel0>);
--		<Panel0>.RequestFocus();
		Raise e;
	When e: GenericException do
		Self.Window.PurgeEvents();
		<Panel0>.RequestFocus();
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.AppendEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Appends an instance to the data flow on reception of an append event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject :	Object to append
--
--	Pre-condition : aObject exists
--
--	Post-condition : The buffer is ok
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
if Self.MyDataContext = NIL and aObject <> NIL then
	aCacheDesc : CacheDesc = (CacheDesc) (aObject);
	if MyCache.CriteraPlay(aCritera=OrigFilterCritera, aRecordSelfDesc=(ObjectSelfDesc)(aCacheDesc.Record)) then
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.AppendEvent');
		MyCache.Append(aCacheDesc);
		if CurrentId = aCacheDesc.Record.Id then
			AffPosition();
		end if;
		AffCurPos(CurrentPosition, MyCache.Objects.Items);
	End if;
End if;
end method;

------------------------------------------------------------
method StandardDataWin.BusinessClassMaj(input output pBusinessClass: DataAccessSrvBD.ObjectSelfDesc,
	input pResult: DataAccessSrvBD.ObjectSelfDesc)
begin
-- Méthode récursive de mise à jour du BusinessClass

if pBusinessClass.SelfDesc = NIL then
	pBusinessClass.SelfDesc = new();
	pBusinessClass.DoResetAttributes();
end if;
if pBusinessClass.SelfDesc.Items = 0 then
	pBusinessClass.DoResetSelfDesc();
end if;
if pResult.SelfDesc = NIL then
	pResult.SelfDesc = new();
end if;
if pResult.SelfDesc.Items = 0 then
	pResult.DoResetSelfDesc();
end if;

pBusinessClass.Id = pResult.Id;
pBusinessClass.DtMajQqo.setValue(pResult.DtMajQqo);
pBusinessClass.IdUtlQqo = pResult.IdUtlQqo;
pBusinessClass.FlagSuppr = pResult.FlagSuppr;

ItemCount : integer;
For aItem in pBusinessClass.SelfDesc do
	ItemCount = ItemCount + 1;
	if aItem.ItemReference.IsA(Type=DataValue) then
		(DataValue)(aItem.ItemReference).setValue((DataValue)(pResult.SelfDesc[ItemCount].ItemReference));
	elseif aItem.ItemReference.IsA(Type=GenericArray) then
		TmpItem : GenericArray = (GenericArray)(aItem.ItemReference);
		TmpArray : GenericArray = (GenericArray)(pResult.SelfDesc[ItemCount].ItemReference);
--		aItem.ItemReference = TmpArray.clone(Deep=TRUE);
		TmpItem.Clear();
		For i in 1 to TmpArray.Items do
			TmpItem.AppendRow(TmpArray.FindObjectForRow(i));
		End for;
	elseif aItem.ItemReference.ISA(Type=ObjectSelfDesc) then
		TmpRecord : ObjectSelfDesc =(ObjectSelfDesc)(aItem.ItemReference);
		Self.BusinessClassMaj(TmpRecord,(ObjectSelfDesc)(pResult.SelfDesc[ItemCount].ItemReference));
	end if;
end for;

end method;

------------------------------------------------------------
method StandardDataWin.Connect(input output SessionId: DataAccessSrvBD.SessionId)
begin
--
--	Description : 	Concret definition of the abstract method Connect.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class StandardDataWin
--
--	Pre-condition : Refer to Abstract method of the class StandardDataWin
--
--	Post-condition : Refer to Abstract method of the class StandardDataWin
--
--	Exceptions : Refer to Abstract method of the class StandardDataWin
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN	|	05/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin Connect');
if FrontComm = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_USER, message = 'DataWin.Connect : Attribute FrontComm is NIL');
	Raise e;
end if;
FrontComm.Connect(SessionId);
end method;

------------------------------------------------------------
method StandardDataWin.CopyMnu(input pSubMenuSrc: DisplayProject.Submenu,
	input output pSubMenuDst: DisplayProject.Submenu)
begin
For aMnu in pSubMenuSrc.Children do
	aMnu.clone(Deep=TRUE).Parent = pSubMenuDst;
End for;


end method;

------------------------------------------------------------
method StandardDataWin.Delete
begin
--
--	Description : 	Delete of the current instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is deleted.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/06/1997	|	Creation.
--  JB BRIAUD       |   05/03/1998  |   FlagPanel0 strategy.
--+

Go : Boolean = FALSE;
if DeleteConfirm and FlagPanel0 and not IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.Msg_DELETE_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		AffStatusLine('Suppression annulée...');
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Delete');
	DoBeforeDelete();
	aRecordDesc : ObjectSelfDesc = new;
	AffStatusLine('Suppression en cours...');
	TmpObject : Object;
	DoAffectObject(TmpObject);
	aRecordDesc = (ObjectSelfDesc)(TmpObject);
	For unCach in MyCache.Objects do
		if unCach.Record.Id = CurrentId then
			aRecordDesc.Id = CurrentId;
			aRecordDesc.IdUtlQqo = unCach.Record.IdUtlQqo;
			aRecordDesc.DtMajQqo = unCach.Record.DtMajQqo;
			exit;
		end if;
	End For;
	DeleteRecord(aRecord=aRecordDesc);
	DoAfterDelete();
	Self.AffPosition();
	AffStatusLine('Suppression effectuée...');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Delete : End');
end if;
end method;

------------------------------------------------------------
method StandardDataWin.DeleteEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Delete of an instance of the buffer on reception of a delete event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject : object to delete
--
--	Pre-condition : None
--
--	Post-condition : The object is deleted from the buffer.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

if aObject <> NIL then
	aCacheDesc : CacheDesc = (CacheDesc) (aObject);
	if MyCache.IsInCache(aCacheDesc.Record.Id) then
		Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.DeleteEvent');
		if CurrentId = aCacheDesc.Record.Id then
			CurrentPosition = CurrentPosition - 1;
			AffPosition();
		end if;
		MyCache.Delete(aCacheDesc);
		AffCurPos(CurrentPosition, MyCache.Objects.Items);
	end if;
end if;
end method;

------------------------------------------------------------
method StandardDataWin.DeleteRecord(input aRecord: DataAccessSrvBD.ObjectSelfDesc)
begin
--
--	Description : 	Delete of one instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is deleted.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	30/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.DeleteRecord');
aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
aCacheDesc.Record = aRecord;
MyTransData.TransObject = aCacheDesc;
--MyTransData.TransActionService = ACT_STD_DELETE;
MyTransData.TransActionService = Self.ActionDelete;
Transfer();
MyCache.Delete(aCacheDesc);

end method;

------------------------------------------------------------
method StandardDataWin.DetailAff(input DetailWin: Framework.ClassType)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.DetailAff');

unDetail : StandardDataWin;
unDetail = (StandardDataWin) (DetailWin.InstanceAlloc());
MyControlWin.Display(unDetail);
Self.AffStatusLine('');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.DetailAff : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.DetailAff');
		Raise;

end method;

------------------------------------------------------------
method StandardDataWin.DetailAff(input DetailWin: Framework.ClassType,
	input ModeAff: Framework.integer)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.DetailAff');

unDetail : StandardDataWin;
unDetail = (StandardDataWin) (DetailWin.InstanceAlloc());
MyControlWin.Display(unDetail, ModeAff);
Self.AffStatusLine('');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.DetailAff : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.DetailAff');
		Raise;
	When e : CtrlTooManyInstanceExc do
		Self.AffStatusLine('Trop d''instances de cette fenêtre');

end method;

------------------------------------------------------------
method StandardDataWin.DicoTransfer(input aTransData: DataAccessSrvBD.TransDico): Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method DicoTransfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class StandardDataWin
--
--	Pre-condition : Refer to Abstract method of the class StandardDataWin
--
--	Post-condition : Refer to Abstract method of the class StandardDataWin
--
--	Exceptions : Refer to Abstract method of the class StandardDataWin
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN	|	18/06/1997	|	Creation.
--	D. NGUYEN	|	30/01/1998	|	Encapsulation par DicoTrt.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.DicoTransfer');
if DicoTrt = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'StandardDataWin.DicoTransfer : Attribute DicoTrt is NIL');
	Raise e;
end if;
Return DicoTrt.DicoTransfer(aTransData);

end method;

------------------------------------------------------------
method StandardDataWin.DoAffectObject(output pObject: Framework.Object)
begin
--
--	Description : 	Affectation of the displayed data to the object transmited.
--					This method must be overloaded in the concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Output -->	aObject :	reception Object for data
--
--	Pre-condition : None
--
--	Post-condition : The object contains the data or is empty (NIL) if no data
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.DoAffectObject');
--aClassType : ClassType = OrderDesc;
--aObject = aClassType.InstanceAlloc();
--aOrder : OrderDesc = (OrderDesc) (aObject);
--aOrder.SecurityName = SellSecurityName;
--aOrder.quantity = Sellquantity;
--aOrder.price = Sellprice;

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('StandardDataWin.DoAffectObject');
Self.TraceExc(unExc, 'StandardDataWin.DoAffectObject');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method StandardDataWin.DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc)
begin
--
--	Description : 	Displays the record passed as parameter.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	pRecord : Record to display.
--
--	Pre-condition : The record is not equal to NIL.
--
--	Post-condition : The display is done.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+
--aOrder : OrderDesc = (OrderDesc) (pRecord.Object);
--SellSecurityName = aOrder.SecurityName;
--SellQuantity = aOrder.Quantity;
--SellPrice = aOrder.Price;
--SellRecordId = pRecord.Id;

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('StandardDataWin.DoAffRecord');
Self.TraceExc(unExc, 'StandardDataWin.DoAffRecord');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method StandardDataWin.DoAfterAdd
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoAfterAppend
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoAfterDelete
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoAfterMenuCtxAction(input output pMenuCommand: DisplayProject.MenuCommand)
begin
-- Actions utilisateur à effectuer après sélection et après action :
end method;

------------------------------------------------------------
method StandardDataWin.DoAfterMenuCtxAff(input output pMenuCommand: DisplayProject.MenuCommand)
begin
-- Actions utilisateur à effectuer après sélection et avant action :
-- mise à jour du DataContext par exemple avant le lancement d'un affichage dans le MenuCommand

end method;

------------------------------------------------------------
method StandardDataWin.DoAfterSetDataMode(input DataMode: Framework.integer)
begin
-- Actions utilisateur à effectuer après Changement du mode :
-- Modification d'une partie de l'écran par exemple
Return;
end method;

------------------------------------------------------------
method StandardDataWin.DoAfterUpdate
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoBeforeAdd
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoBeforeAppend
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoBeforeDelete
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoBeforeMenuCtxAff(input output pMenu: DisplayProject.Submenu)
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoBeforeUpdate
begin

end method;

------------------------------------------------------------
method StandardDataWin.DoGestionAppelArrive(input Param1: Framework.string,
	input Param2: Framework.string,
	input Param3: Framework.string,
	input ParamBool: Framework.boolean)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite à surcharg
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('BarreOutilCTIWin.DoGestionMethodModel');
Self.TraceExc(unExc, 'BarreOutilCTIWin.DoGestionMethodModel');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method StandardDataWin.DoGestionChangementEtat(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionCommunicationEtablie
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionCommunicationTerminee
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionConfirmerRendezVous(input ParamBool: Framework.boolean)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionConsultationEtablie
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionConsultationInitialisee
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionConsultationTerminee(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionErreurSoftphone(input Param1: Framework.string)
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--	DN			09/10/1997		Modification suite fiche ano 8
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Affichage du message d'erreur dans la status line
self.AffStatusLine(Param1);

-- Fin du traitement

return;

end method;

------------------------------------------------------------
method StandardDataWin.DoGestionQuitter
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionTransfertAnnule
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoGestionTransfertPrepare
begin
--
--	Description :	Modèle de méthode DoGestionEvenement (Abstraite)
--
--	Type :	Abstrait
--
--	Parametres :	Input	--> 
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	DN			01/09/1997		Creation
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.DoMethodModel');

-- Declarations


-- Traitement

-- Rien par défaut

-- Fin du traitement

return;
end method;

------------------------------------------------------------
method StandardDataWin.DoStdEventNotifier(input pType: Framework.integer,
	input pObject: Framework.Object)
begin
--
--	Description : 	Traitements spécifiques au projet sur Event de type inconnu
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	pRecord : Record to display.
--
--	Pre-condition : The record is not equal to NIL.
--
--	Post-condition : The display is done.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	11/07/1997	|	Creation.
--+

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('StandardDataWin.DoStdEventNotifier');
Self.TraceExc(unExc, 'StandardDataWin.DoStdEventNotifier');
Raise unExc;
-- Fin du traitement

end method;

------------------------------------------------------------
method StandardDataWin.EventLoop
begin
super.EventLoop();

Exception
	when e : CancelException do
		Task.Part.LogMgr.Put('StandardDataWin -> Sortie sur CancelException !!!');
		Task.Part.LogMgr.PutLine(Self.Window.Title);
		Rep : Integer;
		if not Self.IsShutdownConfirmed then
			if Self.<Panel0>.HasDataChanged then
				Rep = Self.Window.Questiondialog(Self.MSG_QUIT_2, BS_YESNO, BV_YES);
				Self.IsShutdownConfirmed = TRUE;
				if Rep = BV_YES then
					Self.SubmitOnShutdown = TRUE;
				else
					Self.SubmitOnShutdown = FALSE;
				end if;		
			end if;
		end if;
		ExitWindow();

	when e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.EventLoop');
		Self.AffStatusLine(e.Message);
		Self.EventLoop();
end method;

------------------------------------------------------------
method StandardDataWin.ExitWindow
begin
--
--	Description : 	Operations done just before closing the window.
--					The current action is finished properly and currents locks are unlocked.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The window is ready to be closed.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.ExitWindow');

if (DataMode = ACT_STD_UPDATE or DataMode = ACT_STD_APPEND) and Self.SubmitOnShutdown then
	Self.Window.DisableInput();
	Submit();
	Self.Window.EnableInput();
end if;

MyTransData.TransActionService = ACT_NTF_DEREGISTEREVENT;
Transfer();

--Self.RegisterClose(Self);

Super.ExitWindow();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.ExitWindow : End');

Exception
	when e : RecordValidityExc do
		Self.Window.EnableInput();
		
		TmpText : TextData = new(Value=e.Message.value);
		e.Message.setValue(e.ItemName);

		uneStructureDesc : StructureDesc;
		uneStructureDesc = GetStructureDesc(BufferStructure, e.ItemName);
		if uneStructureDesc <> NIL then
			e.Message.setValue(uneStructureDesc.ItemUsername);
		end if;
		e.Message.Concat(':');
		e.Message.Concat(TmpText.value);
		Self.Window.PurgeEvents();
		Self.RequestFocusOn(ItemName=e.ItemName,aWidget=<Panel0>);
--		<Panel0>.RequestFocus();
		Self.TraceExc(e, 'StandardDataWin.ExitWindow');
		Raise e;
	When e: GenericException do
		Self.Window.EnableInput();
		Self.TraceExc(e, 'StandardDataWin.ExitWindow');
		Raise e;
		
end method;

------------------------------------------------------------
method StandardDataWin.Fermer
begin
--
--	Description :	Fermeture de la fenêtre.
--
--	Type :	Concret
--
--	Parametres :	Input	-->
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	AUTEUR	  |	JJ/MM/SSAA	|	Intervention.
--	JB BRIAUD	|	05/03/1998	|	Ajout du cartouche.
--	D. NGUYEN	|	17/03/1998	|	Changement de conception : retour au principe d'origine (shutdown).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Fermer');

-- Declarations
Rep : Integer;
	
-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

-- The purpose is to seek for the initwin in the ControlWin.
-- If we are the InitWin then, ShutDown is equal to Quit application.
if Self.MyControlWin <> Nil 
	and Self.MycontrolWin.InitWin = Self 
	and not Self.IsShutdownConfirmed 
	and not FermerEvtFlag then
		Self.Quitter();
		Self.IsShutdownOK = FALSE;
else -- We aren't the InitWin
	Self.IsShutdownOK = TRUE;
	if not Self.IsShutdownConfirmed and Self.<Panel0>.HasDataChanged then
		Rep = Self.Window.Questiondialog(Self.MSG_QUIT_2, BS_YESNOCANCEL, BV_YES);
		Self.IsShutdownConfirmed = TRUE;
		if Rep = BV_YES then
			Self.SubmitOnShutDown = TRUE;
		elseif Rep = BV_NO then
			Self.SubmitOnShutdown = FALSE;
		else
			Self.IsShutdownOK = FALSE;
			Self.SubmitOnShutdown = FALSE;
			Self.IsShutdownConfirmed = FALSE;
		end if;
	elseif not Self.IsShutdownConfirmed and not Self.<Panel0>.HasDataChanged and Self.IsChanged then
		Rep = Self.Window.Questiondialog(Self.MSG_QUIT_2, BS_YESNO, BV_YES);
		Self.IsShutdownConfirmed = TRUE;
		if Rep = BV_YES then
			Self.SubmitOnShutDown = TRUE;
		else
			Self.SubmitOnShutdown = FALSE;
		end if;
	end if;
end if;
if Self.IsShutdownOK then
	Self.IsShutdownConfirmed = FALSE;
	Self.ExitWindow();
	if Self.MyControlWin <> NIL then
		Post Self.MyControlWin.FermerEvt;
	end if;
end if;


-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Fermer : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.Fermer');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.GestionChangementEtat(input pEtat: Framework.string)
begin
--
--	Description :		Réaction à l'evènement ChangementEtat
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--	DN			31/12/1997		Correction bug (fiche anno 13)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.GestionChangementEtat');

-- Declarations

unEtat : string = pEtat;

-- Traitement

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,'EEEEEEEEEEEEEE Etat :');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1,pEtat);


if (unEtat = CTI_ET_NOTLOGGED) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_AUTOIN) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.SonnerieEnCours = FALSE;
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_ENABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_LIBRE) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	if (self.SonnerieEnCours) then
		<DecrocheBtn>.State = FS_ENABLE;
		<PauseBtn>.State = FS_DISABLE;
		Self.EtatCti.SetValue(Source = '00:00');
	else
		<DecrocheBtn>.State = FS_DISABLE;
		<PauseBtn>.State = FS_ENABLE;
	end if;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
--	DN 31/12 <PauseBtn>.State = FS_ENABLE; 
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_OCCUPE) then --1
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_ENABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_ENABLE;
	<TransfertBtn>.State = FS_ENABLE;
	<PauseBtn>.State = FS_DISABLE;
	if (EnregistrementAutomatique) then --11
		<Enregistrer>.State = FS_DISABLE;
	else --11
		-- On peut déclencher l'enregistrement sélectif
		<Enregistrer>.State = FS_ENABLE;
	end if; --11

elseif (unEtat = CTI_ET_PAUSE) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_DISABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_ENABLE;
	<Enregistrer>.State = FS_DISABLE;

elseif (unEtat = CTI_ET_ACW) then --1
	Self.EtatCti.SetValue(Source = unEtat);
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_ENABLE;
	<AttenteBtn>.State = FS_DISABLE; 
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_ENABLE; -- A la place de DISABLE
	<Enregistrer>.State = FS_DISABLE;
		
elseif (unEtat = CTI_ET_ATTENTE) then --1
	self.<CtiOutilsGrid>.STATE = FS_ENABLE;
	<DecrocheBtn>.State = FS_DISABLE;
	<RaccrocheBtn>.State = FS_DISABLE;
	<LibererBtn>.State = FS_DISABLE;
	<AttenteBtn>.State = FS_ENABLE;
	<TransfertBtn>.State = FS_DISABLE;
	<PauseBtn>.State = FS_DISABLE;
	<Enregistrer>.State = FS_DISABLE;
else --1
	-- C'est pas prévu
end if; --1

self.DoGestionChangementEtat(pEtat);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.GestionChangementEtat : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.GestionChangementEtat');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.GestionEtatSync(input pEtat: Framework.string,
	input pEnregAuto: Framework.boolean,
	input pEnregEnCours: Framework.boolean,
	input pSonnerieEnCours: Framework.boolean,
	input pTimer: Framework.string,
	input pTransfertPrepare: Framework.boolean)
begin
--
--	Description :		Réaction à l'evènement EtatSync
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--	DN			31/12/1997		Correction bug (fiche ano 13)
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.GestionEtatSync');

-- Declarations

-- Traitement

self.EnregistrementAutomatique = pEnregAuto;
self.EnregistrementEnCours = pEnregEnCours;
self.SonnerieEnCours = pSonnerieEnCours;

if (EnregistrementAutomatique) then
	self.<Enregistrer>.state = FS_DISABLE;
else
	self.<Enregistrer>.state = FS_ENABLE;
end if;

if (EnregistrementEnCours) then
	self.<Enregistrer>.ImageValue = self.<FinEnregistrer>.ImageValue;
else
	self.<Enregistrer>.ImageValue = self.ImageEnr;
end if;

if ((pEtat = CTI_ET_OCCUPE) and (self.EtatCti.value = CTI_ET_NOTLOGGED)) then
	-- Demarrage de la fenêtre
	self.GestionChangementEtat(pEtat=pEtat);
elseif (pEtat <> CTI_ET_OCCUPE) and (pEtat <> self.EtatCti.value) then
	self.GestionChangementEtat(pEtat=pEtat);
elseif (self.SonnerieEnCours) then				-- DN 31/12
	self.GestionChangementEtat(pEtat=pEtat);
end if;

if (pTransfertPrepare) then
	self.<CtiOutilsGrid>.state = FS_DISABLE;
end if;

if (pEtat = CTI_ET_OCCUPE) or (pEtat = CTI_ET_ATTENTE) then
	self.EtatCti.value = pTimer;
else
	self.<Enregistrer>.state = FS_DISABLE;
end if;


-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.GestionEtatSync : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.GestionEtatSync');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.Init
begin
--
--	Description : 	Initialisation of the window.
--					This method must be overloaded in concret level for the access to service objects,
--					but it's recommanded to call the super before.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The characteritics of the window are positionned.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--	D. NGUYEN		|	30/10/1997	|	Ajout du DicoTypeLib.
--+

super.Init();
--InitAddValues = new;
MyCache = new;
StdEventNotifier = new;
--BufferStructure = new;
CurPos = new;

Self.IsshutdownConfirmed = FALSE;
Self.SubmitOnShutdown = FALSE;
Self.IsShutdownOK = FALSE;
Self.FermerEvtFlag = FALSE;

-- MyDataContext = SoControlWin.MyDataContext;
-- MyTransType = SoBusinessTransactionService; -- BusinessTransactionService Définition
-- MyClassType = BusinessTransactionService; -- ClassType of the Service for BusinessTransactionService
-- Self.DicoServiceMgr = SoDictionaryBSMgr; -- Dictionary Service Manager Définition
Self.DicoService = DictionaryService; -- ClassType of the Service for DictionaryService
Self.DicoTrt = new();
--Self.DicoTrt.DicoServiceMgr = Self.DicoServiceMgr;
Self.DicoTrt.DicoService =Self.DicoService;
Self.DicoTrt.TransferTrt.TrfRessource = Self;

MyTransData = new;
FirstRead = TRUE;

OrigFillColor = <Panel0>.FillColor;


MaximumInstance = 9999;		-- Maximum number of instance displayed

AddPolicy = 0;				-- 0 : Create a new element with reset
							-- 1 : Create a new element with copy of current

ViewMode = FS_UPDATE;		-- FS_UPDATE : Update
							-- FS_VIEONLY : View Only

FlagAppend = TRUE; 			-- TRUE : permis, FALSE interdit

FlagUpdate = TRUE; 			-- TRUE : permis, FALSE interdit

FlagDelete = TRUE; 			-- TRUE : permis, FALSE interdit

FlagRead = TRUE; 			-- TRUE : permis, FALSE interdit

FlagExecute = TRUE; 		-- TRUE : permis, FALSE interdit

AddConfirm = TRUE;			-- Confirmation before Add (TRUE=YES, FALSE=NO)

AppendConfirm = TRUE;		-- Confirmation before Append (TRUE=YES, FALSE=NO)

DeleteConfirm = TRUE;		-- Confirmation before Delete (TRUE=YES, FALSE=NO)

UpdateConfirm = TRUE;		-- Confirmation before update (TRUE=YES, FALSE=NO) 

ValidateConfirm = FALSE;	-- Confirmation before validation on <SauverBtn>.Click

FlagPanel0    = FALSE;		-- Panel0 focus strategy. Default is currently FALSE.
							-- The Panel0 strategy consist in testing if the focus
							-- is lost by Panel0 and then ask for confirmation
							-- depending of xxxConfirm flag.
							-- If FlagPanel0 is FALSE the stategy consist in
							-- apply a Microsoft like stategy. That is to say :
							-- ask for confirmation, WITHOUT depending of xxxConfirm flag,
							-- by a Yes, No Cancel dialog box.

PlayValidity = TRUE;		-- Play the validity control before append and update (TRUE=YES, FALSE=NO) 

Self.FlagCTI = FALSE;       -- CTI integration (default value is FALSE=NO).

Self.DicoTypeLib = DICO_TYPLIB_STD;	-- Stratégie de récupération des libellés du dictionnaire :
									-- DICO_TYPLIB_STD = Libellés dico standards (LibElement),
									-- DICO_TYPLIB_COD = Libellés dico Codes (CodElement).

Self.ActionAppend	= ACT_STD_APPEND;
Self.ActionDelete	= ACT_STD_DELETE;
Self.ActionRead		= ACT_STD_READ;
Self.ActionUpdate	= ACT_STD_UPDATE;
end method;

------------------------------------------------------------
method StandardDataWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : 	Initialisation of the display of window.
--					This method must be overloaded in concret level for the access to service objects,
--					but it's recommanded to call the super before.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The characteritics of the window are positionned.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN	|	03/06/1997	|	Creation.
--	D. NGUYEN	|	06/02/1998	|	Prise en compte des habilitations.
--	D. NGUYEN	|	06/02/1998	|	Correction de bug sur le ViewMode.
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitDisplay');

	Self.DicoTrt.FrontComm=Self.FrontComm;
	Self.DicoTrt.DicoServiceMgr = Self.DicoServiceMgr;
	
	Self.ResetAttributes(Self.BufferStructure);
	
	Self.Connect(SessionId); -- To be defined in concret level
	MyTransData.TransSessionId = SessionId; -- To be defined in concret level

	Self.SessionUser = MyControlWin.SessionUser;

	-- Init of the FillInFields of the window
	if DicoService <> NIL and DicoServiceMgr <> NIL then
		Self.InitFillInFields(<Panel0>, Self.DicoTypeLib);
	end if;

	if InitAddValues = NIL then
		InitAddValues = BufferStructure.Clone(Deep=TRUE);
	elseif not InitAddValues.IsA(Type=BufferStructure.GetclassType()) then
		InitAddValues = BufferStructure.Clone(Deep=TRUE);
	end if;

	Self.ResetSelfDesc(Self.InitAddValues);

	aStandardPictures : StandardPictures = new;
	
	-- Habilitations
	if PLAY_SECURITY then
		if Self.ActionHab.IsAuthorisedFor(ACT_STD_EXECUTE) then
			if not Self.ActionHab.IsAuthorisedFor(ACT_STD_APPEND) then
				Self.FlagAppend = FALSE;
			end if;
			if not Self.ActionHab.IsAuthorisedFor(ACT_STD_UPDATE) then
				Self.FlagUpdate = FALSE;
			end if;
			if not Self.ActionHab.IsAuthorisedFor(ACT_STD_DELETE) then
				Self.FlagDelete = FALSE;
			end if;
			if not Self.ActionHab.IsAuthorisedFor(ACT_STD_READ) then
				Self.FlagRead = FALSE;
			end if;
			if not Self.ActionHab.IsAuthorisedFor(ACT_STD_APPEND) and
				not Self.ActionHab.IsAuthorisedFor(ACT_STD_UPDATE) and
				not Self.ActionHab.IsAuthorisedFor(ACT_STD_DELETE) then
				Self.ViewMode = FS_VIEWONLY;
			end if;
				
		else
			TmpPar1 : TextData = new(value='StandardDataWin.InitDisplay');
			TmpPar2 : IntegerData = new(value=ACT_STD_EXECUTE);
			e : SecurityExc = new();
			e.message.ReplaceParameters(
				Source = e.message,
				Parameter1=TmpPar1,
				Parameter2=TmpPar2);
			raise e;
		end if;
	end if;
	-- Fin Habilitations

	-- Cohérence ViewMode et Flags
	Self.SetViewMode(Self.ViewMode);
	-- Fin Cohérence ViewMode et Flags

	-- Abonnements au notifier
	MyTransData.TransActionService = ACT_NTF_REGISTEREVENT;
	Transfer();

	if Self.FlagRead = TRUE then
		if WithReadData then
			read();
			AffFirstPosition();
		else
			aTransClass : TransClass = new;
			MyTransData = aTransClass;
			Self.FirstRead = FALSE;
		end if;
		SetDataMode(ACT_STD_READ);
	end if;

if Self.FlagCTI then
	-- Initialisation des attributs propres à la barre d'outil CTI
	self.EtatCti = new(value=CTI_ET_NOTLOGGED);
	
	self.EnregistrementAutomatique = FALSE;
	self.EnregistrementEnCours = FALSE;
	ImageEnr = new(value=self.<Enregistrer>.ImageValue.Value);
--	Self.RegisterToCti();
elseif Self.<CtiOutilsGrid> <> NIL then
	Self.<CtiOutilsGrid>.State = FS_INVISIBLE;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitDisplay : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e,'StandardDataWin.InitDisplay');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.InitFillInFields(input aWidget: DisplayProject.Widget,
	input pTypeLib: Framework.integer = 0)
begin
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitFillInFields');

DicoTrt.InitFillInFields(aWidget, Self.BufferStructure, pTypeLib);

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitFillInFields : End');

Return;
end method;

------------------------------------------------------------
method StandardDataWin.InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitFillInFields');

DicoTrt.InitFillInFields(aWidget, pBufferStructure, pTypeLib);

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitFillInFields : End');

Return;
end method;

------------------------------------------------------------
method StandardDataWin.InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.InitRecordDicoValues');

Self.DicoTrt.InitRecordDicoValues(aRecordSelfDesc, pTypeLib);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.InitRecordDicoValues : End');

Return;
end method;

------------------------------------------------------------
method StandardDataWin.MenuCtxAff(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input pX: Framework.integer,
	input pY: Framework.integer): DisplayProject.MenuCommand
begin
aResult : Menucommand;
if unMenuName <> '' then
	unMenu : MenuGroup = MyControlWin.GetMenu(unMenuName);
	if unMenu <> NIL then
		unMenuCtxWin : MenuCtx = new;
		unMenuCtx : GridField = unMenuCtxWin.<MenuCtxGrid>;
		unMenuCmd : TextGraphic;
		unMenuSep : Line;
		i : integer;
		For unMenuItem in unMenu.Children do
			i = i + 1;
			if unMenuItem.IsA(Type=MenuCommand) then
				unMenuCmd = unMenuCtxWin.<ModCmd>.Clone(Deep=TRUE);
				unMenuCmd.Row = i;
				unMenuCmd.Text.setValue(unMenuItem.Text.Value);
				unMenuCmd.AppData = unMenuItem;
				unMenuCmd.State = FS_SELECTONLY;
				unMenuCmd.Parent = unMenuCtx;
			elseif unMenuItem.IsA(Type=MenuSeparator) then
				unMenuSep = unMenuCtxWin.<ModSep>.Clone(Deep=TRUE);
				unMenuSep.Row = i;
				unMenuSep.WidthPolicy = SP_TO_PARENT; -- Bug Forté ?				
				unMenuSep.AppData = unMenuItem;
				unMenuSep.State = FS_INACTIVE;
				unMenuSep.Parent = unMenuCtx;
			end if;
		end for;
		unMenuCtxWin.Window.InitialX = pX + unWidget.XAbsolute;
		unMenuCtxWin.Window.InitialY = pY + unWidget.YAbsolute;

		uneTask : TaskDesc;
		Self.Window.PurgeEvents();
		Event Loop
			Postregister
				uneTask = Start task unMenuCtxWin.Display() where completion = Event;
			When unMenuCtxWin.DisplayDone(uneCommande) do
				Self.AffStatusLine('');
				aResult = uneCommande;
				exit;
			When unMenuCtxWin.DisplayExc(uneExc) do -- Attention traitement à affiner
				aResult = NIL;
				exit;
			When Self.Window.ChildClick do
				uneTask.PostShutDown();
				exit;
			When Self.Window.ChildClickouter do
				uneTask.PostShutDown();
				exit;
		End event;

	end if;
end if;

if aResult <> NIL then
	Self.DoAfterMenuCtxAff(aResult);
end if;

Return aResult;
end method;

------------------------------------------------------------
method StandardDataWin.MenuCtxAff(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string)
begin
if unMenuName <> '' then
	unMenu : SubMenu = MyControlWin.GetMenu(unMenuName);
	Self.DoBeforeMenuCtxAff(unMenu);
	if unMenu <> NIL then
		Self.ResetMnu(Self.<CtxtPopUp>);
		Self.CopyMnu(unMenu,Self.<CtxtPopUp>);
		unWidget.PopUpMenu = Self.<CtxtPopUp>;
	end if;
end if;


Return;
end method;

------------------------------------------------------------
method StandardDataWin.PostEventLoop
begin
super.PostEventLoop();
if Self.FlagCTI then
	Self.RegisterToCti();
end if;
end method;

------------------------------------------------------------
method StandardDataWin.Quitter
begin
--
--	Description :	Quitte l'application.
--
--	Type :	Concret
--
--	Parametres :	Input	-->
--					Output	-->
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	JB BRIAUD	|	05/03/1998	|	Initial version.
--	D. NGUYEN	|	22/03/1998	|	Debug from Forte "bug" on Main task.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Quitter');

-- Declarations
Rep : Integer;

-- Verification des pre-conditions
-- Fin de verification des pre-conditions

-- Traitement

if Self.<Panel0>.HasDataChanged then
	Rep = Self.Window.Questiondialog(Self.MSG_QUITALL_3, BS_YESNOCANCEL, BV_CANCEL);
	if Rep = BV_NO then
		Self.<Panel0>.HasDataChanged = FALSE;
		SetDataMode(ACT_STD_READ);
		Self.IsShutdownConfirmed = TRUE;
		Self.SubmitOnShutdown = FALSE;
		Self.IsShutdownOK = TRUE;
	elseif Rep = BV_YES then
		Self.SubmitOnShutdown = TRUE;
		Self.IsShutdownConfirmed = TRUE;
		Self.IsShutdownOK = TRUE;
	else
		Self.IsShutdownOK = FALSE;
		Self.SubmitOnShutdown = FALSE;
		Self.IsShutdownConfirmed = FALSE;
	end if;
else -- HasDatachanged
	Rep = Self.Window.Questiondialog(Self.MSG_QUITALL_2, BS_YESNO, BV_NO);
	Self.SubmitOnShutdown = FALSE;
	if Rep = BV_YES then
		Self.IsShutdownConfirmed = TRUE;
		Self.IsShutdownOK = TRUE;
	else
		Self.IsShutdownConfirmed = FALSE;
		Self.IsShutdownOK = FALSE;
	end if;
end if; -- HasDataChanged

if Self.IsShutdownOK then
	DoBeforeQuitApplication();
	if Self.MyControlWin.InitWin <> NIL then
		start task MyControlWin.Quitter();
	else
		self.Fermer();
	end if;
	
end if;

-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Quitter : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'StandardDataWin.Quitter');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.Read
begin
--
--	Description : 	Read of the data flow and alimentation of the window buffer.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Read');

aTransClass : ClassType = TransClass;
Self.MyTransData = (TransClass)(aTransClass.InstanceAlloc());
--MyTransData.TransActionService = ACT_STD_READ;
Self.MyTransData.TransActionService = Self.ActionRead;
if Self.MyDataContext <> NIL then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Read : DataContext <> NIL');
	(TransClass)(MyTransData).aRecordSelfDesc = Self.MyDataContext;
else
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Read : DataContext = NIL');
	(TransClass)(MyTransData).aRecordSelfDesc = NIL;
end if;

MyTransData.TransObject = Transfer();
aObjects : Array of Object = (Array of Object)(MyTransData.TransObject);

if aObjects <> NIL then
	MyCache.Append(aObjects);
else
	MyCache.Objects.Clear();
end if;
FirstRead = FALSE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Read : After Read -> nb Items ');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, MyCache.Objects.Items);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Read : End');

Return;

Exception 

	When e : GenericException do
		Self.TraceExc(e,'StandardDataWin.Read');
		Raise;
end method;

------------------------------------------------------------
method StandardDataWin.RegisterClose(input aWindow: DisplayBD.StandardWin)
begin
--
--	Description : 	Registering of the close of the window in the window controler.
--					This method must be overloaded in concret level to define the name
--					of the window controler service object 
--
--	Type :	Abstract
--
--	Parametres :	Input -->	aWindow :	Window to close
--
--	Pre-condition : The Window exists
--
--	Post-condition : The window is no more referenced in the controler.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

MyControlWin.RegisterClose(aWindow);
Return;
end method;

------------------------------------------------------------
method StandardDataWin.RegisterClose
begin
Self.RegisterClose(Self);
end method;

------------------------------------------------------------
method StandardDataWin.RegisterToCTI
begin
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_INITIALISERCTI);
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_REGISTERNOTIFIER, self.StdEventNotifier);
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_SYNCCTI);
end method;

------------------------------------------------------------
method StandardDataWin.ResetAttributes(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc)
begin
pRecordSelfDesc.DoResetAttributes();
pRecordSelfDesc.SelfDesc = new();
Self.ResetSelfDesc(pRecordSelfDesc);
For unItem in pRecordSelfDesc.SelfDesc do
	if unItem.ItemReference <> NIL then
		if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
			Self.ResetAttributes((ObjectSelfDesc)(unItem.ItemReference));
		end if;
	end if;
End for;
end method;

------------------------------------------------------------
method StandardDataWin.ResetMnu(input output pSubMenu: DisplayProject.Submenu)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.ResetMnu');

TmpMnu : Submenu;
For aMnu in pSubMenu.Children do
	aMnu.Parent = NIL;
	Self.ResetMnu(pSubMenu);
End for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.ResetMnu : End');

end method;

------------------------------------------------------------
method StandardDataWin.ResetSelfDesc(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc)
begin
pRecordSelfDesc.SelfDesc = new();
pRecordSelfDesc.DoResetSelfDesc();
For unItem in pRecordSelfDesc.SelfDesc do
	if unItem.ItemReference <> NIL then
		if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
			Self.ResetSelfDesc((ObjectSelfDesc)(unItem.ItemReference));
		end if;
	end if;
End for;
end method;

------------------------------------------------------------
method StandardDataWin.ResetWindow
begin
--
--	Description : 	Resets the fields of the window.
--					This method should be overloaded in concrete level.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin ResetWindow');
--aRecord : RecordDesc = new;
--aRecord.object = InitAddValues.clone(Deep=TRUE);
--DoAffRecord(pRecord=aRecord);
DoAffRecord(InitAddValues.clone(Deep=TRUE));
Return;
end method;

------------------------------------------------------------
method StandardDataWin.SetDataMode(input DataMode: Framework.integer)
begin
--
--	Description : 	Defines the access mode to the window (insert, update, delete, read, lock, unlock)
--					in fonction of the access type wanted.
--
--	Type :	Abstract
--
--	Parametres :	Input -->	DataMode :	Access Mode wanted.
--
--	Pre-condition : None
--
--	Post-condition : The access to the panel0 and the mode are updated
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.SetDataMode');
Self.DataMode = DataMode;

Case DataMode is

	When ACT_STD_APPEND do
		CurMode = 'Ajout';
		<Panel0>.State = FS_UPDATE;

	When ACT_STD_UPDATE do
		if Self.FlagUpdate = TRUE then
			CurMode = 'Modification';
			<Panel0>.State = FS_UPDATE;
		end if;

	When ACT_STD_DELETE do
		CurMode = 'Effacement';
		<Panel0>.State = FS_VIEWONLY;

	When ACT_STD_READ do
		CurMode = 'Lecture';
		<Panel0>.State = FS_VIEWONLY;

	Else do
		unExc : GenericExc = new;
		unExc.SetWithParams(severity = SP_ER_ERROR, 
			message = 'Cas non connu en SetDataMode : %1',
			param1 = IntegerData(value = DataMode));
		Raise unExc;
end case;

Self.DoAfterSetDataMode(DataMode);

Self.Window.UpdateFieldFromData();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.SetDataMode : End');

Return;

end method;

------------------------------------------------------------
method StandardDataWin.SetViewMode(input aViewMode: Framework.integer)
begin
--
--	Description : 	Sets the view mode of the window.
--
--	Type :	Concret
--
--	Parametres :	Input -->	aViewMode :	FS_VIEWONLY, FS_UPDATE.
--
--	Pre-condition : None
--
--	Post-condition : The window is set on the view or update mode
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	14/08/1996	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.SetViewMode');

if aViewMode = FS_VIEWONLY then
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '	aViewMode : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, aViewMode);
	Self.Window.State = FS_VIEWONLY;
	<SauverBtn>.State = FS_DISABLE;
	<AjouterBtn>.State = FS_DISABLE;
	<SupprimerBtn>.State = FS_DISABLE;
	<Panel0>.FillColor = DSP_CONSULTCOLOR;
else
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '	FlagAppend : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, Self.FlagAppend);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '	FlagUpdate : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, Self.FlagUpdate);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '	FlagDelete : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, Self.FlagDelete);
	Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, '	FlagRead : ');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 10, Self.FlagRead);
	Self.Window.State = FS_UPDATE;
	<SauverBtn>.State = FS_ENABLE;
	if FlagAppend then
		<AjouterBtn>.State = FS_ENABLE;
	else
		<AjouterBtn>.State = FS_DISABLE;
	end if;
	if FlagDelete then
		<SupprimerBtn>.State = FS_ENABLE;
	else
		<SupprimerBtn>.State = FS_DISABLE;
	end if;
	<Panel0>.FillColor = OrigFillColor;
end if;
Self.ViewMode = aViewMode;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.SetViewMode : End');

end method;

------------------------------------------------------------
method StandardDataWin.SetViewPolicy(input aViewPolicy: Framework.integer)
begin
--
--	Description : 	Sets the view Policy of the window.
--
--	Type :	Concret
--
--	Parametres :	Input -->	aViewPolicy :	DTA_VIEWOPTION_ACTIVE, DTA_VIEWOPTION_INACTIVE.
--
--	Pre-condition : None
--
--	Post-condition : The window is set on the view or update mode
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	14/08/1996	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin SetViewPolicy');
Case aViewPolicy is
	When DTA_VIEWOPTION_ACTIVE Do
--		<View>.State = MS_ENABLE;
--		<ViewTool>.State = FS_ENABLE;
	When DTA_VIEWOPTION_INACTIVE Do
--		<View>.State = MS_INVISIBLE;
--		<ViewTool>.State = FS_INVISIBLE;
end case;
end method;

------------------------------------------------------------
method StandardDataWin.Submit
begin
--
--	Description : 	Begins the automatical actions linked to changements
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.Submit');

if ViewMode = FS_UPDATE then
	case DataMode is
		When ACT_STD_APPEND do
			Append();
			AffPosition();
			<Panel0>.HasDataChanged = FALSE;
			SetDataMode(ACT_STD_READ);
		When ACT_STD_UPDATE do
			-- Searching for Real Update
			if <Panel0>.HasDataChanged or Self.IsChanged then
				Update();
				<Panel0>.HasDataChanged = FALSE;	
				Self.IsChanged = FALSE;
				SetDataMode(ACT_STD_READ);
			else
				-- UnlockRequired();
				SetDataMode(ACT_STD_READ);
			end if;
			AffPosition();
		when ACT_STD_DELETE do
			Delete();
			<Panel0>.HasDataChanged = FALSE;
			Self.IsChanged = FALSE;
			SetDataMode(ACT_STD_READ);
			AffPosition();
		when ACT_STD_READ do
			if FirstRead then
				if Self.FlagRead = TRUE then
					Read();
					AffFirstPosition();
					<Panel0>.HasDataChanged = FALSE;
					Self.IsChanged = FALSE;
					SetDataMode(ACT_STD_READ);
				end if;
			end if;
	end case;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.Submit : End');

Return;

Exception
	When e: GenericException do
		Self.Window.EnableInput();
		Self.TraceExc(e, 'StandardDataWin.Submit');
		Raise e;
end method;

------------------------------------------------------------
method StandardDataWin.TransfertCTI
begin
--
--	Description :		Debut d'un transfert
--
--	Type :	Abstrait/Concret
--
--	Parametres :	Input	--> 
--					Output	--> 
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Utilisation : Global
--
--	Historique :
--
--	AUTEUR	|	JJ/MM/SSAA	|	Intervention.
--	DN			21/08/1997		Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- BarreOutilCTIWin.TransfertCTI');

-- Declarations

-- Traitement
Self.MyControlWin.MyActionMgr.Action(ACT_CTI_PREPARETRANSFERT);

hWin : MCTransfertWin = new();
Self.MyControlWin.Display(hWin,CTW_ASYNCDISP);

-- Fin du traitement

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- BarreOutilCTIWin.TransfertCTI : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'BarreOutilCTIWin.TransfertCTI');
		Raise;

end method;

------------------------------------------------------------
method StandardDataWin.Update
begin
--
--	Description : 	Update of the current instance of the data flow.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : The Instance exists
--
--	Post-condition : The instance has been updated
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--  JB BRIAUD       |   05/03/1998  |   FlagPanel0 strategy.
--+

Go : Boolean = FALSE;
if UpdateConfirm and FlagPanel0 and IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_UPDATE_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin Update');
	aRecordDesc : ObjectSelfDesc = new;

	AffStatusLine('Mise à jour en cours...');
	TmpObject : Object;
	DoAffectObject(TmpObject);
	aRecordDesc = (ObjectSelfDesc)(TmpObject);
	For obj in MyCache.Objects do
		if obj.Record.id = CurrentId then
			aRecordDesc.Id = obj.Record.Id;
			aRecordDesc.DtMajQqo = obj.Record.DtMajQqo;
			aRecordDesc.IdUtlQqo = obj.Record.IdUtlQqo;
			exit;
		end if;
	End for;
	TmpMessage : TextData = new();
	TmpWarning : Warning;
	if Self.PlayValidity then
		TmpRecordSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(aRecordDesc);
		InitRecordDicoValues(TmpRecordSelfDesc, Self.DicoTypeLib);
		TmpRecordSelfDesc.DoCheckValidity();
		TmpWarning = TmpRecordSelfDesc.DoCheckWarning();
		if TmpWarning <> NIL then
			TmpMessage = TmpWarning.Message;
			TmpMessage.Concat('\n');
		end if;
	end if;
	DoBeforeUpdate();
	UpdateRecord(aRecord=aRecordDesc);
	DoAfterUpdate();
	TmpMessage.Concat('Mise à jour effectuée...');
	AffStatusLine(TmpMessage);
	AffPosition();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- StandardDataWin After Update');
else
	AffStatusLine('Mise à jour annulée...');
end if;

Return;

Exception 

	When e: RecordValidityExc do
		TmpText : TextData = new(Value=e.Message.value);
		e.Message.setValue(e.ItemName);

		uneStructureDesc : StructureDesc;
		uneStructureDesc = GetStructureDesc(BufferStructure, e.ItemName);
		if uneStructureDesc <> NIL then
			e.Message.setValue(uneStructureDesc.ItemUsername);
		end if;
		e.Message.Concat(':');
		e.Message.Concat(TmpText.value);
		Self.Window.PurgeEvents();
		Self.RequestFocusOn(ItemName=e.ItemName,aWidget=<Panel0>);
--		<Panel0>.RequestFocus();
		Raise e;
	When e: GenericException do
		Self.Window.PurgeEvents();
		<Panel0>.RequestFocus();
		Raise;

end method;

------------------------------------------------------------
method StandardDataWin.UpdateEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Delete of an instance of the buffer on reception of a delete event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject : object to delete
--
--	Pre-condition : None
--
--	Post-condition : The object is deleted from the buffer.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

if aObject <> NIL then
	aCacheDesc : CacheDesc = (CacheDesc) (aObject);
	if aCacheDesc.Record.IsA(Type=Self.Bufferstructure.GetClassType()) then
		if MyCache.IsInCache(aCacheDesc.Record.Id) then
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.UpdateEvent');
			MyCache.Update(aCacheDesc);
			if CurrentId = aCacheDesc.Record.Id then
				AffPosition();
				AffStatusLine('Données mise à jour par un autre utilisateur...');
			end if;
			AffCurPos(CurrentPosition, MyCache.Objects.Items);
		end if;
	else
		-- Traitement du composant
		TmpObj : ObjectSelfDesc = aCacheDesc.Record;
		TmpObjClass : ClassType = TmpObj.GetClassType();
		FlagMaj : Boolean = FALSE;
		For aCach in Self.MyCache.Objects do
			TmpRec : ObjectSelfDesc = aCach.Record;
			if TmpRec.SelfDesc = NIL then
				TmpRec.SelfDesc = new();
			end if;
			if TmpRec.SelfDesc.Items = 0 then
				TmpRec.DoResetSelfDesc();
			end if;
			For aInst in TmpRec.SelfDesc do
				if aInst.ItemReference.IsA(Type=TmpObjClass) then
					TmpRecObj : ObjectSelfDesc = (ObjectSelfDesc)(aInst.ItemReference);
					if TmpRecObj.Id = TmpObj.Id then
--						TmpRecObj = TmpObj;
						Self.BusinessClassMaj(TmpRecObj,TmpObj);
						if aCach.Record.Id = CurrentId then
							FlagMaj = TRUE;
						end if;
					end if;
				end if;
			end for;
			TmpRec.SelfDesc = NIL;
		end for;
		if FlagMaj then
			AffPosition();
			AffStatusLine('Données mise à jour par un autre utilisateur...');
		end if;
	end if;
end if;
end method;

------------------------------------------------------------
method StandardDataWin.UpdateRecord(input aRecord: DataAccessSrvBD.ObjectSelfDesc)
begin
--
--	Description : 	Update of one instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is updated.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	03/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDataWin.UpdateRecord');
aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
aCacheDesc.Record = aRecord;
MyTransData.TransObject = aCacheDesc;
--MyTransData.TransActionService = ACT_STD_UPDATE;
MyTransData.TransActionService = Self.ActionUpdate;
aCacheDesc = (CacheDesc)(Transfer());
MyCache.Update(aCacheDesc);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDataWin.UpdateRecord : End');
Return;

Exception 

	When e:DuplicateKeyExc do
		Raise;
end method;

------------------------------------------------------------
event handler StandardDataWin.ArrayEvh(input pWidget: DisplayProject.ArrayField)
begin
--
--	Description : 	Evènements à traiter pour un ArrayField.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--	D. NGUYEN		|	31/12/1997	|	Prise en compte du changement du widget.
--+
When pWidget.AfterRowAppend(NewObject=NewObject) do
	if newObject.IsA(Type=ObjectSelfDesc) then
		(ObjectSelfDesc)(NewObject).DoResetAttributes();
		pWidget.UpdateFieldFromData();
		pWidget.HasDataChanged = TRUE;
	end if;

end event;

------------------------------------------------------------
event handler StandardDataWin.BriqueCompoundChildEvh(input unWidget: DisplayProject.CompoundField,
	input unMenuName: Framework.string,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL)
begin
When unWidget.ChildDoubleClick do
	-- déclenchement de l'action
	Self.MyControlWin.MyActionMgr.Action(unDetail,unObjet);
	Self.AffStatusLine('');

When unWidget.ChildClickOuter() do
	-- Affichage du menu contextuel
	Self.MenuCtxAff(unWidget,unMenuName);


end event;

------------------------------------------------------------
event handler StandardDataWin.BriqueCompoundEvh(input unWidget: DisplayProject.CompoundField,
	input unMenuName: Framework.string,
	input WithChild: Framework.boolean = TRUE,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL)
begin
if WithChild then
	register BriqueCompoundChildEvh(unWidget, unMenuName, unDetail, unObjet);
end if;

When unWidget.DoubleClick do
	-- déclenchement de l'action
	Self.MyControlWin.MyActionMgr.Action(unDetail,unObjet);
	Self.AffStatusLine('');

When unWidget.ClickOuter() do
	-- Affichage du menu contextuel
	Self.MenuCtxAff(unWidget,unMenuName);


end event;

------------------------------------------------------------
event handler StandardDataWin.BriqueEvh(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input WithChild: Framework.boolean = TRUE,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL)
begin
if unWidget.Isa(CompoundField) then
	register BriqueCompoundEvh((CompoundField)(unWidget), unMenuName, WithChild, unDetail, unObjet);
else
	register BriqueFieldWidgetEvh(unWidget, unMenuName, unDetail, unObjet);
end if;
/*
When unWidget.DoubleClick do
	-- déclenchement de l'action
	Self.MyControlWin.MyActionMgr.Action(unDetail,unObjet);
	Self.AffStatusLine('');

When unWidget.ClickOuter() do
	-- Affichage du menu contextuel
	Self.MenuCtxAff(unWidget,unMenuName);
*/

end event;

------------------------------------------------------------
event handler StandardDataWin.BriqueFieldWidgetEvh(input unWidget: DisplayProject.FieldWidget,
	input unMenuName: Framework.string,
	input unDetail: Framework.integer = 0,
	input unObjet: Framework.Object = NIL)
begin

When unWidget.DoubleClick do
	-- déclenchement de l'action
	Self.MyControlWin.MyActionMgr.Action(unDetail,unObjet);
	Self.AffStatusLine('');
/*
When unWidget.ClickOuter(X_I = x, Y_I = y) do
	-- Affichage du menu contextuel
	unMenuCommand : Menucommand = Self.MenuCtxAff(unWidget,unMenuName,X_I, Y_I);
	if unMenuCommand <> NIL then
		Self.MyControlWin.MyActionMgr.Action(unMenuCommand);
	end if;
*/

When unWidget.ClickOuter() do
	-- Affichage du menu contextuel
	Self.MenuCtxAff(unWidget,unMenuName);


end event;

------------------------------------------------------------
event handler StandardDataWin.CtiEvh()
begin

-- -------------------------------------------------------------------------------
-- Evenements de la Barre CTI vers le module CTI
-- -------------------------------------------------------------------------------

when <DecrocheBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_DECROCHE);
	self.SonnerieEnCours = FALSE;
	
when <RaccrocheBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_RACCROCHE);
	self.SonnerieEnCours = FALSE;
	
when <TransfertBtn>.Click Do
	Self.TransfertCTI();
	
when <LibererBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_LIBERER);
	
when <AttenteBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ATTENTE);
	
	
when <PauseBtn>.Click Do
	Self.MyControlWin.MyActionMgr.Action(ACT_CTI_PAUSE);
	
when <Enregistrer>.Click Do
	if (self.EnregistrementEnCours) then --1
		-- Si enregistrement en cours on l'arrete
		self.EnregistrementEnCours = FALSE;
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_ARRETERENREGISTREMENT);
	else --1
		-- Sinon on le démarre
		self.EnregistrementEnCours = TRUE;
		Self.MyControlWin.MyActionMgr.Action(ACT_CTI_DEMARRERENREGISTREMENT);
	end if; --1
	
/*
--------------------------------------------------------------------------------------
-- Evenements du module CTI vers la Barre CTI
--------------------------------------------------------------------------------------

when self.StdEventNotifier.StdEvent(unType=Type, unObjectSource=Object) do
	-- Travail sur une copie par sécurité
	unObject : Object = unObjectSource.Clone(deep=TRUE);

	case unType is
		when EVT_CTI_ETATSYNC do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionEtatSync(	pEtat= evtparam.Param1, pEnregAuto = evtparam.ParamBool,
									pEnregEnCours = evtparam.ParamBool2, pSonnerieEnCours=evtparam.ParamBool3,
									pTimer = evtparam.Param2, pTransfertPrepare = evtparam.ParamBool4);
		when EVT_CTI_APPELARRIVE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			-- Un appel arrive, on peut décrocher
			self.EnregistrementAutomatique = evtparam.ParamBool;
			self.EnregistrementEnCours = self.EnregistrementAutomatique;
			
			if (evtparam.Param2 <> '3') then
				-- C'est un appel entrant
				self.SonnerieEnCours = TRUE;
				<DecrocheBtn>.State = FS_ENABLE;
			else
				-- C'est un appel sortant
			end if;
				
			
			self.DoGestionAppelArrive(Param1 = evtparam.Param1, Param2 = evtparam.Param2, Param3 = evtParam.Param3, ParamBool = evtparam.ParamBool);
		
		when EVT_CTI_CHANGEMENTETAT do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionChangementEtat(pEtat=evtparam.param1);
			self.DoGestionChangementEtat(Param1=evtparam.param1);

		when EVT_CTI_COMMUNICATIONETABLIE do
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationEtablie();
			
		when EVT_CTI_COMMUNICATIONTERMINEE do
			-- La barre d'outil est dispo
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationTerminee();
			
		when EVT_CTI_CONSULTATIONINITIALISEE do
			self.<CtiOutilsGrid>.state = FS_DISABLE;
			self.DoGestionConsultationInitialisee();
			
		when EVT_CTI_CONSULTATIONETABLIE do
			self.DoGestionConsultationEtablie();
				
		when EVT_CTI_CONSULTATIONTERMINEE do
			
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			if (evtparam.Param1 <> CTI_TR_ANNULECLIENT) then
				self.<CtiOutilsGrid>.state = FS_ENABLE;
			else
			end if;
			self.DoGestionConsultationTerminee(Param1=evtparam.Param1);
			
		when EVT_CTI_ERREURSOFTPHONE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionErreurSoftphone(Param1=evtparam.Param1);
	
		when EVT_CTI_QUITTER do
			self.DoGestionQuitter();
			
		when EVT_CTI_TRANSFERTANNULE do
			-- Le transfert est annulé (ou on est en conference), la barre est accessible
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.DoGestionTransfertAnnule();
		
		when EVT_CTI_TRANSFERTPREPARE do
			-- Un transfert est préparé, la barre est inaccessible
			self.<CtiOutilsGrid>.STATE = FS_DISABLE;
			self.DoGestionTransfertPrepare();
			
		when EVT_CTI_CONFIRMERDV do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionConfirmerRendezVous(ParamBool=evtparam.paramBool);
	end case;

Exception
	-- Exception grave du CTI : on invalide la barre d'outil
	when uneCTIGraveExc : CTIGraveExc do
		self.<CtiOutilsGrid>.STATE = FS_DISABLE;
		raise uneCTIGraveExc;
*/
end event;

------------------------------------------------------------
event handler StandardDataWin.DefaultEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre du traitement par défaut de la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--  JB BRIAUD       |   13/02/1998  |   Strategie Panel0
--  JB BRIAUD       |   05/03/1998  |   Quitter l'application.
--	D. NGUYEN		|	17/03/1998	|	Sortie de la fenêtre.
--+

/*
	when QuitterApplicationEvt do
		if Self.MyControlWin <> Nil and Self.MycontrolWin.InitWin = Self then
			Quitter();
		end if;
*/	
	when Self.Window.FunctionKeyPress(unTouche=keyId,unMod=modifier) do
		if unTouche = FN_F5 and unMod = 0 then
			Self.ActiverBureau();
		end if;

	When Self.FermerEvt do
		Self.FermerEvtFlag = TRUE;
		Task.PostShutDown();

	when task.Shutdown do
		Fermer();
		if Self.IsShutdownOK then
			exit;
		end if;

	when <Panel0>.AfterFocusGain do
	Begin
		Self.Window.DisableInput();
	

		if ViewMode = FS_UPDATE and not <Panel0>.HasDataChanged then
			<Panel0>.HasDataChanged = FALSE;
			if DataMode <> ACT_STD_APPEND and MyCache.Objects.Items > 0 then
				SetDataMode(ACT_STD_UPDATE);
			elseif DataMode = ACT_STD_READ and MyCache.Objects.Items = 0 and FlagAppend then
				Add();
			end if;
		end if;
		Self.Window.EnableInput();
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
	End;

	when <Panel0>.BeforeFocusLoss do
	if FlagPanel0 then
		Begin
			Self.Window.DisableInput();
			if Self.<Panel0>.HasDataChanged then
				Self.IsChanged = TRUE;
			end if;
			Submit();
			Self.Window.EnableInput();
			Exception 
				When e : GenericException do
					Self.Window.EnableInput();
					TmpMsg : TextData = new;
					TmpMsg.Setvalue(e.Message);
					TmpMsg.Concat(' - Severity : ');
					TmpMsg.Concat(e.Severity);
					AffStatusLine(TmpMsg);
		End;
	end if;

	When Self.<CtxtPopUp>.ChildActivate(MenuWid = Child) Do
		if MenuWid.IsA(MenuCommand) then
			TmpMnuCmd : MenuCommand = (MenuCommand)(MenuWid);
			TmpActionParam :  ActionParamDesc = (ActionParamDesc)(TmpMnuCmd.AppData);
			if TmpActionParam <> NIL then
				if TmpActionParam.CodeAction = ACT_DETAIL then
					(DetailAffParamDesc)((ActionParamDesc)(TmpMnuCmd.AppData).unObjet).Origin = Self;
				end if;
			end if;
			Self.DoAfterMenuCtxAff(TmpMnuCmd);
			Self.MyControlWin.MyActionMgr.Action(TmpMnuCmd);
			Self.DoAfterMenuCtxAction(TmpMnuCmd);
--		else
--			unExc : ImplementationExc = new();
--			unExc.Message.setValue('Il faut faire une demande d''intervention avant !!!!');
--			Self.TraceExc(unExc,'StandardDataWin.BriqueEvh');
--			Raise unExc;
		end if;
end event;

------------------------------------------------------------
event handler StandardDataWin.DeplacementEvh()
begin
--
--	Description : 	Evènements à traiter pour le déplacement dans la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--+
	
	when <SuivantBtn>.Click do
	Begin
		Go : Boolean = FALSE;
		Rep : Integer;
		if not FlagPanel0 then
			if Self.<Panel0>.HasDatachanged then
				Rep = Self.Window.Questiondialog(Self.MSG_NEXT_3, BS_YESNOCANCEL, BV_CANCEL);
				if Rep <> BV_CANCEL then
					Go = TRUE;
				end if;
				if Rep = BV_NO then
					Self.<Panel0>.HasDataChanged = FALSE;
					SetDataMode(ACT_STD_READ);
				end if;
			else
				Go = TRUE;
			end if;
		else
			Go = TRUE;
		end if;
			
		if ((Rep = BV_YES) and not FlagPanel0) or FlagPanel0 then
			Self.Window.DisableInput();
			Self.Submit();
			Self.Window.EnableInput();
		end if;
		if go then
			AffNextPosition();
		end if;
	
	Exception 
		When e : GenericException do
			Self.Window.EnableInput();
			TmpMsg : TextData = new;
			TmpMsg.Setvalue(e.Message);
			TmpMsg.Concat(' - Severity : ');
			TmpMsg.Concat(e.Severity);
			AffStatusLine(TmpMsg);
	End;

	when <PrecedentBtn>.Click do
	Begin
		Go : Boolean = FALSE;
		Rep : Integer;
		if not FlagPanel0 then
			if Self.<Panel0>.HasDataChanged then
				Rep = Self.Window.Questiondialog(Self.MSG_PREV_3, BS_YESNOCANCEL, BV_CANCEL);
				if Rep <> BV_CANCEL then
					Go = TRUE;
				end if;
					if Rep = BV_NO then
						Self.<Panel0>.HasDataChanged = FALSE;
						SetDataMode(ACT_STD_READ);
					end if;
			else
				Go = TRUE;
			end if;
		else
			Go = TRUE;
		end if;
			
		if ((Rep = BV_YES) and not FlagPanel0) or FlagPanel0 then
			Self.Window.DisableInput();
			Self.Submit();
			Self.Window.EnableInput();
		end if;
		if go then
			AffPreviousPosition();
		end if;
	
	Exception 
		When e : GenericException do
			Self.Window.EnableInput();
			TmpMsg : TextData = new;
			TmpMsg.Setvalue(e.Message);
			TmpMsg.Concat(' - Severity : ');
			TmpMsg.Concat(e.Severity);
			AffStatusLine(TmpMsg);
	End;
end event;

------------------------------------------------------------
event handler StandardDataWin.EventLoopHandler()
begin
--
--	Description : 	Evènements à traiter dans l'event loop de la méthode display.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--	D. NGUYEN		|	06/07/1997	|	Ventilation en Event Handler.
--+
	
	-- EventHandler du comportement par défaut
	Register Self.DefaultEvh();
	-- Event Handler du Grid de déplacement
	Register Self.DeplacementEvh();
	-- Event Handler du Grid StandardOutils
	Register Self.StandardOutilsEvh();
	-- Event Handler de la barre verticale droite
	Register Self.GeneralOutilsEvh();
	-- Event Handler de l'event notify
	Register Self.EventNotifyEvh();
	-- Event Handler du CTI
	if Self.FlagCTI = TRUE then
		Register CtiEvh();
	end if;
end event;

------------------------------------------------------------
event handler StandardDataWin.EventNotifyEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de l'Event Notify de la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--+
	
	When StdEventNotifier.StdEvent(unType = Type, unObject = Object) do
	Begin
		Case unType is

			when ACT_STD_APPEND do
				AppendEvent((TransClass)(unObject).TransObject);
			When ACT_STD_UPDATE do
				UpdateEvent((TransClass)(unObject).TransObject);
			When ACT_STD_DELETE do
				DeleteEvent((TransClass)(unObject).TransObject);
				
--
-- Debut de section CTI
--
--	DN			31/12/1997		Correction bug (fiche anno 13)
				
		when EVT_CTI_ETATSYNC do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionEtatSync(	pEtat= evtparam.Param1, pEnregAuto = evtparam.ParamBool,
									pEnregEnCours = evtparam.ParamBool2, pSonnerieEnCours=evtparam.ParamBool3,
									pTimer = evtparam.Param2, pTransfertPrepare = evtparam.ParamBool4);
		when EVT_CTI_APPELARRIVE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			-- Un appel arrive, on peut décrocher
			self.EnregistrementAutomatique = evtparam.ParamBool;
			self.EnregistrementEnCours = self.EnregistrementAutomatique;
			
			if (evtparam.Param2 <> '3') then
				-- C'est un appel entrant
				self.SonnerieEnCours = TRUE;
				<DecrocheBtn>.State = FS_ENABLE;
				<PauseBtn>.State = FS_DISABLE; -- DN 31/12
			else
				-- C'est un appel sortant
			end if;
				
			
			self.DoGestionAppelArrive(Param1 = evtparam.Param1, Param2 = evtparam.Param2, Param3 = evtParam.Param3, ParamBool = evtparam.ParamBool);
		
		when EVT_CTI_CHANGEMENTETAT do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.GestionChangementEtat(pEtat=evtparam.param1);
			self.DoGestionChangementEtat(Param1=evtparam.param1);

		when EVT_CTI_COMMUNICATIONETABLIE do
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationEtablie();
			
		when EVT_CTI_COMMUNICATIONTERMINEE do
			-- La barre d'outil est dispo
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.SonnerieEnCours = FALSE;
			self.DoGestionCommunicationTerminee();
			
		when EVT_CTI_CONSULTATIONINITIALISEE do
			self.<CtiOutilsGrid>.state = FS_DISABLE;
			self.DoGestionConsultationInitialisee();
			
		when EVT_CTI_CONSULTATIONETABLIE do
			self.DoGestionConsultationEtablie();
				
		when EVT_CTI_CONSULTATIONTERMINEE do
			
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			if (evtparam.Param1 <> CTI_TR_ANNULECLIENT) then
				self.<CtiOutilsGrid>.state = FS_ENABLE;
			else
			end if;
			self.DoGestionConsultationTerminee(Param1=evtparam.Param1);
			
		when EVT_CTI_ERREURSOFTPHONE do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionErreurSoftphone(Param1=evtparam.Param1);
	
		when EVT_CTI_QUITTER do
			self.DoGestionQuitter();
			
		when EVT_CTI_TRANSFERTANNULE do
			-- Le transfert est annulé (ou on est en conference), la barre est accessible
			self.<CtiOutilsGrid>.STATE = FS_ENABLE;
			self.DoGestionTransfertAnnule();
		
		when EVT_CTI_TRANSFERTPREPARE do
			-- Un transfert est préparé, la barre est inaccessible
			self.<CtiOutilsGrid>.STATE = FS_DISABLE;
			self.DoGestionTransfertPrepare();
			
		when EVT_CTI_CONFIRMERDV do
			evtparam : CTIEventParam = (CTIEventParam) ((TransInterfaceCTIDesc) (unObject).TransObject);
			self.DoGestionConfirmerRendezVous(ParamBool=evtparam.paramBool);
--
-- Fin de section CTI
--
			else do
				Self.DoStdEventNotifier(unType,unObject);
		end Case;
		Exception 
			When e : GenericException do
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
				
			-- Exception grave du CTI : on invalide la barre d'outil
			when uneCTIGraveExc : CTIGraveExc do
				self.<CtiOutilsGrid>.STATE = FS_DISABLE;
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(uneCTIGraveExc.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(uneCTIGraveExc.Severity);
				AffStatusLine(TmpMsg);
	End;


end event;

------------------------------------------------------------
event handler StandardDataWin.GeneralOutilsEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la barre d'outils verticale droite de la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--+
	
	when Self.<QuitterBtn>.Click do
--		Self.MycontrolWin.QuitterApplication();
		Self.Quitter();
end event;

------------------------------------------------------------
event handler StandardDataWin.StandardOutilsEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la barre d'outils Standard de la fenêtre.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	06/07/1997	|	Creation.
--	D. NGUYEN		|	19/03/1998	|	Ajout du ValidateConfirm.
--+
	
--	when <WindowControlBtn>.Click do
--		Self.ActiverBureau();

	when <SauverBtn>.Click do
		if not FlagPanel0 then
			if Self.<Panel0>.HasDataChanged then
				Begin
					Go : Boolean = FALSE;
					Rep : Integer;
					if Self.ValidateConfirm then
					Rep = Self.Window.QuestionDialog(Self.MSG_SAVE_2, BS_YESNO, BV_YES);
						if Rep = BV_YES then
							Go = TRUE;
						end if;
					else
						Go = TRUE;
					end if;
					if Go then
						Self.Window.DisableInput();
						Submit();
						Self.Window.EnableInput();
					end if;
				Exception 
					When e : GenericException do
						Self.Window.EnableInput();
						TmpMsg : TextData = new;
						TmpMsg.Setvalue(e.Message);
						TmpMsg.Concat(' - Severity : ');
						TmpMsg.Concat(e.Severity);
						AffStatusLine(TmpMsg);
				End;
			end if;
		end if;

	when <AjouterBtn>.Click do
	if Self.FlagAppend then
		Begin
			Go : Boolean = FALSE;
			if not FlagPanel0 then
				Rep : Integer;
				if Self.<Panel0>.HasDataChanged then
					Rep = Self.Window.QuestionDialog(Self.MSG_ADD_3, BS_YESNOCANCEL, BV_YES);
					if Rep = BV_YES then
						Go = TRUE;
						Self.Window.DisableInput();
						Self.Submit();
						Self.Window.EnableInput();
					elseif Rep = BV_Cancel then
						Go = FALSE;
					elseif Rep = BV_No then
						Go = TRUE;
						Self.<Panel0>.HasDataChanged = FALSE;
					end if;
				else
					Rep = Self.Window.QuestionDialog(Self.MSG_ADD_2, BS_YESNO, BV_YES);
					if Rep = BV_YES then
						Go = TRUE;
					end if;
				end if;
			end if;
			if FlagPanel0 or (not FlagPanel0 and Go) then
				Self.Window.DisableInput();
				Add(AddPolicy);
				Self.Window.EnableInput();
			end if;
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
		End;
	End if; -- FlagAppend

	when <SupprimerBtn>.Click do
	if Self.FlagDelete then
		Begin
			Go : Boolean = FALSE;
			if not FlagPanel0 then
				Rep : Integer;
				if Self.<Panel0>.HasDatachanged then
					Rep = Self.Window.QuestionDialog(Self.MSG_DELETE_3, BS_YESNOCANCEL, BV_Cancel);
					if Rep = BV_YES then
						Go = TRUE;
					elseif Rep = BV_Cancel then
						Go = FALSE;
					elseif Rep = BV_No then
						Go = TRUE;
						Self.<Panel0>.HasDataChanged = FALSE;
					end if;
				else
					Rep = Self.Window.QuestionDialog(Self.MSG_DELETE_2, BS_YESNO, BV_YES);
					if Rep = BV_YES then
						Go = TRUE;
					end if;
				end if;
			end if;
			if FlagPanel0 or (not FlagPanel0 and Go) then
				Self.Window.DisableInput();
				SetDataMode(ACT_STD_DELETE);
				Submit();
				Self.Window.EnableInput();
			end if;
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
		End;
	end if;

	When <ImprimerBtn>.Click do
		Begin
			Doc : PrintDocument;
			ClonedWindow : StandardDataWin;
			aStandardWinRTpl : StandardWinRTpl= new;
			aDateTime : DateTimeData = new;
			TmpTxt : TextData = new;
			if self.Window.PrintDialog(
					PrintOptions = Self.Window.WindowSystem.DefaultPrintOptions,
					ShowSetUpDialog = FALSE,
					ShowJobDialog = TRUE) = BV_OK then
				TmpTxt.SetValue(Self.Window.Title);
				aStandardWinRTpl.<Title>.Text.value = TmpTxt.value;
				aDateTime.setcurrent();
				aStandardWinRTpl.<Date>.Text.Setvalue(aDateTime);
				Doc = Self.Window.WindowSystem.OpenPrintDocument(
					PrintOptions = Self.Window.WindowSystem.DefaultPrintOptions,
					DocName = TmpTxt.value);
				ClonedWindow = (StandardDataWin)(Self.CloneWindowOnly());
				Doc.SetWorkingPage(Page=aStandardWinRTpl, HeightPolicy = SP_NATURAL, WidthPolicy=SP_TO_PARENT);
				ClonedWindow.Window.Row = 2;
				ClonedWindow.Window.Column = 1;
--				ClonedWindow.<StatusGrid>.State = FS_INVISIBLE;
--				ClonedWindow.<ToolsGrid>.State = FS_INVISIBLE; 
				ClonedWindow.Window.Parent = aStandardWinRTpl.<ReportGrid>; 
				aStandardWinRTpl.Window.UpdateFieldFromData();
				ClonedWindow.<Panel0>.HeightPolicy = SP_NATURAL;
				ClonedWindow.<Panel0>.WidthPolicy = SP_TO_PARENT;
				ClonedWindow.Window.ExpandFieldForPrint(
				  isRecursive = TRUE, RemoveScrollBars = TRUE);
				aStandardWinRTpl.Window.UpdateFieldFromData();
				
				Doc.PrintWorkingPage();
				self.Window.WindowSystem.ClosePrintDocument(PrintDoc = Doc);
			end if;
			Exception
				When e: CancelException do
					Self.AffStatusLine('Printing cancelled');
				When e : GenericException do
					Self.Window.EnableInput();
					TmpMsg : TextData = new;
					TmpMsg.Setvalue(e.Message);
					TmpMsg.Concat(' - Severity : ');
					TmpMsg.Concat(e.Severity);
					AffStatusLine(TmpMsg);
		end;
	

end event;

------------------------------------------------------------
method StandardDicoWin.Init
begin
super.Init();
Self.DicoTrt = new();
Self.DicoTrt.TransferTrt = new(TrfRessource=Self);


end method;

------------------------------------------------------------
method StandardDicoWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- StandardDicoWin.InitDisplay');

Self.DicoTrt.FrontComm=Self.FrontComm;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- StandardDicoWin.InitDisplay : End');

Return;

end method;

------------------------------------------------------------
method StandardDicoWin.InitFillInFields(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
DicoTrt.InitFillInFields(aWidget, pBufferStructure, pTypeLib);

Return;
end method;

------------------------------------------------------------
method StandardDicoWin.InitRecordDicoValues(input output aRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer = 0)
begin
DicoTrt.InitRecordDicoValues(aRecordSelfDesc,pTypeLib);
Return;
end method;

------------------------------------------------------------
method StandardDicoWin.ResetAttributes(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc)
begin
pRecordSelfDesc.DoResetAttributes();
pRecordSelfDesc.SelfDesc = new();
Self.ResetSelfDesc(pRecordSelfDesc);
For unItem in pRecordSelfDesc.SelfDesc do
	if unItem.ItemReference <> NIL then
		if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
			Self.ResetAttributes((ObjectSelfDesc)(unItem.ItemReference));
		end if;
	end if;
End for;
end method;

------------------------------------------------------------
method StandardDicoWin.ResetSelfDesc(input pRecordSelfDesc: DataAccessSrvBD.ObjectSelfDesc)
begin
pRecordSelfDesc.SelfDesc = new();
pRecordSelfDesc.DoResetSelfDesc();
For unItem in pRecordSelfDesc.SelfDesc do
	if unItem.ItemReference <> NIL then
		if unItem.ItemReference.IsA(Type=ObjectSelfDesc) then
			Self.ResetSelfDesc((ObjectSelfDesc)(unItem.ItemReference));
		end if;
	end if;
End for;
end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 1;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'dataclta';


end DataAccessBD;
begin TOOL TarificationProc;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes DataAccessBD;
includes DataAccessSrvBD;
includes DicoBD;
includes DicoSrvBD;
includes FrameworkBD;
includes MoteurTarifSrv;
includes GenericDBMS;
includes DisplayProject;
includes Framework;
includes SecuritySrvBD;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  EvenementTarificationProc;
forward  FrontCommSrv;
forward  ListeofRefTypePackageDesc;
forward  RegleBSMgr;
forward  RegleProc;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant DATE_DEBUT_EURO = '01-jan-1999';
constant LOG_GRPFLAG = 61;
constant TYPE_ERREUR_PRIXCHEVAUCHE = 3;
constant TYPE_ERREUR_PRIXECART = 2;
constant TYPE_ERREUR_PRIXMANQUANT = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class EvenementTarificationProc inherits from DataAccessSrvBD.ServiceDesc

has public  method Action(input aTransdata: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method Init;
has public  method VerifierEvenementTarification(input unEvenement: TarificationSrv.EvenementTarificationDesc);

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class FrontCommSrv inherits from DataAccessSrvBD.FrontCommSrvDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class ListeofRefTypePackageDesc inherits from Framework.Object

has public  attribute Liste: Framework.Array of AddDicoBD.RefTypePackageDesc;

has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class RegleBSMgr inherits from DataAccessSrvBD.BusinessServiceMgrDesc

has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=on);

end class;

class RegleProc inherits from DataAccessSrvBD.ServiceDesc

has public  attribute DicoService: Framework.ClassType;
has public  attribute DicoServiceMgr: DataAccessSrvBD.BusinessServiceMgrDesc;
has public  attribute DicoTrt: DataAccessBD.DicoTrt;
has public  attribute DicoTypeLib: Framework.integer;

has public  method Action(input aTransdata: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method AffectePrixPublic(input uneDevise: Framework.IntegerData,
	input unProduit: Framework.IntegerData,
	input unService: Framework.IntegerData,
	input unecategorie: Framework.IntegerData,
	input unPackage: Framework.IntegerData,
	input unepromotion: Framework.IntegerData = NIL);
has public  method AppendPrixPublic(input PrixPublicCree: TarificationSrv.RegleDesc);
has public  method ControleUnPrixPublic(input CodeDevise: DicoBD.RefDeviseDesc,
	input CodeCategorie: DicoBD.RefTarifDesc,
	input CodePackage: AddDicoBD.RefTypePackageDesc,
	input CodeProduit: DicoBD.RefTypeProduitDesc,
	input CodeService: AddDicoBD.RefTypeServiceDesc,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc): Framework.TextData;
has public  method ControleUnPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle,
	input CodeDevise: DicoBD.RefDeviseDesc,
	input CodeCategorie: DicoBD.RefTarifDesc,
	input CodePackage: AddDicoBD.RefTypePackageDesc,
	input CodeProduit: DicoBD.RefTypeProduitDesc,
	input CodeService: AddDicoBD.RefTypeServiceDesc,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc): Framework.TextData;
has public  method CreerListeProduitdansPackage: Framework.Array of TarificationProc.ListeofRefTypePackageDesc;
has public  method CreerPrixPublic(input UnMoteur: MoteurTarifSrv.MoteurBS,
	input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData = NIL);
has public  method DateMoinsUnJour(input UneDate: Framework.DateTimeData): Framework.DateTimeData;
has public  method DatePlusUnJour(input UneDate: Framework.DateTimeData): Framework.DateTimeData;
has public  method DicoTransfer(input aTransdata: DataAccessSrvBD.TransDico): Framework.Object;
has public  method GenererErreurCompilation(input anomalies: Framework.Array of MoteurTarifSrv.Anomalie): Framework.TextData;
has public  method GenererErreurDates(input ReglesErronnees: Framework.Array of TarificationSrv.RegleDesc,
	input Ecart: Framework.boolean): Framework.TextData;
has public  method Init;
has public  method InitialiseMoteur(input GoCompile: Framework.boolean,
	output anomalies: Framework.Array of MoteurTarifSrv.Anomalie): MoteurTarifSrv.MoteurBS;
has public  method InitListeDico(input NomClassDico: Framework.string): Framework.Array of Framework.ListElement;
has public  method InitListePackage(input UnCode: AddDicoBD.RefTypePackageDesc): Framework.Array of CatalogueSrv.PackageDesc;
has public  method InitListeProduit: Framework.Array of CatalogueSrv.ProduitDesc;
has public  method InitListeProduitdansPackage(input output ListetouslesPackages: Framework.Array of CatalogueSrv.PackageDesc,
	input output TabPackages: Framework.Array of TarificationProc.ListeofRefTypePackageDesc,
	copy input unCode: AddDicoBD.RefTypePackageDesc = NIL,
	input unCodePackagePere: AddDicoBD.RefTypePackageDesc = NIL);
has public  method InitListePromotion: Framework.Array of CatalogueSrv.PromotionDesc;
has public  method RechercheMontantARenseigner: Framework.TextData;
has public  method RemplaceLibelement(input NomClassDico: Framework.string,
	input UnCode: Framework.integer): Framework.TextData;
has public  method TrierReglesParDate(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.Array of MoteurTarifSrv.Regle;
has public  method VerifiePrixPublic(input GoCompile: Framework.boolean,
	input Demarrage: Framework.boolean): Framework.TextData;
has public  method VerifierDatesRegles(input ListeRegles: Framework.Array of TarificationSrv.RegleDesc,
	input UneRegleParam: TarificationSrv.RegleParam,
	input output ReglesErronneesEcart: Framework.Array of TarificationSrv.RegleDesc,
	input ReglesErronneesChevauche: Framework.Array of TarificationSrv.RegleDesc,
	input Index: Framework.integer,
	input DateDebut: Framework.DateTimeData,
	input DateInfini: Framework.DateTimeData);
has public  method VerifieServiceNonRemisable: Framework.Array of TarificationSrv.RegleDesc;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service soFrontCommSrv : TarificationProc.FrontCommSrv = (DialogDuration = MESSAGE,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = 'B156FC43-0BFC-11D1-BE4E-1F5BB6EEAA77');
service soRegleBSMgr : TarificationProc.RegleBSMgr = (DialogDuration = SESSION,
	Visibility = environment,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '75EDD4A0-EFC8-11D1-89FE-68FF1D2DAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method EvenementTarificationProc.Action(input aTransdata: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.Action');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_CONTROLE_EVENEMENT do
		unEvenement : EvenementTarificationDesc = (EvenementTarificationDesc)(aTransData.TransObject);
		self.VerifierEvenementTarification(unEvenement);
	
end case;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.Action : End');

return anObject;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.Action');
		Raise;
		
		
end method;

------------------------------------------------------------
method EvenementTarificationProc.Init
begin
super.Init();
end method;

------------------------------------------------------------
method EvenementTarificationProc.VerifierEvenementTarification(input unEvenement: TarificationSrv.EvenementTarificationDesc)
begin


unItemName : string;
aTransData : TransClass = New();
validite : boolean = TRUE;
aTransdata.TransactionService = ACT_STD_READ;
aTransdata.aRecordSelfDesc.SelfDesc = New();
aTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';					
aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnEvenement.CodeService;
UnCache : Array of CacheDesc = (Array of CacheDesc)(Self.Transfer(aTransData,soCatalogueBSMgr, ServiceBS));

If UnCache <> NIL and unCache.Items > 0 then
	For aCacheDesc in UnCache do
		case (Service_Desc)(aCacheDesc.Record).TypeTarif.IntegerValue  is
			when 3 do
					validite = unEvenement.Montant.DoCheckValidity();
					unItemName = 'Montant';
			when 4 do
					validite = unEvenement.Quantite.DoCheckValidity();
					unItemName = 'Quantite';
		end case;
	end for;
end if;
	


Exception 
	when e: RecordValidityExc do
		e.ItemName = unItemName;
		Raise ;
end method;

------------------------------------------------------------
method FrontCommSrv.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour son démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : FrontCommSrvDesc
--
--	History :
--
--	D. NGUYEN	|	15/06/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommSrv.DoInitService');

Self.SessionSrv = soSessionSrv;
Self.Dependances.AppendRow(Self.SessionSrv);
Self.Dependances.AppendRow(soCatalogueBSMgr);	--permet l'utilisation des services du catalogue Produit 
												--directement
Self.Dependances.AppendRow(soTarificationBSMgr);
Self.Dependances.AppendRow(soRegleBSMgr);



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommSrv.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method FrontCommSrv.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ListeofRefTypePackageDesc.Init
begin
super.Init();
self.Liste = New();
end method;

------------------------------------------------------------
method RegleBSMgr.DoAfterSyncServices
begin
--
--	Description : 	Instanciation des services gérés par le service manager.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	CDC :
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoAfterSyncservicesService');



-- Traitement

Self.AppendRow(aIdent = RegleProc);


-- Fin du traitement

-- Verification des post-conditions
-- Fin de la verification des post-conditions

-- Verification de la coherence
-- Fin de verification de la coherence

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- CatalogueBSMgr.DoAfterSyncService : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'CatalogueBSMgr.DoAfterSyncService');
		Raise;
 
end method;

------------------------------------------------------------
method RegleBSMgr.DoInitService
begin
--
--	Description : 	Initialisation du service avec déclaration des dépendances pour le démarrage.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : BusinessServiceMgrDesc
--
--	History :
--
--	CDC :
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoInitService');


--Self.Dependances.AppendRow(SoNotificationSrv);
--Self.NotificationService = SoNotificationSrv; 
Self.Dependances.AppendRow(soCatalogueBSMgr); 
Self.Dependances.AppendRow(soTarificationBSMgr); 


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- CatalogueBSMgr.DoInitService');

end method;

------------------------------------------------------------
method RegleBSMgr.Init
begin
super.Init();
end method;

------------------------------------------------------------
method RegleProc.Action(input aTransdata: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Entry point for the class.
--
--	Type :	Abstrait
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--	D. NGUYEN	|	22/07/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.Action');

anObject : Object = NIL;
case aTransData.TransActionService is
	when ACT_TARIF_MISEENPRODUCTION do
		anObject =self.VerifiePrixPublic(GoCompile= TRUE,Demarrage= FALSE);
	when ACT_TARIF_COMPLETION_AUTOMATIQUE do
		anObject = self.VerifiePrixPublic(GoCompile= FALSE,Demarrage = TRUE);
	when ACT_TARIF_ERREUR_SIARENSEIGNER do
		anObject = self.RechercheMontantARenseigner();
	when ACT_TARIF_UNSEULPRIXPUBLIC do
		aRegleParam : RegleParam = New();
		aRegleParam = (RegleParam)(aTransData.TransObject);
		anObject =self.ControleUnPrixPublic(aRegleParam.CodeDevise,aRegleParam.CodeCategorie,aRegleParam.CodePackage,
			aRegleParam.CodeProduit,aRegleParam.CodeService,aRegleParam.CodePromotion);
end case;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.Action : End');

return anObject;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.Action');
		Raise;
		
		
end method;

------------------------------------------------------------
method RegleProc.AffectePrixPublic(input uneDevise: Framework.IntegerData,
	input unProduit: Framework.IntegerData,
	input unService: Framework.IntegerData,
	input unecategorie: Framework.IntegerData,
	input unPackage: Framework.IntegerData,
	input unepromotion: Framework.IntegerData = NIL)
begin
--
--	Description : 	Renseigne les attributs du Prix Public que l'on souhaite ajouter dans la base des Règles
--					de tarification :
--					Les données correspondant au contexte d'application sont passées en paramètre de la méthode.
--					Quant aux dates et au montant, ils sont définis ici.
--					La date de début du Prix Public correspond à la date du jour où s'effectue le contrôle.
--					La date de fin correspond à la date dite infini (31/12/2099)
--					Quant au montant du Prix Public:
--						- dans un contexte dit standard : Categorie Standard,Sans Promotion, Hors Package :
--							Montant = A_RENSEIGNER
--						- dans une promotion : Montant = TARIF_SANS_PROMOTION
--						- dans un package et pour une categorie standard : Montant = TARIF_CATEGORIE
--						- Pour une catégorie autre que standard : Montant = TARIF_CATEGORIE_STANDARD
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.CreerPrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.AffectePrixPublic');

DateJour : DateTimeData = New();		--date système
DateJour.SetCurrent(Resolution = DR_DAY);
DateInfini : DateTimeData = New();		--31/12/2099
DateInfini.SetValue(DATE_INFINI);


--initialisation
PrixPublicCree : RegleDesc = new();
PrixPublicCree.DoResetAttributes();

--Affectation du contexte d'application passé en paramètre
PrixPublicCree.CodeDevise.SetValue(uneDevise);
PrixPublicCree.CodeProduit.SetValue(unProduit);
PrixPublicCree.CodeService.SetValue(unService);
PrixPublicCree.CodeCategorie.SetValue(uneCategorie);
PrixPublicCree.CodePackage.SetValue(unPackage);
PrixPublicCree.PrixPublicBln.SetValue(TRUE);


--les prix public créés couvrent l'ensemble de la période.
PrixPublicCree.DateDebutValidite.SetValue(DateJour);
PrixPublicCree.DateFinValidite.SetValue(DateInfini);


If UnePromotion <> NIL then													--Dans une Promotion
	PrixPublicCree.CodePromotion.SetValue(UnePromotion);
	PrixPublicCree.Montant.SetValue(CST_TARIF_SANS_PROMOTION);
else
	PrixPublicCree.CodePromotion.SetValue(IntegerData(Value=IDX_HORS_PROMOTION)); --Hors Promotion : code = IDX_HORS_PROMOTION
	if UneCategorie.Value = IDX_CATEGORIE_STANDARD then								
		if not UnPackage.Value=IDX_HORS_PACKAGE then								
			PrixPublicCree.Montant.SetValue(CST_TARIF_CATEGORIE);	--Sans Promotion,Catégorie Standard et Package
		else																		
			PrixPublicCree.Montant.SetValue(CST_TARIF_A_RENSEIGNER);--Sans Promotion,Catégorie Standard et Hors Package
		end if;
	else																	
		PrixPublicCree.Montant.SetValue(CST_TARIF_CATEGORIE_STANDARD);--Sans Promotion,Catégorie autre que Standard
	end if;
end if;
		
self.AppendPrixPublic(PrixPublicCree);		

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.AffectePrixPublic : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.AffectePrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.AppendPrixPublic(input PrixPublicCree: TarificationSrv.RegleDesc)
begin
--
--	Description : 	Ajout du Prix Public créé dans la base des Règles de Tarification. Appel à un Service Spécifique 
--					de RegleBS via un Transfer avec le code action ACT_TARIF_APPEND_SANSCONTROLE qui correspond 
--					exactement à l'Append du socle sauf que l'on ne souhaite pas éxécuter de contrôles.
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.CreerPrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.AppendPrixPublic');


--Afin de pouvoir faire un ajout dans une table en utilisant le mécanisme d'ajout du socle, il est nécessaire de 
--caster l'objet RegleDesc en CacheDesc. 
UnCache : CacheDesc = New();
UnCache.Record = PrixPublicCree;


--Paramétrage du transfert
aTransData : Transdesc = New();
aTransData.TransActionService = ACT_TARIF_APPEND_SANSCONTROLE;
aTransData.TransObject =UnCache;


Self.Transfer(aTransData,soTarificationBSMgr,RegleBS);


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,2, '- RegleProc.AppendPrixPublic  : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.AppendPrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.ControleUnPrixPublic(input CodeDevise: DicoBD.RefDeviseDesc,
	input CodeCategorie: DicoBD.RefTarifDesc,
	input CodePackage: AddDicoBD.RefTypePackageDesc,
	input CodeProduit: DicoBD.RefTypeProduitDesc,
	input CodeService: AddDicoBD.RefTypeServiceDesc,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc): Framework.TextData
begin
--
--	Description : 	Cette méthode comprend l'ensemble des pré-traitements nécessaire à la vérification de
--					l'unicité et la contiguité des Prix Publics correspondant au contexte d'application passé en paramètre
--					Pour une liste de règles donnée,la méthode de vérification des dates va être appelée. 
--					Les pré-traitements correspondent : - à la création d'une instance de RegleParam, instance 
--					porteuse du contexte .
--							-à la transformation de ListeRegles résultant de la recherche efféctuée par le
--					moteur en un Array of RegleDesc, ceci dans un souci de réutilisabilité des méthodes 
--					VerifierDatesRegles et GenererErreurDates
--							-à l'initialisation des dates : dateJour et DateInfini
--							-à l'initialisation des listes de Regles Erronnees. Deux listes sont créées pour
--							permettre de distinguer facilement le type d'erreur : Ecart ou chevauchement.
--					Cette méthode est appelée par l'utilisateur par activation d'une des options du menu contextuel
--					de la fenêtre d'administration des règles
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.CreerPrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,1, '- RegleProc.ControleUnPrixPublic');


TmpMsg : TextData = New();
aTransdata : TransDesc = New();
UneRegleParam : RegleParam = New();
uneRegleParam.CodeDevise = RefDeviseDesc(CodeDevise);
uneRegleParam.CodeCategorie = RefTarifDesc(CodeCategorie);
uneRegleParam.CodePackage  = RefTypePackageDesc(CodePackage);
uneRegleParam.CodeProduit  = RefTypeProduitDesc(CodeProduit);
uneRegleParam.CodeService  = RefTypeServiceDesc(CodeService);
uneRegleParam.CodePromotion = RefTypePromotionDesc(CodePromotion);
aTransData.TransActionService = ACT_TARIF_READPRIXPUBLIC;
aTransData.TransObject = uneRegleParam;
ListeRegles : Array of RegleDesc = (Array of RegleDesc)(self.transfer(aTransData,soTarificationBSMgr,RegleBS));


if ListeRegles <> NIL and ListeRegles.Items > 0 then
	DateJour : DateTimeData = New();
	DateJour.SetCurrent(Resolution=DR_DAY);
	DateInfini : DateTimeData =New();
	DateInfini.SetValue(DATE_INFINI);

	ReglesErronnesEcart : Array of RegleDesc = New();
	ReglesErronnesChevauche : Array of RegleDesc = New();
	
	self.VerifierDatesRegles(ListeRegles,UneRegleParam,ReglesErronnesEcart,ReglesErronnesChevauche,1,DateJour,DateInfini);

	TmpMsgEcart : textData = self.GenererErreurDates(ReglesErronnesEcart,TRUE);
	TmpMsgChevauche : TextData =self.GenererErreurDates(ReglesErronnesChevauche,FALSE);
	TmpMsg.Concat(TmpMsgEcart);
	TmpMsg.Concat(TmpMsgChevauche);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,2, '- RegleProc.ControleUnPrixPublic : End');


return TmpMsg;



Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.ControleUnPrixPublic');
		Raise;

end method;

------------------------------------------------------------
method RegleProc.ControleUnPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle,
	input CodeDevise: DicoBD.RefDeviseDesc,
	input CodeCategorie: DicoBD.RefTarifDesc,
	input CodePackage: AddDicoBD.RefTypePackageDesc,
	input CodeProduit: DicoBD.RefTypeProduitDesc,
	input CodeService: AddDicoBD.RefTypeServiceDesc,
	input CodePromotion: AddDicoBD.RefTypePromotionDesc): Framework.TextData
begin
--
--	Description : 	Cette méthode comprend l'ensemble des pré-traitements nécessaire à la vérification de
--					l'unicité et la contiguité de l'ensemble des Prix Public. Pour une liste de règles donnée,
--					la méthode de vérification des dates va être appelée. 
--					Les pré-traitements correspondent : - à la création d'une instance de RegleParam, instance 
--					porteuse du contexte .
--							-à la transformation de ListeRegles résultant de la recherche efféctuée par le
--					moteur en un Array of RegleDesc, ceci dans un souci de réutilisabilité des méthodes 
--					VerifierDatesRegles et GenererErreurDates
--							-à l'initialisation des dates : dateJour et DateInfini
--							-à l'initialisation des listes de Regles Erronnees. Deux listes sont créées pour
--							permettre de distinguer facilement le type d'erreur : Ecart ou chevauchement.
--					Cette méthode est appelée au moment de la mise en production. Si elle échoue, pas de réplication
--
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.CreerPrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,1, '- RegleProc.ControleUnPrixPublic');

TmpMsg : TextData ;  --Contient le message d'erreur

If ListeRegles <> NIL and ListeRegles.Items > 0 then

--Affectation de RegleParam, porteur du contexte d'application
	UneRegleParam : RegleParam = New();
	uneRegleParam.CodeDevise =CodeDevise;
	uneRegleParam.CodeCategorie = CodeCategorie;
	uneRegleParam.CodePackage  = CodePackage;
	uneRegleParam.CodeProduit  =CodeProduit;
	uneRegleParam.CodeService  = CodeService;
	if CodePromotion = NIL then		--Hors Promotion
		uneRegleParam.CodePromotion = RefTypePromotionDesc(Value = 1);
	else
		uneRegleParam.CodePromotion = CodePromotion;
	end if;

--Initialisation de la liste de RegleDesc
	ListeReglesDesc : Array of RegleDesc = New();
	UneRegleDesc :RegleDesc = New();
	UneRegleDesc.DoResetAttributes();

--Transformation de la liste d'objet Regle en objet RegleDesc
	for UneRegle in ListeRegles do
		if UneRegle <> NIL then
			uneRegleDesc.CodeDevise = uneRegleParam.CodeDevise;
			uneRegleDesc.CodeCategorie = uneRegleParam.CodeCategorie;
			uneRegleDesc.CodePackage = uneRegleParam.CodePackage;
			uneRegleDesc.CodeProduit = uneRegleParam.CodeProduit;
			uneRegleDesc.CodeService = uneRegleParam.CodeService;
			uneRegleDesc.CodePromotion = uneRegleParam.CodePromotion;
			uneRegleDesc.DateDebutValidite = UneRegle.DateDebutValidite;
			uneRegleDesc.DateFinValidite =UneRegle.DateFinValidite;
			ListeReglesDesc.AppendRow(UneRegleDesc);
		end if;
	end for;
	
--Initialisation des dates correspondant à la période que doivent couvrir les prix Public définis pour ce contexte
	DateJour : DateTimeData = New();
	DateJour.SetCurrent(Resolution=DR_DAY);
	DateInfini : DateTimeData =New();
	DateInfini.SetValue(DATE_INFINI);
	
--initialisation des listes de Regles portant les regles erronnées selon le type d'erreur
	ReglesErronnesEcart : Array of RegleDesc = New();
	ReglesErronnesChevauche : Array of RegleDesc = New();

--Verification des dates
	self.VerifierDatesRegles(ListeReglesDesc,UneRegleParam,ReglesErronnesEcart,ReglesErronnesChevauche,1,DateJour,DateInfini);

--Création du message d'erreur
	TmpMsgEcart : textData = self.GenererErreurDates(ReglesErronnesEcart,TRUE);
	TmpMsgChevauche : TextData =self.GenererErreurDates(ReglesErronnesChevauche,FALSE);
	if TmpMsgEcart <> NIL then
		TmpMsg = New();
		TmpMsg.Concat(TmpMsgEcart); --ecart dans les dates du Prix Public
	end if;
	if TmpMsgChevauche <> NIL then
		if TmpMsg = NIL then
			TmpMsg = New();
		end if;
		TmpMsg.Concat(TmpMsgChevauche); --chevauchement dans les dates
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,2, '- RegleProc.ControleUnPrixPublic  : End');

return TmpMsg;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.ControleUnPrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.CreerListeProduitdansPackage: Framework.Array of TarificationProc.ListeofRefTypePackageDesc
begin
--
--	Description : 	Cette méthode permet d'initialiser la liste des produits dans les packages notamment par l'ajout
--					de l'association entre tous les produits et la valeur Hors Pacckage qui n'est présente que 
--					dans le référentiel et non dans la table.
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.VerifiePrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.CreerListeProduitdansPackage');


ListeTouslesPackages : Array of PackageDesc = self.InitListePackage(NIL);
ListeProduitdansPackage : Array of ListeofRefTypePackageDesc = New();
--Appel de la méthode récursive qui va aller lire la liste des packages proprement dit.
self.InitListeProduitdansPackage(ListeTouslesPackages,ListeProduitdansPackage);
for index in  1 to ListeProduitdansPackage.Items do 
	if ListeProduitdansPackage[index] <> NIL then
		if ListeProduitdansPackage[index].liste <> NIL then
			ListeProduitdansPackage[index].Liste.AppendRow(RefTypePackageDesc(Value = 1));
		end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.CreerListeProduitdansPackage : End');

return ListeProduitdansPackage;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.CreerListeProduitDansPackage');
		Raise;

end method;

------------------------------------------------------------
method RegleProc.CreerPrixPublic(input UnMoteur: MoteurTarifSrv.MoteurBS,
	input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData = NIL)
begin
--
-- Description : Par comparaison avec la liste des règles existantes, nous allons procéder à des contrôles 
--					portant sur la cohérence et la contiguité des dates, et sur l'existence de prix public
--					pour tous les contextes d'application possibles, établis par le catalogue produit
--					
--
--	Type :	Abstrait
--
--	Parametres :	UnMoteur : de type MoteurBs, permet d'appeler des services de création et de parcours 
--					de l'arbre où seront stockées les règles existantes.
--
--	Pre-condition : 
--
--	Post-condition : 
--
--	Exceptions : 
--
--	Usage : RegleProc.VerifierPrixPublic
--
--	Historique :
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.CreerPrixPublic ');


--Recherche des règles répondant au contexte d'application passé en paramètre
TmpPromotion : RefTypePromotionDesc = New();
If CodePromotion = NIL then
	tmpPromotion.SetValue(IntegerData(Value= IDX_HORS_PROMOTION));
end if;
	
ListeRegles : Array of Regle =unMoteur.TrouverListeRegles(
	CodeDevise,
	CodeProduit,
	CodeService,
	Codecategorie,
	CodePackage,
	tmpPromotion);	

--Suppression des règles de tarification qui ne sont pas des prix public(Règle conditionnelle ou tarif privilège)
For aRegle in ListeRegles do
	if not aRegle.prixPublic then
		ListeRegles.DeleteRow(aRegle);
	end if;
end for;	

--si aucune règle n'existe pour ce contexte, création d'une instance de type RegleDesc
-- qui contient le contexte pour lequel le prix public n'existe pas.les attributs de cet instance
--seront renseignés en fonction du niveau atteint dans l'arbre, c'est à dire en fonction de l'existence
--de prix public pour les noeuds de l'arbre considérés ( devise, produit,service;categorie,package,promotion)
If ListeRegles = NIL then
	self.AffectePrixPublic(
		CodeDevise,
		CodeProduit,
		CodeService,
		CodeCategorie,
		CodePackage,
		CodePromotion);	 
end if;			

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.CreerPrixPublic : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.CreerPrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.DateMoinsUnJour(input UneDate: Framework.DateTimeData): Framework.DateTimeData
begin
--
--	Description : 	Enlève un jour à une date passée en paramètre
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.VerifiePrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.DateMoinsUnJour');

UnJour  : IntervalData = new (Value = '00:00:01');

DateRes : DateTimeData = new();
DateRes.Subtract(UneDate,UnJour);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.DateMoinsUnJour : End');

return DateRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.DateMoinsUnJour');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.DatePlusUnJour(input UneDate: Framework.DateTimeData): Framework.DateTimeData
begin
--
--	Description : 	Ajoute un jour à une date passée en paramètre
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.VerifiePrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.DatePlusUnJour');

DateInf : DateTimeData = new(Value='31-dec-2099');
DateRes : DateTimeData;
UnJour  : IntervalData = new (Value = '00:00:01');

DateRes = new();
if UneDate.IsEqual(DateInf) then	--si UneDate = DateInfini , DateRes = DateInfini
   DateRes.SetValue(DateInf);
else
   DateRes.Add(UneDate,UnJour);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.DatePlusUnJour : End');

return DateRes;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.DatePlusUnJour');
		Raise;

end method;

------------------------------------------------------------
method RegleProc.DicoTransfer(input aTransdata: DataAccessSrvBD.TransDico): Framework.Object
begin
--
--	Description : 	Concret definition of the abstract method DicoTransfer.
--
--	Type :	Abstract
--
--	Parametres :	Refer to Abstract method of the class StandardDataWin
--
--	Pre-condition : Refer to Abstract method of the class StandardDataWin
--
--	Post-condition : Refer to Abstract method of the class StandardDataWin
--
--	Exceptions : Refer to Abstract method of the class StandardDataWin
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN	|	18/06/1997	|	Creation.
--	D. NGUYEN	|	30/01/1998	|	Encapsulation par DicoTrt.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.DicoTransfer');
if DicoTrt = NIL then
	e : ImplementationExc = new;
	e.SetWithParams(Severity=SP_ER_ERROR, message = 'StandardDataWin.DicoTransfer : Attribute DicoTrt is NIL');
	Raise e;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.DicoTransfer : End');

Return DicoTrt.DicoTransfer(aTransData);

end method;

------------------------------------------------------------
method RegleProc.GenererErreurCompilation(input anomalies: Framework.Array of MoteurTarifSrv.Anomalie): Framework.TextData
begin
-- Description : Suite à la compilation des règles par le moteur, une liste d'anomalies est crées concernant les
--					règles qui n'ont pu être compilées correctement. Cette liste contient l'identifiant des règles 
--					ne pouvant être compilées et un message décrivant la cause de l'erreur. 
--					Cette méthode a pour but la lecture de l'ensemble des règles de tarification, la recherche 
--					parmi les règles lues des règles citées dans la liste d'anomalie afin de pouvoir créer un 
--					message d'affichage contenant les renseignements sur la règle et le message d'erreur
--					correspondant. La recherche se fait par l'utilisation d'une hashtable.
--					
--
--	Type :	Concret
--
--	Parametres :	
--					
--
--	Pre-condition : 
--
--	Post-condition : 
--
--	Exceptions : 
--
--	Usage : RegleProc.VerifierPrixPublic
--
--	Historique :
--
--  CDC |
--+			

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.GenererErreurCompilation ');

TmpMsg : TextData = new();

--Paramétrage du transfert
aTransData : TransDesc = New();
aTransData.TransActionService = ACT_STD_READ;
aTransData.transObject=NIL;
UnCache : Array of CacheDesc = (Array of CacheDesc)(self.transfer(aTransData,soTarificationBSMgr,RegleBS));

UneRegle : RegleDesc;

--Initialisation de la hashtable : recherche rapide d'une règle par son identifiant
hashtabRegles : HashTable = new;
Reglesfunc : HashFuncs = new(keyType = SP_KT_INTEGER);
hashtabRegles.Setup(size = 300, functions = Reglesfunc, uniqueKey = TRUE);

if UnCache <> NIL and UnCache.Items > 0 then
	for aCacheDesc in UnCache do
		if aCacheDesc <> NIL then
			UneRegle=(RegleDesc)(aCacheDesc.Record);
			hashtabRegles.Enter(UneRegle, key = uneRegle.Id);
		end if;
	end for ;
end if;	


-- lacture du message correspondant à l'identifiant souhaité.
for UneAnomalie in Anomalies do
	if UneAnomalie <> NIL then
		UneRegle=(RegleDesc)(hashtabRegles.Find(key = UneAnomalie.IdRegle));
		Begin
			tmpMsg.Concat('Devise  = %1          ');
			tmpMsg.Concat('Catégorie  = %2          ');
			tmpMsg.Concat('Package  = %3          ');
			tmpMsg.Concat('Produit = %4          ');
			tmpMsg.Concat('Service = %5         ');
			tmpMsg.Concat('Promotion  = %6          ');
			tmpMsg.Concat('Date de Début = %7          ');
			tmpMsg.Concat('Date de Fin  = %8          ');
			if not UneRegle.PrixPublicBln then
				tmpMsg.Concat('Nom de la Règle Conditionelle  = %9          ');
			else
				UneRegle.NomRegle = New();
				tmpMsg.Concat(' = %9          ');
			end if;
				tmpMsg.Concat('\n');
				e : ErreurCompilationExc = new();
				e.SetWithParams(Severity=SP_ER_ERROR, message =tmpMsg.Value,
					param1 = self.RemplaceLibelement(CLASSE_DEVISE_DICO,UneRegle.CodeDevise.Value),
					param2 = self.RemplaceLibelement(CLASSE_CATEGORIE_DICO,UneRegle.CodeCategorie.Value),
					param3 = self.RemplaceLibelement(CLASSE_PACKAGE_DICO,UneRegle.CodePackage.Value),
					param4 = self.RemplaceLibelement(CLASSE_PRODUIT_DICO,UneRegle.CodeProduit.Value),
					param5 = self.RemplaceLibelement(CLASSE_SERVICE_DICO,UneRegle.CodeService.Value),
					param6 = self.RemplaceLibelement(CLASSE_PROMOTION_DICO,UneRegle.CodePromotion.Value),
					param7 = UneRegle.DateDebutValidite,
					param8 = UneRegle.DateFinValidite,
					param9 = UneRegle.NomRegle
					 );
				Raise e;
				
			Exception
			When e:  ErreurCompilationExc  do
				TmpMsg.Concat(UneAnomalie.Message);
				TmpMsg.Concat('\n');
				TmpMsg.Concat(e.Message);
		End;
	end if;		
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.GenererErreurCompilation : End');

return TmpMsg;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.GenererErreurCompilation');
		Raise;

end method;

------------------------------------------------------------
method RegleProc.GenererErreurDates(input ReglesErronnees: Framework.Array of TarificationSrv.RegleDesc,
	input Ecart: Framework.boolean): Framework.TextData
begin
--
--	Description : 	A partir d'une liste de règles érronnées et le type d'erreur, construction d'un message d'erreur adéquate
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.CreerPrixPublic
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.GenererErreurDates');

TmpMsg : TextData;

--Parcours de la liste de règles et constitution du message
if ReglesErronnees <> NIL and ReglesErronnees.Items > 0 then
	for UneRegle in ReglesErronnees do
		if UneRegle <> NIL then
			Begin
				tmpMsgUnitaire : TextData = New();
				tmpMsgUnitaire.Concat('Devise  = %1          ');
				tmpMsgUnitaire.Concat('Catégorie  = %2          ');
				tmpMsgUnitaire.Concat('Package  = %3          ');
				tmpMsgUnitaire.Concat('Produit = %4          ');
				tmpMsgUnitaire.Concat('Service = %5         ');
				tmpMsgUnitaire.Concat('Promotion  = %6          ');
				tmpMsgUnitaire.Concat('Date de Début  = %7          ');
				tmpMsgUnitaire.Concat('Date de Fin  = %8          ');
				tmpMsgUnitaire.Concat('\n');
				e : ErreurPrixPublicExc = new();
				e.SetWithParams(Severity=SP_ER_ERROR, message =tmpMsgUnitaire.Value,
				--remplacelibelement permet d'afficher le libelement et non le code des éléments du catalogue
					param1 = self.RemplaceLibelement(CLASSE_DEVISE_DICO,UneRegle.CodeDevise.Value),
					param2 = self.RemplaceLibelement(CLASSE_CATEGORIE_DICO,UneRegle.CodeCategorie.Value),
					param3 = self.RemplaceLibelement(CLASSE_PACKAGE_DICO,UneRegle.CodePackage.Value),
					param4 = self.RemplaceLibelement(CLASSE_PRODUIT_DICO,UneRegle.CodeProduit.Value),
					param5 = self.RemplaceLibelement(CLASSE_SERVICE_DICO,UneRegle.CodeService.Value),
					param6 = self.RemplaceLibelement(CLASSE_PROMOTION_DICO,UneRegle.CodePromotion.Value),
					param7 = UneRegle.DateDebutValidite,
					param8 = UneRegle.DateFinValidite
					 );
				Raise e;
				
			Exception
			When e:  ErreurPrixPublicExc  do
				if TmpMsg = NIL then
					if Ecart then
						TmpMsg = new(Value = 'Il n''existe pas de Prix Public correspondant aux différents contextes d''application présentés dans la liste suivante et couvrant la période matérialisée par la date de début et la date de fin de validité. Nous vous invitons à les créer.');
						TmpMsg.Concat('\n');
					else
						TmpMsg = new(Value = 'Deux Prix Public ont été définis pour l''ensemble des contextes d''application présentés dans cette liste. C''est la période de chevauchement qui est exprimée ici par les dates de validité.');
						TmpMsg.Concat('\n');
					end if;
				end if;
				TmpMsg.Concat(e.Message);
			End;
		end if;	
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.GenererErreurDates : End');

return TmpMsg;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.GenererErreurDates');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.Init
begin
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.init');

super.Init();

--Initialisation des attributs indispensables à l'utilisation de DicoTrt.DicoTransfer
--Utilisation dans self.InitListeDico()

Self.DicoServiceMgr = SoDictionaryBSMgr; -- Dictionary Service Manager Définition
Self.DicoService = DictionaryService; -- ClassType of the Service for DictionaryService
Self.DicoTrt = new();
Self.DicoTrt.DicoServiceMgr = Self.DicoServiceMgr;
Self.DicoTrt.DicoService =Self.DicoService;
Self.DicoTrt.TransferTrt.TrfRessource = Self;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '-RegleProc.init : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.Init');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitialiseMoteur(input GoCompile: Framework.boolean,
	output anomalies: Framework.Array of MoteurTarifSrv.Anomalie): MoteurTarifSrv.MoteurBS
begin
--
-- Description : Initialisation du moteur. GoCompile si l'on souhaite que les règles soient compilées 
--					ce qui est le cas au moment de la mise en production
--						Anomailes en output, pour pouvooir générer les messages d'erreur dans le cas 
--					où il y ait des erreurs de compilation.
--					
--
--	Type :	Abstrait
--
--	Parametres :	
--
--	Pre-condition : 
--
--	Post-condition : 
--
--	Exceptions : 
--
--	Usage : RegleProc.VerifierPrixPublic
--
--	Historique :
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitialiseMoteur ');

--Initialisation du moteur et construction de l'arbre de recherche
unMoteur : MoteurBS = New();
unMoteur.Initialise(NIL,GoCompile,DoPerformControls= TRUE);
if GoCompile then
	Anomalies = unMoteur.LireErreursCompilation();
else
	Anomalies = New();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitialiseMoteur : End ');

return unMoteur ;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitialiseMoteur');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitListeDico(input NomClassDico: Framework.string): Framework.Array of Framework.ListElement
begin
--
--	Description : 	affecte une ListElement à partir des données du dico correspondant à une classe donnée
--					passée en paramètre.
--
--	Type :	Abstrait
--
--	Parametres :	Input 		--> NomClassDico : string Nom de la classe du Dico dont 
--									les valeurs sont recherchées.
--
--	Pre-condition : Aucun
--
--	Post-condition : The action required is done.
--
--	Exceptions : Aucun
--
--	Usage : Globale from Communication Front
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitListeDico');

-- Chargement de la liste des données dont DicoClassName = NomClassDico passé en paramètre
aTransDico : TransDico = new();
aTransDico.TransActionService = DICO_READ;
aTransDico.aClassType = New(Name = NomClassDico);

tmpDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTrt.DicoTransfer(aTransDico));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitListeDico : End');

return tmpDicoclass.ListElements;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitListeDico');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitListePackage(input UnCode: AddDicoBD.RefTypePackageDesc): Framework.Array of CatalogueSrv.PackageDesc
begin
--
--	Description : chargement de la liste des packages avec ou sans contexte
--
--	Type :	concret
--
--	Parametres :	UnCode : code du package recherché
--
--
--	Exceptions :
--
--	Usage : RegleProc
--
--	Historique :
--
--	CDC |
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitListePackage');

--Déclarations 
ListePackages : Array of PackageDesc = New();
aPackage : PackageDesc = New();

--Paramétrage du transfert
unCache : Array of CacheDesc;
aTransData : TransClass = New();
aTransData.TransActionservice = ACT_STD_READ;

--Si le code est à NIL, on charge l'ensemble des packages
if UnCode <> NIL then
	aTransdata.aRecordSelfDesc.SelfDesc = New();
	aTransdata.aRecordSelfDesc.SelfDesc.AppendRow();
	aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WherePackage';					
	aTransdata.aRecordSelfDesc.SelfDesc[aTransdata.aRecordSelfDesc.SelfDesc.Items].ItemReference = unCode;
	UnCache  = (Array of CacheDesc)(Self.Transfer(aTransdata,soCatalogueBSMgr,PackageBS));
else 
	aTransData.TransObject = NIL;
	UnCache  = (Array of CacheDesc)(Self.Transfer(aTransdata,soCatalogueBSMgr,PackageBS));
end if;

--transformation en un tableau de PackageDesc
if UnCache <> NIL and UnCache.Items > 0 then
	For aCacheDesc in UnCache do
		if aCacheDesc <> NIL then
			aPackage = (PackageDesc)(aCacheDesc.Record);
			ListePackages.AppendRow(aPackage);
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitListePackage : End');

return ListePackages;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitListePackage');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitListeProduit: Framework.Array of CatalogueSrv.ProduitDesc
begin
--
--	Description : 	chargement de l'ensemble des produits présents dans le catalogue
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitListeProduit');

--déclarations
ListeProduit : Array of ProduitDesc = New();

--Parametrage du transfert
UnCache : Array of CacheDesc = New();
aTransdata : Transdesc = New();
aTransdata.TransObject = NIL;
aTransdata.TransactionService = ACT_STD_READ;

UnCache = (Array of CacheDesc)(self.Transfer(aTransdata,soCatalogueBSMgr,ProduitBS));

--transformation en tableau de ProduitDesc

if  UnCache.Items > 0 then
	for aCacheDesc in UnCache do
		If aCacheDesc <> NIL then
			aProduit : ProduitDesc;
			aProduit = (ProduitDesc)(aCacheDesc.Record);
			ListeProduit.AppendRow(aProduit);
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitListeProduit : End');

return ListeProduit;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitListeProduit');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitListeProduitdansPackage(input output ListetouslesPackages: Framework.Array of CatalogueSrv.PackageDesc,
	input output TabPackages: Framework.Array of TarificationProc.ListeofRefTypePackageDesc,
	copy input unCode: AddDicoBD.RefTypePackageDesc = NIL,
	input unCodePackagePere: AddDicoBD.RefTypePackageDesc = NIL)
begin
--
--	Description : 	cette methode permet de retrouver les  packages qui contiennent un produit donné. 
--						
--	Type :	Concret
--
--	Parametres : listePackage : la liste de tous les packages 
--				 tableau indexé avec le code du produit et contenant le code des packages du produit 
--				correspondant à l'index.	
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitListeProduitdansPackage');


ListePackageCourante : Array of PackageDesc = New();
ListeUnPackage : Array of PackageDesc;

--Si unCode = NIL, ceci signifie que la méthode est appelée directement par VerifiePrixPublic().
--Le cache courant va donc contenir tous les packages.
--Au contraire si uncode <> NIl, alors un premier parcours du cache a déjà été éffectué. Le package considéré
--contenait d'autres packages,et c'est les codes des packages qu'il contient
--qui vont servir de critère de recherche pour le transfert.

if unCode <> NIL then
	ListeunPackage = self.InitListePackage(unCode);
end if;

-- ainsi, le cache courant est le résultat du transfert si celui a eu lieu, c'est-à-dire si UnCache <> NIL
if ListeunPackage = NIL then
	ListePackageCourante = ListeTouslesPackages;
else
	ListePackageCourante = ListeUnPackage;
	ListeunPackage = NIL;
end if;

-- Déclarations
UnPackageCourant : PackageDesc;

--Parcours du cache courant
If ListePackageCourante <> NIL then
	for UnPackageCourant in ListePackageCourante do
	
		--Prise en compte des packages éventuellement présents dans le package considéré.
		for UnPackageFils in UnPackageCourant.LienPackages do  
			if UnPackageFils <> NIL then
				unCodePackagePere = New(Value = UnPackageCourant.CodePackage.Value);
				InitListeProduitDansPackage(ListeTouslesPackages,tabPackages,UnPackageFils.CodePackage,unCodePackagePere);
			end if;
		end for;
			
		--Constitution de la liste des codes produits présents dans le package considéré. Ces derniers sont présents dans
		--dans l'attribut LienProduits: attribut qui est renseigné automatiquement par le socle grâce à la gestion de
		--la composition
		for UnLienPackageProduit in UnPackageCourant.LienProduits do
			if UnLienPackageProduit <> NIL then
				if tabPackages[UnLienPackageProduit.CodeProduit.Value] = NIL then
					tabPackages[UnLienPackageProduit.CodeProduit.Value] = New();
				end if;
				
				--un package A contient un package B. Il faudra associer aussi bien au package A 
				--qu'au package B les produits du package B. Pour cela, nous stockons dans la variable
				--UnCodePackagePere le code du package A, et une fois les produits de B lus, nous les 
				--lui affectons. Si par contre, nous sommes entrain de traiter le cas du package B, ce dernier
				--ne contenant pas de package, ses produits lui seront affectés directement(UnPackageCourant)
				if UnCodePackagePere <> NIL then 
					tabPackages[UnLienPackageProduit.CodeProduit.Value].Liste.AppendRow(unCodePackagePere);
				else
					tabPackages[UnLienPackageProduit.CodeProduit.Value].Liste.AppendRow(UnPackageCourant.CodePackage);
					--pour le traitement du cas Hors Package
				end if;
			end if;
		end for;
		unCodePackagePere = NIL;
	end for;
end if;	
	
				
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitListeProduitdansPackage : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitListeProduitdansPackage');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.InitListePromotion: Framework.Array of CatalogueSrv.PromotionDesc
begin
--
--	Description : 	chargement de l'ensemble des promotions présents dans le catalogue
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.InitListePromotion');

--déclarations
ListePromotion : Array of PromotionDesc = New();

--Parametrages du tranfert
aTransdata: TransDesc = New();
aTransData.TransActionService = ACT_STD_READ;
aTransData.TransObject = NIL;

UnCache :Array of CacheDesc= (Array of CacheDesc)(self.Transfer(aTransdata,soCatalogueBSMgr,PromotionBS));

--Transformation en un tableau de PromotionDesc
if  UnCache.Items > 0 then
	for aCacheDesc in UnCache do
		If aCacheDesc <> NIL then
			aPromotion : PromotionDesc;
			aPromotion = (PromotionDesc)(aCacheDesc.Record);
			ListePromotion.AppendRow(aPromotion);
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.InitListePromotion : End');

return ListePromotion;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.InitListePromotion');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.RechercheMontantARenseigner: Framework.TextData
begin
--
--	Description : Cette méthode est lancée au démarrage de l'application . Ce lancement est paramétrable. 
--					Il existe un attribut de type booléen qui peremet d'empêcher ce contrôle. Ce dernier consiste 
--					à rechercher les prix publics dont les montants sont égaux à Tarif_A_renseigner. En plus du 
--					contrôle , il y a constitution d'un message d'erreur qui précise dans quel contexte d'application
-- 					le montant est à "A Renseigner".
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.Action
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.RechercheMontantARenseigner');


TmpMsg : TextData;

--Parametrage du transfert
pTransData : TransClass = New();
pTransData.TransActionService = ACT_STD_READ;


--LECTURE DES PRIX PUBLIC CORRESPONDANT AUX CRITERES DEFINIS PRECEDEMMENT
UnCache : Array of CacheDesc = (Array of CacheDesc)(Transfer(pTransdata,soTarificationBSMgr,RegleBS));

UneRegle : RegleDesc = New();
ListeRegles : Array of RegleDesc = New();

--CAST DE CACHEDESC EN REGLEDESC ET SELECTION DES PRIX PUBLIC DONT LES MONTANTS SONT EGAUX A CST_TARIF_A_RENSEIGNER
if UnCache <> NIL and UnCache.Items > 0 then
	for UnCacheDesc in UnCache do
		if UnCacheDesc <> NIL then
			UneRegle = (RegleDesc)(UnCacheDesc.Record);
			if UneRegle.PrixPublicBln and UneRegle.Montant.IsEqual(CST_TARIF_A_RENSEIGNER) then
				Begin
					tmpMsgUnitaire : TextData = New();
					tmpMsgUnitaire.Concat('Devise  = %1          ');
					tmpMsgUnitaire.Concat('Produit = %2          ');
					tmpMsgUnitaire.Concat('Service = %3          ');
					tmpMsgUnitaire.Concat('\n');
					e : PresenceARenseignerExc = new();
					e.SetWithParams(Severity=SP_ER_ERROR, message =tmpMsgUnitaire.Value,
						param1 = self.RemplaceLibelement(CLASSE_DEVISE_DICO,UneRegle.CodeDevise.Value),
						param2 = self.RemplaceLibelement(CLASSE_PRODUIT_DICO,UneRegle.CodeProduit.Value),
						param3 = self.RemplaceLibelement(CLASSE_SERVICE_DICO,UneRegle.CodeService.Value)
						 );
					Raise e;
					
				Exception
				When e: PresenceARenseignerExc do
					if TmpMsg = NIL then
						TmpMsg = new(Value = 'Liste des Tarifs de référence non renseignés');
						TmpMsg.Concat('\n');
					end if;
					TmpMsg.Concat(e.Message);
					task.part.logmgr.putline(tmpMsg);
				End;
			end if;	
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.RechercheMontantARenseigner : End');

return TmpMsg;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.RechercheMontantARenseigner');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.RemplaceLibelement(input NomClassDico: Framework.string,
	input UnCode: Framework.integer): Framework.TextData
begin
--
--	Description : 	Remplacement du code par le libellé stocké dans le Réferentiel
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc.VerifiePrixPublic
--
--	Historique :
--
--  CDC |
--+

alibelement : TextData = New();

--initialisation des listes par lecture dans le Réferentiel

ListeDevise : Array of ListElement =self.InitListeDico(CLASSE_DEVISE_DICO);
ListeService : Array of ListElement =self.InitListeDico(CLASSE_SERVICE_DICO);
ListeProduit : Array of ListElement =self.InitListeDico(CLASSE_PRODUIT_DICO);
ListeCategorie : Array of ListElement =self.InitListeDico(CLASSE_PRODUIT_DICO);
ListePromotion: Array of ListElement =self.InitListeDico(CLASSE_PROMOTION_DICO);
ListePackage: Array of ListElement =self.InitListeDico(CLASSE_PACKAGE_DICO);



if NomClassDico = CLASSE_SERVICE_DICO then
	for aservice in listeservice do
		if unCode = aservice.IntegerValue then
			alibelement.SetValue(aservice.TextValue);
		end if;
	end for;
end if;
if NomClassDico = CLASSE_PRODUIT_DICO then
	for aproduit in listeproduit do
		if unCode = aproduit.IntegerValue then
			alibelement.SetValue(aproduit.TextValue);
		end if;
	end for;
end if;
if NomClassDico = CLASSE_DEVISE_DICO then
	for adevise in listedevise do
		if unCode = adevise.IntegerValue then
			alibelement.SetValue(adevise.TextValue);
		end if;
	end for;
end if;
if NomClassDico = CLASSE_PACKAGE_DICO then
	for apack in listepackage do
		if unCode = apack.IntegerValue then
			alibelement.SetValue(apack.TextValue);
		end if;
	end for;
end if;
if NomClassDico = CLASSE_CATEGORIE_DICO then
	for acat in listecategorie do
		if unCode = acat.IntegerValue then
			alibelement.SetValue(acat.TextValue);
		end if;
	end for;
end if;

if NomClassDico = CLASSE_PROMOTION_DICO then
	for apromo in listepromotion do
		if unCode = apromo.IntegerValue then
			alibelement.SetValue(apromo.TextValue);
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientWin.RemplaceLibelement : End');

return aLibelement;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientWin.RemplaceLibelement');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.TrierReglesParDate(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.Array of MoteurTarifSrv.Regle
begin
--
--	Description : 	triage des règles en fonction de leur date de début de validité.
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.TrierReglesParDate');

Done : boolean = FALSE;
RegleTemp : Regle ;

while not Done do
	Done = TRUE;
	for index in 1 to ListeRegles.Items - 1 do
		if ListeRegles[index].DateDebutValidite.IsGreaterThan(ListeRegles[index + 1].DateDebutValidite) then
			RegleTemp = ListeRegles[index];
			ListeRegles[index]=ListeRegles[index + 1];
			ListeRegles[index + 1]=RegleTemp;
			Done =FALSE;
		end if;
	end for;	
end while;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.TrierReglesParDate : end');

return ListeRegles;








end method;

------------------------------------------------------------
method RegleProc.VerifiePrixPublic(input GoCompile: Framework.boolean,
	input Demarrage: Framework.boolean): Framework.TextData
begin
--
--	Description : 	cette méthode a pour but de faire l'ensemble des contrôles nécessaires à la mise en 
--					production. Ces contrôles portent sur le Prix public et sur les services non remisables.
--					Il est impératif qu'il existe un et un seul Prix Public valide 	pendant une période donné.
--					Un service non remisable ne peut faire l'objet d'une promotion, ne peut pas avoir de règles
--					conditionnelles définies ni faire de tarif privilège.
--					Il faut pour le contrôle portant sur le prix public construire un arbre à partir des règles 
--					existantes. Puis dans un second temps, pour chaque contexte d'application possible s'assurer 
--					qu'un prix public existe, c'est-à-dire que la branche correspondante dans l'arbre existe.
--					Pour les services non remisables, il est nécessaires de lire les règles de tarification
--					correspondantes, et vérifier que pour toutes PrixPublicBln = VRAI et CodePromotion = 1.
--						
--	Type :	Concret
--
--	Parametres :	
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, 'RegleProc.VerifiePrixPublic');


TmpMsg : TextData ;

--Initialisation du Moteur
anomalies : array of anomalie ;
UnMoteur : MoteurBS = self.InitialiseMoteur(GoCompile,anomalies);

--lancement de la compilation si l'on est en mise en production
if 	GoCompile = TRUE and Anomalies.Items > 0 then
	TmpMsg = self.GenererErreurCompilation(anomalies);
end if;

if (GoCompile = TRUE and Anomalies.Items = 0) or (GoCompile = FALSE) then
	--Initialisation et déclaration des variables
	--provisoirement appelée pour tester les hashtable
	trouver  : boolean; --indique l'existence de règles pour le contexte passé en paramètre de la méthode TrouveSousChemin
	ListePrixPublicCrees : Array of RegleDesc = New(); --liste des prix public présentant des anomalies
	ListeRegles : Array of Regle = New();
	DateJour : DateTimeData = New();
	DateJour.SetCurrent(Resolution = DR_DAY);
	DateDebutEuro : DateTimeData = New(Value= DATE_DEBUT_EURO);
	TmpMsgSansPromotion : TextData;
	TmpMsgAvecPromotion : TextData;
	
	--chargement des devises
	ListeDevise : Array of ListElement = Self.InitListeDico(CLASSE_DEVISE_DICO);
	
	--chargement des catégories
	ListeCategorie  : Array of ListElement = self.InitListeDico(CLASSE_CATEGORIE_DICO);
	
	
	--chargement des produits et des services correspondants
	ListeProduit : Array of ProduitDesc = self.InitListeProduit();
	
	--chargement des packages et recherche pour un produit donné de tous les packages susceptibles de le contenir
	ListeProduitDansPackage : Array of ListeofRefTypePackageDesc = self.CreerListeProduitdansPackage();
	--chargement de toutes les promotions
	ListePromotion : Array of PromotionDesc = InitListePromotion();
	
	--Parcours du catalogue Produit et recherche des règles déja existantes via un arbre de recherche
	for UneDevise in ListeDevise do
		if UneDevise.IntegerValue <> 2 or DateJour.IsGreaterThan(DateDebutEuro) then --La devise Euro ne sera prise
																				     --en compte que le 01-01-1999
			For unProduit in ListeProduit do
				For unService in unProduit.LienServices do
					for uneCategorie in ListeCategorie do
			  			if ListeProduitdansPackage[unProduit.CodeProduit.Value] <> NIL and 
			  				ListeProduitdansPackage[unProduit.CodeProduit.Value].Liste<> NIL then
							for unPackage in ListeProduitdansPackage[unProduit.CodeProduit.Value].Liste do		
								if Demarrage = TRUE then			
									self.CreerPrixPublic (unMoteur,
								  		IntegerData(Value=uneDevise.IntegerValue), 
								  		UnProduit.CodeProduit, 
								  		UnService.CodeService, 
								  		IntegerData(Value=uneCategorie.IntegerValue), 
								  		unPackage, 
								  		NIL);	
								 else
									 ListeRegles : Array of Regle =unMoteur.TrouverListeRegles(
								  		IntegerData(Value=uneDevise.IntegerValue), 
								  		UnProduit.CodeProduit, 
								  		UnService.CodeService, 
								  		IntegerData(Value=uneCategorie.IntegerValue), 
								  		unPackage, 
								  		IntegerData(Value=1));	
								  	
								  	TmpMsgSansPromotion = self.ControleUnPrixPublic(ListeRegles,
								 		RefDeviseDesc(Value=uneDevise.IntegerValue), 
								 		RefTarifDesc(Value=uneCategorie.IntegerValue), 
								 		RefTypePackageDesc(Value=unPackage.IntegerValue), 
								  		UnProduit.CodeProduit, 
								  		UnService.CodeService,
								  		NIL);
								  		if TmpMsgSansPromotion <> NIL then
								  			if tmpMsg = NIL then
								  				TmpMsg = New();
								  			end if;
								  			TmpMsg.concat(TmpMsgSansPromotion);
								  		end if;
								 end if;
							end for; -- Packages
						end if;			
					end for; -- Catégories
				end for; -- Services
			end for;  -- Produits
		end if;
	end for;					
	
	if ListePromotion <> NIL and ListePromotion.items > 0 then
		for unePromotion in ListePromotion do	
			if Demarrage = TRUE then		
				self.CreerPrixPublic(unMoteur,
					UnePromotion.CodeDevise, 
				  	UnePromotion.CodeProduit, 
				  	UnePromotion.CodeService, 
				  	UnePromotion.CodeCategorie, 
				  	UnePromotion.CodePackage, 
				  	UnePromotion.CodePromotion);		 	  	
			else
				ListeRegles : Array of Regle =unMoteur.TrouverListeRegles(
					UnePromotion.CodeDevise,
					UnePromotion.CodeProduit,
					UnePromotion.CodeService,
					UnePromotion.Codecategorie,
					UnePromotion.CodePackage,
					UnePromotion.CodePromotion);	
					
				TmpMsgAvecPromotion = self.ControleUnPrixPublic(ListeRegles,
					UnePromotion.CodeDevise,
					UnePromotion.Codecategorie,
					UnePromotion.CodePackage,
					UnePromotion.CodeProduit,
					UnePromotion.CodeService,
					UnePromotion.CodePromotion);
				if TmpMsgAvecPromotion <> NIL then
		  			if tmpMsg = NIL then
		  				TmpMsg = New();
		  			end if;
		  			TmpMsg.concat(TmpMsgAvecPromotion);
		  		end if;
			end if;	
		end for;		
	end if;			
end if;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.VerifiePrixPublic : End ');

return TmpMsg;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientWin.VerifiePrixPublic');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.VerifierDatesRegles(input ListeRegles: Framework.Array of TarificationSrv.RegleDesc,
	input UneRegleParam: TarificationSrv.RegleParam,
	input output ReglesErronneesEcart: Framework.Array of TarificationSrv.RegleDesc,
	input ReglesErronneesChevauche: Framework.Array of TarificationSrv.RegleDesc,
	input Index: Framework.integer,
	input DateDebut: Framework.DateTimeData,
	input DateInfini: Framework.DateTimeData)
begin
--
--	Description : 	Controle sur la contiguité et l'unicité du Prix Public
--
--	Type :	Concret
--
--	Parametres :										
--
--	Pre-condition : Aucun
--
--	Post-condition : 
--
--	Exceptions : Aucun
--
--	Usage : RegleProc
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- RegleProc.VerifierDatesRegles');

DB : DateTimeData = ListeRegles[index].DateDebutValidite;

UneRegle : RegleDesc = New();
UneRegle.DoResetAttributes();
UneRegle.CodeDevise = UneRegleParam.CodeDevise;
UneRegle.CodeCategorie = UneRegleParam.CodeCategorie;
UneRegle.CodePackage = UneRegleParam.CodePackage;
UneRegle.CodeProduit = UneRegleParam.CodeProduit;
UneRegle.CodeService = UneRegleParam.CodeService;
UneRegle.CodePromotion = UneRegleParam.CodePromotion;

if index = 1 then
	if  not DB.IsEqual(DateDebut) then
  		 if not DB.IsLessThan(DateDebut)  then
	
		  -- Erreur : Ecart sans date de début sur l'écart
		  -- Créer un prix public dont la date de début est égale à la date du
		  -- jour et dont la date de fin est égale à la date de fin - 1 de la règle 1.
			UneRegle.DateDebutValidite.SetValue(DateDebut);
		 	UneRegle.DateFinValidite.SetValue(self.DateMoinsUnJour(ListeRegles[Index].DateDebutValidite));
			ReglesErronneesEcart.AppendRow(UneRegle);
 	
		end if;
   end if;
   
   if index <= ListeRegles.Items - 1 then
   		DateDebut.SetValue(self.DatePlusUnJour(ListeRegles[index].DateFinValidite));
   		VerifierDatesRegles(ListeRegles,UneRegleParam,ReglesErronneesEcart,ReglesErronneesChevauche,index+1, DateDebut, DateInfini);
   end if;
elseif index <= ListeRegles.Items then 

		if not DB.IsEqual(DateDebut) then -- pas égal, donc une erreur
	
			if DB.IsLessThan(DateDebut) then
				-- Erreur : Chevauchement
		     	-- Créer un prix public avec pour date de début DateDebutValidite de la règle et pour
		    	-- date de fin 
		     	UneRegle.DateDebutValidite.SetValue(DB);
		 	  	UneRegle.DateFinValidite.SetValue(ListeRegles[Index - 1].DateFinValidite);
		 	  	ReglesErronneesChevauche.AppendRow(UneRegle);
		 	else
		     	-- Erreur : Ecart
		     	UneRegle.DateDebutValidite.SetValue(DateDebut);
		 	 	UneRegle.DateFinValidite.SetValue(self.DateMoinsUnJour(ListeRegles[index].DateDebutValidite));
		 	 	ReglesErronneesEcart.AppendRow(UneRegle);
		  	end if;   
		end if;
		if index = ListeRegles.Items then
			if not ListeRegles[index].DateFinValidite.IsEqual(DateInfini) then
		 		UneRegle.DateDebutValidite.SetValue(self.DatePlusUnJour(ListeRegles[Index].DateFinValidite));
		 		UneRegle.DateFinValidite.Value = DateInfini.Value;
		 		ReglesErronneesEcart.AppendRow(UneRegle);
			end if;   
		end if;	
		if index <= ListeRegles.Items - 1 then
	   		DateDebut.SetValue(self.DatePlusUnJour(ListeRegles[index].DateFinValidite));
	   		VerifierDatesRegles(ListeRegles,UneRegleParam,ReglesErronneesEcart,ReglesErronneesChevauche,index+1, DateDebut, DateInfini);
	   	end if;	
end if;  

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- RegleProc.VerifierDatesRegles : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'RegleProc.VerifierDatesRegles');
		Raise;
end method;

------------------------------------------------------------
method RegleProc.VerifieServiceNonRemisable: Framework.Array of TarificationSrv.RegleDesc
begin
ListeRegleErrones : Array of RegleDesc = New();
aTransdata: Transdesc = New();
aTransdata.TransActionService = ACT_STD_READ;
aTransData.TransObject = NIL;
UnCache : Array of CacheDesc = (Array Of CacheDesc)(self.Transfer(aTransdata,soTarificationBSMgr,RegleBS));
uneRegle : RegleDesc = New();

aTransdata.TransActionService = ACT_TARIF_READSERVICENONREMISABLE;
aTransData.TransObject = NIL;
ListeServiceNonRemisable : Array of RefTypeServiceDesc = (Array of RefTypeServiceDesc)(self.Transfer(aTransdata,soCatalogueBSMgr,ServiceBS));

if UnCache <> NIL and unCache.Items > 0 then
	For aCacheDesc in unCache do
		if aCacheDesc <> NIL then
			UneRegle = (RegleDesc)(aCacheDesc.Record);
		end if;
		if ListeServiceNonRemisable[UneRegle.CodeService.Value] <> NIL then
			if UneRegle.PrixPublicBln then
				if uneRegle.CodePromotion.Value <> 1 then
					ListeRegleErrones.AppendRow(UneRegle);
				end if;
			else
				ListeRegleErrones.AppendRow(UneRegle);
			end if;
		end if;
	end for;
end if;

return ListeRegleErrones;
				
	

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'tarifica';


end TarificationProc;
begin TOOL TarificationClt;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes DataAccessBD;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes DicoBD;
includes DicoSrvBD;
includes DisplayBD;
includes FrameworkBD;
includes DisplayProject;
includes Framework;
includes TarificationProc;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionMgr;
forward  ControlWin;
forward  FrontCommClt;
forward  InitApp;
forward  LoginWin is mapped;
forward  MenuWin is mapped;
forward  NoeudPriv;
forward  TarifClientDisplayNode;
forward  TarifClientParam;
forward  TarifClientWin is mapped;
forward  TarificationWin is mapped;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant APP_APPLICATIONNAME = 'TARIFICATION';
constant CODE_NOTIFICATION = 1;
constant LOG_GRPFLAG = 58;
constant MESSAGE_CHEVAUCHE = 'Deux Prix Public définis pour cette période';
constant MESSAGE_ECART = 'Pas de Prix Public pour cette période';
constant MESSAGE_MANQUANT = 'Aucun prix public pour ce contexte';
constant NOMBRE_CLIENT = 4000;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ActionMgr inherits from DisplayBD.ActionMgrDesc

has public  method DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ControlWin inherits from DisplayBD.ControlWinDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class FrontCommClt inherits from DisplayBD.FrontCommCltDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=off);

end class;

class InitApp inherits from DataAccessBD.InitAppDesc

has public  method DoInitService;
has public  method DoOpenApplication;
has public  method Init;
has public  method StartApp;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class NoeudPriv inherits from DataStructuresClasses.SearchTree

has public  attribute Montant: Framework.TextData;
has public  attribute NbPersonnes: Framework.integer;
has public  attribute NbPersonnesActifs: Framework.integer;

has public  method DoAcceptDuplicates: Framework.boolean;
has public  method DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer;
has public  method DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object);
has public  method DoRaiseExceptionWhenDuplicateValues: Framework.boolean;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class TarifClientDisplayNode inherits from DisplayProject.DisplayNode

has public  attribute Montant: Framework.TextData;
has public  attribute NbPersonnes: Framework.integer;
has public  attribute NbPersonnesActifs: Framework.integer;
has public  attribute Part: Framework.DoubleData;

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class TarifClientParam inherits from DataAccessSrvBD.ObjectSelfDesc

has public  attribute CodeDevise: DicoBD.RefDeviseDesc;
has public  attribute CodeProduit: DicoBD.RefTypeProduitDesc;
has public  attribute CodeService: AddDicoBD.RefTypeServiceDesc;

has public  method DoResetAttributes;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class LoginWin is mapped inherits from DisplayBD.LoginWinDesc

has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.LoginWinDesc');

has
+51514631000012a0000010879fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060100000201
+000100000b00000200500001000000000003000021010200000000050400001c
+0205054c6f67696e100506007a08004d009fff010101010f1011120101010100
+009fff010000000d00005dc05dbf000000000303030300020404a0a000000000
+00000000009d5dc09d5dbf000000000000010807680100000000000000000000
+02010000000009000007000021010200000000080806007c08000d0005054772
+696430010104010f1011120101011700019fff0c0000000d000005dc0fc90000
+00000303030300050404606000002205dc07d000009d05dc9d0fc90000000000
+00010809100100000000000000000000020100000000040101009fff009fff20
+010100000a000004040100020b00090000210102000000000b0a060003020100
+00000000000b06007a08004d00060650616e656c30010104010f101112010101
+1700029fff0d0000000d000005b20fa000010001030503030008040460600000
+2203e80fa000009d05b29d0fa000000000000001080c6001ff81000000000000
+00000201000000000900000c0000210102000000000d0d06007c08000d000000
+010104010f1011120101011700009fff0e0000000d9fd79fd705c70fb5000000
+0003512a03000b040460600000220000000000009d05c79d0fb5000000000000
+01080e1001000000000000000000000201000000000402020000000000010100
+000f000000000404000000000210001112130000000e00002103020000000010
+13110f06000302010000000000001006007c08000d000000010104010f101112
+0101011700009fff0f0000000d1f0004500d1a0001000103030303000d040360
+600000220000000000009d04509d0d1a0100000000000108141001ff81000000
+0000000000020100000000040202009fff009fff200101001315000000000404
+000000000216171800191a1b00140000210402000000001618191b1506000302
+010000000028281606009208208102000021210401212121212121212100009f
+ff100000000d9d02af9c9c00d001fe000100010303030300100101a0a0000000
+0000000000009cd09d01fe0000000000000103010b1c0103640100009e004420
+1400000000001c00001c0206064e6f6d203a0a10170600030208000000000000
+180600f6082089020808557365726e616d650102042121212121010101170003
+08085465787444617461110000000d9d050c9c9c00c607bb0001000203050303
+0010010180a00000440000000000009cc69d07bb000000000000010302010700
+1e040009ff8100009e0040001403010019060092082081020000212104012121
+21212121212100009fff120000000d2a9d02b000d00484000200010303030300
+100101a0a00000000000000000009cd09d04840000000000000103010b1d0103
+640100009e0044201400000000001d00001c020f0f4d6f742064652070617373
+65203a0a101a06000302080000000000001b0600f60820890208085061737377
+6f7264010204212121212101010117000408085465787444617461130000000d
+9d050c9d02ba00c607bb00020002030503030010010580a0001e440000001e00
+009cc69d07bb0000000000000103020107001e040009ff8100009e1040001403
+01001e0600b4080009020404526f6c6501020421212121210101011700050707
+496e7465676572160000000d9d050c1f00db07bb000100020305030300130105
+80a0001b220000000000009cdb9d07bb00000000000001030201041f07000000
+03041f00002100020001a6011106007c08000d000000010104010f1011120101
+011700009fff170000000d9d0d8200041c01df0001000203030303000d010160
+600000000000000000009d041c9d01df00000000000001082010010000000000
+0000000000020100000000040201009fff009fff000101000021000000040400
+0000022200230020000021020200000000222321060003020100002828001422
+0601130802010208084c6f67696e42746e01020421212121212121211700069f
+ff180000000d002a01a101a10001000103030303001101018080000000000000
+0000009d01a19d01a100000000000001020124002400010f0001252500011200
+01802020260001082020009d0400000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000004040404040000000000000000000000000000000000000000000000
+0000000404020202010300000000000000000000000000000000000000000000
+0000040402020201030300000000000000000000000000000000000000000000
+0004040202020103030300000000000000000000000000000404040000000000
+0404020202010303030000000000000000000000000000040202020100000004
+0402020201030303000000000000000000000000000000040202020103000404
+0202020103030300000000000000000000000000000000040202020103040402
+0202010303030000000000000000000000000000000000040202020104040202
+0201030303000000000000000000000000000000000000040202020204020202
+0103030300000000000000000000000000000000000000040202020202020201
+0303030000000000000000000000000000000000000000040202020202020103
+0303000000000000000000000000000000000000000000020202020202010303
+0300000000000000000000000000000000000000000000000202020201030303
+0000000000000000000000000000000000000000000000000002010103030300
+0000000000000000000000000000000000000000000000000000030303030000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000026000110000105000fc0c0c0000080008000
+80808000ff0023060113080201020a0a416e6e756c657242746e010204212121
+21212121211700079fff190000000d009d022801a101a1000200010303030300
+11010180800000000000000000009d01a19d01a1000000000000010200270027
+00010f000128280001120001802020290001082020009d040000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000005050505050000000505050505000000000000000000000000000000
+0000000005010101010304000505010101040400000000000000000000000000
+0000000005050101010304040505010104040400000000000000000000000000
+0000000004050501010304050501010304040400000000000000000000000000
+0000000000050501010105050101030404040000000000000000000000000000
+0000000000040505010101010103040404000000000000000000000000000000
+0000000000000205010101010304040400000000000000000000000000000000
+0000000000000005010101030404040000000000000000000000000000000000
+0000000000000505010101010304000000000000000000000000000000000000
+0000000000050501010101010103040000000000000000000000000000000000
+0000000005050101030501010103040400000000000000000000000000000000
+0000000505010103040505010101030404000000000000000000000000000000
+0000050501010304040405050101010304040000000000000000000000000000
+0000050101010304040000050501010103040400000000000000000000000000
+0000000503030304040000000503030303040400000000000000000000000000
+0000000000040404040000000000040404040400000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000029000110000106
+0012c0c0c0800000008080000000808080ff0000120600030206000000000000
+1306007c08000d000000010104010f1011120101011700009fff140000000d1f
+9d045b01430d1a0002000103030303000d040360600000220000000000009d01
+439d0d1a01000000000001082a1001ff81000000000000000002010000000004
+0102009fff009fff20010100102b0000000404000000022c2d1e002a00002102
+02000000002c1e2b06000302010000000028282c060092082081029fff212104
+01212121212121212100009fff150000000d9d02a51f00d00209000100010303
+030300130101a0a00000000000000000009cd09d02090000000000000103010b
+2e0103640100009e0044201400000000002e00001c02070752f46c65203a0a10
+2d06000302080000000000000606005e08002e009fff03030303030303030303
+030300009fff0200000008009fff000000000000000000000002012f012f0000
+210002000000002f1a919c9c9ca99d01099d01149d018e9d01999d01a59d020b
+9d02169d02959d02a29d02ae9d032d9d033b9d03479d03a69d03b49d03c09d04
+309d048e9d04a59d04b19d05229d05829d058c9d06079d06139d061f9d06749d
+067b9d0a8e9d0aa69d0aff9d0b069d0f199d0f349d0f409d0fbb9d0fc79d0fd3
+9d10319d10409d104c9d107d9d10878c191a38626377919b9c9c9ca09ca99cc7
+9cf19cf29d01069d01099d01139d01149d01379d01619d01629d01769d018b9d
+018e9d01989d01999d01a59d01c99d01f39d01f49d02089d020b9d02159d0216
+9d02349d02609d02619d02759d028c9d02959d029f9d02a29d02ae9d02cc9d02
+f69d02f79d030b9d03249d032d9d03379d033b9d03479d03659d03919d03929d
+03949d03a69d03aa9d03b49d03c09d03ee9d041a9d041b9d041e9d04239d0430
+9d044e9d04799d047a9d047c9d048e9d04929d04a59d04b19d04df9d050c9d05
+0d9d05109d05159d05229d054b9d05769d05779d057a9d05809d05829d058c9d
+058c9d05aa9d05d69d05d79d05eb9d06029d06079d06119d06139d061f9d0645
+9d066f9d06709d06749d06789d067b9d06859d0a8e9d0aa69d0ace9d0afa9d0a
+fb9d0aff9d0b039d0b069d0b109d0f199d0f349d0f409d0f5e9d0f8a9d0f8b9d
+0f9f9d0fb69d0fbb9d0fc59d0fc79d0fd39d0ff19d101c9d101d9d101f9d1031
+9d10359d10409d104c9d106a9d10799d107a9d107c9d107d9d10879d10870301
-13e951d8


end class;

class MenuWin is mapped inherits from DisplayProject.UserWindow


has public  method Display;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+5151463100000379000002b09fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000201
+000100001b00000100030001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108076b0100000000000000000000020100000000
+090000070000210002000000000606005e08002e009fff030303030303030303
+03030300009fff0200000008009fff0000000000000000000000020108010800
+0021020200000000090a0906005c08000e000808436f6e74726f6c6503030303
+030303030303030300019fff1a00000008060808436f6e74726f6c6500000000
+0b00000000000002010c0103ff000b00001c0200100c0000210202000000000d
+0e0d06006a080002001010756e5365756c507269785075626c69630303030203
+0303030303030300029fff1500000008091313556e205365756c205072697820
+5075626c6963000000000f000000000000010200ff0f00001c0200100e06006a
+080002000a0a4d697365456e50726f6403030302030303030303030300039fff
+1b000000080912124d69736520656e2050726f64756374696f6e000000001000
+0000000000010200ff1000001c0200100a06005c08000e000a0a43616c63756c
+6574746503030303030303030303030300049fff170000000806111143616c63
+756c206465732054617269667300000000110000000000000201120103ff0011
+00001c02001012000021000200000000121a919c9c9ca39d01039d010d9d013e
+9d014a9d018e9d01959d01a19d01f59d01fc9d02499d02509d029f9d02a69d02
+b039191a38626377919b9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d
+010d9d012b9d013a9d013b9d013d9d013e9d01489d014a9d01709d01879d0188
+9d018a9d018b9d018e9d01929d01959d019f9d01a19d01cf9d01f19d01f29d01
+f59d01f99d01fc9d02249d02459d02469d02499d024d9d02509d02789d02989d
+02999d029b9d029c9d029f9d02a39d02a69d02b09d02b00301
-0173702c


end class;

class TarifClientWin is mapped inherits from DataAccessBD.StandardDataWin

has public  attribute ListeDevise: Framework.Array of Framework.ListElement;
has public  attribute ListeProduit: Framework.Array of Framework.ListElement;
has public  attribute ListeService: Framework.Array of Framework.ListElement;
has public  attribute TarifClientInfoArray: Framework.Array of TarificationClt.TarifClientDisplayNode;
has public  attribute UnTarifClientParam: TarificationClt.TarifClientParam;

has public  method AfficListe;
has public  method afficliste2;
has public  method DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method RemplaceLibelement(input unCode: Framework.integer,
	input aType: Framework.integer): Framework.TextData;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+5151463100005f30000054999fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+0001000025000003000b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+01080768010000005dc05dbf0000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d0a2a148c19f5000000000303030300050404606000002203e8
+07d000009d148c9d19f50000000000000108091001000000148c19f500000002
+0100000000040201009fff009fff20010100000a0000000404000100020b0c0d
+00090000210202000000000b0d0a06000302000000000000000b06007c08000d
+000d0d42617272654861757447726964010104010f1011120101011700029fff
+9e000100100000000d000001a119f50001000103030303000801046060000022
+0000000000009d01a19d19f500000000000001080e1001ff8100017719cc0000
+00020100000000040104009fff009fff20010100000f00000000000404000000
+00000210001100120013000e000021040200000000101211130f060003020900
+00000000001006007c08000d0015154465706c6163656d656e744f7574696c73
+47726964010104010f1011120101011700039fff9e000100130000000d000001
+7702af0001000103030303000b010160600000000000000000009d01779d02af
+0000000000000108141001ff8100014d0286000000020100000000040102009f
+ff009fff00010100001500000004040000000216001700140000210202000000
+00161715060003020100001414141416060113080201020c0c50726563656465
+6e7442746e01020421212121212121211700049fff9e000100110000000d1515
+0124012400010001030303030010010180800000000000000018199d01249d01
+240000000000000102001a001800001c020a0a5072e963e964656e740a101900
+001c0200101a00010f00011b1b00011200018014141c0001081414009d01900f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800
+010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f
+0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f
+0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f00
+00080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1c00011000019d0100009d030000000080
+80808000008080000080000080800000808000808080400040400080ff004080
+4000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff
+8000ff8080ffff8080ffff0080ff804000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000017060113
+080201020a0a53756976616e7442746e01020421212121212121211700059fff
+9e000100120000000d9d014d1501240124000100020303030300100101808000
+0000000000001d1e9d01249d01240000000000000102001f001d00001c020808
+53756976616e740a101e00001c0200101f00010f000120200001120001801414
+210001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f
+0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f
+0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f
+08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f
+0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f
+0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f210001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000001106007c08000d0012125374616e646172644f7574696c7347
+726964010104010f1011120101011700089fff9e000100180000000d9d06ac00
+017701770001000203030303000b010160600000000000000000009d01779d01
+770000000000000108221001ff8100014d014d00000002010000000004010100
+9fff009fff000101000023000004040000022400220000210102000000002423
+060003020100001414141424060113080201020b0b496d7072696d657242746e
+01020421212121212121211700099fff9e000100190000000d15150124012400
+010001030303030011010180800000000000000025269d01249d012400000000
+000001020027002500001c020909496d7072696d65720a102600001c02001027
+00010f000128280001120001801414290001081414009d01900f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e
+0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f0f0f0f
+0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e0000
+00000f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f00000000
+0000000000000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f
+0f0f0f000000000000000000000000000f0f000f0f0f0f000f0f0f0f0f0f0101
+010f0f000f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f0f0f00
+0000000000000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f
+000f0f0f0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f2900011000019d0100009d030000000080808080000080
+80000080000080800000808000808080400040400080ff0040804000ff804000
+ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ff
+ff8080ffff0080ff804000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000001206007c08000d001010
+4665726d65724f7574696c7347726964010104010f1011120101011700069fff
+9e000100160000000d9d0c2000017701770001000303030303000b0101606000
+00220000000000009d01779d017700000000000001082a1001ff8100014d014d
+000000020100000000040101009fff009fff00010100002b000004040000022c
+002a0000210102000000002c2b06000302010000141414142c06011308020102
+0a0a5175697474657242746e01020421212121212121211700079fff9e000100
+170000000d151501240124000100010303030300120101808000000000000000
+2d2e9d01249d01240000000000000102002f002d00001c020808517569747465
+720a102e00001c0200102f00010f000130300001120001801414310001081414
+009d01900707070707070707070707070707070707f807070707070707070700
+00000000000000fefef80707070707070707070000000000000000fefef80707
+07070707fefe0700f8f8f8f8f8f8fe0404f8070707070707fe0606fef8f8f8f8
+f8fe040404f8070707070707fe060606f8f8f8f8fe04040404f8070707060606
+06060606fefef8fe0404040404f8070707060606060606060000f8fe04040404
+04f807070706060606060606f8f8f8fe0404040404f8070707070707fe060600
+f8f8f8fe0404040404f8070707070707fe060000f8f8f8fe0404040404f80707
+07070707fe00f800f8f8f8fe0403040404f807070707070707f8f800f8f8f8fe
+0403040404f807070707070707f80700f8f8f8fe0404040404f8070707070707
+07070700f8f8f8fe0404040407f807070707070707070707070707fe04040407
+07f807070707070707070707070707fe04040407070707070707070707070707
+070707fe04040707070707070707070707070707070707fe0407070707070707
+07070707070707070707070707070707070707073100011000019d0100009d03
+00000000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff1306007c08000d009fff230104010f1011120101011700009fff9e0002000c
+0000000d9d11945300c6043b0001000403500303000b01016060000000000000
+0000009cc69d043b000000000000010832100100000000c6043b000000020100
+000000040102009fff009fff0001010000330000000404000000023400350032
+0000210202000000003435330600030201000000000000340600f60820890207
+074375724d6f646521020b212121212101010117000a0606537472696e679e00
+0100200000000d000000c6021e00010001030303030013010280a00000000000
+000000009cc69d021e00000000000001030201070007000009ff8100009e0040
+0014030100350600f6082089020606437572506f7321020b2121212121010101
+17000b0606537472696e679e000100210000000d9d021e0000c6021e00010002
+030303030013010280a00000000000000000009cc69d021e0000000000000103
+0201070007000009ff8100009e004000140301000c0600030209000000000000
+0d06007c08000d000909436f72707347726964010104010f1011120101011700
+0c9fff9e000100140000000d009d01a112ec19f5000200010303030300080404
+60600000220000000000009d12ec9d19f5000000000000010836100100000012
+ec19f5000000020100000000040102009fff009fff2001010000370000000404
+0001000238393a00360000210202000000003a38370600030201000000000000
+3806007c08000d00090947726964456372616e010104010f1011120101011700
+1d9fff9e0002000d0000000d000012ec180c0001000103030303000d04046060
+0000220000000000009d12ec9d180c00000000000001083b100100000012ec18
+0c000000020100000000040101009fff009fff00010100003c00000404000002
+3d003b0000210102000000003d3c06000302010000000000003d06007c08000d
+001010477269644c69737465734469616c6f67010104010f1011120101011700
+1e9fff9e0002000e0000000d000012ec180c0001000103030303003804046060
+0000220000000000009d12ec9d180c00000000000001083e100100000012ec18
+0c000000020100000000040201009fff009fff00010100003f00000004040200
+0002400041003e00002102020000000040413f06000302010000000000004006
+007c08000d0013136772696463686576617563686a656563617274010104010f
+10111201010117001f9fff9e0002000f0000000d00000bc2180c000100010303
+0303003d040460600000220000000000009d0bc29d180c000000000000010842
+10010000000bc2180c000000020100000000040201009fff009fff0001010000
+4300000004040001000244004500420000210202000000004544430600030201
+0000000000004406007c08000d009fff010104010f1011120101011700009fff
+9e000200140000000d0000029b180c0001000103030303004004046060000022
+0000000000009d029b9d180c0000000000000108461001000000029b180c0000
+00020100000000040103009fff009fff00010100004700000000040400000000
+02480049004a004600002103020000000048494a470600030201000000000000
+4806007c08000d009fff010104010f1011120101011700009fff9e0002001500
+00000d0000029b08040001000103030303004404046060000022000000000000
+9d029b9d080400000000000001084b1001ff8100027107da0000000201000000
+000401019f819fff9f819fff00010100004c000004040000024d004b00002101
+02000000004d4c06000302010000646464644d06007c08000d009fff01010b01
+0f1011120101011700009fff9e000200160000000d9d01fe6801a103d3000100
+01030303030048010260600000220000000000009d01a19d03d3000000000000
+01084e100100000001a103d3000000020100000000040201009fff009fff0001
+0100004f000000040400000002500051004e00002102020000000050514f0600
+03020100000000000050060092082081029fff21210401212121212121212100
+009fff9e000200170000000d000000db03d30001000103160403004d0104a0a0
+0000220000000000009cdb9d03d30000000000000103000b5201056400ffff9e
+0044001400000000005200001c0207074465766973650a10510600f608208902
+0a0a436f646544657669736501020b2121212121010101170026080854657874
+446174619e000200180000000d009cdb00c603d30002000103030303004d0102
+80a00000440000000000009cc69d03d30000000000000103020107000e040009
+ff8100009e004000140301004906007c08000d009fff010104010f1011120101
+011700009fff9e000200190000000d9d080400029b0804000100020303030300
+44040460600000220000000000009d029b9d08040000000000000108531001ff
+8100027107da0000000201000000000401019f819fff9f819fff000101000054
+0000040400000255005300002101020000000055540600030201000064646464
+5506007c08000d009fff010104010f1011120101011700009fff9e0002001a00
+00000d9d01fe6801a103d3000100010303030300490101606000002200000000
+00009d01a19d03d3000000000000010856100100000001a103d3000000020100
+000000040201009fff009fff0001010000570000000404000000025800590056
+000021020200000000585957060003020100000000000058060092082081029f
+ff21210401212121212121212100009fff9e0002001b0000000d000000db03d3
+000100010316040300550104a0a00000220000000000009cdb9d03d300000000
+00000103000b5a01056400ffff9e0044001400000000005a00001c0208085072
+6f647569740a10590600f6082089020b0b436f646550726f6475697401020b21
+21212121010101170027080854657874446174619e0002001c0000000d009cdb
+00c603d300020001030303030055010280a00000440000000000009cc69d03d3
+0000000000000103020107000e040009ff8100009e004000140301004a06007c
+08000d009fff010104010f1011120101011700009fff9e0002001d0000000d9d
+100800029b080400010003030303030044040460600000220000000000009d02
+9b9d080400000000000001085b1001ff8100027107da00000002010000000004
+01019f819fff9f819fff00010100005c000004040000025d005b000021010200
+0000005d5c06000302010000646464645d06007c08000d009fff010104010f10
+11120101011700009fff9e0002001e0000000d9d01fe6801a103d30001000103
+030303004a010160600000220000000000009d01a19d03d30000000000000108
+5e100100000001a103d3000000020100000000040201009fff009fff00010100
+005f000000040400000002600061005e00002102020000000060615f06000302
+0100000000000060060092082081029fff21210401212121212121212100009f
+ff9e0002001f0000000d000000db03d30001000103160403005d0104a0a00000
+220000000000009cdb9d03d30000000000000103000b6201056400ffff9e0044
+001400000000006200001c020808536572766963650a10610600f6082089020b
+0b436f64655365727669636501020b2121212121010101170028080854657874
+446174619e000200200000000d009cdb00c603d30002000103030303005d0102
+80a00000440000000000009cc69d03d30000000000000103020107000e040009
+ff8100009e004000140301004506007c08000d000000010104010f1011120101
+011700009fff9e000200100000000d009d029b0928180c000200010303030300
+40040460600000220000000000009d09289d180c0000000000000108631001ff
+ff00091317f7000000020100000000040101009fff009fff0001010000640000
+0404000002650063000021010200000000656406000302010000000000006506
+007c08000d009fff010104010f1011120101011700009fff9e00020011000000
+0d0000091317f700010001030303030045040460600000220000000000009d09
+139d17f70000000000000108661001ff810008e917cd00000002010000000004
+02019f819fff9f819fff20010100006700000004040001000268006900660000
+21020200000000686967060003020000000000000068060092082081029fff21
+210401212121212121212100009fff9e000200120000000d000000f017cd0001
+00010316040300650404a0a00000220000000000009cf09d17cd000000000000
+0103000b6a0105780100009e0040001400000000006a00001c021e1e44e97461
+696c7320646573207461726966732070726976696ce86765730a206906014108
+00090213135461726966436c69656e744c697374566965770102042121212121
+01010117002016165461726966436c69656e74446973706c61794e6f64659e00
+0200130000000d009cf007fa17cd000200010303030300650404a0a000002200
+0a000000009d07fa9d17cd0000000000000103020206f3016b00000000050101
+0202460a02006b0000210502000000006c6d6e6f706c0600bc03080200210101
+7100728000007100001c02010120107200001c020b0b4456536d616c6c49636f
+6e106d0600bc030300002207017300741000007300001c0207074d6f6e74616e
+74107400001c020a0a44564e6f646554657874106e0600bc0307000023140175
+00761000007500001c0217174e6f6d6272652064652062e96ee9666963696169
+726573207600001c020b0b4e62506572736f6e6e6573106f0600bc0307000024
+19017700781000007700001c021e1e4e6f6d6272652064652062e96ee9666963
+69616972657320616374696673207800001c0211114e62506572736f6e6e6573
+41637469667318700600bc03070000250f0179007a1000007900001c02141450
+617274206465206c6120636c69656e74e86c65187a00001c0204045061727410
+4106007a08004d00060650616e656c30010104010f1011120101011700299fff
+0e0000000d009d0bc20729180c0002000103050303003d010460600000220bb8
+0fa000009d07299d180c00000000000001087b2001ff8100070017e200000002
+01000000000900007b0000210102000000007c7c06007c08000d000000010104
+010f1011120101011700009fff9e000200210000000d9ff700070017f7000000
+00030303030041010460600000220000000000009d07009d17f7000000000000
+01087d1001ff810006d617cd0000000201000000000402019f819fff9f819fff
+00010100007e0000000404010000027f8081827d000021020200000000817f7e
+06000302010000000000007f06007c08000d009fff010104010f101112010101
+1700009fff9e000200230000000d000003b417cd0001000103510303007c0104
+60600000220000000000009d03b49d17cd000000000000010883100100000003
+b417cd000000020100000000040201009fff009fff2001010000840000000404
+0001000285008600830000210202000000008586840600030200000000000000
+85060092082081029fff21210401212121212121212100009fff9e0002002400
+00000d000000f017cd0001000103160403007f0404a0a0000022000000000000
+9cf09d17cd0000000000000103000b870105780100009e004000140000000000
+8700001c020606546f74616c0a108606014108000902090942696c616e566965
+77010204212121212101010117002c16165461726966436c69656e7444697370
+6c61794e6f64659e000200250000000d009cf002c417cd000200010303030300
+7f0104a0a00000220002000000009d02c49d17cd0000000000000103020206f3
+01880000000005010102024602020088000021040200000000898a8b8c890600
+bc030802002d01018d008e8000008d00001c02010120108e00001c020b0b4456
+536d616c6c49636f6e108a0600bc030700002e18018f00901000008f00001c02
+1d1d4e6f6d62726520546f74616c2064652062e96ee966696369616972657320
+9000001c020b0b4e62506572736f6e6e6573108b0600bc030700002f1d019100
+921000009100001c0223234e6f6d62726520546f74616c2064652042e96ee966
+6963696172657320616374696673289200001c0211114e62506572736f6e6e65
+73416374696673188c0600bc03070000300f019300941000009300001c021414
+50617274206465206c6120636c69656e74e86c65189400001c02040450617274
+108006000302070000000000008106007c08000d000c0c4469616c6f67756547
+726964020104010f10111201010117002a9fff9e0001001c0000000d009d03b4
+032217cd0002000103030303007c010460600000220000000000009d03229d17
+cd0000000000000108951001000000032217cd00000002010000000004020100
+9fff009fff200101000096000000040400000002970098009500002102020000
+0000979896060003020200000000000097060092082081029fff212104012121
+21212121212100009fff9e000200220000000d0000009c17cd00010001031604
+0300810104a0a00000220000000000009c9c9d17cd0000000000000103000b99
+020100009e0044001400000000009900001c0209094469616c6f6775650a1098
+060084082009020b0b5374617475735f4c696e6502020c212121212101010117
+002b080854657874446174610d0000000d009c9c028617cd0002000103030303
+00810204a0a00000440000001900009d02869d17cd0100000000000103020107
+005d06000501040000ff81018206000302010000000000003906000302060000
+000000003a06007c08000d000f0f426172726544726f69746547726964010104
+010f10111201010117000d9fff9e0001000c0000000d9d180c0012ec01ea0001
+000203030303000d040160600000220000000000009d12ec9d01ea0000000000
+0001089a1001ff810012c201c0000000020100000000040201009fff009fff20
+010100009b0000000404000000029c9c009c9d009a0000210202000000009c9d
+9c9c9b06000302070000141400009c9c06007c08000d000d0d4374694f757469
+6c7347726964010104010f1011120101011700139fff9e000100230000000d49
+9d01ea0afd012e0001000103030303003a010160600000000000000000009d0a
+fd9d012e00000000000001089c9e10010000000afd012e000000020100000000
+040901009fff009fff20010100009c9f00000000000000000000040400000000
+000000000000029ca0009ca1009ca2009ca3009ca4009ca5009ca6009ca7009c
+a8009c9e0000210902000000009ca09ca19ca29ca39ca49ca59ca79ca89ca69c
+9f060003020100001e1e00009ca0060113080201020b0b446563726f63686542
+746e22020421212121212121211700149fff9e000100240000000d001f012401
+240001000103030303009c9c01018080000000000000009ca99caa9d01249d01
+240000000000000102009cab009ca900001c020a0a44e963726f636865720a10
+9caa00001c0200109cab00010f00019cac9cac00011200018014149cad000104
+140a009cc8111111111111111111111111222222222222111111220000000000
+0022111220000000000000022122000022222222000022200002211111122000
+0220000211111111200002222222111111112222221111111111111111111111
+1112211111112211111111200222222200211111112000000000002111111200
+0020202000021111220000000000000221122000002020200000212200000000
+0000000022200000002020200000022000000000000000000212222222222222
+222221111111111111111111119cad0001100001030009ffff00c0c0c0000000
+9ca1060113080201020c0c52616363726f63686542746e220204212121212121
+21211700159fff9e000100250000000d009d0162012401240002000103030303
+009c9c01018080000000000000009cae9caf9d01249d01240000000000000102
+009cb0009cae00001c020b0b52616363726f636865720a109caf00001c020010
+9cb000010f00019cb19cb100011200018014149cb2000104140a009cc8000000
+0033300000000000111111333111111100012222223332222222100122222233
+3222222210122222223332222222211222211033300112222111111100333000
+1111111222210033300012222101111100333000111110000000003330000000
+0000000333333333000000000000333333300000000000000333330000000000
+0000003330000000000000000003000000000000001110000001110000000111
+1111111111100000122222222222221000012222222222222221004444444444
+44444444449cb2000110000105000fc0c0c0000000ffff00ff0000ffffff9ca2
+060113080201020a0a4c69626572657242746e22020421212121212121211700
+169fff9e000100260000000d009d02a50143012e0003000103030303009c9c01
+018080000000000000009cb39cb49d01439d012e0000000000000102009cb500
+9cb300001c0206064c696272650a109cb400001c0200109cb500010f00019cb6
+9cb600011200018017159cb7000104160b009cfd000000000000000000008100
+0000000000000000028100000000000000000022810000000000000000022281
+0000000000000000022081000000000000000022208100000000000000022200
+8100000000000000222000810000000000000022200081000000000000022200
+0081020000000000222200008102200000000222200000810222000000022200
+0000810222200000222200000081022222000222200000008102222220222220
+0000008100222222222200000000810002222222200000000081000022222220
+0000000081000002222200000000008100000022220000000000810000000220
+00000000008100000000000000000000819cb70001100001030009c0c0c00000
+0000ff009ca3060113080201020a0a417474656e746542746e22020421212121
+212121211700179fff9e000100270000000d009d040701190124000400010303
+0303009c9c01018080000022000000009cb89cb99d01199d0124000000000000
+0102009cba009cb800001c020808417474656e74650a109cb900001c0200109c
+ba00010f00019cbb9cbb00011200018013149cbc000104140a009cbe00000000
+0000000000000000000111000000000000000111221000000000000012212211
+1000000000001221221221000000001112212212210000000122122122122100
+0000012212212212210000000122122122122100000001221221221221001100
+0122222222222101221001222222222221122210012222222222222221000122
+2222222222221000012222222222222100000122222222222210000000122222
+22222100000000012222222210000000000011111111000000009cbc00011000
+01030009c0c0c0000000ffff009ca4060113080201020c0c5472616e73666572
+7442746e22020421212121212121211700189fff9e000100280000000d009d05
+40012401240005000103030303009c9c01018080000000000000009cbd9cbe9d
+01249d01240000000000000102009cbf009cbd00001c020b0b5472616e7366e9
+7265720a109cbe00001c0200109cbf00010f00019cc09cc00001120001801414
+00000118143c009d04b0c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000000000000000000000c6
+c6c6000000ffff00ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00ffff00ffff000000000000
+00ffff00ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6ff0000000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00
+ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff00
+00000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff0000
+0000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6
+000000000000000000ffff00ffff00000000000000ffff00ffff00000000c0c0
+c0c6c6c6c6c6c6c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6
+c6c6000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6
+c6c6c6c6c6c6ff0000c0c0c0c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c60000
+00ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6
+c6c6ff0000ff0000c6c6c6ff0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00
+ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff00
+00c0c0c0ff0000ff0000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff0000
+0000000000ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0
+c0c0c0ff0000c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff000000000000
+00ffff00ffff00000000c0c0c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0
+c0c0c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000000000ffff00
+ffff00000000c0c0c0c0c0c0c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6
+c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff0000
+0000c0c0c0c0c0c0c0c0c0ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0
+c0c0c0c0c0c0000000ffff00ffff00000000000000ffff00ffff000000000000
+00000000c0c0c0ff0000c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c000000000
+0000000000ffff00ffff00000000000000ffff00ffff00000000ffff00ffff00
+000000ff0000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff000000
+00ffff00ffff00000000000000ffff00ffff00000000ffff00ffff00000000ff
+0000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00
+ffff00000000000000ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff0000
+0000000000ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000c6c6
+c6000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000000000000000000000000000c0c0c09ca506011308
+0201020808506175736542746e22020421212121212121211700199fff9e0001
+00290000000d009d0683012401240006000103030303009c9c01018080000000
+000000009cc19cc29d01249d01240000000000000102009cc3009cc100001c02
+060650617573650a109cc200001c0200109cc300010f00019cc49cc400011200
+0180141400000118143c009d04b0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000000000000000
+0000000000000000000000000000000000000000000000000000000000c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000ffff00ffff00ffff00ffff
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00000000000000c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00ffff00ffff00ffff00
+ffff00ffff00ffff00ffff00ffff00ffff00ffff00000000c0c0c0c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00ffff0000000000000000000000000000000000
+0000000000000000000000ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000000000c6c6c6000000ffff00ffff00ffff000000
+00c6c6c6000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c0c0c000
+0000000000000000c6c6c6000000ffff00ffff00ffff00ffff00ffff00000000
+c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c0c0c0000000ffff00000000000000000000000000000000ffff00000000c0
+c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000
+ffff00ffff00000000ffffffffffffffffff000000ffff00ffff00000000c0c0
+c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0000000ffff00ffff00ff
+ff00000000ffffffffffffffffff000000ffff00ffff00ffff00000000c6c6c6
+c0c0c0c6c6c6c0c0c0c0c0c0c0c0c00000000000ff0000ff0000ff0000ff0000
+ff0000ff000000000000000000ffff00ffff00ffff00ffff00000000c6c6c6c6
+c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000ff0000ff0000ff0000ff
+ffff00ffff00ffff00ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c0c0
+c0c0c0c00000ff80ffff0000ff0000ff0000ff0000ff0000ff0000ff00000000
+0000000000000000000000000000000000c0c0c0c6c6c6c6c6c6c0c0c00000ff
+00ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c0c0c0c0c0
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c0c0c00000ff80ffff80
+ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c00000ff80ffff80ffff0000
+ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff
+0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000ff00
+00ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000ff0000
+ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c69ca6
+060113080201020e0e46696e456e726567697374726572230204212121212121
+212117001c9fff9e0001002c0000000d009d07c6012401240007000103030303
+009c9c01018080000000000000009cc59cc69d01249d01240000000000000102
+009cc7009cc500001c020c0c456e7265676973747265720a109cc600001c0200
+109cc700010f00019cc89cc800011200018014149cc9000104140a009cc83311
+1111111111111133333000000000000003333333111111111111333303333000
+0000000333300033332000444433334000033330000003333000000033330000
+3333000010000333344333340001100004333333334400011000040333333044
+0001100004403333044400011000044333333444000110000033333333000001
+1001133330033331100110113333000033331101101333300000033331011033
+3310000001333301133331000000001333313333000000000000333333311111
+1111111113319cc9000110000105000f000000c0c0c000ffffff0000ffffff9c
+a7060113080201020b0b456e7265676973747265722202042121212121212121
+17001a9fff9e0001002a0000000d009d0909012401240008000103030303009c
+9c01018080000000000000009cca9ccb9d01249d01240000000000000102009c
+cc009cca00001c020c0c456e7265676973747265720a109ccb00001c0200109c
+cc00010f00019ccd9ccd00011200018014149cce000104140a009cc811111111
+1111111111111000000000000000000110111111111111111101000000000000
+0000000000302020004444444440000000000000000000000000000000000000
+0000100004444444444400011000044044440444000110000400044000440001
+1000044044440444000110000444444444440001100000000000000000011001
+1100000000111001101111100000011111011011111000000111110110111110
+0000011111011001110000000011100110000000000000000001111111111111
+111111119cce000110000105000f000000c0c0c000ffffff0000ffffff9ca806
+00f608208902070745746174437469020204212121212101010117001b080854
+657874446174619e0001002b0000000d0a9d0a4b0092010f0009000103050303
+009c9c010180a0000044000000009ccf9cd0929d010f02000000000001030105
+3c00070005040009ff8100009e004020140301009ccf00001c02101045746174
+20636f6e7365696c6c65720a119cd000001c0200109c9d06007c08000d001111
+47656e6572616c4f7574696c7347726964230104010f10111201010117000e9f
+ff9e000100150000000d009d0ed003de01c00002000103030303003a01016060
+0000220000000000009d03de9d01c000000000000001089cd11001ff810003b4
+0196000000020100000000040101009fff009fff20010100009cd20000040400
+00029cd3009cd10000210102000000009cd39cd206000302010000141414149c
+d306007c08000d0016165374616e646172644f7574696c734772696456657274
+010104010f10111201010117000f9fff9e0001002f0000000d1515038a016d00
+01000103030303009c9d010160600000000000000000009d038a9d016d000000
+00000001089cd41001ff810003610143000000020100000000040301009fff00
+9fff00010100009cd500000000040400000000029cd6009cd7009cd8009cd400
+00210302000000009cd79cd69cd89cd506000302010000141414149cd6060113
+080201020a0a416a6f7574657242746e01220421212121212121211700119fff
+9e0001001b0000000d1515010f01190001000103030303009cd3010180800000
+00000000009cd99cda9d010f9d01190000000000000102009cdb009cd900001c
+0208084e6f75766561750a109cda00001c0200109cdb00010f00019cdc9cdc00
+011200018012139cdd0001081313009d01560707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707040707070707070707070707
+0707070707070704040707070707070707040707070707070707040204070707
+0707040704070407070707070704020204070707070704040407070707070707
+0402020204070704040404040404070707070704020204070707070704040407
+0707070707070402040707070707040704070407070707070704040707070707
+0707070407070707070707070407070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+07070707070707079cdd00011000019d0100009d0300000000bf000000bf00bf
+bf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000000000fffbf0a0a0a48080
+80ff000000ff00ffff000000ffff00ff00ffffffffff9cd7060113080201020c
+0c5375707072696d657242746e01220421212121212121211700109fff9e0001
+001a0000000d1f9d0139010401040002000103030303009cd301018080000000
+000000009cde9cdf9d01049d01040000000000000102009ce0009cde00001c02
+0a0a5375707072696d65720a109cdf00001c0200109ce000010f00019ce19ce1
+00011200018011119ce20001081111009d012107070707070707070707070707
+0707070707070707070707000007070707070707070707070707070000ff0000
+070707070707070707070700ff00ff00ff000707070707070707070700ff00ff
+00ff070707070707070707070700ff00ff070707010107070707070707070707
+000707f80101f8f8070707000000f801010007f80101f8f80707070700ffff00
+f8f801010101f8f800070707070700ffff0007f8010101f8ff00070707070707
+00ff07070101010101ff0007070707070700ff07f80101f8f801010007070707
+07070707070101f8f8ff0101f80707070707070707f80101f8fffffff8010707
+0707070707070101f8f80000000701f80707070707070701f8f80707070707f8
+f8070707070707070707070707070707070707079ce200011000019d0100009d
+0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffff
+ffff9cd806011308020102090953617576657242746e01020421212121212121
+211700129fff9e000100220000000d1f9d025200fa00fa000300010303030300
+9cd301018080000000000000009ce39ce49cfa9cfa0000000000000102009ce5
+009ce300001c0207075361757665720a109ce400001c0200109ce500010f0001
+9ce69ce600011200018010109ce70001081010009d0100070707070707070707
+0707070707070707000000000000000000000000000007070003000707070707
+0707070007000707000300070707070707070700000007070003000707070707
+0707070003000707000300070707070707070700030007070003000707070707
+0707070003000707000300070707070707070700030007070003030000000000
+0000000303000707000303030303030303030303030007070003030000000000
+0000000003000707000303000000000000070700030007070003030000000000
+0007070003000707000303000000000000070700030007070700000000000000
+00000000000007070707070707070707070707070707079ce700011000019d01
+00009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0
+a6caf00000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00
+ffffffffff0606005e08002e009fff03030303030303030303030300009fff02
+00000008009fff000000000000000000000002019ce8019ce800002104020000
+00009ce99cea9ceb9cec9ce906005c08000e00090943747874506f7055700303
+0303030303030303030300319fff9e0001002d0000000806090943747874506f
+705570000000029ced00000000000002019cee0103ff009ced00001c0200109c
+ee0000210102000000009cef9cef06006a0800020007074974656d5473740303
+0302030303030303030300329fff9e0001002e000000089ce907074974656d54
+7374000000039cf0000000000000010200ff9cf000001c0200109cea06005c08
+000e00040466696c6501030303030303030303030300339fff10000000080605
+052646696c65000000000000000000000002019cf10103ff009cf10000210202
+000000009cf29cf39cf206006a0800020205057072696e740303030203030303
+0303030300349fff11000000089cea9fff000000000000000000000001020012
+9cf306006a080002020a0a7072696e7473657475700303030203030303030303
+0300359fff12000000089cea9fff0000000000000000000000010200119ceb06
+005c08000e000606416374696f6e01030303030303030303030300369fff1500
+00000806070726416374696f6e000000000000000000000002019cf40103ff00
+9cf40000210102000000009cf59cf506006a0800020209094e657757696e646f
+7703030302030303030303030300379fff16000000089ceb0b0b264e65772057
+696e646f77000000000000000000000001020eff9cec06005c08000e00040448
+656c7001030303030303030303030300389fff1700000008069fff0000000000
+00000000000002019cf6010303009cf60000210002000000009cf61a919c9c9c
+b89d01189d01239d01a19d01ad9d01b99d024b9d02599d02659d02f79d03039d
+030f9d036c9d037e9d03859d038c9d052f9d083c9d08999d08a99d08b09d08b7
+9d0a5a9d0d679d0df49d0dff9d0e0b9d0e679d0e789d0e7f9d0e869d10299d13
+369d13c19d13cc9d13d89d14339d14439d144a9d14519d15f49d19019d197f9d
+198b9d19979d1a059d1a749d1a809d1b089d1b149d1b209d1ba29d1bad9d1bb9
+9d1c469d1c529d1c5e9d1cee9d1cfa9d1d069d1d879d1d949d1da09d1e1b9d1e
+269d1e329d1eb19d1ebd9d1ec99d1f299d1f389d1fac9d20299d20349d20409d
+20bf9d20cb9d20d79d21379d21479d21bc9d22399d22449d22509d22cf9d22db
+9d22e79d23479d23579d23cc9d24479d24529d245e9d24dd9d24e99d24f59d25
+559d257b9d26069d26159d26269d262f9d26429d26539d26629d26749d26859d
+26a49d26b79d26c89d26ee9d27079d27189d27349d27409d27a89d27b39d2833
+9d283f9d284b9d28c89d28d49d28e09d29409d294e9d29cf9d29dd9d29ee9d29
+f79d2a0a9d2a1b9d2a409d2a539d2a649d2a8f9d2aa89d2ab99d2ad59d2ae19d
+2aed9d2b789d2b849d2b909d2bee9d2bff9d2c6c9d2c789d2c849d2d149d2d22
+9d2d2e9d2de29d2dff9d2e0c9d2e6d9d2e809d2e889d2e919d2f6d9d2f809d2f
+e49d2ff89d30009d30099d30e59d30fe9d31609d316f9d31779d31809d32919d
+32a49d33069d33179d331f9d33289d33fa9d340d9d34719d34859d348d9d3496
+9d395a9d39ba9d39c99d39d19d39da9d3e9e9d3f049d3f199d3f219d3f2a9d40
+069d401f9d40829d40979d409f9d40a89d41849d419d9d42149d422d9d42359d
+42c59d42d29d42df9d437d9d438e9d439b9d43fb9d440c9d44149d441d9d4588
+9d48969d48fa9d490d9d49159d491e9d4a549d4d629d4dc19d4dd19d4dd99d4d
+e29d4ef79d52059d52379d524a9d52979d529f9d52ac9d52f29d52fa9d53399d
+53489d53809d53bd9d54009d540d9d54549d548e9d54999d0298191a38626377
+919b9c9c9ca09cb89cd69d01009d01019d01159d01189d01229d01239d01469d
+01709d01719d01859d019c9d01a19d01ab9d01ad9d01b99d01e89d02129d0213
+9d02279d02429d024b9d02559d02599d02659d029c9d02c69d02c79d02db9d02
+f29d02f79d03019d03039d030f9d033d9d03679d03689d036c9d03709d037e9d
+03829d03859d03899d038c9d03969d052f9d083c9d08689d08949d08959d0899
+9d089d9d08a99d08ad9d08b09d08b49d08b79d08c19d0a5a9d0d679d0d9b9d0d
+c79d0dc89d0ddc9d0df19d0df49d0dfe9d0dff9d0e0b9d0e389d0e629d0e639d
+0e679d0e6b9d0e789d0e7c9d0e7f9d0e839d0e869d0e909d10299d13369d1368
+9d13949d13959d13a99d13be9d13c19d13cb9d13cc9d13d89d14049d142e9d14
+2f9d14339d14379d14439d14479d144a9d144e9d14519d145b9d15f49d19019d
+19239d194e9d194f9d19639d197a9d197f9d19899d198b9d19979d19c69d19ef
+9d19f09d19f39d19f89d1a059d1a339d1a5e9d1a5f9d1a629d1a679d1a749d1a
+809d1aab9d1ad79d1ad89d1aec9d1b039d1b089d1b129d1b149d1b209d1b4b9d
+1b759d1b769d1b8a9d1b9f9d1ba29d1bac9d1bad9d1bb99d1beb9d1c159d1c16
+9d1c2a9d1c419d1c469d1c509d1c529d1c5e9d1c939d1cbd9d1cbe9d1cd29d1c
+e99d1cee9d1cf89d1cfa9d1d069d1d289d1d529d1d539d1d679d1d809d1d879d
+1d919d1d949d1da09d1dc29d1dec9d1ded9d1e019d1e189d1e1b9d1e259d1e26
+9d1e329d1e549d1e809d1e819d1e959d1eac9d1eb19d1ebb9d1ebd9d1ec99d1e
+eb9d1f149d1f159d1f179d1f299d1f2d9d1f389d1f6c9d1f969d1f979d1f9a9d
+1f9f9d1fac9d1fce9d1ffa9d1ffb9d200f9d20269d20299d20339d20349d2040
+9d20629d208e9d208f9d20a39d20ba9d20bf9d20c99d20cb9d20d79d20f99d21
+229d21239d21259d21379d213b9d21479d217c9d21a69d21a79d21aa9d21af9d
+21bc9d21de9d220a9d220b9d221f9d22369d22399d22439d22449d22509d2272
+9d229e9d229f9d22b39d22ca9d22cf9d22d99d22db9d22e79d23099d23329d23
+339d23359d23479d234b9d23579d238c9d23b69d23b79d23ba9d23bf9d23cc9d
+23ee9d241a9d241b9d242f9d24449d24479d24519d24529d245e9d24809d24aa
+9d24ab9d24bf9d24d89d24dd9d24e79d24e99d24f59d25179d25409d25419d25
+439d25559d25599d257b9d25c69d25f19d25f29d25f59d25fd9d26049d26109d
+26159d26269d262a9d262f9d26339d26429d26539d26579d26629d26669d2674
+9d26859d26899d26a49d26a89d26b79d26c89d26cc9d26ee9d26f29d27079d27
+189d271c9d27349d27389d27409d27649d27909d27919d27a59d27a89d27b29d
+27b39d27d59d28009d28019d28159d282e9d28339d283d9d283f9d284b9d286d
+9d28979d28989d28ac9d28c39d28c89d28d29d28d49d28e09d29029d292b9d29
+2c9d292e9d29409d29449d294e9d298f9d29ba9d29bb9d29be9d29c69d29cd9d
+29d99d29dd9d29ee9d29f29d29f79d29fb9d2a0a9d2a1b9d2a1f9d2a409d2a44
+9d2a539d2a649d2a689d2a8f9d2a939d2aa89d2ab99d2abd9d2ad59d2ad99d2a
+e19d2aed9d2b1b9d2b479d2b489d2b5c9d2b739d2b789d2b829d2b849d2b909d
+2bb29d2bdb9d2bdc9d2bde9d2bee9d2bf29d2bff9d2c309d2c5b9d2c5c9d2c5f
+9d2c649d2c6c9d2c789d2c849d2cb59d2ce19d2ce29d2cf69d2d0d9d2d149d2d
+1e9d2d229d2d2e9d2d5e9d2d8a9d2d8b9d2da09d2dc69d2de29d2ded9d2dff9d
+2e0c9d2e3a9d2e679d2e689d2e6d9d2e729d2e809d2e859d2e889d2e8d9d2e91
+9d2e9d9d2f6d9d2f809d2faf9d2fde9d2fdf9d2fe49d2fe99d2ff89d2ffd9d30
+009d30059d30099d30159d30e59d30fe9d312b9d315a9d315b9d31609d31659d
+316f9d31749d31779d317c9d31809d318c9d32919d32a49d32d19d33009d3301
+9d33069d330b9d33179d331c9d331f9d33249d33289d33349d33fa9d340d9d34
+3c9d346b9d346c9d34719d34769d34859d348a9d348d9d34929d34969d34a19d
+395a9d39859d39b49d39b59d39ba9d39bf9d39c99d39ce9d39d19d39d69d39da
+9d39e59d3e9e9d3ecf9d3efe9d3eff9d3f049d3f099d3f199d3f1e9d3f219d3f
+269d3f2a9d3f369d40069d401f9d404d9d407c9d407d9d40829d40879d40979d
+409c9d409f9d40a49d40a89d40b49d41849d419d9d41cf9d41fc9d41fd9d4202
+9d42079d42149d42199d422d9d42329d42359d42699d42959d42969d42ab9d42
+c19d42c59d42d09d42d29d42df9d43189d43439d43449d43599d43739d437d9d
+43889d438e9d439b9d43c89d43f59d43f69d43fb9d44009d440c9d44119d4414
+9d44199d441d9d44299d45889d48969d48c59d48f49d48f59d48fa9d48ff9d49
+0d9d49129d49159d491a9d491e9d492a9d4a549d4d629d4d8e9d4dbb9d4dbc9d
+4dc19d4dc69d4dd19d4dd69d4dd99d4dde9d4de29d4dee9d4ef79d52059d5223
+9d52329d52339d52369d52379d52429d524a9d52769d528f9d52909d52939d52
+949d52979d529c9d529f9d52aa9d52ac9d52d69d52ee9d52ef9d52f29d52f79d
+52fa9d531d9d53319d53329d53359d53369d53399d53449d53489d536c9d537c
+9d537d9d53809d53a99d53b99d53ba9d53bd9d53e29d53f89d53f99d53fc9d53
+fd9d54009d540b9d540d9d54359d54509d54519d54549d54779d54869d54879d
+548a9d548b9d548e9d54999d54990301
-345ee326


end class;

class TarificationWin is mapped inherits from DataAccessBD.StandardDataWin

has public  constant APP_APPLICATIONNAME = 'Tarification : Administration';
has public  constant IDX_ZONEVIDE = '';
has public  constant MSG_SELECT_3 = 'Valider puis afficher la règle sélectionnée ?';

has public  attribute CompletionAutomatique: Framework.boolean;
has public  attribute CurrentIdRegle: Framework.integer;
has public  attribute CurrentPositionRegle: Framework.integer;
has public  attribute DataModeRegle: Framework.integer;
has public  attribute ErreurSiARenseigner: Framework.boolean;
has public  attribute IsServiceRemisable: Framework.boolean;
has public  attribute MyCacheRegle: DataAccessSrvBD.Cache;
has private attribute Panel0_HasDataChanged_Modifie: Framework.boolean;
has private attribute PremierRead: Framework.boolean;
has private attribute QuitterBtnEventRegistration: Framework.EventRegistration;
has private attribute SauvegardeDataMode: Framework.integer;
has private attribute SubmitRegleOnShutdown: Framework.boolean;

has private method AddRegle(input Mode: Framework.integer);
has private method AddRegle;
has public  method AffectDataWinRegle(input aObject: Framework.Object);
has public  method AffFirstPositionRegle;
has public  method AfficherSelection(input ChangementSelection: Framework.boolean);
has public  method AffPositionRegle;
has public  method AppendEvent(input aObject: Framework.Object);
has public  method AppendRegle;
has public  method ChangementPackage;
has public  method ChangementProduit;
has public  method ChangementService;
has public  method ChangerListePromotion(input RemisableBln: Framework.boolean);
has public  method ChangerSelection: Framework.boolean;
has public  method CompleteRegle(input Regle: TarificationSrv.RegleDesc);
has public  method DeleteEvent(input aObject: Framework.Object);
has public  method DeleteRecordRegle(input aRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method DeleteRegle;
has public  method DoAffectObject(output pObject: Framework.Object);
has public  method DoAffectObjectRegle(output pObject: Framework.Object);
has public  method DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method DoAffRecordRegle(input pRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method Fermer;
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method InitListeSelectionRegle;
has public  method InitListField(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer);
has public  method InitScrollList(input aWidget: DisplayProject.Widget,
	input NomClassDico: Framework.string,
	input ListeSelection: Framework.Array of Framework.IntegerData);
has public  method Read;
has public  method ResetWindowRegle;
has public  method SetDataModeRegle(input DataMode: Framework.integer);
has public  method Submit;
has public  method SubmitRegle;
has public  method UpdateEvent(input aObject: Framework.Object);
has public  method UpdateRecordRegle(input aRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method UpdateRegle;
has public  method VoireTarifPrivilege;

has public  event handler ChangerSelectionEvh();
has public  event handler DefaultRegleEvh();
has public  event handler DeplacementPrixPublicEvh();
has public  event handler DeplacementRegleEvh();
has public  event handler EventLoopHandler();
has public  event handler MiseEnProductionEvh();
has public  event handler QuitterBtnEvh();
has public  event handler StandardOutilsPrixPublicEvh();
has public  event handler StandardOutilsRegleEvh();
has public  event handler StrategieSelectionEvh();
has public  event handler UnSeulPrixPublicEvh();
has public  event handler VoireTarifPrivilegeEvh();

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+51514631000084c7000074389fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+000100005d000003001b0001000000000003000021010200000000050400001c
+021d1d546172696669636174696f6e203a2041646d696e697374726174696f6e
+3c0506007a08004d009fff010101010f1011120101010100009fff010000000d
+00005dc05dbf000000000303030300020404a0a00000000000000000009d5dc0
+9d5dbf00000000000001080768010000005dc05dbf0000000201000000000900
+0007000021010200000000080806007c08000d0005054772696430010104010f
+1011120101011700019fff0c0000000d0000153319f500000000030303030005
+0404606000002203e807d000009d15339d19f500000000000001080910010000
+00153319f5000000020100000000040201009fff009fff20010100000a000000
+0404000100020b0c0d00090000210202000000000b0d0a060003020100000000
+00000b06007c08000d000d0d42617272654861757447726964010104010f1011
+120101011700029fff9e000100100000000d0000028619f50001000103030303
+0008010460600000220000000000009d02869d19f500000000000001080e1001
+ff8100025c19cc000000020100000000040205009fff009fff20010100000f00
+0000000000000404000000000000000200001000000000000000110012001300
+140015000e0000210602000000001114131510120f0600030209000000000000
+10060078080201020a0a4d697365456e50726f64010204212121212121212117
+000c9fff9e0002005c0000000d9d05160000e502ee0001000203030303000b01
+01a0a00000000000000000009ce59d02ee000000000000010b0a0a4d69736545
+6e50726f64000201000000001106007c08000d0015154465706c6163656d656e
+744f7574696c7347726964230104010f1011120101011700039fff9e00010013
+0000000d009ce5017702af0002000103030303000b0101606000000000000000
+00009d01779d02af0000000000000108161001ff8100014d0286000000020100
+000000040102009fff009fff0001010000170000000404000000021800190016
+000021020200000000181917060003020100001414141418060113080201020c
+0c507265636564656e7442746e01020421212121212121211700049fff9e0001
+00110000000d1515012401240001000103030303001101018080000000000000
+001a1b9d01249d01240000000000000102001c001a00001c020a0a5072e963e9
+64656e740a101b00001c0200101c00010f00011d1d00011200018014141e0001
+081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f
+0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800
+010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f08
+00010f0f0800010f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f
+0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f
+0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1e00011000019d0100
+009d030000000080808080000080800000800000808000008080008080804000
+40400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff
+0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000019060113080201020a0a53756976616e7442746e0102042121212121
+2121211700059fff9e000100120000000d9d014d150124012400010002030303
+03001101018080000000000000001f209d01249d012400000000000001020021
+001f00001c02080853756976616e740a102000001c0200102100010f00012222
+0001120001801414230001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f
+00080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f
+0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100
+080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f
+0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f
+0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f
+0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f
+0f0f0f00000f0f0f00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f2300011000019d0100009d03000000008080808000008080000080000080
+800000808000808080400040400080ff0040804000ff804000ffffffc0c0c0ff
+0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ffff8080ffff0080
+ff80400000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000000012060078080201021010556e5365756c50
+7269785075626c6963010204212121212121212117000d9fff9e0002005d0000
+000d9d05169d012e00e503e80002000203030303000b0101a0a0000000000000
+0000009ce59d03e8000000000000010b1010556e5365756c507269785075626c
+6963000201000000001306007c08000d0012125374616e646172644f7574696c
+7347726964010104010f1011120101011700089fff9e000100180000000d9d0b
+649ce5017701770002000303030303000b010160600000000000000000009d01
+779d01770000000000000108241001ff8100014d014d00000002010000000004
+0101009fff009fff000101000025000004040000022600240000210102000000
+002625060003020100001414141426060113080201020b0b496d7072696d6572
+42746e01020421212121212121211700099fff9e000100190000000d15150124
+012400010001030303030013010180800000000000000027289d01249d012400
+000000000001020029002700001c020909496d7072696d65720a102800001c02
+00102900010f00012a2a00011200018014142b0001081414009d01900f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e
+0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f
+0f0f0f0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e0000000000
+0e000000000f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f00
+0000000000000000000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f00
+0f000f0f0f0f000000000000000000000000000f0f000f0f0f0f000f0f0f0f0f
+0f0101010f0f000f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f
+0f0f000000000000000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f
+0f000f000f0f0f0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f2b00011000019d0100009d030000000080808080
+00008080000080000080800000808000808080400040400080ff0040804000ff
+804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff
+8080ffff8080ffff0080ff804000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000000000001406007c08000d
+0010104665726d65724f7574696c7347726964010104010f1011120101011700
+069fff9e000100160000000d9d0f429ce5017701770002000403030303000b01
+0160600000220000000000009d01779d017700000000000001082c1001ff8100
+014d014d000000020100000000040101009fff009fff00010100002d00000404
+0000022e002c0000210102000000002e2d06000302010000141414142e060113
+080201020a0a5175697474657242746e01020421212121212121211700079fff
+9e000100170000000d1515012401240001000103030303001401018080000000
+000000002f309d01249d012400000000000001020031002f00001c0208085175
+69747465720a103000001c0200103100010f0001323200011200018014143300
+01081414009d01900707070707070707070707070707070707f8070707070707
+0707070000000000000000fefef80707070707070707070000000000000000fe
+fef8070707070707fefe0700f8f8f8f8f8f8fe0404f8070707070707fe0606fe
+f8f8f8f8f8fe040404f8070707070707fe060606f8f8f8f8fe04040404f80707
+0706060606060606fefef8fe0404040404f8070707060606060606060000f8fe
+0404040404f807070706060606060606f8f8f8fe0404040404f8070707070707
+fe060600f8f8f8fe0404040404f8070707070707fe060000f8f8f8fe04040404
+04f8070707070707fe00f800f8f8f8fe0403040404f807070707070707f8f800
+f8f8f8fe0403040404f807070707070707f80700f8f8f8fe0404040404f80707
+0707070707070700f8f8f8fe0404040407f807070707070707070707070707fe
+0404040707f807070707070707070707070707fe040404070707070707070707
+07070707070707fe04040707070707070707070707070707070707fe04070707
+0707070707070707070707070707070707070707070707073300011000019d01
+00009d0300000000800000008000808000000080800080008080c0c0c0c0dcc0
+a4c8f00000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00
+ffffffffff1506007c08000d009fff230104010f1011120101011700009fff9e
+0002000c0000000d9d13209d013900c6043b0002000503500303000b01016060
+0000000000000000009cc69d043b000000000000010834100100000000c6043b
+000000020100000000040102009fff009fff0001010000350000000404000000
+0236003700340000210202000000003637350600030201000000000000360600
+f60820890207074375724d6f646521020b212121212101010117000a06065374
+72696e679e000100200000000d000000c6021e00010001030303030015010280
+a00000000000000000009cc69d021e00000000000001030201070007000009ff
+8100009e00400014030100370600f6082089020606437572506f7321020b2121
+21212101010117000b0606537472696e679e000100210000000d9d021e0000c6
+021e00010002030303030015010280a00000000000000000009cc69d021e0000
+0000000001030201070007000009ff8100009e004000140301000c0600030209
+0000000000000d06007c08000d000909436f72707347726964010104010f1011
+1201010117000e9fff9e000100140000000d009d028612ad19f5000200010303
+03030008040460600000220000000000009d12ad9d19f5000000000000010838
+100100000012ad19f5000000020100000000040102009fff009fff2001010000
+390000000404000100023a003b00380000210202000000003b3a390600030201
+0000000000003a06007c08000d00090947726964456372616e010104010f1011
+1201010117001f9fff9e0002000e0000000d000012ad180c0001000103030303
+000d040460600000220000000000009d12ad9d180c00000000000001083c1001
+00000012ad180c000000020100000000040201009fff009fff00010100003d00
+000004040a0100023e003f003c0000210202000000003e3f3d06000302010000
+000000003e06007c08000d000f0f4772696447617563686544726f6974010104
+010f1011120101011700209fff9e0002000f0000000d00000fd4180c00010001
+03030303003a040460600000220000000000009d0fd49d180c00000000000001
+084010010000000fd4180c000000020100000000040102009fff009fff000101
+0000410000000404000102024200430040000021020200000000434241060003
+02000000000000004206007c08000d000d0d4772696453656c656374696f6e01
+0104010f1011120101011700509fff9e0002003e0000000d00000fd40b110001
+000103030303003e040460600000220000000000009d0fd49d0b110000000000
+000108441001ff81000faa0ae7000000020100000000040301009fff009fff00
+0101000045000000000404000100000246004700480044000021030200000000
+4746484506000302010000000000004606007c08000d00131347726964446576
+69736543617465676f726965010104010f10111201010117005b9fff9e000200
+490000000d000002b00ae7000100010303030300420104606000002200000000
+00009d02b09d0ae70000000000000108491001ff810002860abe000000020100
+000000040102009fff009fff00010100004a0000000404000000024b004c0049
+0000210202000000004b4c4a06000302010000000000004b06007c08000d000f
+0f537570657247726964446576697365010104010f10111201010117005c9fff
+9e0002004a0000000d0000028605540001000103030303004604046060000022
+0000000000009d02869d055400000000000001084d1001ff8100025c052b0000
+00020100000000040101009fff009fff00010100004e000004040000024f004d
+0000210102000000004f4e06000302010000646464644f06007c08000d000a0a
+47726964446576697365010104010f10111201010117005d9fff9e0002004b00
+00000d6868018c045b0001000103030303004b01046060000022000000000000
+9d018c9d045b0000000000000108501001000000018c045b0000000201000000
+00040201009fff009fff00010100005100000004040000000252005300500000
+21020200000000525351060003020100000000000052060092082081020b0b54
+69747265446576697365212104012121212121212121005e9fff9e0002004c00
+00000d000000b1045b0001000103160303004f0104a0a0000022000000000000
+9cb19d045b0000000000000103000b540201ff819e0044001400000000005400
+001c0207074465766973650a10530600b4080009020a0a436f64654465766973
+65010204212121212101010117005f0707496e74656765729e0002004d000000
+0d009cb100db045b0002000103030303004f010480a00000220000000000009c
+db9d045b0000000000000103020104550700000003045500002102020001a601
+5657560001a6030158000000005800001c0203034f6e6510570001a603025900
+0000005900001c02030354776f104c06007c08000d0012125375706572477269
+6443617465676f726965010104010f1011120101011700609fff9e0002004e00
+00000d9d05540002860569000100020303030300460404606000002200000000
+00009d02869d056900000000000001085a1001ff8100025c0540000000020100
+000000040101009fff009fff00010100005b000004040000025c005a00002101
+02000000005c5b06000302010000646464645c06007c08000d000d0d47726964
+43617465676f726965010104010f1011120101011700619fff9e0002004f0000
+000d6868018c046f0001000103030303004c010460600000220000000000009d
+018c9d046f00000000000001085d1001000000018c046f000000020100000000
+040201009fff009fff00010100005e0000000404000000025f0060005d000021
+0202000000005f605e06000302010000000000005f060092082081020e0e5469
+74726543617465676f72696521210401212121212121212100629fff9e000200
+500000000d000000b1046f0001000103160303005c0104a0a000002200000000
+00009cb19d046f0000000000000103000b610201ff819e004400140000000000
+6100001c020a0a436174e9676f7269650a10600600b4080009020d0d436f6465
+43617465676f72696501020421212121210101011700630707496e7465676572
+9e000200510000000d009cb100db046f0002000103030303005c010480a00000
+220000000000009cdb9d046f0000000000000103020104620700000003046200
+002102020001a6016364630001a6030165000000006500001c0203034f6e6510
+640001a6030266000000006600001c02030354776f104706007c08000d001919
+477269645061636b61676550726f6475697453657276696365010104010f1011
+120101011700519fff9e0002003f0000000d009d02b00a4b0ae7000200010303
+03030042040460600000220000000000009d0a4b9d0ae7000000000000010867
+1001ff81000a220abe000000020100000000040103009fff009fff0001010000
+680000000004040000000002696a6b6c6d6e67000021030200000000696b6d68
+06000302010000000000006906007c08000d000b0b477269645061636b616765
+010104010f1011120101011700529fff9e000200400000000d68680951034c00
+010001030303030047040460600000220000000000009d09519d034c00000000
+000001086f10010000000951034c000000020100000000040201009fff009fff
+000101000070000000040400010002710072736f000021020200000000717270
+060003020100000000000071060092082081020c0c54697472655061636b6167
+6521210401212121212121212100539fff9e000200410000000d000000b1034c
+000100010316030300690104a0a00000220000000000009cb19d034c00000000
+00000103000b740201ff819e0044001400000000007400001c0208085061636b
+6167650a10720600b0080009020b0b436f64655061636b616765010204212121
+21210101011700540707496e74656765729e000200420000000d009cb108a003
+4c00020001030303030069010480a00000220000001e00009d08a09d034c0000
+000000000103020104750700000003107500002100020001a601730600030206
+0000000000006a06000302010000646464006b06007c08000d000b0b47726964
+50726f64756974010104010f1011120101011700559fff9e000200430000000d
+9d03b4680951034c00010002030303030047040460600000220000000000009d
+09519d034c00000000000001087610010000000951034c000000020100000000
+040201009fff009fff0001010000770000000404000100027800797a76000021
+020200000000787977060003020100000000000078060092082081020c0c5469
+74726550726f6475697421210401212121212121212100569fff9e0002004400
+00000d000000b1034c0001000103160303006b0104a0a0000022000000000000
+9cb19d034c0000000000000103000b7b0201ff819e0044001400000000007b00
+001c02080850726f647569740a10790600b0080009020b0b436f646550726f64
+75697401020421212121210101011700570707496e74656765729e0002004500
+00000d009cb108a0034c0002000103030303006b010480a00000220000001e00
+009d08a09d034c00000000000001030201047c0700000003107c000021000200
+01a6017a06000302060000000000006c06000302010000646400006d06007c08
+000d000b0b4772696453657276696365010104010f1011120101011700589fff
+9e000200460000000d9d07006809510356000100030303030300470404606000
+00220000000000009d09519d035600000000000001087d100100000009510356
+000000020100000000040201009fff009fff00010100007e0000000404000100
+027f0080817d0000210202000000007f807e06000302010000000000007f0600
+92082081020c0c54697472655365727669636521210401212121212121212100
+599fff9e000200470000000d000000b103560001000103160303006d0104a0a0
+0000220000000000009cb19d03560000000000000103000b820201ff819e0044
+001400000000008200001c020808536572766963650a10800600b0080009020b
+0b436f646553657276696365010204212121212101010117005a0707496e7465
+6765729e000200480000000d009cb108a003560002000103030303006d010480
+a00000220000001e00009d08a09d035600000000000001030201048307000000
+03108300002100020001a6018106000302060000000000006e06000302010000
+646400644806007c08000d0016164772696450726f6d6f74696f6e436f6e6469
+74696f6e010104010f1011120101011700649fff9e000200520000000d009d0c
+fb02b00ae700030001030303030042010460600000220000000000009d02b09d
+0ae70000000000000108841001ff810002860abe000000020100000000040102
+009fff009fff0001010000850000000404000000028600870084000021020200
+00000086878506000302010000000000008606007c08000d000d0d4772696443
+6f6e646974696f6e010104010f1011120101011700659fff9e00020053000000
+0d00000286068300010001030303030048040460600000220000000000009d02
+869d06830000000000000108881001ff8100025c065900000002010000000004
+0101009fff009fff000101000089000004040000028a00880000210102000000
+008a8906000302010000000064648a060078080201020c0c436f6e646974696f
+6e42746e01020421212121212121211700669fff9e000200540000000d689cbc
+00e50589000100010303030300860101a0a00000000000000000009ce59d0589
+000000000000010b1c1c436f6e646974696f6e7320506172746963756c69e872
+6573202e2e2e000201000000008706007c08000d001212537570657247726964
+50726f6d6f74696f6e010104010f1011120101011700679fff9e000200550000
+000d9d0683000286043b00010002030303030048040460600000220000000000
+009d02869d043b00000000000001088b1001ff8100025c041200000002010000
+0000040101009fff009fff00010100008c000004040000028d008b0000210102
+000000008d8c06000302010000646464648d06007c08000d000d0d4772696450
+726f6d6f74696f6e010104010f1011120101011700689fff9e00020056000000
+0d6868018c034100010001030303030087010460600000220000000000009d01
+8c9d034100000000000001088e1001000000018c034100000002010000000004
+0201009fff009fff00010100008f000000040400000002900091008e00002102
+020000000090918f060003020100000000000090060092082081020e0e546974
+726550726f6d6f74696f6e21210401212121212121212100699fff9e00020057
+0000000d000000b103410001000103160303008d0104a0a00000220000000000
+009cb19d03410000000000000103000b920201ff819e00440014000000000092
+00001c020a0a50726f6d6f74696f6e0a10910600b4080009020d0d436f646550
+726f6d6f74696f6e010204212121212101010117006a0707496e74656765729e
+000200580000000d009cb100db03410002000103030303008d010480a0000022
+0000000000009cdb9d0341000000000000010302010493070000000304930000
+2100020001a6014306007c08000d0009094772696444726f6974010104010f10
+11120101011700219fff9e000200100000000d9d0b11000fd40cfb0001000203
+030303003e040460600000220000000000009d0fd49d0cfb0000000000000108
+9410010000000fd40cfb000000020100000000040301009fff009fff00010100
+0095000000000404000201000296009700980094000021030200000000989796
+9506000302010000000000009606007c08000d000a0a4772696450616e656c30
+010104010f10111201010117003f9fff9e0002002e0000000d000004120cfb00
+010001030303030043040460600000220000000000009d04129d0cfb00000000
+0000010899100100000004120cfb000000020100000000040201009fff009fff
+00010100009a0000000404000000029b009c9c00990000210202000000009b9c
+9c9a06000302010000000000009b06007a08004d00060650616e656c30010104
+010f1011120101011700409fff0e0000000d000002710cfb0001000103510303
+0096010460600000220000000000009d02719d0cfb00000000000001089c9d60
+0100000002710cfb0000000201000000000900009c9d0000210102000000009c
+9e9c9e06007c08000d000a0a507269785075626c6963010104010f1011120101
+0117004109095265676c65446573639e0002002f0000000d000002710cfb0000
+000003030303009b010460600000220000000000009d02719d0cfb0000000000
+0001089c9f1001ff810002470cd1040000020100000000040203009fff009fff
+00010100009ca0000000000004040000010000029ca19ca29ca39ca49ca59ca6
+9ca79ca89ca99caa9cab9cac9c9f0000210602000000009ca19ca59ca79ca99c
+ab9ca39ca006000302010000000000009ca10600920820810216165469747265
+4d6f6e74616e74507269785075626c696321210401212121212121212100429f
+ff9e000200300000000d686800b106100001000103160303009c9e0104a0a000
+00220000000000009cb19d06100000000000000103000b9cad0201ff819e0044
+001400000000009cad00001c020c0c50726978205075626c69630a109ca20600
+0302010000640064009ca3060092082081021818546974726544617465446562
+7574507269785075626c696321210401212121212121212100479fff9e000200
+350000000d9d06786800b103180001000203160303009c9e0104a0a000002200
+00000000009cb19d03180000000000000103000b9cae0201ff819e0044001400
+000000009cae00001c020e0e446174652064652064e96275740a109ca4060003
+02010000640000009ca506009208208102161654697472654461746546696e50
+7269785075626c696321210401212121212121212100439fff9e000200310000
+000d9d09906800b102d90001000303160303009c9e0104a0a000002200000000
+00009cb19d02d90000000000000103000b9caf0201ff819e0044001400000000
+009caf00001c020c0c446174652064652066696e0a109ca60600030201000064
+0000649ca70600f60820890207074d6f6e74616e740102042121212121010101
+1700440b0b4d6f6e74616e74446573639e000200320000000d689d011900c606
+100002000103050303009c9e010480a00000440000001400009cc69d06100000
+0000000001030201070017040009ff8100009e004000140301009ca806000302
+010000006464009ca90600f608208902111144617465446562757456616c6964
+69746501020b21212121210101011700450707447465446573639e0002003300
+00000d9d06979d011900c602d90002000203050303009c9e010280a000004400
+00000000009cc69d02d90000000000000103020107000a040009ff81039cb09e
+0040002406009cb000001c020a0a64642f6d6d2f79797979109caa0600030201
+0000006400009cab0600f6082089020f0f4461746546696e56616c6964697465
+01020b21212121210101011700460707447465446573639e000200340000000d
+9d09909d011900c602d90002000303050303009c9e010280a000004400000000
+00009cc69d02d90000000000000103020107000a000009ff81039cb19e004000
+2406009cb100001c020a0a64642f6d6d2f79797979109cac0600030201000000
+6400649c9c06007c08000d00151547726964426f75746f6e7350726978507562
+6c6963010104010f1011120101011700489fff9e000200360000000d009d0271
+01a10cfb00020001030303030096010460600000220000000000009d01a19d0c
+fb00000000000001089cb2100100000001a10cfb000000020100000000040102
+009fff009fff00010100009cb30000000404000000029cb4009cb5009cb20000
+210202000000009cb49cb59cb306000302010000141400009cb406007c08000d
+00161647726964426f75746f6e734465706c6163656d656e74010104010f1011
+120101011700499fff9e000200370000000d9cbb15017707c500010001030303
+03009c9c010160600000220000000000009d01779d07c500000000000001089c
+b61001ff8100014d079c000000020100000000040104009fff009fff00010100
+009cb7000000000004040000000000029cb8009cb9009cba009cbb009cb60000
+210402000000009cb89cb99cba9cbb9cb706000302010000141414149cb80601
+13080201021616507265636564656e74507269785075626c696342746e010204
+212121212121212117004a9fff9e000200380000000d15150124012400010001
+03030303009cb401018080000000000000009cbc9cbd9d01249d012400000000
+00000102001c009cbc00001c020a0a5072e963e964656e740a109cbd00001c02
+00109cb906011308020102141453756976616e74507269785075626c69634274
+6e010204212121212121212117004b9fff9e000200390000000d9d014d150124
+01240001000203030303009cb401018080000000000000009cbe9cbf9d01249d
+012400000000000001020021009cbe00001c02080853756976616e740a109cbf
+00001c0200109cba060078080201020a0a4e6f757665617542746e0102042121
+21212121212117004c9fff9e0002003a0000000d9d0286150124026700010003
+03030303009cb40401a0a00000220000000000009d01249d0267000000000000
+010b07074e6f7576656175000201000000009cbb060078080201021616537570
+7072696d6572507269785075626c696342746e01020421212121212121211700
+4d9fff9e0002003b0000000d9d050115012402860001000403030303009cb404
+01a0a00000220000000000009d01249d0286000000000000010b090953757070
+72696d6572000201000000009cb506007c08000d0015154772696456616c6964
+6572507269785075626c6963010104010f10111201010117004e9fff9e000200
+3c0000000d9d09f8150177023d0001000203030303009c9c0401606000002200
+00000000009d01779d023d00000000000001089cc01001ff8100014d02130000
+00020100000000040101009fff009fff00010100009cc1000004040000029cc2
+009cc00000210102000000009cc29cc106000302010000141414149cc2060078
+08020102141456616c69646572507269785075626c696342746e010204212121
+212121212117004f9fff9e0002003d0000000d1515012401ea00010001030303
+03009cb50401a0a00000220000000000009d01249d01ea000000000000010b07
+0756616c69646572000201000000009706007c08000d0012124772696453656c
+656374696f6e5265676c65010104010f1011120101011700389fff9e00020027
+0000000d009d041204460cfb0002000103030303004304046060000022000000
+0000009d04469d0cfb00000000000001089cc31001ff8100041c0cd100000002
+0100000000040102009fff009fff00010100009cc40000000404000100029cc5
+009cc6009cc30000210202000000009cc69cc59cc40600030201000000000000
+9cc506007c08000d000e0e5375706572477269645265676c65010104010f1011
+1201010117003b9fff9e0002002a0000000d0000041c09510001000103030303
+0097040460600000220000000000009d041c9d095100000000000001089cc710
+01ff810003f20928000000020100000000040101009fff009fff00010100009c
+c8000004040000029cc99cca9cc70000210102000000009cc99cc80600030201
+0000000000009cc906007c08000d000909477269645265676c65010104010f10
+111201010117003c9fff9e0002002b0000000d68680322085700010001030303
+03009cc5040460600000220000000000009d03229d085700000000000001089c
+cb100100000003220857000000020100000000040201009fff009fff00010100
+009ccc0000000404000100029ccd9cce9ccf9cd09ccb0000210202000000009c
+cd9ccf9ccc06000302010000000000009ccd060092082081020a0a5469747265
+5265676c65212104012121212121212121003d9fff9e0002002c0000000d0000
+00b108570001000103160303009cc90104a0a00000220000000000009cb19d08
+570000000000000103000b9cd10201ff819e0044001400000000009cd100001c
+0206065265676c650a109cce06000302010000000000009ccf0600b008000902
+11115265676c6553656c656374696f6e6e656501020421212121210101011700
+3e0707496e74656765729e0002002d0000000d009cb102470857000200010305
+0303009cc9010480a00000220000000000009d02479d08570000000000000103
+0201049cd20700000003049cd200002100020001a6019cd00600030206000000
+0000009cca06000302010000646464649cc606007c08000d000d0d4772696453
+7472617465676965010104010f1011120101011700399fff9e00020028000000
+0d9d095100041c03800001000203030303009704016060000022000000000000
+9d041c9d038000000000000001089cd31001ff810003f2035600000002010000
+0000040101009fff009fff00010100009cd4000004040000029cd59cd69cd300
+00210102000000009cd59cd406000302010000646464649cd50600b208000902
+0d0d436f6465537472617465676965010204212121212101010117003a070749
+6e74656765729e000200290000000d689c9c02ba02860001000103030303009c
+c6010180800000000000000000009d02ba9d028600000000000001030201049c
+d7070000000401010a0a5374726174e967696573000000009cd7000021030200
+01a6019cd89cd99cda9cd80001a603019cdb000000009cdb00001c0200109cd9
+0001a603029cdc000000009cdc00001c0200109cda0001a603039cdd00000000
+9cdd00001c0200109cd606000302010000000000009806007c08000d000f0f47
+72696444657461696c5265676c65010104010f1011120101011700229fff9e00
+0200110000000d009d0857077d0cfb0003000103030303004304046060000022
+0000000000009d077d9d0cfb00000000000001089cde1001000000077d0cfb00
+0000020100000000040201009fff009fff00010100009cdf0000000404010000
+029ce0009ce19ce29cde0000210202000000009ce19ce09cdf06000302010000
+000000009ce006007c08000d0005055265676c65010104010f10111201010117
+002909095265676c65446573639e000200180000000d000005dc0cfb00010001
+030303030098040460600000220000000000009d05dc9d0cfb00000000000001
+089ce31001ff810005b20cd1040000020100000000040201009fff009fff0001
+0100009ce40000000404000100029ce5009ce6009ce30000210202000000009c
+e59ce69ce406000302010000000000009ce506007c08000d0017174772696449
+64656e74696669636174696f6e5265676c65010104010f10111201010117002a
+9fff9e000200190000000d000001df0cd10001000103030303009ce004046060
+0000220000000000009d01df9d0cd100000000000001089ce7100100000001df
+0cd1000000020100000000040203009fff009fff00010100009ce80000000000
+04040000010000029ce99cea9ceb9cec9ced9cee9cef9cf09cf1009cf29cf39c
+e70000210602000000009ce99ced9cef9cf19cf29ceb9ce80600030201000000
+0000009ce9060092082081020d0d54697472654e6f6d5265676c652121040121
+21212121212121002b9fff9e0002001a0000000d686800b1054a000100010316
+0303009ce50104a0a00000220000000000009cb19d054a000000000000010300
+0b9cf40201ff819e0044001400000000009cf400001c0210104e6f6d20646520
+6c612072e8676c650a189cea06000302010000640064009ceb06009208208102
+131354697472654461746544656275745265676c652121040121212121212121
+2100309fff9e0002001f0000000d9d05b26800b103610001000203160303009c
+e50104a0a00000220000000000009cb19d03610000000000000103000b9cf502
+01ff819e0044001400000000009cf500001c020e0e446174652064652064e962
+75740a109cec06000302010000640000009ced06009208208102111154697472
+654461746546696e5265676c65212104012121212121212121002c9fff9e0002
+001b0000000d9d09136800b103560001000303160303009ce50104a0a0000022
+0000000000009cb19d03560000000000000103000b9cf60201ff819e00440014
+00000000009cf600001c020c0c446174652064652066696e0a109cee06000302
+010000640000649cef0600f60820890208084e6f6d5265676c65010204212121
+212101010117002d0c0c4e6f6d5265676c65446573639e0002001c0000000d68
+9d011900c6054a0002000103030303009ce5010480a00000440000001400009c
+c69d054a00000000000001030201070014040009ff8100009e00400014030100
+9cf006000302010000000064009cf10600f60820890211114461746544656275
+7456616c696469746501020b212121212101010117002e070744746544657363
+9e0002001d0000000d9d05b29d011900c603610002000203050303009ce50102
+80a00000000000000000009cc69d03610000000000000103020107000c000009
+ff81039cf79e0040002406009cf700001c020a0a64642f6d6d2f79797979109c
+f20600f6082089020f0f4461746546696e56616c696469746501020b21212121
+2101010117002f0707447465446573639e0002001e0000000d9d09139d011900
+c603560002000303050303009ce5010280a00000440000000000009cc69d0356
+0000000000000103020107000c040009ff81039cf89e0040002406009cf80000
+1c020a0a64642f6d6d2f79797979109cf306000302010000000000649ce60600
+7c08000d001414477269644465736372697074696f6e5265676c65010104010f
+1011120101011700319fff9e000200200000000d009d01df03d30cd100020001
+03030303009ce0040460600000220000000000009d03d39d0cd1000000000000
+01089cf9100100000003d30cd1000000020100000000040302009fff009fff00
+010100009cfa000000000004040000000001029cfb009cfc009cfd009cfe009c
+ff009d0100009cf90000210602000000009cfb9cfc9cfd9cfe9cff9d01009cfa
+06000302010000646464649cfb0600920820810213135469747265436f6e6469
+74696f6e5265676c6521210401212121212121212100329fff9e000200210000
+000d686800b102cf0001000103160303009ce60104a0a0000022000000000000
+9cb19d02cf0000000000000103000b9d01010201ff819e004400140000000000
+9d010100001c020a0a436f6e646974696f6e0a109cfc06012508200902090943
+6f6e646974696f6e01020421212121210101011700330d0d436f6e646974696f
+6e446573639e000200220000000d9d039f6800bc08ca0001000203030303009c
+e60404a0a00000440001001e00009cbc9d08ca00000000000001030201070020
+0600059e004000980000000120ff810001009cfd060092082081021111546974
+72654d6f6e74616e745265676c6521210401212121212121212100349fff9e00
+0200230000000d689d018c00b102cf0002000103160303009ce60104a0a00000
+220000000000009cb19d02cf0000000000000103000b9d01020201ff819e0044
+001400000000009d010200001c0208084d6f6e74616e740a109cfe0601250820
+090207074d6f6e74616e7401020421212121210101011700350b0b4d6f6e7461
+6e74446573639e000200240000000d9d039f9d018c00bc08ca00020002030303
+03009ce60404a0a00000440001001e00009cbc9d08ca00000000000001030201
+0700200600059e004000980000000120ff810001009cff060092082081021515
+5469747265436f6d6d656e74616972655265676c652121040121212121212121
+2100369fff9e000200250000000d689d02b000b102cf0003000103160303009c
+e60104a0a00000220000000000009cb19d02cf0000000000000103000b9d0103
+0201ff819e0044001400000000009d010300001c020c0c436f6d6d656e746169
+72650a109d0100060125082009020b0b436f6d6d656e74616972650102042121
+2121210101011700370f0f436f6d6d656e7461697265446573639e0002002600
+00000d9d039f9d02b000bc08ca0003000203030303009ce60404a0a000004400
+01001e00009cbc9d08ca000000000000010302010700200600059e0040009800
+00000120ff810001009ce106007c08000d00101047726964426f75746f6e7352
+65676c65010104010f1011120101011700239fff9e000200120000000d009d05
+dc01a10cfb00020001030303030098010460600000220000000000009d01a19d
+0cfb00000000000001089d0104100100000001a10cfb00000002010000000004
+0102009fff009fff00010100009d01050000000404000000029d0106009d0107
+009d01040000210202000000009d01079d01069d010506000302010000141414
+149d010606007c08000d00171747726964426f75746f6e4e6f7576656c6c6552
+65676c65010104010f1011120101011700269fff9e000200150000000d9d010f
+15017706830001000103030303009ce1040160600000220000000000009d0177
+9d068300000000000001089d01081001ff8100014d0659000000020100000000
+040102009fff009fff00010100009d01090000000404000000029d010a009d01
+0b009d01080000210202000000009d010a9d010b9d0109060003020100001414
+14149d010a0600780802010210104e6f7576656c6c655265676c6542746e0102
+0421212121212121211700279fff9e000200160000000d151501240395000100
+0103030303009d01060401a0a00000220000000000009d01249d039500000000
+0000010b0e0e4e6f7576656c6c652052e8676c65000201000000009d010b0600
+780802010211115375707072696d65725265676c6542746e0102042121212121
+2121211700289fff9e000200170000000d9d03be150124028600010002030303
+03009d01060401a0a00000220000000000009d01249d0286000000000000010b
+09095375707072696d6572000201000000009d010706007c08000d0010104772
+696456616c696465725265676c65010104010f1011120101011700249fff9e00
+0200130000000d9d09a5150177023d0001000203030303009ce1010160600000
+000000000000009d01779d023d00000000000001089d010c1001ff8100014d02
+13000000020100000000040101009fff009fff00010100009d010d0000040400
+00029d010e009d010c0000210102000000009d010e9d010d0600030201000014
+1414149d010e060078080201020f0f56616c696465725265676c6542746e0102
+0c21212121212121211700259fff9e000200140000000d1515012401ea000100
+0103030303009d01070201a0a00000220000000000009d01249d01ea00000000
+0000010b070756616c69646572000201000000009ce206000302080000000000
+003f06007c08000d000c0c4469616c6f67756547726964020104010f10111201
+010117006b9fff9e0001001c0000000d009d0fd402d9180c0002000103000303
+003a040460600000220000000000009d02d99d180c00000000000001089d010f
+1001ff810002b017e2000000020100000000040201009fff009fff2001010000
+9d01100000000404000100029d0111009d0112009d010f000021020200000000
+9d01119d01129d011006000302020000000000009d0111060092082081020d0d
+54697472654469616c6f677565212104012121212121212121006c9fff9e0002
+00590000000d000000b117e20001000103160303003f0104a0a0000022000000
+0000009cb19d17e20000000000000103000b9d01130201ff819e004400140000
+0000009d011300001c0209094469616c6f6775650a109d011206008408200902
+0b0b5374617475735f4c696e65020204212121212101010117006d0808546578
+74446174610d0000000d009cb101fe17e20002000103030303003f0404a0a000
+00440003001900009d01fe9d17e20100000000000103020107005e0600050103
+0000ff81013b06007c08000d000f0f426172726544726f697465477269642301
+04010f10111201010117000f9fff9e0001000c0000000d9d180c0012ad01ea00
+01000203030303000d040160600000220000000000009d12ad9d01ea00000000
+000001089d01141001ff8100128401c0000000020100000000040201009fff00
+9fff20010100009d01150000000404000000029d0116009d0117009d01140000
+210202000000009d01179d01169d011506000302070000141400009d01160600
+7c08000d000d0d4374694f7574696c7347726964010104010f10111201010117
+00159fff9e000100230000000d499d01ca0afd012e0001000103030303003b01
+0160600000000000000000009d0afd9d012e00000000000001089d0118100100
+00000afd012e000000020100000000040901009fff009fff20010100009d0119
+00000000000000000000040400000000000000000000029d011a009d011b009d
+011c009d011d009d011e009d011f009d0120009d0121009d0122009d01180000
+210902000000009d011a9d011b9d011c9d011d9d011e9d011f9d01219d01229d
+01209d0119060003020100001e1e00009d011a060113080201020b0b44656372
+6f63686542746e22020421212121212121211700169fff9e000100240000000d
+001f012401240001000103030303009d011601018080000000000000009d0123
+9d01249d01249d01240000000000000102009d0125009d012300001c020a0a44
+e963726f636865720a109d012400001c0200109d012500010f00019d01269d01
+2600011200018014149d0127000104140a009cc8111111111111111111111111
+2222222222221111112200000000000022111220000000000000022122000022
+2222220000222000022111111220000220000211111111200002222222111111
+1122222211111111111111111111111112211111112211111111200222222200
+2111111120000000000021111112000020202000021111220000000000000221
+1220000020202000002122000000000000000022200000002020200000022000
+000000000000000212222222222222222221111111111111111111119d012700
+01100001030009ffff00c0c0c00000009d011b060113080201020c0c52616363
+726f63686542746e22020421212121212121211700179fff9e00010025000000
+0d009d0162012401240002000103030303009d01160101808000000000000000
+9d01289d01299d01249d01240000000000000102009d012a009d012800001c02
+0b0b52616363726f636865720a109d012900001c0200109d012a00010f00019d
+012b9d012b00011200018014149d012c000104140a009cc80000000033300000
+0000001111113331111111000122222233322222221001222222333222222210
+1222222233322222222112222110333001122221111111003330001111111222
+2100333000122221011111003330001111100000000033300000000000000333
+3333330000000000003333333000000000000003333300000000000000003330
+0000000000000000030000000000000011100000011100000001111111111111
+1000001222222222222210000122222222222222210044444444444444444444
+9d012c000110000105000fc0c0c0000000ffff00ff0000ffffff9d011c060113
+080201020a0a4c69626572657242746e22020421212121212121211700189fff
+9e000100260000000d009d02a50143012e0003000103030303009d0116010180
+80000000000000009d012d9d012e9d01439d012e0000000000000102009d012f
+009d012d00001c0206064c696272650a109d012e00001c0200109d012f00010f
+00019d01309d013000011200018017159d0131000104160b009cfd0000000000
+0000000000810000000000000000000281000000000000000000228100000000
+0000000002228100000000000000000220810000000000000000222081000000
+0000000002220081000000000000002220008100000000000000222000810000
+0000000002220000810200000000002222000081022000000002222000008102
+2200000002220000008102222000002222000000810222220002222000000081
+0222222022222000000081002222222222000000008100022222222000000000
+8100002222222000000000810000022222000000000081000000222200000000
+0081000000022000000000008100000000000000000000819d01310001100001
+030009c0c0c000000000ff009d011d060113080201020a0a417474656e746542
+746e22020421212121212121211700199fff9e000100270000000d009d040701
+1901240004000103030303009d011601018080000022000000009d01329d0133
+9d01199d01240000000000000102009d0134009d013200001c02080841747465
+6e74650a109d013300001c0200109d013400010f00019d01359d013500011200
+018013149d0136000104140a009cbe0000000000000000000000000001110000
+0000000000011122100000000000001221221110000000000012212212210000
+0000111221221221000000012212212212210000000122122122122100000001
+2212212212210000000122122122122100110001222222222221012210012222
+2222222112221001222222222222222100012222222222222210000122222222
+2222210000012222222222221000000012222222222100000000012222222210
+000000000011111111000000009d01360001100001030009c0c0c0000000ffff
+009d011e060113080201020c0c5472616e736665727442746e22020421212121
+2121212117001a9fff9e000100280000000d009d054001240124000500010303
+0303009d011601018080000000000000009d01379d01389d01249d0124000000
+0000000102009d0139009d013700001c020b0b5472616e7366e97265720a109d
+013800001c0200109d013900010f00019d013a9d013a00011200018014140000
+0118143c009d04b0c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000000000000000000000c6c6c6
+000000ffff00ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000ffff00ffff00ffff00ffff00ffff00000000000000ff
+ff00ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+ff0000000000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff
+00ffff00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff000000
+0000ffff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00000000
+000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c60000
+00000000000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6
+c6c6c6c6c6c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6
+000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6
+c6c6c6c6ff0000c0c0c0c6c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ff
+ff00ffff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6
+ff0000ff0000c6c6c6ff0000c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff
+00000000000000ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0
+c0c0ff0000ff0000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000
+000000ffff00ffff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0
+c0ff0000c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ff
+ff00ffff00000000c0c0c0c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0
+c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff
+00000000c0c0c0c0c0c0c6c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6
+c6c6c6c6c6c0c0c0000000ffff00ffff00000000000000ffff00ffff00000000
+c0c0c0c0c0c0c0c0c0ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0
+c0c0c0c0000000ffff00ffff00000000000000ffff00ffff0000000000000000
+0000c0c0c0ff0000c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000
+000000ffff00ffff00000000000000ffff00ffff00000000ffff00ffff000000
+00ff0000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ff
+ff00ffff00000000000000ffff00ffff00000000ffff00ffff00000000ff0000
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff
+00000000000000ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000
+000000ffff00ffff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000c6c6c600
+0000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6000000000000000000000000000000c0c0c09d011f0601130802
+01020808506175736542746e220204212121212121212117001b9fff9e000100
+290000000d009d0683012401240006000103030303009d011601018080000000
+000000009d013b9d013c9d01249d01240000000000000102009d013d009d013b
+00001c02060650617573650a109d013c00001c0200109d013d00010f00019d01
+3e9d013e000112000180141400000118143c009d04b0c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c60000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000000000ffff00
+ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff000000
+00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff00ff
+ff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00000000
+c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00ffff000000000000000000
+00000000000000000000000000000000000000ffff00ffff00ffff00000000c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000c6c6c6000000ffff00
+ffff00ffff00000000c6c6c6000000000000ffff00ffff00000000c0c0c0c6c6
+c6c6c6c6c0c0c0000000000000000000c6c6c6000000ffff00ffff00ffff00ff
+ff00ffff00000000c0c0c0c0c0c0000000000000c0c0c0c0c0c0c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c0c0c0000000ffff000000000000000000000000000000
+00ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6
+c6c6c0c0c0000000ffff00ffff00000000ffffffffffffffffff000000ffff00
+ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000
+00ffff00ffff00ffff00000000ffffffffffffffffff000000ffff00ffff00ff
+ff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0c0c00000000000ff0000ff
+0000ff0000ff0000ff0000ff000000000000000000ffff00ffff00ffff00ffff
+00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000ff0000ff0000ff00
+00ff0000ff0000ffffff00ffff00ffff00ffff00ffff00ffff00ffff00000000
+c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff0000ff0000
+ff0000ff000000000000000000000000000000000000000000c0c0c0c6c6c6c6
+c6c6c0c0c00000ff00ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ff
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c0c0
+c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c0
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c00000ff
+80ffff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c00000ff80
+ffff0000ff0000ff0000ff0000ff0000ff0000ffc0c0c0c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000ff0000
+ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c00000ff0000ff
+0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c69d0120060113080201020e0e46696e456e726567697374726572
+230204212121212121212117001e9fff9e0001002c0000000d009d07c6012401
+240007000103030303009d011601018080000000000000009d013f9d01409d01
+249d01240000000000000102009d0141009d013f00001c020c0c456e72656769
+73747265720a109d014000001c0200109d014100010f00019d01429d01420001
+1200018014149d0143000104140a009cc8331111111111111111333330000000
+0000000333333311111111111133330333300000000003333000333320004444
+3333400003333000000333300000003333000033330000100003333443333400
+0110000433333333440001100004033333304400011000044033330444000110
+0004433333344400011000003333333300000110011333300333311001101133
+3300003333110110133330000003333101103333100000013333011333310000
+000013333133330000000000003333333111111111111113319d014300011000
+0105000f000000c0c0c000ffffff0000ffffff9d0121060113080201020b0b45
+6e726567697374726572220204212121212121212117001c9fff9e0001002a00
+00000d009d0909012401240008000103030303009d0116010180800000000000
+00009d01449d01459d01249d01240000000000000102009d0146009d01440000
+1c020c0c456e7265676973747265720a109d014500001c0200109d014600010f
+00019d01479d014700011200018014149d0148000104140a009cc81111111111
+1111111111100000000000000000011011111111111111110100000000000000
+0000000030202000444444444000000000000000000000000000000000000000
+0010000444444444440001100004404444044400011000040004400044000110
+0004404444044400011000044444444444000110000000000000000001100111
+0000000011100110111110000001111101101111100000011111011011111000
+0001111101100111000000001110011000000000000000000111111111111111
+1111119d0148000110000105000f000000c0c0c000ffffff0000ffffff9d0122
+0600f608208902070745746174437469020204212121212101010117001d0808
+54657874446174619e0001002b0000000d0a9d0a4b0092010f00090001030503
+03009d0116010180a0000044000000009d01499d014a929d010f020000000000
+010301053c00070005040009ff8100009e004020140301009d014900001c0210
+104574617420636f6e7365696c6c65720a119d014a00001c0200109d01170600
+7c08000d00111147656e6572616c4f7574696c7347726964230104010f101112
+0101011700109fff9e000100150000000d009d0e9103de01c000020001030303
+03003b010160600000220000000000009d03de9d01c000000000000001089d01
+4b1001ff810003b40196000000020100000000040101009fff009fff20010100
+009d014c000004040000029d014d009d014b0000210102000000009d014d9d01
+4c06000302010000141414149d014d06007c08000d0016165374616e64617264
+4f7574696c734772696456657274010104010f1011120101011700119fff9e00
+01002f0000000d1515038a016d0001000103030303009d011701016060000000
+0000000000009d038a9d016d00000000000001089d014e1001ff810003610143
+000000020100000000040301009fff009fff00010100009d014f000000000404
+00000000029d0150009d0151009d0152009d014e0000210302000000009d0151
+9d01509d01529d014f06000302010000141414149d0150060113080201020a0a
+416a6f7574657242746e01220421212121212121211700139fff9e0001001b00
+00000d1515010f01190001000103030303009d014d0101808000000000000000
+9d01539d01549d010f9d01190000000000000102009d0155009d015300001c02
+08084e6f75766561750a109d015400001c0200109d015500010f00019d01569d
+015600011200018012139d01570001081313009d015607070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070407070707070707
+0707070707070707070707040407070707070707070407070707070707070402
+0407070707070407040704070707070707040202040707070707040404070707
+0707070704020202040707040404040404040707070707040202040707070707
+0404040707070707070704020407070707070407040704070707070707040407
+0707070707070704070707070707070704070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707079d015700011000019d0100009d0300000000bf00
+0000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000fffbf0
+a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffffff9d01510601
+13080201020c0c5375707072696d657242746e01220421212121212121211700
+129fff9e0001001a0000000d1f9d0139010401040002000103030303009d014d
+01018080000000000000009d01589d01599d01049d0104000000000000010200
+9d015a009d015800001c020a0a5375707072696d65720a109d015900001c0200
+109d015a00010f00019d015b9d015b00011200018011119d015c000108111100
+9d01210707070707070707070707070707070707070707070707070000070707
+07070707070707070707070000ff0000070707070707070707070700ff00ff00
+ff000707070707070707070700ff00ff00ff070707070707070707070700ff00
+ff070707010107070707070707070707000707f80101f8f8070707000000f801
+010007f80101f8f80707070700ffff00f8f801010101f8f800070707070700ff
+ff0007f8010101f8ff0007070707070700ff07070101010101ff000707070707
+0700ff07f80101f8f80101000707070707070707070101f8f8ff0101f8070707
+0707070707f80101f8fffffff80107070707070707070101f8f80000000701f8
+0707070707070701f8f80707070707f8f8070707070707070707070707070707
+070707079d015c00011000019d0100009d0300000000bf000000bf00bfbf0000
+00bfbf00bf00bfbfc0c0c0c0dcc0a6caf0000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000fffbf0a0a0a4808080ff00
+0000ff00ffff000000ffff00ff00ffffffffff9d015206011308020102090953
+617576657242746e01020421212121212121211700149fff9e00010022000000
+0d1f9d025200fa00fa0003000103030303009d014d0101808000000000000000
+9d015d9d015e9cfa9cfa0000000000000102009d015f009d015d00001c020707
+5361757665720a109d015e00001c0200109d015f00010f00019d01609d016000
+011200018010109d01610001081010009d010007070707070707070707070707
+0707070700000000000000000000000000000707000300070707070707070700
+0700070700030007070707070707070000000707000300070707070707070700
+0300070700030007070707070707070003000707000300070707070707070700
+0300070700030007070707070707070003000707000303000000000000000003
+0300070700030303030303030303030303000707000303000000000000000000
+0300070700030300000000000007070003000707000303000000000000070700
+0300070700030300000000000007070003000707070000000000000000000000
+000007070707070707070707070707070707079d016100011000019d0100009d
+0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf0
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffff
+ffff0606005e08002e009fff03030303030303030303030300009fff02000000
+08009fff000000000000000000000002019d0162019d01620000210402000000
+009d01639d01649d01659d01669d016306005c08000e00040466696c65010303
+030303030303030303006e9fff10000000080605052646696c65000000000000
+000000000002019d01670103ff009d01670000210202000000009d01689d0169
+9d016806006a0800020205057072696e74030303020303030303030303006f9f
+ff11000000089d01639fff0000000000000000000000010200129d016906006a
+080002020a0a7072696e74736574757003030302030303030303030300709fff
+12000000089d01639fff0000000000000000000000010200119d016406005c08
+000e000606416374696f6e01030303030303030303030300719fff1500000008
+06070726416374696f6e000000000000000000000002019d016a0103ff009d01
+6a0000210102000000009d016b9d016b06006a0800020209094e657757696e64
+6f7703030302030303030303030300729fff16000000089d01640b0b264e6577
+2057696e646f77000000000000000000000001020eff9d016506005c08000e00
+040448656c7001030303030303030303030300739fff1700000008069fff0000
+00000000000000000002019d016c010303009d016c0000210002000000009d01
+6606005c08000e00090943747874506f70557003030303030303030303030300
+749fff9e0001002d0000000806090943747874506f705570000000029d016d00
+000000000002019d016e0103ff009d016d00001c0200109d016e000021010200
+0000009d016f9d016f06006a0800020007074974656d54737403030302030303
+030303030300759fff9e0001002e000000089d016607074974656d5473740000
+00039d0170000000000000010200ff9d017000001c0200109d01701a919c9c9c
+c19d01219d012c9d01aa9d01b69d01c29d02649d02749d02809d02ec9d037f9d
+038b9d03979d03f49d04069d040d9d04149d05b79d08c49d09219d09319d0938
+9d093f9d0ae29d0def9d0e699d0ef79d0f029d0f0e9d0f6a9d0f7b9d0f829d0f
+899d112c9d14399d14c59d14d09d14dc9d15379d15479d154e9d15559d16f89d
+1a059d1a859d1a919d1a9d9d1b0b9d1b7a9d1b869d1c0e9d1c1a9d1c269d1cac
+9d1cb89d1cc49d1d509d1d5c9d1d689d1df69d1e039d1e0f9d1e9f9d1eab9d1e
+b79d1f3f9d1f4a9d1f569d1fdd9d1fe99d1ff59d205e9d206d9d20d69d20e29d
+20ed9d20f89d21039d210e9d219b9d21a69d21b29d223c9d22489d22549d22c0
+9d22d29d233e9d234a9d23559d23609d236b9d23769d24129d241f9d242b9d24
+b39d24bf9d24cb9d25359d25459d25b09d25ba9d25c69d25d29d265c9d26689d
+26749d26de9d26ee9d27599d27639d276f9d277b9d28059d28119d281d9d2887
+9d28979d29029d290c9d29189d29249d29b99d29c59d29d19d2a579d2a629d2a
+6e9d2aed9d2b7a9d2b859d2b919d2c1b9d2c279d2c339d2c9f9d2cb19d2d1d9d
+2d279d2db39d2dc09d2dcc9d2e549d2e619d2e6d9d2ed49d2ee19d2f8c9d2fa3
+9d2fb09d30279d303c9d30499d30c49d30db9d30e89d31619d31769d31839d31
+fa9d32079d32869d32999d32a69d33239d33369d33439d33dc9d33eb9d33f89d
+349c9d34af9d34bc9d35279d353a9d35429d35ad9d35be9d35c69d36329d36ac
+9d37419d374e9d375b9d37cf9d38649d38739d38809d390c9d39199d39269d39
+b49d39c39d39d09d3a3b9d3a4a9d3a579d3acb9d3ad69d3ae39d3af09d3b7d9d
+3b8a9d3b979d3c189d3c299d3c369d3c3e9d3c4b9d3c539d3c609d3c689d3c75
+9d3d089d3d179d3d249d3db49d3dc39d3dd09d3e7f9d3e969d3ea39d3f119d3f
+2a9d3f379d3fad9d3fc49d3fd19d40459d405a9d40679d40e09d40ed9d416c9d
+417f9d41fc9d420f9d421c9d42c69d42de9d42eb9d43609d43749d43f29d4467
+9d44799d44f59d456e9d45849d46099d46a19d46b39d46c19d47629d47749d47
+829d47fb9d48729d49069d49159d49239d49949d49a19d4a349d4a469d4a549d
+4ac39d4ad69d4b459d4bdb9d4bed9d4bfb9d4cbb9d4ce29d4cf09d4d569d4d6a
+9d4d739d4d7e9d4e5c9d4e709d4ed99d4eee9d4ef79d4f029d4fe09d4ffa9d50
+619d50719d507a9d50859d51989d51ac9d52139d52259d522e9d52399d530d9d
+53219d538a9d539f9d53a89d53b39d58789d58dd9d58ed9d58f69d59019d5dc6
+9d5e319d5e479d5e509d5e5b9d5f399d5f539d5fbb9d5fd19d5fda9d5fe59d60
+c39d60dd9d61589d61729d617b9d620f9d621e9d622c9d62d19d62e69d62f49d
+63599d636b9d63749d637f9d64ec9d67fb9d68649d68789d68819d688c9d69c4
+9d6cd39d6d379d6d489d6d519d6d5c9d6e739d71829d71b59d71cd9d720e9d72
+209d725a9d72999d72de9d72ed9d73369d73729d737e9d73ce9d73d79d73e69d
+742f9d74389d041b191a38626377919b9c9c9ca09cc19cdf9d01099d010a9d01
+1e9d01219d012b9d012c9d014f9d01799d017a9d018e9d01a59d01aa9d01b49d
+01b69d01c29d01f19d021b9d021c9d02309d024f9d02649d026e9d02749d0280
+9d02ac9d02d79d02d89d02ec9d03239d034e9d034f9d03639d037a9d037f9d03
+899d038b9d03979d03c59d03ef9d03f09d03f49d03f89d04069d040a9d040d9d
+04119d04149d041e9d05b79d08c49d08f09d091c9d091d9d09219d09259d0931
+9d09359d09389d093c9d093f9d09499d0ae29d0def9d0e219d0e4e9d0e4f9d0e
+699d0e9d9d0eca9d0ecb9d0edf9d0ef49d0ef79d0f019d0f029d0f0e9d0f3b9d
+0f659d0f669d0f6a9d0f6e9d0f7b9d0f7f9d0f829d0f869d0f899d0f939d112c
+9d14399d146b9d14989d14999d14ad9d14c29d14c59d14cf9d14d09d14dc9d15
+089d15329d15339d15379d153b9d15479d154b9d154e9d15529d15559d155f9d
+16f89d1a059d1a279d1a549d1a559d1a699d1a809d1a859d1a8f9d1a919d1a9d
+9d1acc9d1af59d1af69d1af99d1afe9d1b0b9d1b399d1b649d1b659d1b689d1b
+6d9d1b7a9d1b869d1bb19d1bdd9d1bde9d1bf29d1c099d1c0e9d1c189d1c1a9d
+1c269d1c519d1c7b9d1c7c9d1c909d1ca79d1cac9d1cb69d1cb89d1cc49d1cf5
+9d1d1f9d1d209d1d349d1d4b9d1d509d1d5a9d1d5c9d1d689d1d979d1dc19d1d
+c29d1dd69d1def9d1df69d1e009d1e039d1e0f9d1e449d1e6e9d1e6f9d1e839d
+1e9a9d1e9f9d1ea99d1eab9d1eb79d1ee89d1f129d1f139d1f279d1f3c9d1f3f
+9d1f499d1f4a9d1f569d1f829d1fac9d1fad9d1fc19d1fd89d1fdd9d1fe79d1f
+e99d1ff59d20229d204b9d204c9d204e9d205e9d20629d206d9d20a09d20ca9d
+20cb9d20ce9d20d49d20d69d20e09d20e29d20ed9d20f19d20f89d21039d2107
+9d210e9d21429d216e9d216f9d21839d21989d219b9d21a59d21a69d21b29d21
+e19d220b9d220c9d22209d22379d223c9d22469d22489d22549d22849d22ad9d
+22ae9d22b09d22c09d22c49d22d29d23089d23329d23339d23369d233c9d233e
+9d23489d234a9d23559d23599d23609d236b9d236f9d23769d23b19d23dd9d23
+de9d23f29d240b9d24129d241c9d241f9d242b9d24589d24829d24839d24979d
+24ae9d24b39d24bd9d24bf9d24cb9d24f99d25229d25239d25259d25359d2539
+9d25459d25799d25a49d25a59d25a89d25ae9d25b09d25ba9d25ba9d25c69d25
+d29d25ff9d262b9d262c9d26409d26579d265c9d26669d26689d26749d26a29d
+26cb9d26cc9d26ce9d26de9d26e29d26ee9d27229d274d9d274e9d27519d2757
+9d27599d27639d27639d276f9d277b9d27a89d27d49d27d59d27e99d28009d28
+059d280f9d28119d281d9d284b9d28749d28759d28779d28879d288b9d28979d
+28cb9d28f69d28f79d28fa9d29009d29029d290c9d290c9d29189d29249d295c
+9d29889d29899d299d9d29b49d29b99d29c39d29c59d29d19d2a009d2a2a9d2a
+2b9d2a3f9d2a549d2a579d2a619d2a629d2a6e9d2a9c9d2ac69d2ac79d2aed9d
+2b219d2b4d9d2b4e9d2b629d2b779d2b7a9d2b849d2b859d2b919d2bc09d2bea
+9d2beb9d2bff9d2c169d2c1b9d2c259d2c279d2c339d2c639d2c8c9d2c8d9d2c
+8f9d2c9f9d2ca39d2cb19d2ce79d2d119d2d129d2d159d2d1b9d2d1d9d2d279d
+2d279d2d529d2d7e9d2d7f9d2d939d2dac9d2db39d2dbd9d2dc09d2dcc9d2df8
+9d2e229d2e239d2e379d2e4e9d2e549d2e5e9d2e619d2e6d9d2e919d2ebb9d2e
+bc9d2ed19d2ed49d2edf9d2ee19d2f179d2f419d2f429d2f579d2f739d2f8c9d
+2f979d2fa39d2fb09d2fe99d30139d30149d30169d30279d302c9d303c9d3049
+9d30849d30b09d30b19d30b39d30c49d30c99d30db9d30e89d31219d314d9d31
+4e9d31509d31619d31669d31769d31839d31b89d31e49d31e59d31e89d31ed9d
+31fa9d32079d32429d32709d32719d32749d32799d32869d328b9d32999d32a6
+9d32df9d330d9d330e9d33119d33169d33239d33289d33369d33439d337b9d33
+a79d33a89d33bd9d33d59d33dc9d33e79d33eb9d33f89d34319d345d9d345e9d
+34739d348f9d349c9d34a79d34af9d34bc9d34f59d35229d35239d35279d352c
+9d353a9d353f9d35429d35799d35a89d35a99d35ad9d35b29d35be9d35c39d35
+c69d35f39d36209d36219d36329d366b9d36989d36999d36ac9d36e49d37119d
+37129d37279d373d9d37419d374c9d374e9d375b9d37929d37bd9d37be9d37cf
+9d38039d382f9d38309d38459d385d9d38649d386f9d38739d38809d38b19d38
+db9d38dc9d38f19d39079d390c9d39179d39199d39269d39529d397d9d397e9d
+39939d39ab9d39b49d39bf9d39c39d39d09d39fd9d3a279d3a289d3a2a9d3a3b
+9d3a409d3a4a9d3a579d3a929d3abe9d3abf9d3ac29d3ac99d3acb9d3ad69d3a
+d69d3ae39d3af09d3b209d3b4c9d3b4d9d3b629d3b789d3b7d9d3b889d3b8a9d
+3b979d3bce9d3bfa9d3bfb9d3bfe9d3c059d3c189d3c239d3c299d3c369d3c3b
+9d3c3e9d3c4b9d3c509d3c539d3c609d3c659d3c689d3c759d3ca69d3cd29d3c
+d39d3ce89d3d009d3d089d3d139d3d179d3d249d3d559d3d7f9d3d809d3d959d
+3dad9d3db49d3dbf9d3dc39d3dd09d3e0a9d3e359d3e369d3e4b9d3e679d3e7f
+9d3e8a9d3e969d3ea39d3ed39d3efd9d3efe9d3f009d3f119d3f169d3f2a9d3f
+379d3f6d9d3f999d3f9a9d3f9c9d3fad9d3fb29d3fc49d3fd19d40059d40319d
+40329d40349d40459d404a9d405a9d40679d409e9d40ca9d40cb9d40ce9d40d3
+9d40e09d40ed9d41289d41569d41579d415a9d415f9d416c9d41719d417f9d41
+b89d41e69d41e79d41ea9d41ef9d41fc9d42019d420f9d421c9d42539d42809d
+42819d42969d42b29d42c69d42d19d42de9d42eb9d43219d434b9d434c9d434e
+9d43609d43669d43749d43ad9d43d99d43da9d43dd9d43e29d43f29d44269d44
+529d44539d44559d44679d446d9d44799d44ae9d44dc9d44dd9d44e09d44e59d
+44f59d452d9d45599d455a9d455c9d456e9d45749d45849d45c29d45f09d45f1
+9d45f49d45f99d46099d463c9d46689d46699d467f9d46989d46a19d46ad9d46
+b39d46c19d46fc9d47299d472a9d47409d47599d47629d476e9d47749d47829d
+47b69d47e29d47e39d47fb9d48309d485e9d485f9d48729d48a69d48d39d48d4
+9d48ea9d49019d49069d49129d49159d49239d49569d49829d49839d49949d49
+a19d49cf9d49fb9d49fc9d4a129d4a2b9d4a349d4a409d4a469d4a549d4a859d
+4aae9d4aaf9d4ab19d4ac39d4ac99d4ad69d4b099d4b349d4b359d4b389d4b3d
+9d4b459d4b769d4ba29d4ba39d4bb99d4bd29d4bdb9d4be79d4bed9d4bfb9d4c
+2c9d4c589d4c599d4c6f9d4c969d4cbb9d4cc79d4ce29d4cf09d4d1f9d4d4f9d
+4d509d4d569d4d5c9d4d6a9d4d709d4d739d4d799d4d7e9d4d8c9d4e5c9d4e70
+9d4ea09d4ed29d4ed39d4ed99d4edf9d4eee9d4ef49d4ef79d4efd9d4f029d4f
+109d4fe09d4ffa9d50289d505a9d505b9d50619d50679d50719d50779d507a9d
+50809d50859d50939d51989d51ac9d51da9d520c9d520d9d52139d52199d5225
+9d522b9d522e9d52349d52399d52479d530d9d53219d53519d53839d53849d53
+8a9d53909d539f9d53a59d53a89d53ae9d53b39d53bf9d58789d58a49d58d69d
+58d79d58dd9d58e39d58ed9d58f39d58f69d58fc9d59019d590d9d5dc69d5df8
+9d5e2a9d5e2b9d5e319d5e379d5e479d5e4d9d5e509d5e569d5e5b9d5e699d5f
+399d5f539d5f829d5fb49d5fb59d5fbb9d5fc19d5fd19d5fd79d5fda9d5fe09d
+5fe59d5ff39d60c39d60dd9d61109d61409d61419d61469d614b9d61589d615e
+9d61729d61789d617b9d61b09d61dc9d61dd9d61f39d620a9d620f9d621b9d62
+1e9d622c9d62669d62929d62939d62a99d62c49d62d19d62dd9d62e69d62f49d
+63229d63529d63539d63599d635f9d636b9d63719d63749d637a9d637f9d638d
+9d64ec9d67fb9d682b9d685d9d685e9d68649d686a9d68789d687e9d68819d68
+879d688c9d689a9d69c49d6cd39d6d009d6d309d6d319d6d379d6d3d9d6d489d
+6d4e9d6d519d6d579d6d5c9d6d6a9d6e739d71829d71a09d71af9d71b09d71b4
+9d71b59d71c19d71cd9d71f19d72059d72069d720a9d720b9d720e9d721a9d72
+209d72459d72569d72579d725a9d72849d72959d72969d72999d72bf9d72d59d
+72d69d72da9d72db9d72de9d72ea9d72ed9d73169d73329d73339d73369d735a
+9d73699d736a9d736e9d736f9d73729d737e9d737e9d73ab9d73c59d73c69d73
+ca9d73cb9d73ce9d73d49d73d79d73e39d73e69d74119d742b9d742c9d742f9d
+74359d74380301
-88511213


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service SoFrontCommClt : TarificationClt.FrontCommClt = (DialogDuration = SESSION,
	Visibility = user,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '04A43F3D-0BFC-11D1-BE4E-1F5BB6EEAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionMgr.DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object)
begin
--
--	Description :	Cette méthode permet de gérer des actions propres aux projets utilisateurs
--					(par exemple un calcul).	
--
--	Type :	Concret
--
--	Parametres :	Input	--> pAction :	Code action non répertorié dans les actions standards
--					Input	--> pObjet 	:	Paramètre lié à l'arction (il faudra caster en fonction de l'action)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	ActionExc : générée en cas d'action inconnue.
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgr.DoAction');


-- Traitement


Case pAction is
	When ACT_TARIF_CALCULTARIF do
		i : integer;
--	When ACT_TARIF_MISEENPRODUCTION do
	Else do
		unExc : ActionExc = new;
		unExc.Message.Concat(pAction);
		Self.TraceExc(unExc, 'ActionMgr.DoAction');
		Raise unExc;
End Case;
-- Fin du traitement


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgr.DoAction : End');

Return;


end method;

------------------------------------------------------------
method ActionMgr.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ControlWin.Init
begin
super.Init();
-- Définition du nom de l'application 
Self.ApplicationName = APP_APPLICATIONNAME;

-- Affectation des Menus utilisés en menu contextuel
hWin : MenuWin = new;
Self.MenuRef = hWin.Window.Menu;

-- Affection du manager d'actions
hActionMgr : ActionMgr = new;
Self.MyActionMgr = hActionMgr;
Self.MyActionMgr.MyControlWin = Self;

end method;

------------------------------------------------------------
method FrontCommClt.DoInitService
begin
--
--	Description :	Cette méthode permet d'initialiser le service (Définition du serveur de cmmunication et des dépendances).
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommClt.DoInitService');

Self.FrontCommSrv = SoFrontCommSrv;
Self.Dependances.AppendRow(Self.FrontCommSrv);
Task.Delay(1000);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommClt.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method FrontCommClt.Init
begin
super.Init();
Self.IsUsingFrontCommSrv = FALSE;

end method;

------------------------------------------------------------
method InitApp.DoInitService
begin
--
--	Description :	Cette méthode permet d'initialiser le service (Définition du serveur de cmmunication et des dépendances).
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--	D. NGUYEN	  |	04/07/1997	|	Corrections (simplification des init).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.DoInitService');

-- Définition de la frontale de communication
TmpFrontComm : FrontCommClt = SoFrontCommClt;
Self.FrontComm = TmpFrontComm;
Self.Dependances.AppendRow(Self.FrontComm);

-- Définition du controleur de fenêtres
TmpControlWin : ControlWin = new();
TmpControlWin.ApplicationName = APP_APPLICATIONNAME; -- Définition du nom de l'application 
hWin : MenuWin = new; -- Affectation des Menus utilisés en menu contextuel
TmpControlWin.MenuRef = hWin.Window.Menu;
--hActionMgr : ActionMgr = new(FrontComm = TmpFrontComm, InterfaceMgr=TmpInterfaceMgr); -- Affection du manager d'actions
hActionMgr : ActionMgr = new(FrontComm = TmpFrontComm); -- Affection du manager d'actions

TmpControlWin.MyActionMgr = hActionMgr;
TmpControlWin.MyActionMgr.MyControlWin = TmpControlWin;
TmpControlWin.DictionaryBSMgr = soDictionaryBSMgr;
Self.Dependances.AppendRow(TmpControlWin.DictionaryBSMgr);

Self.MyControlWin = TmpControlWin;
Self.MyControlWin.FrontComm = Self.FrontComm;
Self.Dependances.AppendRow(Self.myControlWin);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method InitApp.DoOpenApplication
begin
--
--	Description : 	démarre l'application. En général par l'ouverture d'une ou plusieurs fenêtres.
--					La fenêtre principale de l'application doit obligatoirement être lancée en mode synchrone;
--					sinon, on sort de l'application.
--
--	Type :	Concret
--
--	Parametres :	Auncun
--
--	Pre-condition :	Aucun
--
--	Post-condition :	Aucun
--
--	Exceptions :	Aucun
--
--	Usage : InitApp
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.OpenApplication');

hWin : LoginWin = new;	-- Fenêtre de login
hWin.MyControlWin = Self.MyControlWin;
hWin.FrontComm = Self.MyControlWin.FrontComm;
hWin.Parent = Self;
hWin.Display();

hWin1 : TarificationWin = new;	-- Fenêtre principale de l'application
Self.MyControlWin.InitWin = hWin1;
Self.MyControlWin.Display(hWin1, CTW_ASYNCDISP);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.OpenApplication : End');

Return;

Exception
	When e:GenericException do
		Self.TraceExc(e,'InitApp.OpenApplication');
		Raise;
 


end method;

------------------------------------------------------------
method InitApp.Init
begin
super.Init();

end method;

------------------------------------------------------------
method InitApp.StartApp
begin
--
--	Description : 	Synchronization of the service objects due at the startup of the current service.
--
--	Type :	Abstract
--
--	Parameters :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Startup of the application
--
--	History :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.StartApp');

Super.SyncServices();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.StartApp : End');

Return;

Exception
	When e:DistributedAccessException do
		Task.Delay(1000);
		Self.SyncServices();
end method;

------------------------------------------------------------
method NoeudPriv.DoAcceptDuplicates: Framework.boolean
begin
-- Doit t'on accepter les valeurs (sémantiquement) en double
-- False par défaut

return false;
end method;

------------------------------------------------------------
method NoeudPriv.DoCompare(input Key1: Framework.Object,
	input Key2: Framework.Object): Framework.integer
begin
--
--	Description : Comparer deux clés
--
--	Type :	abstrait
--
--	Parametres :    Key1  : Première clé
--					Key2  : Deuxième clé
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

unRes : integer;
T1    : TextData ;
T2    : TextData ;

T1 = (TextData) (Key1);
T2 = (TextData) (Key2);

if T1.IsGreaterThan(T2) then
   unRes = 1;
elseif T1.IsLessThan(T2) then 
   unRes = -1;
else
   unRes = 0;
end if;

return unRes;
end method;

------------------------------------------------------------
method NoeudPriv.DoNotifyNodeFound(input aNode: DataStructuresClasses.SearchTree,
	input CaseBranch: Framework.integer,
	input Param: Framework.Object)
begin
--
--	Description : Méthode "callback" appelée pour calculer les pourcentages
--
--	Type :	concret
--
--	Parametres :    aNode      : Le noeud faisant l'objet de la notification
--	                CaseBranch : Code de l'action à effectuer 
--					Param 	   : Paramètre utilisable pour un traitement du noeud 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	??/04/1998	|	Creation.
--+

-- Cette méthode doit être surchargée par la classe dérivée
-- La variable CaseBranch donne une indication (utilisateur) ce
-- l'action à effectuer avec la donnée

-- Exemple :
-- case CaseBranch is
--   when 1 do
--			(Stack) (Param).Push(aNode.Value);
-- end case;

Montant : NoeudPriv;
Part   : DoubleData = New();

case CaseBranch is

    when CODE_NOTIFICATION do

	  Montant = (NoeudPriv) (aNode);
	  Part.Divide(Montant.NbPersonnesActifs, NOMBRE_CLIENT);  
	  Part.Multiply(Part.Value,100);

	  aDisplayNode : TarifClientDisplayNode = new();
	  aDisplayNode.DVNodeText = Montant.Montant;
	  aDisplayNode.NbPersonnes = Montant.NbPersonnes;
	  aDisplayNode.NbPersonnesActifs = Montant.NbPersonnesActifs;
	  aDisplayNode.Part = Part;
	  
	  (array of TarifClientDisplayNode) (Param).AppendRow(aDisplayNode);
	  	  	  		
end case;



end method;

------------------------------------------------------------
method NoeudPriv.DoRaiseExceptionWhenDuplicateValues: Framework.boolean
begin
return TRUE;
end method;

------------------------------------------------------------
method NoeudPriv.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarifClientDisplayNode.Init
begin
super.Init();
end method;

------------------------------------------------------------
method TarifClientParam.DoResetAttributes
begin
--
--	Description : 	Instanciation des attributs de la structure de données.
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+


Self.CodeDevise = New();
Self.CodeService = New();
Self.CodeProduit = New();




end method;

------------------------------------------------------------
method TarifClientParam.Init
begin
super.Init();
end method;

------------------------------------------------------------
method LoginWin.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MenuWin.Display
begin
self.Open();
event loop
	when task.Shutdown do
		exit;
end event;
self.Close();
end method;

------------------------------------------------------------
method MenuWin.Init
begin
--
--	Description :		Initialisation des menus contextuels
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--
--	D. Nguyen	|	07/05/1997	|	Création.
--+

super.Init();

unActionParam : ActionParamDesc;

unActionParam= new(CodeAction=ACT_TARIF_CALCULTARIF);
unDetailAffParam : DetailAffParamDesc = new(AffMode=CTW_ASYNCDISP,uneDetailWin=TarifClientWin);
unActionParam.unObjet = unDetailAffParam;
<Calculette>.AppData = unActionParam;

unActionParam= new(CodeAction=ACT_TARIF_UNSEULPRIXPUBLIC);
unDetailAffParam  = new(AffMode=CTW_ASYNCDISP,uneDetailWin=TarifClientWin);
unActionParam.unObjet = unDetailAffParam;
<UnSeulPrixPublic>.AppData = unActionParam;

unActionParam= new(CodeAction=ACT_TARIF_MISEENPRODUCTION);
unDetailAffParam  = new(AffMode=CTW_ASYNCDISP,uneDetailWin=TarifClientWin);
unActionParam.unObjet = unDetailAffParam;
<MiseEnProd>.AppData = unActionParam;
end method;

------------------------------------------------------------
method TarifClientWin.AfficListe
begin
aTransdata : Transclass = New();
atransData.aRecordSelfDesc.selfDesc=New();
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereDevise';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeDevise;
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereProduit';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeProduit;
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeService;
aTransdata.TransActionService = ACT_STD_READ;
UnCache : Array of CacheDesc = (Array of CacheDesc)(self.Transfer(aTransdata,soTarificationBSMgr,TarifClientBS));
UnTarifClient : TarifClientDesc = New();
dateJour : DateTimeData = New();
datejour.SetCurrent(Resolution = DR_DAY);



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarifClientWin.AfficheListe : ');
-- Initialisation de la liste
compteur : integer = 0;
tmpListeCourante : array of TarifClientDisplayNode = new();
tmpListeCouranteTotale : array of TarifClientDisplayNode = new();
UnTarifClient2 : TarifClientDesc = New();
/*if UnCache <> NIL and UnCache.Items > 0 then--Existence de données à afficher définies dans la méthode AfficheArbre
	For aCacheDesc in UnCache do
		if aCachedesc <> NIL then
			compteur = compteur + 1;
			for index in 1 to UnCache.Items  do
				if unCache[index] <> NIL then
					if unCache[index].Record <> NIL then
						UnTarifClient = (TarifClientDesc)(unCache[index].Record);				
						if tmpListeCourante[compteur] = NIL then
							tmpListeCourante[compteur] = New();
							tmpListeCourante[compteur].DVNodeText = new();
							tmpListeCourante[compteur].DVNodeText.SetValue(UnTarifClient.Montant);
							tmpListeCourante[compteur].NbPersonnes = 1 ;
							if DateJour.IsGreaterThan(UnTarifClient.DateDebutValidite) or DateJour.IsEqual(UnTarifClient.DateDebutValidite) then
								if UnTarifClient.DateFinValidite.IsGreaterThan(DateJour) or DateJour.IsEqual(UnTarifClient.DateFinValidite) then
									tmpListeCourante[compteur].NbPersonnesActifs = 1 ;
								end if;
							end if;
						end if;
						if unCache[index + 1] <> NIL then
							if unCache[index + 1].Record <> NIL then
								UnTarifClient2= (TarifClientDesc)(unCache[index + 1].Record);
								if UnTarifClient.Montant.Compare(length=0,Source=UnTarifClient2.Montant,IgnoreCase=TRUE) = 0 then
									tmpListeCourante[compteur].NbPersonnes = tmpListeCourante[compteur].NbPersonnes + 1;
									if (DateJour.IsGreaterThan(UnTarifClient2.DateDebutValidite) or DateJour.IsEqual(UnTarifClient2.DateDebutValidite)) then
										if (UnTarifClient2.DateFinValidite.IsGreaterThan(DateJour) or DateJour.IsEqual(UnTarifClient2.DateFinValidite)) then
											tmpListeCourante[compteur].NbPersonnesActifs = tmpListeCourante[compteur].NbPersonnesActifs + 1 ;
										end if;
									end if;
									UnCache.DeleteRow(unCache[index]);
									index = index - 1;
								end if;
							end if;
						end if;
					end if;
				end if;
				
			end for;
			
		end if;	
		tmpListeCourante[compteur].Part = ((tmpListeCourante[compteur].NbPersonnes * 100.0) / NOMBRE_CLIENT);
			
	end for;
	<TarifClientListView>.SetViewNodes(nodes = tmpListeCourante);
	for valeur in 1 to tmpListeCourante.Items do
			tmpListeCouranteTotale[1] = New();
			tmpListeCouranteTotale[1].NbPersonnes = tmpListeCourante[valeur].NbPersonnes + tmpListeCouranteTotale[1].NbPersonnes;
			tmpListeCouranteTotale[1].NbPersonnesActifs = tmpListeCourante[valeur].NbPersonnes + tmpListeCouranteTotale[1].NbPersonnesActifs;
	end for;
	tmpListeCouranteTotale[1].Part = (tmpListeCouranteTotale[1].NbPersonnes * 100.0) /NOMBRE_CLIENT;
	<BilanView>.SetViewNodes(nodes = tmpListeCouranteTotale);
else
		-- Si pas de donnée à afficher ,message
		self.AffStatusLine('Pas de tarif privilège pour ce contexte d''application');
end if;*/

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientWin.AfficheListe : End ');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientWin.AfficheListe');
		Raise;

end method;

------------------------------------------------------------
method TarifClientWin.afficliste2
begin
aTransdata : Transclass = New();
atransData.aRecordSelfDesc.selfDesc=New();
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereDevise';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeDevise;
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereProduit';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeProduit;
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = UnTarifClientParam.CodeService;
aTransdata.TransActionService = ACT_STD_READ;
UnCache : Array of CacheDesc = (Array of CacheDesc)(self.Transfer(aTransdata,soTarificationBSMgr,TarifClientBS));

dateJour : DateTimeData = New();
datejour.SetCurrent(Resolution = DR_DAY);


-- 1ERE Boucle : Cast des CacheDesc en TarifClientDesc (Optionnel, mais plus pratique)
ListePriv : array of TarifClientDesc = new();
if UnCache <> NIL and UnCache.Items > 0 then--Existence de données à afficher définies dans la méthode AfficheArbre
	For aCacheDesc in UnCache do
		if aCachedesc <> NIL then
			ListePriv.AppendRow((TarifClientDesc)(aCacheDesc.Record));		
		end if;
	end for;
end if;

-- 2EME Boucle : Insertion dans l'arbre et comptage des occurrences de chaque expression

Arbre   : NoeudPriv = new();
Montant : NoeudPriv;

for unPriv in ListePriv do
	if unPriv.Montant <> NIL then
		Montant = (NoeudPriv) (Arbre.ForceNode(unPriv.Montant,NIL,NoeudPriv,0,NIL));
		Montant.Montant = unPriv.Montant;
		Montant.NbPersonnes = Montant.NbPersonnes + 1;	
	   	if DateJour.IsGreaterThan(UnPriv.DateDebutValidite) or DateJour.IsEqual(UnPriv.DateDebutValidite) then
			if UnPriv.DateFinValidite.IsGreaterThan(DateJour) or DateJour.IsEqual(UnPriv.DateFinValidite) then
				Montant.NbPersonnesActifs = Montant.NbPersonnesActifs + 1;	
			end if;
		end if;
	end if;
end for;

tmpListeCourante : array of TarifClientDisplayNode = new();
Arbre.DeepLeftTraversalInOrder(CODE_NOTIFICATION,tmpListeCourante);

if tmpListeCourante.Items > 0 and tmpListeCourante <> NIL then
	for index in 1 to tmpListeCourante.Items do
		if tmpListeCourante[index] <> NIL then
			<TarifClientListView>.SetViewNodes(nodes = tmpListeCourante);
		end if;
	end for;
end if;



end method;

------------------------------------------------------------
method TarifClientWin.DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc)
begin

--	Description : 	Affiche l'enregistrement passé en paramètre.
--					Nous ne souhaitons pas dans notre cas procéder à un affichage standard : GridField contenu 
--					dans le Panel0, mappé par la classe métier considéré avec affichage automatique des instances 
--					dans les widgets correspondants aux champs considéres; mais au contraire, nous voulons 
--					présenter les différents enregistrements dans une ListField. Ainsi, cette méthode est défini 
--					dans cette application uniquement dans un but d'adéquation au socle et ne sera jamais appelée.
--
--	Type :	Concret
--
--	Parametres :	Input -->	pRecord :	enregistrement à afficher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientWin.DoAffRecord ');



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientWin.DoAffRecord : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientWin.DoAffRecord');
		Raise;
end method;

------------------------------------------------------------
method TarifClientWin.Init
begin
super.Init();
self.FlagInitReadData = FALSE;
end method;

------------------------------------------------------------
method TarifClientWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : Chargement dans une scrollList des données du referentiel.
--				  Equivalent de DicoTrt.InitFillInFields
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.InitDisplay');

Super.InitDisplay(WithReadData);
self.CodeDevise = self.RemplaceLibelement(self.UnTarifClientParam.CodeDevise.Value,TYPE_DEVISE);
self.CodeProduit = self.RemplaceLibelement(self.UnTarifClientParam.CodeProduit.Value,TYPE_PRODUIT);
self.CodeService = self.RemplaceLibelement(self.UnTArifClientParam.CodesERVICE.Value,TYPE_SERVICE);
self.AfficListe2();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.InitDisplay : End');

Return;
Exception
	When e : GenericException do
		Self.TraceExc(e,'TarificationWin.InitDisplay');
		Raise;


end method;

------------------------------------------------------------
method TarifClientWin.RemplaceLibelement(input unCode: Framework.integer,
	input aType: Framework.integer): Framework.TextData
begin
--
--	Description : lecture dans le réferentiel des libellés correspondants aux codes passées en paramètres
--
--	Type :	Abstrait
--
--	Parametres : Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarifClientWin
--
--	History :
--
--	CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarifClientWin.RemplaceLibelement : ');

aLibelement : TextData = New();


-- ListeService, listeProduit et ListeDevise ont été chargées aux préalables avec les valeurs 
-- du réferentiel correspondant respectivement aux types du dico suivant : RefTypeServiceDesc,
-- RefTypeProduitDesc, RefDeviseDesc.

if aType = TYPE_SERVICE then
	for aservice in listeservice do
		if unCode = aservice.IntegerValue then
			alibelement.SetValue(aservice.TextValue);
		end if;
	end for;
end if;
if aType = TYPE_PRODUIT then
	for aproduit in listeproduit do
		if unCode = aproduit.IntegerValue then
			alibelement.SetValue(aproduit.TextValue);
		end if;
	end for;
end if;
if aType = TYPE_DEVISE then
	for adevise in listedevise do
		if unCode = adevise.IntegerValue then
			alibelement.SetValue(adevise.TextValue);
		end if;
	end for;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarifClientWin.RemplaceLibelement : End');

return aLibelement;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarifClientWin.RemplaceLibelement');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.AddRegle(input Mode: Framework.integer)
begin
--
--	Description : 	Creation of a new instance of the window.
--
--	Type :	Abstract
--
--	Parametres :	Input --> Mode :	DTA_ADDNEW (Creation with initialisation)
--										DTA_ADDFROMCURRENT (Creation by copy of the current)
--
--	Pre-condition : The mode must be alimented.
--
--	Post-condition : The instance is created in the interface
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AddRegle');

Go : Boolean = FALSE;
if AddConfirm and FlagPanel0 then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_ADD_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		AffStatusLine('Add canceled...');
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;

if Go then
	TmpRecord : ObjectSelfDesc;
	CurrentIdRegle = 0;
	Case Mode is
		when DTA_ADDNEW do
			TmpRecord = BufferStructure.clone(Deep=TRUE);
			i : integer;
			For SDesc in InitAddValues.SelfDesc do
				i = i + 1;
				if TmpRecord.SelfDesc[i].ItemReference.IsA(Type=DataValue) then
					aItemReference : DataValue = (DataValue)(TmpRecord.SelfDesc[i].ItemReference);

					if (DataValue)(SDesc.ItemReference) <> NIL then
						if (DataValue)(SDesc.ItemReference).IsNull = TRUE then
							aItemReference.IsNull = TRUE;
						else
							aItemReference.setValue((DataValue)(SDesc.ItemReference).TextValue);
						end if;
					else
						aItemReference.setValue((DataValue)(SDesc.ItemReference).TextValue);
					end if;
				else
					aItemRefence : Object = TmpRecord.SelfDesc[i].ItemReference.clone(Deep=TRUE);
				end if;
			End for;
			TmpRecord.Id = 0;
			AffectDataWinRegle(TmpRecord);
		when DTA_ADDFROMCURRENT do
			TmpObject : Object;
			DoAffectObjectRegle(TmpObject);
			TmpRecord = (ObjectSelfDesc)(TmpObject).clone(TRUE);
			TmpRecord.Id = 0;
			AffectDataWinRegle(TmpRecord);
	End Case;
	DoAfterAdd();
	<Regle>.HasDataChanged = FALSE;
	SetDataModeRegle(ACT_STD_APPEND);
End if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-TarificationWin.AddRegle : End');


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.AddRegle');
		Raise;

end method;

------------------------------------------------------------
method TarificationWin.AddRegle
begin
--
--	Description : 	Creation of a new instance of the window, default option.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is created in the interface in DTA_ADDNEW mode
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

AddRegle(DTA_ADDNEW);
end method;

------------------------------------------------------------
method TarificationWin.AffectDataWinRegle(input aObject: Framework.Object)
begin
--
--	Description : 	Affectation of the display from the object received.
--					The object must contain the data to display.
--					This method must be overloaded in concret level.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject :	Contains the data to display
--
--	Pre-condition : None
--
--	Post-condition : The data are displayed.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AffectDataWinRegle');

aBufferType : Classtype = BufferStructure.GetClassType();
if not aObject.Isa(aBufferType) then
	aClassType : ClassType = aBufferType;
	aObject = aClassType.InstanceAlloc();
end if;
--aRecord : RecordDesc = new(object=(ObjectSelfDesc)(aObject));
--DoAffRecord(aRecord);
DoAffRecordRegle((ObjectSelfDesc)(aObject));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AffectDataWinRegle : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.AffectDataWinRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.AffFirstPositionRegle
begin
--
--	Description : 	Displays the first position of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	Historique :
--
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AffFirstPositionRegle');
SavPosition : integer = CurrentPositionRegle;
if CurrentPositionRegle = 0 and MyCacheRegle.Objects.Items > 0 then
	CurrentPositionRegle = 1;
end if;
if CurrentPositionRegle > 0 and MyCacheRegle.Objects.Items > 0 then
	CurrentPositionRegle = 1;
	AffPositionRegle();
	<Regle>.HasDataChanged = FALSE;
	SetDataMode(ACT_STD_READ);
Else
	CurrentPositionRegle = 0;
	AffPositionRegle();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AffFirstPositionRegle : End');

Return;

Exception
	When e : NoDataFoundExc do
		CurrentPositionRegle = SavPosition;
		TmpMsg : TextData = new;
		TmpMsg.setValue('* Exc : ');
		TmpMsg.concat(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.concat(e.Severity);
		Task.Part.LogMgr.PutLine(SP_MT_DEBUG, SP_ST_USER1, LOG_GRPFLAG, 2, TmpMsg);
		AffStatusLine('... Réessayer plus tard : données non accessibles pour l''instant.');
		Self.Window.PurgeEvents();

end method;

------------------------------------------------------------
method TarificationWin.AfficherSelection(input ChangementSelection: Framework.boolean)
begin
--
--	Description :	Cette méthode lance la recherche et l'affichage des règles correspondant à un contexte donné :
--					contexte affecté à self.MyDataContext.
--					Elle est utilisé par la méthode ChangerSelection() : boolean
--					Lorsque l'utilisateur modifie la selection, et qu'il a au préalable effectué des modifications
--					sur une des règles sans la valider, une proposition de sauvegarde est faite.
--					3 réponses possibles :
--						Cancel : Chgt_Selection = FALSE
--						Oui : Chgt_Selection = TRUE;
--						Non : Chgt_Selection = TRUE;
--
--	Type :	
--
--	Parametres :	Input 		--> Chgt_Selection : boolean
--									Chgt_Selection = FALSE , Recherche annulée
--									ChangementSelection = TRUE ,	Recherche effectuée		
		
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : ChangerSelection() : boolean
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AfficherSelection');


-- CHANGEMENTSELECTION = TRUE : LE CONTEXTE EST MIS A JOUR ET LA LECTURE EFFECTUEE

if ChangementSelection= TRUE then
	Self.<Panel0>.HasDataChanged = FALSE;
	Self.<Regle>.HasDataChanged = FALSE;
	SetDataMode(ACT_STD_READ);
	SetDataModeRegle(ACT_STD_READ);	
	RegleDesc(self.MyDataContext.unRecord).CodeDevise.SetValue(self.CodeDevise);
	RegleDesc(self.MyDataContext.unRecord).CodeCategorie.SetValue(self.CodeCategorie);
	RegleDesc(self.MyDataContext.unRecord).CodePackage.SetValue(self.CodePackage);
	RegleDesc(self.MyDataContext.unRecord).CodeProduit.SetValue(self.CodeProduit);
	RegleDesc(self.MyDataContext.unRecord).CodeService.SetValue(self.CodeService);
	RegleDesc(self.MyDataContext.unRecord).CodePromotion.SetValue(self.CodePromotion);
	self.Read();
else
-- CHANGEMENTSELECTION = FALSE : LE CONTEXTE EST CONSERVE ET LA VALEUR DES CHAMPS CORRIGES 
	self.CodeDevise = RegleDesc(self.MyDataContext.unRecord).CodeDevise.Value;
	self.CodeCategorie = RegleDesc(self.MyDataContext.unRecord).CodeCategorie.Value;
	self.CodePackage = RegleDesc(self.MyDataContext.unRecord).CodePackage.Value;
	self.CodeProduit = RegleDesc(self.MyDataContext.unRecord).CodeProduit.Value;
	self.CodeService = RegleDesc(self.MyDataContext.unRecord).CodeService.Value;
	self.CodePromotion = RegleDesc(self.MyDataContext.unRecord).CodePromotion.Value;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AfficherSelection : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.AfficherSelection');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.AffPositionRegle
begin
--
--	Description : 	Displays the current position of the data flow.
--					if there's no data, the window is initialized.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG,1, '- TarificationWin.AffPositionRegle');
if MyCacheRegle.Objects <> NIL then
	if CurrentPositionRegle <= MyCacheRegle.Objects.Items then
		if MyCacheRegle.Objects[CurrentPositionRegle] <> NIL then
			CurrentIdRegle = MyCacheRegle.Objects[CurrentPositionRegle].Record.Id;
--			TmpRec : RecordDesc = new(object=MyCacheRegle.Objects[CurrentPositionRegle].Record);
--			DoAffRecordRegle(TmpRec);
			DoAffRecordRegle(MyCacheRegle.Objects[CurrentPositionRegle].Record.Clone(TRUE));
		else
			ResetWindowRegle();
		end if;
	else
		Self.CurrentPositionRegle = Self.CurrentPositionRegle - 1;
		Self.AffPositionRegle();
	end if;
else
	ResetWindowRegle();
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AffPositionRegle : End');


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.AffPositionRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.AppendEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Appends an instance to the data flow on reception of an append event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject :	Object to append
--
--	Pre-condition : aObject exists
--
--	Post-condition : The buffer is ok
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AppendEvent');

if Self.MyDataContext = NIL and aObject <> NIL then
	if (RegleDesc)((CacheDesc)(aObject).Record).PrixPublicBln.Value = TRUE then
		Super.AppendEvent(aObject);
	else
		aCacheDesc : CacheDesc = (CacheDesc)(aObject);
		if MyCacheRegle.CriteraPlay(aCritera=OrigFilterCritera, aRecordSelfDesc=(ObjectSelfDesc)(aCacheDesc.Record)) then
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AppendEvent');
			MyCacheRegle.Append(aCacheDesc);
			self.InitListeSelectionRegle();
			if CurrentIdRegle = aCacheDesc.Record.Id then
				AffPositionRegle();
			end if;
		End if;
	end if;
End if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AppendEvent');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.AppendEvent');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.AppendRegle
begin
--
--	Description : 	Append of an instance in the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : The instance exists
--
--	Post-condition : The instance is appended
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AppendRegle');


Go : Boolean = FALSE;
if AppendConfirm and FlagPanel0 and not IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_APPEND_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.AppendRegle');
	aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
	AffStatusLine('Création en cours...');
	TmpObject : Object;
	DoAffectObjectRegle(TmpObject);
	aCacheDesc.Record = (ObjectSelfDesc)(TmpObject);
	TmpMessage : TextData = new();
	TmpWarning : Warning;
	if Self.PlayValidity then
		TmpRecordSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(aCacheDesc.Record);
		InitRecordDicoValues(TmpRecordSelfDesc, Self.DicoTypeLib);
		TmpRecordSelfDesc.DoCheckValidity();
		TmpWarning = TmpRecordSelfDesc.DoCheckWarning();
		if TmpWarning <> NIL then
			TmpMessage = TmpWarning.Message;
			TmpMessage.Concat('\n');
		end if;
		aCacheDesc.Record.DtMajQqo.SetCurrent();
		aCacheDesc.record.IdUtlQqo=Self.SessionUser.IdUtl;
	end if;
	aCacheDesc.Record.Id = CurrentIdRegle;
	DoBeforeAppend();
	MyTransData.TransObject = aCacheDesc;
	MyTransData.TransActionService = ACT_STD_APPEND;
	aCacheDesc = (CacheDesc)(Transfer());
	DoAfterAppend();
	if aCacheDesc <> NIL then
		MyCacheRegle.Append(aCacheDesc);
	end if;
	TmpMessage.Concat('Création effectuée...');
	AffStatusLine(TmpMessage);
	Self.InitListeSelectionRegle();
	Self.CurrentPositionRegle = Self.MyCacheRegle.Objects.Items;
	AffPositionRegle();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AppendRegle: End');
else
	AffStatusLine('Création annulée...');
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.AppendRegle : End');

Return;

Exception 

	When e: RecordValidityExc do
		TmpText : TextData = new(Value=e.Message.value);
		e.Message.setValue(e.ItemName);

		uneStructureDesc : StructureDesc;
		uneStructureDesc = GetStructureDesc(BufferStructure, e.ItemName);
		if uneStructureDesc <> NIL then
			e.Message.setValue(uneStructureDesc.ItemUsername);
		end if;
		e.Message.Concat(':');
		e.Message.Concat(TmpText.value);
		Self.Window.PurgeEvents();
		Self.RequestFocusOn(ItemName=e.ItemName,aWidget=<Regle>);
		Raise e;
	When e: GenericException do
		Self.Window.PurgeEvents();
		<Regle>.RequestFocus();
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.ChangementPackage
begin
--
--	Description :	traitements à faire lors d'un changement de selection portant sur le code Package
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ChangementPackage');

ListeSelection : Array of IntegerData = New();
UnCodePackage : RefTypePackageDesc = New(Value = self.CodePackage);


--si le code package est égal à 1, cela signifie que l'on se place dans un contexte 'hors package',
-- dans ce cas, il faut charger l'ensemble des produits présents dans le dico
if UnCodePackage.Value = 1 then
	self.InitListField(self.<CodeProduit>,self.BufferStructure,0);
else
	aTransData : Transdesc = New();
	aTransdata.TransActionService = ACT_TARIF_READCODEPRODUIT;
	aTransData.TransObject = UnCodePackage;
	
	--Chargement des produits pour un package donnée ou
	ListeSelection = (Array of IntegerData)(transfer(aTransData,soCatalogueBSMgr,PackageBS));
	-- Recherche des produits correspondant à un package donné et affichage dans la ScrollList
	self.InitScrollList(self.<CodeProduit>,'RefTypeProduitDesc',ListeSelection);
end if;

-- Affectation du premier produit trouvé au champ CodeProduit
self.CodeProduit=self.<CodeProduit>.ExtractListElementByIndex(1).IntegerValue;


-- Repercussion de ce changement au niveau du produit (Recherche des services et des promotions)
self.ChangementProduit();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ChangementPackage : End');


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ChangementPackage');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.ChangementProduit
begin
--	Description :	traitements à faire lors d'un changement de selection portant sur le code Produit
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ChangementProduit');

UnCodeProduit : RefTypeProduitDesc = New (Value = self.CodeProduit);

ListeSelection : Array of IntegerData = New();


aTransData : Transdesc = New();
aTransdata.TransActionService = ACT_TARIF_READCODESERVICETARIFABLE;
aTransData.TransObject = UnCodeProduit;

--Chargement des produits pour un package donnée ou
ListeSelection = (Array of IntegerData)(transfer(aTransData,soCatalogueBSMgr,ProduitBS));

-- Recherche des services correspondant à un produit donné et affichage dans la ScrollList
self.InitScrollList(self.<CodeService>,'RefTypeServiceDesc',ListeSelection);

-- Affectation du premier service trouvé au champ CodeService
self.CodeService = self.<CodeService>.ExtractListElementByIndex(1).IntegerValue;


-- Repercussion de ce changement au niveau du service (Recherche des promotions)
self.ChangementService();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ChangementProduit : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ChangementProduit');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.ChangementService
begin
--Descrition : lorsque le service n'est pas remisable, il est impossible de créer une règle spécifique
--				Il n'y a ni condition particulière ni promotion
--				
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :TarificationWin.ChangerSelectionEvh()
--
--	Historique :
--
--  CDC |
--
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ChangementService ');
			
UnService : Service_Desc = New();

-- Initialisation et affectation du contexte de recherche
aTransdata : Transclass = New();
atransData.aRecordSelfDesc.selfDesc=New();
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = IntegerData(Value=self.CodeService);
aTransdata.TransActionService = ACT_STD_READ;

-- Lecture
UnCache : Array of CacheDesc= (Array of CacheDesc)(transfer(atransdata,soCatalogueBSMgr,ServiceBS));


if UnCache <> NIL and UnCache.Items > 0 then
	for UnCacheDesc in UnCache do
		if UnCacheDesc <> NIL then
			UnService = (Service_Desc)(UnCacheDesc.Record);
			self.IsServiceRemisable = UnService.RemisableBln;
			self.ChangerListePromotion(UnService.RemisableBln);
			
			-- S'IL LE SERVICE N'EST PAS REMISABLE, LES CHAMPS DE SAISI DE LA REGLE CONDITIONNELLE 
			-- DOIVENT ETRE EN VIEWONLY ET EN GRISE, LE BOUTON "CONDITIONS PARTICULIERES" INACTIF, 
			-- LES BOUTONS VALABLES POUR LES REGLES CONDITIONNELLES INACTIFS EGALEMENT.
			
			if not UnService.RemisableBln then 
				self.<Regle.Commentaire>.State = FS_VIEWONLY;
				self.<Regle.Commentaire>.FillColor = C_GRAY2; 
				self.<Regle.Condition>.State = FS_VIEWONLY;
				self.<Regle.Condition>.FillColor = C_GRAY2;
				self.<Regle.DateDebutValidite>.State = FS_VIEWONLY;
				self.<Regle.DateDebutValidite>.FillColor = C_GRAY2;
				self.<Regle.DateFinValidite>.State = FS_VIEWONLY;
				self.<Regle.DateFinValidite>.FillColor = C_GRAY2;
				self.<Regle.Montant>.State = FS_VIEWONLY;
				self.<Regle.Montant>.FillColor = C_GRAY2;	
				self.<Regle.NomRegle>.State = FS_VIEWONLY;
				self.<Regle.NomRegle>.FillColor = C_GRAY2;	
				self.<GridBoutonsRegle>.State = FS_INACTIVE;
				self.<ConditionBtn>.State = FS_INACTIVE;
				self.<RegleSelectionnee>.State = FS_VIEWONLY;
				self.<RegleSelectionnee>.FillColor = C_GRAY2;											
			else
				self.<Regle.Commentaire>.State = FS_UPDATE;
				self.<Regle.Commentaire>.FillColor = C_WHITE; 
				self.<Regle.Condition>.State = FS_UPDATE;
				self.<Regle.Condition>.FillColor = C_WHITE;
				self.<Regle.DateDebutValidite>.State = FS_UPDATE;
				self.<Regle.DateDebutValidite>.FillColor = C_WHITE;
				self.<Regle.DateFinValidite>.State = FS_UPDATE;
				self.<Regle.DateFinValidite>.FillColor = C_WHITE;
				self.<Regle.Montant>.State = FS_UPDATE;
				self.<Regle.Montant>.FillColor = C_WHITE;
				self.<Regle.NomRegle>.State = FS_UPDATE;
				self.<Regle.NomRegle>.FillColor = C_WHITE;	
				self.<GridBoutonsRegle>.State = FS_UPDATE;	
				self.<ConditionBtn>.State = FS_UPDATE;		
				self.<RegleSelectionnee>.State = FS_UPDATE;
				self.<RegleSelectionnee>.FillColor = C_WHITE;								
			end if;
		end if;
	end for;
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ChangementService : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ChangementService');
		Raise;

end method;

------------------------------------------------------------
method TarificationWin.ChangerListePromotion(input RemisableBln: Framework.boolean)
begin
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ChangerListePromotion ');

ListeSelection : Array of IntegerData = New();


if RemisableBln then
	-- Affectation de PromotionParam : contient les paramètres de recherche pour les promotions
	aPromotionParam : PromotionParam = New();
	aPromotionParam.DoResetAttributes();
	aPromotionParam.CodeCategorie.SetValue(self.codeCategorie);
	aPromotionParam.CodeDevise.SetValue(self.codeDevise);
	aPromotionParam.CodePackage.SetValue(self.codePackage);
	aPromotionParam.CodeProduit.SetValue(self.codeProduit);
	aPromotionParam.CodeService.SetValue(self.codeService);	
	aTransData : Transdesc = New();
	aTransdata.TransActionService = ACT_TARIF_READCODEPROMOTION;
	aTransData.TransObject = aPromotionParam;
	

	--Chargement des promotions 
	ListeSelection = (Array of IntegerData)(transfer(aTransData,soCatalogueBSMgr,PromotionBS));	
else
	--service non remisable : pas de promotion
	ListeSelection.Appendrow(IntegerData (Value = 1));  
		
end if;


--chargement et  affichage des promotions
	self.InitScrollList(self.<CodePromotion>,'RefTypePromotionDesc',ListeSelection);
	

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ChangerListePromotion : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ChangerListePromotion');
		Raise;


end method;

------------------------------------------------------------
method TarificationWin.ChangerSelection: Framework.boolean
begin
--
--	Description :	Lorsque l'utilisateur modifie la selection, et qu'il a au préalable effectué des modifications
--					sur une des règles sans la valider, une proposition de sauvegarde est faite.
--					3 réponses possibles :
--						Cancel : Chgt_Selection = FALSE
--						Oui : Chgt_Selection = TRUE;
--						Non : Chgt_Selection = TRUE;
--
--	Type :	
--
--	Parametres :	Input 		--> Chgt_Selection : boolean
--									Chgt_Selection = FALSE , Recherche annulée
--									Chgt_Selection = TRUE ,	Recherche effectuée		
		
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : ChangerSelection() : boolean
--
--	Historique :
--
--  CDC |
--
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ChangerSelection');


	AffStatusLine(' ');
	ChangementSelection : boolean = TRUE;
	Begin
		if (Self.<Panel0>.HasDatachanged) or (self.<Regle>.HasDataChanged) then
			Rep : Integer = Self.Window.Questiondialog(Self.MSG_SELECT_3, BS_YESNOCANCEL, BV_CANCEL);
			if Rep = BV_YES then
				Self.Window.DisableInput();
				if Self.<Panel0>.HasDataChanged then			
					super.submit();
				end if;
				if Self.<Regle>.HasDataChanged then
					self.SubmitRegle();
				end if;
				Self.Window.EnableInput();
			end if;
			if Rep = BV_CANCEL then
				ChangementSelection = FALSE;
			else
				ChangementSelection  = TRUE;
			end if;
		end if;

		
	Exception 
		When e : GenericException do
			Self.Window.EnableInput();
			TmpMsg : TextData = new;
			TmpMsg.Setvalue(e.Message);
			TmpMsg.Concat(' - Severity : ');
			TmpMsg.Concat(e.Severity);
			AffStatusLine(TmpMsg);
	End;



Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ChangerSelection : End');

return ChangementSelection ;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ChangerSelection');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.CompleteRegle(input Regle: TarificationSrv.RegleDesc)
begin
--
--	Description : 	affecte les données manquantes d'une règle (les codes présents dans le GridGauche)
--	
--
--	Type :	Concret
--
--	Parametres :	aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--  CDC |C
--
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.CompleteRegle');


Regle.CodeDevise.SetValue(self.CodeDevise);
Regle.CodeCategorie.SetValue(self.CodeCategorie);
Regle.CodePackage.SetValue(self.CodePackage);
Regle.CodeProduit.SetValue(self.CodeProduit);
Regle.CodeService.SetValue(self.CodeService);
Regle.CodePromotion.SetValue(self.CodePromotion);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.CompleteRegle : End');

Exception	
When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.CompleteRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DeleteEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Delete of an instance of the buffer on reception of a delete event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject : object to delete
--
--	Pre-condition : None
--
--	Post-condition : The object is deleted from the buffer.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DeleteEvent ');

if aObject <> NIL then
	if (RegleDesc)((CacheDesc)(aObject).Record).PrixPublicBln.Value = TRUE then
		Super.DeleteEvent(aObject);
	else
		aCacheDesc : CacheDesc = (CacheDesc)(aObject);
		if MyCacheRegle.IsInCache(aCacheDesc.Record.Id) then
			Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DeleteEvent');
			MyCacheRegle.Delete(aCacheDesc);
			self.InitListeSelectionRegle();
			if CurrentIdRegle = aCacheDesc.Record.Id then
				CurrentPositionRegle = CurrentPositionRegle - 1;
				AffPositionRegle();
			end if;
		end if;
	end if;
end if;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DeleteEvent');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DeleteRecordRegle(input aRecord: DataAccessSrvBD.ObjectSelfDesc)
begin
--
--	Description : 	Delete of one instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is deleted.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DeleteRecordRegle');

aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
aCacheDesc.Record = aRecord;
MyTransData.TransObject = aCacheDesc;
MyTransData.TransActionService = ACT_STD_DELETE;
Transfer();
MyCacheRegle.Delete(aCacheDesc);
self.InitListeSelectionRegle();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-TarificationWin.DeleteRecordRegle : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DeleteRecordRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DeleteRegle
begin
--
--	Description : 	Delete of the current instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is deleted.
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

Go : Boolean = FALSE;
if DeleteConfirm and FlagPanel0 and not IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.Msg_DELETE_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		AffStatusLine('Suppression annulée...');
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.DeleteRegle');
	DoBeforeDelete();
	aRecordDesc : ObjectSelfDesc = new;
	AffStatusLine('Suppression en cours...');
	TmpObject : Object;
	DoAffectObjectRegle(TmpObject);
	aRecordDesc = (ObjectSelfDesc)(TmpObject);
	For unCach in MyCacheRegle.Objects do
		if unCach.Record.Id = CurrentIdRegle then
			aRecordDesc.Id = CurrentIdRegle;
			aRecordDesc.IdUtlQqo = unCach.Record.IdUtlQqo;
			aRecordDesc.DtMajQqo = unCach.Record.DtMajQqo;
			exit;
		end if;
	End For;
	DeleteRecordRegle(aRecord=aRecordDesc);
	DoAfterDelete();
	Self.AffPositionRegle();
	AffStatusLine('Suppression effectuée...');
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DeleteRegle : End');
end if;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DeleteRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DoAffectObject(output pObject: Framework.Object)
begin
--
--	Description : 	Affectation des données affichées à l'objet de données.
--
--	Type :	Concret
--
--	Parametres :	Output -->	pObject :	Objet de réception des données
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--	CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.DoAffectObject');

self.PrixPublic.PrixPublicBln.SetValue(TRUE);
self.PrixPublic.CodeStrategie.SetValue(self.CodeStrategie);
self.CompleteRegle(Self.PrixPublic);
pObject = self.PrixPublic;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DoAffectObject : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DoAffectObject');
		Raise;
	When e : GenericExc do
		self.AffStatusLine (e.Source);
		
end method;

------------------------------------------------------------
method TarificationWin.DoAffectObjectRegle(output pObject: Framework.Object)
begin
--
--	Description : 	Affectation des données affichées à l'objet de données.
--
--	Type :	Concret
--
--	Parametres :	Output -->	pObject :	Objet de réception des données
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.DoAffectObjectRegle');
	
self.Regle.PrixPublicBln.SetValue(FALSE);
self.CompleteRegle(Self.Regle);
pObject = self.Regle;
	
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DoAffectObjectRegle : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DoAffectObjectRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc)
begin

--	Description : 	Affiche l'enregistrement passé en paramètre.
--
--	Type :	Concret
--
--	Parametres :	Input -->	pRecord :	enregistrement à afficher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DoAffRecord ');

date : DateTimeData = new(); 
date.SetCurrent();

Self.PrixPublic = (RegleDesc)(pRecord);
Self.CodeStrategie = (RegleDesc)(pRecord).CodeStrategie.IntegerValue;

--EN PRODUCTION
if (Self.PrixPublic.ProductionBln.Value = TRUE) then 
	self.<SupprimerPrixPublicBtn>.State = FS_DISABLE;
	-- DATE JOUR > DATE FIN VALIDITE
	if date.IsGreaterThan(self.PrixPublic.DateFinValidite) then
		Self.<PrixPublic.Montant>.State = FS_VIEWONLY;
		Self.<PrixPublic.Montant>.FillColor = C_GRAY1; 
		Self.<CodeStrategie>.State = FS_VIEWONLY;
		Self.<PrixPublic.DateDebutValidite>.State = FS_VIEWONLY;
		Self.<PrixPublic.DateDebutValidite>.FillColor = C_GRAY1; 
  	 	Self.<PrixPublic.DateFinValidite>.State = FS_VIEWONLY;
  	 	Self.<PrixPublic.DateFinValidite>.FillColor = C_GRAY1; 
	else
		-- DATE DEBUT VALIDITE < DATE JOUR <= DATE FIN VALIDITE 
		if ( date.IsGreaterThan(self.PrixPublic.DateDebutValidite)  or date.IsEqual(self.PrixPublic.DateDebutValidite)) then
			Self.<PrixPublic.Montant>.State = FS_VIEWONLY;
			Self.<PrixPublic.Montant>.FillColor = C_GRAY1; 
			Self.<CodeStrategie>.State = FS_VIEWONLY;
			Self.<PrixPublic.DateDebutValidite>.State = FS_VIEWONLY;
			Self.<PrixPublic.DateDebutValidite>.FillColor = C_GRAY1; 
			Self.<PrixPublic.DateFinValidite>.State = FS_UPDATE;
			Self.<PrixPublic.DateFinValidite>.FillColor = C_WHITE; 
			
		else 
		-- DATE JOUR <= DATE DEBUT VALIDITE 
			if (date.IsEqual(self.PrixPublic.DateDebutValidite) or (self.PrixPublic.DateDebutValidite.IsGreaterThan(date))) then
				Self.<PrixPublic.Montant>.State = FS_VIEWONLY;
				Self.<PrixPublic.Montant>.FillColor = C_GRAY1;
				Self.<CodeStrategie>.State = FS_VIEWONLY; 
				Self.<PrixPublic.DateDebutValidite>.State = FS_UPDATE;
				Self.<PrixPublic.DateDebutValidite>.FillColor = C_WHITE; 
				Self.<PrixPublic.DateFinValidite>.State = FS_UPDATE;
				Self.<PrixPublic.DateFinValidite>.FillColor = C_WHITE; 
			end if;	
		end if;
	end if;
else
--PAS EN PRODUCTION	
	self.<SupprimerPrixPublicBtn>.State = FS_ENABLE;
	Self.<PrixPublic.Montant>.State = FS_UPDATE;
	Self.<PrixPublic.Montant>.FillColor = C_WHITE; 
	Self.<PrixPublic.DateDebutValidite>.State = FS_UPDATE;
	Self.<PrixPublic.DateDebutValidite>.FillColor = C_WHITE; 
	Self.<PrixPublic.DateFinValidite>.State = FS_UPDATE;
	Self.<PrixPublic.DateFinValidite>.FillColor = C_WHITE; 
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DoAffRecord : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DoAffRecord');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.DoAffRecordRegle(input pRecord: DataAccessSrvBD.ObjectSelfDesc)
begin

--	Description : 	Affiche l'enregistrement passé en paramètre.
--
--	Type :	Concret
--
--	Parametres :	Input -->	pRecord :	enregistrement à afficher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : TarificationWin
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.DoAffRecordRegle ');



date : DateTimeData = new(); 
date.SetCurrent();

Self.Regle = (RegleDesc)(pRecord);
--EN PRODUCTION
if (Self.Regle.ProductionBln.Value = TRUE) then 
	self.<SupprimerRegleBtn>.State = FS_DISABLE;
	-- DATE JOUR > DATE FIN VALIDITE
	if date.IsGreaterThan(self.Regle.DateFinValidite)  then
		Self.<Regle.Montant>.State = FS_VIEWONLY;
		Self.<Regle.Montant>.FillColor = C_GRAY2; 
		Self.<Regle.DateDebutValidite>.State = FS_VIEWONLY;
		Self.<Regle.DateDebutValidite>.FillColor = C_GRAY2; 
 		Self.<Regle.DateFinValidite>.State = FS_VIEWONLY;
 		Self.<Regle.DateFinValidite>.FillColor = C_GRAY2; 
	else
		-- DATE DEBUT VALIDITE < DATE JOUR <= DATE FIN VALIDITE 
		if ( date.IsGreaterThan(self.Regle.DateDebutValidite) or date.IsEqual(self.Regle.DateDebutValidite) ) then
			Self.<Regle.Montant>.State = FS_VIEWONLY;
			Self.<Regle.Montant>.FillColor = C_GRAY2; 
			Self.<Regle.DateDebutValidite>.State = FS_VIEWONLY;
			Self.<Regle.DateDebutValidite>.FillColor = C_GRAY2; 
			if IsServiceRemisable then
				Self.<Regle.DateFinValidite>.State = FS_UPDATE;
				Self.<Regle.DateFinValidite>.FillColor = C_WHITE; 
			end if;
		else 
		-- DATE JOUR <= DATE DEBUT VALIDITE 
			if (date.IsEqual(self.Regle.DateDebutValidite) or (self.Regle.DateDebutValidite.IsGreaterThan(date))) then
				Self.<Regle.Montant>.State = FS_VIEWONLY;
				Self.<Regle.Montant>.FillColor = C_GRAY2;
				if IsServiceRemisable then 
					Self.<Regle.DateDebutValidite>.State = FS_UPDATE;
					Self.<Regle.DateDebutValidite>.FillColor = C_WHITE; 
					Self.<Regle.DateFinValidite>.State = FS_UPDATE;
					Self.<Regle.DateFinValidite>.FillColor = C_WHITE; 
				end if;
			end if;	
		end if;
	end if;
else
--PAS EN PRODUCTION	
	self.<SupprimerRegleBtn>.State = FS_ENABLE;
	if IsServiceRemisable then
		Self.<Regle.Montant>.State = FS_UPDATE;
		Self.<Regle.Montant>.FillColor = C_WHITE; 
		Self.<Regle.DateDebutValidite>.State = FS_UPDATE;
		Self.<Regle.DateDebutValidite>.FillColor = C_WHITE; 
		Self.<Regle.DateFinValidite>.State = FS_UPDATE;
		Self.<Regle.DateFinValidite>.FillColor = C_WHITE; 
	end if;
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.DoAffRecordRegle : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.DoAffRecordRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.Fermer
begin
--
--	Description :	Fermeture de la fenêtre.
--
--	Type :	Concret
--
--	Parametres :	
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.Fermer');

if self.<Regle>.HasDataChanged then
	self.SubmitRegleOnShutDown = TRUE;
	if not Self.<Panel0>.HasDataChanged then
  		self.Panel0_HasDataChanged_Modifie = TRUE;
		Self.<Panel0>.HasDataChanged = TRUE;
		if self.DataMode <> ACT_STD_UPDATE and self.DataMode <> ACT_STD_APPEND then
			self.SauvegardeDataMode = self.DataMode;
			self.DataMode = ACT_STD_UPDATE;
		end if;
	else
		self.Panel0_HasDataChanged_Modifie = FALSE;
	end if;
else
	self.SubmitRegleOnShutDown = FALSE;
	self.Panel0_HasDataChanged_Modifie = FALSE;
end if;
Super.Fermer();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.Fermer : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.Fermer');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.Init
begin
--
--	Description :	Initialisation de la fenêtre.
--
--	Type :	Concret
--
--	Parametres :	
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  CDC |	
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.Init');

unRecord : RegleDesc = new;
unRecord.DoResetAttributes();
BufferStructure = unRecord;

date : datetimedata = new;
date.SetCurrent(resolution= DR_DAY);	--date du jour exprimée sous forme jour,mois,année uniquement


--Initialisation des attributs de RegleDesc : équivaut à fixer des valeurs par défaut
InitAddRegle : RegleDesc = new();
InitAddRegle.DoResetAttributes();
InitAddRegle.DateDebutValidite.SetValue(date);
InitAddRegle.DateFinValidite.SetValue(DATE_INFINI);
self.InitAddValues = InitAddRegle;

MyTransType = soTarificationBSMgr; -- BusinessService Définition
MyClassType =RegleBS; -- ClassType of the Service for BusinessTransactionService

self.PremierRead = TRUE ;		--attribut initialisé à vrai pour empêcher la lecture des
								--règles de tarification avant que la méthode InitDisplay()
								--n'ait été lancé. C'est en effet elle qui va définir un filtre
								--de sélection des règles, nécessaire à la lecture.

self.IsServiceRemisable = TRUE; -- cet attribut est indispensable pour la méthode DoAffRecordRegle
								-- en effet si un service n'est pas remisable, l'ensemble des champs 
								-- du panel Regle doivent apparaître en grisé. 
self.CompletionAutomatique = TRUE;
Self.ErreurSiARenseigner = TRUE;			

super.Init();

ViewMode =FS_UPDATE;		-- FS_UPDATE : Mise à jour autorisée
self.FlagCTI=FALSE;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.Init : End');



Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.Init');
		Raise;


end method;

------------------------------------------------------------
method TarificationWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : Chargement dans une scrollList des données du referentiel.
--				  Equivalent de DicoTrt.InitFillInFields
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.InitDisplay');

Super.InitDisplay(WithReadData);

If CompletionAutomatique then
	aTransdata : TransDesc = New();
	aTransData.TransActionService = ACT_TARIF_COMPLETION_AUTOMATIQUE;
	TmpMsg : TextData  = (TextData)(self.transfer(aTransData,soRegleBSMgr,RegleProc));
	if TmpMsg <> NIL then
		AffStatusLine(TmpMsg);
	end if;
end if;
If ErreurSiARenseigner then
	aTransdata : TransDesc = New();
	aTransData.TransActionService = ACT_TARIF_ERREUR_SIARENSEIGNER;
	TmpMsg : TextData  = (TextData)(self.transfer(aTransData,soRegleBSMgr,RegleProc));
	if TmpMsg <> NIL then
		AffStatusLine(TmpMsg);
	end if;
end if;



self.InitListField(self.<GridSelection>,self.BufferStructure,0);
self.InitListField(self.<CodeStrategie>,self.BufferStructure,0);
MonContexteCourant : RegleDesc = New();
MonContexteCourant.DoResetAttributes();

--AFFECTATION DU CONTEXTE DE LA REGLE AVEC LA PREMIERE VALEUR DE LA LISTFIELD
MonContexteCourant.CodeDevise.SetValue(self.<CodeDevise>.ExtractListElementByIndex(1).IntegerValue);
MonContexteCourant.CodeCategorie.SetValue(self.<CodeCategorie>.ExtractListElementByIndex(1).IntegerValue);
MonContexteCourant.CodePackage.SetValue(self.<CodePackage>.ExtractListElementByIndex(1).IntegerValue);
MonContexteCourant.CodeProduit.SetValue(self.<CodeProduit>.ExtractListElementByIndex(1).IntegerValue);
MonContexteCourant.CodeService.SetValue(self.<CodeService>.ExtractListElementByIndex(1).IntegerValue);
MonContexteCourant.CodePromotion.SetValue(self.<CodePromotion>.ExtractListElementByIndex(1).IntegerValue);

--AFFECTATION DU CONTEXTE DE LA FENETRE AVEC LE CONTEXTE D'APPLICATION DE LA REGLE DEFINI PRECEDEMMENT
self.MyDataContext = New();
self.MyDataContext.unRecord = MonContexteCourant;
self.myDataContext.selfDesc = New();
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WhereDevise';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodeDevise;
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WhereCategorie';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodeCategorie;
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WherePackage';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodePackage;
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WhereProduit';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodeProduit;
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WhereService';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodeService;
self.myDataContext.SelfDesc.AppendRow();
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemName = 'WherePromotion';
self.myDataContext.SelfDesc[self.myDataContext.SelfDesc.Items].ItemReference = (RegleDesc)(self.MyDataContext.unRecord).CodePromotion;

--LECTURE DES REGLES CORRESPONDANTES
self.Read();

self.<PrixPublic.Montant>.RequestFocus();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.InitDisplay : End');

Return;
Exception
	When e : GenericException do
		Self.TraceExc(e,'TarificationWin.InitDisplay');
		Raise;


end method;

------------------------------------------------------------
method TarificationWin.InitListeSelectionRegle
begin
--
--	Description :  Chargement de la liste des noms de règles
--
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
--  CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.InitListeSelectionRegle');


ListeRegles : Array of ListElement = New();

if self.MyCacheRegle.Objects <> NIL then
	for aCacheDesc in self.MyCacheRegle.Objects do
		listeRegles.AppendRow(ListElement(IntegerValue = self.MyCacheRegle.Objects.FindRowForObject(aCacheDesc) , TextValue = (RegleDesc)(aCacheDesc.Record).NomRegle));
	end for;
	self.<RegleSelectionnee>.SetElementList(ListeRegles);
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.InitListeSelectionRegle : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.InitListeSelectionRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.InitListField(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer)
begin
--
--	Description : Chargement dans une ListField des données du referentiel.
--				  Equivalent de DicoTrt.InitFillInFields
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
-- CDC|
--+

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin. InitListField');

if aWidget.IsA(Type=ListField) then
	for aDesc in pBufferStructure.SelfDesc do
		if aDesc.ItemName = aWidget.Name.Value then
			if aDesc.ItemReference.Isa(Type=DicoDesc) 
			 then
				-- Read the Dico
				aTransDico : TransDico = new();
				aTransDico.TransActionService = DICO_READ;
				aTransDico.aClassType = aDesc.ItemReference.GetClassType();
				aTransDico.TypeLib = pTypeLib;
				aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
				-- Change the ListField List Elements
				if aDicoClass <> NIL then
					if aWidget.IsA(Type=ListField) then
						(ListField)(aWidget).setElementList(List=aDicoClass.ListElements);
					end if;
				else
					if aDesc.ItemReference.Isa(Type=TypBooleanNullable) and (TypBooleanNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypBooleanNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypIntegerNullable) and (TypIntegerNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypIntegerNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDateTimeNullable) and (TypDateTimeNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypDateTimeNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDoubleNullable) and (TypDoubleNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypDoubleNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypTextNullable) and (TypTextNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypTextNullable)(aDesc.ItemReference).ListValues);
						end if;
					end if;
				end if;
			end if;
		end if; 
	end for;
elseif aWidget.Isa(Type=CompoundField) then
	for aChild in (CompoundField)(aWidget).Children do
		InitListField(aChild, pBufferStructure, pTypeLib);
	end for;
end if;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin. InitListField : End');


Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.InitListfield');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.InitScrollList(input aWidget: DisplayProject.Widget,
	input NomClassDico: Framework.string,
	input ListeSelection: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 		1. Chargement des valeurs du dico pour une classe donnée : 
--							RefProduitDesc ou RefTypeServiceDesc
--						2. Affichage des valeurs présentes dans la sélection
--						
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  NomClassDico : nom de la classe du dico dont on souhaite connaître la liste des valeurs
--					ListeSelection : liste des valeurs à afficher.
--					exemple : on souhaite charger la liste des produits correspondant à un package,
--						 puis les afficherdans la scrolllist .
--					aWidget : self.<CodeProduit>
--					NomClassDico : RefTypeProduitDesc
--					ListeSelection : Liste des Codes produit our lesquels on
--						recherche les libelement dansle réferentiel et qu'on affiche ensuite
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+


Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin. InitScrollList');



-- 1. Chargement des valeurs du dico pour une classe donnée : 
--		RefProduitDesc ou RefTypeServiceDesc
MaListeElement : Array of ListElement = New();

if ListeSelection <> NIL and ListeSelection.Items > 0 then
	aTransDico : TransDico = New();
	aTransDico.TransActionService = DICO_READ;
	aTransDico.aClassType = New (Name = NomClassDico);
	aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
	
	
	--Si l'élément lu dans le réferentiel  fait  partie de la sélection, il est ajouté à la liste
	if aDicoClass <> NIL then
		for aElement in aDicoClass.ListElements do
			for UneSelection in ListeSelection do
				if aElement.IntegerValue=UneSelection.IntegerValue then
					MaListeElement.AppendRow(aElement);
				end if;
			end for;
		end for;
	end if;
	(ListField)(aWidget).setElementList(List=MaListeElement);
else 
	aElement : ListElement = New();
	aElement.TextValue.SetValue(IDX_ZONEVIDE);
	MaListeElement.AppendRow(aElement);
	(ListField)(aWidget).setElementList(List=MaListeElement);
	self.AffStatusLine('Liste Vide');
end if;



Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin. InitScrollList : End');


Return;
	
	
Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.InitScrollList');
		Raise;


end method;

------------------------------------------------------------
method TarificationWin.Read
begin
--
--	Description : le cache de la fenêtre est trié. Les prix public sont placés dans le cache standard : 
--				  StandardDataWin.MyCache	les règles dans TarificationWin.MyCacheRegle
--
--	Type :	Concret
--
--	Parametres :Aucun	
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+


Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.Read');

if not self.PremierRead then
	super.Read();
	super.AffFirstPosition();
	tmpCache : Cache = New();
	self.MyCacheRegle = New();

	if self.MyCache.Objects <> NIL then 
		for aCacheDesc in Self.MyCache.Objects do
			if (RegleDesc)(aCacheDesc.Record).PrixPublicBln.Value = TRUE then
				tmpCache.Append(aCacheDesc);
			else
				self.MyCacheRegle.Append(aCacheDesc);
			end if;		
		end for;
		self.MyCache = tmpCache;
	end if;

	self.InitListeSelectionRegle();

	self.AffFirstPositionRegle();
	<Regle>.HasDataChanged = FALSE;
	SetDataModeRegle(ACT_STD_READ);
else 
	self.PremierRead = FALSE;
end if;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.Read : End');


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.Read');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.ResetWindowRegle
begin
--
--	Description : 	Resets the fields of the window.
--					This method should be overloaded in concrete level.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.ResetWindowRegle');

DoAffRecordRegle(InitAddValues.clone(Deep=TRUE));

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.ResetWindowRegle : End');


Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.ResetWindowRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.SetDataModeRegle(input DataMode: Framework.integer)
begin
--
--	Description : 	Defines the access mode to the window (insert, update, delete, read, lock, unlock)
--					in fonction of the access type wanted.
--
--	Type :	Abstract
--
--	Parametres :	Input -->	DataMode :	Access Mode wanted.
--
--	Pre-condition : None
--
--	Post-condition : The access to the panel0 and the mode are updated
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.SetDataModeRegle');
Self.DataModeRegle = DataMode;

Case DataMode is

	When ACT_STD_APPEND do
		CurMode = 'Ajout';
		<Regle>.State = FS_UPDATE;

	When ACT_STD_UPDATE do
		if Self.FlagUpdate = TRUE then
			CurMode = 'Modification';
			<Regle>.State = FS_UPDATE;
		end if;

	When ACT_STD_DELETE do
		CurMode = 'Effacement';
		<Regle>.State = FS_VIEWONLY;

	When ACT_STD_READ do
		CurMode = 'Lecture';
		<Regle>.State = FS_VIEWONLY;

	Else do
		unExc : GenericExc = new;
		unExc.SetWithParams(severity = SP_ER_ERROR, 
			message = 'Cas non connu en SetDataMode : %1',
			param1 = IntegerData(value = DataMode));
		Raise unExc;
end case;

Self.Window.UpdateFieldFromData();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.SetDataMode : End');

Return;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.SetDataModeRegle');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.Submit
begin
--
--	Description : 	Begins the automatical actions linked to changements
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	D. NGUYEN		|	22/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.Submit');

if Panel0_HasDataChanged_Modifie then
	<Panel0>.HasDataChanged = FALSE;
	self.Panel0_HasDataChanged_Modifie = FALSE;
	self.DataMode = self.SauvegardeDataMode;
	Self.SubmitRegle();
else
	SubmitRegleOnShutDown : boolean = self.SubmitRegleOnShutDown;
	self.SubmitRegleOnShutDown = FALSE;
	Super.Submit();
	if SubmitRegleOnShutDown = TRUE then
		Self.SubmitRegle();
	end if;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.Submit : End');

Return;

Exception
	When e: GenericException do
		Self.Window.EnableInput();
		Self.TraceExc(e, 'TarificationWin.Submit');
		Raise e;
end method;

------------------------------------------------------------
method TarificationWin.SubmitRegle
begin
--
--	Description : 	Begins the automatical actions linked to changements
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage :TarificationWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.SubmitRegle');

if ViewMode = FS_UPDATE then
	case DataModeRegle is
		When ACT_STD_APPEND do
			
			AppendRegle();
			AffPositionRegle();
			<Regle>.HasDataChanged = FALSE;
			SetDataModeRegle(ACT_STD_READ);
		When ACT_STD_UPDATE do
			-- Searching for Real Update
			if <Regle>.HasDataChanged then
				UpdateRegle();
				<Regle>.HasDataChanged = FALSE;	
				SetDataModeRegle(ACT_STD_READ);
			else
				-- UnlockRequired();
				SetDataModeRegle(ACT_STD_READ);
			end if;
			AffPositionRegle();
		when ACT_STD_DELETE do
			DeleteRegle();
			<Regle>.HasDataChanged = FALSE;
			SetDataModeRegle(ACT_STD_READ);
			AffPositionRegle();
		when ACT_STD_READ do
	end case;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '-TarificationWin.SubmitRegle : End');

Return;

Exception
	When e: GenericException do
		Self.Window.EnableInput();
		Self.TraceExc(e, 'TarificationWin.SubmitRegle');
		Raise e;
end method;

------------------------------------------------------------
method TarificationWin.UpdateEvent(input aObject: Framework.Object)
begin
--
--	Description : 	Delete of an instance of the buffer on reception of a delete event.
--
--	Type :	Abstrait
--
--	Parametres :	Input -->	aObject : object to delete
--
--	Pre-condition : None
--
--	Post-condition : The object is deleted from the buffer.
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+

if aObject <> NIL then
	if (RegleDesc)((CacheDesc)(aObject).Record).PrixPublicBln.Value = TRUE then
		Super.UpdateEvent(aObject);
	else
		aCacheDesc : CacheDesc = (CacheDesc) (aObject);
		if aCacheDesc.Record.IsA(Type=Self.Bufferstructure.GetClassType()) then
			if MyCacheRegle.IsInCache(aCacheDesc.Record.Id) then
				Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.UpdateEvent');
				MyCacheRegle.Update(aCacheDesc);
				Self.InitListeSelectionRegle();
				if CurrentIdRegle = aCacheDesc.Record.Id then
					AffPositionRegle();
					AffStatusLine('Données mise à jour par un autre utilisateur...');
				end if;
			end if;
		else
		-- Traitement du composant
			TmpObj : ObjectSelfDesc = aCacheDesc.Record;
			TmpObjClass : ClassType = TmpObj.GetClassType();
			FlagMaj : Boolean = FALSE;
			For aCach in Self.MyCacheRegle.Objects do
				TmpRec : ObjectSelfDesc = aCach.Record;
				if TmpRec.SelfDesc = NIL then
					TmpRec.SelfDesc = new();
				end if;
				if TmpRec.SelfDesc.Items = 0 then
					TmpRec.DoResetSelfDesc();
				end if;
				For aInst in TmpRec.SelfDesc do
					if aInst.ItemReference.IsA(Type=TmpObjClass) then
						TmpRecObj : ObjectSelfDesc = (ObjectSelfDesc)(aInst.ItemReference);
						if TmpRecObj.Id = TmpObj.Id then
--							TmpRecObj = TmpObj;
							Self.BusinessClassMaj(TmpRecObj,TmpObj);
							if aCach.Record.Id = CurrentIdRegle then
								FlagMaj = TRUE;
							end if;
						end if;
					end if;
				end for;
				TmpRec.SelfDesc = NIL;
			end for;
			if FlagMaj then
				AffPositionRegle();
				AffStatusLine('Données mise à jour par un autre utilisateur...');
			end if;
		end if;
	end if;
end if;


Exception
	When e : GenericException do
		Self.TraceExc(e, 'TarificationWin.UpdateEvent');
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.UpdateRecordRegle(input aRecord: DataAccessSrvBD.ObjectSelfDesc)
begin
--
--	Description : 	Update of one instance of the data flow.
--
--	Type :	Abstrait
--
--	Parametres :	None
--
--	Pre-condition : None
--
--	Post-condition : The instance is updated.
--
--	Exceptions : None
--
--	Usage : TarificationaWin
--
--	Historique :
--
--	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- TarificationWin.UpdateRecordRegle');


aCacheDesc : CacheDesc = new(IdUtl=Self.SessionUser.IdUtl);
aCacheDesc.Record = aRecord;
MyTransData.TransObject = aCacheDesc;
MyTransData.TransActionService = ACT_STD_UPDATE;
aCacheDesc = (CacheDesc)(Transfer());
MyCacheRegle.Update(aCacheDesc);
Self.InitListeSelectionRegle();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.UpdateRecordRegle : End');
Return;

Exception 
	When e:DuplicateKeyExc do
		Raise;
end method;

------------------------------------------------------------
method TarificationWin.UpdateRegle
begin
--
--	Description : 	Update of the current instance of the data flow.
--
--	Type :	Abstract
--
--	Parametres :	None
--
--	Pre-condition : The Instance exists
--
--	Post-condition : The instance has been updated
--
--	Exceptions : None
--
--	Usage : TarificationWin
--
--	Historique :
--
--
--+

Go : Boolean = FALSE;
if UpdateConfirm and FlagPanel0 and IsShutdownConfirmed then
	if Self.Window.QuestionDialog(
			MessageText=Self.MSG_UPDATE_1,
			ButtonSet = BS_OKCANCEL,
			DefaultButton = BV_OK,
			WrapWidth = 25) = BV_OK then
		Go = TRUE;
	else
		Go = FALSE;
	end if;
else
	Go = TRUE;
end if;
if Go then
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- TarificationWin.UpdateRegle');
	aRecordDesc : ObjectSelfDesc = new;

	AffStatusLine('Mise à jour en cours...');
	TmpObject : Object;
	DoAffectObjectRegle(TmpObject);
	aRecordDesc = (ObjectSelfDesc)(TmpObject);
	For obj in MyCacheRegle.Objects do
		if obj.Record.id = CurrentIdRegle then
			aRecordDesc.Id = obj.Record.Id;
			aRecordDesc.DtMajQqo = obj.Record.DtMajQqo;
			aRecordDesc.IdUtlQqo = obj.Record.IdUtlQqo;
			exit;
		end if;
	End for;
	TmpMessage : TextData = new();
	TmpWarning : Warning;
	if Self.PlayValidity then
		TmpRecordSelfDesc : ObjectSelfDesc = (ObjectSelfDesc)(aRecordDesc);
		InitRecordDicoValues(TmpRecordSelfDesc, Self.DicoTypeLib);
		TmpRecordSelfDesc.DoCheckValidity();
		TmpWarning = TmpRecordSelfDesc.DoCheckWarning();
		if TmpWarning <> NIL then
			TmpMessage = TmpWarning.Message;
			TmpMessage.Concat('\n');
		end if;
	end if;
	DoBeforeUpdate();
	UpdateRecordRegle(aRecord=aRecordDesc);
	DoAfterUpdate();
	TmpMessage.Concat('Mise à jour effectuée...');
	AffStatusLine(TmpMessage);
	AffPositionRegle();
	Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 3, '- TarificationWin After Update');
else
	AffStatusLine('Mise à jour annulée...');
end if;

Return;

Exception 

	When e: RecordValidityExc do
		TmpText : TextData = new(Value=e.Message.value);
		e.Message.setValue(e.ItemName);

		uneStructureDesc : StructureDesc;
		uneStructureDesc = GetStructureDesc(BufferStructure, e.ItemName);
		if uneStructureDesc <> NIL then
			e.Message.setValue(uneStructureDesc.ItemUsername);
		end if;
		e.Message.Concat(':');
		e.Message.Concat(TmpText.value);
		Self.Window.PurgeEvents();
		Self.RequestFocusOn(ItemName=e.ItemName,aWidget=<Regle>);
--		<Panel0>.RequestFocus();
		Raise e;
	When e: GenericException do
		Self.Window.PurgeEvents();
		<Regle>.RequestFocus();
		Raise;

end method;

------------------------------------------------------------
method TarificationWin.VoireTarifPrivilege
begin
--
--	Description : Visualisation des conditions particulières. Intialisation et affichage de TarifClientWin 
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	CDC		|	
--
--+


hWin : TarifClientWin = new;
Self.MyControlWin.InitWindow(hwin);
hWin.BufferStructure = TarifClientDesc();
hWin.MyTransType = sotarificationBSMgr;
hWin.MyClassType = TarifClientBS;
hWin.FlagDelete = FALSE;
hWin.FlagAppend = FALSE;
hwin.FlagUpdate = FALSE;
hWin.FlagRead = FALSE;
hWin.window.title = 'Visualisation des Tarifs Privilege';


aTransDico : TransDico = new();
aTransDico.TypeLib = 0;
aTransDico.TransActionService = DICO_READ;
aTransDico.aClassType = RefDeviseDesc;
aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
hWin.ListeDevise = aDicoClass.ListElements;

aTransDico.aClassType = RefTypeProduitDesc;
aDicoClass = (DicoClassDesc)(DicoTransfer(aTransDico));
hWin.ListeProduit = aDicoClass.ListElements;

aTransDico.aClassType = RefTypeServiceDesc;
aDicoClass = (DicoClassDesc)(DicoTransfer(aTransDico));
hWin.ListeService = aDicoClass.ListElements;

--Initialisation des critères de sélection pour les tarifs privilèges
hwin.unTarifClientParam = New();
hwin.unTarifClientParam.DoResetAttributes();
hwin.unTarifClientParam.CodeDevise.Value = self.CodeDevise;
hwin.unTarifClientParam.CodeService.Value = self.CodeService;
hwin.unTarifClientParam.CodeProduit.Value = self.CodeProduit;

Self.MyControlWin.Display(hWin, CTW_ASYNCDISP);
self.window.Activate();

end method;

------------------------------------------------------------
event handler TarificationWin.ChangerSelectionEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre d'un changement de selection 
--						au niveau du GridGauche.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	CDC		|	
--
--+

-----------------------
-- Changement Devise : Seule la liste des promotions doit être mis à jour, puis lecure des règles 
-- si changementSelection = vrai

when self.<CodeDevise>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection();
	if ChangementSelection then
		self.ChangerListePromotion(TRUE);
	end if;
	self.AfficherSelection(ChangementSelection);
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();	

-----------------------
-- Changement Categorie : Seule la liste des promotions doit être mis à jour, puis lecture des règles 
-- si changementSelection = vrai

when self.<CodeCategorie>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection();
	if ChangementSelection then
		self.ChangerListePromotion(TRUE);
	end if;
	self.AfficherSelection(ChangementSelection);
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();

-----------------------
-- Changement Package : Les listes des produits, Services et promotions doivent être mis à jour, puis lecture des règles
-- si changementSelection = vrai

when self.<CodePackage>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection(); --Demande de sauvegarde
	if ChangementSelection then
		self.ChangementPackage();		-- recherche des produits, services et promotions correspondants
	end if;
	self.AfficherSelection(ChangementSelection); --affichage des règles répondant à ce contexte
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();

----------------------
-- Changement produit : Les listes des services et promotions doivent être mis à jour, puis lecture des règles 
-- si changementSelection = vrai

when self.<CodeProduit>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection();
	if ChangementSelection then
		self.ChangementProduit();
	end if;
	self.AfficherSelection(ChangementSelection);
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();

---------------------
-- Changement Service: La liste des promotions doit  être mis à jour, puis lecture des règles 
-- si changementSelection = vrai	

when self.<CodeService>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection();
	if ChangementSelection then
		self.ChangementService();
	end if;
	self.AfficherSelection(ChangementSelection);
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();
	
----------------------
-- Changement Promotion: Lecture des règles si ChangementSelection = vrai

when self.<CodePromotion>.AfterValueChange() do
	self.window.DisableInput();
	self.window.DisplayState = DS_HIDDEN;
	ChangementSelection : boolean = self.ChangerSelection();
	self.AfficherSelection(ChangementSelection);	
	self.window.DisplayState = DS_NORMAL;
	self.window.EnableInput();

	

	

end event;

------------------------------------------------------------
event handler TarificationWin.DefaultRegleEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre du traitement par défaut du Grid self.<Regle>,
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--


when <Regle>.AfterFocusGain do
Begin
	Self.Window.DisableInput();
	if ViewMode = FS_UPDATE and not <Regle>.HasDataChanged then
		<Regle>.HasDataChanged = FALSE;
		if DataModeRegle <> ACT_STD_APPEND and MyCacheRegle.Objects.Items > 0 then
			SetDataModeRegle(ACT_STD_UPDATE);
		elseif DataModeRegle = ACT_STD_READ and MyCacheRegle.Objects.Items = 0 and FlagAppend then
			AddRegle();
		end if;
	end if;
	Self.Window.EnableInput();
	Exception 
		When e : GenericException do
			Self.Window.EnableInput();
			TmpMsg : TextData = new;
			TmpMsg.Setvalue(e.Message);
			TmpMsg.Concat(' - Severity : ');
			TmpMsg.Concat(e.Severity);
			AffStatusLine(TmpMsg);
End;

when <Regle>.BeforeFocusLoss do
if FlagPanel0 then
	Begin
		Self.Window.DisableInput();
		Self.SubmitRegle();
		Self.Window.EnableInput();
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
	End;
end if;
end event;

------------------------------------------------------------
event handler TarificationWin.DeplacementPrixPublicEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre des boutons Suivant et Précédent relatifs au prix public.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+
	
when self.<PrecedentPrixPublicBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
	post self.<PrecedentBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;

when self.<SuivantPrixPublicBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
	post self.<SuivantBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;
	
end event;

------------------------------------------------------------
event handler TarificationWin.DeplacementRegleEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre d'une selection dans la liste des noms de règles.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+

when self.<RegleSelectionnee>.AfterValueChange() do
Begin
	Go : Boolean = FALSE;
	Rep : Integer;
	if not FlagPanel0 then		
		if Self.<Regle>.HasDatachanged then
			Rep = Self.Window.Questiondialog(Self.MSG_SELECT_3, BS_YESNOCANCEL, BV_CANCEL);
			if Rep <> BV_CANCEL then
				Go = TRUE;
			end if;
			if Rep = BV_NO then
				Self.<Regle>.HasDataChanged = FALSE;
				SetDataModeRegle(ACT_STD_READ);
			end if;
		else
			Go = TRUE;
		end if;
	else
		Go = TRUE;
	end if;		
		
	if ((Rep = BV_YES) and not FlagPanel0) or FlagPanel0 then
		Self.Window.DisableInput();
		Self.SubmitRegle();
		Self.Window.EnableInput();
	end if;
	if go then
		CurrentPositionRegle = self.RegleSelectionnee;
		self.AffPositionRegle();
		<Regle>.HasDataChanged = FALSE;
		SetDataModeRegle(ACT_STD_READ);
		AffStatusLine('');
	end if;
	
Exception 
	When e : GenericException do
		Self.Window.EnableInput();
		TmpMsg : TextData = new;
		TmpMsg.Setvalue(e.Message);
		TmpMsg.Concat(' - Severity : ');
		TmpMsg.Concat(e.Severity);
		AffStatusLine(TmpMsg);
End;
end event;

------------------------------------------------------------
event handler TarificationWin.EventLoopHandler()
begin
--
--	Description :	Localisation des abonnements spécifiques à l'utilisateur.
--					Remarque : il est indispensable de s'abonner à l'EventLoopHandler de la super-classe. 	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--


Register Super.EventLoopHandler();

--unDetailParam : DetailAffParamDesc;
--unDetailParam = new(uneDetailWin=TarifClientWin, AffMode=CTW_ASYNCDISP);
Register self.BriqueEvh(self.<GridEcran>,'Controle',TRUE,ACT_TARIF_MISEENPRODUCTION,NIL);



Register self.ChangerSelectionEvh();
Register self.StrategieSelectionEvh();

Register self.DeplacementPrixPublicEvh();
Register self.StandardOutilsPrixPublicEvh();

Register self.DefaultRegleEvh();
Register self.DeplacementRegleEvh();
Register self.StandardOutilsRegleEvh();

Register self.VoireTarifPrivilegeEvh();

Register self.ChangerSelectionEvh();

Register self.UnSeulPrixPublicEvh();
Register self.MiseEnProductionEvh();

self.QuitterBtnEventRegistration = Register self.QuitterBtnEvh();
end event;

------------------------------------------------------------
event handler TarificationWin.MiseEnProductionEvh()
begin
when <MiseEnProd>.Click do
	aTransdata : TransDesc = New();
	aTransData.TransActionService = ACT_TARIF_MISEENPRODUCTION;
	aTransData.TransObject = NIL;
	TmpMsg : TextData  = (TextData)(self.transfer(aTransData,soRegleBSMgr,RegleProc));
	if TmpMsg <> NIL then
		AffStatusLine(TmpMsg);
	end if;
end event;

------------------------------------------------------------
event handler TarificationWin.QuitterBtnEvh()
begin
--
--	Description : 	Evènements à traiter lorsque l'utilisateur quitte la fenêtre.
--					La redéfinition de StandardDataWin.Quitter() est interdite car 
--					elle contient des attributs privés. Cependant, nous avons besoin de procéder 
--					à certains traitements avant que cette méthode ne soit exécuter. 
--					Ces traitements sefforcent de contourner encore une fois létat du Panel0, 
--					le mode de la fenêtre et bien évidemment vu le contexte à affecter
--					correctement lattribut SubmitRegleOnShutdown. 
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--
--	CDC		|	
--
--+
	
	when Self.<QuitterBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
		if self.<Regle>.HasDataChanged then
			self.SubmitRegleOnShutDown = TRUE;
			if not Self.<Panel0>.HasDataChanged then
				self.Panel0_HasDataChanged_Modifie = TRUE;
				Self.<Panel0>.HasDataChanged = TRUE;
				if self.DataMode <> ACT_STD_UPDATE and self.DataMode <> ACT_STD_APPEND then
					self.SauvegardeDataMode = self.DataMode;
					self.DataMode = ACT_STD_UPDATE;
				end if;
			else
				self.Panel0_HasDataChanged_Modifie = FALSE;
			end if;
		else
			self.SubmitRegleOnShutDown = FALSE;
			self.Panel0_HasDataChanged_Modifie = FALSE;
		end if;
		
		
-- Nous nous sommes abonné dans l'EventLoopHandler() à QuitterBtnEventRegistration afin que les traitements 
-- précédents puissent être effectués. L'évenement correspondant au click du bouton "Quitter" de la StandardDataWin
-- étant capté en amont, nous avons dû créer une nouvel évenement qui suite à des traitements particuliers réactive 
-- le click du bouton Quitter.
-- et nous nous « réabonnnons » à lévenement de la fenêtre mère.
		self.QuitterBtnEventRegistration.DeregisterHandler();
		Post Self.<QuitterBtn>.Click(eventInfo, x, y, modifier, node, row, column);
end event;

------------------------------------------------------------
event handler TarificationWin.StandardOutilsPrixPublicEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la barre d'outils relatives au prix public.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+
	
	when self.<ValiderPrixPublicBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
		post self.<SauverBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;
		<PrixPublic.montant>.RequestFocus();
	
	when self.<NouveauBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
		post self.<AjouterBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;
		<PrixPublic.montant>.RequestFocus();
	
	when self.<SupprimerPrixPublicBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do
		post self.<SupprimerBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;
		<PrixPublic.montant>.RequestFocus();
	
end event;

------------------------------------------------------------
event handler TarificationWin.StandardOutilsRegleEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la barre d'outils relative à la règle spéciifique.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : StandardDataWin
--
--	Historique :
--

--+
	


when <ValiderRegleBtn>.Click do
if not FlagPanel0 then
	if Self.<Regle>.HasDataChanged then
		Begin
			Go : Boolean = FALSE;
			Rep : Integer;
			if Self.ValidateConfirm then
			Rep = Self.Window.QuestionDialog(Self.MSG_SAVE_2, BS_YESNO, BV_YES);
				if Rep = BV_YES then
					Go = TRUE;
				end if;
			else
				Go = TRUE;
			end if;
			if Go then
				Self.Window.DisableInput();
				Self.SubmitRegle();
				Self.Window.EnableInput();
			end if;
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
		End;
	end if;
	<Regle.NomRegle>.RequestFocus();
end if;

when <NouvelleRegleBtn>.Click do
if Self.FlagAppend then
	Begin
		Go : Boolean = FALSE;
		if not FlagPanel0 then
			Rep : Integer;
			if Self.<Regle>.HasDataChanged then
				Rep = Self.Window.QuestionDialog(Self.MSG_ADD_3, BS_YESNOCANCEL, BV_YES);
				if Rep = BV_YES then
					Go = TRUE;
					Self.Window.DisableInput();
					Self.SubmitRegle();
					Self.Window.EnableInput();
				elseif Rep = BV_Cancel then
					Go = FALSE;
				elseif Rep = BV_No then
					Go = TRUE;
					Self.<Regle>.HasDataChanged = FALSE;
				end if;
			else
				Rep = Self.Window.QuestionDialog(Self.MSG_ADD_2, BS_YESNO, BV_YES);
				if Rep = BV_YES then
					Go = TRUE;
				end if;
			end if;
		end if;
		if FlagPanel0 or (not FlagPanel0 and Go) then
			Self.Window.DisableInput();
			AddRegle(AddPolicy);
			Self.Window.EnableInput();
		end if;
		Exception 
			When e : GenericException do
				Self.Window.EnableInput();
				TmpMsg : TextData = new;
				TmpMsg.Setvalue(e.Message);
				TmpMsg.Concat(' - Severity : ');
				TmpMsg.Concat(e.Severity);
				AffStatusLine(TmpMsg);
	End;
	<Regle.NomRegle>.RequestFocus();
End if; -- FlagAppend

when <SupprimerRegleBtn>.Click do 
if Self.FlagDelete then
	Begin
		Go : Boolean = FALSE;
		if not FlagPanel0 then
			Rep : Integer;
			if Self.<Regle>.HasDatachanged then
				Rep = Self.Window.QuestionDialog(Self.MSG_DELETE_3, BS_YESNOCANCEL, BV_Cancel);
				if Rep = BV_YES then
					Go = TRUE;
				elseif Rep = BV_Cancel then
					Go = FALSE;
				elseif Rep = BV_No then
					Go = TRUE;
					Self.<Regle>.HasDataChanged = FALSE;
				end if;
			else
				Rep = Self.Window.QuestionDialog(Self.MSG_DELETE_2, BS_YESNO, BV_YES);
				if Rep = BV_YES then
					Go = TRUE;
				end if;
			end if;
		end if;
		if FlagPanel0 or (not FlagPanel0 and Go) then
			Self.Window.DisableInput();
			SetDataModeRegle(ACT_STD_DELETE);
			SubmitRegle();
			Self.Window.EnableInput();
		end if;
	Exception 
		When e : GenericException do
			Self.Window.EnableInput();
			TmpMsg : TextData = new;
			TmpMsg.Setvalue(e.Message);
			TmpMsg.Concat(' - Severity : ');
			TmpMsg.Concat(e.Severity);
			AffStatusLine(TmpMsg);
	End;
	<Regle.NomRegle>.RequestFocus();
end if;
	
end event;

------------------------------------------------------------
event handler TarificationWin.StrategieSelectionEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre d'un changement stratégie. Ce changement devant être prise 
-- 						en compte au niveau du prix public, il est nécessaire de modifier l'état du panel0 et passer
--						en mode Update.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	CDC		|	
--
--+

when self.<CodeStrategie>.AfterValueChange() do
	SetDataMode(ACT_STD_UPDATE);
	self.<Panel0>.HasDataChanged = TRUE ;
	

end event;

------------------------------------------------------------
event handler TarificationWin.UnSeulPrixPublicEvh()
begin
when <UnSeulPrixPublic>.Click do
	aTransdata : TransDesc = New();
	UneRegleParam : RegleParam = New();
	uneRegleParam.CodeDevise = RefDeviseDesc(Value=self.CodeDevise);
	uneRegleParam.CodeCategorie = RefTarifDesc(Value=self.CodeCategorie);
	uneRegleParam.CodePackage  = RefTypePackageDesc(Value=self.CodePackage);
	uneRegleParam.CodeProduit  = RefTypeProduitDesc(Value=self.CodeProduit);
	uneRegleParam.CodeService  = RefTypeServiceDesc(Value=self.CodeService);
	uneRegleParam.CodePromotion = RefTypePromotionDesc(Value=self.CodePromotion);
	aTransData.TransActionService = ACT_TARIF_UNSEULPRIXPUBLIC;
	aTransData.TransObject = uneRegleParam;
	TmpMsg : TextData = (TextData)(self.transfer(aTransData,soRegleBSMgr,RegleProc));
	if TmpMsg <> NIL then
		AffStatusLine(TmpMsg);
	end if;
end event;

------------------------------------------------------------
event handler TarificationWin.VoireTarifPrivilegeEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la visualisation des conditions particulières
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	CDC		|	
--
--+

when self.<ConditionBtn>.Click do
	self.VoireTarifPrivilege();
end event;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'tarifica';
	StartingMethod = (class = InitApp, method = SyncServices);


end TarificationClt;
begin TOOL WasteSpace;

includes AddDicoBD;
includes AddFrameworkBD;
includes BatchTarifSrv;
includes CatalogueSrv;
includes CompilateurClasses;
includes ContexteClt;
includes ContexteSrv;
includes ContexteTarificat;
includes DataAccessBD;
includes DataAccessSrvBD;
includes DataStructuresClasses;
includes ExpressionClasses;
includes FrameworkBD;
includes MoteurTarifSrv;
includes ParserClasses;
includes ParserErrors;
includes ParserExpression;
includes GenericDBMS;
includes DisplayProject;
includes Framework;
includes TarificationProc;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  BatchTarifTest;
forward  CleCompteBD;
forward  MoteurBS;
forward  MoteurBSTest;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant LOG_GRPFLAG = 67;
constant TABLE_REGLES = 'Regles';
constant TEST_NUMBER = 1;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class BatchTarifTest inherits from BatchTarifSrv.BatchTarification

has public  constant CAT_COL = 3;
has public  constant CAT_STD = 1;
has public  constant CAT_VIP = 2;
has public  constant HPK = 1;
has public  constant HPR = 1;
has public  constant MAX_RG_CAT = 3;
has public  constant MAX_RG_COND = 2;
has public  constant MAX_RG_DEV = 2;
has public  constant MAX_RG_EVAL = 2;
has public  constant MAX_RG_OPER = 2;
has public  constant MAX_RG_PACK = 1;
has public  constant MAX_RG_PRIV = 2;
has public  constant MAX_RG_PROD = 2;
has public  constant MAX_RG_PROM = 2;
has public  constant PK1 = 2;
has public  constant PR1 = 2;

has public  attribute CompteurEval: Framework.integer;
has public  attribute unGenerateur: Framework.RandomNumber;

has public  method CreerEvenementTest2(input NumClient: Framework.integer,
	input output Liste: Framework.Array of TarificationSrv.EvenementTarificationDesc,
	input Categorie: Framework.integer,
	input Package: Framework.integer,
	input Promotion: Framework.integer);
has public  method EvalueCRE(input unCre: TarificationSrv.EvenementTarificationDesc): Framework.integer;
has public  method GenererLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable;
has public  method Init;
has public  method InitialiseTest;
has public  method PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long);
has public  method PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData);
has public  method StartBatch;
has public  method Test;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class CleCompteBD inherits from DataStructuresClasses.UnaryFunction

has public  constant A1 = 9;
has public  constant A2 = 9;
has public  constant A3 = 8;

has public  method Execute(input Value: Framework.Object): Framework.Object;
has public  method Init;

has property
	shared=(allow=off, override=on);
	transactional=(allow=off, override=on);
	monitored=(allow=off, override=on);
	distributed=(allow=off, override=on);

end class;

class MoteurBS inherits from DataAccessSrvBD.ServiceDesc

has public  constant TARIF_NORMAL = 'Tarif_Normal';

has public  attribute Arbre: MoteurTarifSrv.Noeud;
has public  attribute AttributionTypeDecimal: Framework.integer;
has public  attribute CompteurEval: Framework.integer;
has public  attribute CT: ContexteTarificat.ContexteTarification;
has public  attribute DateReference: Framework.DateTimeData;
has public  attribute GoCompile: Framework.boolean;
has public  attribute NombreCompilees: Framework.integer;
has public  attribute NombreExpl: Framework.integer;
has public  attribute NombreListes: Framework.integer;
has public  attribute NombreNoeudsFin: Framework.integer;
has public  attribute NombreNoeudsInt: Framework.integer;
has public  attribute NombrePrivCrees: Framework.integer;
has public  attribute NombreRegles: Framework.integer;
has public  attribute NombreServInseres: Framework.integer;
has public  attribute unCompilateur: CompilateurClasses.Compilateur;

has public  method Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method AnomalieEvaluation(input Source: Framework.string,
	input Descr: Framework.string);
has public  method AnomalieTarification(input Source: Framework.string,
	input Descr: Framework.string);
has public  method CalculerChemin(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method CalculerChemin(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method CompileCategoriesEtPrivileges(input leService: MoteurTarifSrv.NoeudServices);
has public  method CompilePackages(input lesPackages: Framework.Array of MoteurTarifSrv.Noeud,
	input PrixPublicCatStandard: Framework.string);
has public  method CompilePromotions(input lesPromotions: Framework.Array of MoteurTarifSrv.Noeud,
	input PrixPublicHorsPackage: Framework.string);
has public  method CompilerArbre;
has public  method CompilerUneRegle(input uneRegle: MoteurTarifSrv.Regle);
has public  method ConstruireArbre(input lesRegles: Framework.Array of TarificationSrv.RegleDesc,
	input lesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudIntermediaire;
has public  method ConstruireBranchePrivilege(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method ConstruireBrancheRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData);
has public  method DeterminerPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle,
	input LeTarifNormal: Framework.string,
	input ErreurSiTarifNormal: Framework.boolean = FALSE): Framework.string;
has public  method DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object;
has public  method DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc;
has public  method DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc;
has public  method Evalue: Framework.NumericData;
has public  method EvalueCRE(input unCre: TarificationSrv.EvenementTarificationDesc): Framework.NumericData;
has public  method EvaluerMaxiApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvaluerMiniApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvaluerPremierApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData;
has public  method EvalueTarifPrivilege(input leService: MoteurTarifSrv.NoeudServices): Framework.NumericData;
has public  method Init;
has public  method Initialise(input unContexte: ContexteClt.Contexte,
	input GoCompile: Framework.boolean);
has public  method PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long);
has public  method PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData);
has public  method TrouverCheminPrivileges(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudServices;
has public  method TrouverCheminRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudPorteurDeRegles;
has public  method TrouverListeRegles(input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData,
	input output BreakCode: Framework.integer): Framework.Array of MoteurTarifSrv.Regle;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;

class MoteurBSTest inherits from MoteurTarifSrv.MoteurBS

has public  constant CAT_COL = 3;
has public  constant CAT_STD = 1;
has public  constant CAT_VIP = 2;
has public  constant HPK = 1;
has public  constant HPR = 1;
has public  constant MAX_RG_CAT = 3;
has public  constant MAX_RG_COND = 2;
has public  constant MAX_RG_DEV = 2;
has public  constant MAX_RG_EVAL = 2;
has public  constant MAX_RG_OPER = 2;
has public  constant MAX_RG_PACK = 1;
has public  constant MAX_RG_PRIV = 2;
has public  constant MAX_RG_PROD = 2;
has public  constant MAX_RG_PROM = 1;
has public  constant PK1 = 2;
has public  constant PR1 = 2;

has public  attribute unGenerateur: Framework.RandomNumber;

has public  method CreerEvenementTest2(input NumClient: Framework.integer,
	input output Liste: Framework.Array of TarificationSrv.EvenementTarificationDesc,
	input Categorie: Framework.integer,
	input Package: Framework.integer,
	input Promotion: Framework.integer);
has public  method CreerRegle(input Cat: Framework.integer,
	input Promo: Framework.integer,
	input Pack: Framework.integer,
	input Eval: Framework.string,
	input PP: Framework.boolean = TRUE): TarificationSrv.RegleDesc;
has public  method DoAfterSyncServices;
has public  method DoInitService;
has public  method DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc;
has public  method DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc;
has public  method GenererLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc;
has public  method GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable;
has public  method GenererNumeroClient: Framework.TextData;
has public  method Init;
has public  method InitialiseTest;
has public  method Test;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=on, default=off);

end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method BatchTarifTest.CreerEvenementTest2(input NumClient: Framework.integer,
	input output Liste: Framework.Array of TarificationSrv.EvenementTarificationDesc,
	input Categorie: Framework.integer,
	input Package: Framework.integer,
	input Promotion: Framework.integer)
begin
	unEvTarif : EvenementTarificationDesc = new();

	-- Partie commune à chaque 
	unEvTarif.NumClient.SetValue(NumClient);
	unEvTarif.CodeDevise.SetValue(1);
	unEvTarif.CodeProduit.SetValue(1);
	unEvTarif.CodeService.SetValue(1);

	-- Partie variante
	unEvTarif.CodePackage.SetValue(Package);
	unEvTarif.CodePromotion.SetValue(Promotion);
	unEvTarif.CodeCategorie.setValue(Categorie);
	Liste.AppendRow(unEvTarif);

end method;

------------------------------------------------------------
method BatchTarifTest.EvalueCRE(input unCre: TarificationSrv.EvenementTarificationDesc): Framework.integer
begin
aTransData : TransDesc = new();
aTransData.TransActionService = ACT_TARIF_EVALUE;
aTransData.TransObject = unCre;
unNumericData : NumericData = (NumericData) (self.Transfer(aTransData,soMoteurBSMgr,MoteurBS));
aTransData = NIL; -- Pour éviter les fuites de mémoire
return 0;
end method;

------------------------------------------------------------
method BatchTarifTest.GenererLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
ListeEvTarif : array of EvenementTarificationDesc = new();
unEvTarif    : EvenementTarificationDesc;

if unGenerateur = NIL then
   unGenerateur = new(); -- Seed positionné automatiquement
end if;

if TEST_NUMBER = 1 then

	for i in 1 to 100 do -- Test aléatoire
	
		unEvTarif = new();
		unEvTarif.NumClient.SetValue(i);
		unEvTarif.CodeService.SetValue(GenererNombre(MAX_RG_OPER));
		unEvTarif.CodeProduit.SetValue(GenererNombre(MAX_RG_PROD));
		unEvTarif.CodePackage.SetValue(GenererNombre(MAX_RG_PACK));
		unEvTarif.CodePromotion.SetValue(GenererNombre(MAX_RG_PROM));
		unEvTarif.CodeDevise.SetValue(GenererNombre(MAX_RG_DEV));
		unEvTarif.CodeCategorie.setValue(GenererNombre(MAX_RG_CAT));
	    ListeEvTarif.AppendRow(unEvTarif);
	    
	end for;

else -- Test des capacités de réduction du tarif normal

    for i in 1 to 5 do

		-- Catégorie Standard
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,HPK,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,HPK,PR1); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,PK1,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,PK1,PR1); 
	
		-- Catégorie VIP
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,HPK,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,HPK,PR1); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,PK1,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,PK1,PR1); 

	end for;

end if;

return ListeEvTarif;


end method;

------------------------------------------------------------
method BatchTarifTest.GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable
begin
-- Génération d'un nombre aléatoire entre 1 et MaxRange
unEntier : IntegerNullable = new();
unEntier.SetValue(unGenerateur.Get());
unEntier.Mod(unEntier.Value,MaxRange);
unEntier.Value = unEntier.Value + 1;
return unEntier;
end method;

------------------------------------------------------------
method BatchTarifTest.Init
begin
super.Init();
end method;

------------------------------------------------------------
method BatchTarifTest.InitialiseTest
begin
	-- Initialisation du service objet
	-- Lecture des règles
	-- Construction de l'arbre

	unGenerateur = new();
	unGenerateur.SetSeed(9321765408); -- Pour avoir toujours le même jeu de test
	
Task.Part.LogMgr.PutLine('INIT0 : INITIALISATION MEMOIRE DES TABLES (=DEBUT DU TRAITEMENT)');


/*
    UnContexte : Contexte;
--	unContexte = ContexteTarification();						  -- si NIL, contexte = variables initialisées pour le test	
	unCompilateur = new(Contexte=unContexte); -- Création d'une instance du compilateur avec liée à un contexte
	


Initialise(unContexte);
*/
Test();

return;

Exception
   when e : GenericException do
	   Task.Part.LogMgr.PutLine('EXCEPTION LEVEE, ABANDON TEST...');
       Self.TraceExc(e,'MoteurBS.Initialise');
       raise;
       
end method;

------------------------------------------------------------
method BatchTarifTest.PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long)
begin
--
--	Description : 	Affichage d'un nombre de ticks d'horloge (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(NumberTicks)');

unMessage.Concat(' ');
unMessage.Concat(NumberTicks);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(NumberTicks) : End');

end method;

------------------------------------------------------------
method BatchTarifTest.PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData)
begin
--
--	Description : 	Affichage d'un message (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(TextData)');

unMessage.Concat(' ');
unMessage.Concat(unCompl);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(TextData)');

end method;

------------------------------------------------------------
method BatchTarifTest.StartBatch
begin
super.StartBatch();
Test();

end method;

------------------------------------------------------------
method BatchTarifTest.Test
begin
-- self.EvalueCre(unCre);
--Task.Part.LogMgr.PutLine(unNumericData.TextValue);

-- Lancement du test du moteur de tarification

Task.Part.LogMgr.PutLine('');
Task.Part.LogMgr.PutLine('INIT/INITIALISATION MAINTENANT TERMINEE, DEBUT DU TEST');
Task.Part.LogMgr.PutLine('TRT/GENERATION DES CRE');
Task.Part.LogMgr.PutLine('');

lesEvenements : array of EvenementTarificationDesc = GenererLesEvenements();
unTarif : NumericData;

Task.Part.LogMgr.PutLine('TRT/EVALUATION DES CRE');

ChronoEval : Chronometre = new();
ChronoEval.Fire();

if TEST_NUMBER = 1 then
	for i in 1 to 50 do
		for unEvt in lesEvenements do
--	        unTarif = EvalueCRE(unEvt);
		end for;
	    if unTarif<>NIL then
	       Task.Part.LogMgr.Put(unTarif);
	       Task.Part.LogMgr.Put(' ');
		else
		   Task.Part.LogMgr.PutLine('Impossible de calculer un tarif');
	    end if;
	end for;
else
		Diviseur : integer = 0;
		
		for unEvt in lesEvenements do
--	        unTarif = EvalueCRE(unEvt);
			if Diviseur = 8 then 
				Task.Part.LogMgr.PutLine('');
				Diviseur = 0;
			end if;
			Diviseur = Diviseur + 1;
		     if unTarif<>NIL then
		       Task.Part.LogMgr.Put(unTarif);
		       Task.Part.LogMgr.Put(' ');
			else
			   Task.Part.LogMgr.PutLine('Impossible de calculer un tarif');
		    end if;
		end for;
end if;

PutMessage('Temps total d''evaluation : ',ChronoEval.AsText());
PutMessage('Nombre de règles evaluees : ',CompteurEval);
Task.Part.LogMgr.PutLine('TRT FIN');

end method;

------------------------------------------------------------
method CleCompteBD.Execute(input Value: Framework.Object): Framework.Object
begin
C     : array of IntegerData = new();
Total : integer;
Res	  : IntegerData;
X	  : integer;
Z 	  : integer;
K	  : IntegerData;

NCSansCle : TextData = new();
/*
if     Value.IsA(TextData) then
        NCSansCle.SetValue((TextData) (Value));
elseif Value.IsA(IntegerData) then
        NCSansCle.SetValue((IntegerData) (Value).TextValue);
else
	   Exc : GenericExc = new();
	   Exc.SetWithParams(SP_ER_ERROR,'Le numéro de compte doit être de type IntegerData ou TextData');
	   raise Exc;
end if;

-- Extraction des chiffres du code client
for i in 1 to 7 do 
  C[i] = new(TextValue = NCSansCle.CopyRange(i-1,i));
end for;

Total = 9*A1+8*A2+7*A3+6*C[1].Value+5*C[2].Value+4*C[3].Value+3*C[4].Value+2*C[5].Value;
Res   = new();
Res.Mod(Total, 11);

if Res.Value=0 or Res.Value=1 
then X = Res.Value;
else X = 11 - Res.Value;
end if;

Z = X - C[6].Value;
if Z < 0 then Z = Z * -1;

K = new(Value = Z + C[7].Value);
if K.Value>=10 then
   BK : IntegerData = K.Clone(Deep = TRUE);
   K.SetValue(K.Value / 10  + BK.Mod(BK.Value,10).Value);   
end if;

NCSansCle.Concat(K.TextValue);
*/

return NCSansCle;

end method;

------------------------------------------------------------
method CleCompteBD.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MoteurBS.Action(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description : 	Méthode Action destinée à router les évaluations
--
--	Type :	Concret
--
--	Parametres :	Input		--> aTransdata :	Communication structure.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucun
--
--	Usage : 
--
--	Historique :
--
--	PMT			|	06/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Action');

-- Declarations

aResult : Object;

	Case aTransData.TransActionService is

		when ACT_TARIF_EVALUE do		 -- Evaluation d'un événement de tarification
			
			aResult = self.EvalueCre((EvenementTarificationDesc) (aTransData.TransObject));

      	else do -- Traitement des autres cas
		
--			aResult = DoAction(aTransData, aTransOrigin);
			aResult = NIL;
			AnomalieTarification('Action','Code action incorrect');
	end case;
	

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Action : End');

Return aResult;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'MoteurBS.Action');
		Raise;
end method;

------------------------------------------------------------
method MoteurBS.AnomalieEvaluation(input Source: Framework.string,
	input Descr: Framework.string)
begin
--
--	Description : Levée d'une exception spécifique au moteur de tarification
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : AnomalieTarificationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	18/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.AnomalieEvaluation');

unMessage : TextData = new();
unMessage.SetValue('Erreur fatale : ');
unMessage.Concat(Source);
unMessage.Concat(' - ');
unMessage.Concat(Descr);

uneAnomalie : AnomalieEvaluationExc = new();
uneAnomalie.SetWithParams(SP_ER_ERROR,unMessage.Value);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.AnomalieEvaluation : End (Levée d''une anomalie) ');

raise uneAnomalie;

end method;

------------------------------------------------------------
method MoteurBS.AnomalieTarification(input Source: Framework.string,
	input Descr: Framework.string)
begin
--
--	Description : Levée d'une exception spécifique au moteur de tarification
--
--	Type :	concret
--
--	Parametres :   Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : AnomalieTarificationExc
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.AnomalieTarification');

unMessage : TextData = new();
unMessage.SetValue('Erreur fatale : ');
unMessage.Concat(Source);
unMessage.Concat(' - ');
unMessage.Concat(Descr);

uneAnomalie : AnomalieTarificationExc = new();
uneAnomalie.SetWithParams(SP_ER_ERROR,unMessage.Value);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.AnomalieTarification : End (Levée d''une anomalie) ');

raise uneAnomalie;

end method;

------------------------------------------------------------
method MoteurBS.CalculerChemin(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Calcul du chemin d'accès à un noeud (Version RegleDesc)
-- 				  	Le chemin d'accès représente la branche de l'arbre que l'on doit
--				  	atteindre pour obtenir la liste de règles correspondant au RegleDesc
--
--				  	Les indices du tableau représente les niveaux de l'arbre
--				  	Les entiers stockés dans le tableau représente le rang du noeud fils dans le tableau Children
--	
--
--	Type :	concret
--
--	Parametres :    unRegleDesc   : Le RegleDesc pour lequel on va calculer le chemin d'accès (= branche de l'arbre)
--					unChemin	  : Le tableau d'entiers dans lequel on renvoie le chemin d'accès
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CalculerChemin(RegleDesc)');


unChemin.Clear();
unChemin.AppendRow(unRegleDesc.CodeDevise);
unChemin.AppendRow(unRegleDesc.CodeProduit);
unChemin.AppendRow(unRegleDesc.CodeService);
unChemin.AppendRow(unRegleDesc.CodeCategorie);
unChemin.AppendRow(unRegleDesc.CodePackage);
unChemin.AppendRow(unRegleDesc.CodePromotion);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CalculerChemin(RegleDesc) : End');

end method;

------------------------------------------------------------
method MoteurBS.CalculerChemin(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Calcul du chemin d'accès à un noeud (Version TarifClientDesc)
-- 				  	Le chemin d'accès représente la branche de l'arbre que l'on doit
--				  	atteindre pour obtenir la liste de règles correspondant au RegleDesc
--
--				  	Les indices du tableau représente les niveaux de l'arbre
--				  	Les entiers stockés dans le tableau représente le rang du noeud fils dans le tableau Children
--	
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le TarifClientDesc pour lequel on va calculer le chemin d'accès (= branche de l'arbre)
--					unChemin	  : Le tableau d'entiers dans lequel on renvoie le chemin d'accès
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CalculerChemin(TarifClientDesc)');

unChemin.Clear();
unChemin.AppendRow(unTarifClient.CodeDevise);
unChemin.AppendRow(unTarifClient.CodeProduit);
unChemin.AppendRow(unTarifClient.CodeService);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CalculerChemin(TarifClientDesc) : End');

end method;

------------------------------------------------------------
method MoteurBS.CompileCategoriesEtPrivileges(input leService: MoteurTarifSrv.NoeudServices)
begin
--
--	Description : 	Lancement pour chaque catégorie client de la compilation des packages 
--
--	Détermination au préalable de la liste de règles hors catégorie (=Catégorie standard), 
--	hors package et hors promotion
--
--
--	Type :	concret
--
--	Parametres :    leService : Sous-arbre à compiler
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompileCategoriesEtPrivileges');

PrixPublicCategorieStandard : string;
unType						: integer;

-- Exploration de la branche "Prix public"
CategorieStandard       : NoeudIntermediaire   = (NoeudIntermediaire)   (leService          . Children[IDX_CATEGORIE_STANDARD]);
HorsPackages 		    : NoeudIntermediaire   = (NoeudIntermediaire)   (CategorieStandard  . Children[IDX_HORS_PACKAGE]);
HorsPromotions          : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (HorsPackages       . Children[IDX_HORS_PROMOTION]);
PrixPublicHorsContexte  : array of Regle       = HorsPromotions.LesRegles;

-- Détermination de la chaîne PrixPublic 
if PrixPublicHorsContexte = NIL then
   AnomalieTarification('CompileCategoriesEtPrivileges','Attention : Une liste de regles à nil');	
else
	-- Détermination du prix public de la catégorie standard
	PrixPublicCategorieStandard = DeterminerPrixPublic(PrixPublicHorsContexte,'',TRUE);

	-- Parcours de toutes les catégories et compilation des sous-arbres correspondants
	-- en passant en paramètre le prix public "CategorieStandard"
	
	for uneCategorie in leService.Children do -- Pour toutes les catégories
		CompilePackages((NoeudIntermediaire) (uneCategorie).Children,PrixPublicCategorieStandard);
	end for;

	-- Récupération de la liste des privilèges associés aux noeud leService
	lesPrivileges : array of Privilege = (array of Privilege) (leService.Privileges.FillArray());
	for unPrivilege in lesPrivileges do
	
		-- Validation : On ne veut pas avoir de référence sur le tarif_normal dans un tarif privilège
		if unCompilateur.DoesExpand(srcString=unPrivilege.EvalString,WithItem=TARIF_NORMAL) then
		   AnomalieTarification('CompileCategoriesEtPrivileges','Un tarif privilege ne doit pas contenir une occurrence de tarif normal');	
		end if;
		
		-- Compilation effective du tarif privilège
 		unPrivilege.Eval = unCompilateur.Compile(unPrivilege.EvalString.Value);

		-- Validation : contrôle de type
		unType = unPrivilege.Eval.VerifieType(); -- pré-allocation des variables temporaires
		if unType <> AttributionTypeDecimal then
		   AnomalieTarification('CompileCategoriesEtPrivileges','Un tarif privilege est mal type');	
		end if;		
		
		-- Pour libérer la référence
		unPrivilege.EvalString = NIL; 

		NombreCompilees = NombreCompilees + 1;  -- DEBUG
	end for;
	
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompileCategoriesEtPrivileges : End');


end method;

------------------------------------------------------------
method MoteurBS.CompilePackages(input lesPackages: Framework.Array of MoteurTarifSrv.Noeud,
	input PrixPublicCatStandard: Framework.string)
begin
--
--	Description : 	Lancement de la compilation des promotions pour chaque package de la liste  
--
--	La compilation consiste en la détermination à chaque étape de la liste de règles  
--	hors package et hors promotion et finalement du prix public de cette liste de règles 
--	Le prix public pour la catégorie standard servira de chaîne de remplacement pour toute 
--	occurrence du tarif normal trouvée dans la règle prix public
--
--	Détermination au préalable de la liste de règles hors package et hors promotion sachant que 
--	l'on recoit en paramètre le prix public pour la catégorie standard
--
--
--	Type :	concret
--
--	Parametres :    lesPackages 		  : La liste des packages à compiler
--					PrixPublicCatStandard : Le prix public pour la catégorie standard, sous la forme d'une chaîne
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilePackages');

PrixPublicHorsPackage : string;

-- Exploration de la branche "Prix public"
HorsPackages           : NoeudIntermediaire = (NoeudIntermediaire) (lesPackages[IDX_HORS_PACKAGE]);
HorsPromotions         : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (HorsPackages . Children[IDX_HORS_PROMOTION]);
PrixPublicHorsContexte : array of Regle     = HorsPromotions.LesRegles;

PrixPublicHorsPackage = DeterminerPrixPublic(PrixPublicHorsContexte,PrixPublicCatStandard);
for UnPackage in lesPackages do 
	CompilePromotions((NoeudIntermediaire) (unPackage).Children,PrixPublicHorsPackage);
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilePackages : End');

end method;

------------------------------------------------------------
method MoteurBS.CompilePromotions(input lesPromotions: Framework.Array of MoteurTarifSrv.Noeud,
	input PrixPublicHorsPackage: Framework.string)
begin
--
--	Description : 	Lancement de la compilation des règles pour chaque noeud fils 
--
--	La compilation consiste en la détermination à chaque étape de la liste de règles hors catégorie 
--	hors package et hors promotion et finalement du prix public de cette liste de règles 
--	Le prix public hors package servira de chaîne de remplacement pour toute occurrence du tarif normal 
--
--	Détermination au préalable de la liste de règles hors promotion sachant que 
--	l'on recoit en paramètre le prix public hors package
--
--
--	Type :	concret
--
--	Parametres :    lesPromotions  		  : La liste des promotions à compiler
--					PrixPublicHorsPackage : Le prix public hors package, sous la forme d'une chaîne
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilePromotions');

PrixPublicHorsPromotion : string;

-- Exploration de la branche "Prix public" pour récupérer le prix public de la liste de promotions
HorsPromotions          : NoeudPorteurDeRegles = (NoeudPorteurDeRegles) (LesPromotions[IDX_HORS_PROMOTION]);
PrixPublicsHorsContexte	: array of Regle       = HorsPromotions.LesRegles; -- Le prix public de la liste de promotions

ListePromotionCourante  : array of Regle;
PrixPublicListeCourante : string;  -- Le prix public de la liste de règles

PrixPublicHorsPromotion = DeterminerPrixPublic(PrixPublicsHorsContexte,PrixPublicHorsPackage);
for unePromotion in lesPromotions do 

	ListePromotionCourante = (NoeudPorteurDeRegles) (unePromotion).LesRegles;
	PrixPublicListeCourante = DeterminerPrixPublic(ListePromotionCourante,PrixPublicHorsPromotion,FALSE);
	for uneRegle in ListePromotionCourante do 

		if SHOW_STRINGS = TRUE then
		  Task.Part.LogMgr.Put(uneRegle.EvalString.Value);
	      Task.Part.LogMgr.Put(' => ');
	    end if;

		if  not uneRegle.PrixPublic = TRUE then
			uneRegle.EvalString = unCompilateur.Expand(srcString=uneRegle.EvalString,
													   WithItem=TARIF_NORMAL,
													   WithString=PrixPublicListeCourante);
		end if;
		CompilerUneRegle(uneRegle);
	end for;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilePromotions : End');

return;

exception
	when e : GenericException do
		self.TraceExc(e,'CompilePromotions');
		raise;

end method;

------------------------------------------------------------
method MoteurBS.CompilerArbre
begin
--
--	Description : 	Lancement de la compilation de l'ensemble de l'arbre de recherche des règles
--
--	La compilation consiste en un parcours de toutes les branches de l'arbre dans le but de trouver
--  toutes les listes de règles stockées dans l'arbre et de compiler toutes les règles stockées dans
--  ces listes. 
--
--  La compilation d'une règle consiste en la compilation de la partie condition et de la partie expression
--  ainsi que de la vérification du type.
--
--	Les listes de règles consistent avant cette phase de compilation en une liste de chaînes. Toutes ces chaînes 
--  sont écrasées volontairement après leur compilation par une référence à NIL afin de les faire passer au 
--  ramasse - miettes (Garbage collector).
--
--  La moindre erreur de compilation ou de vérification de type doit normalement se solder par une exception qui
--  met fin (volontairement) à l'initialisation du moteur de tarification ce qui aura pour conséquence le fait
--  que le moteur ne renverra jamais ServiceStarted = TRUE et donc la tarification ne pourra pas démarrer tant
--  que la liste de règles contiendra des règles erronées.
--
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilePromotions');

-- Deuxième passe de la génération de l'arbre,
-- on va maintenant passer à la compilation des expressions
-- en déterminant la version de tarif_normal à chaque niveau

-- Voir si il est possible de réaffecter le noeud dans un noeud du type
-- exact pour pouvoir éviter les casts dans la boucle for

-- for x in xxx do
--     tmpx : NoeudIntermediaire = x;
--     for y in tmpx.children
--		...
--	   end for;
-- end for;

-- Mesurer le gain en termes de performances

ChronoCompilation : Chronometre = new();
ChronoCompilation.Fire();

begin
	-- La compilation est lancée pour chaque devise
	-- A chacun de ces devises correspond un tableau de produits
	-- A chacun des produits correspond un tableau de services
	-- A chacun de ces services correspond un tableau de catégories
	
	for uneDevise in (NoeudIntermediaire) (arbre).Children do
		for unProduit in (NoeudIntermediaire) (uneDevise).Children do
			for unService in (NoeudIntermediaire) (unProduit).Children do	
					CompileCategoriesEtPrivileges((NoeudServices)(unService));
			end for;		
		end for;
	end for;

exception
	when e : GenericException do
	   self.TraceExc(e,'MoteurBS.CompilerArbre');
	   raise;
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilePromotions : End');

PutMessage('Temps total de compilation : ',ChronoCompilation.AsText());


end method;

------------------------------------------------------------
method MoteurBS.CompilerUneRegle(input uneRegle: MoteurTarifSrv.Regle)
begin
--
--	Description : 	Compilation d'une règle (Partie condition et partie évaluation) à partir de 
--					la version base de données de la règle
--
--	La compilation consiste en l'appel du compilateur avec la méthode Compile qui retourne une instance d'une
--  expression ou NIL si l'expression n'a pas pu être compilée
--  
--  Cette méthode effectue également une vérification de type:
--	   Une condition doit toujours renvoyer un type booléen
--	   Une évaluation doit toujours renvoyer un type décimal
--
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.CompilerUneRegle');


  exprCondition : ExpressionCompilee;
  exprEvaluation: ExpressionCompilee;
  
  -- On tente de compiler la partie condition
  begin
	-- Pour traiter le problème des chaînes vides dans les conditions des règles prix publics
	if uneRegle.PrixPublic=TRUE then
	   uneRegle.CondString.SetValue('1=1');	
	end if;

	exprCondition = unCompilateur.Compile(uneRegle.CondString.Value);
	uneRegle.CondString = NIL; -- Passage au ramasse - miettes
	if exprCondition<>NIL then
	   if exprCondition.Expression = NIL or exprCondition.VerifieType()<>TYPE_BOOLEEN 
	   then AnomalieTarification('CompilerUneRegle/VerifCond1','Condition mal formee ou de type incorrect');
	   end if;
	else
	  AnomalieTarification('CompilerUneRegle/VerifCond2','Condition mal formee');	
	end if;
  exception
   when e : GenericException do
	unMessage : TextData = new();
    unMessage.SetValue(e.Message);   
	unMessage.Concat('[ ');
	unMessage.Concat(uneRegle.CondString);	
	unMessage.Concat(' ]');
	Self.TraceExc(e,unMessage.Value);
	raise;
  end;

  -- On tente de compiler la partie evaluation
  begin
    unType : integer;
	if SHOW_STRINGS then
		Task.Part.LogMgr.PutLine(uneRegle.EvalString.Value);
	end if;
	exprEvaluation = unCompilateur.Compile(uneRegle.EvalString.Value);
	uneRegle.EvalString = NIL; -- Passage au ramasse - miettes
	if exprEvaluation <> NIL then
	   if exprEvaluation.Expression <> NIL  then
          unType = exprEvaluation.VerifieType();
          if unType <> AttributionTypeDecimal then 
			  AnomalieTarification('CompilerUneRegle/VerifEval1','l''expression evaluation doit etre de type numerique');
		  end if;
	   else 
		  AnomalieTarification('CompilerUneRegle/VerifEval2','l''expression evaluation doit etre de type numerique');
	   end if;
	else
	  AnomalieTarification('CompilerUneRegle/VerifEval3','Evaluation mal formee');
	end if;
  exception
   when e : GenericException do
	unMessage : TextData = new();
	unMessage.SetValue(e.Message);
	unMessage.Concat('[ ');
	unMessage.Concat(uneRegle.EvalString);	
	unMessage.Concat(' ]');
	Self.TraceExc(e,unMessage.Value);
	raise;
  end;

  if ExprCondition<>NIL and ExprEvaluation<>NIL then
	 uneRegle.SetParams(exprCondition,exprEvaluation,uneRegle.PrixPublic);
	 NombreCompilees = NombreCompilees + 1; -- Tient compte des deux expressions de la règle
  end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.CompilerUneRegle : End');

end method;

------------------------------------------------------------
method MoteurBS.ConstruireArbre(input lesRegles: Framework.Array of TarificationSrv.RegleDesc,
	input lesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudIntermediaire
begin
--
--	Description : 	Construction de l'ensemble de l'arbre à partir de la liste de règles
-- 					récupérée dans la table des règles ainsi que dans la tarification privilège
--
--					Cette méthode ne compile rien, elle ne fait que construire les branches de l'arbre
--					necéssaires à l'accès aux règles et à y greffer les règles sous leur forme chaîne
--
--					ConstruireBrancheRegles appelé pour chaque RegleDesc
--					ConstruireBranchePrivilege appelé pour chaque TarifClientDesc
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireArbre');

ChronoConstruction : Chronometre = new();
ChronoConstruction.Fire();

NombreNoeudsInt = 0;  -- Nombre de noeuds intermédiaires
NombreNoeudsFin = 0;  -- Nombre de noeuds finaux 
NombreExpl = 0;  	  -- Nombre de noeuds explorés
NombreListes = 0;     -- Nombre de listes de règles créées
NombreCompilees = 0;  -- Nombre de règles correctement compilées
NombrePrivCrees = 0;  -- Nombre de noeuds services créés
	
Arbre = NoeudIntermediaire(); -- Instanciation de la racine de l'arbre

-- Construction des règles (non privilèges)
for uneRegle in LesRegles do
  ConstruireBrancheRegles(uneRegle,unChemin);
end for;

-- Construction des règles (privilèges)
for UneRegle in LesPrivileges do
  ConstruireBranchePrivilege(uneRegle,unChemin);
end for;

PutMessage('Temps de construction de l''arbre : ',ChronoConstruction.AsText());

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireArbre : End');

return (NoeudIntermediaire) (arbre);


end method;

------------------------------------------------------------
method MoteurBS.ConstruireBranchePrivilege(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Construction d'une branche d'accès à un TarifClientDesc
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le Tarif privilège à insérer
--					unChemin	  : Le chemin d'accès tel que calculé par CalculerChemin
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireBranchePrivilege');

if unTarifClient<>NIL then

   -- TrouverCheminPrivileges effectue en même temps la recherche et la construction de la branche
   ListePriv : NoeudServices = TrouverCheminPrivileges(unTarifClient,unChemin);
   
   -- La liste n'a pas encore été créée. Ne devrait jamais se produire 
   -- car est censé être créé dans la méthode TrouverChemin. Ne sert donc que de garde-fou
   if ListePriv = NIL then
      AnomalieTarification('ConstruireBranchePrivilege','Erreur : Liste de règles créée dans ConstruireBrancheRegles');
   end if;
 
   -- Instanciation de la règle privilège  
   unPrivilege : Privilege = new();
   unPrivilege.CodeClient = unTarifClient.CodeClient;
   unPrivilege.EvalString = unTarifClient.Montant;
   
   -- Insertion de la règle dans la liste
   ListePriv.AjouterPriv(unTarifClient.CodeClient.IntegerValue,unPrivilege);

else
   -- Oops, what's happened ? Has the sh... hit the fan ? 
	AnomalieTarification('ConstruireBranchePrivilege','Tarif client à NILincorrect');
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireBranchePrivilege : End');


end method;

------------------------------------------------------------
method MoteurBS.ConstruireBrancheRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 	Construction d'une branche d'accès à un RegleDesc
--
--	Type :	concret
--
--	Parametres :    unRegleDesc : La règle à insérer
--					unChemin    : Le chemin d'accès à la règle tel que calculé par CalculerChemin
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.ConstruireBrancheRegle');

-- Construire la branche correspondant à la règle consiste à la compiler, 
-- trouver/construire le chemin correspondant dans l'arbre de recherche
-- et l'insérer dans la liste de règles (après avoir créé cette liste si necéssaire)

-- Création de la règle sans procéder à la compilation mais simplement en lui faisant
-- porter les expressions à compiler lors de la deuxième passe

laRegle : Regle = new();
laRegle.SetStrings(uneChaineCond=unRegleDesc.Condition,
				   uneChaineEval=unRegleDesc.Montant);
laRegle.PrixPublic = unRegleDesc.PrixPublicBln;		

-- Récupération d'une référence (par création ou reprise) vers la liste de règles concernées
ListeRegles : array of Regle = TrouverCheminRegles(unRegleDesc,unChemin).LesRegles;
   
-- La liste n'a pas encore été créée. Ne devrait jamais se produire 
-- car est censé être créé dans la méthode TrouverChemin. Ne sert donc que de garde-fou
if ListeRegles = NIL then
  uneErreur : AnomalieTarificationExc = new();
  uneErreur.SetWithParams(SP_ER_ERROR,'Erreur : Liste de règles créée dans ConstruireBrancheRegles');
  Task.Part.LogMgr.PutLine('Erreur : Liste de règles créée dans ConstruireBrancheRegles');
  raise uneErreur;	
end if;

-- Insertion de la règle dans la liste
ListeRegles.AppendRow(laRegle);
   
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.ConstruireBrancheRegle : End');

end method;

------------------------------------------------------------
method MoteurBS.DeterminerPrixPublic(input ListeRegles: Framework.Array of MoteurTarifSrv.Regle,
	input LeTarifNormal: Framework.string,
	input ErreurSiTarifNormal: Framework.boolean = FALSE): Framework.string
begin
--
--	Description : 	Détermination dans une liste de règles de la règle considérée comme le prix public
--
--	Type :	concret
--
--	Parametres :    ListeRegles   : La liste de règles
--					LeTarifNormal : La chaîne de remplacement pour toute occurrence de tarif_normal
--					ErreurSiTarifNormal : Doit t'on lever une exception en cas de présence du tarif_normal 
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DeterminerPrixPublic');

LePrixPublic : string='';

-- Rechercher le prix public dans la liste de règles
for Regle in ListeRegles do

	if  Regle.PrixPublic then
		-- Vérifier que l'expression ne contient pas Tarif_Normal
		Expanded : TextData = unCompilateur.Expand(srcString=Regle.EvalString,WithString=leTarifNormal,WithItem=TARIF_NORMAL);
		if Regle.EvalString <> NIL and Expanded <> NIL then 
		   if ErreurSiTarifNormal = TRUE and not Regle.EvalString.IsEqual(Expanded) then
	          AnomalieTarification('Occurrence de tarif normal non autorisée dans le prix public final',Regle.EvalString.Value);
		   end if;
		else
		 AnomalieTarification('DeterminerPrixPublic','Evaluation ou expansion de regle a NIL');
		end if;
		Regle.EvalString.SetValue(Expanded);
		LePrixPublic = Expanded.Value;
		exit;
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DeterminerPrixPublic : End');

return LePrixPublic;

exception
  when e : GenericException do
  	self.TraceExc(e,'Erreur dans DeterminerPrixPublic');
	raise;
  	
end method;

------------------------------------------------------------
method MoteurBS.DoAction(input aTransData: DataAccessSrvBD.TransDesc,
	input aTransOrigin: DataAccessSrvBD.StdEventNotifier = NIL): Framework.Object
begin
--
--	Description :	Méthode a définir au niveau concret pour
--  une action "non standatd". Un transdataDesc est transmi
--  les éventuelles données en retour sont de type Object.	
--
--	Type :	Abstrait/Concret
--
--
--	Parametres :	Copy Input	--> aTransdata :	Communication structure.
--					Input 		--> aTransOrigin : caller.
--					Return      --> Object : Return data flow.
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--  PMT	 	| ??/05/1998  |   Création
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoAction');

-- Declarations
unExc : ImplementationExc;

-- Traitement
unExc = New();
unExc.Message.Concat('BusinessServiceDesc.DoAction');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoAction : End (Levée d''une exception) ');
Raise unExc;
-- Fin du traitement


Exception
	When e : GenericException do
		Self.TraceExc(e, 'BusinessServiceDesc.DoAction');
		Raise;
end method;

------------------------------------------------------------
method MoteurBS.DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc
begin
--
--	Description : 	Lecture des règles normales
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoLireLesPrivileges');
Task.Part.LogMgr.PutLine('************* Lecture des privileges en cours ***************');

TmpPriv : array of TarifClientDesc = new();
unCache : array of CacheDesc;

aTransData : TransDesc = new();
aTransData.TransactionService = ACT_STD_READ;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)
unCache = (array of CacheDesc) (self.Transfer(aTransData,soTarificationBSMgr,TarifClientBS));

unCompteur : integer = 0;
for unCacheDesc in unCache do 
	Task.Part.LogMgr.PutLine(IntegerData(Value=unCompteur).TextValue);
	TmpPriv.AppendRow((TarifClientDesc) (unCacheDesc.Record));
	unCompteur = unCompteur + 1;
end for;

Task.Part.LogMgr.PutLine('************* Lecture des privileges terminee ***************');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoLireLesPrivileges : End');

return TmpPriv;
end method;

------------------------------------------------------------
method MoteurBS.DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc
begin
--
--	Description : 	Lecture des règles normales
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.DoLireLesRegles');
Task.Part.LogMgr.PutLine('************* Lecture des regles en cours ***************');

unCache : array of CacheDesc;

aTransData : TransDesc = new();
aTransData.TransactionService = ACT_STD_READ;
aTransData.TransObject = DateReference.Clone(Deep=true); -- Passage de la date de référence (clonée)
unCache = (array of CacheDesc) (self.Transfer(aTransData,soTarificationBSMgr,RegleBS));

TmpRegles : array of RegleDesc = new();
unCompteur : integer = 0;
for unCacheDesc in unCache do 
	Task.Part.LogMgr.PutLine(IntegerData(Value=unCompteur).TextValue);
	TmpRegles.AppendRow((RegleDesc) (unCacheDesc.Record));
	unCompteur = unCompteur + 1;
end for;

Task.Part.LogMgr.PutLine('************* Lecture des regles terminee ***************');
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.DoLireLesRegles : End');

return TmpRegles;
end method;

------------------------------------------------------------
method MoteurBS.Evalue: Framework.NumericData
begin
--
--	Description : 	Evaluation d'un événement de tarification 
--
--	Type :	concret
--
--	Parametres :    Aucun car les paramètres sont passés via le contexte
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Evalue');

unTarif 	: NumericData;

begin
	
	SADevises    : NoeudIntermediaire = (NoeudIntermediaire) ((NoeudIntermediaire) (Arbre).Children[CT.CodeDevise.Value]);	
	SAServices   : NoeudServices;	
	
	SAProduits  : NoeudIntermediaire = (NoeudIntermediaire) (SADevises.Children[CT.CodeProduit.Value]);
	SAServices        = (NoeudServices) (SAProduits.Children[CT.CodeService.Value]);
    	
	unPrivilege	: Privilege = SAServices.LirePriv(CT.NumClient.IntegerValue); 
	if unPrivilege<>NIL then -- On vient de trouver un privilège, on doit donc l'évaluer
		unTarif = (NumericData) (unPrivilege.Eval.Evalue());	
	else
	    -- pas de privilège pour le client, le service, la devise et la date de référence en cours
		-- on continue donc le déroulement de l'arbre
		
        SACategories : NoeudIntermediaire    = (NoeudIntermediaire)   (SAServices.Children[CT.CodeCategorie.Value]);
		SAPackages   : NoeudIntermediaire    = (NoeudIntermediaire)   (SACategories.Children[CT.CodePackage.Value]);
		SAPromotions : NoeudPorteurDeRegles  = (NoeudPorteurDeRegles) (SAPackages.Children[CT.CodePromotion.Value]);

		case SAPromotions.Strategie is
			when STRATEGIE_STANDARD  do unTarif = EvaluerPremierApplicables  (SAPromotions.lesRegles);
			when STRATEGIE_MINI      do unTarif = EvaluerMiniApplicables     (SAPromotions.lesRegles);
			when STRATEGIE_MAXI      do unTarif = EvaluerMaxiApplicables     (SAPromotions.lesRegles);
			else AnomalieTarification('Evalue','Stratégie invalide');
		end case;   
	end if;

exception
	when e : GenericException do
	   self.TraceExc(e,'CRE invalide');

	   -- Problème pendant l'évaluation d'un événenement de tarification
	   -- Lancement d'une exception spécifique pour signaler le problème et
	   -- pouvoir la reporter dans un fichier log
	   
/*
	   unMessage : TextData = new(Value='Problème pendant l''évaluation d''un événement de tarification\n ');
	   unMessage.Concat('[CodeClient=%1,  CodeDevise=%2    , CodeCategorie=%3, CodeProduit=%4, CodeService=%5,\n');
	   unMessage.Concat(' CodePackage=%6, CodePromotion=%7 , DateDebut=%8,     DateFin=%9]\n');
	   unMessage.ReplaceParameters(unMessage,Parameter1=(IntegerData) (CT.NumClient)     , 
	   										 Parameter2=(IntegerData) (CT.CodeDevise)    ,
	   										 Parameter3=(IntegerData) (CT.CodeCategorie) , 
	   										 Parameter4=(IntegerData) (CT.CodeProduit)   ,
	   										 Parameter5=(IntegerData) (CT.CodeService)   ,
	   										 Parameter6=(IntegerData) (CT.CodePackage)   ,
	   										 Parameter7=(IntegerData) (CT.CodePromotion));

	   uneAnomalieEval : AnomalieEvaluation = new();
	   uneAnomalieEval.SetWithParams(SP_ER_ERROR, unMessage.Value);
	   raise uneAnomalieEval;
*/
end;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Evalue : End');

return unTarif;

end method;

------------------------------------------------------------
method MoteurBS.EvalueCRE(input unCre: TarificationSrv.EvenementTarificationDesc): Framework.NumericData
begin
--
--	Description : 	Initiation du contexte puis appel de l'évaluation d'un événement de tarification 
--
--	Type :	concret
--
--	Parametres :    unCre : L'événement de tarification à valoriser (= évaluer)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueCRE');

unNumClient : IntegerData = IntegerData(Value = unCre.NumClient.IntegerValue);

CT.Initialise(NumClient=unNumClient,
			  CodeCategorie=unCre.CodeCategorie,
			  CodeService=unCre.CodeService,
			  CodePackage=unCre.CodePackage,
			  CodeProduit=unCre.CodeProduit,
			  CodePromotion=unCre.CodePromotion,
			  CodeDevise=unCre.CodeDevise);

/*

CT.Initialise(NumClient=(IntegerData) (unCre.Client),
			  Categorie=(IntegerData) (unCre.Categorie),
			  unService=(IntegerData) (unCre.Operation),
			  Package=(IntegerData) (unCre.Package),
			  Produit=(IntegerData) (unCre.Produit),
			  Promotion=(IntegerData) (unCre.Promotion),
			  Devise=(IntegerData) (unCre.Devise));
*/

-- Appel concret de l'évaluation
unTarif : NumericData = Self.Evalue();

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueCRE : End');

return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerMaxiApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie maximale
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueMaxiApplicables');

unRes   : NumericData;
unTarif : NumericData;
Cond    : BooleanData;

for uneRegle in lesRegles do

	Cond = (BooleanData) (uneRegle.Cond.Evalue());
    CompteurEval = CompteurEval + 1;
	
	-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
	if Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE then
		unRes = (NumericData) (uneRegle.Eval.Evalue());

		-- Calcul du tarif maximum
		-- unRes ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull 

		if unRes <> NIL and unRes.IsNull = FALSE and
		  (unTarif = NIL or unRes.IsGreaterThan(unTarif)) 
		then unTarif  =  unRes; 
		end if;	

	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueMaxiApplicables : End');

return unRes;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerMiniApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie minimimale
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueMiniApplicables');

unRes   : NumericData;
unTarif : NumericData;
Cond    : BooleanData;

for uneRegle in lesRegles do

	Cond = (BooleanData) (uneRegle.Cond.Evalue());
    CompteurEval = CompteurEval + 1;

	-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
	if Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE then
		unRes = (NumericData) (uneRegle.Eval.Evalue());

		-- Calcul du tarif minimum
		-- unRes ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull 
		if unRes <> NIL and unRes.IsNull = FALSE and
		  (unTarif = NIL or unRes.IsLessThan(unTarif)) 
		then unTarif  = unRes; 
		end if;	
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueMiniApplicables : End');


return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvaluerPremierApplicables(input lesRegles: Framework.Array of MoteurTarifSrv.Regle): Framework.NumericData
begin
--
--	Description : 	Evaluation de l'événement de tarification selon la stratégie standard (= La première règle vérifiée s'applique)
--
--	Type :	concret
--
--	Parametres :    lesRegles : La liste de règles servant à effectuer l'évaluation
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvaluePremierApplicables');

unTarif : NumericData;
Cond 	: BooleanData;

for uneRegle in lesRegles do
    if      uneRegle.PrixPublic = TRUE then

     		unTarif = (NumericData) (uneRegle.Eval.Evalue()); -- Evaluation du tarif public
		    CompteurEval = CompteurEval + 1;

    else
    		Cond = (BooleanData) (uneRegle.Cond.Evalue());
		    CompteurEval = CompteurEval + 1;

			-- Cond ne doit pas renvoyer NIL et ne doit pas être positionné sur IsNull + Value = TRUE si condition vérifiée
    		if   Cond <> NIL and Cond.IsNull = FALSE and Cond.Value = TRUE
    		then 
    			 unTarif = (NumericData) (uneRegle.Eval.Evalue());
	             exit; -- Sortie immédiate après vérification positive d'une règle
		    end if;
	end if;
end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvaluePremierApplicables : End');

return unTarif;
end method;

------------------------------------------------------------
method MoteurBS.EvalueTarifPrivilege(input leService: MoteurTarifSrv.NoeudServices): Framework.NumericData
begin
--
--	Description : 	Evaluation d'un tarif privilège
--
--	Type :	concret
--
--	Parametres :    leService : Le noeud service porteur de la liste des privilège pour le service qu'il représente
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.EvalueTarifPrivilege');

-- L'appel à LirePriv permet de se rendre indépendant de l'implémentation concrète de la recherche
-- d'un privilège dans le noeud. On peut donc hésiter entre une HashTable et d'autres méthodes de stockage

-- Recherche de l'existence ou non d'un privilège pour la devise, le produit, le service et le client en cours
--
-- LirePriv : Laisser l'exception se lever pour la récupérer plus tard, ne pas renvoyer NIL
--
unPrivilege	: Privilege = leService.LirePriv(CT.NumClient.IntegerValue); 
unTarif		: NumericData = NIL;
if unPrivilege = NIL 
then unTarif = NIL;  -- Rien trouvé, on renvoie NIL. A ce niveau, NIL n'est donc pas une condition d'erreur
else 
     unTarif = (NumericData) (unPrivilege.Eval.Evalue()); -- Trouvé ! On renvoie le résultat
--     CompteurEval = CompteurEval + 1;
end if;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.EvalueTarifPrivilege : End');

return unTarif;

-- Question : Que se passe t'il si pour une raison ou une autre, cette méthode renvoie NIL 
-- alors qu'elle ne devrait pas et que par la suite, l'évaluation normale se passe bien : 
-- Le tarif privilège est donc ignoré ce qui devient problématique. Peut - être faut t'il 
-- prévoir un traitement pour distinguer un problème dans l'évaluation d'une absence de tarif privilège.

end method;

------------------------------------------------------------
method MoteurBS.Init
begin
--
--	Description : 	Initialisation (au sens méthode Init) du moteur
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Init');

super.Init();
--CT = ContexteTarification(); -- Création du contexte (=instanciation)
--Initialise(CT);			 	 -- Lancement de l'initialisation (construction de l'arbre)

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Init : End');

end method;

------------------------------------------------------------
method MoteurBS.Initialise(input unContexte: ContexteClt.Contexte,
	input GoCompile: Framework.boolean)
begin
--
--	Description : 	Initialisation du moteur (= construction de l'arbre de recherche, compilation ...)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

-- Lecture des règles
-- Construction de l'arbre


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.Initialise');

	DateReference = new();
	DateReference.SetCurrent();
	
	-- Initialisé ici pour éviter de tester si NIL dans TrouverChemin
	unChemin : array of IntegerData = new();
	unChemin.Clear(); 

	unCompilateur = new(Contexte=unContexte); -- Création d'une instance du compilateur avec liée à un contexte
	unCompilateur.MapDecimalToDouble();
	AttributionTypeDecimal = TYPE_NUMERIQUE;
	
Task.Part.LogMgr.PutLine('INIT/LECTURE DES REGLES NORMALES ET DES REGLES PRIVILEGES');

	lesRegles : array of RegleDesc = DoLireLesRegles();
	lesPrivileges : array of TarifClientDesc = DoLireLesPrivileges();

Task.Part.LogMgr.PutLine('INIT/CONSTRUCTION EFFECTIVE DE L''ARBRE DE RECHERCHE DES REGLES');

	ConstruireArbre(lesRegles,lesPrivileges,unChemin);	  -- Construction de l'arbre de recherche des règles


/*
	GoCompile : BooleanData = new(Value=TRUE);
	post WantCompile(GoCompile);

	event loop
	  register CompileEvent;
	  when self.WantCompile do 
	       exit;
	  when self.CompileAccepted do 
	       GoCompile.Value = TRUE;
	       exit;
	  when self.CompileRejected do
	       GoCompile.Value = FALSE;
	end event;
*/
	
	if GoCompile=TRUE then
	   CompilerArbre();									  -- Compilation des règles 
	end if;

	

	
-- PHASE TERMINALE : (Sorry for that), impression des différentes statistiques 

PutMessage('regles privileges creees      : ',NombrePrivCrees);
PutMessage('regles crees                  : ',NombreRegles);

PutMessage('Generation de l''arbre','');

PutMessage('noeuds services inseres       : ',NombreServInseres);
PutMessage('noeuds intermediaires         : ',NombreNoeudsInt);
PutMessage('noeuds finaux                 : ',NombreNoeudsFin);
PutMessage('listes de regles              : ',NombreListes);
PutMessage('noeuds explores               : ',NombreExpl);
PutMessage('regles correctement compilees : ',NombreCompilees);

Task.Part.LogMgr.PutLine('INIT/FIN');

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.Initialise : End');

return;

Exception
   when e : GenericException do
	   Task.Part.LogMgr.PutLine('EXCEPTION LEVEE');
       Self.TraceExc(e,'MoteurBS.Initialise');
       raise;
end method;

------------------------------------------------------------
method MoteurBS.PutMessage(input unMessage: Framework.TextData,
	input NumberTicks: Framework.long)
begin
--
--	Description : 	Affichage d'un nombre de ticks d'horloge (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(NumberTicks)');

unMessage.Concat(' ');
unMessage.Concat(NumberTicks);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(NumberTicks) : End');

end method;

------------------------------------------------------------
method MoteurBS.PutMessage(input unMessage: Framework.TextData,
	input unCompl: Framework.TextData)
begin
--
--	Description : 	Affichage d'un message (Débuggage et compte-rendu d'activité)
--
--	Type :	concret
--
--	Parametres :    Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.PutMessage(TextData)');

unMessage.Concat(' ');
unMessage.Concat(unCompl);
Task.Part.LogMgr.PutLine(unMessage.Value);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.PutMessage(TextData)');

end method;

------------------------------------------------------------
method MoteurBS.TrouverCheminPrivileges(input unTarifClient: TarificationSrv.TarifClientDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudServices
begin
--
--	Description : 	Recherche et construction d'une branche de l'arbre de recherche en fonction d'un tarif
--					privilège
--
--	Type :	concret
--
--	Parametres :    unTarifClient : Le tarif privilège à insérer
--					Le chemin d'accès au tarif client
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.TrouverCheminPrivileges');

-- Chemin d'accès : Les indices indiquent le niveau de l'arbre
--					Les valeurs stockés indiquent le rang dans le sous tableau des fils

unRang   : integer;
Courant  : NoeudIntermediaire;
Prochain : NoeudIntermediaire;
Services : NoeudServices;

CalculerChemin(unTarifClient,unChemin);  -- Création du chemin d'accès au noeud recherché (version TarifClientDesc)
Courant = (NoeudIntermediaire) (Arbre); -- On démarre de la racine, tant qu'à faire
for Parcours in unChemin do

    unRang = Parcours.Value;    -- Rang du noeud souhaité dans le tableau des fils
	NombreExpl = NombreExpl + 1;
	
	-- Lecture et création si necéssaire du prochain noeud de l'arborescence
	if		Parcours.IsA(RefTypeServiceDesc) then		-- Noeud porteur de services et d'une stratégie
			
			Services = (NoeudServices) (Courant.children[unRang]); -- Niveau suivant : Package, donc NoeudOperations
			if Services = NIL then
	           Services = NoeudServices();
			   Courant.Children[unRang]=Services;
			   NombreServInseres = NombreServInseres + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
	        end if;
			Courant = Services;
			
	else												-- Noeud intermédiaire

			Prochain = (NoeudIntermediaire) (Courant.children[unRang]); -- Niveau suivant : Devise ou catégorie ou package ou produits, donc NoeudIntermediaire
			if Prochain = NIL then
	           Prochain = NoeudIntermediaire();
			   Courant.Children[unRang]=Prochain;
			   NombreNoeudsInt = NombreNoeudsInt + 1;	 
	        end if;
	        Courant = Prochain;
			
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.TrouverCheminPrivileges : End');

return Services; 
end method;

------------------------------------------------------------
method MoteurBS.TrouverCheminRegles(input unRegleDesc: TarificationSrv.RegleDesc,
	input unChemin: Framework.Array of Framework.IntegerData): MoteurTarifSrv.NoeudPorteurDeRegles
begin
--
--	Description : 	Recherche et construction d'une branche de l'arbre de recherche en fonction d'une règle normale
--
--	Type :	concret
--
--	Parametres :    unRegleDesc : La règle à insérer
--					Le chemin d'accès à la règle
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	05/05/1998	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- MoteurBS.TrouverCheminRegles');

-- Chemin d'accès : Les indices indiquent le niveau de l'arbre
--					Les valeurs stockés indiquent le rang dans le sous tableau des fils

unRang   : integer;
Courant  : NoeudIntermediaire;
Prochain : NoeudIntermediaire;
Final	 : NoeudPorteurDeRegles;

CalculerChemin(unRegleDesc,unChemin);  -- Création du chemin d'accès au noeud recherché (version RegleDesc)
Courant = (NoeudIntermediaire) (Arbre); -- On démarre de la racine, tant qu'à faire
for Parcours in unChemin do

    unRang = Parcours.Value;    -- Rang du noeud souhaité dans le tableau des fils
	
	-- Lecture et création si necéssaire du prochain noeud de l'arborescence
	if		Parcours.IsA(RefTypeServiceDesc) then		-- Noeud porteur d'opérations et d'une stratégie
			
			Prochain = (NoeudServices) (Courant.children[unRang]); -- Niveau suivant : Package, donc NoeudOperations
			if Prochain = NIL then
	           Prochain = NoeudServices();
			   Courant.Children[unRang]=Prochain;
			   NombreServInseres = NombreServInseres + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;
	        end if;
			Courant = Prochain;
						
		   		
	elseif	Parcours.IsA(RefTypePromotionDesc) then			-- Noeud porteur de règles

			Final = (NoeudPorteurDeRegles) (Courant.children[unRang]); -- Niveau suivant : Liste de règles, donc NoeudPorteurDeRegles
			if Final = NIL then
	           Final = NoeudPorteurDeRegles();
			   Courant.Children[unRang]=Final;
			   NombreNoeudsFin = NombreNoeudsFin + 1;	
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
			   NombreListes = NombreListes+1;
			end if;
            if unRegleDesc.PrixPublicBln then
               Final.Strategie = (IntegerNullable) (unRegleDesc.CodeStrategie).Value;   -- Penser à renseigner le champs stratégie.	
            end if;
            
	else												-- Noeud intermédiaire

			Prochain = (NoeudIntermediaire) (Courant.children[unRang]); -- Niveau suivant : Devise ou catégorie ou package ou produits, donc NoeudIntermediaire
			if Prochain = NIL then
	           Prochain = NoeudIntermediaire();
			   Courant.Children[unRang]=Prochain;
			   NombreNoeudsInt = NombreNoeudsInt + 1;		   	
	        end if;
			Courant = Prochain;
			
	end if;

end for;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- MoteurBS.TrouverCheminRegles : End');

return Final;

exception
	when e : GenericException do
		self.TraceExc(e,'TrouverCheminRegles : Erreur de code stratégie');
		raise;
		
end method;

------------------------------------------------------------
method MoteurBS.TrouverListeRegles(input CodeDevise: Framework.IntegerData,
	input CodeProduit: Framework.IntegerData,
	input CodeService: Framework.IntegerData,
	input CodeCategorie: Framework.IntegerData,
	input CodePackage: Framework.IntegerData,
	input CodePromotion: Framework.IntegerData,
	input output BreakCode: Framework.integer): Framework.Array of MoteurTarifSrv.Regle
begin
--
--	Description : 	Retourne la liste de règles correspondant au contexte
--					d'application passé en paramètre
--
--	Type :	concret
--
--	Parametres :    CodeDevise    : Code de la devise
--					CodeProduit   : Code du produit
--					CodeService   : Code du service
--					CodeCategorie : Code de la catégorie
--					CodePackage	  : Code du package
--					CodePromotion : Code de la promotion
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	PMT	|	28/05/1998	|	Creation.
--+

BreakCode = 0;
SAPromotions : NoeudPorteurDeRegles;

SADevises    : NoeudIntermediaire = (NoeudIntermediaire) ((NoeudIntermediaire) (Arbre).Children[CodeDevise.Value]);	
if SADevises = NIL -- 1
then BreakCode = BreakCode + 1;
else
	SAProduits   : NoeudIntermediaire = (NoeudIntermediaire) (SADevises.Children[CodeProduit.Value]);
	if SAProduits = NIL -- 2 
	then BreakCode = BreakCode + 1;
	else
		SAServices   : NoeudServices      = (NoeudServices) (SAProduits.Children[CodeService.Value]);
		if SAServices = NIL -- 3
		then BreakCode = BreakCode + 1;
		else
			SACategories : NoeudIntermediaire    = (NoeudIntermediaire)   (SAServices.Children[CodeCategorie.Value]);
			if SACategories = NIL -- 4 
			then BreakCode = BreakCode + 1;
			else
				SAPackages   : NoeudIntermediaire    = (NoeudIntermediaire)   (SACategories.Children[CodePackage.Value]);
				if SAPackages = NIL -- 5
				then BreakCode = BreakCode + 1;
				else SAPromotions = (NoeudPorteurDeRegles) (SAPackages.Children[CodePromotion.Value]);
				end if; -- 5;
			end if; -- 4
		end if; -- 3
	end if; -- 2
end if; -- 1


uneListeDeRegles : array of Regle;
if SAPromotions = NIL 
then uneListeDeRegles = NIL;	
else uneListeDeRegles = SAPromotions.LesRegles;
	 BreakCode = BreakCode + 1;
end if;

return uneListeDeRegles;

end method;

------------------------------------------------------------
method MoteurBSTest.CreerEvenementTest2(input NumClient: Framework.integer,
	input output Liste: Framework.Array of TarificationSrv.EvenementTarificationDesc,
	input Categorie: Framework.integer,
	input Package: Framework.integer,
	input Promotion: Framework.integer)
begin
	unEvTarif : EvenementTarificationDesc = new();

	-- Partie commune à chaque 
	unEvTarif.NumClient.SetValue(NumClient);
	unEvTarif.CodeDevise.SetValue(1);
	unEvTarif.CodeProduit.SetValue(1);
	unEvTarif.CodeService.SetValue(1);

	-- Partie variante
	unEvTarif.CodePackage.SetValue(Package);
	unEvTarif.CodePromotion.SetValue(Promotion);
	unEvTarif.CodeCategorie.setValue(Categorie);
	Liste.AppendRow(unEvTarif);

end method;

------------------------------------------------------------
method MoteurBSTest.CreerRegle(input Cat: Framework.integer,
	input Promo: Framework.integer,
	input Pack: Framework.integer,
	input Eval: Framework.string,
	input PP: Framework.boolean = TRUE): TarificationSrv.RegleDesc
begin
-- Cool Helper method

unRegleDesc : RegleDesc = new();
unRegleDesc.DoResetAttributes();
unRegleDesc.Commentaire.SetValue('Commentaire');
unRegleDesc.CodeDevise.SetValue(1);
unRegleDesc.CodeCategorie.SetValue(Cat);
unRegleDesc.CodeProduit.SetValue(1); -- NS 
unRegleDesc.CodeService.SetValue(1); -- NS
unRegleDesc.CodePromotion.SetValue(Promo); 
unRegleDesc.CodePackage.SetValue(Pack);
unRegleDesc.PrixPublicBln.SetValue(PP);
if not PP then 
   unRegleDesc.Condition.SetValue('Age<25');
   unRegleDesc.Montant.SetValue('Tarif_Normal/2');
else
   unRegleDesc.Condition.SetValue('1=1');
   unRegleDesc.Montant.SetValue(Eval);

end if;

return unRegleDesc;

end method;

------------------------------------------------------------
method MoteurBSTest.DoAfterSyncServices
begin
--super.DoAfterSyncServices();
Test();
end method;

------------------------------------------------------------
method MoteurBSTest.DoInitService
begin
super.DoInitService();
end method;

------------------------------------------------------------
method MoteurBSTest.DoLireLesPrivileges: Framework.Array of TarificationSrv.TarifClientDesc
begin
-- Lire la table des tarifs clients et la mettre sous la forme
-- d'une table en mémoire

TablePrivileges : array of TarifClientDesc = new();
lesEvenements : array of EvenementTarificationDesc = GenererLesEvenements();
NombrePrivCrees = 0;  -- Nombre de règles privilèges créées


unEntier   : IntegerData = new();
unPrivDesc : TarifClientDesc;


if TEST_NUMBER = 1 then

	for i in 1 to lesEvenements.items do
	   
	   
	   -- Génération de MAX_RG_PRIV événements ayant une chance minime de s'appliquer
	   for j in 1 to MAX_RG_PRIV do
	
		   unPrivDesc = new();
		   unPrivDesc.CodeClient = new();
		   unPrivDesc.CodeClient.SetValue(lesEvenements[i].NumClient);
		   unPrivDesc.CodeProduit.SetValue(GenererNombre(MAX_RG_PROD));
		   unPrivDesc.CodeService.SetValue(GenererNombre(MAX_RG_OPER));
		   unPrivDesc.CodeDevise.SetValue(GenererNombre(MAX_RG_DEV));
		   unPrivDesc.Montant.SetValue((Double) (GenererNombre(80).Value));
		   unPrivDesc.Montant.Concat('.00');
		   TablePrivileges.AppendRow(unPrivDesc);
		   NombrePrivCrees = NombrePrivCrees+1;		
	
		end for;
	
		-- Génération d'un événement dont on est sûr qu'il va s'appliquer
	    unPrivDesc = new();
	    unPrivDesc.CodeClient = new();
	    unPrivDesc.CodeClient.SetValue(lesEvenements[i].NumClient);
	    unPrivDesc.CodeProduit.SetValue(lesEvenements[i].CodeProduit);
	    unPrivDesc.CodeService.SetValue(lesEvenements[i].CodeService);
	    unPrivDesc.CodeDevise.SetValue(lesEvenements[i].CodeDevise);
	    unPrivDesc.Montant.SetValue ((Double) (GenererNombre(80).Value));
	    unPrivDesc.Montant.Concat('.00');
	    TablePrivileges.AppendRow(unPrivDesc);
	    NombrePrivCrees = NombrePrivCrees+1;		
		
	    i = i + 3;
			    
	end for;

end if;

return TablePrivileges;
end method;

------------------------------------------------------------
method MoteurBSTest.DoLireLesRegles: Framework.Array of TarificationSrv.RegleDesc
begin
lesReglesDesc : array of RegleDesc = new();

if TEST_NUMBER = 1 then -- Test aléatoire
    
	Cond : Assoc = new();
	Cond.Append('1','Age<25');
	Cond.Append('2','Prix<>300');
	Cond.Append('3','Prix=200');
	Cond.Append('4','Prix>200');
	Cond.Append('5','Categorie=''VIP''');
	
	Eval : Assoc = new();
	Eval.Append('1','100+(Prix*2)');
	Eval.Append('2','Prix*(Age*0.80)/100');
	Eval.Append('3','100.00');
	Eval.Append('4','150.00');
	Eval.Append('5','Prix/2');
	
	NumCondition  : IntegerData = new();
	NumEvaluation : IntegerData = new();
	
	NombreRegles = 0;
	
	unRegleDesc : RegleDesc;
	for Devise in 1 to MAX_RG_DEV do
	  for Categorie in 1 to MAX_RG_CAT do
		for Produits in 1 to MAX_RG_PROD do
			for Operations in 1 to MAX_RG_OPER do		
				for Package in 1 to MAX_RG_PACK do
					for Promotion in 1 to MAX_RG_PROM do
						for Conditions in 1 to MAX_RG_COND do
							for Evaluations in 1 to MAX_RG_EVAL do
	
								unRegleDesc = new();
								unRegleDesc.DoResetAttributes();
								unRegleDesc.Commentaire.SetValue('Commentaire');
								unRegleDesc.CodeDevise.SetValue(Devise);
								unRegleDesc.CodeCategorie.SetValue(Categorie);
								unRegleDesc.CodeProduit.SetValue(Produits);
								unRegleDesc.CodeService.SetValue(Operations);
								unRegleDesc.CodePromotion.SetValue(Promotion);
								unRegleDesc.CodePackage.SetValue(Package);
								NumCondition.SetValue(GenererNombre(MAX_RG_COND));
								unRegleDesc.Condition.SetValue(Cond.FindByKey(NumCondition.TextValue).GetItem());
								NumEvaluation.SetValue(GenererNombre(MAX_RG_EVAL));
								unRegleDesc.Montant.SetValue(Eval.FindByKey(NumEvaluation.TextValue).GetItem());
								if Conditions = 1 and Evaluations=1 then 
								   unRegleDesc.CodeStrategie.SetValue(GenererNombre(3));
								   unRegleDesc.PrixPublicBln.SetValue(TRUE);
								else
								   unRegleDesc.CodeStrategie.SetValue(STRATEGIE_INDEFINI);
								   unRegleDesc.PrixPublicBln.SetValue(FALSE);
								end if;
								LesReglesDesc.AppendRow(unRegleDesc);
								NombreRegles = NombreRegles + 1;
															
							end for; -- Evaluations
						end for; -- Conditions
					end for; -- Promotions
				end for; -- Package
			end for; -- Operations
		end for; -- Produits
	  end for; -- Categorie
	end for; -- Devise
else
	-- Test des capacités de réduction du tarif normal
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= HPR, Eval='200.00'         , PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= HPR, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= PR1, Eval='Tarif_Normal/2' , PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= HPK, Promo= PR1, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= HPR, Eval='Tarif_Normal/4' , PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= HPR, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= PR1, Eval='Tarif_Normal/5' , PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_STD , Pack= PK1, Promo= PR1, Eval=''               , PP=FALSE));
	
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= HPR, Eval='Tarif_Normal/8' , PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= HPR, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= PR1, Eval='Tarif_Normal/10', PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= HPK, Promo= PR1, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= HPR, Eval='Tarif_Normal/20', PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= HPR, Eval=''               , PP=FALSE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= PR1, Eval='Tarif_Normal/40', PP=TRUE));
	lesReglesDesc.AppendRow(CreerRegle(Cat=CAT_VIP , Pack= PK1, Promo= PR1, Eval=''               , PP=FALSE));
end if;	

return LesReglesDesc;
end method;

------------------------------------------------------------
method MoteurBSTest.GenererLesEvenements: Framework.Array of TarificationSrv.EvenementTarificationDesc
begin
ListeEvTarif : array of EvenementTarificationDesc = new();
unEvTarif    : EvenementTarificationDesc;

if unGenerateur = NIL then
   unGenerateur = new(); -- Seed positionné automatiquement
end if;

if TEST_NUMBER = 1 then

	for i in 1 to 50 do -- Test aléatoire
	
		unEvTarif = new();
		unEvTarif.NumClient.SetValue(i);
		unEvTarif.CodeService.SetValue(GenererNombre(MAX_RG_OPER));
		unEvTarif.CodeProduit.SetValue(GenererNombre(MAX_RG_PROD));
		unEvTarif.CodePackage.SetValue(GenererNombre(MAX_RG_PACK));
		unEvTarif.CodePromotion.SetValue(GenererNombre(MAX_RG_PROM));
		unEvTarif.CodeDevise.SetValue(GenererNombre(MAX_RG_DEV));
		unEvTarif.CodeCategorie.setValue(GenererNombre(MAX_RG_CAT));
	    ListeEvTarif.AppendRow(unEvTarif);
	    
	end for;

else -- Test des capacités de réduction du tarif normal

    for i in 1 to 50 do

		-- Catégorie Standard
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,HPK,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,HPK,PR1); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,PK1,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_STD,PK1,PR1); 
	
		-- Catégorie VIP
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,HPK,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,HPK,PR1); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,PK1,HPR); 
		CreerEvenementTest2(i,ListeEvTarif,CAT_VIP,PK1,PR1); 

	end for;

end if;

return ListeEvTarif;


end method;

------------------------------------------------------------
method MoteurBSTest.GenererNombre(input MaxRange: Framework.integer): Framework.IntegerNullable
begin
-- Génération d'un nombre aléatoire entre 1 et MaxRange
unEntier : IntegerNullable = new();
unEntier.SetValue(unGenerateur.Get());
unEntier.Mod(unEntier.Value,MaxRange);
unEntier.Value = unEntier.Value + 1;
return unEntier;
end method;

------------------------------------------------------------
method MoteurBSTest.GenererNumeroClient: Framework.TextData
begin
unNumClient : TextData = new();
unRandom    : RandomNumber = new();
unChiffre   : IntegerData = new();
for i in 1 to 7 do
  unChiffre.SetValue(unRandom.Get());
  unChiffre.Mod(unChiffre.Value,10);
  unNumClient.Concat(unChiffre.TextValue);
end for;
return unNumClient;
end method;

------------------------------------------------------------
method MoteurBSTest.Init
begin
super.Init();
-- Initialisation du service objet
-- Lecture des règles
-- Construction de l'arbre

unGenerateur = new();
unGenerateur.SetSeed(9321765408); -- Pour avoir toujours le même jeu de test
end method;

------------------------------------------------------------
method MoteurBSTest.InitialiseTest
begin
	-- Initialisation du service objet
	-- Lecture des règles
	-- Construction de l'arbre

	unGenerateur = new();
	unGenerateur.SetSeed(9321765408); -- Pour avoir toujours le même jeu de test
	
Task.Part.LogMgr.PutLine('INIT0 : INITIALISATION MEMOIRE DES TABLES (=DEBUT DU TRAITEMENT)');


/*
    UnContexte : Contexte;
--	unContexte = ContexteTarification();						  -- si NIL, contexte = variables initialisées pour le test	
	unCompilateur = new(Contexte=unContexte); -- Création d'une instance du compilateur avec liée à un contexte
	


Initialise(unContexte);
*/
Test();

return;

Exception
   when e : GenericException do
	   Task.Part.LogMgr.PutLine('EXCEPTION LEVEE, ABANDON TEST...');
       Self.TraceExc(e,'MoteurBS.Initialise');
       raise;
       
end method;

------------------------------------------------------------
method MoteurBSTest.Test
begin
-- Lancement du test du moteur de tarification

Self.ServiceStarted = FALSE;
CT = ContexteTarification();
Initialise(CT,true,false); -- Lancement de l'initialisation

Task.Part.LogMgr.PutLine('');
Task.Part.LogMgr.PutLine('INIT/INITIALISATION MAINTENANT TERMINEE, DEBUT DU TEST');
Task.Part.LogMgr.PutLine('TRT/GENERATION DES CRE');
Task.Part.LogMgr.PutLine('');

lesEvenements : array of EvenementTarificationDesc = GenererLesEvenements();
unTarif : NumericData;

Task.Part.LogMgr.PutLine('TRT/EVALUATION DES CRE');

ChronoEval : Chronometre = new();
ChronoEval.Fire();

if TEST_NUMBER = 1 then
	for i in 1 to 50 do
		for unEvt in lesEvenements do
	        unTarif = EvalueCRE(unEvt);
		end for;
	    if unTarif<>NIL then
	       Task.Part.LogMgr.Put(unTarif);
	       Task.Part.LogMgr.Put(' ');
		else
		   Task.Part.LogMgr.PutLine('Impossible de calculer un tarif');
	    end if;
	end for;
else
		Diviseur : integer = 0;
		
		for unEvt in lesEvenements do
	        unTarif = EvalueCRE(unEvt);
			if Diviseur = 8 then 
				Task.Part.LogMgr.PutLine('');
				Diviseur = 0;
			end if;
			Diviseur = Diviseur + 1;
		     if unTarif<>NIL then
		       Task.Part.LogMgr.Put(unTarif);
		       Task.Part.LogMgr.Put(' ');
			else
			   Task.Part.LogMgr.PutLine('Impossible de calculer un tarif');
		    end if;
		end for;
end if;

PutMessage('Temps total d''evaluation : ',ChronoEval.AsText());
PutMessage('Nombre de règles evaluees : ',CompteurEval);
Task.Part.LogMgr.PutLine('TRT FIN');

end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'wastespa';


end WasteSpace;
begin TOOL EvenementTarificationClt;

includes AddDicoBD;
includes AddFrameworkBD;
includes CatalogueSrv;
includes DataAccessBD;
includes DataAccessSrvBD;
includes DicoBD;
includes DicoSrvBD;
includes DisplayBD;
includes FrameworkBD;
includes DisplayProject;
includes Framework;
includes TarificationProc;
includes TarificationSrv;
HAS PROPERTY IsLibrary = FALSE;

-- START FORWARD CLASS DECLARATIONS
forward  ActionMgr;
forward  ControlWin;
forward  EvenementTarificationWin is mapped;
forward  FrontCommClt;
forward  InitApp;
forward  LoginWin is mapped;
forward  MenuWin is mapped;
-- END FORWARD CLASS DECLARATIONS

-- START FORWARD CURSOR DECLARATIONS
-- END FORWARD CURSOR DECLARATIONS

-- START CONSTANT DEFINITIONS
constant APP_APPLICATIONNAME = 'EVENEMENT DE TARIFICATION';
constant IDX_ZONEVIDE = '';
constant LOG_GRPFLAG = 60;
-- END CONSTANT DEFINITIONS

-- START C DATA TYPE DEFINITIONS
-- END C DATA TYPE DEFINITIONS

-- START CLASS DEFINITIONS

class ActionMgr inherits from DisplayBD.ActionMgrDesc

has public  method DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object);
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class ControlWin inherits from DisplayBD.ControlWinDesc

has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class FrontCommClt inherits from DisplayBD.FrontCommCltDesc

has public  method DoInitService;
has public  method Init;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=on, override=off, default=off);

end class;

class InitApp inherits from DataAccessBD.InitAppDesc

has public  method DoInitService;
has public  method DoOpenApplication;
has public  method Init;
has public  method StartApp;

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);

end class;

class EvenementTarificationWin is mapped inherits from DataAccessBD.StandardDataWin

has public  attribute SimulationBln: Framework.boolean;
has public  attribute TypeTarif: AddDicoBD.RefTypeTarifDesc;

has public  method ChangementProduit;
has public  method ChangementService;
has public  method CreerEvenement;
has public  method DoAffectObject(output pObject: Framework.Object);
has public  method DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc);
has public  method Init;
has public  method InitDisplay(input WithReadData: Framework.boolean = TRUE);
has public  method InitListField(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer);
has public  method InitScrollList(input aWidget: DisplayProject.Widget,
	input NomClassDico: Framework.string,
	input ListeSelection: Framework.Array of Framework.IntegerData);
has public  method InitWinPourRetrocessionSimulation;
has public  method InitWinPourTarification;
has public  method VerifierValidite;

has public  event handler ChangerSelectionEvh();
has public  event handler EventLoopHandler();
has public  event handler RetrocessionSaisieEvh();
has public  event handler StandardOutilsEvenementEvh();

has property
	shared=(allow=off, override=off);
	transactional=(allow=off, override=off);
	monitored=(allow=off, override=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.StandardWin',
		name = 'DataAccessBD.StandardDataWin');

has
+51514631000063000000580c9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+0000000000000000000202a0a00000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060600000101
+0001000092000003000b0001000000000003000021010200000000050400001c
+0214145374616e6461726420446174612057696e646f77170506007a08004d00
+9fff010101010f1011120101010100009fff010000000d00005dc05dbf000000
+000303030300020404a0a00000000000000000009d5dc09d5dbf000000000000
+01080768010000005dc05dbf0000000201000000000900000700002101020000
+0000080806007c08000d0005054772696430010104010f101112010101170001
+9fff0c0000000d2a1f130b1959000000000303030300050404606000002203e8
+07d000009d130b9d19590000000000000108091001000000130b195900000002
+0100000000040201009fff009fff20010100000a0000000404000100020b0c0d
+00090000210202000000000b0d0a06000302010000000000000b06007c08000d
+000d0d42617272654861757447726964010104010f1011120101011700029fff
+9e000100100000000d000001a119590001000103030303000801046060000022
+0000000000009d01a19d195900000000000001080e1001ff8100017719300000
+00020100000000040104009fff009fff20010100000f00000000000404000000
+00000210001100120013000e000021040200000000101211130f060003020900
+00000000001006007c08000d0015154465706c6163656d656e744f7574696c73
+47726964230104010f1011120101011700039fff9e000100130000000d000001
+7702af0001000103030303000b010160600000000000000000009d01779d02af
+0000000000000108141001ff8100014d0286000000020100000000040102009f
+ff009fff00010100001500000004040000000216001700140000210202000000
+00161715060003020100001414141416060113080201020c0c50726563656465
+6e7442746e01020421212121212121211700049fff9e000100110000000d1515
+0124012400010001030303030010010180800000000000000018199d01249d01
+240000000000000102001a001800001c020a0a5072e963e964656e740a101900
+001c0200101a00010f00011b1b00011200018014141c0001081414009d01900f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f08000f0f0f08000f0f0f0f0f0f0f0f0f0f0f0f0800
+010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f
+0f0f0f0f0800010f0f0800010f0f0f0f0f0f0f0f0f0f0f0800010f0f0800010f
+0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f0f0f0f0f0f0f0f00
+00080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f
+0f0f0f0f0f0f0f0f0f0000080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f0000
+080f0f0000080f0f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f00000f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f1c00011000019d0100009d030000000080
+80808000008080000080000080800000808000808080400040400080ff004080
+4000ff804000ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff
+8000ff8080ffff8080ffff0080ff804000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000017060113
+080201020a0a53756976616e7442746e01020421212121212121211700059fff
+9e000100120000000d9d014d1501240124000100020303030300100101808000
+0000000000001d1e9d01249d01240000000000000102001f001d00001c020808
+53756976616e740a101e00001c0200101f00010f000120200001120001801414
+210001081414009d01900f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f00080f0f0f00080f0f0f0f0f0f
+0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f
+0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f
+0f0f0f0f0f0f0100080f0f0100080f0f0f0f0f0f0f0f0f0f0f0f0f08000f0f0f
+08000f0f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f
+0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f
+0f0f0f0f0f0f0f0800000f0f0800000f0f0f0f0f0f0f0f0f0f0f0f00000f0f0f
+00000f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f210001100001
+9d0100009d030000000080808080000080800000800000808000008080008080
+80400040400080ff0040804000ff804000ffffffc0c0c0ff0000ffff0000ff00
+00ffff0000ffff00ffffff8000ff8080ffff8080ffff0080ff80400000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000001106007c08000d0012125374616e646172644f7574696c7347
+726964010104010f1011120101011700089fff9e000100180000000d9d068300
+017701770001000203030303000b010160600000000000000000009d01779d01
+770000000000000108221001ff8100014d014d00000002010000000004010100
+9fff009fff000101000023000004040000022400220000210102000000002423
+060003020100001414141424060113080201020b0b496d7072696d657242746e
+01020421212121212121211700099fff9e000100190000000d15150124012400
+010001030303030011010180800000000000000025269d01249d012400000000
+000001020027002500001c020909496d7072696d65720a102600001c02001027
+00010f000128280001120001801414290001081414009d01900f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0000000000000000000f0f0f0f0f0f0f0f0f0f000e0e0e0e
+0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e000f0f0f0f0f0f0f0f
+0f0f000e0e0e0e0e0e0e0e000f0f0f0f0f0f0f0f0f0f000e00000000000e0000
+00000f0f0f0f0f0f0f000e0e0e0e0e0e0e0e000f000f000f0f0f0f0f00000000
+0000000000000f000f00000f0f0f0f000f0f0f0f0f0f0f0f0f0f000f000f000f
+0f0f0f000000000000000000000000000f0f000f0f0f0f000f0f0f0f0f0f0101
+010f0f000f000f0f0f0f0f000f0f0f0f0f0f1111110f0f0000000f0f0f0f0f00
+0000000000000000000000000f000f0f0f0f0f0f000f0f0f0f0f0f0f0f0f000f
+000f0f0f0f0f0f0f0f00000000000000000000000f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f0f
+0f0f0f0f0f0f0f0f0f2900011000019d0100009d030000000080808080000080
+80000080000080800000808000808080400040400080ff0040804000ff804000
+ffffffc0c0c0ff0000ffff0000ff0000ffff0000ffff00ffffff8000ff8080ff
+ff8080ffff0080ff804000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000000000000000000000000000000000000000001206007c08000d001010
+4665726d65724f7574696c7347726964010104010f1011120101011700069fff
+9e000100160000000d9d0bcd00017701770001000303030303000b0101606000
+00220000000000009d01779d017700000000000001082a1001ff8100014d014d
+000000020100000000040101009fff009fff00010100002b000004040000022c
+002a0000210102000000002c2b06000302010000141414142c06011308020102
+0a0a5175697474657242746e01020421212121212121211700079fff9e000100
+170000000d151501240124000100010303030300120101808000000000000000
+2d2e9d01249d01240000000000000102002f002d00001c020808517569747465
+720a102e00001c0200102f00010f000130300001120001801414310001081414
+009d01900707070707070707070707070707070707f807070707070707070700
+00000000000000fefef80707070707070707070000000000000000fefef80707
+07070707fefe0700f8f8f8f8f8f8fe0404f8070707070707fe0606fef8f8f8f8
+f8fe040404f8070707070707fe060606f8f8f8f8fe04040404f8070707060606
+06060606fefef8fe0404040404f8070707060606060606060000f8fe04040404
+04f807070706060606060606f8f8f8fe0404040404f8070707070707fe060600
+f8f8f8fe0404040404f8070707070707fe060000f8f8f8fe0404040404f80707
+07070707fe00f800f8f8f8fe0403040404f807070707070707f8f800f8f8f8fe
+0403040404f807070707070707f80700f8f8f8fe0404040404f8070707070707
+07070700f8f8f8fe0404040407f807070707070707070707070707fe04040407
+07f807070707070707070707070707fe04040407070707070707070707070707
+070707fe04040707070707070707070707070707070707fe0407070707070707
+07070707070707070707070707070707070707073100011000019d0100009d03
+00000000800000008000808000000080800080008080c0c0c0c0dcc0a4c8f000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000000fffbf0a0a0a4808080ff000000ff00ffff000000ffff00ff00ffffffff
+ff1306007c08000d009fff230104010f1011120101011700009fff9e0002005b
+0000000d9d11175300c6043b0001000403500303000b01016060000000000000
+0000009cc69d043b000000000000010832100100000000c6043b000000020100
+000000040102009fff009fff0001010000330000000404000000023400350032
+0000210202000000003435330600030201000000000000340600f60820890207
+074375724d6f646521020b212121212101010117000a0606537472696e679e00
+0100200000000d000000c6021e00010001030303030013010280a00000000000
+000000009cc69d021e00000000000001030201070007000009ff8100009e0040
+0014030100350600f6082089020606437572506f7321020b2121212121010101
+17000b0606537472696e679e000100210000000d9d021e0000c6021e00010002
+030303030013010280a00000000000000000009cc69d021e0000000000000103
+0201070007000009ff8100009e004000140301000c0600030209000000000000
+0d06007c08000d000909436f72707347726964010104010f1011120101011700
+0c9fff9e000100140000000d009d01a1116a1959000200010303030300080404
+60600000220000000000009d116a9d1959000000000000010836100100000011
+6a1959000000020100000000040102009fff009fff2001010000370000000404
+0001000238003900360000210202000000003938370600030201000000000000
+3806007c08000d00090947726964456372616e010104010f1011120101011700
+1d9fff9e0002000f0000000d0000116a17700001000103030303000d04046060
+0000220000000000009d116a9d177000000000000001083a1001000000116a17
+70000000020100000000040201009fff009fff00010100003b00000004040100
+00023c003d003a0000210202000000003d3c3b06000302010000000000003c06
+007c08000d009fff010104010f1011120101011700009fff9e00020010000000
+0d00000eef177000010001030303030038040460600000220000000000009d0e
+ef9d177000000000000001083e10010000000eef177000000002010000000004
+0101009fff009fff00010100003f0000040400000240003e0000210102000000
+00403f06000302000000000000004006007c08000d00090947726964546f7461
+6c010104010f1011120101011700219fff9e000200110000000d00000eef1770
+0001000103030303003c040460600000220000000000009d0eef9d1770000000
+00000001084110010000000eef1770000000020100000000040101009fff009f
+ff00010100004200000404000002430041000021010200000000434206000302
+010000000000004306007c08000d000a0a4772696450616e656c30010104010f
+1011120101011700229fff9e0002002f0000000d00000eef1770000100010303
+03030040040460600000220000000000009d0eef9d1770000000000000010844
+10010000000eef1770000000020100000000040201009fff009fff0001010000
+4500000004040100000246004700440000210202000000004746450600030201
+0000000000004606007a08004d00060650616e656c30010104010f1011120101
+011700289fff0e0000000d00000bb81770000100010351030300430404606000
+00220bb8177000009d0bb89d177000000000000001084860010000000bb81770
+00000002010000000009000048000021010200000000494906007c08000d0009
+094576656e656d656e74010104010f10111201010117002919194576656e656d
+656e74546172696669636174696f6e446573639e000200300000000d0a000bb8
+175b00000000030303030046040460600000220000000000009d0bb89d175b00
+000000000001084a1001ff81000b8e1731040000020100000000040101009fff
+009fff00010100004b000004040000024c4d4a0000210102000000004c4b0600
+0302010000000000004c06007c08000d000d0d477269644576656e656d656e74
+010104010f10111201010117002a9fff9e0002005c0000000d00000b8e173100
+010001030303030049040460600000220000000000009d0b8e9d173100000000
+000001084e1001ff81000b651707000000020100000000040102009fff009fff
+20010100004f000000040400010002500051004e00002102020000000051504f
+06000302060000000000005006007c08000d000d0d4772696453656c65637469
+6f6e010104010f1011120101011700349fff9e000200690000000d00000b650a
+170001000103030303004c040460600000220000000000009d0b659d0a170000
+000000000108521001ff81000b3b09ee000000020100000000040101009fff00
+9fff000101000053000004040000025400520000210102000000005453060003
+02010000000000005406007c08000d0012124772696450726f64756974536572
+76696365010104010f1011120101011700359fff9e0002006a0000000d00000b
+3b09ee00010001030303030050040460600000220000000000009d0b3b9d09ee
+0000000000000108551001ff81000b1109c4000000020100000000040201009f
+ff009fff00010100005600000004040000000257585900550000210202000000
+00575956060003020100009d012c9cc89cc89cc85706007c08000d000b0b4772
+696450726f64756974010104010f1011120101011700369fff9e0002006e0000
+000d9cc69d012e03f20838000100010303030300540404606000002200000000
+00009d03f29d083800000000000001085a100100000003f20838000000020100
+000000040201009fff009fff00010100005b0000000404000100025c005d5e5a
+0000210202000000005c5d5b06000302010000000000005c060092082081020c
+0c546974726550726f6475697421210401212121212121212100379fff9e0002
+006f0000000d000000b10838000100010316030300570104a0a0000022000000
+0000009cb19d08380000000000000103000b5f0201ff819e0044001400000000
+005f00001c02070750726f64756974105d0600b0080009020b0b436f64655072
+6f64756974010204212121212101010117003812125265665479706550726f64
+756974446573639e000200700000000d009cb102470838000200010305030300
+57010480a00000220000001e00009d02479d0838000000000000010302010460
+0700000003046000002100020001a6015e060003020600000000000058060003
+02010000646464005906007c08000d000b0b4772696453657276696365010104
+010f1011120101011700399fff9e0002006e0000000d9cc69d064f03fd083800
+020001030303030054040460600000220000000000009d03fd9d083800000000
+0000010861100100000003fd0838000000020100000000040201009fff009fff
+0001010000620000000404000100026300646561000021020200000000636462
+060003020100000000000063060092082081020c0c5469747265536572766963
+65212104012121212121212121003a9fff9e0002006f0000000d000000b10838
+000100010316030300590104a0a00000220000000000009cb19d083800000000
+00000103000b660201ff819e0044001400000000006600001c02080853657276
+6963650a10640600b0080009020b0b436f646553657276696365010204212121
+212101010117003b12125265665479706553657276696365446573639e000200
+700000000d009cb10247083800020001030503030059010480a0000022000000
+1e00009d02479d08380000000000000103020104670700000003046700002100
+020001a6016506000302060000000000005106007c08000d000c0c4772696456
+61726961626c65010104010f10111201010117002b9fff9e000200840000000d
+9d0a17000b650cf00001000203030303004c040460600000220000000000009d
+0b659d0cf000000000000001086810010000000b650cf0000000020100000000
+040201009fff009fff2001010000690000000404000000026a006b0068000021
+0202000000006b6a6906000302010000000000006a06007c08000d000e0e4772
+69644465636f436c69656e74010104010f1011120101011700319fff9e000200
+720000000d000005b20cf0000100010303030300510404606000002200000000
+00009d05b29d0cf000000000000001086c1001ff810005890cc7000000020100
+000000040101009fff009fff20010100006d000004040000026e006c00002101
+02000000006e6d060003020100009cc89cc89d01909d01906e06007c08000d00
+0a0a47726964436c69656e74010104010f1011120101011700329fff9e000200
+730000000d9d03f29d0209017704e20001000103030303006a01016060000022
+0000000000009d01779d04e200000000000001086f1001000000017704e20000
+00020100000000040201009fff009fff00010100007000000004040000000271
+7273006f00002102020000000071737006000302010000000000007106009208
+2081029fff21210401212121212121212100009fff9e000200920000000d0000
+00b104e20001000103160403006e0404a0a00000220000000000009cb19d04e2
+0000000000000103000b740201ff819e0040001400000000007400001c021111
+4e756de9726f20647520436c69656e740a187206000302080000000000007306
+00f60820890209094e756d436c69656e7401020b21212121210101011700330d
+0d4e756d436c69656e74446573639e000200750000000d009cb100c604e20002
+000103050303006e010280a00000440000000000009cc69d04e2000000000000
+01030201070012000009ff8100009e004000240301006b06007c08000d000f0f
+477269644465636f4d6f6e74616e74010104010f10111201010117002c9fff9e
+000200760000000d009d05b205b20cf000020001035103030051040460600000
+220000000000009d05b29d0cf00000000000000108751001ff810005890cc700
+0000020100000000040102009fff009fff200101000076000000040400000002
+7700780075000021020200000000787776060003020100009cc89cc89d01909d
+01907706007c08000d000b0b477269644d6f6e74616e74010104010f10111201
+010117002f9fff9e0002007a0000000d9d018c9d020901770412000100010303
+0303006b010160600000220000000000009d01779d0412000000000000010879
+100100000001770412000000020100000000040201009fff009fff0001010000
+7a0000000404000000027b007c00790000210202000000007b7c7a0600030201
+0000000000007b060092082081029fff21210401212121212121212100009fff
+9e000200870000000d000000b10412000100010316040300770404a0a0000022
+0000000000009cb19d04120000000000000103000b7d0201ff819e0040001400
+000000007d00001c0208084d6f6e74616e740a107c0600f60820890207074d6f
+6e74616e7401020b21212121210101011700301111547970446f75626c654e75
+6c6c61626c659e0002007c0000000d009cb100c6041200020001030503030077
+010280a00000440000000000009cc69d04120000000000000103020107000f04
+0009ff8100009e004000240301007806007c08000d000c0c477269645175616e
+74697465010104010f10111201010117002d9fff9e000200770000000d9d0729
+9d0209017704120001000203030303006b010160600000220000000000009d01
+779d041200000000000001087e10010000000177041200000002010000000004
+0201009fff009fff00010100007f000000040400000002808182007e00002102
+020000000080827f060003020100000000000080060092082081020000212104
+01212121212121212100009fff9e000200860000000d000000b1041200010001
+0316040300780404a0a00000220000000000009cb19d04120000000000000103
+000b830201ff819e0040001400000000008300001c0209095175616e746974e9
+0a10810600030208000000000000820600f60820890208085175616e74697465
+01020b212121212101010117002e1212547970496e74656765724e756c6c6162
+6c659e000200790000000d009cb100c6041200020001030503030078010280a0
+0000440000000000009cc69d04120000000000000103020107000f040009ff81
+00009e004000240301004d06000302060000000000004706007c08000d001414
+47726964426f75746f6e734576656e656d656e74010104010f10111201010117
+00239fff9e000200370000000d009d0bb8033717700002000103030303004304
+0460600000220000000000009d03379d17700000000000000108841001ff8100
+030d1746000000020100000000040101009fff009fff00010100008500000404
+000002860084000021010200000000868506000302010000646400008606007c
+08000d009fff010104010f1011120101011700009fff9e000200890000000d00
+68023d174600010001030303030047040460600000220000000000009d023d9d
+17460000000000000108871001000000023d1746000000020100000000040102
+009fff009fff20010100008800000004040000000289008a0087000021020200
+000000898a88060003020100000000009cc88906007c08000d000d0d47726964
+4465636f526574726f010104010f1011120101011700249fff9e0002008a0000
+000d0000023d0d7800010001035103030086040460600000220000000000009d
+023d9d0d7800000000000001088b1001000000023d0d78000000020100000000
+040101009fff009fff20010100008c000004040000028d008b00002101020000
+00008d8c0600030201000064649cc89cc88d0600b2080009020f0f526574726f
+63657373696f6e426c6e01020421212121210101011700250707496e74656765
+729e000200880000000d9d033768016d07000001000103030303008901018080
+0000220000000000009d016d9d070000000000000001030201048e0702000004
+14010000000000008e00002102020001a6018f908f0001a60301910000000091
+00001c020c0c546172696669636174696f6e10900001a6030292000000009200
+001c020c0c526574726f63657373696f6e108a06007c08000d00141447726964
+56616c696465724576656e656d656e74010104010f1011120101011700269fff
+9e0002003d0000000d9d10af6801620356000100020303030300860101606000
+00220000000000009d01629d03560000000000000108931001ff81000139032c
+000000020100000000040101009fff009fff0001010000940000040400000295
+0093000021010200000000959406000302010000141414149506007808020102
+131356616c696465724576656e656d656e7442746e01020a2121212121212121
+1700279fff9e0002003e0000000d1515010f03030001000103030303008a0202
+a0a00000220000000000009d010f9d0303000000000000010b070756616c6964
+6572000201000000003d06007c08000d000c0c4469616c6f6775654772696402
+0104010f10111201010117001e9fff9e0001001c0000000d009d0eef027b1770
+0002000103000303003804046060000022000003e800009d027b9d1770000000
+0000000108961001ff810002521746000000020100000000040201009fff009f
+ff20010100009700000004040001000298009900960000210202000000009899
+97060003020200000000000098060092082081020d0d54697472654469616c6f
+677565212104012121212121212121001f9fff9e0002005a0000000d000000b1
+17460001000103160303003d0104a0a00000220000000000009cb19d17460000
+000000000103000b9a0201ff819e0044001400000000009a00001c0209094469
+616c6f6775650a1099060084082009020b0b5374617475735f4c696e6502020c
+2121212121010101170020080854657874446174610d0000000d009cb101a117
+460002000103030303003d0204a0a00000440002005000009d01a19d17460100
+000000000103020107005b04000501020000ff81013906007c08000d000f0f42
+6172726544726f69746547726964230104010f10111201010117000d9fff9e00
+01000c0000000d9d177000116a01ea0001000203030303000d04016060000022
+0000000000009d116a9d01ea00000000000001089b1001ff8100114101c00000
+00020100000000040201009fff009fff20010100009c9c000000040400000002
+9c9d009c9e009b0000210202000000009c9e9c9d9c9c06000302070000141400
+009c9d06007c08000d000d0d4374694f7574696c7347726964010104010f1011
+120101011700139fff9e000100230000000d499d01240afd012e000100010303
+03030039010160600000000000000000009d0afd9d012e00000000000001089c
+9f10010000000afd012e000000020100000000040901009fff009fff20010100
+009ca000000000000000000000040400000000000000000000029ca1009ca200
+9ca3009ca4009ca5009ca6009ca7009ca8009ca9009c9f000021090200000000
+9ca19ca29ca39ca49ca59ca69ca89ca99ca79ca0060003020100001e1e00009c
+a1060113080201020b0b446563726f63686542746e2202042121212121212121
+1700149fff9e000100240000000d001f012401240001000103030303009c9d01
+018080000000000000009caa9cab9d01249d01240000000000000102009cac00
+9caa00001c020a0a44e963726f636865720a109cab00001c0200109cac00010f
+00019cad9cad00011200018014149cae000104140a009cc81111111111111111
+1111111122222222222211111122000000000000221112200000000000000221
+2200002222222200002220000221111112200002200002111111112000022222
+2211111111222222111111111111111111111111122111111122111111112002
+2222220021111111200000000000211111120000202020000211112200000000
+0000022112200000202020000021220000000000000000222000000020202000
+0002200000000000000000021222222222222222222111111111111111111111
+9cae0001100001030009ffff00c0c0c00000009ca2060113080201020c0c5261
+6363726f63686542746e22020421212121212121211700159fff9e0001002500
+00000d009d0162012401240002000103030303009c9d01018080000000000000
+009caf9cb09d01249d01240000000000000102009cb1009caf00001c020b0b52
+616363726f636865720a109cb000001c0200109cb100010f00019cb29cb20001
+1200018014149cb3000104140a009cc800000000333000000000001111113331
+1111110001222222333222222210012222223332222222101222222233322222
+2221122221103330011222211111110033300011111112222100333000122221
+0111110033300011111000000000333000000000000003333333330000000000
+0033333330000000000000033333000000000000000033300000000000000000
+0300000000000000111000000111000000011111111111111000001222222222
+2222100001222222222222222100444444444444444444449cb3000110000105
+000fc0c0c0000000ffff00ff0000ffffff9ca3060113080201020a0a4c696265
+72657242746e22020421212121212121211700169fff9e000100260000000d00
+9d02a50143012e0003000103030303009c9d01018080000000000000009cb49c
+b59d01439d012e0000000000000102009cb6009cb400001c0206064c69627265
+0a109cb500001c0200109cb600010f00019cb79cb700011200018017159cb800
+0104160b009cfd00000000000000000000810000000000000000000281000000
+0000000000002281000000000000000002228100000000000000000220810000
+0000000000002220810000000000000002220081000000000000002220008100
+0000000000002220008100000000000002220000810200000000002222000081
+0220000000022220000081022200000002220000008102222000002222000000
+8102222200022220000000810222222022222000000081002222222222000000
+0081000222222220000000008100002222222000000000810000022222000000
+0000810000002222000000000081000000022000000000008100000000000000
+000000819cb80001100001030009c0c0c000000000ff009ca406011308020102
+0a0a417474656e746542746e22020421212121212121211700179fff9e000100
+270000000d009d0407011901240004000103030303009c9d0101808000002200
+0000009cb99cba9d01199d01240000000000000102009cbb009cb900001c0208
+08417474656e74650a109cba00001c0200109cbb00010f00019cbc9cbc000112
+00018013149cbd000104140a009cbe0000000000000000000000000001110000
+0000000000011122100000000000001221221110000000000012212212210000
+0000111221221221000000012212212212210000000122122122122100000001
+2212212212210000000122122122122100110001222222222221012210012222
+2222222112221001222222222222222100012222222222222210000122222222
+2222210000012222222222221000000012222222222100000000012222222210
+000000000011111111000000009cbd0001100001030009c0c0c0000000ffff00
+9ca5060113080201020c0c5472616e736665727442746e220204212121212121
+21211700189fff9e000100280000000d009d0540012401240005000103030303
+009c9d01018080000000000000009cbe9cbf9d01249d01240000000000000102
+009cc0009cbe00001c020b0b5472616e7366e97265720a109cbf00001c020010
+9cc000010f00019cc19cc1000112000180141400000118143c009d04b0c6c6c6
+c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c600000000
+0000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6000000000000000000000000000000c6c6c6000000ffff00ffff00ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ff
+ff00ffff00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00
+ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff
+00ffff00ffff00ffff00000000000000ffff00ffff00ffff00ffff00ffff0000
+0000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000000000ffff00ffff00ffff00
+ffff00ffff00000000000000ffff00ffff00000000000000000000c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6ff0000c6c6c6000000000000000000ffff00ff
+ff00000000000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6c0c0c0
+c6c6c6c6c6c6c0c0c0ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff000000
+00000000ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000c0c0c0c6
+c6c6ff0000ff0000c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000
+ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6ff0000ff0000c6c6c6ff00
+00c0c0c0c0c0c0c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ff
+ff00000000c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0ff0000ff0000c0c0c0
+c6c6c6c6c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff000000
+00c0c0c0c0c0c0c6c6c6c6c6c6ff0000c0c0c0c0c0c0ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0
+c0c0c0c6c6c6ff0000ff0000c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0
+c0000000ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c6
+c6c6ff0000c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c6c6c6c6c6c6c0c0c0000000
+ffff00ffff00000000000000ffff00ffff00000000c0c0c0c0c0c0c0c0c0ff00
+00c0c0c0c0c0c0c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0c0c0c0000000ffff00ff
+ff00000000000000ffff00ffff00000000000000000000c0c0c0ff0000c0c0c0
+c0c0c0c0c0c0c6c6c6c0c0c0c0c0c0000000000000000000ffff00ffff000000
+00000000ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000
+ffff00ffff00000000ffff00ffff00000000ff0000c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6000000ffff00ffff00000000ffff00ffff00000000000000ffff00ff
+ff00000000ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+000000ffff00ffff00000000ffff00ffff00000000000000ffff00ffff000000
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6000000ff
+ff00ffff00000000ffff00ffff00000000c6c6c6000000000000000000000000
+000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c60000000000
+00000000000000000000c0c0c09ca6060113080201020808506175736542746e
+22020421212121212121211700199fff9e000100290000000d009d0683012401
+240006000103030303009c9d01018080000000000000009cc29cc39d01249d01
+240000000000000102009cc4009cc200001c02060650617573650a109cc30000
+1c0200109cc400010f00019cc59cc5000112000180141400000118143c009d04
+b0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c60000000000000000000000000000000000000000000000
+00000000000000000000000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6000000000000ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00
+ffff00ffff00ffff00000000000000c6c6c6c6c6c6c6c6c6c6c6c6c6c6c60000
+00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ffff00ff
+ff00ffff00ffff00000000c0c0c0c6c6c6c6c6c6c6c6c6000000ffff00ffff00
+ffff00000000000000000000000000000000000000000000000000000000ffff
+00ffff00ffff00000000c6c6c6c6c6c6c6c6c6000000ffff00ffff0000000000
+0000c6c6c6000000ffff00ffff00ffff00000000c6c6c6000000000000ffff00
+ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0000000000000000000c6c6c60000
+00ffff00ffff00ffff00ffff00ffff00000000c0c0c0c0c0c0000000000000c0
+c0c0c0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00000000
+000000000000000000000000ffff00000000c0c0c0c6c6c6c6c6c6c0c0c0c0c0
+c0c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0000000ffff00ffff00000000ffffffff
+ffffffffff000000ffff00ffff00000000c0c0c0c6c6c6c0c0c0c6c6c6c6c6c6
+c0c0c0c0c0c0c0c0c0000000ffff00ffff00ffff00000000ffffffffffffffff
+ff000000ffff00ffff00ffff00000000c6c6c6c0c0c0c6c6c6c0c0c0c0c0c0c0
+c0c00000000000ff0000ff0000ff0000ff0000ff0000ff000000000000000000
+ffff00ffff00ffff00ffff00000000c6c6c6c6c6c6c0c0c0c0c0c0c0c0c00000
+ff0000ff0000ff0000ff0000ff0000ff0000ffffff00ffff00ffff00ffff00ff
+ff00ffff00ffff00000000c6c6c6c6c6c6c0c0c0c0c0c00000ff80ffff0000ff
+0000ff0000ff0000ff0000ff0000ff0000000000000000000000000000000000
+00000000c0c0c0c6c6c6c6c6c6c0c0c00000ff00ffff80ffff0000ff0000ff00
+00ff0000ff0000ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0
+c0c0c0c6c6c6c6c6c6c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000
+ff0000ff0000ffc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0
+c0c0c6c6c6c0c0c00000ff80ffff80ffff0000ff0000ff0000ff0000ff0000ff
+0000ffc0c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c0c0c0c0c0c00000ff80ffff0000ff0000ff0000ff0000ff0000ff0000ffc0
+c0c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0
+c0c0c0c0c0c00000ff0000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0
+c0c0c0c0c00000ff0000ff0000ff0000ff0000ff0000ffc6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c0c0c0c0c0c0c0c0c0c0c0
+c0c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6
+c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c6c69ca7060113080201020e0e46696e45
+6e726567697374726572230204212121212121212117001c9fff9e0001002c00
+00000d009d07c6012401240007000103030303009c9d01018080000000000000
+009cc69cc79d01249d01240000000000000102009cc8009cc600001c020c0c45
+6e7265676973747265720a109cc700001c0200109cc800010f00019cc99cc900
+011200018014149cca000104140a009cc8331111111111111111333330000000
+0000000333333311111111111133330333300000000003333000333320004444
+3333400003333000000333300000003333000033330000100003333443333400
+0110000433333333440001100004033333304400011000044033330444000110
+0004433333344400011000003333333300000110011333300333311001101133
+3300003333110110133330000003333101103333100000013333011333310000
+000013333133330000000000003333333111111111111113319cca0001100001
+05000f000000c0c0c000ffffff0000ffffff9ca8060113080201020b0b456e72
+6567697374726572220204212121212121212117001a9fff9e0001002a000000
+0d009d0909012401240008000103030303009c9d01018080000000000000009c
+cb9ccc9d01249d01240000000000000102009ccd009ccb00001c020c0c456e72
+65676973747265720a109ccc00001c0200109ccd00010f00019cce9cce000112
+00018014149ccf000104140a009cc81111111111111111111110000000000000
+0000011011111111111111110100000000000000000000003020200044444444
+4000000000000000000000000000000000000000001000044444444444000110
+0004404444044400011000040004400044000110000440444404440001100004
+4444444444000110000000000000000001100111000000001110011011111000
+0001111101101111100000011111011011111000000111110110011100000000
+11100110000000000000000001111111111111111111119ccf00011000010500
+0f000000c0c0c000ffffff0000ffffff9ca90600f60820890207074574617443
+7469020204212121212101010117001b080854657874446174619e0001002b00
+00000d0a9d0a4b0092010f0009000103050303009c9d010180a0000044000000
+009cd09cd1929d010f020000000000010301053c00070005040009ff8100009e
+004020140301009cd000001c0210104574617420636f6e7365696c6c65720a11
+9cd100001c0200109c9e06007c08000d00111147656e6572616c4f7574696c73
+47726964230104010f10111201010117000e9fff9e000100150000000d009d0d
+4e03de01c000020001030303030039010160600000220000000000009d03de9d
+01c000000000000001089cd21001ff810003b401960000000201000000000401
+01009fff009fff20010100009cd3000004040000029cd4009cd2000021010200
+0000009cd49cd306000302010000141414149cd406007c08000d001616537461
+6e646172644f7574696c734772696456657274010104010f1011120101011700
+0f9fff9e0001002f0000000d1515038a016d0001000103030303009c9e010160
+600000000000000000009d038a9d016d00000000000001089cd51001ff810003
+610143000000020100000000040301009fff009fff00010100009cd600000000
+040400000000029cd7009cd8009cd9009cd50000210302000000009cd89cd79c
+d99cd606000302010000141414149cd7060113080201020a0a416a6f75746572
+42746e01220421212121212121211700119fff9e0001001b0000000d1515010f
+01190001000103030303009cd401018080000000000000009cda9cdb9d010f9d
+01190000000000000102009cdc009cda00001c0208084e6f75766561750a109c
+db00001c0200109cdc00010f00019cdd9cdd00011200018012139cde00010813
+13009d0156070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070704070707070707070707070707070707070707040407070707
+0707070704070707070707070704020407070707070407040704070707070707
+0402020407070707070404040707070707070704020202040707040404040404
+0407070707070402020407070707070404040707070707070704020407070707
+0704070407040707070707070404070707070707070704070707070707070704
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707070707070707
+0707070707070707070707070707070707070707070707070707079cde000110
+00019d0100009d0300000000bf000000bf00bfbf000000bfbf00bf00bfbfc0c0
+c0c0dcc0a6caf000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000fffbf0a0a0a4808080ff000000ff00ffff000000ff
+ff00ff00ffffffffff9cd8060113080201020c0c5375707072696d657242746e
+01220421212121212121211700109fff9e0001001a0000000d1f9d0139010401
+040002000103030303009cd401018080000000000000009cdf9ce09d01049d01
+040000000000000102009ce1009cdf00001c020a0a5375707072696d65720a10
+9ce000001c0200109ce100010f00019ce29ce200011200018011119ce3000108
+1111009d01210707070707070707070707070707070707070707070707070000
+07070707070707070707070707070000ff0000070707070707070707070700ff
+00ff00ff000707070707070707070700ff00ff00ff0707070707070707070707
+00ff00ff070707010107070707070707070707000707f80101f8f80707070000
+00f801010007f80101f8f80707070700ffff00f8f801010101f8f80007070707
+0700ffff0007f8010101f8ff0007070707070700ff07070101010101ff000707
+0707070700ff07f80101f8f80101000707070707070707070101f8f8ff0101f8
+0707070707070707f80101f8fffffff80107070707070707070101f8f8000000
+0701f80707070707070701f8f80707070707f8f8070707070707070707070707
+070707070707079ce300011000019d0100009d0300000000bf000000bf00bfbf
+000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000fffbf0a0a0a4808080
+ff000000ff00ffff000000ffff00ff00ffffffffff9cd9060113080201020909
+53617576657242746e01020421212121212121211700129fff9e000100220000
+000d1f9d025200fa00fa0003000103030303009cd40101808000000000000000
+9ce49ce59cfa9cfa0000000000000102009ce6009ce400001c02070753617576
+65720a109ce500001c0200109ce600010f00019ce79ce700011200018010109c
+e80001081010009d010007070707070707070707070707070707070000000000
+0000000000000000000707000300070707070707070700070007070003000707
+0707070707070000000707000300070707070707070700030007070003000707
+0707070707070003000707000300070707070707070700030007070003000707
+0707070707070003000707000303000000000000000003030007070003030303
+0303030303030303000707000303000000000000000000030007070003030000
+0000000007070003000707000303000000000000070700030007070003030000
+0000000007070003000707070000000000000000000000000007070707070707
+070707070707070707079ce800011000019d0100009d0300000000bf000000bf
+00bfbf000000bfbf00bf00bfbfc0c0c0c0dcc0a6caf000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000fffbf0a0a0a4
+808080ff000000ff00ffff000000ffff00ff00ffffffffff0606005e08002e00
+9fff03030303030303030303030300009fff0200000008009fff000000000000
+000000000002019ce9019ce90000210402000000009cea9ceb9cec9ced9cea06
+005c08000e00090943747874506f705570030303030303030303030303003c9f
+ff9e0001002d0000000806090943747874506f705570000000029cee00000000
+000002019cef0103ff009cee00001c0200109cef0000210102000000009cf09c
+f006006a0800020007074974656d547374030303020303030303030303003d9f
+ff9e0001002e000000089cea07074974656d547374000000039cf10000000000
+00010200ff9cf100001c0200109ceb06005c08000e00040466696c6501030303
+0303030303030303003e9fff10000000080605052646696c6500000000000000
+0000000002019cf20103ff009cf20000210202000000009cf39cf49cf306006a
+0800020205057072696e74030303020303030303030303003f9fff1100000008
+9ceb9fff0000000000000000000000010200129cf406006a080002020a0a7072
+696e74736574757003030302030303030303030300409fff12000000089ceb9f
+ff0000000000000000000000010200119cec06005c08000e000606416374696f
+6e01030303030303030303030300419fff150000000806070726416374696f6e
+000000000000000000000002019cf50103ff009cf50000210102000000009cf6
+9cf606006a0800020209094e657757696e646f77030303020303030303030303
+00429fff16000000089cec0b0b264e65772057696e646f770000000000000000
+00000001020eff9ced06005c08000e00040448656c7001030303030303030303
+030300439fff1700000008069fff000000000000000000000002019cf7010303
+009cf70000210002000000009cf71a919c9c9cb89d01189d01239d01a19d01ad
+9d01b99d024b9d02599d02659d02f79d03039d030f9d036c9d037e9d03859d03
+8c9d052f9d083c9d08999d08a99d08b09d08b79d0a5a9d0d679d0df49d0dff9d
+0e0b9d0e679d0e789d0e7f9d0e869d10299d13369d13c19d13cc9d13d89d1433
+9d14439d144a9d14519d15f49d19019d197f9d198b9d19979d1a059d1a749d1a
+809d1b089d1b149d1b209d1ba69d1bb29d1bbe9d1c379d1c429d1c4e9d1cd09d
+1cdb9d1ce79d1d6e9d1d7a9d1d869d1dec9d1df79d1e929d1e9d9d1ea99d1f33
+9d1f3f9d1f4b9d1fd19d1fdc9d1fe89d20779d20839d20949d211f9d212b9d21
+379d21a19d21b09d22269d22309d223c9d22489d22d39d22df9d22eb9d23559d
+23659d23db9d23e59d23f19d247c9d24889d24949d251b9d25269d25389d25c3
+9d25cf9d25db9d26399d26529d265e9d26d69d27649d27709d27829d280e9d28
+1a9d28269d28849d28949d290e9d299b9d29a79d29b39d2a119d2a229d2a2e9d
+2aaa9d2ab69d2b459d2b509d2b5c9d2bd99d2be59d2bf29d2c789d2c839d2c91
+9d2d089d2d149d2d1f9d2d339d2d3e9d2d529d2de19d2dec9d2df89d2e699d2e
+f49d2f009d2f0c9d2f779d2f889d2ff59d30869d30949d30a19d31559d31729d
+317f9d31e09d31f39d31fb9d32049d32e09d32f39d33579d336b9d33739d337c
+9d34589d34719d34d39d34e29d34ea9d34f39d36049d36179d36799d368a9d36
+929d369b9d376d9d37809d37e49d37f89d38009d38099d3ccd9d3d2d9d3d3c9d
+3d449d3d4d9d42119d42779d428c9d42949d429d9d43799d43929d43f59d440a
+9d44129d441b9d44f79d45109d45879d45a09d45a89d46389d46459d46529d46
+f09d47019d470e9d476e9d477f9d47879d47909d48fb9d4c099d4c6d9d4c809d
+4c889d4c919d4dc79d50d59d51349d51449d514c9d51559d526a9d55789d55aa
+9d55bd9d560a9d56129d561f9d56659d566d9d56ac9d56bb9d56f39d57309d57
+739d57809d57c79d58019d580c9d02b6191a38626377919b9c9c9ca09cb89cd6
+9d01009d01019d01159d01189d01229d01239d01469d01709d01719d01859d01
+9c9d01a19d01ab9d01ad9d01b99d01e89d02129d02139d02279d02429d024b9d
+02559d02599d02659d029c9d02c69d02c79d02db9d02f29d02f79d03019d0303
+9d030f9d033d9d03679d03689d036c9d03709d037e9d03829d03859d03899d03
+8c9d03969d052f9d083c9d08689d08949d08959d08999d089d9d08a99d08ad9d
+08b09d08b49d08b79d08c19d0a5a9d0d679d0d9b9d0dc79d0dc89d0ddc9d0df1
+9d0df49d0dfe9d0dff9d0e0b9d0e389d0e629d0e639d0e679d0e6b9d0e789d0e
+7c9d0e7f9d0e839d0e869d0e909d10299d13369d13689d13949d13959d13a99d
+13be9d13c19d13cb9d13cc9d13d89d14049d142e9d142f9d14339d14379d1443
+9d14479d144a9d144e9d14519d145b9d15f49d19019d19239d194e9d194f9d19
+639d197a9d197f9d19899d198b9d19979d19c69d19ef9d19f09d19f39d19f89d
+1a059d1a339d1a5e9d1a5f9d1a629d1a679d1a749d1a809d1aab9d1ad79d1ad8
+9d1aec9d1b039d1b089d1b129d1b149d1b209d1b4b9d1b759d1b769d1b8a9d1b
+a19d1ba69d1bb09d1bb29d1bbe9d1be09d1c0a9d1c0b9d1c1f9d1c349d1c379d
+1c419d1c429d1c4e9d1c799d1ca39d1ca49d1cb89d1ccd9d1cd09d1cda9d1cdb
+9d1ce79d1d139d1d3d9d1d3e9d1d529d1d699d1d6e9d1d789d1d7a9d1d869d1d
+aa9d1dd49d1dd59d1de99d1dec9d1df69d1df79d1e3b9d1e659d1e669d1e7a9d
+1e8f9d1e929d1e9c9d1e9d9d1ea99d1ed89d1f029d1f039d1f179d1f2e9d1f33
+9d1f3d9d1f3f9d1f4b9d1f7a9d1fa49d1fa59d1fb99d1fce9d1fd19d1fdb9d1f
+dc9d1fe89d201c9d20469d20479d205b9d20729d20779d20819d20839d20949d
+20c19d20ee9d20ef9d21039d211a9d211f9d21299d212b9d21379d21659d218e
+9d218f9d21919d21a19d21a59d21b09d21ef9d221a9d221b9d221e9d22249d22
+269d22309d22309d223c9d22489d22759d22a29d22a39d22b79d22ce9d22d39d
+22dd9d22df9d22eb9d23199d23429d23439d23459d23559d23599d23659d23a4
+9d23cf9d23d09d23d39d23d99d23db9d23e59d23e59d23f19d241f9d244b9d24
+4c9d24609d24779d247c9d24869d24889d24949d24c49d24ee9d24ef9d25039d
+25189d251b9d25259d25269d25389d25649d25929d25939d25a79d25be9d25c3
+9d25cd9d25cf9d25db9d25fd9d26269d26279d26299d26399d263d9d26529d26
+5e9d26969d26c09d26c19d26c49d26c99d26d69d27079d27339d27349d27489d
+275f9d27649d276e9d27709d27829d27af9d27dd9d27de9d27f29d28099d280e
+9d28189d281a9d28269d28489d28719d28729d28749d28849d28889d28949d28
+ce9d28f89d28f99d28fc9d29019d290e9d293c9d296a9d296b9d297f9d29969d
+299b9d29a59d29a79d29b39d29d59d29fe9d29ff9d2a019d2a119d2a159d2a22
+9d2a2e9d2a6a9d2a949d2a959d2a989d2a9d9d2aaa9d2ab69d2aec9d2b189d2b
+199d2b2d9d2b429d2b459d2b4f9d2b509d2b5c9d2b7e9d2ba89d2ba99d2bbd9d
+2bd49d2bd99d2be39d2be59d2bf29d2c219d2c4b9d2c4c9d2c609d2c759d2c78
+9d2c829d2c839d2c919d2cc99d2cf59d2cf69d2cf99d2cff9d2d089d2d129d2d
+149d2d1f9d2d239d2d339d2d3e9d2d429d2d529d2d889d2db49d2db59d2dc99d
+2dde9d2de19d2deb9d2dec9d2df89d2e2d9d2e579d2e589d2e699d2e979d2ec3
+9d2ec49d2ed89d2eef9d2ef49d2efe9d2f009d2f0c9d2f3b9d2f649d2f659d2f
+679d2f779d2f7b9d2f889d2fb99d2fe49d2fe59d2fe89d2fed9d2ff59d30269d
+30529d30539d30679d307f9d30869d30909d30949d30a19d30d19d30fd9d30fe
+9d31139d31399d31559d31609d31729d317f9d31ad9d31da9d31db9d31e09d31
+e59d31f39d31f89d31fb9d32009d32049d32109d32e09d32f39d33229d33519d
+33529d33579d335c9d336b9d33709d33739d33789d337c9d33889d34589d3471
+9d349e9d34cd9d34ce9d34d39d34d89d34e29d34e79d34ea9d34ef9d34f39d34
+ff9d36049d36179d36449d36739d36749d36799d367e9d368a9d368f9d36929d
+36979d369b9d36a79d376d9d37809d37af9d37de9d37df9d37e49d37e99d37f8
+9d37fd9d38009d38059d38099d38149d3ccd9d3cf89d3d279d3d289d3d2d9d3d
+329d3d3c9d3d419d3d449d3d499d3d4d9d3d589d42119d42429d42719d42729d
+42779d427c9d428c9d42919d42949d42999d429d9d42a99d43799d43929d43c0
+9d43ef9d43f09d43f59d43fa9d440a9d440f9d44129d44179d441b9d44279d44
+f79d45109d45429d456f9d45709d45759d457a9d45879d458c9d45a09d45a59d
+45a89d45dc9d46089d46099d461e9d46349d46389d46439d46459d46529d468b
+9d46b69d46b79d46cc9d46e69d46f09d46fb9d47019d470e9d473b9d47689d47
+699d476e9d47739d477f9d47849d47879d478c9d47909d479c9d48fb9d4c099d
+4c389d4c679d4c689d4c6d9d4c729d4c809d4c859d4c889d4c8d9d4c919d4c9d
+9d4dc79d50d59d51019d512e9d512f9d51349d51399d51449d51499d514c9d51
+519d51559d51619d526a9d55789d55969d55a59d55a69d55a99d55aa9d55b59d
+55bd9d55e99d56029d56039d56069d56079d560a9d560f9d56129d561d9d561f
+9d56499d56619d56629d56659d566a9d566d9d56909d56a49d56a59d56a89d56
+a99d56ac9d56b79d56bb9d56df9d56ef9d56f09d56f39d571c9d572c9d572d9d
+57309d57559d576b9d576c9d576f9d57709d57739d577e9d57809d57a89d57c3
+9d57c49d57c79d57ea9d57f99d57fa9d57fd9d57fe9d58019d580c9d580c0301
-87afea1f


end class;

class LoginWin is mapped inherits from DisplayBD.LoginWinDesc

has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);
	classlineage = (
		name = 'DisplayBD.LoginWinDesc');

has
+51514631000012bc000010a39fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101010100009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405060100000201
+000100001200000200500001000000000003000021010200000000050400001c
+0205054c6f67696e100506007a08004d009fff010101010f1011120101010100
+009fff010000000d00005dc05dbf000000000303030300020404a0a000000000
+00000000009d5dc09d5dbf000000000000010807680100000000000000000000
+02010000000009000007000021010200000000080806007c08000d0005054772
+696430010104010f1011120101011700019fff0c0000000d000005dc0fc90000
+00000303030300050404606000002205dc07d000009d05dc9d0fc90000000000
+00010809100100000000000000000000020100000000040101009fff009fff20
+010100000a000004040100020b00090000210102000000000b0a060003020100
+00000000000b06007a08004d00060650616e656c30010104010f101112010101
+1700029fff0d0000000d000005b20fa000010001030503030008040460600000
+2203e80fa000009d05b29d0fa000000000000001080c6001ff81000000000000
+00000201000000000900000c0000210102000000000d0d06007c08000d000000
+010104010f1011120101011700009fff9e0001000c0000000d9fd79fd705c70f
+b50000000003512a03000b040460600000220000000000009d05c79d0fb50000
+0000000001080e10010000000000000000000002010000000004020200000000
+00010100000f000000000404000000000210001112130000000e000021030200
+0000001013110f06000302010000000000001006007c08000d00000001010401
+0f1011120101011700009fff9e0001000d0000000d1f0004500d1a0001000103
+030303000d040360600000220000000000009d04509d0d1a0100000000000108
+141001ff810000000000000000020100000000040202009fff009fff20010100
+1315000000000404000000000216171800191a1b001400002104020000000016
+18191b1506000302010000000028281606009208208102000021210401212121
+212121212100009fff9e0001000e0000000d9d02af9c9c00d001fe0001000103
+03030300100101a0a00000000000000000009cd09d01fe000000000000010301
+0b1c0103640100009e0044201400000000001c00001c0206064e6f6d203a0a10
+170600030208000000000000180600f6082089020808557365726e616d650102
+04212121212101010117000308085465787444617461110000000d9d050c9c9c
+00c607bb00010002030503030010010180a00000440000000000009cc69d07bb
+0000000000000103020107001e040009ff8100009e0040001403010019060092
+08208102000021210401212121212121212100009fff9e0001000f0000000d2a
+9d02b000d00484000200010303030300100101a0a00000000000000000009cd0
+9d04840000000000000103010b1d0103640100009e0044201400000000001d00
+001c020f0f4d6f74206465207061737365203a0a101a06000302080000000000
+001b0600f608208902080850617373776f726401020421212121210101011700
+0408085465787444617461130000000d9d050c9d02ba00c607bb000200020305
+03030010010580a0001e440000001e00009cc69d07bb00000000000001030201
+07001e040009ff8100009e104000140301001e0600b4080009020404526f6c65
+01020421212121210101011700050707496e7465676572160000000d9d050c1f
+00db07bb00010002030503030013010580a0001b220000000000009cdb9d07bb
+00000000000001030201041f0700000003041f00002100020001a6011106007c
+08000d000000010104010f1011120101011700009fff9e000100120000000d9d
+0d8200041c01df0001000203030303000d010160600000000000000000009d04
+1c9d01df00000000000001082010010000000000000000000002010000000004
+0201009fff009fff000101000021000000040400000002220023002000002102
+02000000002223210600030201000028280014220601130802010208084c6f67
+696e42746e01020421212121212121211700069fff180000000d002a01a101a1
+00010001030303030011010180800000000000000000009d01a19d01a1000000
+00000001020124002400010f000125250001120001802020260001082020009d
+0400000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000404040404000000
+0000000000000000000000000000000000000000000000040402020201030000
+0000000000000000000000000000000000000000000004040202020103030000
+0000000000000000000000000000000000000000000404020202010303030000
+0000000000000000000000000404040000000000040402020201030303000000
+0000000000000000000000040202020100000004040202020103030300000000
+0000000000000000000000040202020103000404020202010303030000000000
+0000000000000000000000040202020103040402020201030303000000000000
+0000000000000000000000040202020104040202020103030300000000000000
+0000000000000000000000040202020204020202010303030000000000000000
+0000000000000000000000040202020202020201030303000000000000000000
+0000000000000000000000040202020202020103030300000000000000000000
+0000000000000000000000020202020202010303030000000000000000000000
+0000000000000000000000000202020201030303000000000000000000000000
+0000000000000000000000000002010103030300000000000000000000000000
+0000000000000000000000000000030303030000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+000026000110000105000fc0c0c000008000800080808000ff00230601130802
+01020a0a416e6e756c657242746e01020421212121212121211700079fff1900
+00000d009d022801a101a1000200010303030300110101808000000000000000
+00009d01a19d01a100000000000001020027002700010f000128280001120001
+802020290001082020009d040000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000505050505000000
+0505050505000000000000000000000000000000000000000501010101030400
+0505010101040400000000000000000000000000000000000505010101030404
+0505010104040400000000000000000000000000000000000405050101030405
+0501010304040400000000000000000000000000000000000005050101010505
+0101030404040000000000000000000000000000000000000004050501010101
+0103040404000000000000000000000000000000000000000000020501010101
+0304040400000000000000000000000000000000000000000000000501010103
+0404040000000000000000000000000000000000000000000000050501010101
+0304000000000000000000000000000000000000000000000005050101010101
+0103040000000000000000000000000000000000000000000505010103050101
+0103040400000000000000000000000000000000000000050501010304050501
+0101030404000000000000000000000000000000000005050101030404040505
+0101010304040000000000000000000000000000000005010101030404000005
+0501010103040400000000000000000000000000000000050303030404000000
+0503030303040400000000000000000000000000000000000004040404000000
+0000040404040400000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+0000000000000000000000000000000000000000000000000000000000000000
+00000000000000000000000000290001100001060012c0c0c080000000808000
+0000808080ff00001206000302060000000000001306007c08000d0000000101
+04010f1011120101011700009fff9e000100100000000d1f9d045b01430d1a00
+02000103030303000d040360600000220000000000009d01439d0d1a01000000
+000001082a1001ff810000000000000000020100000000040102009fff009fff
+20010100102b0000000404000000022c2d1e002a0000210202000000002c1e2b
+06000302010000000028282c060092082081029fff2121040121212121212121
+2100009fff9e000100110000000d9d02a51f00d0020900010001030303030013
+0101a0a00000000000000000009cd09d02090000000000000103010b2e010364
+0100009e0044201400000000002e00001c02070752f46c65203a0a102d060003
+02080000000000000606005e08002e009fff0303030303030303030303030000
+9fff0200000008009fff000000000000000000000002012f012f000021000200
+0000002f1a919c9c9ca99d01099d01149d018e9d01999d01a59d020b9d02169d
+02999d02a69d02b29d03359d03439d034f9d03b29d03c09d03cc9d043c9d049e
+9d04b59d04c19d05329d05929d059c9d061b9d06279d06339d06889d068f9d0a
+a29d0aba9d0b139d0b1a9d0f2d9d0f489d0f549d0fd39d0fdf9d0feb9d104d9d
+105c9d10689d10999d10a38c191a38626377919b9c9c9ca09ca99cc79cf19cf2
+9d01069d01099d01139d01149d01379d01619d01629d01769d018b9d018e9d01
+989d01999d01a59d01c99d01f39d01f49d02089d020b9d02159d02169d02389d
+02649d02659d02799d02909d02999d02a39d02a69d02b29d02d49d02fe9d02ff
+9d03139d032c9d03359d033f9d03439d034f9d03719d039d9d039e9d03a09d03
+b29d03b69d03c09d03cc9d03fa9d04269d04279d042a9d042f9d043c9d045e9d
+04899d048a9d048c9d049e9d04a29d04b59d04c19d04ef9d051c9d051d9d0520
+9d05259d05329d055b9d05869d05879d058a9d05909d05929d059c9d059c9d05
+be9d05ea9d05eb9d05ff9d06169d061b9d06259d06279d06339d06599d06839d
+06849d06889d068c9d068f9d06999d0aa29d0aba9d0ae29d0b0e9d0b0f9d0b13
+9d0b179d0b1a9d0b249d0f2d9d0f489d0f549d0f769d0fa29d0fa39d0fb79d0f
+ce9d0fd39d0fdd9d0fdf9d0feb9d100d9d10389d10399d103b9d104d9d10519d
+105c9d10689d10869d10959d10969d10989d10999d10a39d10a30301
-147c7323


end class;

class MenuWin is mapped inherits from DisplayProject.UserWindow

has public  method Display;
has public  method Init;

has property
	shared=(allow=on, override=on, default=off);
	transactional=(allow=on, override=on, default=off);
	monitored=(allow=on, override=on, default=off);
	distributed=(allow=off, override=off);

has
+515146310000013d0000010d9fe3010100002101020000000002020600940800
+1d009fff010104210f1011120101011700009fff000000000d00000bb80fa000
+000000000000000000010160600000000000000000009d0bb89d0fa000000000
+00000108030301fffd00000000000000000201000000000f0405000600000201
+000100000f00000100030001000000000003000021010200000000050400001c
+0200100506007a08004d009fff010101010f1011120101011700009fff010000
+000d00005dc05dbf000000000303030300020404a0a00000000000000000009d
+5dc09d5dbf0000000000000108066b0100000000000000000000020100000000
+09000006000021000200000000061a919c9c9ca39d01039d010d12191a386263
+77919b9c9c9ca09ca39cc19ceb9cec9d01009d01039d010d9d010d0301
-0021dc63


end class;
-- END CLASS DEFINITIONS

-- START SERVICE OBJECT DEFINITIONS
service SoFrontCommClt : EvenementTarificationClt.FrontCommClt = (DialogDuration = SESSION,
	Visibility = user,
	FailOver = FALSE,
	LoadBalance = FALSE) HAS PROPERTY extended = (UUID = '04A43F3D-0BFC-11D1-BE4E-1F5BB6EEAA77');
-- END SERVICE OBJECT DEFINITIONS

-- START CURSOR DEFINITIONS
-- END CURSOR DEFINITIONS

-- START TYPEDEF DEFINITIONS
-- END TYPEDEF DEFINITIONS

-- START METHOD DEFINITIONS

------------------------------------------------------------
method ActionMgr.DoAction(input pAction: Framework.integer,
	input pObjet: Framework.Object)
begin
--
--	Description :	Cette méthode permet de gérer des actions propres aux projets utilisateurs
--					(par exemple un calcul).	
--
--	Type :	Concret
--
--	Parametres :	Input	--> pAction :	Code action non répertorié dans les actions standards
--					Input	--> pObjet 	:	Paramètre lié à l'arction (il faudra caster en fonction de l'action)
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	-	ActionExc : générée en cas d'action inconnue.
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- ActionMgr.DoAction');


-- Traitement


Case pAction is
--	When ACT_UNEACTION do
	Else do
		unExc : ActionExc = new;
		unExc.Message.Concat(pAction);
		Self.TraceExc(unExc, 'ActionMgr.DoAction');
		Raise unExc;
End Case;
-- Fin du traitement


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- ActionMgr.DoAction : End');

Return;


end method;

------------------------------------------------------------
method ActionMgr.Init
begin
super.Init();

end method;

------------------------------------------------------------
method ControlWin.Init
begin
super.Init();
-- Définition du nom de l'application 
Self.ApplicationName = APP_APPLICATIONNAME;

-- Affectation des Menus utilisés en menu contextuel
hWin : MenuWin = new;
Self.MenuRef = hWin.Window.Menu;

-- Affection du manager d'actions
hActionMgr : ActionMgr = new;
Self.MyActionMgr = hActionMgr;
Self.MyActionMgr.MyControlWin = Self;

end method;

------------------------------------------------------------
method FrontCommClt.DoInitService
begin
--
--	Description :	Cette méthode permet d'initialiser le service (Définition du serveur de cmmunication et des dépendances).
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- FrontCommClt.DoInitService');

Self.FrontCommSrv = SoFrontCommSrv;
Self.Dependances.AppendRow(Self.FrontCommSrv);
Task.Delay(1000);
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- FrontCommClt.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method FrontCommClt.Init
begin
super.Init();
Self.IsUsingFrontCommSrv = FALSE;

end method;

------------------------------------------------------------
method InitApp.DoInitService
begin
--
--	Description :	Cette méthode permet d'initialiser le service (Définition du serveur de cmmunication et des dépendances).
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : 	Aucune
--
--	Utilisation : Globale
--
--	Historique :
--
--	D. NGUYEN	  |	15/06/1997	|	Création pour exemple.
--	D. NGUYEN	  |	04/07/1997	|	Corrections (simplification des init).
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.DoInitService');

-- Définition de la frontale de communication
TmpFrontComm : FrontCommClt = SoFrontCommClt;
Self.FrontComm = TmpFrontComm;
Self.Dependances.AppendRow(Self.FrontComm);

-- Définition du controleur de fenêtres
TmpControlWin : ControlWin = new();
TmpControlWin.ApplicationName = APP_APPLICATIONNAME; -- Définition du nom de l'application 
hWin : MenuWin = new; -- Affectation des Menus utilisés en menu contextuel
TmpControlWin.MenuRef = hWin.Window.Menu;
--hActionMgr : ActionMgr = new(FrontComm = TmpFrontComm, InterfaceMgr=TmpInterfaceMgr); -- Affection du manager d'actions
hActionMgr : ActionMgr = new(FrontComm = TmpFrontComm); -- Affection du manager d'actions

TmpControlWin.MyActionMgr = hActionMgr;
TmpControlWin.MyActionMgr.MyControlWin = TmpControlWin;
TmpControlWin.DictionaryBSMgr = soDictionaryBSMgr;
Self.Dependances.AppendRow(TmpControlWin.DictionaryBSMgr);

Self.MyControlWin = TmpControlWin;
Self.MyControlWin.FrontComm = Self.FrontComm;
Self.Dependances.AppendRow(Self.myControlWin);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.DoInitService : End');

Return;

end method;

------------------------------------------------------------
method InitApp.DoOpenApplication
begin
--
--	Description : 	démarre l'application. En général par l'ouverture d'une ou plusieurs fenêtres.
--					La fenêtre principale de l'application doit obligatoirement être lancée en mode synchrone;
--					sinon, on sort de l'application.
--
--	Type :	Concret
--
--	Parametres :	Auncun
--
--	Pre-condition :	Aucun
--
--	Post-condition :	Aucun
--
--	Exceptions :	Aucun
--
--	Usage : InitApp
--
--	History :
--
--	D. NGUYEN	|	22/05/1996	|	Creation.
--+
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.OpenApplication');

hWin : LoginWin = new;	-- Fenêtre de login
hWin.MyControlWin = Self.MyControlWin;
hWin.FrontComm = Self.MyControlWin.FrontComm;
hWin.Parent = Self;
hWin.Display();

hWin1 : EvenementTArificationWin = new;	-- Fenêtre principale de l'application
Self.MyControlWin.InitWin = hWin1;
Self.MyControlWin.Display(hWin1, CTW_ASYNCDISP);


hWin2 : EvenementTarificationWin = new;	-- Fenêtre principale de l'application

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.OpenApplication : End');

Return;

Exception
	When e:GenericException do
		Self.TraceExc(e,'InitApp.OpenApplication');
		Raise;
 


end method;

------------------------------------------------------------
method InitApp.Init
begin
super.Init();

end method;

------------------------------------------------------------
method InitApp.StartApp
begin
--
--	Description : 	Synchronization of the service objects due at the startup of the current service.
--
--	Type :	Abstract
--
--	Parameters :	Input	-->	aServiceMgr	:	Service Manager as a Service Object
--
--	Pre-condition : None
--
--	Post-condition : None
--
--	Exceptions : None
--
--	Usage : Startup of the application
--
--	History :
--
--	D. NGUYEN	|	27/05/1997	|	Creation.
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- InitApp.StartApp');

Super.SyncServices();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- InitApp.StartApp : End');

Return;

Exception
	When e:DistributedAccessException do
		Task.Delay(1000);
		Self.SyncServices();
end method;

------------------------------------------------------------
method EvenementTarificationWin.ChangementProduit
begin
--	Description :	traitements à faire lors d'un changement de selection portant sur le code Produit
--
--	Type :	Concret
--
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.ChangementProduit');


UnCodeProduit : RefTypeProduitDesc = self.Evenement.CodeProduit;
ListeSelection : Array of IntegerData = New();
aTransData : Transdesc = New();
aTransdata.TransActionService = ACT_TARIF_SERVICESEMIS_PARRC;
aTransData.TransObject = UnCodeProduit;

--Chargement des services dont les événements de tarification doivent être émis par RC et correspondants
--au produit séléctionné par l'utilisateur
ListeSelection = (Array of IntegerData)(transfer(aTransData,soCatalogueBSMgr,ProduitBS));


-- chargement dans la scrollList des services lus
self.InitScrollList(self.<Evenement.CodeService>,'RefTypeServiceDesc',ListeSelection);

-- Affectation du premier service trouvé au champ CodeService
self.Evenement.CodeService.SetValue(self.<Evenement.CodeService>.ExtractListElementByIndex(1).IntegerValue);

-- Affichage des champs à saisir en fonction de la nature du service (Prix fixe, prix dépendant du montant,
-- Prix dépedant de la quantité)
self.ChangementService();


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.ChangementProduit : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.ChangementProduit');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.ChangementService
begin
--Descrition : Affichage des champs à saisir en fonction de la nature du service
--				Le tarif du service peut être fixe, dépendre du montant ou de la quantité
--				
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.ChangementService ');
			
UnService : Service_Desc = New();

--Paramétrage du transfert et lecture du service séléctionné par l'utilisateur
aTransdata : Transclass = New();
aTransdata.TransActionService = ACT_STD_READ;
atransData.aRecordSelfDesc.selfDesc=New();
atransData.aRecordSelfDesc.SelfDesc.AppendRow();
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemName = 'WhereService';
atransData.aRecordSelfDesc.SelfDesc[atransData.aRecordSelfDesc.SelfDesc.Items].ItemReference = self.Evenement.CodeService;

-- Lecture
UnCache : Array of CacheDesc= (Array of CacheDesc)(transfer(atransdata,soCatalogueBSMgr,ServiceBS));

--Parcours du cache: en fonction de la nature du service, on rend visible certains champs.
If UnCache <> NIL and UnCache.Items > 0 then
	For aCacheDesc in UnCache do
		self.TypeTarif = (Service_Desc)(aCacheDesc.Record).TypeTarif;
		case self.TypeTarif.Value is
			when TYPE_TARIF_MONTANT do 	self.<Evenement.GridDecoMontant>.State=FS_UPDATE;
												self.<Evenement.GridQuantite>.state=FS_INVISIBLE;
												self.<Evenement.GridMontant>.state=FS_UPDATE;
			when TYPE_TARIF_QUANTITE do 	self.<Evenement.GridDecoMontant>.State=FS_UPDATE;
												self.<Evenement.GridMontant>.State = FS_INVISIBLE;
												self.<Evenement.GridQuantite>.State = FS_UPDATE;
			when TYPE_TARIF_FIXE do   	self.<Evenement.GridDecoMontant>.State=FS_INVISIBLE;
		End case;
	end for;
end if;


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.ChangementService : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.ChangementService');
		Raise;

end method;

------------------------------------------------------------
method EvenementTarificationWin.CreerEvenement
begin
-- Descrition : Cette méthode a pour but de'affecter les données qui ne sont pas saisies à l'écran
--				 Ces données sont présentes dans des domaines variés, totalement externe au Catalogue 
--					Produit ou au domaine de la tarification.
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--
--+


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.CreerEvenement ');

-- Date Courante
date : DteDesc = new(); 
date.SetCurrent();

--self.Evenement.DateOperation = New();--date du jour
self.Evenement.DateOperation = Date;
--self.Evenement.CodeAgence = New();
self.Evenement.CodeAgence.SetValue('Banque Directe'); --lié au conseiller
--self.Evenement.CodeEtab = New();
self.Evenement.CodeEtab.SetValue('Banque Directe');   --lié au conseiller
self.Evenement.CodeCanal.SetValue(1);                 --identifiant du conseiller
self.Evenement.CompteAFacturer.SetValue('1000715');   --lié au contrat ? NumSurCompt
self.Evenement.NumContrat.SetValue('10007151');	  --lié au codeproduit et au numclient
self.Evenement.NumCompte.SetValue('1000716');			  --?????
--self.Evenement.CodeDevise=New();
--self.Evenement.CodePackage=New();
--self.Evenement.CodePromotion=New();

--le code devise correspond à la devise du compte pour toutes les opérations dont le codeemissionevenement est différent de 6
--Traiter EtaCre

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.CreerEvenement : End');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.CreerEvenement');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.DoAffectObject(output pObject: Framework.Object)
begin
--
--	Description : 	Affectation des données affichées à l'objet de données.
--
--	Type :	Concret
--
--	Parametres :	Output -->	pObject :	Objet de réception des données
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : EvenementTarificationWin
--
--	History :
--
--	CDC |
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.DoAffectObject');

self.CreerEvenement();	--affectation des données non saisies au niveau de l'IHMEvenementTarificationWin
pObject = self.Evenement;

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.DoAffectObject : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.DoAffectObject');
		Raise;
	When e : GenericExc do
		self.AffStatusLine (e.Source);
		
end method;

------------------------------------------------------------
method EvenementTarificationWin.DoAffRecord(input pRecord: DataAccessSrvBD.ObjectSelfDesc)
begin

--	Description : 	Affiche l'enregistrement passé en paramètre.
--
--	Type :	Concret
--
--	Parametres :	Input -->	pRecord :	enregistrement à afficher
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Usage : EvenementTarificationWin
--
--	History :
--
--	CDC	|	
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.DoAffRecord ');


Self.Evenement = (EvenementTarificationDesc)(pRecord);

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.DoAffRecord : End');

Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.DoAffRecord');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.Init
begin
--
--	Description :	Initialisation de la fenêtre.
--
--	Type :	Concret
--
--	Parametres :	
--
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation : EvenementTarificationWin
--
--	Historique :
--
--  CDC |	
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.Init');

unRecord : EvenementTarificationDesc = new;
unRecord.DoResetAttributes();
BufferStructure = unRecord;

date : datetimedata = new;
date.SetCurrent(resolution= DR_DAY);	--date du jour exprimée sous forme jour,mois,année uniquement


--Initialisation des attributs de RegleDesc : équivaut à fixer des valeurs par défaut
InitAddEvenement : EvenementTarificationDesc = new();
InitAddEvenement.DoResetAttributes();
InitAddEvenement.CodeProduit = New();
InitAddEvenement.CodeService = New();
InitAddEvenement.RetrocessionBln.SetValue(FALSE);
self.InitAddValues = InitAddEvenement;


--Déclaration des services
MyTransType = soTarificationBSMgr; -- BusinessService Définition
MyClassType =EvenementTarificationBS; -- ClassType of the Service for BusinessTransactionService

super.Init();

ViewMode =FS_UPDATE;		-- FS_UPDATE : Mise à jour autorisée
self.FlagCTI=FALSE;
self.FlagInitReadData= FALSE;	--pas de lacture au démarrage de l'application
self.FlagRead = FALSE;			--application de saisie uniquement
self.ValidateConfirm = TRUE;	--demande de confirmation avant validation
--self.SimulationBln =TRUE;
self.SimulationBln =FALSE; -- Pas dans un contexte de simulation de tarification


Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.Init : End');



Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.Init');
		Raise;


end method;

------------------------------------------------------------
method EvenementTarificationWin.InitDisplay(input WithReadData: Framework.boolean = TRUE)
begin
--
--	Description : Chargement dans une scrollList des données du referentiel.
--				  Equivalent de DicoTrt.InitFillInFields.
--					Au démarrage de l'application, on charge la liste des produits qui contiennent les 
--					services dont les événements de tarification doivent être émis par RC.
--					Puis on se place sur le premier produit de cette liste et on procède à la lecture des 
--					services correspondants. Enfin, on n'affiche que les champs qui sont à saisir en respect
--					de la nature du produit.
--					Si on est en simulation, la radiolist qui permet d'opter pour la rétrocession ou la
--					tarification est rendu invisible. Il en est de même si l'utilisateur n'a pas les habilitations
--					nécessaires à la saisie d'une rétrocession.
--					Par défaut, on est en situation de saisie d'une événement de tarification.
--	
--
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : EvenementTarificationWin
--
--	History :
--
--  CDC |
--
--+

Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin.InitDisplay');

Super.InitDisplay(WithReadData);

--si habilitation permet et
if not SimulationBln then
	self.<RetrocessionBln>.TextValue.SetValue('Tarification');
	self.InitWinPourTarification();
	self.SetDataMode(ACT_STD_APPEND);
	<Panel0>.HasDataChanged = TRUE;
else									
	self.<GridDecoRetro>.State = FS_INVISIBLE;
	self.InitWinPourRetrocessionSimulation();
end if;

		
Task.Part.LogMgr.PutLine(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin.InitDisplay : End');

Return;
Exception
	When e : GenericException do
		Self.TraceExc(e,'EvenementTarificationWin.InitDisplay');
		Raise;


end method;

------------------------------------------------------------
method EvenementTarificationWin.InitListField(input aWidget: DisplayProject.Widget,
	input pBufferStructure: DataAccessSrvBD.ObjectSelfDesc,
	input pTypeLib: Framework.integer)
begin
--
--	Description : Chargement dans une ListField des données du referentiel.
--				  Equivalent de DicoTrt.InitFillInFields
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  pBufferStructure : ObjetSelfDesc de mapping (StandardDataWin.BufferStructure)
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--
-- CDC|
--+

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitListField');

if aWidget.IsA(Type=ListField) then
	for aDesc in pBufferStructure.SelfDesc do
		if aDesc.ItemName = aWidget.Name.Value then
			if aDesc.ItemReference.Isa(Type=DicoDesc) 
			 then
				-- Read the Dico
				aTransDico : TransDico = new();
				aTransDico.TransActionService = DICO_READ;
				aTransDico.aClassType = aDesc.ItemReference.GetClassType();
				aTransDico.TypeLib = pTypeLib;
				aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
				-- Change the ListField List Elements
				if aDicoClass <> NIL then
					if aWidget.IsA(Type=ListField) then
						(ListField)(aWidget).setElementList(List=aDicoClass.ListElements);
					end if;
				else
					if aDesc.ItemReference.Isa(Type=TypBooleanNullable) and (TypBooleanNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypBooleanNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypIntegerNullable) and (TypIntegerNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypIntegerNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDateTimeNullable) and (TypDateTimeNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypDateTimeNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypDoubleNullable) and (TypDoubleNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypDoubleNullable)(aDesc.ItemReference).ListValues);
						end if;
					elseif aDesc.ItemReference.Isa(Type=TypTextNullable) and (TypTextNullable)(aDesc.ItemReference).ListValues <> NIL then
						if aWidget.IsA(Type=ListField) then
							(ListField)(aWidget).setElementList(List=(TypTextNullable)(aDesc.ItemReference).ListValues);
						end if;
					end if;
				end if;
			end if;
		end if; 
	end for;
elseif aWidget.Isa(Type=CompoundField) then
	for aChild in (CompoundField)(aWidget).Children do
		InitListField(aChild, pBufferStructure, pTypeLib);
	end for;
end if;
Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin. InitListField : End');


Return;

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.InitListfield');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.InitScrollList(input aWidget: DisplayProject.Widget,
	input NomClassDico: Framework.string,
	input ListeSelection: Framework.Array of Framework.IntegerData)
begin
--
--	Description : 		1. Chargement des valeurs du dico pour une classe donnée : 
--							RefProduitDesc ou RefTypeServiceDesc
--						2. Affichage des valeurs présentes dans la sélection
--						
--	Type :	Concret
--
--	Parametres :	aWidget : champ cible de la fenêtre
--                  NomClassDico : nom de la classe du dico dont on souhaite connaître la liste des valeurs
--					ListeSelection : liste des valeurs à afficher.
--					exemple : on souhaite charger la liste des produits correspondant à un package,
--						 puis les afficherdans la scrolllist .
--					aWidget : self.<CodeProduit>
--					NomClassDico : RefTypeProduitDesc
--					ListeSelection : Liste des Codes produit our lesquels on
--						recherche les libelement dansle réferentiel et qu'on affiche ensuite
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Globale
--
--	History :
--

--+


Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitScrollList');



-- 1. Chargement des valeurs du dico pour une classe donnée : 
--		RefProduitDesc ou RefTypeServiceDesc
MaListeElement : Array of ListElement = New();

if ListeSelection <> NIL and ListeSelection.Items > 0 then
	aTransDico : TransDico = New();
	aTransDico.TransActionService = DICO_READ;
	aTransDico.aClassType = New (Name = NomClassDico);
	aDicoClass : DicoClassDesc = (DicoClassDesc)(DicoTransfer(aTransDico));
	
	
	--Si l'élément lu dans le réferentiel  fait  partie de la sélection, il est ajouté à la liste
	if aDicoClass <> NIL then
		for aElement in aDicoClass.ListElements do
			for UneSelection in ListeSelection do
				if UneSelection <> NIL then
					if aElement.IntegerValue=UneSelection.IntegerValue then
						MaListeElement.AppendRow(aElement);
					end if;
				end if;
			end for;
		end for;
	end if;
	(ListField)(aWidget).setElementList(List=MaListeElement);
else 
	aElement : ListElement = New();
	aElement.TextValue.SetValue(IDX_ZONEVIDE);
	MaListeElement.AppendRow(aElement);
	(ListField)(aWidget).setElementList(List=MaListeElement);
	self.AffStatusLine('Liste Vide');
end if;



Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin. InitScrollList : End');


Return;
	
	
Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.InitScrollList');
		Raise;


end method;

------------------------------------------------------------
method EvenementTarificationWin.InitWinPourRetrocessionSimulation
begin
-- Descrition : Chargement de l'ensemble des produits présents dans le Référentiel, placement sur les premier produit de la liste, 
--					puis lecture des services dont les événements doivent être émis par RC
--
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--
--+

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitWinPourRetrocessionSimulation');

self.DoAffRecord(InitAddValues);  --initialisation de l'instance modèle

self.InitListField(self.<Evenement.GridProduit>,self.BufferStructure,0); --chargement de la liste des produits du
																		 --	Référentiel
--placement sur le premier produit																		 
self.Evenement.CodeProduit.SetValue(self.<Evenement.CodeProduit>.ExtractListElementByIndex(1).IntegerValue);

--lecture des services correspondants
self.ChangementProduit();


Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitWinPourRetrocessionSimulation');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.InitWinPourRetrocessionSimulation');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.InitWinPourTarification
begin
-- Descrition : Chargement de l'ensemble des produits présents dans le Référentiel, placement sur les premier produit de la liste, 
--					puis lecture des services dont les événements doivent être émis par RC
--
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--
--+

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitWinPourTarification');


self.DoAffRecord(InitAddValues);
aTransData : TransDesc =  New();
aTransData.TransActionService = ACT_TARIF_PRODUITSEMIS_PARRC;
aTransData.TransObject = NIL;
ListeProduit : Array of RefTypeProduitDesc = (Array of RefTypeProduitDesc)(self.Transfer(aTransData,soCatalogueBSMgr,ProduitBS));
self.InitScrollList(self.<Evenement.CodeProduit>,'RefTypeProduitDesc',ListeProduit);
self.Evenement.CodeProduit.SetValue(self.<Evenement.CodeProduit>.ExtractListElementByIndex(1).IntegerValue);
self.ChangementProduit();


Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. InitWinPourTarification');


Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.InitWinPourTarification');
		Raise;
end method;

------------------------------------------------------------
method EvenementTarificationWin.VerifierValidite
begin
-- Descrition : Contrôle en fonction de la natutre du service. Si son tarif dépend
--					du montant, ce dernier devra être obligatoirement saisi.
--					Idem pour la quantité.
--
--	Type :	Concret
--
--
--	Parametres :	
--
--	Pre-condition : Aucune
--
--	Post-condition : Aucune
--
--	Exceptions : Aucune
--
--	Utilisation :EvenementTarificationWin
--
--	Historique :
--
--  CDC |
--
--+

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 1, '- EvenementTarificationWin. VerifierValidite');


case self.TypeTarif.Value is
	when TYPE_TARIF_MONTANT do 	self.Evenement.Montant.DoCheckValidity();
	when TYPE_TARIF_QUANTITE do self.Evenement.Quantite.DoCheckValidity();
End case;

Task.Part.LogMgr.Put(SP_MT_AUDIT, SP_ST_USER1, LOG_GRPFLAG, 2, '- EvenementTarificationWin. VerifierValidite');

Exception
	When e : GenericException do
		Self.TraceExc(e, 'EvenementTarificationWin.InitScrollList');
		Raise;
end method;

------------------------------------------------------------
event handler EvenementTarificationWin.ChangerSelectionEvh()
begin
when self.<Evenement.CodeProduit>.AfterValueChange() do
	self.ChangementProduit();
when self.<Evenement.CodeService>.AfterValueChange() do
	self.ChangementService();
	
end event;

------------------------------------------------------------
event handler EvenementTarificationWin.EventLoopHandler()
begin
--
--	Description :	Localisation des abonnements spécifiques à l'utilisateur.
--					Remarque : il est indispensable de s'abonner à l'EventLoopHandler de la super-classe. 	
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--


Register Super.EventLoopHandler();


Register self.ChangerSelectionEvh();

Register self.StandardOutilsEvenementEvh();
Register self.RetrocessionSaisieEvh();
end event;

------------------------------------------------------------
event handler EvenementTarificationWin.RetrocessionSaisieEvh()
begin
when <RetrocessionBln>.AfterValueChange do
	if self.<RetrocessionBln>.TextValue.IsEqual('Retrocession') then
		self.evenement.RetrocessionBln.SetValue(TRUE);
		self.InitWinPourRetrocessionsimulation();
	elseif self.<RetrocessionBln>.TextValue.IsEqual('Tarification') then
		self.evenement.RetrocessionBln.SetValue(FALSE);
		self.InitWinPourTarification();
	end if;


end event;

------------------------------------------------------------
event handler EvenementTarificationWin.StandardOutilsEvenementEvh()
begin
--
--	Description : 	Evènements à traiter dans le cadre de la barre d'outils relatives au prix public.
--
--	Type :	Abstrait
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : TarificationWin
--
--	Historique :
--
--	
--+
	
	when self.<ValiderEvenementBtn>.Click(eventInfo = eventInfo, x = x, y = y, modifier = modifier, node = node, row = row, column = column) do		
	if not SimulationBln then
			self.VerifierValidite();
			post self.<SauverBtn>.Click(eventInfo, x, y, modifier, node, row, column) ;
			<Evenement.NumClient>.RequestFocus();
			setDataMode(ACT_STD_APPEND);
			self.AffStatusLine(' ');
	end if;
end event;

------------------------------------------------------------
method LoginWin.Init
begin
super.Init();
end method;

------------------------------------------------------------
method MenuWin.Display
begin
self.Open();
event loop
	when task.Shutdown do
		exit;
end event;
self.Close();
end method;

------------------------------------------------------------
method MenuWin.Init
begin
--
--	Description :		Initialisation des menus contextuels
--
--	Type :	Concret
--
--	Parametres :	Aucun
--
--	Pre-condition : Aucun
--
--	Post-condition : Aucun
--
--	Exceptions : Aucun
--
--	Usage : Global
--
--	History :
--
--	D. Nguyen	|	07/05/1997	|	Création.
--+

super.Init();




end method;
-- END METHOD DEFINITIONS
HAS PROPERTY
	CompatibilityLevel = 0;
	ProjectType = APPLICATION;
	Restricted = FALSE;
	MultiThreaded = TRUE;
	Internal = FALSE;
	LibraryName = 'evenemen';
	StartingMethod = (class = InitApp, method = StartApp);


end EvenementTarificationClt;
